(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new t.Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="e476ae11-54f6-408c-97d2-b4a2f2447755",t._sentryDebugIdIdentifier="sentry-dbid-e476ae11-54f6-408c-97d2-b4a2f2447755")}catch{}})();function CW(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var J0e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};J0e.SENTRY_RELEASE={id:"1dc6584911fe333d951379e410225ec75a7f8d9f"};(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var la=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function es(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kW={exports:{}},T2={},RW={exports:{}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var db=Symbol.for("react.element"),X0e=Symbol.for("react.portal"),Z0e=Symbol.for("react.fragment"),Q0e=Symbol.for("react.strict_mode"),e_e=Symbol.for("react.profiler"),t_e=Symbol.for("react.provider"),n_e=Symbol.for("react.context"),r_e=Symbol.for("react.forward_ref"),i_e=Symbol.for("react.suspense"),s_e=Symbol.for("react.memo"),o_e=Symbol.for("react.lazy"),O$=Symbol.iterator;function a_e(t){return t===null||typeof t!="object"?null:(t=O$&&t[O$]||t["@@iterator"],typeof t=="function"?t:null)}var IW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xW=Object.assign,PW={};function Lv(t,e,n){this.props=t,this.context=e,this.refs=PW,this.updater=n||IW}Lv.prototype.isReactComponent={};Lv.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Lv.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function OW(){}OW.prototype=Lv.prototype;function i4(t,e,n){this.props=t,this.context=e,this.refs=PW,this.updater=n||IW}var s4=i4.prototype=new OW;s4.constructor=i4;xW(s4,Lv.prototype);s4.isPureReactComponent=!0;var M$=Array.isArray,MW=Object.prototype.hasOwnProperty,o4={current:null},AW={key:!0,ref:!0,__self:!0,__source:!0};function LW(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)MW.call(e,r)&&!AW.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:db,type:t,key:s,ref:o,props:i,_owner:o4.current}}function c_e(t,e){return{$$typeof:db,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function a4(t){return typeof t=="object"&&t!==null&&t.$$typeof===db}function l_e(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var A$=/\/+/g;function Qx(t,e){return typeof t=="object"&&t!==null&&t.key!=null?l_e(""+t.key):e.toString(36)}function $E(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case db:case X0e:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Qx(o,0):r,M$(i)?(n="",t!=null&&(n=t.replace(A$,"$&/")+"/"),$E(i,e,n,"",function(l){return l})):i!=null&&(a4(i)&&(i=c_e(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(A$,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",M$(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Qx(s,a);o+=$E(s,e,n,c,i)}else if(c=a_e(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Qx(s,a++),o+=$E(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function tw(t,e,n){if(t==null)return t;var r=[],i=0;return $E(t,r,"","",function(s){return e.call(n,s,i++)}),r}function u_e(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ss={current:null},FE={transition:null},d_e={ReactCurrentDispatcher:Ss,ReactCurrentBatchConfig:FE,ReactCurrentOwner:o4};function DW(){throw Error("act(...) is not supported in production builds of React.")}Mt.Children={map:tw,forEach:function(t,e,n){tw(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return tw(t,function(){e++}),e},toArray:function(t){return tw(t,function(e){return e})||[]},only:function(t){if(!a4(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Mt.Component=Lv;Mt.Fragment=Z0e;Mt.Profiler=e_e;Mt.PureComponent=i4;Mt.StrictMode=Q0e;Mt.Suspense=i_e;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=d_e;Mt.act=DW;Mt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=xW({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=o4.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)MW.call(e,c)&&!AW.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:db,type:t.type,key:i,ref:s,props:r,_owner:o}};Mt.createContext=function(t){return t={$$typeof:n_e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:t_e,_context:t},t.Consumer=t};Mt.createElement=LW;Mt.createFactory=function(t){var e=LW.bind(null,t);return e.type=t,e};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(t){return{$$typeof:r_e,render:t}};Mt.isValidElement=a4;Mt.lazy=function(t){return{$$typeof:o_e,_payload:{_status:-1,_result:t},_init:u_e}};Mt.memo=function(t,e){return{$$typeof:s_e,type:t,compare:e===void 0?null:e}};Mt.startTransition=function(t){var e=FE.transition;FE.transition={};try{t()}finally{FE.transition=e}};Mt.unstable_act=DW;Mt.useCallback=function(t,e){return Ss.current.useCallback(t,e)};Mt.useContext=function(t){return Ss.current.useContext(t)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(t){return Ss.current.useDeferredValue(t)};Mt.useEffect=function(t,e){return Ss.current.useEffect(t,e)};Mt.useId=function(){return Ss.current.useId()};Mt.useImperativeHandle=function(t,e,n){return Ss.current.useImperativeHandle(t,e,n)};Mt.useInsertionEffect=function(t,e){return Ss.current.useInsertionEffect(t,e)};Mt.useLayoutEffect=function(t,e){return Ss.current.useLayoutEffect(t,e)};Mt.useMemo=function(t,e){return Ss.current.useMemo(t,e)};Mt.useReducer=function(t,e,n){return Ss.current.useReducer(t,e,n)};Mt.useRef=function(t){return Ss.current.useRef(t)};Mt.useState=function(t){return Ss.current.useState(t)};Mt.useSyncExternalStore=function(t,e,n){return Ss.current.useSyncExternalStore(t,e,n)};Mt.useTransition=function(){return Ss.current.useTransition()};Mt.version="18.3.1";RW.exports=Mt;var y=RW.exports;const re=es(y),c4=CW({__proto__:null,default:re},[y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f_e=y,h_e=Symbol.for("react.element"),p_e=Symbol.for("react.fragment"),g_e=Object.prototype.hasOwnProperty,m_e=f_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v_e={key:!0,ref:!0,__self:!0,__source:!0};function NW(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)g_e.call(e,r)&&!v_e.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:h_e,type:t,key:s,ref:o,props:i,_owner:m_e.current}}T2.Fragment=p_e;T2.jsx=NW;T2.jsxs=NW;kW.exports=T2;var b=kW.exports,UW={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(la,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function s(v,S){var _=v[S];if(typeof _.bind=="function")return _.bind(v);try{return Function.prototype.bind.call(_,v)}catch{return function(){return Function.prototype.apply.apply(_,[v,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?o:console[v]!==void 0?s(console,v):console.log!==void 0?s(console,"log"):e}function c(v,S){for(var _=0;_<i.length;_++){var w=i[_];this[w]=_<v?e:this.methodFactory(w,v,S)}this.log=this.debug}function l(v,S,_){return function(){typeof console!==n&&(c.call(this,S,_),this[v].apply(this,arguments))}}function u(v,S,_){return a(v)||l.apply(this,arguments)}function d(v,S,_){var w=this,T;S=S??"WARN";var C="loglevel";typeof v=="string"?C+=":"+v:typeof v=="symbol"&&(C=void 0);function I(U){var N=(i[U]||"silent").toUpperCase();if(!(typeof window===n||!C)){try{window.localStorage[C]=N;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+N+";"}catch{}}}function R(){var U;if(!(typeof window===n||!C)){try{U=window.localStorage[C]}catch{}if(typeof U===n)try{var N=window.document.cookie,L=N.indexOf(encodeURIComponent(C)+"=");L!==-1&&(U=/^([^;]+)/.exec(N.slice(L))[1])}catch{}return w.levels[U]===void 0&&(U=void 0),U}}function O(){if(!(typeof window===n||!C)){try{window.localStorage.removeItem(C);return}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}w.name=v,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=_||u,w.getLevel=function(){return T},w.setLevel=function(U,N){if(typeof U=="string"&&w.levels[U.toUpperCase()]!==void 0&&(U=w.levels[U.toUpperCase()]),typeof U=="number"&&U>=0&&U<=w.levels.SILENT){if(T=U,N!==!1&&I(U),c.call(w,U,v),typeof console===n&&U<w.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+U},w.setDefaultLevel=function(U){S=U,R()||w.setLevel(U,!1)},w.resetLevel=function(){w.setLevel(S,!1),O()},w.enableAll=function(U){w.setLevel(w.levels.TRACE,U)},w.disableAll=function(U){w.setLevel(w.levels.SILENT,U)};var A=R();A==null&&(A=S),w.setLevel(A,!1)}var f=new d,p={};f.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var _=p[S];return _||(_=p[S]=new d(S,f.getLevel(),f.methodFactory)),_};var m=typeof window!==n?window.log:void 0;return f.noConflict=function(){return typeof window!==n&&window.log===f&&(window.log=m),f},f.getLoggers=function(){return p},f.default=f,f})})(UW);var y_e=UW.exports;const H0=es(y_e),$W="matrix";H0.methodFactory=function(t,e,n){return function(...r){return this.prefix&&r.unshift(this.prefix),t==="error"||t==="warn"||t==="trace"||t==="info"||t==="debug"?console[t](...r):console.log(...r)}};function FW(t){const e=t;e.getChild=e.withPrefix=function(n){const r=this.prefix||"";return __e(r+n)}}function __e(t){const e=H0.getLogger(`${$W}-${t}`);return e.prefix!==t&&(FW(e),e.prefix=t,e.setLevel(H0.levels.DEBUG,!1)),e}const k=H0.getLogger($W);k.setLevel(H0.levels.DEBUG,!1);FW(k);class Jft{constructor(e,n){this.parent=e,this.name=n+":"}trace(...e){this.parent.trace(this.name,...e)}debug(...e){this.parent.debug(this.name,...e)}info(...e){this.parent.info(this.name,...e)}warn(...e){this.parent.warn(this.name,...e)}error(...e){this.parent.error(this.name,...e)}}const b_e="l",S_e="rn",w_e={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":","ꓽ":":","⩴":"::=","⧴":":→","！":"!",ǃ:"!","ⵑ":"!","‼":"!!","⁉":"!?",ʔ:"?","Ɂ":"?","ॽ":"?",Ꭾ:"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·",ᐧ:"·","⋯":"···","ⵈ":"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'","ʹ":"'","ʹ":"'","ˈ":"'","ˊ":"'","ˋ":"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'","ꞌ":"'",י:"'","ߴ":"'","ߵ":"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''","ʺ":"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/","Ⳇ":"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·","Ⲵ":"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">","𖼿":">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2",Ƨ:"2",Ϩ:"2","Ꙅ":"2",ᒿ:"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3",Ȝ:"3",Ʒ:"3","Ꝫ":"3","Ⳍ":"3",З:"3",Ӡ:"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6",б:"6",Ꮾ:"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a",ɑ:"a",α:"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a",а:"a","ⷶ":"ͣ",Ａ:"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A",Α:"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A",А:"A",Ꭺ:"A",ᗅ:"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B",Β:"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B",В:"B",Ᏼ:"B",ᗷ:"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ","ᏼ":"ʙ",ｃ:"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c",ϲ:"c","ⲥ":"c",с:"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C","Ⅽ":"C",ℂ:"C",ℭ:"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C",С:"C",Ꮯ:"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄	⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ",є:"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d",Ꮷ:"d",ᑯ:"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D","ꓓ":"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵","ꝺ":"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ","ꭰ":"ᴅ","⸹":"ẟ",δ:"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ",ծ:"ẟ",ᕷ:"ẟ","℮":"e",ｅ:"e",ℯ:"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E",Ε:"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E",Е:"E","ⴹ":"E",Ꭼ:"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E",ě:"ĕ",Ě:"Ĕ","ɇ":"e̸","Ɇ":"E̸",ҿ:"ę","ꭼ":"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ",ɚ:"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ","Ԑ":"Ɛ",Ꮛ:"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ",з:"ɜ",ҙ:"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f",ſ:"f","ẝ":"f",ք:"f","𝈓":"F",ℱ:"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F",Ϝ:"F","𝟊":"F",ᖴ:"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F",ƒ:"f̦",Ƒ:"F̦","ᵮ":"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g",ɡ:"g","ᶃ":"g",ƍ:"g",ց:"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G",Ꮐ:"G",Ᏻ:"G","ꓖ":"G","ᶢ":"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ",ｈ:"h",ℎ:"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H",Η:"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H",Н:"H",Ꮋ:"H",ᕼ:"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ",ɦ:"h̔","ꚕ":"h̔",Ᏺ:"h̔","Ⱨ":"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵","Ӊ":"H̦",Ӈ:"H̦",н:"ʜ","ꮋ":"ʜ",ң:"ʜ̩","ӊ":"ʜ̦",ӈ:"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i",ｉ:"i","ⅰ":"i",ℹ:"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i",ı:"i","𝚤":"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i",і:"i","ꙇ":"i","ӏ":"i","ꭵ":"i",Ꭵ:"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii",ĳ:"ij","ⅳ":"iv","ⅸ":"ix",ｊ:"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j",ϳ:"j",ј:"j",Ｊ:"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J",Ј:"J",Ꭻ:"J",ᒍ:"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵",ᒙ:"J·","𝚥":"ȷ",յ:"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k",K:"K",Ｋ:"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K",Κ:"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K",К:"K",Ꮶ:"K",ᛕ:"K","ꓗ":"K","𐔘":"K",ƙ:"k̔","Ⱪ":"K̩",Қ:"K̩","₭":"K̵","Ꝁ":"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:b_e,Ｉ:"l","Ⅰ":"l",ℐ:"l",ℑ:"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l",Ɩ:"l",ｌ:"l","ⅼ":"l",ℓ:"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l",ǀ:"l",Ι:"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l","𞸀":"l","𞺀":"l",ﺎ:"l",ﺍ:"l","ߊ":"l","ⵏ":"l",ᛁ:"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L",ℒ:"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L",Ꮮ:"L",ᒪ:"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll","Ⅱ":"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ",Ｍ:"M","Ⅿ":"M",ℳ:"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M",Μ:"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N",Ν:"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩",Ɲ:"N̦","ᵰ":"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No","ͷ":"ᴎ",и:"ᴎ","𐑍":"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o",ο:"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o",σ:"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o",о:"o","ჿ":"o",օ:"o",ס:"o",ه:"o","𞸤":"o","𞹤":"o","𞺄":"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O",Ο:"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O",О:"O",Օ:"O","ⵔ":"O",ዐ:"O",ଠ:"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º",ǒ:"ŏ",Ǒ:"Ŏ","ۿ":"ô",Ő:"Ö",ø:"o̸","ꬾ":"o̸",Ø:"O̸","ⵁ":"O̸",Ǿ:"Ó̸",ɵ:"o̵","ꝋ":"o̵",ө:"o̵",ѳ:"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵","Ꝋ":"O̵",θ:"O̵",ϑ:"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵",Θ:"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵",Ө:"O̵",Ѳ:"O̵","ⴱ":"O̵",Ꮎ:"O̵",Ꮻ:"O̵","ꭴ":"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى","ൟ":"oരo",တ:"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p",ｐ:"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p",ρ:"p",ϱ:"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p",р:"p",Ｐ:"P",ℙ:"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P",Ρ:"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P",Р:"P",Ꮲ:"P",ᑭ:"P","ꓑ":"P","𐊕":"P",ƥ:"p̔","ᵽ":"p̵",ᑷ:"p·",ᒆ:"P'","ᴩ":"ᴘ","ꮲ":"ᴘ",φ:"ɸ",ϕ:"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ",ф:"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q",գ:"q",զ:"q",ℚ:"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q",ʠ:"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ",κ:"ĸ",ϰ:"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ",к:"ĸ","ꮶ":"ĸ",қ:"ĸ̩",ҟ:"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r",г:"r","ꮁ":"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R","ꓣ":"R","𖼵":"R",ɽ:"r̨",ɼ:"r̩","ɍ":"r̵",ғ:"r̵","ᵲ":"r̴",ґ:"r'","𑣣":"rn",m:S_e,"ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸",ɱ:"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ",я:"ᴙ","ᵳ":"ɾ̴","℩":"ɿ",ｓ:"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s",ƽ:"s",ѕ:"s","ꮪ":"s","𑣁":"s","𐑈":"s",Ｓ:"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S",ʂ:"s̨","ᵴ":"s̴","ꞵ":"ß",β:"ß",ϐ:"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T",Τ:"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T",Т:"T",Ꭲ:"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T",ƭ:"t̔","⍡":"T̈","Ⱦ":"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵","ᵵ":"t̴",Ⴀ:"Ꞇ","Ꜩ":"T3",ʨ:"tɕ","℡":"TEL","ꝷ":"tf",ʦ:"ts",ʧ:"tʃ","ꜩ":"tȝ",τ:"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ",т:"ᴛ","ꭲ":"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u",ʋ:"u",υ:"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u",ս:"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U","ꓴ":"U","𖽂":"U","𑢸":"U",ǔ:"ŭ",Ǔ:"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'","ᵫ":"ue","ꭣ":"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v",ｖ:"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v",ν:"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v",ѵ:"v",ט:"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V",Ѵ:"V","ⴸ":"V",Ꮩ:"V",ᐯ:"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ",Л:"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w",ѡ:"w","ԝ":"w",ա:"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W",Ꮃ:"W",Ꮤ:"W","ꓪ":"W",ѽ:"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ",м:"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X",Χ:"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X",Х:"X","ⵝ":"X",ᚷ:"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll",ɣ:"y","ᶌ":"y",ｙ:"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y",ʏ:"y","ỿ":"y","ꭚ":"y",γ:"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y",у:"y",ү:"y",ყ:"y","𑣜":"y",Ｙ:"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y",Υ:"Y",ϒ:"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y",ƴ:"y̔","ɏ":"y̵",ұ:"y̵","¥":"Y̵","Ɏ":"Y̵",Ұ:"Y̵",ʒ:"ȝ","ꝫ":"ȝ","ⳍ":"ȝ",ӡ:"ȝ",ჳ:"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z",Ζ:"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z",Ꮓ:"Z","ꓜ":"Z","𑢩":"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦","ᵶ":"z̴",ƿ:"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ",ϩ:"ƨ","ꙅ":"ƨ",ь:"ƅ","ꮟ":"ƅ",ы:"ƅi","ꭾ":"ɂ",ˤ:"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ","𖼇":"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ",ᐃ:"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ",µ:"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ",ϖ:"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π",п:"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π",П:"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ",ϛ:"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ",ѱ:"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω",Ω:"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω",ᘯ:"Ω",ᘵ:"Ω","𐊶":"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И",Й:"Ѝ","Ҋ":"Ѝ̦",ѝ:"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո","ꓵ":"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ","ݲ":"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز",ﺰ:"ز",ﺯ:"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ","ݾ":"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ","ࢯ":"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ","ࢤ":"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ","ݣ":"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى","ݢ":"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ","ࢰ":"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م","ࢧ":"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن","ݨ":"نؕ","ݩ":"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و",ﻮ:"و",ﻭ:"و","ࢱ":"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى",ں:"ى","𞸝":"ى","𞹝":"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆",ێ:"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै","ऄ":"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ",က:"ဂာ","ၰ":"ဃှ","ၦ":"ပှ",ဟ:"ပာ","ၯ":"ပာှ","ၾ":"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·","ᣝ":"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ","ᣠ":"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·",ᕩ:"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ",ᇃ:"ᄀᄅ","ᇻ":"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ","ᇿ":"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ","ퟋ":"ᄂᄅ",ᄖ:"ᄂᄇ","ᅛ":"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ","ᅜ":"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ","ퟌ":"ᄂᄎ",ᇉ:"ᄂᄐ","ᅝ":"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ",ᇋ:"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ","ꥤ":"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ","ꥦ":"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ","ꥧ":"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ","ꥬ":"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ","ퟲ":"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ","ퟛ":"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ","ퟜ":"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ","ꥯ":"ᄆᄀ",ᇚ:"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ",ᇛ:"ᄆᄅ","ퟠ":"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ","ퟢ":"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ","ퟣ":"ᄇᄃ",ᇣ:"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ","ퟦ":"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ","ퟨ":"ᄇᄌ",ᄨ:"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ","ꥴ":"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ","ퟪ":"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ","ퟯ":"ᄉᄌ",ᄷ:"ᄉᄎ","ퟰ":"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ","ퟱ":"ᄉᄐ",ᄺ:"ᄉᄑ","ퟮ":"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ","ꥶ":"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ","ꥷ":"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ","ꥹ":"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ","ퟺ":"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ","ꥻ":"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ","ꥼ":"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ","ᆣ":"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ","ᆤ":"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ","ᆥ":"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨","ힰ":"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ","ힱ":"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨","ힴ":"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨","ힵ":"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨","ힶ":"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ","ힷ":"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨","ힸ":"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ","ퟅ":"ᆞᅡ",ᆟ:"ᆞᅥ","ퟆ":"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄",不:"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨",ᆚ:"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ",ᆛ:"丨ᅮ","ퟃ":"丨ᅲ",ᆝ:"丨ᆞ","ퟄ":"丨丨",串:"串","丸":"丸",丹:"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二","𠄢":"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什","仌":"仌",令:"令","你":"你",倂:"併","倂":"併","侀":"侀",來:"來",例:"例","侮":"侮","侮":"侮","侻":"侻",便:"便",值:"値",倫:"倫","偺":"偺","備":"備","像":"像",僚:"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿",兀:"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全",兩:"兩",ハ:"八","⼋":"八",六:"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃",切:"切","切":"切",列:"列",利:"利","㓟":"㓟",刺:"刺","刻":"刻","剆":"剆","割":"割","剷":"剷",劉:"劉","𠠄":"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉",勒:"勒",勞:"勞","勤":"勤","勤":"勤",勵:"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕",北:"北","北":"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即",卵:"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶",參:"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句","叫":"叫","叱":"叱","吆":"吆",吏:"吏",吝:"吝","吸":"吸",呂:"呂","呈":"呈","周":"周","咞":"咞","咢":"咢",咽:"咽",䎛:"㖈","哶":"哶","唐":"唐","啓":"啓",啟:"啓","啕":"啕","啣":"啣","善":"善","善":"善",喇:"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳",嗀:"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器",囹:"囹","圖":"圖","圗":"圗","⼟":"土",士:"土","⼠":"土","型":"型","城":"城",㦳:"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀",塚:"塚","塚":"塚",塞:"塞",填:"塡",壿:"墫","墬":"墬","墳":"墳",壘:"壘",壟:"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊",タ:"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄",奈:"奈",契:"契","奔":"奔","奢":"奢",女:"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦",嬀:"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀",宅:"宅","𡧈":"𡧈","寃":"寃","寘":"寘",寧:"寧",寧:"寧","寧":"寧",寮:"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸",尿:"尿","屠":"屠",屢:"屢","層":"層",履:"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦",崙:"崙","嵃":"嵃",嵐:"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲",嶺:"嶺","⼮":"巛","巢":"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾",帲:"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干",年:"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶",廊:"廊","廊":"廊",廉:"廉","廒":"廒",廓:"廓","廙":"廙",廬:"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱",弄:"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳",律:"律","㣣":"㣣","徚":"徚",復:"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志",念:"念","忹":"忹",怒:"怒",怜:"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘",惡:"惡","𢛔":"𢛔","愈":"愈","慨":"慨",慄:"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎",憐:"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲",懶:"懶","懶":"懶",戀:"戀","⼽":"戈","成":"成","戛":"戛",戮:"戮","戴":"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱",拉:"拉",拏:"拏",拓:"拓","拔":"拔","拼":"拼",拾:"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨",捻:"捻","掃":"掃",掠:"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮",搉:"㩁",撚:"撚","撝":"撝",擄:"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬",數:"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日",易:"易",曶:"㫚","㫤":"㫤","晉":"晉",晩:"晚",晴:"晴","晴":"晴","暑":"暑","暑":"暑",暈:"暈","㬈":"㬈","暜":"暜",暴:"暴",曆:"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰",更:"更","書":"書","⽉":"月","𣍟":"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗","朗":"朗","朗":"朗",脧:"朘","望":"望","望":"望",幐:"㬺",䐠:"㬻","𣎓":"𣎓",膧:"朣","𣎜":"𣎜","⽊":"木",李:"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃",柿:"杮",杻:"杻","枅":"枅",林:"林","㭉":"㭉","𣏕":"𣏕",柳:"柳","柺":"柺",栗:"栗","栟":"栟","桒":"桒","𣑭":"𣑭",梁:"梁","梅":"梅","梅":"梅","梎":"梎",梨:"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝",槩:"㮣",樧:"榝","榣":"榣","槪":"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓","𣚣":"𣚣","檨":"檨",櫓:"櫓","櫛":"櫛",欄:"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲",歷:"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟",殮:"殮","⽎":"殳",殺:"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧",沈:"沈","沿":"沿",泌:"泌","泍":"泍",泥:"泥","𣲼":"𣲼",洛:"洛",洞:"洞","洴":"洴","派":"派",流:"流","流":"流","流":"流","洖":"洖","浩":"浩",浪:"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞",淋:"淋",淚:"淚",淪:"淪","淹":"淹","渚":"渚","港":"港","湮":"湮",潙:"溈","滋":"滋","滋":"滋",溜:"溜",溺:"溺","滇":"滇",滑:"滑","滛":"滛","㴳":"㴳",漏:"漏","漢":"漢","漢":"漢",漣:"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆",濫:"濫",濾:"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災",炙:"炙","炭":"炭",烈:"烈",烙:"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅",煉:"煉","𤋮":"𤋮","熜":"熜",燎:"燎",燐:"燐","𤎫":"𤎫",爐:"爐",爛:"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛",牢:"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯",狀:"狀","𤜵":"𤜵",狼:"狼",猪:"猪","猪":"猪","𤠔":"𤠔",獵:"獵","獺":"獺","⽞":"玄",率:"率",率:"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥",玲:"玲","㺸":"㺸","㺸":"㺸",珞:"珞",琉:"琉",理:"理","琢":"琢","瑇":"瑇","瑜":"瑜",瑩:"瑩","瑱":"瑱","瑱":"瑱","璅":"璅",璉:"璉",璘:"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶",留:"留",略:"略",異:"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒",痢:"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼",益:"益","益":"益","盛":"盛",盧:"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳",省:"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹",晣:"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝",硏:"研","硎":"硎",硫:"硫",碌:"碌","碌":"碌","碑":"碑",磊:"磊","磌":"磌","磌":"磌",磻:"磻","䃣":"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝",神:"神",祥:"祥","視":"視","視":"視",祿:"祿","𥚚":"𥚚","禍":"禍","禎":"禎",福:"福","福":"福","𥛅":"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊","䄯":"䄯","秫":"秫",稜:"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱",立:"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹",笠:"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐",簾:"簾",籠:"籠","⽶":"米","类":"类",粒:"粒",精:"精","糒":"糒",糖:"糖","糨":"糨","䊠":"䊠","糣":"糣",糧:"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀",紐:"紐",索:"索",累:"累",絶:"絕","絣":"絣","絛":"絛",綠:"綠",綾:"綾","緇":"緇",練:"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉",縷:"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙",罹:"罹","罺":"罺",羅:"羅","𦌾":"𦌾","⽺":"羊","羕":"羕",羚:"羚",羽:"羽","⽻":"羽","翺":"翺",老:"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳",聆:"聆","聠":"聠","𦖨":"𦖨",聯:"聯","聰":"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙",腁:"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽",若:"若","若":"若","苦":"苦","𦬼":"𦬼",茶:"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓",菉:"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華",菱:"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭",落:"落",葉:"葉",蔿:"蒍","𦳕":"𦳕","𦵫":"𦵫",蓮:"蓮","蓱":"蓱","蓳":"蓳",蓼:"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬",藍:"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡",藺:"藺",蘆:"蘆","䕫":"䕫",蘒:"蘒",蘭:"蘭","𧃒":"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎","虐":"虐",虜:"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊",螺:"螺","蠁":"蠁","䗹":"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤",裂:"裂","𧙧":"𧙧",裏:"裏","裗":"裗","裞":"裞",裡:"裡",裸:"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆",見:"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦",詽:"訮",訞:"䚶","䚾":"䚾","䛇":"䛇","誠":"誠",說:"說",說:"說","調":"調","請":"請",諒:"諒",論:"論","諭":"諭","諭":"諭",諸:"諸","諸":"諸",諾:"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹",識:"識",讀:"讀",讏:"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈","豕":"豕","⾗":"豕",豣:"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁",賂:"賂",賈:"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起",趆:"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼",跺:"跥",路:"路","跰":"跰",躛:"躗","⾝":"身",車:"車","⾞":"車","軔":"軔",輧:"軿",輦:"輦",輪:"輪","輸":"輸","輸":"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛","辞":"辞",辰:"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡",連:"連",逸:"逸","逸":"逸","遲":"遲",遼:"遼","𨗒":"𨗒","𨗭":"𨗭",邏:"邏","⾢":"邑","邔":"邔",郎:"郎",郞:"郎","郞":"郎","郱":"郱",都:"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉",酪:"酪","醙":"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼",錄:"錄",鍊:"鍊",鎮:"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕",閭:"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸","陼":"陼",隆:"隆",隣:"隣","䧦":"䧦","⾪":"隶","隷":"隷",隸:"隷",隸:"隷","⾫":"隹","雃":"雃",離:"離","難":"難","難":"難","⾬":"雨",零:"零",雷:"雷","霣":"霣","𩅅":"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋",領:"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻",類:"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢",飯:"飯",飼:"飼","䬳":"䬳",館:"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂",駱:"駱","駾":"駾",驪:"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯","鱀":"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎",鶴:"鶴","𪄅":"𪄅","䳸":"䳸",鷺:"鷺","𪈎":"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿","𪊑":"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎","䵖":"䵖","⿊":"黑",黒:"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿",龍:"龍","⿓":"龍","龎":"龎","⻰":"龙",龜:"龜",龜:"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var BW=w_e;function E_e(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var T_e=RegExp(Object.keys(BW).map(E_e).join("|"),"g");function C_e(t){return BW[t]}function k_e(t){return t.replace(T_e,C_e)}var R_e=k_e;const I_e=es(R_e);var C2={exports:{}},jW={};function Ta(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var x_e=Ta;Ta.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ta.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ta.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};Ta.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ta.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};Ta.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};Ta.prototype.start=Ta.prototype.try;Ta.prototype.errors=function(){return this._errors};Ta.prototype.attempts=function(){return this._attempts};Ta.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(t[s]||0)+1;t[s]=o,o>=n&&(e=i,n=o)}return e};(function(t){var e=x_e;t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in n)r[i]=n[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<r.retries;o++)s.push(this.createTimeout(o,r));return n&&n.forever&&!s.length&&s.push(this.createTimeout(o,r)),s.sort(function(a,c){return a-c}),s},t.createTimeout=function(n,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return s=Math.min(s,r.maxTimeout),s},t.wrap=function(n,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in n)typeof n[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=n[a];n[a]=(function(u){var d=t.operation(r),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(m){d.retry(m)||(m&&(arguments[0]=d.mainError()),p.apply(this,arguments))}),d.attempt(function(){u.apply(n,f)})}).bind(n,c),n[a].options=r}}})(jW);var P_e=jW;const O_e=P_e,M_e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class HW extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const A_e=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},L_e=t=>M_e.includes(t),KW=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=O_e.operation(e);i.attempt(async s=>{try{n(await t(s))}catch(o){if(!(o instanceof Error)){r(new TypeError(`Non-error was thrown: "${o}". You should only throw errors.`));return}if(o instanceof HW)i.stop(),r(o.originalError);else if(o instanceof TypeError&&!L_e(o.message))i.stop(),r(o);else{A_e(o,s,e);try{await e.onFailedAttempt(o)}catch(a){r(a);return}i.retry(o)||r(i.mainError())}}})});C2.exports=KW;C2.exports.default=KW;C2.exports.AbortError=HW;var D_e=C2.exports;const VW=es(D_e);let k2=class{constructor(e,n){if(this.stable=e,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){const e=[this.name],n=this.altName;return n&&e.push(n),e}matches(e){return this.name===e||this.altName===e}findIn(e){let n;return this.name&&(n=e==null?void 0:e[this.name]),!n&&this.altName&&(n=e==null?void 0:e[this.altName]),n}includedIn(e){let n=!1;return this.name&&(n=e.includes(this.name)),!n&&this.altName&&(n=e.includes(this.altName)),n}};class R2 extends k2{constructor(){super(...arguments),this.preferUnstable=!1}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}let or=class extends k2{constructor(e,n){if(super(e,n),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}};var zh=(t=>(t.Self="m.self",t.Pin="m.pin",t))(zh||{});const fb=new or("m.asset","org.matrix.msc3488.asset"),wf=new or("m.ts","org.matrix.msc3488.ts"),hb=new or("m.location","org.matrix.msc3488.location");var Wi=(t=>(t.Read="m.read",t.FullyRead="m.fully_read",t.ReadPrivate="m.read.private",t))(Wi||{});const pb="main",e3=new Map;function t3(t){return t instanceof String&&(t=t.toString()),e3.has(t)||e3.set(t,t),e3.get(t)}function XT(t,e){const n=e??new URLSearchParams;for(const[r,i]of Object.entries(t))i!=null&&(Array.isArray(i)?i.forEach(s=>{n.append(r,String(s))}):n.append(r,String(i)));return n}function L$(t,e,n){const r={...n,[e]:n[t]};return delete r[t],r}function Me(t,e){for(const n in e){if(!e.hasOwnProperty(n))continue;const r=e[n];r!=null&&(t=t.replace(n,encodeURIComponent(r)))}return t}function ZT(t,e,n){let r;if(n){for(r=t.length-1;r>=0;r--)if(e(t[r],r,t))return t.splice(r,1),!0}else for(r=0;r<t.length;r++)if(e(t[r],r,t))return t.splice(r,1),!0;return!1}function qW(t,e){for(const n of e)if(!t.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function I2(t){return JSON.parse(JSON.stringify(t))}function of(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="number"&&isNaN(t)&&isNaN(e))return!0;if(t===null||e===null)return t===e;if(!(t instanceof Object)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===e.toString();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!of(t[n],e[n]))return!1}else{for(const n in e)if(e.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;for(const n in t)if(e.hasOwnProperty(n)!==t.hasOwnProperty(n)||!of(t[n],e[n]))return!1}return!0}function b6(t){if(typeof t!="object"||t==null||Array.isArray(t))return t;const e=[];for(const[n,r]of Object.entries(t))e.push([n,b6(r)]);return e.sort((n,r)=>BE(n[0],r[0])),e}function D$(t){return typeof t=="number"&&isFinite(t)}function Ih(t){return typeof t=="string"?I_e(t.normalize("NFD").replace(U_e,"")):""}function S6(t){return typeof t=="string"?t.replace(/[\u202d-\u202e]/g,""):""}function N_e(t){return Ih(t.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}const U_e=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function GW(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function zW(t){return GW(t).replace(/\\\*/g,".*").replace(/\?/g,".")}function n3(t){return t!=null&&t.endsWith("/")?t.slice(0,-1):t}function Jm(t,e){return new Promise(n=>{setTimeout(n,t,e)})}async function Qft(t,e,n){const r=Date.now();try{return await n()}finally{const i=Date.now();t.debug(`[Perf]: ${e} took ${i-r}ms`)}}function $_e(){return new Promise(t=>setTimeout(t))}function WW(t){return t==null}function Ef(){let t,e;const n=new Promise((r,i)=>{t=r,e=i});return{resolve:t,reject:e,promise:n}}async function Bg(t,e){for(const n of t)await e(await n)}function ih(t){return Promise.resolve(t())}async function F_e(t,e){const n=[];for(let r=0;r<t.length;r+=e)n.push(...await Promise.all(t.slice(r,r+e).map(i=>i())));return n}function B_e(t){return VW(e=>t(e),{forever:!0,factor:2,minTimeout:3e3,maxTimeout:15e3})}const af=(()=>{let t="";for(let e=32;e<=126;e++)t+=String.fromCharCode(e);return t})();function N$(t,e,n=af){return t.padEnd(e,n[0])}function K0(t,e=af){const n=BigInt(e.length);if(t<=n)return e[Number(t)-1]??"";let r=t/n,i=Number(t%n)-1;return i<0&&(r-=BigInt(Math.abs(i)),i=Number(n)-1),K0(r,e)+e[i]}function QT(t,e=af){const n=BigInt(e.length);let r=BigInt(0);for(let i=t.length-1,s=BigInt(0);i>=0;i--,s++){const o=t.charCodeAt(i)-e.charCodeAt(0);r+=BigInt(1+o)*n**s}return r}function j_e(t,e,n=af){const r=Math.max(t.length,e.length),i=QT(N$(t,r,n),n),s=QT(N$(e,r,n),n),o=(i+s)/BigInt(2);return o===i||o==s?K0(o,n)+n[0]:K0(o,n)}function Py(t,e=af){return K0(QT(t,e)+BigInt(1),e)}function U$(t,e=af){return K0(QT(t,e)-BigInt(1),e)}function BE(t,e){return t<e?-1:t>e?1:0}function YW(t,e,n=!1){for(const[r,i]of Object.entries(e)){if(t[r]instanceof Object&&i){YW(t[r],i);continue}if(i!=null||!n){nl(t,r,i);continue}}return t}function $$(t){return wf.findIn(t.getContent())??-1}function H_e(t,e){return $$(e)-$$(t)}function l4(t){return[Wi.Read,Wi.ReadPrivate].includes(t)}function F$(t,e,n=(r,i)=>r===i){if(t.size!==e.size)return!1;for(const[r,i]of t){const s=e.get(r);if(s===void 0||!n(i,s))return!1}return!0}function JW(t){return t instanceof Map?xh(t):Array.isArray(t)?t.map(e=>JW(e)):t}function xh(t){const e=new Map;for(const[n,r]of t)e.set(n,JW(r));return Object.fromEntries(e.entries())}function G1(t){return t==="__proto__"||t==="prototype"||t==="constructor"}function nl(t,e,n){if(G1(e))throw new Error("Trying to modify prototype or constructor");t[e]=n}function Ya(t){return!(G1(t.room_id)||G1(t.sender)||G1(t.event_id))}class fr extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}const w6="migrationState";var Wh=(t=>(t[t.NOT_STARTED=0]="NOT_STARTED",t[t.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",t[t.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",t[t.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",t[t.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",t[t.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",t))(Wh||{});const Xm=50;function zf(t,e){return encodeURIComponent(t)+"/"+encodeURIComponent(e)}function r3(t){const e=t.split("/"),n=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);return{senderKey:n,sessionId:r}}class x2{constructor(){this.migrationState=Wh.NOT_STARTED,this.outgoingRoomKeyRequests=[],this.account=null,this.crossSigningKeys=null,this.privateKeys={},this.sessions={},this.sessionProblems={},this.notifiedErrorDevices={},this.inboundGroupSessions={},this.inboundGroupSessionsWithheld={},this.deviceData=null,this.rooms={},this.sessionsNeedingBackup={},this.sharedHistoryInboundGroupSessions={},this.parkedSharedHistory=new Map}async containsData(){return this.account!==null}async startup(){return this}deleteAllData(){return Promise.resolve()}async getMigrationState(){return this.migrationState}async setMigrationState(e){this.migrationState=e}getOrAddOutgoingRoomKeyRequest(e){const n=e.requestBody;return ih(()=>{const r=this._getOutgoingRoomKeyRequest(n);return r?(k.log(`already have key request outstanding for ${n.room_id} / ${n.session_id}: not sending another`),r):(k.log(`enqueueing key request for ${n.room_id} / `+n.session_id),this.outgoingRoomKeyRequests.push(e),e)})}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const n of this.outgoingRoomKeyRequests)if(of(n.requestBody,e))return n;return null}getOutgoingRoomKeyRequestByState(e){for(const n of this.outgoingRoomKeyRequests)for(const r of e)if(n.state===r)return Promise.resolve(n);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this.outgoingRoomKeyRequests.filter(n=>n.state==e))}getOutgoingRoomKeyRequestsByTarget(e,n,r){const i=[];for(const s of this.outgoingRoomKeyRequests)for(const o of r)s.state===o&&s.recipients.some(a=>a.userId===e&&a.deviceId===n)&&i.push(s);return Promise.resolve(i)}updateOutgoingRoomKeyRequest(e,n,r){for(const i of this.outgoingRoomKeyRequests)if(i.requestId===e)return i.state!==n?(k.warn(`Cannot update room key request from ${n} as it was already updated to ${i.state}`),Promise.resolve(null)):(Object.assign(i,r),Promise.resolve(i));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,n){for(let r=0;r<this.outgoingRoomKeyRequests.length;r++){const i=this.outgoingRoomKeyRequests[r];if(i.requestId===e)return i.state!=n?(k.warn(`Cannot delete room key request in state ${i.state} (expected ${n})`),Promise.resolve(null)):(this.outgoingRoomKeyRequests.splice(r,1),Promise.resolve(i))}return Promise.resolve(null)}getAccount(e,n){n(this.account)}storeAccount(e,n){this.account=n}getCrossSigningKeys(e,n){n(this.crossSigningKeys)}getSecretStorePrivateKey(e,n,r){const i=this.privateKeys[r];n(i||null)}storeCrossSigningKeys(e,n){this.crossSigningKeys=n}storeSecretStorePrivateKey(e,n,r){this.privateKeys[n]=r}countEndToEndSessions(e,n){let r=0;for(const i of Object.values(this.sessions))r+=Object.keys(i).length;n(r)}getEndToEndSession(e,n,r,i){const s=this.sessions[e]||{};i(s[n]||null)}getEndToEndSessions(e,n,r){r(this.sessions[e]||{})}getAllEndToEndSessions(e,n){Object.entries(this.sessions).forEach(([r,i])=>{Object.entries(i).forEach(([s,o])=>{n({...o,deviceKey:r,sessionId:s})})})}storeEndToEndSession(e,n,r,i){let s=this.sessions[e];s===void 0&&(s={},this.sessions[e]=s),nl(s,n,r)}async storeEndToEndSessionProblem(e,n,r){const i=this.sessionProblems[e]=this.sessionProblems[e]||[];i.push({type:n,fixed:r,time:Date.now()}),i.sort((s,o)=>s.time-o.time)}async getEndToEndSessionProblem(e,n){const r=this.sessionProblems[e]||[];if(!r.length)return null;const i=r[r.length-1];for(const s of r)if(s.time>n)return Object.assign({},s,{fixed:i.fixed});return i.fixed?null:i}async filterOutNotifiedErrorDevices(e){const n=this.notifiedErrorDevices,r=[];for(const i of e){const{userId:s,deviceInfo:o}=i;s in n?o.deviceId in n[s]||(r.push(i),nl(n[s],o.deviceId,!0)):(r.push(i),nl(n,s,{[o.deviceId]:!0}))}return r}async getEndToEndSessionsBatch(){const e=[];for(const n of Object.values(this.sessions))for(const r of Object.values(n))if(e.push(r),e.length>=Xm)return e;return e.length===0?null:e}async deleteEndToEndSessionsBatch(e){for(const{deviceKey:n,sessionId:r}of e){const i=this.sessions[n]||{};delete i[r],Object.keys(i).length===0&&delete this.sessions[n]}}getEndToEndInboundGroupSession(e,n,r,i){const s=zf(e,n);i(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}getAllEndToEndInboundGroupSessions(e,n){for(const r of Object.keys(this.inboundGroupSessions))n({...r3(r),sessionData:this.inboundGroupSessions[r]});n(null)}addEndToEndInboundGroupSession(e,n,r,i){const s=zf(e,n);this.inboundGroupSessions[s]===void 0&&(this.inboundGroupSessions[s]=r)}storeEndToEndInboundGroupSession(e,n,r,i){const s=zf(e,n);this.inboundGroupSessions[s]=r}storeEndToEndInboundGroupSessionWithheld(e,n,r,i){const s=zf(e,n);this.inboundGroupSessionsWithheld[s]=r}async countEndToEndInboundGroupSessions(){return Object.keys(this.inboundGroupSessions).length}async getEndToEndInboundGroupSessionsBatch(){const e=[];for(const[n,r]of Object.entries(this.inboundGroupSessions))if(e.push({...r3(n),sessionData:r,needsBackup:n in this.sessionsNeedingBackup}),e.length>=Xm)return e;return e.length===0?null:e}async deleteEndToEndInboundGroupSessionsBatch(e){for(const{senderKey:n,sessionId:r}of e){const i=zf(n,r);delete this.inboundGroupSessions[i]}}getEndToEndDeviceData(e,n){n(this.deviceData)}storeEndToEndDeviceData(e,n){this.deviceData=e}storeEndToEndRoom(e,n,r){this.rooms[e]=n}getEndToEndRooms(e,n){n(this.rooms)}getSessionsNeedingBackup(e){const n=[];for(const r in this.sessionsNeedingBackup)if(this.inboundGroupSessions[r]&&(n.push({...r3(r),sessionData:this.inboundGroupSessions[r]}),e&&r.length>=e))break;return Promise.resolve(n)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this.sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const n of e){const r=zf(n.senderKey,n.sessionId);delete this.sessionsNeedingBackup[r]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const n of e){const r=zf(n.senderKey,n.sessionId);this.sessionsNeedingBackup[r]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,n,r){const i=this.sharedHistoryInboundGroupSessions[e]||[];i.push([n,r]),this.sharedHistoryInboundGroupSessions[e]=i}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this.sharedHistoryInboundGroupSessions[e]||[])}addParkedSharedHistory(e,n){const r=this.parkedSharedHistory.get(e)??[];r.push(n),this.parkedSharedHistory.set(e,r)}takeParkedSharedHistory(e){const n=this.parkedSharedHistory.get(e)??[];return this.parkedSharedHistory.delete(e),Promise.resolve(n)}doTxn(e,n,r){return Promise.resolve(r(null))}}function P2(t,e,n,r,i,s=!1,o,a){if(typeof e!="string"||!e)return"";if(e.indexOf("mxc://")!==0)return s?e:"";a&&(o=!0);let c=e.slice(6),l;a?l="/_matrix/client/v1/media/download/":l="/_matrix/media/v3/download/";const u={};n&&(u.width=Math.round(n).toString()),r&&(u.height=Math.round(r).toString()),i&&(u.method=i),Object.keys(u).length>0&&(a?l="/_matrix/client/v1/media/thumbnail/":l="/_matrix/media/v3/thumbnail/"),typeof o=="boolean"&&(u.allow_redirect=JSON.stringify(o));const d=c.indexOf("#");let f="";d>=0&&(f=c.slice(d),c=c.slice(0,d));const p=Object.keys(u).length===0?"":"?"+XT(u);return t+l+c+p+f}var u4={exports:{}},lm=typeof Reflect=="object"?Reflect:null,B$=lm&&typeof lm.apply=="function"?lm.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},jE;lm&&typeof lm.ownKeys=="function"?jE=lm.ownKeys:Object.getOwnPropertySymbols?jE=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:jE=function(e){return Object.getOwnPropertyNames(e)};function K_e(t){console&&console.warn&&console.warn(t)}var XW=Number.isNaN||function(e){return e!==e};function mn(){mn.init.call(this)}u4.exports=mn;u4.exports.once=z_e;mn.EventEmitter=mn;mn.prototype._events=void 0;mn.prototype._eventsCount=0;mn.prototype._maxListeners=void 0;var j$=10;function O2(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(mn,"defaultMaxListeners",{enumerable:!0,get:function(){return j$},set:function(t){if(typeof t!="number"||t<0||XW(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");j$=t}});mn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};mn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||XW(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ZW(t){return t._maxListeners===void 0?mn.defaultMaxListeners:t._maxListeners}mn.prototype.getMaxListeners=function(){return ZW(this)};mn.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")B$(c,this,n);else for(var l=c.length,u=rY(c,l),r=0;r<l;++r)B$(u[r],this,n);return!0};function QW(t,e,n,r){var i,s,o;if(O2(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=ZW(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,K_e(a)}return t}mn.prototype.addListener=function(e,n){return QW(this,e,n,!1)};mn.prototype.on=mn.prototype.addListener;mn.prototype.prependListener=function(e,n){return QW(this,e,n,!0)};function V_e(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function eY(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=V_e.bind(r);return i.listener=n,r.wrapFn=i,i}mn.prototype.once=function(e,n){return O2(n),this.on(e,eY(this,e,n)),this};mn.prototype.prependOnceListener=function(e,n){return O2(n),this.prependListener(e,eY(this,e,n)),this};mn.prototype.removeListener=function(e,n){var r,i,s,o,a;if(O2(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():q_e(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};mn.prototype.off=mn.prototype.removeListener;mn.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function tY(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?G_e(i):rY(i,i.length)}mn.prototype.listeners=function(e){return tY(this,e,!0)};mn.prototype.rawListeners=function(e){return tY(this,e,!1)};mn.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):nY.call(t,e)};mn.prototype.listenerCount=nY;function nY(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}mn.prototype.eventNames=function(){return this._eventsCount>0?jE(this._events):[]};function rY(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function q_e(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function G_e(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function z_e(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}iY(t,e,s,{once:!0}),e!=="error"&&W_e(t,i,{once:!0})})}function W_e(t,e,n){typeof t.on=="function"&&iY(t,"error",e,n)}function iY(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var M2=u4.exports;const d4=es(M2);var f4=(t=>(t.NewListener="newListener",t.RemoveListener="removeListener",t.Error="error",t))(f4||{});class Fn extends M2.EventEmitter{addListener(e,n){return super.addListener(e,n)}emit(e,...n){return super.emit(e,...n)}async emitPromised(e,...n){const r=this.listeners(e);return Promise.allSettled(r.map(i=>i(...n))).then(()=>r.length>0)}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,n){return super.off(e,n)}on(e,n){return super.on(e,n)}once(e,n){return super.once(e,n)}prependListener(e,n){return super.prependListener(e,n)}prependOnceListener(e,n){return super.prependOnceListener(e,n)}removeAllListeners(e){return e===void 0?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,n){return super.removeListener(e,n)}rawListeners(e){return super.rawListeners(e)}}var Z=(t=>(t.RoomCanonicalAlias="m.room.canonical_alias",t.RoomCreate="m.room.create",t.RoomJoinRules="m.room.join_rules",t.RoomMember="m.room.member",t.RoomThirdPartyInvite="m.room.third_party_invite",t.RoomPowerLevels="m.room.power_levels",t.RoomName="m.room.name",t.RoomTopic="m.room.topic",t.RoomAvatar="m.room.avatar",t.RoomPinnedEvents="m.room.pinned_events",t.RoomEncryption="m.room.encryption",t.RoomHistoryVisibility="m.room.history_visibility",t.RoomGuestAccess="m.room.guest_access",t.RoomServerAcl="m.room.server_acl",t.RoomTombstone="m.room.tombstone",t.RoomPredecessor="org.matrix.msc3946.room_predecessor",t.PolicyRuleUser="m.policy.rule.user",t.PolicyRuleRoom="m.policy.rule.room",t.PolicyRuleServer="m.policy.rule.server",t.SpaceChild="m.space.child",t.SpaceParent="m.space.parent",t.RoomRedaction="m.room.redaction",t.RoomMessage="m.room.message",t.RoomMessageEncrypted="m.room.encrypted",t.Sticker="m.sticker",t.CallInvite="m.call.invite",t.CallCandidates="m.call.candidates",t.CallAnswer="m.call.answer",t.CallHangup="m.call.hangup",t.CallReject="m.call.reject",t.CallSelectAnswer="m.call.select_answer",t.CallNegotiate="m.call.negotiate",t.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",t.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",t.CallReplaces="m.call.replaces",t.CallAssertedIdentity="m.call.asserted_identity",t.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",t.CallEncryptionKeysPrefix="io.element.call.encryption_keys",t.KeyVerificationRequest="m.key.verification.request",t.KeyVerificationStart="m.key.verification.start",t.KeyVerificationCancel="m.key.verification.cancel",t.KeyVerificationMac="m.key.verification.mac",t.KeyVerificationDone="m.key.verification.done",t.KeyVerificationKey="m.key.verification.key",t.KeyVerificationAccept="m.key.verification.accept",t.KeyVerificationReady="m.key.verification.ready",t.RoomMessageFeedback="m.room.message.feedback",t.Reaction="m.reaction",t.PollStart="org.matrix.msc3381.poll.start",t.Typing="m.typing",t.Receipt="m.receipt",t.Presence="m.presence",t.FullyRead="m.fully_read",t.Tag="m.tag",t.SpaceOrder="org.matrix.msc3230.space_order",t.PushRules="m.push_rules",t.Direct="m.direct",t.IgnoredUserList="m.ignored_user_list",t.RoomKey="m.room_key",t.RoomKeyRequest="m.room_key_request",t.ForwardedRoomKey="m.forwarded_room_key",t.Dummy="m.dummy",t.GroupCallPrefix="org.matrix.msc3401.call",t.GroupCallMemberPrefix="org.matrix.msc3401.call.member",t.CallNotify="org.matrix.msc4075.call.notify",t))(Z||{}),qn=(t=>(t.Annotation="m.annotation",t.Replace="m.replace",t.Reference="m.reference",t.Thread="m.thread",t))(qn||{}),Oa=(t=>(t.Text="m.text",t.Emote="m.emote",t.Notice="m.notice",t.Image="m.image",t.File="m.file",t.Audio="m.audio",t.Location="m.location",t.Video="m.video",t.KeyVerificationRequest="m.key.verification.request",t))(Oa||{});const eC="type";var Ph=(t=>(t.Space="m.space",t.UnstableCall="org.matrix.msc3417.call",t.ElementVideo="io.element.video",t))(Ph||{});const vs="org.matrix.msgid",E6=new or("m.room.purpose","org.matrix.msc3088.purpose"),T6=new or("m.enabled","org.matrix.msc3088.enabled"),C6=new or("m.data_tree","org.matrix.msc3089.data_tree"),sY=new or("m.leaf","org.matrix.msc3089.leaf"),eu=new or("m.branch","org.matrix.msc3089.branch"),oY=new or("m.room.marker","org.matrix.msc2716.marker"),k6=new or("with_rel_types","org.matrix.msc3912.with_relations"),aY=new or("io.element.functional_members","io.element.functional_members"),vh=new or("m.visibility","org.matrix.msc3531.visibility"),R6=new or("enabled","org.matrix.msc3881.enabled"),Y_e=new or("device_id","org.matrix.msc3881.device_id"),cY=new or("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),tC=new or("thread_id","org.matrix.msc4023.thread_id"),lY=new k2("membership","io.element.msc4115.membership");var Ge=(t=>(t.Ban="ban",t.Invite="invite",t.Join="join",t.Knock="knock",t.Leave="leave",t))(Ge||{}),Hs=(t=>(t.Membership="RoomMember.membership",t.Name="RoomMember.name",t.PowerLevel="RoomMember.powerLevel",t.Typing="RoomMember.typing",t))(Hs||{});class nC extends Fn{constructor(e,n){super(),this.roomId=e,this.userId=n,this._isOutOfBand=!1,this.modified=-1,this.requestedProfileInfo=!1,this.typing=!1,this.powerLevel=0,this.powerLevelNorm=0,this.disambiguate=!1,this.events={},this.name=n,this.rawDisplayName=n,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,n){const r=e.getDirectionalContent().displayname??"";if(e.getType()!==Z.RoomMember)return;this._isOutOfBand=!1,this.events.member=e;const i=this.membership;this.membership=e.getDirectionalContent().membership,this.membership===void 0&&k.trace(`membership event with membership undefined (forwardLooking: ${e.forwardLooking})!`,e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Z_e(this.userId,r,n);const s=this.name;this.name=Q_e(this.userId,r,this.disambiguate),this.rawDisplayName=S6(e.getDirectionalContent().displayname??""),(!this.rawDisplayName||!Ih(this.rawDisplayName))&&(this.rawDisplayName=this.userId),i!==this.membership&&(this.updateModifiedTime(),this.emit("RoomMember.membership",e,this,i)),s!==this.name&&(this.updateModifiedTime(),this.emit("RoomMember.name",e,this,s))}setPowerLevelEvent(e){if(e.getType()!==Z.RoomPowerLevels||e.getStateKey()!=="")return;const n=e.getDirectionalContent();let r=n.users_default||0;const i=n.users||{};Object.values(i).forEach(a=>{r=Math.max(r,a)});const s=this.powerLevel,o=this.powerLevelNorm;i[this.userId]!==void 0&&Number.isInteger(i[this.userId])?this.powerLevel=i[this.userId]:n.users_default!==void 0?this.powerLevel=n.users_default:this.powerLevel=0,this.powerLevelNorm=0,r>0&&(this.powerLevelNorm=this.powerLevel*100/r),(s!==this.powerLevel||o!==this.powerLevelNorm)&&(this.updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))}setTypingEvent(e){if(e.getType()!=="m.typing")return;const n=this.typing;this.typing=!1;const r=e.getContent().user_ids;Array.isArray(r)&&(r.indexOf(this.userId)!==-1&&(this.typing=!0),n!==this.typing&&(this.updateModifiedTime(),this.emit("RoomMember.typing",e,this)))}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===Ge.Leave&&this.events.member!==void 0&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){const e=this.events.member;let n=e.getContent(),r=e.getSender();if(n.membership===Ge.Join&&(n=e.getPrevContent(),r=e.getUnsigned().prev_sender),n.membership===Ge.Invite&&n.is_direct)return r}}getAvatarUrl(e,n,r,i,s=!0,o){const a=this.getMxcAvatarUrl();if(!a&&!s)return null;const c=P2(e,a,n,r,i,o);return c||null}getMxcAvatarUrl(){if(this.events.member)return this.events.member.getDirectionalContent().avatar_url;if(this.user)return this.user.avatarUrl}}const J_e=/@.+:.+/,X_e=/[\u200E\u200F\u202A-\u202F]/;function Z_e(t,e,n){return!e||e===t||!Ih(e)||!n?!1:!!(J_e.test(e)||X_e.test(e)||n.getUserIdsWithDisplayName(e).some(i=>i!==t))}function Q_e(t,e,n){return!e||e===t?t:n?S6(e)+" ("+t+")":Ih(e)?S6(e):t}var ws={},A2={},gb={};Object.defineProperty(gb,"__esModule",{value:!0});gb.NamespacedMap=void 0;function ebe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=tbe(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function tbe(t,e){if(t){if(typeof t=="string")return H$(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H$(t,e)}}function H$(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function nbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rbe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ibe(t,e,n){return e&&rbe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function sbe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var obe=function(){function t(e){if(nbe(this,t),sbe(this,"internalMap",new Map),e){var n=ebe(e),r;try{for(n.s();!(r=n.n()).done;){var i=r.value;this.set(i[0],i[1])}}catch(s){n.e(s)}finally{n.f()}}}return ibe(t,[{key:"get",value:function(n){return n.name&&this.internalMap.has(n.name)?this.internalMap.get(n.name):n.altName&&this.internalMap.has(n.altName)?this.internalMap.get(n.altName):null}},{key:"set",value:function(n,r){n.name&&this.internalMap.set(n.name,r),n.altName&&this.internalMap.set(n.altName,r)}},{key:"has",value:function(n){return!!this.get(n)}},{key:"delete",value:function(n){n.name&&this.internalMap.delete(n.name),n.altName&&this.internalMap.delete(n.altName)}},{key:"hasNamespaced",value:function(n){return this.internalMap.has(n)}},{key:"getNamespaced",value:function(n){return this.internalMap.get(n)}}]),t}();gb.NamespacedMap=obe;var $u={};function I6(t){"@babel/helpers - typeof";return I6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I6(t)}Object.defineProperty($u,"__esModule",{value:!0});$u.InvalidEventError=void 0;function abe(t,e,n){return Object.defineProperty(t,"prototype",{writable:!1}),t}function cbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lbe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V0(t,e)}function ube(t){var e=uY();return function(){var r=q0(t),i;if(e){var s=q0(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return dbe(this,i)}}function dbe(t,e){if(e&&(I6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fbe(t)}function fbe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x6(t){var e=typeof Map=="function"?new Map:void 0;return x6=function(r){if(r===null||!hbe(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return HE(r,arguments,q0(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),V0(i,r)},x6(t)}function HE(t,e,n){return uY()?HE=Reflect.construct:HE=function(i,s,o){var a=[null];a.push.apply(a,s);var c=Function.bind.apply(i,a),l=new c;return o&&V0(l,o.prototype),l},HE.apply(null,arguments)}function uY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function hbe(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function V0(t,e){return V0=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},V0(t,e)}function q0(t){return q0=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},q0(t)}var pbe=function(t){lbe(n,t);var e=ube(n);function n(r){return cbe(this,n),e.call(this,r)}return abe(n)}(x6(Error));$u.InvalidEventError=pbe;var Dv={},gl={},Tf={};Object.defineProperty(Tf,"__esModule",{value:!0});Tf.ExtensibleEvent=void 0;function gbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mbe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vbe(t,e,n){return e&&mbe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var ybe=function(){function t(e){gbe(this,t),this.wireFormat=e}return vbe(t,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),t}();Tf.ExtensibleEvent=ybe;var mb={};Object.defineProperty(mb,"__esModule",{value:!0});mb.isOptionalAString=_be;mb.isProvided=dY;function _be(t){return dY(t)&&typeof t=="string"}function dY(t){return t!=null}var wr={},uc={};function P6(t){"@babel/helpers - typeof";return P6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P6(t)}Object.defineProperty(uc,"__esModule",{value:!0});uc.UnstableValue=uc.NamespacedValue=void 0;function bbe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O6(t,e)}function O6(t,e){return O6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},O6(t,e)}function Sbe(t){var e=Tbe();return function(){var r=rC(t),i;if(e){var s=rC(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return wbe(this,i)}}function wbe(t,e){if(e&&(P6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ebe(t)}function Ebe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Tbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rC(t){return rC=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},rC(t)}function fY(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cbe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hY(t,e,n){return e&&Cbe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}var pY=function(){function t(e,n){if(fY(this,t),this.stable=e,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return hY(t,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(n){return!!this.name&&this.name===n||!!this.altName&&this.altName===n}},{key:"findIn",value:function(n){var r;return this.name&&(r=n==null?void 0:n[this.name]),!r&&this.altName&&(r=n==null?void 0:n[this.altName]),r}},{key:"includedIn",value:function(n){var r=!1;return this.name&&(r=n.includes(this.name)),!r&&this.altName&&(r=n.includes(this.altName)),r}}]),t}();uc.NamespacedValue=pY;var kbe=function(t){bbe(n,t);var e=Sbe(n);function n(r,i){var s;if(fY(this,n),s=e.call(this,r,i),!s.unstable)throw new Error("Unstable value must be supplied");return s}return hY(n,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),n}(pY);uc.UnstableValue=kbe;Object.defineProperty(wr,"__esModule",{value:!0});wr.M_TEXT=wr.M_NOTICE=wr.M_MESSAGE=wr.M_HTML=wr.M_EMOTE=void 0;var vb=uc,Rbe=new vb.UnstableValue("m.message","org.matrix.msc1767.message");wr.M_MESSAGE=Rbe;var Ibe=new vb.UnstableValue("m.text","org.matrix.msc1767.text");wr.M_TEXT=Ibe;var xbe=new vb.UnstableValue("m.html","org.matrix.msc1767.html");wr.M_HTML=xbe;var Pbe=new vb.UnstableValue("m.emote","org.matrix.msc1767.emote");wr.M_EMOTE=Pbe;var Obe=new vb.UnstableValue("m.notice","org.matrix.msc1767.notice");wr.M_NOTICE=Obe;var Fu={};Object.defineProperty(Fu,"__esModule",{value:!0});Fu.isEventTypeSame=Mbe;function Mbe(t,e){if(typeof t=="string")return typeof e=="string"?e===t:e.matches(t);if(typeof e=="string")return t.matches(e);var n=e,r=t;return n.matches(r.name)||n.matches(r.altName)}function M6(t){"@babel/helpers - typeof";return M6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M6(t)}Object.defineProperty(gl,"__esModule",{value:!0});gl.MessageEvent=void 0;var Abe=Tf,Oy=mb,i3=$u,fo=wr,Lbe=Fu;function K$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function V$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?K$(Object(n),!0).forEach(function(r){cd(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Dbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function q$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nbe(t,e,n){return e&&q$(t.prototype,e),n&&q$(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ube(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A6(t,e)}function A6(t,e){return A6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},A6(t,e)}function $be(t){var e=Bbe();return function(){var r=iC(t),i;if(e){var s=iC(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Fbe(this,i)}}function Fbe(t,e){if(e&&(M6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KE(t)}function KE(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function iC(t){return iC=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},iC(t)}function cd(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var jbe=function(t){Ube(n,t);var e=$be(n);function n(r){var i;Dbe(this,n),i=e.call(this,r),cd(KE(i),"text",void 0),cd(KE(i),"html",void 0),cd(KE(i),"renderings",void 0);var s=fo.M_MESSAGE.findIn(i.wireContent),o=fo.M_TEXT.findIn(i.wireContent),a=fo.M_HTML.findIn(i.wireContent);if((0,Oy.isProvided)(s)){if(!Array.isArray(s))throw new i3.InvalidEventError("m.message contents must be an array");var c=s.find(function(u){return!(0,Oy.isProvided)(u.mimetype)||u.mimetype==="text/plain"}),l=s.find(function(u){return u.mimetype==="text/html"});if(!c)throw new i3.InvalidEventError("m.message is missing a plain text representation");i.text=c.body,i.html=l==null?void 0:l.body,i.renderings=s}else if((0,Oy.isOptionalAString)(o))i.text=o,i.html=a,i.renderings=[{body:o,mimetype:"text/plain"}],i.html&&i.renderings.push({body:i.html,mimetype:"text/html"});else throw new i3.InvalidEventError("Missing textual representation for event");return i}return Nbe(n,[{key:"isEmote",get:function(){return fo.M_EMOTE.matches(this.wireFormat.type)||(0,Oy.isProvided)(fo.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return fo.M_NOTICE.matches(this.wireFormat.type)||(0,Oy.isProvided)(fo.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(i){return(0,Lbe.isEventTypeSame)(i,fo.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var i=cd({},fo.M_MESSAGE.name,this.renderings);if(this.renderings.length===1){var s=this.renderings[0].mimetype;(s===void 0||s==="text/plain")&&(i=cd({},fo.M_TEXT.name,this.renderings[0].body))}return i}},{key:"serialize",value:function(){var i;return{type:"m.room.message",content:V$(V$({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:(i=this.html)!==null&&i!==void 0?i:void 0})}}}],[{key:"from",value:function(i,s){var o;return new n({type:fo.M_MESSAGE.name,content:(o={},cd(o,fo.M_TEXT.name,i),cd(o,fo.M_HTML.name,s),o)})}}]),n}(Abe.ExtensibleEvent);gl.MessageEvent=jbe;var Nv={};function L6(t){"@babel/helpers - typeof";return L6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L6(t)}Object.defineProperty(Nv,"__esModule",{value:!0});Nv.NoticeEvent=void 0;var Hbe=gl,nw=wr,Kbe=Fu;function G$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Vbe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qbe(t,e,n){return e&&z$(t.prototype,e),n&&z$(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function z1(){return typeof Reflect<"u"&&Reflect.get?z1=Reflect.get:z1=function(e,n,r){var i=Gbe(e,n);if(i){var s=Object.getOwnPropertyDescriptor(i,n);return s.get?s.get.call(arguments.length<3?e:r):s.value}},z1.apply(this,arguments)}function Gbe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=Yh(t),t!==null););return t}function zbe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D6(t,e)}function D6(t,e){return D6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},D6(t,e)}function Wbe(t){var e=Xbe();return function(){var r=Yh(t),i;if(e){var s=Yh(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Ybe(this,i)}}function Ybe(t,e){if(e&&(L6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jbe(t)}function Jbe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xbe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Yh(t){return Yh=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Yh(t)}var Zbe=function(t){zbe(n,t);var e=Wbe(n);function n(r){return Vbe(this,n),e.call(this,r)}return qbe(n,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(i){return(0,Kbe.isEventTypeSame)(i,nw.M_NOTICE)||z1(Yh(n.prototype),"isEquivalentTo",this).call(this,i)}},{key:"serialize",value:function(){var i=z1(Yh(n.prototype),"serialize",this).call(this);return i.content.msgtype="m.notice",i}}],[{key:"from",value:function(i,s){var o;return new n({type:nw.M_NOTICE.name,content:(o={},G$(o,nw.M_TEXT.name,i),G$(o,nw.M_HTML.name,s),o)})}}]),n}(Hbe.MessageEvent);Nv.NoticeEvent=Zbe;var Uv={};function N6(t){"@babel/helpers - typeof";return N6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N6(t)}Object.defineProperty(Uv,"__esModule",{value:!0});Uv.EmoteEvent=void 0;var Qbe=gl,rw=wr,eSe=Fu;function W$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tSe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Y$(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nSe(t,e,n){return e&&Y$(t.prototype,e),n&&Y$(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function W1(){return typeof Reflect<"u"&&Reflect.get?W1=Reflect.get:W1=function(e,n,r){var i=rSe(e,n);if(i){var s=Object.getOwnPropertyDescriptor(i,n);return s.get?s.get.call(arguments.length<3?e:r):s.value}},W1.apply(this,arguments)}function rSe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=Jh(t),t!==null););return t}function iSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U6(t,e)}function U6(t,e){return U6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},U6(t,e)}function sSe(t){var e=cSe();return function(){var r=Jh(t),i;if(e){var s=Jh(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return oSe(this,i)}}function oSe(t,e){if(e&&(N6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aSe(t)}function aSe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Jh(t){return Jh=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},Jh(t)}var lSe=function(t){iSe(n,t);var e=sSe(n);function n(r){return tSe(this,n),e.call(this,r)}return nSe(n,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(i){return(0,eSe.isEventTypeSame)(i,rw.M_EMOTE)||W1(Jh(n.prototype),"isEquivalentTo",this).call(this,i)}},{key:"serialize",value:function(){var i=W1(Jh(n.prototype),"serialize",this).call(this);return i.content.msgtype="m.emote",i}}],[{key:"from",value:function(i,s){var o;return new n({type:rw.M_EMOTE.name,content:(o={},W$(o,rw.M_TEXT.name,i),W$(o,rw.M_HTML.name,s),o)})}}]),n}(Qbe.MessageEvent);Uv.EmoteEvent=lSe;Object.defineProperty(Dv,"__esModule",{value:!0});Dv.LEGACY_M_ROOM_MESSAGE=void 0;Dv.parseMRoomMessage=pSe;var J$=gl,uSe=Nv,dSe=Uv,fSe=uc,td=wr;function X$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Yo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?X$(Object(n),!0).forEach(function(r){sh(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function sh(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var hSe=new fSe.NamespacedValue("m.room.message");Dv.LEGACY_M_ROOM_MESSAGE=hSe;function pSe(t){var e,n,r;if(td.M_MESSAGE.findIn(t.content)||td.M_TEXT.findIn(t.content))return new J$.MessageEvent(t);var i=(e=t.content)===null||e===void 0?void 0:e.msgtype,s=(n=t.content)===null||n===void 0?void 0:n.body,o=((r=t.content)===null||r===void 0?void 0:r.format)==="org.matrix.custom.html"?t.content.formatted_body:null;if(i==="m.text"){var a;return new J$.MessageEvent(Yo(Yo({},t),{},{content:Yo(Yo({},t.content),{},(a={},sh(a,td.M_TEXT.name,s),sh(a,td.M_HTML.name,o),a))}))}else if(i==="m.notice"){var c;return new uSe.NoticeEvent(Yo(Yo({},t),{},{content:Yo(Yo({},t.content),{},(c={},sh(c,td.M_TEXT.name,s),sh(c,td.M_HTML.name,o),c))}))}else if(i==="m.emote"){var l;return new dSe.EmoteEvent(Yo(Yo({},t),{},{content:Yo(Yo({},t.content),{},(l={},sh(l,td.M_TEXT.name,s),sh(l,td.M_HTML.name,o),l))}))}else return null}var L2={};Object.defineProperty(L2,"__esModule",{value:!0});L2.parseMMessage=ySe;var gSe=gl,Z$=wr,mSe=Uv,vSe=Nv;function ySe(t){return Z$.M_EMOTE.matches(t.type)?new mSe.EmoteEvent(t):Z$.M_NOTICE.matches(t.type)?new vSe.NoticeEvent(t):new gSe.MessageEvent(t)}var ki={};Object.defineProperty(ki,"__esModule",{value:!0});ki.M_POLL_START=ki.M_POLL_RESPONSE=ki.M_POLL_KIND_UNDISCLOSED=ki.M_POLL_KIND_DISCLOSED=ki.M_POLL_END=void 0;var yb=uc,_Se=new yb.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");ki.M_POLL_KIND_DISCLOSED=_Se;var bSe=new yb.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");ki.M_POLL_KIND_UNDISCLOSED=bSe;var SSe=new yb.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");ki.M_POLL_START=SSe;var wSe=new yb.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");ki.M_POLL_RESPONSE=wSe;var ESe=new yb.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");ki.M_POLL_END=ESe;var D2={},Xh={};function $6(t){"@babel/helpers - typeof";return $6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$6(t)}Object.defineProperty(Xh,"__esModule",{value:!0});Xh.PollStartEvent=Xh.PollAnswerSubevent=void 0;var xl=ki,gY=gl,R1=wr,VE=$u,TSe=uc,CSe=Fu,kSe=Tf;function RSe(t){return OSe(t)||PSe(t)||xSe(t)||ISe()}function ISe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xSe(t,e){if(t){if(typeof t=="string")return F6(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return F6(t,e)}}function PSe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function OSe(t){if(Array.isArray(t))return F6(t)}function F6(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Q$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function MSe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q$(Object(n),!0).forEach(function(r){Ls(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function mY(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function eF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vY(t,e,n){return e&&eF(t.prototype,e),n&&eF(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function yY(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B6(t,e)}function B6(t,e){return B6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},B6(t,e)}function _Y(t){var e=LSe();return function(){var r=sC(t),i;if(e){var s=sC(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return ASe(this,i)}}function ASe(t,e){if(e&&($6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dh(t)}function dh(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function LSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function sC(t){return sC=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},sC(t)}function Ls(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bY=function(t){yY(n,t);var e=_Y(n);function n(r){var i;mY(this,n),i=e.call(this,r),Ls(dh(i),"id",void 0);var s=r.content.id;if(!s||typeof s!="string")throw new VE.InvalidEventError("Answer ID must be a non-empty string");return i.id=s,i}return vY(n,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:MSe({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(i,s){return new n({type:"org.matrix.sdk.poll.answer",content:Ls({id:i},R1.M_TEXT.name,s)})}}]),n}(gY.MessageEvent);Xh.PollAnswerSubevent=bY;var DSe=function(t){yY(n,t);var e=_Y(n);function n(r){var i;mY(this,n),i=e.call(this,r),Ls(dh(i),"question",void 0),Ls(dh(i),"kind",void 0),Ls(dh(i),"rawKind",void 0),Ls(dh(i),"maxSelections",void 0),Ls(dh(i),"answers",void 0);var s=xl.M_POLL_START.findIn(i.wireContent);if(!s.question)throw new VE.InvalidEventError("A question is required");if(i.question=new gY.MessageEvent({type:"org.matrix.sdk.poll.question",content:s.question}),i.rawKind=s.kind,xl.M_POLL_KIND_DISCLOSED.matches(i.rawKind)?i.kind=xl.M_POLL_KIND_DISCLOSED:i.kind=xl.M_POLL_KIND_UNDISCLOSED,i.maxSelections=Number.isFinite(s.max_selections)&&s.max_selections>0?s.max_selections:1,!Array.isArray(s.answers))throw new VE.InvalidEventError("Poll answers must be an array");var o=s.answers.slice(0,20).map(function(a){return new bY({type:"org.matrix.sdk.poll.answer",content:a})});if(o.length<=0)throw new VE.InvalidEventError("No answers available");return i.answers=o,i}return vY(n,[{key:"isEquivalentTo",value:function(i){return(0,CSe.isEventTypeSame)(i,xl.M_POLL_START)}},{key:"serialize",value:function(){var i;return{type:xl.M_POLL_START.name,content:(i={},Ls(i,xl.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(s){return s.serialize().content})}),Ls(i,R1.M_TEXT.name,"".concat(this.question.text,`
`).concat(this.answers.map(function(s,o){return"".concat(o+1,". ").concat(s.text)}).join(`
`))),i)}}}],[{key:"from",value:function(i,s,o){var a,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return new n({type:xl.M_POLL_START.name,content:(a={},Ls(a,R1.M_TEXT.name,i),Ls(a,xl.M_POLL_START.name,{question:Ls({},R1.M_TEXT.name,i),kind:o instanceof TSe.NamespacedValue?o.name:o,max_selections:c,answers:s.map(function(l){return Ls({id:NSe()},R1.M_TEXT.name,l)})}),a)})}}]),n}(kSe.ExtensibleEvent);Xh.PollStartEvent=DSe;var tF="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function NSe(){return RSe(Array(16)).map(function(){return tF.charAt(Math.floor(Math.random()*tF.length))}).join("")}var _b={},$v={};Object.defineProperty($v,"__esModule",{value:!0});$v.REFERENCE_RELATION=void 0;var USe=uc,$Se=new USe.NamespacedValue("m.reference");$v.REFERENCE_RELATION=$Se;function j6(t){"@babel/helpers - typeof";return j6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j6(t)}Object.defineProperty(_b,"__esModule",{value:!0});_b.PollResponseEvent=void 0;var FSe=Tf,cg=ki,BSe=$u,s3=$v,jSe=Fu;function HSe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function KSe(t,e,n){return e&&nF(t.prototype,e),n&&nF(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function VSe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H6(t,e)}function H6(t,e){return H6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},H6(t,e)}function qSe(t){var e=zSe();return function(){var r=oC(t),i;if(e){var s=oC(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return GSe(this,i)}}function GSe(t,e){if(e&&(j6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qE(t)}function qE(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zSe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function oC(t){return oC=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},oC(t)}function My(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var WSe=function(t){VSe(n,t);var e=qSe(n);function n(r){var i;HSe(this,n),i=e.call(this,r),My(qE(i),"internalAnswerIds",void 0),My(qE(i),"internalSpoiled",void 0),My(qE(i),"pollEventId",void 0);var s=i.wireContent["m.relates_to"];if(!s3.REFERENCE_RELATION.matches(s==null?void 0:s.rel_type)||typeof(s==null?void 0:s.event_id)!="string")throw new BSe.InvalidEventError("Relationship must be a reference to an event");return i.pollEventId=s.event_id,i.validateAgainst(null),i}return KSe(n,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(i){var s=cg.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(s==null?void 0:s.answers)){this.internalSpoiled=!0,this.internalAnswerIds=[];return}var o=s.answers;if(o.some(function(a){return typeof a!="string"})||o.length===0){this.internalSpoiled=!0,this.internalAnswerIds=[];return}if(i){if(o.some(function(a){return!i.answers.some(function(c){return c.id===a})})){this.internalSpoiled=!0,this.internalAnswerIds=[];return}o=o.slice(0,i.maxSelections)}this.internalAnswerIds=o,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(i){return(0,jSe.isEventTypeSame)(i,cg.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:cg.M_POLL_RESPONSE.name,content:My({"m.relates_to":{rel_type:s3.REFERENCE_RELATION.name,event_id:this.pollEventId}},cg.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(i,s){return new n({type:cg.M_POLL_RESPONSE.name,content:My({"m.relates_to":{rel_type:s3.REFERENCE_RELATION.name,event_id:s}},cg.M_POLL_RESPONSE.name,{answers:i})})}}]),n}(FSe.ExtensibleEvent);_b.PollResponseEvent=WSe;var bb={};function K6(t){"@babel/helpers - typeof";return K6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K6(t)}Object.defineProperty(bb,"__esModule",{value:!0});bb.PollEndEvent=void 0;var Ay=ki,YSe=$u,o3=$v,JSe=gl,XSe=wr,ZSe=Fu,QSe=Tf;function rF(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ewe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rF(Object(n),!0).forEach(function(r){Pg(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rF(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function twe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function iF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nwe(t,e,n){return e&&iF(t.prototype,e),n&&iF(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function rwe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V6(t,e)}function V6(t,e){return V6=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},V6(t,e)}function iwe(t){var e=owe();return function(){var r=aC(t),i;if(e){var s=aC(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return swe(this,i)}}function swe(t,e){if(e&&(K6(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return q6(t)}function q6(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function owe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function aC(t){return aC=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},aC(t)}function Pg(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var awe=function(t){rwe(n,t);var e=iwe(n);function n(r){var i;twe(this,n),i=e.call(this,r),Pg(q6(i),"pollEventId",void 0),Pg(q6(i),"closingMessage",void 0);var s=i.wireContent["m.relates_to"];if(!o3.REFERENCE_RELATION.matches(s==null?void 0:s.rel_type)||typeof(s==null?void 0:s.event_id)!="string")throw new YSe.InvalidEventError("Relationship must be a reference to an event");return i.pollEventId=s.event_id,i.closingMessage=new JSe.MessageEvent(i.wireFormat),i}return nwe(n,[{key:"isEquivalentTo",value:function(i){return(0,ZSe.isEventTypeSame)(i,Ay.M_POLL_END)}},{key:"serialize",value:function(){return{type:Ay.M_POLL_END.name,content:ewe(Pg({"m.relates_to":{rel_type:o3.REFERENCE_RELATION.name,event_id:this.pollEventId}},Ay.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(i,s){var o;return new n({type:Ay.M_POLL_END.name,content:(o={"m.relates_to":{rel_type:o3.REFERENCE_RELATION.name,event_id:i}},Pg(o,Ay.M_POLL_END.name,{}),Pg(o,XSe.M_TEXT.name,s),o)})}}]),n}(QSe.ExtensibleEvent);bb.PollEndEvent=awe;Object.defineProperty(D2,"__esModule",{value:!0});D2.parseMPoll=dwe;var a3=ki,cwe=Xh,lwe=_b,uwe=bb;function dwe(t){return a3.M_POLL_START.matches(t.type)?new cwe.PollStartEvent(t):a3.M_POLL_RESPONSE.matches(t.type)?new lwe.PollResponseEvent(t):a3.M_POLL_END.matches(t.type)?new uwe.PollEndEvent(t):null}Object.defineProperty(A2,"__esModule",{value:!0});A2.ExtensibleEvents=void 0;var fwe=gb,hwe=$u,sF=Dv,c3=L2,iw=wr,l3=ki,u3=D2;function pwe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=gwe(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function gwe(t,e){if(t){if(typeof t=="string")return oF(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oF(t,e)}}function oF(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function mwe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function aF(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vwe(t,e,n){return e&&aF(t.prototype,e),n&&aF(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function G6(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var z6=function(){function t(){mwe(this,t),G6(this,"interpreters",new fwe.NamespacedMap([[sF.LEGACY_M_ROOM_MESSAGE,sF.parseMRoomMessage],[iw.M_MESSAGE,c3.parseMMessage],[iw.M_EMOTE,c3.parseMMessage],[iw.M_NOTICE,c3.parseMMessage],[l3.M_POLL_START,u3.parseMPoll],[l3.M_POLL_RESPONSE,u3.parseMPoll],[l3.M_POLL_END,u3.parseMPoll]])),G6(this,"_unknownInterpretOrder",[iw.M_MESSAGE])}return vwe(t,[{key:"unknownInterpretOrder",get:function(){var n;return(n=this._unknownInterpretOrder)!==null&&n!==void 0?n:[]},set:function(n){this._unknownInterpretOrder=n}},{key:"registerInterpreter",value:function(n,r){this.interpreters.set(n,r)}},{key:"parse",value:function(n){try{if(this.interpreters.hasNamespaced(n.type))return this.interpreters.getNamespaced(n.type)(n);var r=pwe(this.unknownInterpretOrder),i;try{for(r.s();!(i=r.n()).done;){var s=i.value;if(this.interpreters.has(s)){var o=this.interpreters.get(s)(n);if(o)return o}}}catch(a){r.e(a)}finally{r.f()}return null}catch(a){if(a instanceof hwe.InvalidEventError)return null;throw a}}}],[{key:"defaultInstance",get:function(){return t._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return t.defaultInstance.unknownInterpretOrder},set:function(n){t.defaultInstance.unknownInterpretOrder=n}},{key:"registerInterpreter",value:function(n,r){t.defaultInstance.registerInterpreter(n,r)}},{key:"parse",value:function(n){return t.defaultInstance.parse(n)}}]),t}();A2.ExtensibleEvents=z6;G6(z6,"_defaultInstance",new z6);var SY={};Object.defineProperty(SY,"__esModule",{value:!0});var Fv={};Object.defineProperty(Fv,"__esModule",{value:!0});Fv.LegacyMsgType=void 0;Fv.isEventLike=ywe;var d3=wr,um;Fv.LegacyMsgType=um;(function(t){t.Text="m.text",t.Notice="m.notice",t.Emote="m.emote"})(um||(Fv.LegacyMsgType=um={}));function ywe(t,e){var n=t.content;return e===um.Text?d3.M_MESSAGE.matches(t.type)||t.type==="m.room.message"&&(n==null?void 0:n.msgtype)==="m.text":e===um.Emote?d3.M_EMOTE.matches(t.type)||t.type==="m.room.message"&&(n==null?void 0:n.msgtype)==="m.emote":e===um.Notice?d3.M_NOTICE.matches(t.type)||t.type==="m.room.message"&&(n==null?void 0:n.msgtype)==="m.notice":!1}(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=A2;Object.keys(e).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===e[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return e[R]}})});var n=SY;Object.keys(n).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===n[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return n[R]}})});var r=$u;Object.keys(r).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===r[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return r[R]}})});var i=uc;Object.keys(i).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===i[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return i[R]}})});var s=gb;Object.keys(s).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===s[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return s[R]}})});var o=mb;Object.keys(o).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===o[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return o[R]}})});var a=Fv;Object.keys(a).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===a[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return a[R]}})});var c=Fu;Object.keys(c).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===c[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return c[R]}})});var l=Dv;Object.keys(l).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===l[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return l[R]}})});var u=L2;Object.keys(u).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===u[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return u[R]}})});var d=D2;Object.keys(d).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===d[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return d[R]}})});var f=$v;Object.keys(f).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===f[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return f[R]}})});var p=Tf;Object.keys(p).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===p[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return p[R]}})});var m=wr;Object.keys(m).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===m[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return m[R]}})});var v=gl;Object.keys(v).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===v[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return v[R]}})});var S=Uv;Object.keys(S).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===S[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return S[R]}})});var _=Nv;Object.keys(_).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===_[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return _[R]}})});var w=ki;Object.keys(w).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===w[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return w[R]}})});var T=Xh;Object.keys(T).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===T[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return T[R]}})});var C=_b;Object.keys(C).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===C[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return C[R]}})});var I=bb;Object.keys(I).forEach(function(R){R==="default"||R==="__esModule"||R in t&&t[R]===I[R]||Object.defineProperty(t,R,{enumerable:!0,get:function(){return I[R]}})})})(ws);const _we="modulepreload",bwe=function(t){return"/"+t},cF={},Swe=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=bwe(c),c in cF)return;cF[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":_we,l||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var Id=(t=>(t.DisplayName="User.displayName",t.AvatarUrl="User.avatarUrl",t.Presence="User.presence",t.CurrentlyActive="User.currentlyActive",t.LastPresenceTs="User.lastPresenceTs",t))(Id||{});class lu extends Fn{constructor(e){super(),this.userId=e,this.modified=-1,this.presence="offline",this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={},this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,n){const r=new lu(e);return n.reEmitter.reEmit(r,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),r}setPresenceEvent(e){if(e.getType()!=="m.presence")return;const n=this.events.presence===null;this.events.presence=e;const r=[];(e.getContent().presence!==this.presence||n)&&r.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push("User.displayName"),e.getContent().currently_active!==void 0&&e.getContent().currently_active!==this.currentlyActive&&r.push("User.currentlyActive"),this.presence=e.getContent().presence,r.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(const i of r)this.emit(i,e,this)}setDisplayName(e){const n=this.displayName;this.displayName=e,e!==n&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){const n=this.avatarUrl;this.avatarUrl=e,e!==n&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var It=(t=>(t.Backward="b",t.Forward="f",t))(It||{});const Bi=class Bi{constructor(e){var n;this.eventTimelineSet=e,this.events=[],this.baseIndex=0,this.startToken=null,this.endToken=null,this.prevTimeline=null,this.nextTimeline=null,this.paginationRequests={b:null,f:null},this.roomId=((n=e.room)==null?void 0:n.roomId)??null,this.roomId&&(this.startState=new e_(this.roomId,void 0,!0),this.endState=new e_(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+new Date().toISOString()}static setEventMetadata(e,n,r){var i,s,o,a;(s=(i=e.sender)==null?void 0:i.events)!=null&&s.member||(e.sender=n.getSentinelMember(e.getSender())),!((a=(o=e.target)==null?void 0:o.events)!=null&&a.member)&&e.getType()===Z.RoomMember&&(e.target=n.getSentinelMember(e.getStateKey())),e.isState()&&r&&(e.forwardLooking=!1)}initialiseState(e,{timelineWasEmpty:n}={}){var r,i;if(this.events.length>0)throw new Error("Cannot initialise state after events are added");(r=this.startState)==null||r.setStateEvents(e,{timelineWasEmpty:n}),(i=this.endState)==null||i.setStateEvents(e,{timelineWasEmpty:n})}forkLive(e){const n=this.getState(e),r=new Bi(this.eventTimelineSet);return r.startState=n==null?void 0:n.clone(),r.endState=n,this.endState=n==null?void 0:n.clone(),r}fork(e){const n=this.getState(e),r=new Bi(this.eventTimelineSet);return r.startState=n==null?void 0:n.clone(),r.endState=n==null?void 0:n.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Bi.BACKWARDS)return this.startState;if(e==Bi.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e==="b"?this.startToken:this.endToken}setPaginationToken(e,n){this.roomId?this.getState(n).paginationToken=e:n==="b"?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Bi.BACKWARDS)return this.prevTimeline;if(e==Bi.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,n){if(this.getNeighbouringTimeline(n))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+n+")");if(n==Bi.BACKWARDS)this.prevTimeline=e;else if(n==Bi.FORWARDS)this.nextTimeline=e;else throw new Error("Invalid direction '"+n+"'");this.setPaginationToken(null,n)}addEvent(e,{toStartOfTimeline:n,roomState:r,timelineWasEmpty:i}={toStartOfTimeline:!1}){r||(r=n?this.startState:this.endState);const s=this.getTimelineSet();s.room&&(Bi.setEventMetadata(e,r,n),e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(r==null||r.setStateEvents([e],{timelineWasEmpty:i}),(!e.sender||e.getType()===Z.RoomMember&&!n)&&Bi.setEventMetadata(e,r,n)));let o;n?o=0:o=this.events.length,this.events.splice(o,0,e),n&&this.baseIndex++}insertEvent(e,n,r){const i=this.getTimelineSet();i.room&&(Bi.setEventMetadata(e,r,!1),e.isState()&&i.room.getUnfilteredTimelineSet()===i&&(r.setStateEvents([e],{}),(!e.sender||e.getType()===Z.RoomMember)&&Bi.setEventMetadata(e,r,!1))),this.events.splice(n,0,e)}removeEvent(e){for(let n=this.events.length-1;n>=0;n--){const r=this.events[n];if(r.getId()==e)return this.events.splice(n,1),n<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}};Bi.BACKWARDS="b",Bi.FORWARDS="f";let He=Bi;var wY=(t=>(t.Add="Relations.add",t.Remove="Relations.remove",t.Redaction="Relations.redaction",t))(wY||{});const wwe=(t,e,n=[])=>[e,...n].includes(t);class h4 extends Fn{constructor(e,n,r,i){super(),this.relationType=e,this.eventType=n,this.altEventTypes=i,this.relationEventIds=new Set,this.relations=new Set,this.annotationsByKey={},this.annotationsBySender={},this.sortedAnnotationsByKey=[],this.targetEvent=null,this.creationEmitted=!1,this.onEventStatus=(s,o)=>{if(!s.isSending()){s.removeListener(sn.Status,this.onEventStatus);return}o===Ze.CANCELLED&&(s.removeListener(sn.Status,this.onEventStatus),this.removeEvent(s))},this.onBeforeRedaction=async s=>{if(this.relations.has(s)){if(this.relations.delete(s),this.relationType===qn.Annotation)this.removeAnnotationFromAggregation(s);else if(this.relationType===qn.Replace&&this.targetEvent&&!this.targetEvent.isState()){const o=await this.getLastReplacement();this.targetEvent.makeReplaced(o)}s.removeListener(sn.BeforeRedaction,this.onBeforeRedaction),this.emit("Relations.redaction",s)}},this.client=r instanceof U2?r.client:r}async addEvent(e){if(this.relationEventIds.has(e.getId()))return;const n=e.getRelation();if(!n){k.error("Event must have relation info");return}const r=n.rel_type,i=e.getType();if(this.relationType!==r||!wwe(i,this.eventType,this.altEventTypes)){k.error("Event relation info doesn't match this container");return}if(e.isSending()&&e.on(sn.Status,this.onEventStatus),this.relations.add(e),this.relationEventIds.add(e.getId()),this.relationType===qn.Annotation)this.addAnnotationToAggregation(e);else if(this.relationType===qn.Replace&&this.targetEvent&&!this.targetEvent.isState()){const s=await this.getLastReplacement();this.targetEvent.makeReplaced(s)}e.on(sn.BeforeRedaction,this.onBeforeRedaction),this.emit("Relations.add",e),this.maybeEmitCreated()}async removeEvent(e){if(this.relations.has(e)){if(this.relations.delete(e),this.relationType===qn.Annotation)this.removeAnnotationFromAggregation(e);else if(this.relationType===qn.Replace&&this.targetEvent&&!this.targetEvent.isState()){const n=await this.getLastReplacement();this.targetEvent.makeReplaced(n)}this.emit("Relations.remove",e)}}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){const{key:n}=e.getRelation()??{};if(!n)return;let r=this.annotationsByKey[n];r||(r=this.annotationsByKey[n]=new Set,this.sortedAnnotationsByKey.push([n,r])),r.add(e),this.sortedAnnotationsByKey.sort((o,a)=>{const c=o[1];return a[1].size-c.size});const i=e.getSender();let s=this.annotationsBySender[i];s||(s=this.annotationsBySender[i]=new Set),s.add(e)}removeAnnotationFromAggregation(e){const{key:n}=e.getRelation()??{};if(!n)return;const r=this.annotationsByKey[n];r&&(r.delete(e),this.sortedAnnotationsByKey.sort((o,a)=>{const c=o[1];return a[1].size-c.size}));const i=e.getSender(),s=this.annotationsBySender[i];s&&s.delete(e)}getSortedAnnotationsByKey(){return this.relationType!==qn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==qn.Annotation?null:this.annotationsBySender}async getLastReplacement(){if(this.relationType!==qn.Replace||!this.targetEvent)return null;const e=this.targetEvent.getServerAggregatedRelation(qn.Replace),n=e==null?void 0:e.origin_server_ts,r=this.getRelations().reduce((i,s)=>s.getSender()!==this.targetEvent.getSender()||n&&n>s.getTs()||i&&i.getTs()>s.getTs()?i:s,null);return r!=null&&r.shouldAttemptDecryption()&&this.client.isCryptoEnabled()?await r.attemptDecryption(this.client.crypto):r!=null&&r.isBeingDecrypted()&&await r.getDecryptionPromise(),r}async setTargetEvent(e){if(!this.targetEvent){if(this.targetEvent=e,this.relationType===qn.Replace&&!this.targetEvent.isState()){const n=await this.getLastReplacement();n&&this.targetEvent.makeReplaced(n)}this.maybeEmitCreated()}}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(sn.RelationsCreated,this.relationType,this.eventType))}}class EY{constructor(e,n){this.client=e,this.room=n,this.relations=new Map}getChildEventsForEvent(e,n,r){var i,s;return(s=(i=this.relations.get(e))==null?void 0:i.get(n))==null?void 0:s.get(r)}getAllChildEventsForEvent(e){const n=this.relations.get(e)??new Map,r=[];for(const i of n.values())for(const s of i.values())r.push(...s.getRelations());return r}aggregateParentEvent(e){const n=this.relations.get(e.getId());if(n)for(const r of n.values())for(const i of r.values())i.setTargetEvent(e)}aggregateChildEvent(e,n){if(e.isRedacted()||e.status===Ze.CANCELLED)return;const r=e.getRelation();if(!r)return;const i=()=>{if(e.isDecryptionFailure()){e.once(sn.Decrypted,i);return}this.aggregateChildEvent(e,n)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption()){e.once(sn.Decrypted,i);return}const{event_id:s,rel_type:o}=r,a=e.getType();let c=this.relations.get(s);c||(c=new Map,this.relations.set(s,c));let l=c.get(o);l||(l=new Map,c.set(o,l));let u=l.get(a);if(!u){u=new h4(o,a,this.client),l.set(a,u);const d=this.room??(n==null?void 0:n.room),f=(n==null?void 0:n.findEventById(s))??(d==null?void 0:d.findEventById(s))??(d==null?void 0:d.getPendingEvent(s));f&&u.setTargetEvent(f)}u.addEvent(e)}}let Og;Og=k.log.bind(k);var Y1=(t=>(t.Ignore="ignore",t.Replace="replace",t))(Y1||{});class jg extends Fn{constructor(e,n={},r,i,s=null){var o;super(),this.room=e,this.thread=i,this.threadListType=s,this._eventIdToTimeline=new Map,this.timelineSupport=!!n.timelineSupport,this.liveTimeline=new He(this),this.displayPendingEvents=n.pendingEvents!==!1,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=n.filter,this.relations=((o=this.room)==null?void 0:o.relations)??new EY((e==null?void 0:e.client)??r)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return!this.room||!this.displayPendingEvents?[]:this.room.getPendingEvents()}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,n){const r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(n,r))}resetLiveTimeline(e,n){const r=!this.timelineSupport||!n,i=this.liveTimeline,s=r?i.forkLive(He.FORWARDS):i.fork(He.FORWARDS);r?(this.timelines=[s],this._eventIdToTimeline=new Map):this.timelines.push(s),n&&i.setPaginationToken(n,He.FORWARDS),s.setPaginationToken(e??null,He.BACKWARDS),this.liveTimeline=s,this.emit(ct.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(e==null)return null;const n=this._eventIdToTimeline.get(e);return n===void 0?null:n}findEventById(e){const n=this.getTimelineForEvent(e);if(n)return n.getEvents().find(function(r){return r.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new He(this);return this.timelines.push(e),e}addEventsToTimeline(e,n,r,i){if(!r)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!n&&r==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this.filter&&(e=this.filter.filterRoomTimeline(e),!e.length))return;const s=n?He.BACKWARDS:He.FORWARDS,o=n?He.FORWARDS:He.BACKWARDS;let a=!1,c=!1;for(const l of e){const u=l.getId(),d=this._eventIdToTimeline.get(u);if(!d){this.addEventToTimeline(l,r,{toStartOfTimeline:n}),c=!0,a=!0;continue}if(c=!1,d==r){Og("Event "+u+" already in timeline "+r);continue}const f=r.getNeighbouringTimeline(s);if(f){d==f?Og("Event "+u+" in neighbouring timeline - switching to "+d):Og("Event "+u+" already in a different timeline "+d),r=d;continue}k.info("Already have timeline for "+u+" - joining timeline "+r+" to "+d);const p=d===this.liveTimeline,m=r===this.liveTimeline,v=s===He.BACKWARDS&&p,S=s===He.FORWARDS&&m;if(v||S){v&&k.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+d+")"),S&&k.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+r+")");continue}r.setNeighbouringTimeline(d,s),d.setNeighbouringTimeline(r,o),r=d,a=!0}if(c||!a){if(s===He.FORWARDS&&r===this.liveTimeline){k.warn({lastEventWasNew:c,didUpdate:a}),k.warn(`Refusing to set forwards pagination token of live timeline ${r} to ${i}`);return}r.setPaginationToken(i??null,s)}}addLiveEvent(e,{duplicateStrategy:n,fromCache:r,roomState:i,timelineWasEmpty:s}={}){if(this.filter&&!this.filter.filterRoomTimeline([e]).length)return;const o=this._eventIdToTimeline.get(e.getId());if(o){if(n==="replace"){Og("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const a=o.getEvents();for(let c=0;c<a.length;c++)if(a[c].getId()===e.getId()){i||(i=o.getState(He.FORWARDS)),He.setEventMetadata(e,i,!1),a[c]=e;break}}else Og("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());return}this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:r,roomState:i,timelineWasEmpty:s})}addEventToTimeline(e,n,r,i=!1,s){var u,d;let o=!!r,a;if(typeof r=="object"?{toStartOfTimeline:o,fromCache:i=!1,roomState:s,timelineWasEmpty:a}=r:r!==void 0&&k.warn("Overload deprecated: `EventTimelineSet.addEventToTimeline(event, timeline, toStartOfTimeline, fromCache?, roomState?)` is deprecated in favor of the overload with `EventTimelineSet.addEventToTimeline(event, timeline, IAddEventToTimelineOptions)`"),n.getTimelineSet()!==this)throw new Error(`EventTimelineSet.addEventToTimeline: Timeline=${n.toString()} does not belong " +
                "in timelineSet(threadId=${(u=this.thread)==null?void 0:u.id})`);const c=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){let f=`event=${c}`;e.threadRootId&&(f+=`(belongs to thread=${e.threadRootId})`),k.warn(`EventTimelineSet.addEventToTimeline: Ignoring ${f} that does not belong in timeline=${n.toString()} timelineSet(threadId=${(d=this.thread)==null?void 0:d.id})`);return}n.addEvent(e,{toStartOfTimeline:o,roomState:s,timelineWasEmpty:a}),this._eventIdToTimeline.set(c,n);const l={timeline:n,liveEvent:!o&&n==this.liveTimeline&&!i};this.emit(ct.Timeline,e,this.room,!!o,!1,l)}insertEventIntoTimeline(e,n,r){var d,f;if(n.getTimelineSet()!==this)throw new Error(`EventTimelineSet.insertEventIntoTimeline: Timeline=${n.toString()} does not belong " +
                "in timelineSet(threadId=${(d=this.thread)==null?void 0:d.id})`);const i=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){let p=`event=${i}`;e.threadRootId&&(p+=`(belongs to thread=${e.threadRootId})`),k.warn(`EventTimelineSet.insertEventIntoTimeline: Ignoring ${p} that does not belong in timeline=${n.toString()} timelineSet(threadId=${(f=this.thread)==null?void 0:f.id})`);return}const s=e.relationEventId;if(!s){this.addEventToTimeline(e,n,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:r});return}const o=this.findEventById(s),a=n.getEvents();let l=o!==void 0?a.indexOf(o):0;for(;l<a.length&&!(a[l].getTs()>e.getTs());l++);n.insertEvent(e,l,r),this._eventIdToTimeline.set(i,n);const u={timeline:n,liveEvent:!1};this.emit(ct.Timeline,e,this.room,!1,!1,u)}handleRemoteEcho(e,n,r){const i=this._eventIdToTimeline.get(n);i?(this._eventIdToTimeline.delete(n),this._eventIdToTimeline.set(r,i)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1})}removeEvent(e){const n=this._eventIdToTimeline.get(e);if(!n)return null;const r=n.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);const i={timeline:n};this.emit(ct.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,n){if(e==n)return 0;const r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(n);if(r===void 0||i===void 0)return null;if(r===i){let o,a;const c=r.getEvents();for(let u=0;u<c.length&&(o===void 0||a===void 0);u++){const d=c[u].getId();d==e&&(o=u),d==n&&(a=u)}const l=o-a;return l<0?-1:l>0?1:0}let s=r;for(;s;){if(s===i)return-1;s=s.getNeighbouringTimeline(He.FORWARDS)}for(s=r;s;){if(s===i)return 1;s=s.getNeighbouringTimeline(He.BACKWARDS)}return null}canContain(e){var s;if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");const{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);return this.thread?this.thread.id===n:(!r&&!i&&k.warn(`EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=${(s=this.room)==null?void 0:s.roomId} eventId=${e.getId()} threadId=${e.threadRootId}`),r)}}var Ze=(t=>(t.NOT_SENT="not_sent",t.ENCRYPTING="encrypting",t.SENDING="sending",t.QUEUED="queued",t.SENT="sent",t.CANCELLED="cancelled",t))(Ze||{});class TY{constructor(e,n){this.roomId=e}}class CY{constructor(e){this.target=e,this.reEmitters=new WeakMap}reEmit(e,n){let r=this.reEmitters.get(e);r||(r=new Map,this.reEmitters.set(e,r));for(const i of n){if(r.has(i))continue;const s=(...o)=>{i==="error"&&this.target.listenerCount("error")===0||this.target.emit(i,...o,e)};e.on(i,s),r.set(i,s)}}stopReEmitting(e,n){const r=this.reEmitters.get(e);if(r){for(const i of n)e.off(i,r.get(i)),r.delete(i);r.size===0&&this.reEmitters.delete(e)}}}class Bv extends CY{constructor(e){super(e)}reEmit(e,n){super.reEmit(e,n)}stopReEmitting(e,n){super.stopReEmitting(e,n)}}const G0=new R2("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function Ewe(t,e){if(e.endsWith("*")){const n=e.slice(0,-1);return t.slice(0,n.length)===n}else return t===e}class lF{constructor(e,n){this.filterJson=e,this.userId=n}check(e){var s,o;const n=((s=e.getUnsigned())==null?void 0:s["m.relations"])||{},r=Object.keys(n),i=[];return this.userId&&((o=n==null?void 0:n[hn.name])!=null&&o.current_user_participated)&&i.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),e.getContent()?e.getContent().url!==void 0:!1,r,i)}toJSON(){return{types:this.filterJson.types||null,not_types:this.filterJson.not_types||[],rooms:this.filterJson.rooms||null,not_rooms:this.filterJson.not_rooms||[],senders:this.filterJson.senders||null,not_senders:this.filterJson.not_senders||[],contains_url:this.filterJson.contains_url||null,[gm.name]:this.filterJson[gm.name]||[],[mm.name]:this.filterJson[mm.name]||[]}}checkFields(e,n,r,i,s,o){const a={rooms:function(d){return e===d},senders:function(d){return n===d},types:function(d){return Ewe(r,d)}};for(const d in a){const f=a[d],p="not_"+d,m=this.filterJson[p];if(m!=null&&m.some(f))return!1;const v=this.filterJson[d];if(v&&!v.some(f))return!1}const c=this.filterJson.contains_url;if(c!==void 0&&c!==i)return!1;const l=this.filterJson[mm.name];if(l!==void 0&&!this.arrayMatchesFilter(l,s))return!1;const u=this.filterJson[gm.name];return!(u!==void 0&&!this.arrayMatchesFilter(u,o))}arrayMatchesFilter(e,n){return n.length>0&&e.every(r=>n.includes(r))}filter(e){return e.filter(this.check,this)}limit(){return this.filterJson.limit!==void 0?this.filterJson.limit:10}}function f3(t,e,n){const r=e.split(".");let i=t;for(let s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=n}const b2=class b2{constructor(e,n){this.userId=e,this.filterId=n,this.definition={}}static fromJson(e,n,r){const i=new b2(e,n);return i.setDefinition(r),i}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;const n=e.room,r={};n&&(n.rooms&&(r.rooms=n.rooms),n.rooms&&(r.not_rooms=n.not_rooms)),this.roomFilter=new lF(r,this.userId),this.roomTimelineFilter=new lF((n==null?void 0:n.timeline)||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){f3(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var n,r,i;this.definition={...this.definition,room:{...(n=this.definition)==null?void 0:n.room,timeline:{...(i=(r=this.definition)==null?void 0:r.room)==null?void 0:i.timeline,[G0.name]:e}}}}setLazyLoadMembers(e){f3(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){f3(this.definition,"room.include_leave",e)}};b2.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0};let _o=b2;function p4(t){return t!=null}const Twe=new ws.UnstableValue("m.message","org.matrix.msc1767.message"),g4=new ws.UnstableValue("m.text","org.matrix.msc1767.text"),Cwe=new ws.UnstableValue("m.html","org.matrix.msc1767.html"),kY=new ws.NamespacedValue("m.reference");function kwe(t,e){if(typeof t=="string")return typeof e=="string"?e===t:e.matches(t);if(typeof e=="string")return t.matches(e);{const n=e,r=t;return n.matches(r.name)||p4(r.altName)&&n.matches(r.altName)}}const m4=new or("m.topic","org.matrix.msc3765.topic");function RY(t,e){return{msgtype:Oa.Text,format:"org.matrix.custom.html",body:t,formatted_body:e}}function IY(t,e){return{msgtype:Oa.Notice,format:"org.matrix.custom.html",body:t,formatted_body:e}}function xY(t,e){return{msgtype:Oa.Emote,format:"org.matrix.custom.html",body:t,formatted_body:e}}function PY(t){return{msgtype:Oa.Text,body:t}}function OY(t){return{msgtype:Oa.Notice,body:t}}function MY(t){return{msgtype:Oa.Emote,body:t}}const AY=(t,e,n,r)=>{const i=`at ${new Date(n).toISOString()}`,s=e===zh.Self?"User":void 0,o=r?`"${r}"`:void 0;return[s,"Location",o,t,i].filter(Boolean).join(" ")},LY=(t,e,n,r,i)=>{const s=t??AY(e,i||zh.Self,n,r),o=n?{[wf.name]:n}:{};return{msgtype:Oa.Location,body:s,geo_uri:e,[hb.name]:{description:r,uri:e},[fb.name]:{type:i||zh.Self},[g4.name]:s,...o}},Rwe=t=>{const e=hb.findIn(t),n=fb.findIn(t),r=wf.findIn(t),i=g4.findIn(t),s=(e==null?void 0:e.uri)??(t==null?void 0:t.geo_uri),o=e==null?void 0:e.description,a=(n==null?void 0:n.type)??zh.Self,c=i??t.body;return LY(c,s,r??void 0,o,a)},DY=(t,e)=>{const n=[{body:t,mimetype:"text/plain"}];return p4(e)&&n.push({body:e,mimetype:"text/html"}),{topic:t,[m4.name]:n}},Iwe=t=>{var i,s;const e=m4.findIn(t);if(!Array.isArray(e))return{text:t.topic};const n=((i=e==null?void 0:e.find(o=>!p4(o.mimetype)||o.mimetype==="text/plain"))==null?void 0:i.body)??t.topic,r=(s=e==null?void 0:e.find(o=>o.mimetype==="text/html"))==null?void 0:s.body;return{text:n,html:r}},xwe=(t,e,n,r,i)=>({description:n,timeout:t,live:e,[wf.name]:i||Date.now(),[fb.name]:{type:r??zh.Self}}),NY=t=>{const{description:e,timeout:n,live:r}=t,i=wf.findIn(t)??void 0,s=fb.findIn(t);return{description:e,timeout:n,live:r,assetType:s==null?void 0:s.type,timestamp:i}},Pwe=(t,e,n,r)=>({[hb.name]:{description:r,uri:t},[wf.name]:e,"m.relates_to":{rel_type:kY.name,event_id:n}}),W6=t=>{const e=hb.findIn(t),n=wf.findIn(t)??void 0;return{description:e==null?void 0:e.description,uri:e==null?void 0:e.uri,timestamp:n}},Owe=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:AY,makeBeaconContent:Pwe,makeBeaconInfoContent:xwe,makeEmoteMessage:MY,makeHtmlEmote:xY,makeHtmlMessage:RY,makeHtmlNotice:IY,makeLocationContent:LY,makeNotice:OY,makeTextMessage:PY,makeTopicContent:DY,parseBeaconContent:W6,parseBeaconInfoContent:NY,parseLocationEvent:Rwe,parseTopicContent:Iwe},Symbol.toStringTag,{value:"Module"}));var _r=(t=>(t.New="Beacon.new",t.Update="Beacon.update",t.LivenessChange="Beacon.LivenessChange",t.Destroy="Beacon.Destroy",t.LocationUpdate="Beacon.LocationUpdate",t))(_r||{});const Y6=(t,e,n)=>n>=t&&t+e>=n,cC=t=>`${t.getRoomId()}_${t.getStateKey()}`;class UY extends Fn{constructor(e){super(),this.rootEvent=e,this.clearLatestLocation=()=>{this._latestLocationEvent=void 0,this.emit("Beacon.LocationUpdate",this.latestLocationState)},this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return cC(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&W6(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(cC(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit("Beacon.update",e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit("Beacon.Destroy",this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),!!this.beaconInfo)if(this.isLive){const e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var i;if(!this.isLive)return;const r=(i=e.filter(s=>{const o=s.getContent(),a=W6(o);if(!a.uri||!a.timestamp)return!1;const{timestamp:c}=a;return this._beaconInfo.timestamp&&Y6(this._beaconInfo.timestamp,this._beaconInfo.timeout,c)&&(!this.latestLocationState||c>this.latestLocationState.timestamp)}).sort(H_e))==null?void 0:i[0];r&&(this._latestLocationEvent=r,this.emit("Beacon.LocationUpdate",this.latestLocationState))}setBeaconInfo(e){this._beaconInfo=NY(e.getContent()),this.checkLiveness()}checkLiveness(){const e=this.isLive;if(!this.beaconInfo)return;const n=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!n&&Y6(n,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit("Beacon.LivenessChange",this.isLive,this)}}function $Y(t,e,n,r=!1){return new oi({content:{[e.getId()]:{[n]:{[t]:{ts:e.getTs(),...!r&&{thread_id:tv(e)}}}}},type:Z.Receipt,room_id:e.getRoomId()})}const lg=0,ug=1;class FY extends Fn{constructor(){super(...arguments),this.receipts=new fr(()=>new Map),this.receiptCacheByEventId=new Map}getReadReceiptForUserId(e,n=!1,r=Wi.Read){var o;const[i,s]=((o=this.receipts.get(r))==null?void 0:o.get(e))??[null,null];return n?i:s??i}compareReceipts(e,n){return this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,n.eventId)??e.data.ts-n.data.ts}getEventReadUpTo(e,n=!1){const r=this.getLatestReceipt(e,n);return r&&this.receiptPointsAtConsistentEvent(r)?r.eventId:null}receiptPointsAtConsistentEvent(e){var r;const n=this.findEventById(e.eventId);if(!n)return!1;if(!((r=e.data)!=null&&r.thread_id))return!0;if(e.data.thread_id===pb){if(Q0(n))return!0}else if(n.threadRootId===e.data.thread_id)return!0;return k.warn(`Ignoring receipt because its thread_id (${e.data.thread_id}) disagrees with the thread root (${n.threadRootId}) of the referenced event (event ID = ${e.eventId})`),!1}getLatestReceipt(e,n){const r=this.getReadReceiptForUserId(e,n,Wi.Read),i=this.getReadReceiptForUserId(e,n,Wi.ReadPrivate);let s;return r!=null&&r.eventId&&(i!=null&&i.eventId)&&(s=this.compareReceipts(r,i)),s?(s<0?i:r)??null:i??r??null}addReceiptToStructure(e,n,r,i,s){const o=this.receipts.getOrCreate(n);let a=o.get(r);a||(a=[null,null],o.set(r,a));let c=a[lg];s&&(c=a[ug]??a[lg]);const l={eventId:e,data:i};if(c&&this.compareReceipts(c,l)>=0)return;const u=s?a[lg]:l,d=s?l:a[ug];let f=null;u&&d&&(f=this.getUnfilteredTimelineSet().compareEventOrdering(u.eventId,d.eventId));const p=f===null||f<0,m=a[ug]??a[lg];s&&p?a[ug]=l:s||(a[lg]=l,p||(a[ug]=null));const v=a[ug]??a[lg];if(m!==v){if(m&&this.receiptCacheByEventId.get(m.eventId)){const S=m.eventId;this.receiptCacheByEventId.set(S,this.receiptCacheByEventId.get(S).filter(_=>_.type!==n||_.userId!==r)),this.receiptCacheByEventId.get(S).length<1&&this.receiptCacheByEventId.delete(S)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:r,type:n,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){const n=this.getReadReceiptForUserId(e,!1),r=this.timeline[this.timeline.length-1];r&&(n==null?void 0:n.eventId)===r.getId()&&e===r.getSender()&&(this.setUnread(xr.Total,0),this.setUnread(xr.Highlight,0))}addLocalEchoReceipt(e,n,r,i=!1){this.addReceipt($Y(e,n,r,i),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(n){return l4(n.type)}).map(function(n){return n.userId})}}const Mwe=new ws.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),Awe=new ws.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),Lwe=new ws.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),z0=new ws.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),lC=new ws.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");var v4=(t=>(t.New="Poll.new",t.End="Poll.end",t.Update="Poll.update",t.Responses="Poll.Responses",t.Destroy="Poll.Destroy",t.UndecryptableRelations="Poll.UndecryptableRelations",t))(v4||{});const uF=(t,e)=>({responseEvents:t.filter(r=>{if(!r.isDecryptionFailure())return z0.matches(r.getType())&&r.getTs()<=e})});class BY extends Fn{constructor(e,n,r){if(super(),this.rootEvent=e,this.matrixClient=n,this.room=r,this._isFetchingResponses=!1,this.responses=null,this.undecryptableRelationEventIds=new Set,this.countUndecryptableEvents=i=>{const s=i.filter(a=>a.isDecryptionFailure()).map(a=>a.getId()),o=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...s]),this.undecryptableRelationsCount!==o&&this.emit("Poll.UndecryptableRelations",this.undecryptableRelationsCount)},!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return(e=this.endEvent)==null?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}async getResponses(){return this.responses?this.responses:(this.isFetchingResponses||await this.fetchResponses(),this.responses)}onNewRelation(e){var i;if(lC.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit("Poll.end")),!this.responses)return;const n=((i=this.endEvent)==null?void 0:i.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:r}=uF([e],n);this.countUndecryptableEvents([e]),r.length&&(r.forEach(s=>{this.responses.addEvent(s)}),this.emit("Poll.Responses",this.responses))}async fetchResponses(){var o;this._isFetchingResponses=!0;const e=await this.matrixClient.relations(this.roomId,this.rootEvent.getId(),"m.reference",void 0,{from:this.relationsNextBatch||void 0});await Promise.all(e.events.map(a=>this.matrixClient.decryptEventIfNeeded(a)));const n=this.responses||new h4("m.reference",z0.name,this.matrixClient,[z0.altName]),r=e.events.find(a=>lC.matches(a.getType()));this.validateEndEvent(r)&&(this.endEvent=r,this.refilterResponsesOnEnd(),this.emit("Poll.end"));const i=((o=this.endEvent)==null?void 0:o.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:s}=uF(e.events,i);s.forEach(a=>{n.addEvent(a)}),this.relationsNextBatch=e.nextBatch??void 0,this.responses=n,this.countUndecryptableEvents(e.events),this.relationsNextBatch?this.fetchResponses():this._isFetchingResponses=!1,this.emit("Poll.Responses",this.responses)}refilterResponsesOnEnd(){var n;if(!this.responses)return;const e=((n=this.endEvent)==null?void 0:n.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(r=>{var i;r.getTs()>e&&((i=this.responses)==null||i.removeEvent(r))}),this.emit("Poll.Responses",this.responses)}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;const n=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||n.maySendRedactionForEvent(this.rootEvent,r))}}const jY=t=>{const e=t.getType();return ws.M_POLL_START.matches(e)||z0.matches(e)||lC.matches(e)};class Dwe{constructor(e){this.onTimelineEvent=n=>{const r=n.getId();if(!r)return;const i=this.danglingReceipts.remove(r);i==null||i.forEach(s=>{s.receipt.thread_id?this.threadedReceipts.set(s.receipt.thread_id,s.eventId,s.receiptType,s.userId,s.receipt.ts,s.synthetic):this.unthreadedReceipts.set(r,s.receiptType,s.userId,s.receipt.ts,s.synthetic)})},this.room=e,this.threadedReceipts=new Fwe(e),this.unthreadedReceipts=new HY(e),this.danglingReceipts=new Bwe,e.on(ct.Timeline,this.onTimelineEvent)}add(e,n){for(const[r,i]of Object.entries(e))for(const[s,o]of Object.entries(i))for(const[a,c]of Object.entries(o))this.room.findEventById(r)?c.thread_id?this.threadedReceipts.set(c.thread_id,r,s,a,c.ts,n):this.unthreadedReceipts.set(r,s,a,c.ts,n):this.danglingReceipts.add(new Uwe(r,s,a,c,n))}hasUserReadEvent(e,n){const r=this.unthreadedReceipts.get(e);if(r&&J6(r.eventId,n,this.room))return!0;const i=this.room.findEventById(n);if(!i)return k.warn(`hasUserReadEvent event ID ${n} not found in room ${this.room.roomId}: this shouldn't happen!`),!1;const s=tv(i),o=this.threadedReceipts.get(s,e);return!!(o&&J6(o.eventId,n,this.room)||this.userSentLatestEventInThread(s,e))}userSentLatestEventInThread(e,n){var i;const r=e===pb?this.room.getLiveTimeline().getEvents():(i=this.room.getThread(e))==null?void 0:i.timeline;return!!(r&&r.length>0&&r[r.length-1].getSender()===n)}}class Nwe{constructor(e,n,r){this.eventId=e,this.receiptType=n,this.ts=r}}class Uwe{constructor(e,n,r,i,s){this.eventId=e,this.receiptType=n,this.userId=r,this.receipt=i,this.synthetic=s}}class $we{constructor(e){this.room=e,this.real=void 0,this.synthetic=void 0}set(e,n){e?this.synthetic=n:this.real=n,this.synthetic&&this.real&&J6(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){return this.synthetic??this.real}getByType(e){return e?this.synthetic:this.real}}class HY{constructor(e){this.room=e,this.data=new Map}set(e,n,r,i,s){const o=y4(this.data,r,()=>new $we(this.room)),a=o.getByType(s);a&&jwe(a.eventId,e,this.room)||o.set(s,new Nwe(e,n,i))}get(e){var n;return(n=this.data.get(e))==null?void 0:n.get()}}class Fwe{constructor(e){this.room=e,this.data=new Map}set(e,n,r,i,s,o){y4(this.data,e,()=>new HY(this.room)).set(n,r,i,s,o)}get(e,n){var r;return(r=this.data.get(e))==null?void 0:r.get(n)}}class Bwe{constructor(){this.data=new Map}add(e){y4(this.data,e.eventId,()=>[]).push(e)}remove(e){const n=this.data.get(e);return this.data.delete(e),n}}function y4(t,e,n){const r=t.get(e);if(r)return r;{const i=n();return t.set(e,i),i}}function J6(t,e,n){const r=n.compareEventOrdering(t,e);return r!==null&&r>=0}function jwe(t,e,n){const r=n.compareEventOrdering(t,e);return r!==null&&r>0}function Hwe(t,e,n){const r=t.findEventById(e),i=t.findEventById(n);if(!r||!i)return null;const s=Q0(r),o=Q0(i);return s&&o?Kwe(t,e,n,r,i):Vwe(e,n,r,i)}function Kwe(t,e,n,r,i){const s=t.getUnfilteredTimelineSet(),o=s.compareEventOrdering(e,n);return o!==null?o:s.getTimelineForEvent(e)===s.getLiveTimeline()?1:s.getTimelineForEvent(n)===s.getLiveTimeline()?-1:KY(r,i)}function Vwe(t,e,n,r){const i=tv(n),s=tv(r),o=n.getThread();return o&&i===s?o.timelineSet.compareEventOrdering(t,e):KY(n,r)}function KY(t,e){const n=t.getTs(),r=e.getTs();return n<r?-1:n>r?1:0}var oe=(t=>(t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE",t.Options="OPTIONS",t.Head="HEAD",t.Patch="PATCH",t))(oe||{});class uC extends Error{constructor(e,n){super(e),this.httpStatus=n}}class Ii extends uC{constructor(e={},n,r,i){let s=e.error||"Unknown message";n&&(s=`[${n}] ${s}`),r&&(s=`${s} (${r})`),super(`MatrixError: ${s}`,n),this.httpStatus=n,this.url=r,this.event=i,this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.data=e}}let Sb=class extends Error{constructor(e,n){super(e+(n?`: ${n.message}`:""))}get name(){return"ConnectionError"}};var dC=(t=>(t.SessionLoggedOut="Session.logged_out",t.NoConsent="no_consent",t))(dC||{});/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var dF=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,qwe=/\\([\u000b\u0020-\u00ff])/g,Gwe=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,zwe=Wwe;function Wwe(t){if(!t)throw new TypeError("argument string is required");var e=typeof t=="object"?Ywe(t):t;if(typeof e!="string")throw new TypeError("argument string is required to be a string");var n=e.indexOf(";"),r=n!==-1?e.slice(0,n).trim():e.trim();if(!Gwe.test(r))throw new TypeError("invalid media type");var i=new Jwe(r.toLowerCase());if(n!==-1){var s,o,a;for(dF.lastIndex=n;o=dF.exec(e);){if(o.index!==n)throw new TypeError("invalid parameter format");n+=o[0].length,s=o[1].toLowerCase(),a=o[2],a.charCodeAt(0)===34&&(a=a.slice(1,-1),a.indexOf("\\")!==-1&&(a=a.replace(qwe,"$1"))),i.parameters[s]=a}if(n!==e.length)throw new TypeError("invalid parameter format")}return i}function Ywe(t){var e;if(typeof t.getHeader=="function"?e=t.getHeader("content-type"):typeof t.headers=="object"&&(e=t.headers&&t.headers["content-type"]),typeof e!="string")throw new TypeError("content-type header is missing from object");return e}function Jwe(t){this.parameters=Object.create(null),this.type=t}function N2(t){const e=new AbortController;return setTimeout(()=>{e.abort()},t),e.signal}function VY(t){const e=new AbortController;function n(){for(const i of t)i.removeEventListener("abort",r)}function r(){e.abort(),n()}for(const i of t){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:e.signal,cleanup:n}}function _4(t,e){let n;try{n=Xwe(t)}catch(r){return r}return(n==null?void 0:n.type)==="application/json"&&e?new Ii(JSON.parse(e),t.status,qY(t)?t.responseURL:t.url):(n==null?void 0:n.type)==="text/plain"?new uC(`Server returned ${t.status} error: ${e}`,t.status):new uC(`Server returned ${t.status} error`,t.status)}function qY(t){return"getResponseHeader"in t}function Xwe(t){let e;if(qY(t)?e=t.getResponseHeader("Content-Type"):e=t.headers.get("Content-Type"),!e)return null;try{return zwe(e)}catch(n){throw new Error(`Error parsing Content-Type '${e}': ${n}`)}}async function GY(t,e){let n=0,r=null;for(;n<t;)try{if(n>0){const i=1e3*Math.pow(2,n);k.log(`network operation failed ${n} times, retrying in ${i}ms...`),await Jm(i)}return await e()}catch(i){if(i instanceof Sb)n+=1,r=i;else throw i}throw r}function zY(t,e,n){if(e>4||t instanceof Sb&&!n||t.httpStatus&&(t.httpStatus===400||t.httpStatus===403||t.httpStatus===401)||t.name==="AbortError"||t.name==="M_TOO_LARGE")return-1;if(t.name==="M_LIMIT_EXCEEDED"){const r=t.data.retry_after_ms;if(r>0)return r}return 1e3*Math.pow(2,e)}class Zwe{constructor(e,n){this.eventEmitter=e,this.opts=n,this.abortController=new AbortController,qW(n,["baseUrl","prefix"]),n.onlyData=!!n.onlyData,n.useAuthorizationHeader=n.useAuthorizationHeader??!0}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,n){return this.opts.fetchFn?this.opts.fetchFn(e,n):global.fetch(e,n)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,n,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");let o,a;e===oe.Get?o=r:a=r;const c=this.getUrl(n,o,i,this.opts.idBaseUrl),l={json:!0,headers:{}};return s&&(l.headers.Authorization=`Bearer ${s}`),this.requestOtherUrl(e,c,a,l)}async authedRequest(e,n,r,i,s={}){r||(r={});const o={...s};this.opts.accessToken&&(this.opts.useAuthorizationHeader?(o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),r.access_token&&delete r.access_token):r.access_token||(r.access_token=this.opts.accessToken));try{return await this.request(e,n,r,i,o)}catch(a){const c=a;if(c.errcode==="M_UNKNOWN_TOKEN"&&!o.doNotAttemptTokenRefresh&&await this.tryRefreshToken())return this.authedRequest(e,n,r,i,{...s,doNotAttemptTokenRefresh:!0});throw c.errcode=="M_UNKNOWN_TOKEN"&&!(o!=null&&o.inhibitLogoutEmit)?this.eventEmitter.emit(dC.SessionLoggedOut,c):c.errcode=="M_CONSENT_NOT_GIVEN"&&this.eventEmitter.emit(dC.NoConsent,c.message,c.data.consent_uri),c}}async tryRefreshToken(){var e;if(!this.opts.refreshToken||!this.opts.tokenRefreshFunction)return!1;try{const{accessToken:n,refreshToken:r}=await this.opts.tokenRefreshFunction(this.opts.refreshToken);return this.opts.accessToken=n,this.opts.refreshToken=r,!0}catch(n){return(e=this.opts.logger)==null||e.warn("Failed to refresh token",n),!1}}request(e,n,r,i,s){const o=this.getUrl(n,r,s==null?void 0:s.prefix,s==null?void 0:s.baseUrl);return this.requestOtherUrl(e,o,i,s)}async requestOtherUrl(e,n,r,i={}){var _,w,T,C;const s=this.sanitizeUrlForLogs(n);(_=this.opts.logger)==null||_.debug(`FetchHttpApi: --> ${e} ${s}`);const o=Object.assign({},i.headers||{}),a=i.json??!0,c=a&&((w=r==null?void 0:r.constructor)==null?void 0:w.name)===Object.name;a&&(c&&!o["Content-Type"]&&(o["Content-Type"]="application/json"),o.Accept||(o.Accept="application/json"));const l=i.localTimeoutMs??this.opts.localTimeoutMs,u=i.keepAlive??!1,d=[this.abortController.signal];l!==void 0&&d.push(N2(l)),i.abortSignal&&d.push(i.abortSignal);let f;c?f=JSON.stringify(r):f=r;const{signal:p,cleanup:m}=VY(d);let v;const S=Date.now();try{v=await this.fetch(n,{signal:p,method:e,body:f,headers:o,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:"no-cache",credentials:"omit",keepalive:u,priority:i.priority}),(T=this.opts.logger)==null||T.debug(`FetchHttpApi: <-- ${e} ${s} [${Date.now()-S}ms ${v.status}]`)}catch(I){throw(C=this.opts.logger)==null||C.debug(`FetchHttpApi: <-- ${e} ${s} [${Date.now()-S}ms ${I}]`),I.name==="AbortError"?I:new Sb("fetch failed",I)}finally{m()}if(!v.ok)throw _4(v,await v.text());return this.opts.onlyData?a?v.json():v.text():v}sanitizeUrlForLogs(e){try{let n;typeof e=="string"?n=new URL(e):n=e;const r=new URLSearchParams;for(const o of n.searchParams.keys())r.append(o,"xxx");const i=r.toString(),s=i?`?${i}`:"";return n.origin+n.pathname+s}catch{return"??"}}getUrl(e,n,r,i){const s=i??this.opts.baseUrl,o=s.endsWith("/")?s.slice(0,-1):s,a=new URL(o+(r??this.opts.prefix)+e);return n&&XT(n,a.searchParams),a}}var Nn=(t=>(t.V1="/_matrix/client/v1",t.V3="/_matrix/client/v3",t.Unstable="/_matrix/client/unstable",t))(Nn||{}),Oc=(t=>(t.V2="/_matrix/identity/v2",t))(Oc||{}),Oh=(t=>(t.V1="/_matrix/media/v1",t.V3="/_matrix/media/v3",t))(Oh||{});const Qwe=1e3;let eEe=0,h3;const ou=[],tEe=function(...t){};function fF(t,e,...n){e=e||0,e<0&&(e=0);const r=Date.now()+e,i=eEe++,s={runAt:r,func:t,params:n,key:i},o=rEe(ou,function(a){return a.runAt-r});return ou.splice(o,0,s),b4(),i}function hF(t){if(ou.length===0)return;let e;for(e=0;e<ou.length;e++)if(ou[e].key==t){ou.splice(e,1);break}e===0&&b4()}function b4(){h3&&global.clearTimeout(h3);const t=ou[0];if(!t)return;const e=Date.now(),n=Math.min(t.runAt-e,Qwe);h3=global.setTimeout(nEe,n)}function nEe(){const t=Date.now(),e=[];for(;;){const n=ou[0];if(!n||n.runAt>t)break;const r=ou.shift();tEe("runCallbacks: popping",r.key),e.push(r)}b4();for(const n of e)try{n.func.apply(global,n.params)}catch(r){k.error("Uncaught exception in callback function",r)}}function rEe(t,e){let n=0,r=t.length;for(;n<r;){const i=n+r>>1;e(t[i])>0?r=i:n=i+1}return n}class WY extends Zwe{constructor(){super(...arguments),this.uploads=[]}uploadContent(e,n={}){const r=n.includeFilename??!0,i=n.abortController??new AbortController,s=(n.type??e.type)||"application/octet-stream",o=n.name??e.name,a={loaded:0,total:0,abortController:i},c=Ef();if(global.XMLHttpRequest){const l=new global.XMLHttpRequest,u=function(){l.abort(),c.reject(new Error("Timeout"))};let d=fF(u,3e4);l.onreadystatechange=function(){switch(l.readyState){case global.XMLHttpRequest.DONE:hF(d);try{if(l.status===0)throw new DOMException(l.statusText,"AbortError");if(!l.responseText)throw new Error("No response body.");l.status>=400?c.reject(_4(l,l.responseText)):c.resolve(JSON.parse(l.responseText))}catch(p){if(p.name==="AbortError"){c.reject(p);return}c.reject(new Sb("request failed",p))}break}},l.upload.onprogress=p=>{var m;hF(d),a.loaded=p.loaded,a.total=p.total,d=fF(u,3e4),(m=n.progressHandler)==null||m.call(n,{loaded:p.loaded,total:p.total})};const f=this.getUrl("/upload",void 0,Oh.V3);r&&o&&f.searchParams.set("filename",encodeURIComponent(o)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&f.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),l.open(oe.Post,f.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&l.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),l.setRequestHeader("Content-Type",s),l.send(e),i.signal.addEventListener("abort",()=>{l.abort()})}else{const l={};r&&o&&(l.filename=o);const u={"Content-Type":s};this.authedRequest(oe.Post,"/upload",l,e,{prefix:Oh.V3,headers:u,abortSignal:i.signal}).then(d=>this.opts.onlyData?d:d.json()).then(c.resolve,c.reject)}return a.promise=c.promise.finally(()=>{ZT(this.uploads,l=>l===a)}),i.signal.addEventListener("abort",()=>{ZT(this.uploads,l=>l===a),c.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(a),a.promise}cancelUpload(e){const n=this.uploads.find(r=>r.promise===e);return n?(n.abortController.abort(),!0):!1}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:Oh.V3+"/upload",params:{access_token:this.opts.accessToken}}}}const iEe=6*60*60*1e3,sEe=30*1e3;var S4=(t=>(t.Stable="stable",t.Unstable="unstable",t))(S4||{});class YY{constructor(e){this.http=e,this.fetchCapabilities=async()=>{const n=await this.http.authedRequest(oe.Get,"/capabilities");return this.capabilities=n.capabilities,this.capabilities},this.poll=async()=>{try{await this.fetchCapabilities(),this.clearTimeouts(),this.refreshTimeout=setTimeout(this.poll,iEe),k.debug("Fetched new server capabilities")}catch(n){this.clearTimeouts();const r=Math.floor(sEe+Math.random()*5e3);this.retryTimeout=setTimeout(this.poll,r),k.warn(`Failed to refresh capabilities: retrying in ${r}ms`,n)}}}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}const JY="10",oEe=["1","2","3","4","5","6","7","8","9","10"],aEe=30;var xr=(t=>(t.Highlight="highlight",t.Total="total",t))(xr||{}),ct=(t=>(t.MyMembership="Room.myMembership",t.Tags="Room.tags",t.AccountData="Room.accountData",t.Receipt="Room.receipt",t.Name="Room.name",t.Redaction="Room.redaction",t.RedactionCancelled="Room.redactionCancelled",t.LocalEchoUpdated="Room.localEchoUpdated",t.Timeline="Room.timeline",t.TimelineReset="Room.timelineReset",t.TimelineRefresh="Room.TimelineRefresh",t.OldStateUpdated="Room.OldStateUpdated",t.CurrentStateUpdated="Room.CurrentStateUpdated",t.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",t.UnreadNotifications="Room.UnreadNotifications",t.Summary="Room.Summary",t))(ct||{});let U2=class extends FY{constructor(e,n,r,i={}){super(),this.roomId=e,this.client=n,this.myUserId=r,this.opts=i,this.txnToEvent=new Map,this.notificationCounts={},this.threadNotifications=new Map,this.cachedThreadReadReceipts=new Map,this.oldestThreadedReceiptTs=1/0,this.unthreadedReceipts=new Map,this.polls=new Map,this.threadsTimelineSets=[],this.filteredTimelineSets={},this.timelineNeedsRefresh=!1,this.summaryHeroes=null,this.getTypeWarning=!1,this.getVersionWarning=!1,this.tags={},this.accountData=new Map,this.summary=null,this.threads=new Map,this.visibilityEvents=new Map,this.roomReceipts=new Dwe(this),this.threadTimelineSetsPromise=null,this.threadsReady=!1,this.updateThreadRootEvents=(s,o,a)=>{var c,l;s.length&&(this.updateThreadRootEvent((c=this.threadsTimelineSets)==null?void 0:c[0],s,o,a),s.hasCurrentUserParticipated&&this.updateThreadRootEvent((l=this.threadsTimelineSets)==null?void 0:l[1],s,o,a))},this.updateThreadRootEvent=(s,o,a,c)=>{s&&o.rootEvent&&(c&&s.removeEvent(o.id),wi.hasServerSideSupport?s.addLiveEvent(o.rootEvent,{duplicateStrategy:Y1.Replace,fromCache:!1,roomState:this.currentState}):s.addEventToTimeline(o.rootEvent,s.getLiveTimeline(),{toStartOfTimeline:a}))},this.applyRedaction=s=>{if(s.isRedaction()){const o=s.event.redacts,a=o?this.findEventById(o):void 0;if(a){const c=a.threadRootId;if(a.makeRedacted(s,this),a.isState()){const l=this.currentState.getStateEvents(a.getType(),a.getStateKey());(l==null?void 0:l.getId())===a.getId()&&this.currentState.setStateEvents([a])}this.emit("Room.redaction",s,this,c),this.visibilityEvents.delete(o),a.isVisibilityEvent()&&this.redactVisibilityChangeEvent(s)}}},this.setMaxListeners(100),this.reEmitter=new Bv(this),i.pendingEventOrdering=i.pendingEventOrdering||Zh.Chronological,this.name=e,this.normalizedName=e,this.relations=new EY(this.client,this),this.on("Room.receipt",this.onReceipt),this.timelineSets=[new jg(this,i)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===Zh.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(s=>{const o=this.client.getEventMapper({toDevice:!1,decrypt:!1});s.forEach(async a=>{const c=o(a);await n.decryptEventIfNeeded(c),c.setStatus(Ze.NOT_SENT),this.addPendingEvent(c,c.getTxnId())})})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}async createThreadsTimelineSets(){var e;if(this.threadTimelineSetsPromise)return this.threadTimelineSetsPromise;if((e=this.client)!=null&&e.supportsThreads())try{this.threadTimelineSetsPromise=Promise.all([this.createThreadTimelineSet(),this.createThreadTimelineSet(Ka.My)]);const n=await this.threadTimelineSetsPromise;return this.threadsTimelineSets[0]=n[0],this.threadsTimelineSets[1]=n[1],n}catch{return this.threadTimelineSetsPromise=null,null}return null}async decryptCriticalEvents(){if(!this.client.isCryptoEnabled())return;const e=this.getEventReadUpTo(this.client.getUserId(),!0),n=this.getLiveTimeline().getEvents(),r=n.findIndex(s=>s.event.event_id===e),i=n.slice(r).reverse().map(s=>this.client.decryptEventIfNeeded(s));await Promise.allSettled(i)}async decryptAllEvents(){if(!this.client.isCryptoEnabled())return;const e=this.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(n=>this.client.decryptEventIfNeeded(n));await Promise.allSettled(e)}getCreator(){const e=this.currentState.getStateEvents(Z.RoomCreate,"");return(e==null?void 0:e.getSender())??null}getVersion(){const e=this.currentState.getStateEvents(Z.RoomCreate,"");return e?e.getContent().room_version??"1":(this.getVersionWarning||(k.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}async getRecommendedVersion(){let e={};try{e=await this.client.getCapabilities()}catch{}let n=e["m.room_versions"];if(!n){n={default:JY,available:{}};for(const i of oEe)n.available[i]=S4.Stable}let r=this.checkVersionAgainstCapability(n);if(r.urgent&&r.needsUpgrade){k.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{e=await this.client.fetchCapabilities()}catch(i){k.warn("Failed to refresh room version capabilities",i)}if(n=e["m.room_versions"],n)r=this.checkVersionAgainstCapability(n);else return k.warn("No room version capability - assuming upgrade required."),r}return r}checkVersionAgainstCapability(e){const n=this.getVersion();k.log(`[${this.roomId}] Current version: ${n}`),k.log(`[${this.roomId}] Version capability: `,e);const r={version:n,needsUpgrade:!1,urgent:!1};return n===e.default||Object.keys(e.available).filter(s=>e.available[s]==="stable").includes(n)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?k.warn(`URGENT upgrade required on ${this.roomId}`):k.warn(`Non-urgent upgrade required on ${this.roomId}`)),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(Z.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);const n=ZT(this.pendingEventList,function(r){return r.getId()==e},!1);return this.savePendingEvents(),n}hasPendingEvent(e){var n;return((n=this.pendingEventList)==null?void 0:n.some(r=>r.getId()===e))??!1}getPendingEvent(e){var n;return((n=this.pendingEventList)==null?void 0:n.find(r=>r.getId()===e))??null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){const n=this.getLiveTimeline().getEvents();return n.length?n[n.length-1].getTs():Number.MIN_SAFE_INTEGER}getLastLiveEvent(){const e=this.getLiveTimeline().getEvents(),n=e[e.length-1],r=this.getLastThread();if(!r)return n;const i=r.events[r.events.length-1];return((n==null?void 0:n.getTs())??0)>((i==null?void 0:i.getTs())??0)?n:i}getLastThread(){return this.getThreads().reduce((e,n)=>{if(!e)return n;const r=n.events[n.events.length-1],i=e.events[e.events.length-1];return((r==null?void 0:r.getTs())??0)>=((i==null?void 0:i.getTs())??0)?n:e},void 0)}getMyMembership(){return this.selfMembership??Ge.Leave}getDMInviter(){var n;const e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if(this.selfMembership===Ge.Invite&&this.getInvitedAndJoinedMemberCount()===2)return(n=this.summaryHeroes)==null?void 0:n[0]}guessDMUserId(){const e=this.getMember(this.myUserId);if(e){const i=e.getDMInviter();if(i)return i}if(Array.isArray(this.summaryHeroes)&&this.summaryHeroes.length)return this.summaryHeroes[0];const r=this.currentState.getMembers().find(i=>i.userId!==this.myUserId);return r?r.userId:this.myUserId}getFunctionalMembers(){const e=this.currentState.getStateEvents(aY.name,"");return Array.isArray(e==null?void 0:e.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var a;const e=this.getFunctionalMembers();let n=0;if(this.getMembers().forEach(c=>{c.membership!=="join"&&c.membership!=="invite"||e.includes(c.userId)||n++}),n>2)return;const r=(a=this.summaryHeroes)==null?void 0:a.filter(c=>!e.includes(c)),i=Array.isArray(r)&&r.length;if(i){const c=r.map(l=>this.getMember(l)).find(l=>!!l);if(c)return c}const s=this.getMembers(),o=s==null?void 0:s.filter(c=>!e.includes(c.userId));if(o.length<=2){const c=o.find(l=>l.userId!==this.myUserId);if(c)return c}if(i){const c=r.map(l=>this.client.getUser(l)).find(l=>!!l);if(c){const l=new nC(this.roomId,c.userId);return l.user=c,l}}}updateMyMembership(e){const n=this.selfMembership;this.selfMembership=e,n!==e&&(e===Ge.Leave&&this.cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,n))}async loadMembersFromServer(){const e=this.client.store.getSyncToken();return(await this.client.members(this.roomId,void 0,Ge.Leave,e??void 0)).chunk}async loadMembers(){let e=!1,n=await this.client.store.getOutOfBandMembers(this.roomId);return(n===null||this.hasEncryptionStateEvent())&&(e=!0,n=await this.loadMembersFromServer(),k.log(`LL: got ${n.length} members from server for room ${this.roomId}`)),{memberEvents:n.filter(Ya).map(this.client.getEventMapper()),fromServer:e}}membersLoaded(){return this.opts.lazyLoadMembers?this.currentState.outOfBandMembersReady():!0}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this.loadMembers().then(n=>(this.currentState.setOutOfBandMembers(n.memberEvents),n.fromServer)).catch(n=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),n});return e.then(n=>{if(n){const r=this.currentState.getMembers().filter(s=>s.isOutOfBand()).map(s=>{var o;return(o=s.events.member)==null?void 0:o.event});return k.log(`LL: telling store to write ${r.length} members for room ${this.roomId}`),this.client.store.setOutOfBandMembers(this.roomId,r).catch(s=>{k.log("LL: storing OOB room members failed, oh well",s)})}}).catch(n=>{k.error(n)}),this.membersPromise=e,this.membersPromise}async clearLoadedMembersIfNeeded(){this.opts.lazyLoadMembers&&this.membersPromise&&(await this.loadMembersIfNeeded(),await this.client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this.membersPromise=void 0)}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{k.error(`error after clearing loaded members from room ${this.roomId} after leaving`),k.log(e)})}async refreshLiveTimeline(){const e=this.getLiveTimeline(),n=e.getPaginationToken(He.FORWARDS),r=e.getPaginationToken(He.BACKWARDS),i=e.getEvents(),s=i[i.length-1];k.log(`[refreshLiveTimeline for ${this.roomId}] at mostRecentEventInTimeline=${s&&s.getId()} liveTimelineBefore=${e.toString()} forwardPaginationToken=${n} backwardPaginationToken=${r}`);const o=this.getUnfilteredTimelineSet();let a;s?(this.resetLiveTimeline(null,null),this.emit("Room.TimelineRefresh",this,o),a=await this.client.getEventTimeline(o,s.getId())):a=await this.client.getLatestTimeline(o);const c=o.getLiveTimeline();!c||c.getPaginationToken(It.Forward)===null&&c.getPaginationToken(It.Backward)===null&&c.getEvents().length===0?(k.log(`[refreshLiveTimeline for ${this.roomId}] using our new live timeline`),a.setPaginationToken(n,He.FORWARDS),o.setLiveTimeline(a),this.fixUpLegacyTimelineFields()):k.log(`[refreshLiveTimeline for ${this.roomId}] \`/sync\` or some other request beat us to creating a new live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history.`),this.setTimelineNeedsRefresh(!1),this.emit("Room.TimelineRefresh",this,o)}resetLiveTimeline(e,n){for(const r of this.timelineSets)r.resetLiveTimeline(e??void 0,n??void 0);for(const r of this.threads.values())r.resetLiveTimeline(e,n);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){const e=this.oldState,n=this.currentState;this.oldState=this.getLiveTimeline().getState(He.BACKWARDS),this.currentState=this.getLiveTimeline().getState(He.FORWARDS),e!==this.oldState&&this.emit("Room.OldStateUpdated",this,e,this.oldState),n!==this.currentState&&(this.emit("Room.CurrentStateUpdated",this,n,this.currentState),this.reEmitter.stopReEmitting(n,[xt.Events,xt.Members,xt.NewMember,xt.Update,xt.Marker,_r.New,_r.Update,_r.Destroy,_r.LivenessChange]),this.reEmitter.reEmit(this.currentState,[xt.Events,xt.Members,xt.NewMember,xt.Update,xt.Marker,_r.New,_r.Update,_r.Destroy,_r.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var s,o;let n=[],r=!1;const i=e.getContent();for(const a of Object.values(i))for(const[c,l]of Object.entries(a))if(l4(c)&&l)for(const[u,d]of Object.entries(l)){if(!d||typeof d!="object")continue;const f=d;u===this.client.getUserId()&&(f.thread_id===void 0?r=!0:typeof f.thread_id=="string"&&n.push(f.thread_id))}r&&(n=this.getThreads().filter(a=>this.getThreadUnreadNotificationCount(a.id,"total")>0||this.getThreadUnreadNotificationCount(a.id,"highlight")>0).map(a=>a.id),n.push("main"));for(const a of n){const l=a==="main"?this.getLiveTimeline():(s=this.getThread(a))==null?void 0:s.liveTimeline;if(!l){k.warn(`Couldn't find timeline for thread ID ${a} in room ${this.roomId}`);continue}const u=l.getEvents();let d=0;for(let f=u.length-1;f>=0;f--){if(f===u.length-20)return;const p=u[f];if(this.hasUserReadEvent(this.client.getUserId(),p.getId()))break;const m=this.client.getPushActionsForEvent(p);d+=(o=m==null?void 0:m.tweaks)!=null&&o.highlight?1:0}a==="main"?this.setUnreadNotificationCount("highlight",d):this.setThreadUnreadNotificationCount(a,"highlight",d)}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){const n=this.findEventById(e),r=this.findThreadForEvent(n);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){let n=this.getUnfilteredTimelineSet().findEventById(e);if(!n){const r=this.getThreads();for(let i=0;i<r.length;i++)if(n=r[i].findEventById(e),n)return n}return n}getUnreadNotificationCount(e="total"){let n=this.getRoomUnreadNotificationCount(e);for(const r of this.threadNotifications.values())n+=r[e]??0;return n}getUnreadCountForEventContext(e="total",n){return(!!n.threadRootId&&!n.isThreadRoot?this.getThreadUnreadNotificationCount(n.threadRootId,e):this.getRoomUnreadNotificationCount(e))??0}getRoomUnreadNotificationCount(e="total"){return this.notificationCounts[e]??0}getThreadUnreadNotificationCount(e,n="total"){var r;return((r=this.threadNotifications.get(e))==null?void 0:r[n])??0}hasThreadUnreadNotification(){for(const e of this.threadNotifications.values())if((e.highlight??0)>0||(e.total??0)>0)return!0;return!1}setThreadUnreadNotificationCount(e,n,r){var s,o;const i={highlight:(s=this.threadNotifications.get(e))==null?void 0:s.highlight,total:(o=this.threadNotifications.get(e))==null?void 0:o.total,[n]:r};this.threadNotifications.set(e,i),this.emit("Room.UnreadNotifications",i,e)}get threadsAggregateNotificationType(){let e=null;for(const n of this.threadNotifications.values()){if((n.highlight??0)>0)return"highlight";(n.total??0)>0&&!e&&(e="total")}return e}resetThreadUnreadNotificationCountFromSync(e=[]){const n=this.hasEncryptionStateEvent();for(const[r,i]of this.threadNotifications)e.includes(r)||(i.total=0,n||(i.highlight=0));this.emit("Room.UnreadNotifications")}setUnreadNotificationCount(e,n){this.notificationCounts[e]=n,this.emit("Room.UnreadNotifications",this.notificationCounts)}setUnread(e,n){return this.setUnreadNotificationCount(e,n)}setSummary(e){const n=e["m.heroes"],r=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(r)&&this.currentState.setJoinedMemberCount(r),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(n)&&(this.summaryHeroes=n.filter(s=>s!==this.myUserId)),this.emit("Room.Summary",e)}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices===void 0?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,n,r,i,s=!0){const o=this.currentState.getStateEvents(Z.RoomAvatar,"");if(!o&&!s)return null;const a=o?o.getContent().url:null;return a?P2(e,a,n,r,i):null}getMxcAvatarUrl(){var e,n;return((n=(e=this.currentState.getStateEvents(Z.RoomAvatar,""))==null?void 0:e.getContent())==null?void 0:n.url)||null}getCanonicalAlias(){const e=this.currentState.getStateEvents(Z.RoomCanonicalAlias,"");return e&&e.getContent().alias||null}getAltAliases(){const e=this.currentState.getStateEvents(Z.RoomCanonicalAlias,"");return e?e.getContent().alt_aliases||[]:[]}addEventsToTimeline(e,n,r,i){r.getTimelineSet().addEventsToTimeline(e,n,r,i)}getThread(e){return this.threads.get(e)??null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(Ge.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(n){return n.membership===e})}async getEncryptionTargetMembers(){await this.loadMembersIfNeeded();let e=this.getMembersWithMembership(Ge.Join);return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership(Ge.Invite))),e}shouldEncryptForInvitedMembers(){var n;const e=this.currentState.getStateEvents(Z.RoomHistoryVisibility,"");return((n=e==null?void 0:e.getContent())==null?void 0:n.history_visibility)!=="joined"}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,n){const r=this.getMember(e);return r?r.membership===n:!1}getOrCreateFilteredTimelineSet(e,{prepopulateTimeline:n=!0,useSyncEvents:r=!0,pendingEvents:i=!0}={}){if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];const s=Object.assign({filter:e,pendingEvents:i},this.opts),o=new jg(this,s);this.reEmitter.reEmit(o,["Room.timeline","Room.timelineReset"]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));const a=this.getLiveTimeline();if(n){a.getEvents().forEach(function(l){o.addLiveEvent(l)});let c=a;for(;c.getNeighbouringTimeline(He.BACKWARDS);)c=c.getNeighbouringTimeline(He.BACKWARDS);o.getLiveTimeline().setPaginationToken(c.getPaginationToken(He.BACKWARDS),He.BACKWARDS)}else if(r){const c=a.getPaginationToken(It.Forward);o.getLiveTimeline().setPaginationToken(c,It.Backward)}return o}async getThreadListFilter(e=Ka.All){const n=this.client.getUserId(),r=new _o(n),i={room:{timeline:{[mm.name]:[hn.name]}}};e===Ka.My&&(i.room.timeline[gm.name]=[n]),r.setDefinition(i);const s=await this.client.getOrCreateFilter(`THREAD_PANEL_${this.roomId}_${e}`,r);return r.filterId=s,r}async createThreadTimelineSet(e){let n;if(wi.hasServerSideListSupport)n=new jg(this,{...this.opts,pendingEvents:!1},void 0,void 0,e??Ka.All),this.reEmitter.reEmit(n,["Room.timeline","Room.timelineReset"]);else if(wi.hasServerSideSupport){const r=await this.getThreadListFilter(e);n=this.getOrCreateFilteredTimelineSet(r,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else n=new jg(this,{pendingEvents:!1}),Array.from(this.threads).forEach(([,r])=>{if(r.length===0)return;const i=r.timeline.some(s=>s.getSender()===this.client.getUserId());(e!==Ka.My||i)&&n.getLiveTimeline().addEvent(r.rootEvent,{toStartOfTimeline:!1})});return n}processThreadRoots(e,n){if(this.client.supportsThreads())for(const r of e)He.setEventMetadata(r,this.currentState,n),this.getThread(r.getId())||this.createThread(r.getId(),r,[],n)}async fetchRoomThreads(){var e,n;if(!(this.threadsReady||!this.client.supportsThreads())){if(wi.hasServerSideListSupport)await Promise.all([this.fetchRoomThreadList(Ka.All),this.fetchRoomThreadList(Ka.My)]);else{const r=await this.getThreadListFilter(),{chunk:i}=await this.client.createMessagesRequest(this.roomId,"",Number.MAX_SAFE_INTEGER,It.Backward,r);if(!i.length)return;const s=i.map(this.client.getEventMapper()).sort((c,l)=>{const u=c.getServerAggregatedRelation(hn.name),d=l.getServerAggregatedRelation(hn.name);return u.latest_event.origin_server_ts-d.latest_event.origin_server_ts});let o;const a=this.getLiveTimeline().getState(He.FORWARDS);for(const c of s){const l={duplicateStrategy:Y1.Ignore,fromCache:!1,roomState:a};(e=this.threadsTimelineSets[0])==null||e.addLiveEvent(c,l);const u=c.getServerAggregatedRelation(hn.name);u!=null&&u.current_user_participated&&((n=this.threadsTimelineSets[1])==null||n.addLiveEvent(c,l),o=c)}this.processThreadRoots(s,!0),this.client.decryptEventIfNeeded(s[s.length-1]),o&&this.client.decryptEventIfNeeded(o)}this.on(Ga.NewReply,this.onThreadReply),this.on(Ga.Update,this.onThreadUpdate),this.on(Ga.Delete,this.onThreadDelete),this.threadsReady=!0}}async processPollEvents(e){for(const n of e)try{if(!n.isEncrypted()&&!jY(n))continue;await this.client.decryptEventIfNeeded(n),this.processPollEvent(n)}catch(r){k.warn("Error processing poll event",n.getId(),r)}}async processPollEvent(e){if(e.isDecryptionFailure()){e.once(sn.Decrypted,r=>{this.processPollEvent(r)});return}if(ws.M_POLL_START.matches(e.getType())){try{const r=new BY(e,this.client,this);this.polls.set(e.getId(),r),this.emit(v4.New,r),e.once(sn.BeforeRedaction,i=>{this.polls.delete(i.getId())})}catch{}return}const n=e.relationEventId;if(n&&this.polls.has(n)){const r=this.polls.get(n);r==null||r.onNewRelation(e)}}async fetchRoomThreadList(e){if(!this.client.supportsThreads()||this.threadsTimelineSets.length===0)return;const n=e===Ka.My?this.threadsTimelineSets[1]:this.threadsTimelineSets[0],{chunk:r,end:i}=await this.client.createThreadListMessagesRequest(this.roomId,null,void 0,It.Backward,n.threadListType,n.getFilter());if(n.getLiveTimeline().setPaginationToken(i??null,It.Backward),!r.length)return;const s=r.map(this.client.getEventMapper());this.processThreadRoots(s,!0);const o=this.getLiveTimeline().getState(He.FORWARDS);for(const a of s)n.addLiveEvent(a,{duplicateStrategy:Y1.Replace,fromCache:!1,roomState:o})}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var i;this.threads.delete(e.id);const n=this.getTimelineForEvent(e.id),r=(i=n==null?void 0:n.getEvents())==null?void 0:i.find(s=>s.getId()===e.id);r?e.clearEventMetadata(r):k.debug("onThreadDelete: Could not find root event in room timeline");for(const s of this.threadsTimelineSets)s.removeEvent(e.id)}removeFilteredTimelineSet(e){const n=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];const r=this.timelineSets.indexOf(n);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,n,r){var c;if(!((c=this.client)!=null&&c.supportsThreads()))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||r!=null&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};const i=e.isRelation(hn.name),s=e.getAssociatedId(),o=e.threadRootId;if(s&&!i&&(o===s||r!=null&&r.has(s)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};let a;return s&&(a=this.findEventById(s)??(n==null?void 0:n.find(l=>l.getId()===s))),a&&!i?this.eventShouldLiveIn(a,n,r):o!=null?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:o}:!s||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;const{threadId:n}=this.eventShouldLiveIn(e);return n?this.getThread(n):null}addThreadedEvents(e,n,r=!1){const i=this.getThread(e);if(i)i.addEvents(n,r);else{const s=this.findEventById(e)??n.find(o=>o.getId()===e);this.createThread(e,s,n,r)}}processThreadedEvents(e,n){var i;e.forEach(this.applyRedaction);const r={};for(const s of e){const{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(s);a&&!r[o]&&(r[o]=[]),(i=r[o])==null||i.push(s)}Object.entries(r).map(([s,o])=>this.addThreadedEvents(s,o,n))}createThread(e,n,r=[],i){if(this.threads.has(e))return this.threads.get(e);if(n){const o=this.relations.getAllChildEventsForEvent(n.getId());o!=null&&o.length&&(r=r.concat(o.filter(a=>!a.isRelation(qn.Replace))))}const s=new wi(e,n,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:this.cachedThreadReadReceipts.get(e)??[]});return this.reEmitter.reEmit(s,[Ga.Delete,Ga.Update,Ga.NewReply,"Room.timeline","Room.timelineReset"]),this.cachedThreadReadReceipts.delete(e),this.threads.set(s.id,s),s.addEvents(r,!1),this.threadsReady&&s.initialEventsFetched&&this.updateThreadRootEvents(s,i,!1),this.emit(Ga.New,s,i),s}processLiveEvent(e){if(this.applyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e),!e.getUnsigned().transaction_id&&e.getSender()===this.myUserId){for(const[r,i]of this.txnToEvent)if(i.getId()===e.getId()){k.debug("processLiveEvent: found sent event without txn ID: ",r,e.getId());const s=e.getUnsigned();s.transaction_id=r,e.setUnsigned(s);break}}}addLiveEvent(e,n){const{duplicateStrategy:r,timelineWasEmpty:i,fromCache:s}=n;for(const o of this.timelineSets)o.addLiveEvent(e,{duplicateStrategy:r,fromCache:s,timelineWasEmpty:i});e.sender&&e.getType()!==Z.RoomRedaction&&this.addReceipt($Y(e.sender.userId,e,Wi.Read),!0)}addPendingEvent(e,n){if(e.status!==Ze.SENDING&&e.status!==Ze.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(n))throw new Error("addPendingEvent called on an event with known txnId "+n);if(He.setEventMetadata(e,this.getLiveTimeline().getState(He.FORWARDS),!1),this.txnToEvent.set(n,e),this.pendingEventList){if(this.pendingEventList.some(r=>r.status===Ze.NOT_SENT)&&(k.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(Ze.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){const r=e.event.redacts;let i=this.pendingEventList.find(s=>s.getId()===r);!i&&r&&(i=this.findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit("Room.redaction",e,this,i.threadRootId))}}else for(const r of this.timelineSets)r.getFilter()?r.getFilter().filterRoomTimeline([e]).length&&r.addEventToTimeline(e,r.getLiveTimeline(),{toStartOfTimeline:!1}):r.addEventToTimeline(e,r.getLiveTimeline(),{toStartOfTimeline:!1});this.emit("Room.localEchoUpdated",e,this)}savePendingEvents(){if(this.pendingEventList){const e=this.pendingEventList.map(n=>({...n.event,txn_id:n.getTxnId()})).filter(n=>{const r=n.type===Z.RoomMessageEncrypted,i=this.hasEncryptionStateEvent();return r||!i});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,n){const r=n.getId(),i=e.getId(),s=n.status;k.debug(`Got remote echo for event ${r} -> ${i} old status ${s}`),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(r),n.handleRemoteEcho(e.event);const{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),c=a?this.getThread(a):null;if(c==null||c.setEventMetadata(n),c==null||c.timelineSet.handleRemoteEcho(n,r,i),o)for(const l of this.timelineSets)l.handleRemoteEcho(n,r,i);this.emit("Room.localEchoUpdated",n,this,r,s)}updatePendingEvent(e,n,r){if(k.log(`setting pendingEvent status to ${n} in ${e.getRoomId()} event ID ${e.getId()} -> ${r}`),n==Ze.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(n==Ze.SENT&&this.getTimelineForEvent(r)){const c=this.findEventById(r);if(!(c==null?void 0:c.getUnsigned().transaction_id)&&c){const u=c.getUnsigned();u.transaction_id=e.getTxnId(),c.setUnsigned(u),this.removeEvent(c.getId()),this.handleRemoteEcho(c,e)}return}const i=e.status,s=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const o=cEe[i];if(!(o!=null&&o.includes(n)))throw new Error(`Invalid EventStatus transition ${i}->${n}`);if(e.setStatus(n),n==Ze.SENT){e.replaceLocalEventId(r);const{shouldLiveInRoom:a,threadId:c}=this.eventShouldLiveIn(e),l=c?this.getThread(c):void 0;if(l==null||l.setEventMetadata(e),l==null||l.timelineSet.replaceEventId(s,r),a)for(const u of this.timelineSets)u.replaceEventId(s,r)}else if(n==Ze.CANCELLED){if(this.pendingEventList){const a=this.getPendingEvent(s);this.removePendingEvent(s),a!=null&&a.isRedaction()&&this.revertRedactionLocalEcho(a)}this.removeEvent(s)}this.savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,s,i)}revertRedactionLocalEcho(e){const n=e.event.redacts;if(!n)return;const r=this.getUnfilteredTimelineSet().findEventById(n);r&&(r.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}async addLiveEvents(e,n){var u;const{duplicateStrategy:r,fromCache:i,timelineWasEmpty:s=!1}=n??{};if(r&&["replace","ignore"].indexOf(r)===-1)throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(let d=0;d<this.timelineSets.length;d++){const f=this.timelineSets[d].getLiveTimeline();if(f.getPaginationToken(He.FORWARDS))throw new Error("live timeline "+d+" is no longer live - it has a pagination token ("+f.getPaginationToken(He.FORWARDS)+")");if(f.getNeighbouringTimeline(He.FORWARDS))throw new Error(`live timeline ${d} is no longer live - it has a neighbouring timeline`)}const o=this.findThreadRoots(e),a={},c={duplicateStrategy:r,fromCache:i,timelineWasEmpty:s},l=[...e];for(const d of e){if(this.processLiveEvent(d),d.getUnsigned().transaction_id){const v=this.txnToEvent.get(d.getUnsigned().transaction_id);if(v){this.handleRemoteEcho(d,v);continue}}let{shouldLiveInRoom:f,shouldLiveInThread:p,threadId:m}=this.eventShouldLiveIn(d,l,o);if(!p&&!f&&d.isRelation())try{const v=new oi(await this.client.fetchRoomEvent(this.roomId,d.relationEventId));if(l.push(v),v.threadRootId){o.add(v.threadRootId);const S=d.getUnsigned();S[tC.name]=v.threadRootId,d.setUnsigned(S)}({shouldLiveInRoom:f,shouldLiveInThread:p,threadId:m}=this.eventShouldLiveIn(d,l,o))}catch(v){k.error("Failed to load parent event of unhandled relation",v)}p&&!a[m??""]&&(a[m??""]=[]),(u=a[m??""])==null||u.push(d),f?this.addLiveEvent(d,c):!p&&d.isRelation()&&this.relations.aggregateChildEvent(d)}Object.entries(a).forEach(([d,f])=>{this.addThreadedEvents(d,f,!1)})}partitionThreadedEvents(e){if(this.client.supportsThreads()){const s=this.findThreadRoots(e);return e.reduce((o,a)=>{const{shouldLiveInRoom:c,shouldLiveInThread:l,threadId:u}=this.eventShouldLiveIn(a,e,s);return c&&o[0].push(a),l&&(a.setThreadId(u??""),o[1].push(a)),!l&&!c&&o[2].push(a),o},[[],[],[]])}else return[e,[],[]]}findThreadRoots(e){const n=new Set;for(const r of e){const i=r.threadRootId;i!=null&&n.add(i)}return n}addReceipt(e,n=!1){const r=e.getContent();this.roomReceipts.add(r,n),Object.keys(r).forEach(i=>{Object.keys(r[i]).forEach(s=>{Object.keys(r[i][s]).forEach(o=>{var d;const a=r[i][s][o],c=!a.thread_id||a.thread_id===pb,l=c?this:this.threads.get(a.thread_id??"");if(l){if(l.addReceiptToStructure(i,s,o,a,n),!n&&this.client.isInitialSyncComplete()&&o===this.client.getUserId()){const f=l.timeline[l.timeline.length-1];f&&i===f.getId()&&o===f.getSender()&&(l.setUnread("total",0),l.setUnread("highlight",0))}}else this.cachedThreadReadReceipts.set(a.thread_id,[...this.cachedThreadReadReceipts.get(a.thread_id)??[],{eventId:i,receiptType:s,userId:o,receipt:a,synthetic:n}]);const u=this.client.getUserId();o===u&&!c&&a.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=a.ts),!a.thread_id&&a.ts>(((d=this.unthreadedReceipts.get(o))==null?void 0:d.ts)??0)&&this.unthreadedReceipts.set(o,a)})})}),this.emit("Room.receipt",e,this)}addEphemeralEvents(e){for(const n of e)n.getType()===Z.Typing?this.currentState.setTypingEvent(n):n.getType()===Z.Receipt&&this.addReceipt(n)}removeEvents(e){for(const n of e)this.removeEvent(n)}removeEvent(e){let n=!1;for(const r of this.timelineSets){const i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),n=!0)}return n}recalculate(){const e=this.currentState.getStateEvents(Z.RoomMember,this.myUserId);if(e){const r=e.getContent().membership;this.updateMyMembership(r),r===Ge.Invite&&(e.getUnsigned().invite_room_state||[]).forEach(s=>{this.currentState.getStateEvents(s.type,s.state_key)||this.currentState.setStateEvents([new oi({type:s.type,state_key:s.state_key,content:s.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}const n=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=N_e(this.name),this.summary=new TY(this.roomId,{title:this.name}),n!==this.name&&this.emit("Room.name",this)}addTags(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)}addAccountData(e){for(const n of e){n.getType()==="m.tag"&&this.addTags(n);const r=n.getType(),i=this.accountData.get(r);this.accountData.set(r,n),this.emit("Room.accountData",n,this,i)}}getAccountData(e){return this.accountData.get(e)}maySendMessage(){return this.getMyMembership()===Ge.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(Z.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(Z.RoomMessage,this.myUserId))}canInvite(e){let n=this.getMyMembership()===Ge.Join;const r=this.currentState.getStateEvents(Z.RoomPowerLevels,""),i=r&&r.getContent(),s=this.getMember(e);return i&&s&&i.invite>s.powerLevel&&(n=!1),n}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){const e=this.currentState.getStateEvents(Z.RoomCreate,"");if(!e){this.getTypeWarning||(k.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0);return}return e.getContent()[eC]}isSpaceRoom(){return this.getType()===Ph.Space}isCallRoom(){return this.getType()===Ph.UnstableCall}isElementVideoRoom(){return this.getType()===Ph.ElementVideo}findPredecessor(e=!1){const n=this.getLiveTimeline().getState(He.FORWARDS);return n?n.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){const n=this.client.roomNameGenerator(this.roomId,e);if(n!==null)return n}switch(e.type){case 2:return e.name;case 1:switch(e.subtype){case"Inviting":return`Inviting ${pF(e.names,e.count)}`;default:return pF(e.names,e.count)}case 0:return e.oldName?`Empty room (was ${e.oldName})`:"Empty room"}}calculateRoomName(e,n=!1){if(!n){const f=this.currentState.getStateEvents(Z.RoomName,"");if(f!=null&&f.getContent().name)return this.roomNameGenerator({type:2,name:f.getContent().name})}const r=this.getCanonicalAlias();if(r)return this.roomNameGenerator({type:2,name:r});const i=this.currentState.getJoinedMemberCount(),s=this.currentState.getInvitedMemberCount();let o=i+s-1;const a=this.getFunctionalMembers();let c=[];if(this.summaryHeroes)this.summaryHeroes.forEach(f=>{if(a.includes(f)){o--;return}const p=this.getMember(f);c.push(p?p.name:f)});else{let f=this.currentState.getMembers().filter(m=>m.userId!==e&&(m.membership===Ge.Invite||m.membership===Ge.Join));f=f.filter(({userId:m})=>a.includes(m)?(o--,!1):!0);const p=new Intl.Collator;f.sort((m,v)=>p.compare(m.userId,v.userId)),f=f.slice(0,5),c=f.map(m=>m.name)}if(o)return this.roomNameGenerator({type:1,names:c,count:o});if(this.getMyMembership()==Ge.Join){const f=this.currentState.getStateEvents(Z.RoomThirdPartyInvite);if(f!=null&&f.length){const p=f.map(m=>m.getContent().display_name);return this.roomNameGenerator({type:1,subtype:"Inviting",names:p,count:p.length+1})}}let u=c;u.length||(u=this.currentState.getMembers().filter(f=>f.userId!==e&&f.membership!==Ge.Invite&&f.membership!==Ge.Join).map(f=>f.name));let d;return u.length&&(d=this.roomNameGenerator({type:1,names:u,count:u.length+1})),this.roomNameGenerator({type:0,oldName:d})}applyNewVisibilityEvent(e){const n=e.asVisibilityChange();if(!n)return;const r=e.getSender();if(!r||!(vh.name&&this.currentState.maySendStateEvent(vh.name,r)||vh.altName&&this.currentState.maySendStateEvent(vh.altName,r)))return;const s=this.visibilityEvents.get(n.eventId);if(s){let a=s.length-1;const c=Math.max(0,s.length-aEe);for(;a>=c&&!(s[a].getTs()<e.getTs());--a);a===-1?s.unshift(e):s.splice(a+1,0,e)}else this.visibilityEvents.set(n.eventId,[e]);const o=this.findEventById(n.eventId);o&&o.applyVisibilityEvent(n)}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");const n=e.getRelation(),r=n==null?void 0:n.event_id,i=this.visibilityEvents.get(r);if(!i)return;const s=i.findIndex(o=>o.getId()===e.getId());if(s!==-1&&(i.splice(s,1),s===i.length)){const o=this.findEventById(r);if(!o)return;if(s===0)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{const c=i[i.length-1].asVisibilityChange();if(!c)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(c)}}}applyPendingVisibilityEvents(e){const n=this.visibilityEvents.get(e.getId());if(!n||n.length==0)return;const r=n[n.length-1],i=r.asVisibilityChange();i&&(i.visible,!(r.getTs()<e.getTs())&&e.applyVisibilityEvent(i))}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,n){return this.roomReceipts.hasUserReadEvent(e,n)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);const n=this.getThreads().filter(r=>this.getThreadUnreadNotificationCount(r.id,"total")>0);for(const r of n)r.fixupNotifications(e)}compareEventOrdering(e,n){return Hwe(this,e,n)}hasEncryptionStateEvent(){var e;return!!((e=this.getLiveTimeline().getState(He.FORWARDS))!=null&&e.getStateEvents(Z.RoomEncryption,""))}};const cEe={[Ze.ENCRYPTING]:[Ze.SENDING,Ze.NOT_SENT,Ze.CANCELLED],[Ze.SENDING]:[Ze.ENCRYPTING,Ze.QUEUED,Ze.NOT_SENT,Ze.SENT],[Ze.QUEUED]:[Ze.SENDING,Ze.NOT_SENT,Ze.CANCELLED],[Ze.SENT]:[],[Ze.NOT_SENT]:[Ze.SENDING,Ze.QUEUED,Ze.CANCELLED],[Ze.CANCELLED]:[]};var XY=(t=>(t[t.EmptyRoom=0]="EmptyRoom",t[t.Generated=1]="Generated",t[t.Actual=2]="Actual",t))(XY||{});function pF(t,e){const n=e-1;return t.length?t.length===1&&n<=1?t[0]:t.length===2&&n<=2?`${t[0]} and ${t[1]}`:n>1?`${t[0]} and ${n} others`:`${t[0]} and 1 other`:"Empty room"}var Si=(t=>(t[t.Stable=0]="Stable",t[t.Unstable=1]="Unstable",t[t.Unsupported=2]="Unsupported",t))(Si||{}),vo=(t=>(t.Thread="Thread",t.ThreadUnreadNotifications="ThreadUnreadNotifications",t.LoginTokenRequest="LoginTokenRequest",t.RelationBasedRedactions="RelationBasedRedactions",t.AccountDataDeletion="AccountDataDeletion",t.RelationsRecursion="RelationsRecursion",t.IntentionalMentions="IntentionalMentions",t))(vo||{});const lEe={Thread:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},ThreadUnreadNotifications:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},LoginTokenRequest:{unstablePrefixes:["org.matrix.msc3882"]},RelationBasedRedactions:{unstablePrefixes:["org.matrix.msc3912"]},AccountDataDeletion:{unstablePrefixes:["org.matrix.msc3391"]},RelationsRecursion:{unstablePrefixes:["org.matrix.msc3981"]},IntentionalMentions:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};async function uEe(t){var n,r;const e=new Map;for(const[i,s]of Object.entries(lEe)){const o=((n=t.versions)==null?void 0:n.includes(s.matrixVersion||""))??!1,a=((r=s.unstablePrefixes)==null?void 0:r.every(c=>{var l;return((l=t.unstable_features)==null?void 0:l[c])===!0}))??!1;o?e.set(i,0):a?e.set(i,1):e.set(i,2)}return e}const gF=80*1e3,dEe=3;var ii=(t=>(t.Error="ERROR",t.Prepared="PREPARED",t.Stopped="STOPPED",t.Syncing="SYNCING",t.Catchup="CATCHUP",t.Reconnecting="RECONNECTING",t))(ii||{});const fEe=["org.matrix.msc2716v3"];function mF(t,e){return`FILTER_SYNC_${t}`+(e?"_"+e:"")}function jn(...t){k.log(...t)}var ZY=(t=>(t.Offline="offline",t.Online="online",t.Unavailable="unavailable",t))(ZY||{});function QY(t){return{initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:30*1e3,pendingEventOrdering:Zh.Chronological,threadSupport:!1,...t}}function eJ(t){return{canResetEntireTimeline:e=>!1,...t}}class I1{constructor(e,n,r){this.client=e,this._peekRoom=null,this.syncState=null,this.catchingUp=!1,this.running=!1,this.notifEvents=[],this.failedSyncCount=0,this.storeIsInvalid=!1,this.getPushRules=async()=>{try{jn("Getting push rules...");const i=await this.client.getPushRules();jn("Got push rules"),this.client.pushRules=i}catch(i){return k.error("Getting push rules failed",i),this.shouldAbortSync(i)?void 0:(jn("Waiting for saved sync before retrying push rules..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,i),this.getPushRules())}},this.buildDefaultFilter=()=>{const i=new _o(this.client.credentials.userId);return this.client.canSupport.get(vo.ThreadUnreadNotifications)!==Si.Unsupported&&i.setUnreadThreadNotifications(!0),i},this.prepareLazyLoadingForSync=async()=>{var i;jn("Prepare lazy loading for sync..."),this.client.isGuest()&&(this.opts.lazyLoadMembers=!1),this.opts.lazyLoadMembers&&(jn("Enabling lazy load on sync filter..."),this.opts.filter||(this.opts.filter=this.buildDefaultFilter()),this.opts.filter.setLazyLoadMembers(!0)),this.opts.lazyLoadMembers&&((i=this.syncOpts.crypto)==null||i.enableLazyLoading())},this.storeClientOptions=async()=>{try{jn("Storing client options..."),await this.client.storeClientOptions(),jn("Stored client options")}catch(i){throw k.error("Storing client options failed",i),i}},this.getFilter=async()=>{jn("Getting filter...");let i;this.opts.filter?i=this.opts.filter:i=this.buildDefaultFilter();let s;try{s=await this.client.getOrCreateFilter(mF(this.client.credentials.userId),i)}catch(o){return k.error("Getting filter failed",o),this.shouldAbortSync(o)?{}:(jn("Waiting for saved sync before retrying filter..."),await this.recoverFromSyncStartupError(this.savedSyncPromise,o),this.getFilter())}return{filter:i,filterId:s}},this.onOnline=()=>{jn("Browser thinks we are back online"),this.startKeepAlives(0)},this.opts=QY(n),this.syncOpts=eJ(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[ct.Timeline,ct.TimelineReset])}createRoom(e){const n=tJ(this.client,e,this.opts);return n.on(xt.Marker,(r,i)=>{this.onMarkerStateEvent(n,r,i)}),n}onMarkerStateEvent(e,n,{timelineWasEmpty:r}={}){if(r){k.debug(`MarkerState: Ignoring markerEventId=${n.getId()} in roomId=${e.roomId} because the timeline was empty before the marker arrived which means there is nothing to refresh.`);return}fEe.includes(e.getVersion())||n.getSender()===e.getCreator()?(k.debug(`MarkerState: Timeline needs to be refreshed because a new markerEventId=${n.getId()} was sent in roomId=${e.roomId}`),e.setTimelineNeedsRefresh(!0),e.emit(ct.HistoryImportedWithinTimeline,n,e)):k.debug(`MarkerState: Ignoring markerEventId=${n.getId()} in roomId=${e.roomId} because MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.`)}async syncLeftRooms(){var l;const e=this.client,n=new _o(this.client.credentials.userId);n.setTimelineLimit(1),n.setIncludeLeaveRooms(!0);const r=this.opts.pollTimeout+gF,s={timeout:0,filter:await e.getOrCreateFilter(mF(e.credentials.userId,"LEFT_ROOMS"),n)},o=await e.http.authedRequest(oe.Get,"/sync",s,void 0,{localTimeoutMs:r});let a=[];return(l=o.rooms)!=null&&l.leave&&(a=this.mapSyncResponseToRoomArray(o.rooms.leave)),(await Promise.all(a.map(async u=>{const d=u.room;if(!u.isBrandNewRoom)return;u.timeline=u.timeline||{prev_batch:null,events:[]};const f=this.mapSyncEventsFormat(u.timeline,d),p=this.mapSyncEventsFormat(u.state,d);return d.getLiveTimeline().setPaginationToken(u.timeline.prev_batch,He.BACKWARDS),await this.injectRoomEvents(d,p,f),d.recalculate(),e.store.storeRoom(d),e.emit(qe.Room,d),this.processEventsForNotifs(d,f),d}))).filter(Boolean)}peek(e,n=20){var i;if(((i=this._peekRoom)==null?void 0:i.roomId)===e)return Promise.resolve(this._peekRoom);const r=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,n).then(s=>{var l;if(((l=this._peekRoom)==null?void 0:l.roomId)!==e)throw new Error("Peeking aborted");s.messages=s.messages||{chunk:[]},s.messages.chunk=s.messages.chunk||[],s.state=s.state||[];const o=I2(s.state).map(r.getEventMapper()),a=s.state.map(r.getEventMapper()),c=s.messages.chunk.map(r.getEventMapper());return Array.isArray(s.presence)&&s.presence.map(r.getEventMapper()).forEach(function(u){let d=r.store.getUser(u.getContent().user_id);d?d.setPresenceEvent(u):(d=lu.createUser(u.getContent().user_id,r),d.setPresenceEvent(u),r.store.storeUser(d)),r.emit(qe.Event,u)}),s.messages.start&&(this._peekRoom.oldState.paginationToken=s.messages.start),this._peekRoom.oldState.setStateEvents(o),this._peekRoom.currentState.setStateEvents(a),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(c.reverse(),!0,this._peekRoom.getLiveTimeline(),s.messages.start),r.store.storeRoom(this._peekRoom),r.emit(qe.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,n){var r;if(this._peekRoom!==e){jn("Stopped peeking in room %s",e.roomId);return}this.client.http.authedRequest(oe.Get,"/events",{room_id:e.roomId,timeout:String(30*1e3),from:n},void 0,{localTimeoutMs:50*1e3,abortSignal:(r=this.abortController)==null?void 0:r.signal}).then(async i=>{if(this._peekRoom!==e){jn("Stopped peeking in room %s",e.roomId);return}i.chunk.filter(function(o){return o.type==="m.presence"}).map(this.client.getEventMapper()).forEach(o=>{let a=this.client.store.getUser(o.getContent().user_id);a?a.setPresenceEvent(o):(a=lu.createUser(o.getContent().user_id,this.client),a.setPresenceEvent(o),this.client.store.storeUser(a)),this.client.emit(qe.Event,o)});const s=i.chunk.filter(function(o){return o.room_id===e.roomId&&o.event_id}).map(this.client.getEventMapper());await e.addLiveEvents(s),this.peekPoll(e,i.end)},i=>{k.error("[%s] Peek poll failed: %s",e.roomId,i),setTimeout(()=>{this.peekPoll(e,n)},30*1e3)})}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData??null}async recoverFromSyncStartupError(e,n){await e;const r=this.startKeepAlives();this.updateSyncState("ERROR",{error:n}),await r}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(k.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState("ERROR",{error:e}),!0):!1}async sync(){var i,s;if(this.running=!0,this.abortController=new AbortController,(s=(i=global.window)==null?void 0:i.addEventListener)==null||s.call(i,"online",this.onOnline,!1),this.client.isGuest())return this.doSync({});jn("Getting saved sync token...");const e=this.client.store.getSavedSyncToken().then(o=>(jn("Got saved sync token"),o));this.savedSyncPromise=this.client.store.getSavedSync().then(o=>{if(jn(`Got reply from saved sync, exists? ${!!o}`),o)return this.syncFromCache(o)}).catch(o=>{k.error("Getting saved sync failed",o)}),await this.getPushRules(),await this.prepareLazyLoadingForSync(),await this.storeClientOptions();const{filterId:n,filter:r}=await this.getFilter();if(r){if(this.client.resetNotifTimelineSet(),!this.currentSyncRequest){let o=n;const a=await e;if(a)jn("Sending first sync request...");else{jn("Sending initial sync request...");const c=this.buildDefaultFilter();c.setDefinition(r.getDefinition()),c.setTimelineLimit(this.opts.initialSyncLimit),o=JSON.stringify(c.getDefinition())}this.currentSyncRequest=this.doSyncRequest({filter:o},a)}return jn("Waiting for saved sync before starting sync processing..."),await this.savedSyncPromise,this.doSync({filter:n})}}stop(){var e,n,r;jn("SyncApi.stop"),(n=(e=global.window)==null?void 0:e.removeEventListener)==null||n.call(e,"online",this.onOnline,!1),this.running=!1,(r=this.abortController)==null||r.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return this.connectionReturnedDefer?(this.startKeepAlives(0),!0):!1}async syncFromCache(e){jn("sync(): not doing HTTP hit, instead returning stored /sync data");const n=e.nextBatch;this.client.store.setSyncToken(n);const r={nextSyncToken:n,catchingUp:!1,fromCache:!0},i={next_batch:n,rooms:e.roomsData,account_data:{events:e.accountData}};try{await this.processSyncResponse(r,i)}catch(s){k.error("Error processing cached sync",s)}this.storeIsInvalid||this.updateSyncState("PREPARED",r)}async doSync(e){for(;this.running;){const n=this.client.store.getSyncToken();let r;try{this.currentSyncRequest||(this.currentSyncRequest=this.doSyncRequest(e,n)),r=await this.currentSyncRequest}catch(s){if(await this.onSyncError(s))return;continue}finally{this.currentSyncRequest=void 0}this.client.store.setSyncToken(r.next_batch),this.failedSyncCount=0;const i={oldSyncToken:n??void 0,nextSyncToken:r.next_batch,catchingUp:this.catchingUp};this.syncOpts.crypto&&await this.syncOpts.crypto.onSyncWillProcess(i);try{await this.processSyncResponse(i,r)}catch(s){k.error("Caught /sync error",s),this.client.emit(qe.SyncUnexpectedError,s)}await this.client.store.setSyncData(r),i.catchingUp=this.catchingUp,e.hasSyncedBefore||(this.updateSyncState("PREPARED",i),e.hasSyncedBefore=!0),this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onSyncCompleted(i),this.updateSyncState("SYNCING",i),this.client.store.wantsSave()&&(this.syncOpts.crypto&&await this.syncOpts.crypto.saveDeviceList(0),await this.client.store.save())}this.running||(jn("Sync no longer running: exiting."),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState("STOPPED"))}doSyncRequest(e,n){var i;const r=this.getSyncParams(e,n);return this.client.http.authedRequest(oe.Get,"/sync",r,void 0,{localTimeoutMs:r.timeout+gF,abortSignal:(i=this.abortController)==null?void 0:i.signal})}getSyncParams(e,n){let r=this.opts.pollTimeout;(this.getSyncState()!=="SYNCING"||this.catchingUp)&&(this.catchingUp=!0,r=0);let i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());const s={filter:i,timeout:r};return this.opts.disablePresence?s.set_presence="offline":this.presence!==void 0&&(s.set_presence=this.presence),n?s.since=n:s._cacheBuster=Date.now(),["RECONNECTING","ERROR"].includes(this.getSyncState())&&(s.timeout=0),s}setPresence(e){this.presence=e}async onSyncError(e){if(!this.running)return jn("Sync no longer running: exiting"),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject(),this.connectionReturnedDefer=void 0),this.updateSyncState("STOPPED"),!0;if(k.error("/sync error %s",e),this.shouldAbortSync(e))return!0;this.failedSyncCount++,k.log("Number of consecutive failed sync requests:",this.failedSyncCount),jn("Starting keep-alive");const n=this.startKeepAlives();return this.currentSyncRequest=void 0,this.updateSyncState(this.failedSyncCount>=dEe?"ERROR":"RECONNECTING",{error:e}),await n&&this.getSyncState()==="ERROR"&&this.updateSyncState("CATCHUP",{catchingUp:!0}),!1}async processSyncResponse(e,n){var c,l,u;const r=this.client;if(Array.isArray((c=n.presence)==null?void 0:c.events)&&n.presence.events.filter(Ya).map(r.getEventMapper()).forEach(function(d){let f=r.store.getUser(d.getSender());f?f.setPresenceEvent(d):(f=lu.createUser(d.getSender(),r),f.setPresenceEvent(d),r.store.storeUser(f)),r.emit(qe.Event,d)}),Array.isArray((l=n.account_data)==null?void 0:l.events)){const d=n.account_data.events.filter(Ya).map(r.getEventMapper()),f=d.reduce((p,m)=>(p[m.getType()]=r.store.getAccountData(m.getType()),p),{});r.store.storeAccountDataEvents(d),d.forEach(function(p){if(p.getType()===Z.PushRules){const v=p.getContent();r.setPushRules(v)}const m=f[p.getType()];return r.emit(qe.AccountData,p,m),p})}if(n.to_device&&Array.isArray(n.to_device.events)&&n.to_device.events.length>0){let d=n.to_device.events.filter(Ya);this.syncOpts.cryptoCallbacks&&(d=await this.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(d));const f=[];d.map(r.getEventMapper({toDevice:!0})).map(p=>{if(p.getType()==="m.key.verification.cancel"){const m=p.getContent().transaction_id;m&&f.push(m)}return p}).forEach(function(p){const m=p.getContent();if(p.getType()=="m.room.message"&&m.msgtype=="m.bad.encrypted"){k.log("Ignoring undecryptable to-device event from "+p.getSender());return}if(p.getType()==="m.key.verification.start"||p.getType()==="m.key.verification.request"){const v=m.transaction_id;f.includes(v)&&p.flagCancelled()}r.emit(qe.ToDeviceEvent,p)})}else this.catchingUp=!1;let i=[],s=[],o=[],a=[];n.rooms&&(n.rooms.invite&&(i=this.mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(s=this.mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(o=this.mapSyncResponseToRoomArray(n.rooms.leave)),n.rooms.knock&&(a=this.mapSyncResponseToRoomArray(n.rooms.knock))),this.notifEvents=[],await Bg(i,async d=>{var S;const f=d.room,p=this.mapSyncEventsFormat(d.invite_state,f);await this.injectRoomEvents(f,p);const m=(S=f.currentState.getStateEvents(Z.RoomMember,r.getUserId()))==null?void 0:S.getSender(),v=r.crypto;if(v){const _=await v.cryptoStore.takeParkedSharedHistory(f.roomId);for(const w of _)w.senderId===m&&await v.olmDevice.addInboundGroupSession(f.roomId,w.senderKey,w.forwardingCurve25519KeyChain,w.sessionId,w.sessionKey,w.keysClaimed,!0,{sharedHistory:!0,untrusted:!0})}d.isBrandNewRoom?(f.recalculate(),r.store.storeRoom(f),r.emit(qe.Room,f)):f.recalculate(),p.forEach(function(_){r.emit(qe.Event,_)})}),await Bg(s,async d=>{const f=d.room,p=this.mapSyncEventsFormat(d.state,f),m=this.mapSyncEventsFormat(d.timeline,f,!1),v=this.mapSyncEventsFormat(d.ephemeral),S=this.mapSyncEventsFormat(d.account_data),_=this.isRoomEncrypted(f,p,m);d.unread_notifications&&((!_||d.unread_notifications.notification_count===0)&&f.setUnreadNotificationCount(xr.Total,d.unread_notifications.notification_count??0),(!_||f.getUnreadNotificationCount(xr.Highlight)<=0)&&f.setUnreadNotificationCount(xr.Highlight,d.unread_notifications.highlight_count??0));const w=d[G0.name]??d[G0.altName];if(w){f.resetThreadUnreadNotificationCountFromSync(Object.keys(w));for(const[C,I]of Object.entries(w)){(!_||I.notification_count===0)&&f.setThreadUnreadNotificationCount(C,xr.Total,I.notification_count??0);const R=f.getThreadUnreadNotificationCount(C,xr.Highlight)<=0;(!_||_&&R)&&f.setThreadUnreadNotificationCount(C,xr.Highlight,I.highlight_count??0)}}else f.resetThreadUnreadNotificationCountFromSync();if(d.timeline=d.timeline||{},d.isBrandNewRoom)d.timeline.prev_batch!==null&&f.getLiveTimeline().setPaginationToken(d.timeline.prev_batch,He.BACKWARDS);else if(d.timeline.limited){let C=!0;for(let I=m.length-1;I>=0;I--){const R=m[I].getId();if(f.getTimelineForEvent(R)){jn(`Already have event ${R} in limited sync - not resetting`),C=!1,m.splice(0,I);break}}C&&(f.resetLiveTimeline(d.timeline.prev_batch,this.syncOpts.canResetEntireTimeline(f.roomId)?null:e.oldSyncToken??null),r.resetNotifTimelineSet())}if(this.syncOpts.cryptoCallbacks)for(const C of p.concat(m))C.isState()&&C.getType()===Z.RoomEncryption&&C.getStateKey()===""&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(f,C);try{await this.injectRoomEvents(f,p,m,e.fromCache)}catch(C){k.error(`Failed to process events on room ${f.roomId}:`,C)}d.summary&&f.setSummary(d.summary),f.addEphemeralEvents(v),f.addAccountData(S),f.recalculate(),d.isBrandNewRoom&&(r.store.storeRoom(f),r.emit(qe.Room,f)),this.processEventsForNotifs(f,m);const T=C=>r.emit(qe.Event,C);p.forEach(T),m.forEach(T),v.forEach(T),S.forEach(T),f.decryptCriticalEvents()}),await Bg(o,async d=>{const f=d.room,p=this.mapSyncEventsFormat(d.state,f),m=this.mapSyncEventsFormat(d.timeline,f),v=this.mapSyncEventsFormat(d.account_data);await this.injectRoomEvents(f,p,m),f.addAccountData(v),f.recalculate(),d.isBrandNewRoom&&(r.store.storeRoom(f),r.emit(qe.Room,f)),this.processEventsForNotifs(f,m),p.forEach(function(S){r.emit(qe.Event,S)}),m.forEach(function(S){r.emit(qe.Event,S)}),v.forEach(function(S){r.emit(qe.Event,S)})}),await Bg(a,async d=>{const f=d.room,p=this.mapSyncEventsFormat(d.knock_state,f);await this.injectRoomEvents(f,p),d.isBrandNewRoom?(f.recalculate(),r.store.storeRoom(f),r.emit(qe.Room,f)):f.recalculate(),p.forEach(function(m){r.emit(qe.Event,m)})}),e.oldSyncToken&&this.notifEvents.length&&(this.notifEvents.sort(function(d,f){return d.getTs()-f.getTs()}),this.notifEvents.forEach(function(d){var f;(f=r.getNotifTimelineSet())==null||f.addLiveEvent(d)})),n.device_lists&&this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.processDeviceLists(n.device_lists),await((u=this.syncOpts.cryptoCallbacks)==null?void 0:u.processKeyCounts(n.device_one_time_keys_count,n.device_unused_fallback_key_types??n["org.matrix.msc2732.device_unused_fallback_key_types"]))}startKeepAlives(e){return e===void 0&&(e=2e3+Math.floor(Math.random()*5e3)),this.keepAliveTimer!==null&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedDefer||(this.connectionReturnedDefer=Ef()),this.connectionReturnedDefer.promise}pokeKeepAlive(e=!1){var r;if(!this.running){clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.reject("SyncApi.stop() was called"),this.connectionReturnedDefer=void 0);return}const n=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedDefer&&(this.connectionReturnedDefer.resolve(e),this.connectionReturnedDefer=void 0)};this.client.http.request(oe.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15*1e3,abortSignal:(r=this.abortController)==null?void 0:r.signal}).then(()=>{n()},i=>{i.httpStatus==400||i.httpStatus==404?this.keepAliveTimer=setTimeout(n,2e3):(e=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,e),5e3+Math.floor(Math.random()*5e3)),this.updateSyncState("ERROR",{error:i}))})}mapSyncResponseToRoomArray(e){const n=this.client;return Object.keys(e).filter(r=>!G1(r)).map(r=>{let i=n.store.getRoom(r),s=!1;return i||(i=this.createRoom(r),s=!0),{...e[r],room:i,isBrandNewRoom:s}})}mapSyncEventsFormat(e,n,r=!0){if(!e||!Array.isArray(e.events))return[];const i=this.client.getEventMapper({decrypt:r});return e.events.filter(Ya).map(function(s){return n&&(s.room_id=n.roomId),i(s)})}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const n=this.client;e.getMembersWithMembership(Ge.Invite).forEach(function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=n.getUser(r.userId);let s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){const a=r.events.member;(a==null?void 0:a.getContent().membership)===Ge.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})})}findEncryptionEvent(e){return e==null?void 0:e.find(n=>n.getType()===Z.RoomEncryption&&n.getStateKey()==="")}isRoomEncrypted(e,n,r){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(n)||!!this.findEncryptionEvent(r)}async injectRoomEvents(e,n,r,i=!1){const s=e.getLiveTimeline(),o=s.getEvents().length==0;if(o){for(const a of n)this.client.getPushActionsForEvent(a);s.initialiseState(n,{timelineWasEmpty:o})}this.resolveInvites(e),e.recalculate(),o||(e.oldState.setStateEvents(n||[]),e.currentState.setStateEvents(n||[])),await e.addLiveEvents(r||[],{fromCache:i,timelineWasEmpty:o}),this.client.processBeaconEvents(e,r)}processEventsForNotifs(e,n){var r;if(this.client.getNotifTimelineSet())for(const i of n){const s=this.client.getPushActionsForEvent(i);s!=null&&s.notify&&((r=s.tweaks)!=null&&r.highlight)&&this.notifEvents.push(i)}}getGuestFilter(){return"{}"}updateSyncState(e,n){const r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(qe.Sync,this.syncState,r,n)}}function tJ(t,e,n){const{timelineSupport:r}=t,i=new U2(e,t,t.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return t.reEmitter.reEmit(i,[ct.Name,ct.Redaction,ct.RedactionCancelled,ct.Receipt,ct.Tags,ct.LocalEchoUpdated,ct.AccountData,ct.MyMembership,ct.Timeline,ct.TimelineReset,xt.Events,xt.Members,xt.NewMember,xt.Update,_r.New,_r.Update,_r.Destroy,_r.LivenessChange]),i.on(xt.NewMember,(s,o,a)=>{a.user=t.getUser(a.userId)??void 0,t.reEmitter.reEmit(a,[Hs.Name,Hs.Typing,Hs.PowerLevel,Hs.Membership])}),i}class hEe{constructor(){this.accountData=new Map,this.fromToken=null}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,n){return[]}setUserCreator(e){}storeEvents(e,n,r,i){}storeFilter(e){}getFilter(e,n){return null}getFilterIdByName(e){return null}setFilterIdByName(e,n){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,n){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}async getPendingEvents(e){return[]}setPendingEvents(e,n){return Promise.resolve()}async saveToDeviceBatches(e){return Promise.resolve()}getOldestToDeviceBatch(){return Promise.resolve(null)}async removeToDeviceBatch(e){return Promise.resolve()}async destroy(){}}var gi=[];for(var p3=0;p3<256;++p3)gi.push((p3+256).toString(16).slice(1));function pEe(t,e=0){return(gi[t[e+0]]+gi[t[e+1]]+gi[t[e+2]]+gi[t[e+3]]+"-"+gi[t[e+4]]+gi[t[e+5]]+"-"+gi[t[e+6]]+gi[t[e+7]]+"-"+gi[t[e+8]]+gi[t[e+9]]+"-"+gi[t[e+10]]+gi[t[e+11]]+gi[t[e+12]]+gi[t[e+13]]+gi[t[e+14]]+gi[t[e+15]]).toLowerCase()}var sw,gEe=new Uint8Array(16);function mEe(){if(!sw&&(sw=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!sw))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return sw(gEe)}var vEe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const vF={randomUUID:vEe};function ac(t,e,n){if(vF.randomUUID&&!e&&!t)return vF.randomUUID();t=t||{};var r=t.random||(t.rng||mEe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,pEe(r)}var nJ={},rJ={exports:{}},yF=rJ.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var e="candidate:%s %d %s %d %s %d typ %s";return e+=t.raddr!=null?" raddr %s rport %d":"%v%v",e+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(e+=" generation %d"),e+=t["network-id"]!=null?" network-id %d":"%v",e+=t["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var e="ssrc:%d";return t.attribute!=null&&(e+=" %s",t.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var e="mediaclk:";return e+=t.id!=null?"id=%s %s":"%v%s",e+=t.mediaClockValue!=null?"=%s":"",e+=t.rateNumerator!=null?" rate=%s":"",e+=t.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(yF).forEach(function(t){var e=yF[t];e.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var iJ=rJ.exports;(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},r=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},i=iJ,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var f=d[0],p=d.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var m=0;m<(i[f]||[]).length;m+=1){var v=i[f][m];if(v.reg.test(p))return r(v,u,p)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}})(nJ);var g3=iJ,yEe=/%[sdv%]/g,_Ee=function(t){var e=1,n=arguments,r=n.length;return t.replace(yEe,function(i){if(e>=r)return i;var s=n[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},Ly=function(t,e,n){var r=e.format instanceof Function?e.format(e.push?n:n[e.name]):e.format,i=[t+"="+r];if(e.names)for(var s=0;s<e.names.length;s+=1){var o=e.names[s];e.name?i.push(n[e.name][o]):i.push(n[e.names[s]])}else i.push(n[e.name]);return _Ee.apply(null,i)},bEe=["v","o","s","i","u","e","p","c","b","t","r","z","a"],SEe=["i","c","b","a"],wEe=function(t,e){e=e||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var n=e.outerOrder||bEe,r=e.innerOrder||SEe,i=[];return n.forEach(function(s){g3[s].forEach(function(o){o.name in t&&t[o.name]!=null?i.push(Ly(s,o,t)):o.push in t&&t[o.push]!=null&&t[o.push].forEach(function(a){i.push(Ly(s,o,a))})})}),t.media.forEach(function(s){i.push(Ly("m",g3.m[0],s)),r.forEach(function(o){g3[o].forEach(function(a){a.name in s&&s[a.name]!=null?i.push(Ly(o,a,s)):a.push in s&&s[a.push]!=null&&s[a.push].forEach(function(c){i.push(Ly(o,a,c))})})})}),i.join(`\r
`)+`\r
`},Cp=nJ,EEe=wEe,TEe=EEe,sJ=Cp.parse;Cp.parseParams;Cp.parseFmtpConfig;Cp.parsePayloads;Cp.parseRemoteCandidates;Cp.parseImageAttributes;Cp.parseSimulcastStreamList;function hs(t){if(typeof Buffer=="function")return Buffer.from(t).toString("base64");if(typeof btoa=="function"&&t instanceof Uint8Array)return btoa(t.reduce((e,n)=>e+String.fromCharCode(n),""));throw new Error("No base64 impl found!")}function $2(t){return hs(t).replace(/={1,2}$/,"")}function F2(t){return $2(t).replace(/\+/g,"-").replace(/\//g,"_")}function xi(t){if(typeof Buffer=="function")return Buffer.from(t,"base64");if(typeof atob=="function"){const e=function*(){const n=atob(t.replace(/-/g,"+").replace(/_/g,"/"));for(let r=0;r<n.length;++r)yield n.charCodeAt(r)};return Uint8Array.from(e())}else throw new Error("No base64 impl found!")}const CEe="abcdefghijklmnopqrstuvwxyz",kEe="ABCDEFGHIJKLMNOPQRSTUVWXYZ",REe="0123456789";function oJ(t){const e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),F2(e)}function Zi(t){return IEe(t,kEe+CEe+REe)}function IEe(t,e){let n="";for(let r=0;r<t;++r)n+=e.charAt(Math.floor(Math.random()*e.length));return n}const nd="org.matrix.msc3077.sdp_stream_metadata";var fn=(t=>(t.Usermedia="m.usermedia",t.Screenshare="m.screenshare",t))(fn||{});let yh=null,X6=0;const xEe=()=>(yh===null&&(yh=new AudioContext),X6++,yh),PEe=()=>{X6--,X6===0&&(yh==null||yh.close(),yh=null)},OEe=200,Z6=-60,MEe=8;var aJ=(t=>(t.NewStream="new_stream",t.MuteStateChanged="mute_state_changed",t.LocalVolumeChanged="local_volume_changed",t.VolumeChanged="volume_changed",t.ConnectedChanged="connected_changed",t.Speaking="speaking",t.Disposed="disposed",t))(aJ||{});class tu extends Fn{constructor(e){super(),this.localVolume=1,this.measuringVolumeActivity=!1,this.speakingThreshold=Z6,this.speaking=!1,this._disposed=!1,this._connected=!1,this.onAddTrack=()=>{this.emit("new_stream",this.stream)},this.onCallState=n=>{n===bo.Connected?this.connected=!0:n===bo.Connecting&&(this.connected=!1)},this.volumeLooper=()=>{if(!this.analyser||!this.measuringVolumeActivity)return;this.analyser.getFloatFrequencyData(this.frequencyBinCount);let n=-1/0;for(const i of this.frequencyBinCount)i>n&&(n=i);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(n),this.emit("volume_changed",n);let r=!1;for(const i of this.speakingVolumeSamples)if(i>this.speakingThreshold){r=!0;break}this.speaking!==r&&(this.speaking=r,this.emit("speaking",this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,OEe)},this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(MEe).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(Ds.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit("connected_changed",this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,n){if(n===e)return;const r=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=n,n.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),r&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit("new_stream",this.stream)}initVolumeMeasuring(){if(!this.hasAudioTrack)return;this.audioContext||(this.audioContext=xEe()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1,this.audioContext.createMediaStreamSource(this.stream).connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}getMember(){const e=this.client.getRoom(this.roomId);return(e==null?void 0:e.getMember(this.userId))??null}isLocal(){return this.userId===this.client.getUserId()&&(this.deviceId===void 0||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return this.stream.getAudioTracks().length===0||this.audioMuted}isVideoMuted(){return this.stream.getVideoTracks().length===0||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,n){e!==null&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),n!==null&&(this.videoMuted=n),this.emit("mute_state_changed",this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit("volume_changed",-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){const e=this.client.getMediaHandler(),n=this.stream.clone();return k.log(`CallFeed clone() cloning stream (originalStreamId=${this.stream.id}, newStreamId${n.id})`),this.purpose===fn.Usermedia?e.userMediaStreams.push(n):e.screensharingStreams.push(n),new tu({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:n,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,n;clearTimeout(this.volumeLooperTimeout),(e=this.stream)==null||e.removeEventListener("addtrack",this.onAddTrack),(n=this.call)==null||n.removeListener(Ds.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,PEe()),this._disposed=!0,this.emit("disposed")}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit("local_volume_changed",e)}}var $l=(t=>(t[t.Blocked=-1]="Blocked",t[t.Unverified=0]="Unverified",t[t.Verified=1]="Verified",t))($l||{});class cJ{constructor(e){this.dehydrated=!1,this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||0,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get(`ed25519:${this.deviceId}`)}getIdentityKey(){return this.keys.get(`curve25519:${this.deviceId}`)}}const S2=class S2{constructor(e){this.deviceId=e,this.algorithms=[],this.keys={},this.verified=$l.Unverified,this.known=!1,this.unsigned={},this.signatures={}}static fromStorage(e,n){const r=new S2(n);for(const i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r}toStorage(){return{algorithms:this.algorithms,keys:this.keys,verified:this.verified,known:this.known,unsigned:this.unsigned,signatures:this.signatures}}getFingerprint(){return this.keys["ed25519:"+this.deviceId]}getIdentityKey(){return this.keys["curve25519:"+this.deviceId]}getDisplayName(){return this.unsigned.device_display_name||null}isBlocked(){return this.verified==$l.Blocked}isVerified(){return this.verified==$l.Verified}isUnverified(){return this.verified==$l.Unverified}isKnown(){return this.known===!0}};S2.DeviceVerification={VERIFIED:$l.Verified,UNVERIFIED:$l.Unverified,BLOCKED:$l.Blocked};let Ys=S2;const AEe=3e3;var Q6=(t=>(t.Incoming="Call.incoming",t))(Q6||{});class LEe{constructor(e){this.nextSeqByCall=new Map,this.toDeviceEventBuffers=new Map,this.onSync=()=>{const n=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(n)):this.eventBufferPromiseChain=this.evaluateEventBuffer(n)},this.onRoomTimeline=n=>{this.callEventBuffer.push(n)},this.onToDeviceEvent=n=>{const r=n.getContent();if(!r.call_id){this.callEventBuffer.push(n);return}if(this.nextSeqByCall.has(r.call_id)||this.nextSeqByCall.set(r.call_id,0),r.seq===void 0){this.callEventBuffer.push(n);return}const i=this.nextSeqByCall.get(r.call_id)||0;if(r.seq!==i){this.toDeviceEventBuffers.has(r.call_id)||this.toDeviceEventBuffers.set(r.call_id,[]);const s=this.toDeviceEventBuffers.get(r.call_id),o=s.findIndex(a=>a.getContent().seq>r.seq);o===-1?s.push(n):s.splice(o,0,n)}else{const s=r.call_id;this.callEventBuffer.push(n),this.nextSeqByCall.set(s,r.seq+1);const o=this.toDeviceEventBuffers.get(s);let a=o&&o.shift();for(;a&&a.getContent().seq===this.nextSeqByCall.get(s);)this.callEventBuffer.push(a),this.nextSeqByCall.set(s,a.getContent().seq+1),a=o.shift()}},this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(qe.Sync,this.onSync),this.client.on(ct.Timeline,this.onRoomTimeline),this.client.on(qe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(qe.Sync,this.onSync),this.client.removeListener(ct.Timeline,this.onRoomTimeline),this.client.removeListener(qe.ToDeviceEvent,this.onToDeviceEvent)}async evaluateEventBuffer(e){await Promise.all(e.map(i=>this.client.decryptEventIfNeeded(i)));const n=e.filter(i=>{const s=i.getType();return s.startsWith("m.call.")||s.startsWith("org.matrix.call.")}),r=new Set;for(const i of n){const s=i.getType();(s===Z.CallAnswer||s===Z.CallHangup)&&r.add(i.getContent().call_id)}for(const i of n){const s=i.getType(),o=i.getContent().call_id;if(!(s===Z.CallInvite&&r.has(o)))try{await this.handleCallEvent(i)}catch(a){k.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",a)}}}async handleCallEvent(e){var d,f,p;this.client.emit(qe.ReceivedVoipEvent,e);const n=e.getContent(),r=e.getRoomId()||((f=(d=this.client.groupCallEventHandler.getGroupCallById(n.conf_id))==null?void 0:d.room)==null?void 0:f.roomId),i=n.conf_id,s=e.getType(),o=e.getSender();let a=n.call_id?this.calls.get(n.call_id):void 0,c,l;if(i){if(l=this.client.groupCallEventHandler.getGroupCallById(i),!l){k.warn(`CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=${i}, type=${s})`);return}if(c=n.device_id,!c){k.warn(`CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=${o})`),l.emit(fC.Error,new fJ(o));return}if(n.dest_session_id!==this.client.getSessionId()){k.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring");return}}const u=o===this.client.credentials.userId&&(c===void 0||c===this.client.getDeviceId());if(r){if(s===Z.CallInvite){if(u||e.getLocalAge()>n.lifetime-AEe||a&&a.state===bo.Ended||(a&&k.warn(`CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=${n.call_id})`),n.invitee&&n.invitee!==this.client.getUserId()))return;const m=(this.client.getTurnServersExpiry()??0)-Date.now();if(k.info("CallEventHandler handleCallEvent() current turn creds expire in "+m+" ms"),a=W0(this.client,r,{forceTURN:this.client.forceTURN,opponentDeviceId:c,groupCallId:i,opponentSessionId:n.sender_session_id})??void 0,!a){k.log(`CallEventHandler handleCallEvent() this client does not support WebRTC (callId=${n.call_id})`);return}a.callId=n.call_id;const v=l==null?void 0:l.getGroupCallStats();v&&a.initStats(v);try{await a.initWithInvite(e)}catch(_){_ instanceof Bl&&(_.code===dJ.UnknownDevice?l==null||l.emit(fC.Error,_):k.error(_))}if(this.calls.set(a.callId,a),this.candidateEventsByCall.get(a.callId))for(const _ of this.candidateEventsByCall.get(a.callId))a.onRemoteIceCandidatesReceived(_);let S;for(const _ of this.calls.values()){const w=[bo.WaitLocalMedia,bo.CreateOffer,bo.InviteSent].includes(_.state);if(a.roomId===_.roomId&&_.direction===hJ.Outbound&&((p=a.getOpponentMember())==null?void 0:p.userId)===_.invitee&&w){S=_;break}}S?S.callId>a.callId?(k.log(`CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=${a.callId}, outgoingId=${S.callId})`),S.replacedBy(a)):(k.log(`CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=${a.callId}, outgoingId=${S.callId})`),a.hangup(Fl.Replaced,!0)):this.client.emit("Call.incoming",a);return}else if(s===Z.CallCandidates){if(u)return;a?a.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(n.call_id)||this.candidateEventsByCall.set(n.call_id,[]),this.candidateEventsByCall.get(n.call_id).push(e));return}else if([Z.CallHangup,Z.CallReject].includes(s)){a?a.state!==bo.Ended&&(s===Z.CallHangup?a.onHangupReceived(n):a.onRejectReceived(n),a.state===bo.Ended&&this.calls.delete(n.call_id)):(a=W0(this.client,r,{opponentDeviceId:c,opponentSessionId:n.sender_session_id})??void 0,a&&(a.callId=n.call_id,a.initWithHangup(e),this.calls.set(n.call_id,a)));return}if(!a||!a.hasPeerConnection){k.info(`CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=${s})`);return}if(e.getContent().party_id!==a.ourPartyId)switch(s){case Z.CallAnswer:u?a.state===bo.Ringing&&a.onAnsweredElsewhere(n):a.onAnswerReceived(e);break;case Z.CallSelectAnswer:a.onSelectAnswerReceived(e);break;case Z.CallNegotiate:a.onNegotiateReceived(e);break;case Z.CallAssertedIdentity:case Z.CallAssertedIdentityPrefix:a.onAssertedIdentityReceived(e);break;case Z.CallSDPStreamMetadataChanged:case Z.CallSDPStreamMetadataChangedPrefix:a.onSDPStreamMetadataChangedReceived(e);break}}}}var eM=(t=>(t.Incoming="GroupCall.incoming",t.Outgoing="GroupCall.outgoing",t.Ended="GroupCall.ended",t.Participants="GroupCall.participants",t))(eM||{});class DEe{constructor(e){this.client=e,this.groupCalls=new Map,this.roomDeferreds=new Map,this.onRoomsChanged=n=>{this.createGroupCallForRoom(n)},this.onRoomStateChanged=(n,r)=>{if(n.getType()===Z.GroupCallPrefix){const s=n.getStateKey(),o=n.getContent(),a=this.groupCalls.get(r.roomId);!a&&!o["m.terminated"]&&!n.isRedacted()?this.createGroupCallFromRoomStateEvent(n):a&&a.groupCallId===s?o["m.terminated"]||n.isRedacted()?a.terminate(!1):o["m.type"]!==a.type&&k.warn(`GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=${r.roomId})`):a&&a.groupCallId!==s&&k.warn(`GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=${r.roomId})`)}}}async start(){this.client.getSyncState()!==ii.Syncing&&(k.debug("GroupCallEventHandler start() waiting for client to start syncing"),await new Promise(n=>{const r=()=>{if(this.client.getSyncState()===ii.Syncing)return this.client.off(qe.Sync,r),n()};this.client.on(qe.Sync,r)}));const e=this.client.getRooms();for(const n of e)this.createGroupCallForRoom(n);this.client.on(qe.Room,this.onRoomsChanged),this.client.on(xt.Events,this.onRoomStateChanged)}stop(){this.client.removeListener(qe.Room,this.onRoomsChanged),this.client.removeListener(xt.Events,this.onRoomStateChanged)}getRoomDeferred(e){let n=this.roomDeferreds.get(e);if(n===void 0){let r;n={prom:new Promise(i=>{r=i})},n.resolve=r,this.roomDeferreds.set(e,n)}return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(n=>n.groupCallId===e)}createGroupCallForRoom(e){const n=e.currentState.getStateEvents(Z.GroupCallPrefix),r=n.sort((i,s)=>s.getTs()-i.getTs());for(const i of r)if(!(i.getContent()["m.terminated"]||i.isRedacted())){k.debug(`GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=${i.getStateKey()}, ts=${i.getTs()}, roomId=${e.roomId}, numOfPossibleCalls=${n.length})`),this.createGroupCallFromRoomStateEvent(i);break}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){const n=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(n);if(!i){k.warn(`GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=${n})`);return}const s=e.getStateKey(),o=r["m.type"];if(!Object.values(B2).includes(o)){k.warn(`GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=${o}, roomId=${n})`);return}const a=r["m.intent"];if(!Object.values(w4).includes(a)){k.warn(`Received invalid group call intent (type=${o}, roomId=${n})`);return}const c=!!r["io.element.ptt"];let l;if(r!=null&&r.dataChannelsEnabled&&(r!=null&&r.dataChannelOptions)){const{ordered:d,maxPacketLifeTime:f,maxRetransmits:p,protocol:m}=r.dataChannelOptions;l={ordered:d,maxPacketLifeTime:f,maxRetransmits:p,protocol:m}}const u=new T4(this.client,i,o,c,a,s,(r==null?void 0:r.dataChannelsEnabled)||this.client.isVoipWithNoMediaAllowed,l,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,r["io.element.livekit_service_url"]);return this.groupCalls.set(i.roomId,u),this.client.emit("GroupCall.incoming",u),u}}class NEe{constructor(){this.bandwidth={},this.bitrate={},this.packetLoss={},this.transport=[]}}class UEe{static buildBandwidthReport(e){const n=e.availableIncomingBitrate,r=e.availableOutgoingBitrate;return{download:n?Math.round(n/1e3):0,upload:r?Math.round(r/1e3):0}}}class $Ee{static buildReport(e,n,r,i){const s=e==null?void 0:e.get(n.localCandidateId),o=e==null?void 0:e.get(n.remoteCandidateId);if(o&&s){const a=o.ip!==void 0?o.ip:o.address,c=o.port,l=`${a}:${c}`,u=s.ip!==void 0?s.ip:s.address,d=s.port,f=`${u}:${d}`,p=o.protocol;r.some(m=>m.ip===l&&m.type===p&&m.localIp===f)||r.push({ip:l,type:p,localIp:f,isFocus:i,localCandidateType:s.candidateType,remoteCandidateType:o.candidateType,networkType:s.networkType,rtt:n.currentRoundTripTime?n.currentRoundTripTime*1e3:NaN})}return r}}class FEe{constructor(){this.ssrcToMid={local:new Map,remote:new Map}}findMidBySsrc(e,n){let r;return this.ssrcToMid[n].forEach((i,s)=>{if(i.find(o=>o==e)){r=s;return}}),r}parse(e,n){const r=sJ(e),i=new Map;r.media.forEach(s=>{var o;if(s.mid&&s.type==="video"||s.type==="audio"){const a=[];(o=s.ssrcs)==null||o.forEach(c=>{c.attribute==="cname"&&a.push(`${c.id}`)}),i.set(`${s.mid}`,a)}}),this.ssrcToMid[n]=i}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class BEe{constructor(e){this.pc=e}getLocalTracks(e){const n=r=>r!==null&&r.kind===e;return this.pc.getTransceivers().filter(r=>r.currentDirection==="sendonly"||r.currentDirection==="sendrecv").filter(r=>r.sender!==null).map(r=>r.sender).map(r=>r.track).filter(n)}getTackById(e){return this.pc.getTransceivers().map(n=>{if((n==null?void 0:n.sender.track)!==null&&n.sender.track.id===e)return n.sender.track;if((n==null?void 0:n.receiver.track)!==null&&n.receiver.track.id===e)return n.receiver.track}).find(n=>n!==void 0)}getLocalTrackIdByMid(e){const n=this.pc.getTransceivers().find(r=>r.mid===e);if(n!==void 0&&n.sender&&n.sender.track)return n.sender.track.id}getRemoteTrackIdByMid(e){const n=this.pc.getTransceivers().find(r=>r.mid===e);if(n!==void 0&&n.receiver&&n.receiver.track)return n.receiver.track.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(n=>n.receiver.track.id===e||n.sender.track!==null&&n.sender.track.id===e)}}class jEe{constructor(e,n,r){this.trackId=e,this.type=n,this.kind=r,this.loss={packetsTotal:0,packetsLost:0,isDownloadStream:!1},this.bitrate={download:0,upload:0},this.resolution={width:-1,height:-1},this.audioConcealment={concealedAudio:0,totalAudioDuration:0},this.framerate=0,this.jitter=0,this.codec="",this.isAlive=!0,this.isMuted=!1,this.isEnabled=!0}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,n){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=n}getAudioConcealment(){return this.audioConcealment}}class HEe{constructor(e,n){this.mediaSsrcHandler=e,this.mediaTrackHandler=n,this.track2stats=new Map}findTrack2Stats(e,n){let r;if(e.trackIdentifier)r=e.trackIdentifier;else if(e.mid)r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){if(!this.mediaSsrcHandler.findMidBySsrc(e.ssrc,n))return;r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(!r)return;let i=this.track2stats.get(r);if(!i){const s=this.mediaTrackHandler.getTackById(r);if(s!==void 0){const o=s.kind==="audio"?s.kind:"video";i=new jEe(r,n,o),this.track2stats.set(r,i)}else return}return i}findLocalVideoTrackStats(e){if(this.mediaTrackHandler.getLocalTracks("video").length!==0)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class oh{static getNonNegativeValue(e){let n=e;return typeof n!="number"&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)}}class po{static buildFramerateResolution(e,n){const r={height:n.frameHeight,width:n.frameWidth},i=n.framesPerSecond;r.height&&r.width&&e.setResolution(r),e.setFramerate(Math.round(i||0))}static calculateSimulcastFramerate(e,n,r,i){let s=e.getFramerate();if(!s){if(r){const o=n.timestamp-r.timestamp;o>0&&n.framesSent&&(s=(n.framesSent-r.framesSent)/o*1e3)}if(!s)return}s=i?Math.round(s/i):0,e.setFramerate(s)}static buildCodec(e,n,r){const i=e==null?void 0:e.get(r.codecId);if(i){const s=i.mimeType.split("/")[1];s&&n.setCodec(s)}}static buildBitrateReceived(e,n,r){e.setBitrate({download:po.calculateBitrate(n.bytesReceived,r.bytesReceived,n.timestamp,r.timestamp),upload:0})}static buildBitrateSend(e,n,r){e.setBitrate({download:0,upload:this.calculateBitrate(n.bytesSent,r.bytesSent,n.timestamp,r.timestamp)})}static buildPacketsLost(e,n,r){const i=n.type==="outbound-rtp"?"packetsSent":"packetsReceived";let s=n[i];(!s||s<0)&&(s=0);const o=oh.getNonNegativeValue(r[i]),a=Math.max(0,s-o),c=oh.getNonNegativeValue(n.packetsLost),l=oh.getNonNegativeValue(r.packetsLost),u=Math.max(0,c-l);e.setLoss({packetsTotal:a+u,packetsLost:u,isDownloadStream:n.type!=="outbound-rtp"})}static calculateBitrate(e,n,r,i){const s=oh.getNonNegativeValue(e),o=oh.getNonNegativeValue(n),a=Math.max(0,s-o),c=r-i;let l=0;return c>0&&(l=Math.round(a*8/c)),l}static setTrackStatsState(e,n){var i;if(n===void 0){e.alive=!1;return}const r=e.getType()==="remote"?n.receiver.track:(i=n==null?void 0:n.sender)==null?void 0:i.track;if(r==null){e.alive=!1;return}if(r.readyState==="ended"){e.alive=!1;return}e.muted=r.muted,e.enabled=r.enabled,e.alive=!0}static buildTrackSummary(e){const n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},i=e.filter(o=>o.getType()==="remote"),s=i.filter(o=>o.kind==="audio");return i.forEach(o=>{var c,l;const a=o.kind==="video"?n:r;a.count++,o.alive&&o.muted&&a.muted++,a.maxJitter<o.getJitter()&&(a.maxJitter=o.getJitter()),a.maxPacketLoss<o.getLoss().packetsLost&&(a.maxPacketLoss=o.getLoss().packetsLost),s.length>0&&(a.concealedAudio+=(c=o.getAudioConcealment())==null?void 0:c.concealedAudio,a.totalAudio+=(l=o.getAudioConcealment())==null?void 0:l.totalAudioDuration)}),{audioTrackSummary:r,videoTrackSummary:n}}static buildJitter(e,n){if(n.type!=="inbound-rtp")return;const r=n==null?void 0:n.jitter;if(r!==void 0){const i=oh.getNonNegativeValue(r);e.setJitter(Math.round(i*1e3))}else e.setJitter(-1)}static buildAudioConcealment(e,n){if(n.type!=="inbound-rtp")return;const i=1e3*(n==null?void 0:n.totalSamplesDuration)/(n==null?void 0:n.totalSamplesReceived)*(n==null?void 0:n.concealedSamples),s=1e3*(n==null?void 0:n.totalSamplesDuration);e.setAudioConcealment(i,s)}}class J1{static build(e){const n={},r={download:0,upload:0},i={download:0,upload:0};let s=0,o=0;const a={local:new Map,remote:new Map},c={local:new Map,remote:new Map},l={local:new Map,remote:new Map},u=new Map,d=new Map;let f=0,p=0,m=0,v=0,S=0,_=0;for(const[w,T]of e){const C=T.getLoss(),I=C.isDownloadStream?"download":"upload";if(r[I]+=C.packetsTotal,i[I]+=C.packetsLost,s+=T.getBitrate().download,o+=T.getBitrate().upload,T.kind==="audio"){const R=T.getAudioConcealment();S+=R.concealedAudio,_+=R.totalAudioDuration,f+=T.getBitrate().download,p+=T.getBitrate().upload}else m+=T.getBitrate().download,v+=T.getBitrate().upload;a[T.getType()].set(w,T.getResolution()),c[T.getType()].set(w,T.getFramerate()),l[T.getType()].set(w,T.getCodec()),T.getType()==="remote"&&(u.set(w,T.getJitter()),T.kind==="audio"&&d.set(w,T.getAudioConcealment())),T.resetBitrate()}return n.bitrate={upload:o,download:s},n.bitrate.audio={upload:p,download:f},n.bitrate.video={upload:v,download:m},n.packetLoss={total:J1.calculatePacketLoss(i.download+i.upload,r.download+r.upload),download:J1.calculatePacketLoss(i.download,r.download),upload:J1.calculatePacketLoss(i.upload,r.upload)},n.audioConcealment=d,n.totalAudioConcealment={concealedAudio:S,totalAudioDuration:_},n.framerate=c,n.resolution=a,n.codec=l,n.jitter=u,n}static calculatePacketLoss(e,n){return!n||n<=0||!e||e<=0?0:Math.round(e/n*100)}}class xd{static buildCallFeedReport(e,n,r){const i=r.getTransceivers(),s=[],o=[];return i.forEach(a=>{var u;const c=(u=a.sender)!=null&&u.track?xd.buildTrackStats(a.sender.track,"sender"):null,l=xd.buildTrackStats(a.receiver.track,"receiver");s.push({mid:a.mid==null?"null":a.mid,direction:a.direction,currentDirection:a.currentDirection==null?"null":a.currentDirection,sender:c,receiver:l})}),{callId:e,opponentMemberId:n,transceiver:s,callFeeds:o}}static buildTrackStats(e,n="--"){var s,o;const r=(s=e.getSettings())==null?void 0:s.deviceId,i=(o=e.getConstraints())==null?void 0:o.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:r||"unknown",constrainDeviceId:i||"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:n}}static expandCallFeedReport(e,n,r="unknown"){return e.callFeeds||(e.callFeeds=[]),n.forEach(i=>{const s=i.stream.getAudioTracks(),o=i.stream.getVideoTracks(),a=s.length>0?xd.buildTrackStats(i.stream.getAudioTracks()[0],i.purpose):null,c=o.length>0?xd.buildTrackStats(i.stream.getVideoTracks()[0],i.purpose):null,l={stream:i.stream.id,type:i.isLocal()?"local":"remote",audio:a,video:c,purpose:i.purpose,prefix:r,isVideoMuted:i.isVideoMuted(),isAudioMuted:i.isAudioMuted()};e.callFeeds.push(l)}),e}}class KEe{constructor(e,n,r,i,s=!0){this.callId=e,this.opponentMemberId=n,this.pc=r,this.emitter=i,this.isFocus=s,this.isActive=!0,this.connectionStats=new NEe,r.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new HEe(new FEe,new BEe(r))}async processStats(e,n){const r={isFirstCollection:this.previousStatsReport===void 0,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(this.isActive){const i=this.pc.getStats();if(typeof(i==null?void 0:i.then)=="function")return i.then(s=>{var a,c;this.currentStatsReport=typeof(s==null?void 0:s.result)=="function"?s.result():s;try{this.processStatsReport(e,n)}catch(l){return this.handleError(l),r}this.previousStatsReport=this.currentStatsReport,r.receivedMedia=this.connectionStats.bitrate.download,r.receivedAudioMedia=((a=this.connectionStats.bitrate.audio)==null?void 0:a.download)||0,r.receivedVideoMedia=((c=this.connectionStats.bitrate.video)==null?void 0:c.download)||0;const o=po.buildTrackSummary(Array.from(this.trackStats.getTrack2stats().values()));return{...r,audioTrackSummary:o.audioTrackSummary,videoTrackSummary:o.videoTrackSummary}}).catch(s=>(this.handleError(s),r));this.isActive=!1}return Promise.resolve(r)}processStatsReport(e,n){var i;const r=new Map;r.callId=this.callId,r.opponentMemberId=this.opponentMemberId,(i=this.currentStatsReport)==null||i.forEach(s=>{const o=this.previousStatsReport?this.previousStatsReport.get(s.id):null;if(s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded")this.connectionStats.bandwidth=UEe.buildBandwidthReport(s),this.connectionStats.transport=$Ee.buildReport(this.currentStatsReport,s,this.connectionStats.transport,this.isFocus);else if(s.type==="inbound-rtp"||s.type==="outbound-rtp"){const a=this.trackStats.findTrack2Stats(s,s.type==="inbound-rtp"?"remote":"local");if(!a)return;if(o&&po.buildPacketsLost(a,s,o),s.type==="inbound-rtp"){po.buildFramerateResolution(a,s),o&&po.buildBitrateReceived(a,s,o);const c=this.trackStats.findTransceiverByTrackId(a.trackId);po.setTrackStatsState(a,c),po.buildJitter(a,s),po.buildAudioConcealment(a,s)}else o&&(r.set(a.trackId,oh.getNonNegativeValue(s.bytesSent)),po.buildBitrateSend(a,s,o));po.buildCodec(this.currentStatsReport,a,s)}else if(s.type==="track"&&s.kind==="video"&&!s.remoteSource){const a=this.trackStats.findLocalVideoTrackStats(s);if(!a)return;po.buildFramerateResolution(a,s),po.calculateSimulcastFramerate(a,s,o,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(r),this.emitter.emitCallFeedReport(xd.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,k.warn(`CallStatsReportGatherer ${this.callId} processStatsReport fails and set to inactive ${e}`)}processAndEmitConnectionStatsReport(){const e=J1.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport({...e,transport:this.connectionStats.transport}),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){this.pc.signalingState==="stable"&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var Zc=(t=>(t.CONNECTION_STATS="StatsReport.connection_stats",t.CALL_FEED_REPORT="StatsReport.call_feed_report",t.BYTE_SENT_STATS="StatsReport.byte_sent_stats",t.SUMMARY_STATS="StatsReport.summary_stats",t))(Zc||{});class VEe extends Fn{emitByteSendReport(e){this.emit(Zc.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(Zc.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(Zc.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(Zc.SUMMARY_STATS,e)}}class lJ{constructor(e){this.emitter=e}build(e){const n=e.filter(u=>!u.isFirstCollection),r=n.length,i=e.length;if(r===0)return;const s={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0};let o=0,a=0;n.forEach(u=>{this.countTrackListReceivedMedia(s,u),this.countConcealedAudio(s,u),o=this.buildMaxJitter(o,u),a=this.buildMaxPacketLoss(a,u)});const c=5,l={percentageReceivedMedia:Number((s.receivedMedia/r).toFixed(c)),percentageReceivedVideoMedia:Number((s.receivedVideo/r).toFixed(c)),percentageReceivedAudioMedia:Number((s.receivedAudio/r).toFixed(c)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(s.totalAudio>0?(s.concealedAudio/s.totalAudio).toFixed(c):0),peerConnections:i};this.emitter.emitSummaryStatsReport(l)}static extendSummaryReport(e,n){const r=[],i=[];for(const s of n){i.push(s);for(const o of s[1])r.push(o)}e.opponentDevicesInCall=Math.max(0,r.length-1),e.opponentUsersInCall=Math.max(0,i.length-1),e.diffDevicesToPeerConnections=Math.max(0,r.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=Math.max(0,r.length-1)==0?0:e.peerConnections/(r.length-1)}countTrackListReceivedMedia(e,n){let r=!1,i=!1;(n.receivedAudioMedia>0||n.audioTrackSummary.count===0)&&(e.receivedAudio++,r=!0),(n.receivedVideoMedia>0||n.videoTrackSummary.count===0||n.videoTrackSummary.muted>0&&n.videoTrackSummary.muted===n.videoTrackSummary.count)&&(e.receivedVideo++,i=!0),i&&r&&e.receivedMedia++}buildMaxJitter(e,n){return e<n.videoTrackSummary.maxJitter&&(e=n.videoTrackSummary.maxJitter),e<n.audioTrackSummary.maxJitter&&(e=n.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,n){return e<n.videoTrackSummary.maxPacketLoss&&(e=n.videoTrackSummary.maxPacketLoss),e<n.audioTrackSummary.maxPacketLoss&&(e=n.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,n){e.concealedAudio+=n.audioTrackSummary.concealedAudio,e.totalAudio+=n.audioTrackSummary.totalAudio}}class qEe{constructor(e,n,r=1e4){this.groupCallId=e,this.userId=n,this.interval=r,this.gatherers=new Map,this.reports=new VEe,this.summaryStatsReportGatherer=new lJ(this.reports)}start(){this.timer===void 0&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,n,r){return this.hasStatsReportGatherer(e)?!1:(this.gatherers.set(e,new KEe(e,n,r,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,n){var r;(r=this.getStatsReportGatherer(e))==null||r.setOpponentMemberId(n)}processStats(){const e=[];this.gatherers.forEach(n=>{e.push(n.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(n=>this.summaryStatsReportGatherer.build(n)).catch(n=>{k.error("Could not build summary stats report",n)})}setInterval(e){this.interval=e}}var w4=(t=>(t.Ring="m.ring",t.Prompt="m.prompt",t.Room="m.room",t))(w4||{}),B2=(t=>(t.Video="m.video",t.Voice="m.voice",t))(B2||{}),fC=(t=>(t.GroupCallStateChanged="group_call_state_changed",t.ActiveSpeakerChanged="active_speaker_changed",t.CallsChanged="calls_changed",t.UserMediaFeedsChanged="user_media_feeds_changed",t.ScreenshareFeedsChanged="screenshare_feeds_changed",t.LocalScreenshareStateChanged="local_screenshare_state_changed",t.LocalMuteStateChanged="local_mute_state_changed",t.ParticipantsChanged="participants_changed",t.Error="group_call_error",t))(fC||{}),uJ=(t=>(t.ConnectionStats="GroupCall.connection_stats",t.ByteSentStats="GroupCall.byte_sent_stats",t.SummaryStats="GroupCall.summary_stats",t.CallFeedStats="GroupCall.call_feed_stats",t))(uJ||{}),dJ=(t=>(t.NoUserMedia="no_user_media",t.UnknownDevice="unknown_device",t.PlaceCallFailed="place_call_failed",t))(dJ||{});class tM extends Error{constructor(e,n,r){r?super(n+": "+r):super(n),this.code=e}}class fJ extends tM{constructor(e){super("unknown_device","No device found for "+e),this.userId=e}}var E4=(t=>(t.LocalCallFeedUninitialized="local_call_feed_uninitialized",t.InitializingLocalCallFeed="initializing_local_call_feed",t.LocalCallFeedInitialized="local_call_feed_initialized",t.Entered="entered",t.Ended="ended",t))(E4||{});const _F=1e3*60*60;function ow(t){var e;return((e=t.getOpponentMember())==null?void 0:e.userId)||t.invitee||null}class T4 extends Fn{constructor(e,n,r,i,s,o,a,c,l,u=!1,d){var f;super(),this.client=e,this.room=n,this.type=r,this.isPtt=i,this.intent=s,this.dataChannelsEnabled=a,this.dataChannelOptions=c,this.useLivekit=u,this.activeSpeakerInterval=1e3,this.retryCallInterval=5e3,this.participantTimeout=1e3*15,this.pttMaxTransmitTime=1e3*20,this.userMediaFeeds=[],this.screenshareFeeds=[],this.calls=new Map,this.callHandlers=new Map,this.retryCallCounts=new Map,this.transmitTimer=null,this.participantsExpirationTimer=null,this.resendMemberStateTimer=null,this.initWithAudioMuted=!1,this.initWithVideoMuted=!1,this.statsCollectIntervalTime=0,this.onConnectionStats=p=>{this.emit("GroupCall.connection_stats",{report:p})},this.onByteSentStats=p=>{this.emit("GroupCall.byte_sent_stats",{report:p})},this.onSummaryStats=p=>{lJ.extendSummaryReport(p,this.participants),this.emit("GroupCall.summary_stats",{report:p})},this.onCallFeedReport=p=>{this.localCallFeed&&(p=xd.expandCallFeedReport(p,[this.localCallFeed],"from-local-feed"));const m=[];this.forEachCall(v=>{v.callId===p.callId&&v.getFeeds().forEach(S=>m.push(S))}),p=xd.expandCallFeedReport(p,m,"from-call-feed"),this.emit("GroupCall.call_feed_stats",{report:p})},this._state="local_call_feed_uninitialized",this._participants=new Map,this._creationTs=null,this._enteredViaAnotherSession=!1,this.onIncomingCall=p=>{var w;if(p.roomId!==this.room.roomId)return;if(p.state!==bo.Ringing){k.warn(`GroupCall ${this.groupCallId} onIncomingCall() incoming call no longer in ringing state - ignoring`);return}if(!p.groupCallId||p.groupCallId!==this.groupCallId){k.log(`GroupCall ${this.groupCallId} onIncomingCall() ignored because it doesn't match the current group call`),p.reject();return}const m=(w=p.getOpponentMember())==null?void 0:w.userId;if(m===void 0){k.warn(`GroupCall ${this.groupCallId} onIncomingCall() incoming call with no member - ignoring`);return}if(this.useLivekit){k.info("Received incoming call whilst in signaling-only mode! Ignoring.");return}const v=this.calls.get(m)??new Map,S=v.get(p.getOpponentDeviceId());if((S==null?void 0:S.callId)===p.callId)return;k.log(`GroupCall ${this.groupCallId} onIncomingCall() incoming call (userId=${m}, callId=${p.callId})`),S&&S.hangup(Fl.Replaced,!1),v.set(p.getOpponentDeviceId(),p),this.calls.set(m,v),this.initCall(p);const _=this.getLocalFeeds().map(T=>T.clone());if(!this.callExpected(p))for(const T of _)Ir(T.stream.getAudioTracks(),!1),Ir(T.stream.getVideoTracks(),!1);p.answerWithCallFeeds(_),this.emit("calls_changed",this.calls)},this.onRetryCallLoop=()=>{let p=!1;for(const[{userId:m},v]of this.participants){const S=this.calls.get(m);let _=this.retryCallCounts.get(m);for(const[w,T]of v){const C=S==null?void 0:S.get(w),I=(_==null?void 0:_.get(w))??0;(C==null?void 0:C.getOpponentSessionId())!==T.sessionId&&this.wantsOutgoingCall(m,w)&&I<3&&(_===void 0&&(_=new Map,this.retryCallCounts.set(m,_)),_.set(w,I+1),p=!0)}}p&&this.placeOutgoingCalls()},this.onCallFeedsChanged=p=>{const m=ow(p),v=p.getOpponentDeviceId();if(!m)throw new Error("Cannot change call feeds without user id");const S=this.getUserMediaFeed(m,v),_=p.remoteUsermediaFeed,w=_!==S,T=this.calls.get(m),C=T==null?void 0:T.get(v);if((C==null?void 0:C.callId)!==p.callId)return;w&&(!S&&_?this.addUserMediaFeed(_):S&&_?this.replaceUserMediaFeed(S,_):S&&!_&&this.removeUserMediaFeed(S));const I=this.getScreenshareFeed(m,v),R=p.remoteScreensharingFeed;R!==I&&(!I&&R?this.addScreenshareFeed(R):I&&R?this.replaceScreenshareFeed(I,R):I&&!R&&this.removeScreenshareFeed(I))},this.onCallStateChanged=(p,m,v)=>{var T;if(m===bo.Ended)return;const S=this.localCallFeed.isAudioMuted();p.localUsermediaStream&&p.isMicrophoneMuted()!==S&&p.setMicrophoneMuted(S);const _=this.localCallFeed.isVideoMuted();p.localUsermediaStream&&p.isLocalVideoMuted()!==_&&p.setLocalVideoMuted(_);const w=(T=p.getOpponentMember())==null?void 0:T.userId;if(m===bo.Connected&&w){const C=this.retryCallCounts.get(w);C==null||C.delete(p.getOpponentDeviceId()),(C==null?void 0:C.size)===0&&this.retryCallCounts.delete(w)}},this.onCallHangup=p=>{var S;if(p.hangupReason===Fl.Replaced)return;const m=((S=p.getOpponentMember())==null?void 0:S.userId)??this.room.getMember(p.invitee).userId,v=this.calls.get(m);(v==null?void 0:v.get(p.getOpponentDeviceId()))===p&&(this.disposeCall(p,p.hangupReason),v.delete(p.getOpponentDeviceId()),v.size===0&&this.calls.delete(m),this.emit("calls_changed",this.calls))},this.onCallReplaced=(p,m)=>{const v=p.getOpponentMember().userId;let S=this.calls.get(v);S===void 0&&(S=new Map,this.calls.set(v,S)),p.hangup(Fl.Replaced,!1),this.initCall(m),S.set(p.getOpponentDeviceId(),m),this.emit("calls_changed",this.calls)},this.onActiveSpeakerLoop=()=>{let p,m;for(const v of this.userMediaFeeds){if(v.isLocal()&&this.userMediaFeeds.length>1)continue;const _=v.speakingVolumeSamples.reduce((w,T)=>w+Math.max(T,Z6))/v.speakingVolumeSamples.length;(!p||_>p)&&(p=_,m=v)}m&&this.activeSpeaker!==m&&p&&p>Z6&&(this.activeSpeaker=m,this.emit("active_speaker_changed",this.activeSpeaker))},this.onRoomState=()=>this.updateParticipants(),this.onParticipantsChanged=()=>{this.forEachCall(p=>{const m=this.callExpected(p);for(const v of p.getLocalFeeds())Ir(v.stream.getAudioTracks(),!v.isAudioMuted()&&m),Ir(v.stream.getVideoTracks(),!v.isVideoMuted()&&m)}),this.state==="entered"&&!this.useLivekit&&this.placeOutgoingCalls()},this.onStateChanged=(p,m)=>{(p==="entered"||m==="entered"||p==="ended")&&(this.updateParticipants(),this.updateMemberState().catch(v=>k.error(`GroupCall ${this.groupCallId} onStateChanged() failed to update member state devices"`,v)))},this.onLocalFeedsChanged=()=>{this.state==="entered"&&this.updateMemberState().catch(p=>k.error(`GroupCall ${this.groupCallId} onLocalFeedsChanged() failed to update member state feeds`,p))},this.reEmitter=new CY(this),this.groupCallId=o??ah(),this._livekitServiceURL=d,this.creationTs=((f=n.currentState.getStateEvents(Z.GroupCallPrefix,this.groupCallId))==null?void 0:f.getTs())??null,this.updateParticipants(),n.on(xt.Update,this.onRoomState),this.on("participants_changed",this.onParticipantsChanged),this.on("group_call_state_changed",this.onStateChanged),this.on("local_screenshare_state_changed",this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}async create(){return this.creationTs=Date.now(),this.client.groupCallEventHandler.groupCalls.set(this.room.roomId,this),this.client.emit(eM.Outgoing,this),await this.sendCallStateEvent(),this}async sendCallStateEvent(){const e={"m.intent":this.intent,"m.type":this.type,"io.element.ptt":this.isPtt,dataChannelsEnabled:this.dataChannelsEnabled,dataChannelOptions:this.dataChannelsEnabled?this.dataChannelOptions:void 0};this.livekitServiceURL&&(e["io.element.livekit_service_url"]=this.livekitServiceURL),await this.client.sendStateEvent(this.room.roomId,Z.GroupCallPrefix,e,this.groupCallId)}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){const n=this._state;e!==n&&(this._state=e,this.emit("group_call_state_changed",e,n))}get participants(){return this._participants}set participants(e){const n=this._participants,r=(s,o)=>s.sessionId===o.sessionId&&s.screensharing===o.screensharing;F$(e,n,(s,o)=>F$(s,o,r))||(this._participants=e,this.emit("participants_changed",e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(const n of this.calls.values())for(const r of n.values())e(r)}getLocalFeeds(){const e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e;return((e=this.participants.get(this.room.getMember(this.client.getUserId())))==null?void 0:e.has(this.client.getDeviceId()))??!1}callExpected(e){var s;const n=ow(e),r=n===null?null:this.room.getMember(n),i=e.getOpponentDeviceId();return r!==null&&i!==void 0&&((s=this.participants.get(r))==null?void 0:s.get(i))!==void 0}async initLocalCallFeed(){if(this.useLivekit){k.info("Livekit group call: not starting local call feed.");return}if(this.state!=="local_call_feed_uninitialized")throw new Error(`Cannot initialize local call feed in the "${this.state}" state.`);if(this.state="initializing_local_call_feed",this.initCallFeedPromise)return this.initCallFeedPromise;try{this.initCallFeedPromise=this.initLocalCallFeedInternal(),await this.initCallFeedPromise}finally{this.initCallFeedPromise=void 0}}async initLocalCallFeedInternal(){k.log(`GroupCall ${this.groupCallId} initLocalCallFeedInternal() running`);let e;try{e=await this.client.getMediaHandler().getUserMediaStream(!0,this.type==="m.video")}catch(r){if(this.allowCallWithoutVideoAndAudio)e=new MediaStream;else throw this.state="local_call_feed_uninitialized",r}if(this._state!=="initializing_local_call_feed")throw this.client.getMediaHandler().stopUserMediaStream(e),new Error("Group call disposed while gathering media stream");const n=new tu({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:e,purpose:fn.Usermedia,audioMuted:this.initWithAudioMuted||e.getAudioTracks().length===0||this.isPtt,videoMuted:this.initWithVideoMuted||e.getVideoTracks().length===0});Ir(e.getAudioTracks(),!n.isAudioMuted()),Ir(e.getVideoTracks(),!n.isVideoMuted()),this.localCallFeed=n,this.addUserMediaFeed(n),this.state="local_call_feed_initialized"}async updateLocalUsermediaStream(e){if(this.localCallFeed){const n=this.localCallFeed.stream;this.localCallFeed.setNewStream(e);const r=this.localCallFeed.isAudioMuted(),i=this.localCallFeed.isVideoMuted();k.log(`GroupCall ${this.groupCallId} updateLocalUsermediaStream() (oldStreamId=${n.id}, newStreamId=${e.id}, micShouldBeMuted=${r}, vidShouldBeMuted=${i})`),Ir(e.getAudioTracks(),!r),Ir(e.getVideoTracks(),!i),this.client.getMediaHandler().stopUserMediaStream(n)}}async enter(){if(this.state==="local_call_feed_uninitialized")await this.initLocalCallFeed();else if(this.state!=="local_call_feed_initialized")throw new Error(`Cannot enter call in the "${this.state}" state`);k.log(`GroupCall ${this.groupCallId} enter() running`),this.state="entered",this.client.on(Q6.Incoming,this.onIncomingCall);for(const e of this.client.callEventHandler.calls.values())this.onIncomingCall(e);this.useLivekit||(this.retryCallLoopInterval=setInterval(this.onRetryCallLoop,this.retryCallInterval),this.activeSpeaker=void 0,this.onActiveSpeakerLoop(),this.activeSpeakerLoopInterval=setInterval(this.onActiveSpeakerLoop,this.activeSpeakerInterval))}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),this.transmitTimer!==null&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),this.retryCallLoopInterval!==void 0&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state==="entered"&&(this.forEachCall(n=>n.hangup(Fl.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(Q6.Incoming,this.onIncomingCall),(e=this.stats)==null||e.stop())}leave(){this.dispose(),this.state="local_call_feed_uninitialized"}async terminate(e=!0){if(this.dispose(),this.room.off(xt.Update,this.onRoomState),this.client.groupCallEventHandler.groupCalls.delete(this.room.roomId),this.client.emit(eM.Ended,this),this.state="ended",e){const n=this.room.currentState.getStateEvents(Z.GroupCallPrefix,this.groupCallId);await this.client.sendStateEvent(this.room.roomId,Z.GroupCallPrefix,{...n.getContent(),"m.terminated":"call_ended"},this.groupCallId)}}isLocalVideoMuted(){return this.localCallFeed?this.localCallFeed.isVideoMuted():!0}isMicrophoneMuted(){return this.localCallFeed?this.localCallFeed.isAudioMuted():!0}async setMicrophoneMuted(e){if(!e&&!await this.client.getMediaHandler().hasAudioDevice())return!1;const n=!e&&this.isPtt;this.isPtt&&(!e&&this.isMicrophoneMuted()?this.transmitTimer=setTimeout(()=>{this.setMicrophoneMuted(!0)},this.pttMaxTransmitTime):e&&!this.isMicrophoneMuted()&&(this.transmitTimer!==null&&clearTimeout(this.transmitTimer),this.transmitTimer=null)),this.forEachCall(i=>{var s;return(s=i.localUsermediaFeed)==null?void 0:s.setAudioVideoMuted(e,null)});const r=async()=>{const i=[];this.forEachCall(s=>i.push(s.sendMetadataUpdate())),await Promise.all(i).catch(s=>k.info(`GroupCall ${this.groupCallId} setMicrophoneMuted() failed to send some metadata updates`,s))};if(n&&await r(),this.localCallFeed){if(k.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() (streamId=${this.localCallFeed.stream.id}, muted=${e})`),!await this.checkAudioPermissionIfNecessary(e))return!1;this.localCallFeed.setAudioVideoMuted(e,null),Ir(this.localCallFeed.stream.getAudioTracks(),!e)}else k.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no stream muted (muted=${e})`),this.initWithAudioMuted=e;return this.forEachCall(i=>Ir(i.localUsermediaFeed.stream.getAudioTracks(),!e&&this.callExpected(i))),this.emit("local_mute_state_changed",e,this.isLocalVideoMuted()),n||await r(),!0}async checkAudioPermissionIfNecessary(e){try{if(!e&&this.localCallFeed&&!this.localCallFeed.hasAudioTrack){const n=await this.client.getMediaHandler().getUserMediaStream(!0,!this.localCallFeed.isVideoMuted());if((n==null?void 0:n.getTracks().length)===0)return k.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no device to receive local stream, muted=${e}`),!1}}catch{return k.log(`GroupCall ${this.groupCallId} setMicrophoneMuted() no device or permission to receive local stream, muted=${e}`),!1}return!0}async setLocalVideoMuted(e){if(!e&&!await this.client.getMediaHandler().hasVideoDevice())return!1;if(this.localCallFeed){k.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() (stream=${this.localCallFeed.stream.id}, muted=${e})`);try{const r=await this.client.getMediaHandler().getUserMediaStream(!0,!e);await this.updateLocalUsermediaStream(r),this.localCallFeed.setAudioVideoMuted(null,e),Ir(this.localCallFeed.stream.getVideoTracks(),!e)}catch{return k.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() no device or permission to receive local stream, muted=${e}`),!1}}else k.log(`GroupCall ${this.groupCallId} setLocalVideoMuted() no stream muted (muted=${e})`),this.initWithVideoMuted=e;const n=[];return this.forEachCall(r=>n.push(r.setLocalVideoMuted(e))),await Promise.all(n),this.forEachCall(r=>Ir(r.localUsermediaFeed.stream.getVideoTracks(),!e&&this.callExpected(r))),this.emit("local_mute_state_changed",this.isMicrophoneMuted(),e),!0}async setScreensharingEnabled(e,n={}){if(e===this.isScreensharing())return e;if(e)try{k.log(`GroupCall ${this.groupCallId} setScreensharingEnabled() is asking for screensharing permissions`);const r=await this.client.getMediaHandler().getScreensharingStream(n);for(const i of r.getTracks()){const s=()=>{this.setScreensharingEnabled(!1),i.removeEventListener("ended",s)};i.addEventListener("ended",s)}return k.log(`GroupCall ${this.groupCallId} setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls`),this.localDesktopCapturerSourceId=n.desktopCapturerSourceId,this.localScreenshareFeed=new tu({client:this.client,roomId:this.room.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId(),stream:r,purpose:fn.Screenshare,audioMuted:!1,videoMuted:!1}),this.addScreenshareFeed(this.localScreenshareFeed),this.emit("local_screenshare_state_changed",!0,this.localScreenshareFeed,this.localDesktopCapturerSourceId),this.forEachCall(i=>i.pushLocalFeed(this.localScreenshareFeed.clone())),!0}catch(r){if(n.throwOnFail)throw r;return k.error(`GroupCall ${this.groupCallId} setScreensharingEnabled() enabling screensharing error`,r),this.emit("group_call_error",new tM("no_user_media","Failed to get screen-sharing stream: ",r)),!1}else return this.forEachCall(r=>{r.localScreensharingFeed&&r.removeLocalFeed(r.localScreensharingFeed)}),this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0,this.emit("local_screenshare_state_changed",!1,void 0,void 0),!1}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,n){const r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||n>i)}placeOutgoingCalls(){let e=!1;for(const[{userId:n},r]of this.participants){const i=this.calls.get(n)??new Map;for(const[s,o]of r){const a=i.get(s);if((a==null?void 0:a.getOpponentSessionId())!==o.sessionId&&this.wantsOutgoingCall(n,s)){e=!0,a!==void 0&&(k.debug(`GroupCall ${this.groupCallId} placeOutgoingCalls() replacing call (userId=${n}, deviceId=${s}, callId=${a.callId})`),a.hangup(Fl.NewSession,!1));const c=W0(this.client,this.room.roomId,{invitee:n,opponentDeviceId:s,opponentSessionId:o.sessionId,groupCallId:this.groupCallId});c===null?(k.error(`GroupCall ${this.groupCallId} placeOutgoingCalls() failed to create call (userId=${n}, device=${s})`),i.delete(s)):(this.initCall(c),i.set(s,c),k.debug(`GroupCall ${this.groupCallId} placeOutgoingCalls() placing call (userId=${n}, deviceId=${s}, sessionId=${o.sessionId})`),c.placeCallWithCallFeeds(this.getLocalFeeds().map(l=>l.clone()),o.screensharing).then(()=>{this.dataChannelsEnabled&&c.createDataChannel("datachannel",this.dataChannelOptions)}).catch(l=>{k.warn(`GroupCall ${this.groupCallId} placeOutgoingCalls() failed to place call (userId=${n})`,l),l instanceof Bl&&l.code==="unknown_device"?this.emit("group_call_error",l):this.emit("group_call_error",new tM("place_call_failed",`Failed to place call to ${n}`)),c.hangup(Fl.SignallingFailed,!1),i.get(s)===c&&i.delete(s)}))}}i.size>0?this.calls.set(n,i):this.calls.delete(n)}e&&this.emit("calls_changed",this.calls)}getMemberStateEvents(e){return e===void 0?this.room.currentState.getStateEvents(Z.GroupCallMemberPrefix):this.room.currentState.getStateEvents(Z.GroupCallMemberPrefix,e)}initCall(e){const n=ow(e);if(!n)throw new Error("Cannot init call without user id");const r=()=>this.onCallFeedsChanged(e),i=(c,l)=>this.onCallStateChanged(e,c,l),s=this.onCallHangup,o=c=>this.onCallReplaced(e,c);let a=this.callHandlers.get(n);a===void 0&&(a=new Map,this.callHandlers.set(n,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:s,onCallReplaced:o}),e.on(Ds.FeedsChanged,r),e.on(Ds.State,i),e.on(Ds.Hangup,s),e.on(Ds.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(Ds)),e.initStats(this.getGroupCallStats()),r()}disposeCall(e,n){const r=ow(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");const s=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:c,onCallReplaced:l}=s.get(i);if(e.removeListener(Ds.FeedsChanged,o),e.removeListener(Ds.State,a),e.removeListener(Ds.Hangup,c),e.removeListener(Ds.Replaced,l),s.delete(r),s.size===0&&this.callHandlers.delete(r),e.hangupReason===Fl.Replaced)return;const u=this.getUserMediaFeed(r,i);u&&this.removeUserMediaFeed(u);const d=this.getScreenshareFeed(r,i);d&&this.removeScreenshareFeed(d)}getUserMediaFeed(e,n){return this.userMediaFeeds.find(r=>r.userId===e&&r.deviceId===n)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit("user_media_feeds_changed",this.userMediaFeeds)}replaceUserMediaFeed(e,n){const r=this.userMediaFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,n),e.dispose(),n.measureVolumeActivity(!0),this.emit("user_media_feeds_changed",this.userMediaFeeds)}removeUserMediaFeed(e){const n=this.userMediaFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(n,1),e.dispose(),this.emit("user_media_feeds_changed",this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit("active_speaker_changed",this.activeSpeaker))}getScreenshareFeed(e,n){return this.screenshareFeeds.find(r=>r.userId===e&&r.deviceId===n)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}replaceScreenshareFeed(e,n){const r=this.screenshareFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,n),e.dispose(),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}removeScreenshareFeed(e){const n=this.screenshareFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(n,1),e.dispose(),this.emit("screenshare_feeds_changed",this.screenshareFeeds)}updateParticipants(){const e=this.room.getMember(this.client.getUserId());if(!e){k.warn(`GroupCall ${this.groupCallId} updateParticipants() tried to update participants before local room member is available`);return}if(this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state==="ended"){this.participants=new Map;return}const n=new Map,r=Date.now(),i=this.state==="entered"||this.enteredViaAnotherSession;let s=1/0;for(const o of this.getMemberStateEvents()){const a=this.room.getMember(o.getStateKey()),c=o.getContent(),u=(Array.isArray(c["m.calls"])?c["m.calls"]:[]).find(p=>p["m.call_id"]===this.groupCallId);let f=(Array.isArray(u==null?void 0:u["m.devices"])?u["m.devices"]:[]).filter(p=>typeof p.device_id=="string"&&typeof p.session_id=="string"&&typeof p.expires_ts=="number"&&p.expires_ts>r&&Array.isArray(p.feeds));if(!i&&(a==null?void 0:a.userId)===this.client.getUserId()&&(f=f.filter(p=>p.device_id!==this.client.getDeviceId())),f.length>0&&(a==null?void 0:a.membership)===Ge.Join){const p=new Map;n.set(a,p);for(const m of f)p.set(m.device_id,{sessionId:m.session_id,screensharing:m.feeds.some(v=>v.purpose===fn.Screenshare)}),m.expires_ts<s&&(s=m.expires_ts)}}if(i){let o=n.get(e);o===void 0&&(o=new Map,n.set(e,o)),o.has(this.client.getDeviceId())||o.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(a=>a.purpose===fn.Screenshare)})}this.participants=n,s<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),s-r))}async updateDevices(e,n=!1){const r=Date.now(),i=this.client.getUserId(),s=this.getMemberStateEvents(i),o=(s==null?void 0:s.getContent())??{},a=Array.isArray(o["m.calls"])?o["m.calls"]:[];let c=null;const l=[];for(const v of a)v["m.call_id"]===this.groupCallId?c=v:l.push(v);c===null&&(c={});const d=(Array.isArray(c["m.devices"])?c["m.devices"]:[]).filter(v=>typeof v.device_id=="string"&&typeof v.session_id=="string"&&typeof v.expires_ts=="number"&&v.expires_ts>r&&Array.isArray(v.feeds)),f=e(d);if(f===null)return;const p=[...l];f.length>0&&p.push({...c,"m.call_id":this.groupCallId,"m.devices":f});const m={"m.calls":p};await this.client.sendStateEvent(this.room.roomId,Z.GroupCallMemberPrefix,m,i,{keepAlive:n})}async addDeviceToMemberState(){await this.updateDevices(e=>[...e.filter(n=>n.device_id!==this.client.getDeviceId()),{device_id:this.client.getDeviceId(),session_id:this.client.getSessionId(),expires_ts:Date.now()+_F,feeds:this.getLocalFeeds().map(n=>({purpose:n.purpose}))}])}async updateMemberState(){this.resendMemberStateTimer!==null&&(clearInterval(this.resendMemberStateTimer),this.resendMemberStateTimer=null),this.state==="entered"?(await this.addDeviceToMemberState(),this.resendMemberStateTimer=setInterval(async()=>{k.log(`GroupCall ${this.groupCallId} updateMemberState() resending call member state"`);try{await this.addDeviceToMemberState()}catch(e){k.error(`GroupCall ${this.groupCallId} updateMemberState() failed to resend call member state`,e)}},_F*3/4)):await this.updateDevices(e=>e.filter(n=>n.device_id!==this.client.getDeviceId()),!0)}async cleanMemberState(){const{devices:e}=await this.client.getDevices(),n=new Map(e.map(r=>[r.device_id,r]));await this.updateDevices(r=>{const i=r.filter(s=>{const o=n.get(s.device_id);return(o==null?void 0:o.last_seen_ts)!==void 0&&!(s.device_id===this.client.getDeviceId()&&this.state!=="entered"&&!this.enteredViaAnotherSession)});return i.length===r.length?null:i})}getGroupCallStats(){if(this.stats===void 0){const e=this.client.getUserId()||"unknown";this.stats=new qEe(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(Zc.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(Zc.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(Zc.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(Zc.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,this.stats!==void 0&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}var bo=(t=>(t.Fledgling="fledgling",t.InviteSent="invite_sent",t.WaitLocalMedia="wait_local_media",t.CreateOffer="create_offer",t.CreateAnswer="create_answer",t.Connecting="connecting",t.Connected="connected",t.Ringing="ringing",t.Ended="ended",t))(bo||{}),hJ=(t=>(t.Inbound="inbound",t.Outbound="outbound",t))(hJ||{}),Ds=(t=>(t.Hangup="hangup",t.State="state",t.Error="error",t.Replaced="replaced",t.LocalHoldUnhold="local_hold_unhold",t.RemoteHoldUnhold="remote_hold_unhold",t.HoldUnhold="hold_unhold",t.FeedsChanged="feeds_changed",t.AssertedIdentityChanged="asserted_identity_changed",t.LengthChanged="length_changed",t.DataChannel="datachannel",t.SendVoipEvent="send_voip_event",t.PeerConnectionCreated="peer_connection_created",t))(Ds||{}),Fl=(t=>(t.UserHangup="user_hangup",t.LocalOfferFailed="local_offer_failed",t.NoUserMedia="no_user_media",t.UnknownDevices="unknown_devices",t.SendInvite="send_invite",t.CreateAnswer="create_answer",t.CreateOffer="create_offer",t.SendAnswer="send_answer",t.SetRemoteDescription="set_remote_description",t.SetLocalDescription="set_local_description",t.AnsweredElsewhere="answered_elsewhere",t.IceFailed="ice_failed",t.InviteTimeout="invite_timeout",t.Replaced="replaced",t.SignallingFailed="signalling_timeout",t.UserBusy="user_busy",t.Transferred="transferred",t.NewSession="new_session",t))(Fl||{});const GEe="1",zEe="stun:turn.matrix.org",m3=60*1e3,WEe=1e3,YEe=30*1e3,JEe=2*1e3;class Bl extends Error{constructor(e,n,r){super(n+": "+r),this.code=e}}function ah(){return Date.now().toString()+Zi(16)}function bF(t){return[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:t?12e3:void 0}]}function Na(t,e){return t+":"+e}class XEe extends Fn{constructor(e){if(super(),this.toDeviceSeq=0,this.isPtt=!1,this._state="fledgling",this.candidateSendQueue=[],this.candidateSendTries=0,this.candidatesEnded=!1,this.feeds=[],this.transceivers=new Map,this.inviteOrAnswerSent=!1,this.waitForLocalAVStream=!1,this.removeTrackListeners=new Map,this.remoteOnHold=!1,this.makingOffer=!1,this.ignoreOffer=!1,this.isSettingRemoteAnswerPending=!1,this.remoteCandidateBuffer=new Map,this.gotLocalIceCandidate=n=>{if(n.candidate){if(this.candidatesEnded&&k.warn(`Call ${this.callId} gotLocalIceCandidate() got candidate after candidates have ended!`),k.debug(`Call ${this.callId} got local ICE ${n.candidate.sdpMid} ${n.candidate.candidate}`),this.callHasEnded())return;n.candidate.candidate===""?this.queueCandidate(null):this.queueCandidate(n.candidate)}},this.onIceGatheringStateChange=n=>{var r;k.debug(`Call ${this.callId} onIceGatheringStateChange() ice gathering state changed to ${this.peerConn.iceGatheringState}`),((r=this.peerConn)==null?void 0:r.iceGatheringState)==="complete"&&(this.queueCandidate(null),k.debug(`Call ${this.callId} onIceGatheringStateChange() ice gathering state complete, set candidates have ended`))},this.getLocalOfferFailed=n=>{k.error(`Call ${this.callId} getLocalOfferFailed() running`,n),this.emit("error",new Bl("local_offer_failed","Failed to get local offer!",n),this),this.terminate("local","local_offer_failed",!1)},this.getUserMediaFailed=n=>{if(this.successor){this.successor.getUserMediaFailed(n);return}k.warn(`Call ${this.callId} getUserMediaFailed() failed to get user media - ending call`,n),this.emit("error",new Bl("no_user_media","Couldn't start capturing media! Is your microphone set up and does this app have permission?",n),this),this.terminate("local","no_user_media",!1)},this.placeCallFailed=n=>{if(this.successor){this.successor.placeCallFailed(n);return}k.warn(`Call ${this.callId} placeCallWithCallFeeds() failed - ending call`,n),this.emit("error",new Bl("ice_failed","Couldn't start call! Invalid ICE server configuration.",n),this),this.terminate("local","ice_failed",!1)},this.onIceConnectionStateChanged=()=>{var n,r,i,s,o,a,c;if(!this.callHasEnded()&&(k.debug(`Call ${this.callId} onIceConnectionStateChanged() running (state=${(n=this.peerConn)==null?void 0:n.iceConnectionState}, conn=${(r=this.peerConn)==null?void 0:r.connectionState})`),["connected","completed"].includes(((i=this.peerConn)==null?void 0:i.iceConnectionState)??"")?(clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state="connected",!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit("length_changed",Math.round((Date.now()-this.callStartTime)/1e3),this)},WEe))):((s=this.peerConn)==null?void 0:s.iceConnectionState)=="failed"?(this.candidatesEnded=!1,(o=this.peerConn)!=null&&o.restartIce?(this.candidatesEnded=!1,k.debug(`Call ${this.callId} onIceConnectionStateChanged() ice restart (state=${(a=this.peerConn)==null?void 0:a.iceConnectionState})`),this.peerConn.restartIce()):(k.info(`Call ${this.callId} onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)`),this.hangup("ice_failed",!1))):((c=this.peerConn)==null?void 0:c.iceConnectionState)=="disconnected"&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var l,u,d;k.info(`Call ${this.callId} onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=${(l=this.peerConn)==null?void 0:l.iceConnectionState}, conn=${(u=this.peerConn)==null?void 0:u.connectionState})`),(d=this.peerConn)!=null&&d.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},JEe),this.iceDisconnectedTimeout=setTimeout(()=>{k.info(`Call ${this.callId} onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)`),this.hangup("ice_failed",!1)},YEe),this.state="connecting"),this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState)))for(const l of this.getRemoteFeeds())l.setAudioVideoMuted(!0,!0)},this.onSignallingStateChanged=()=>{var n;k.debug(`Call ${this.callId} onSignallingStateChanged() running (state=${(n=this.peerConn)==null?void 0:n.signalingState})`)},this.onTrack=n=>{if(n.streams.length===0){k.warn(`Call ${this.callId} onTrack() called with streamless track streamless (kind=${n.track.kind})`);return}const r=n.streams[0];if(this.pushRemoteFeed(r),!this.removeTrackListeners.has(r)){const i=()=>{r.getTracks().length===0&&(k.info(`Call ${this.callId} onTrack() removing track (streamId=${r.id})`),this.deleteFeedByStream(r),r.removeEventListener("removetrack",i),this.removeTrackListeners.delete(r))};r.addEventListener("removetrack",i),this.removeTrackListeners.set(r,i)}},this.onDataChannel=n=>{this.emit("datachannel",n.channel,this)},this.onNegotiationNeeded=async()=>{if(k.info(`Call ${this.callId} onNegotiationNeeded() negotiation is needed!`),this.state!=="create_offer"&&this.opponentVersion===0){k.info(`Call ${this.callId} onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event`);return}this.queueGotLocalOffer()},this.onHangupReceived=n=>{k.debug(`Call ${this.callId} onHangupReceived() running`),this.partyIdMatches(n)||this.state==="ringing"?this.terminate("remote",n.reason||"user_hangup",!0):k.info(`Call ${this.callId} onHangupReceived() ignoring message from party ID ${n.party_id}: our partner is ${this.opponentPartyId}`)},this.onRejectReceived=n=>{k.debug(`Call ${this.callId} onRejectReceived() running`),["invite_sent","ringing"].includes(this.state)||this.state==="fledgling"&&this.direction==="inbound"?this.terminate("remote",n.reason||"user_hangup",!0):k.debug(`Call ${this.callId} onRejectReceived() called in wrong state (state=${this.state})`)},this.onAnsweredElsewhere=n=>{k.debug(`Call ${this.callId} onAnsweredElsewhere() running`),this.terminate("remote","answered_elsewhere",!0)},this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=e.forceTURN??!1,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],this.turnServers.length===0&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[zEe]});for(const n of this.turnServers)qW(n,["urls"]);this.callId=ah(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}async placeVoiceCall(){await this.placeCall(!0,!1)}async placeVideoCall(){await this.placeCall(!0,!0)}createDataChannel(e,n){const r=this.peerConn.createDataChannel(e,n);return this.emit("datachannel",r,this),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!!(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!!(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit("state",e,n,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?"video":"voice"}get hasLocalUserMediaVideoTrack(){var e;return!!((e=this.localUsermediaStream)!=null&&e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===fn.Usermedia&&((n=e.stream)==null?void 0:n.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!!((e=this.localUsermediaStream)!=null&&e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===fn.Usermedia&&!!((n=e.stream)!=null&&n.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!!((e=this.transceivers.get(Na(fn.Usermedia,"audio")))!=null&&e.sender)}get hasUserMediaVideoSender(){var e;return!!((e=this.transceivers.get(Na(fn.Usermedia,"video")))!=null&&e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===fn.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===fn.Screenshare)}get localUsermediaStream(){var e;return(e=this.localUsermediaFeed)==null?void 0:e.stream}get localScreensharingStream(){var e;return(e=this.localScreensharingFeed)==null?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===fn.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===fn.Screenshare)}get remoteUsermediaStream(){var e;return(e=this.remoteUsermediaFeed)==null?void 0:e.stream}get remoteScreensharingStream(){var e;return(e=this.remoteScreensharingFeed)==null?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(n=>n.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}async initOpponentCrypto(){var r,i;if(!this.opponentDeviceId||!this.client.getUseE2eForGroupCall())return;if(!this.client.isCryptoEnabled()){this.opponentDeviceInfo=new Ys(this.opponentDeviceId);return}if(!this.client.crypto)throw new Error("Crypto is not initialised.");const e=this.invitee||((r=this.getOpponentMember())==null?void 0:r.userId);if(!e)throw new Error("Couldn't find opponent user ID to init crypto");const n=await this.client.crypto.deviceList.downloadKeys([e],!1);if(this.opponentDeviceInfo=(i=n.get(e))==null?void 0:i.get(this.opponentDeviceId),this.opponentDeviceInfo===void 0)throw new fJ(e)}getLocalSDPStreamMetadata(e=!1){const n={};for(const r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),n[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return n}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata()){this.pushRemoteFeedWithoutMetadata(e);return}const n=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,s=this.remoteSDPStreamMetadata[e.id].video_muted;if(!r){k.warn(`Call ${this.callId} pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=${e.id})`);return}if(this.getFeedByStreamId(e.id)){k.warn(`Call ${this.callId} pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.feeds.push(new tu({client:this.client,call:this,roomId:this.roomId,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:s})),this.emit("feeds_changed",this.feeds,this),k.info(`Call ${this.callId} pushRemoteFeed() pushed stream (streamId=${e.id}, active=${e.active}, purpose=${r})`)}pushRemoteFeedWithoutMetadata(e){var s;const n=this.getOpponentMember().userId,r=fn.Usermedia,i=(s=this.feeds.find(o=>!o.isLocal()))==null?void 0:s.stream;if(i&&e.id!==i.id){k.warn(`Call ${this.callId} pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=${e.id})`);return}if(this.getFeedByStreamId(e.id)){k.warn(`Call ${this.callId} pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.feeds.push(new tu({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r})),this.emit("feeds_changed",this.feeds,this),k.info(`Call ${this.callId} pushRemoteFeedWithoutMetadata() pushed stream (streamId=${e.id}, active=${e.active})`)}pushNewLocalFeed(e,n,r=!0){const i=this.client.getUserId();if(Ir(e.getAudioTracks(),!0),Ir(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)){k.warn(`Call ${this.callId} pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=${e.id})`);return}this.pushLocalFeed(new tu({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n}),r)}pushLocalFeed(e,n=!0){if(this.feeds.some(r=>e.stream.id===r.stream.id)){k.info(`Call ${this.callId} pushLocalFeed() ignoring duplicate local stream (streamId=${e.stream.id})`);return}if(this.feeds.push(e),n)for(const r of e.stream.getTracks()){k.info(`Call ${this.callId} pushLocalFeed() adding track to peer connection (id=${r.id}, kind=${r.kind}, streamId=${e.stream.id}, streamPurpose=${e.purpose}, enabled=${r.enabled})`);const i=Na(e.purpose,r.kind);if(this.transceivers.has(i)){const s=this.transceivers.get(i);s.sender.replaceTrack(r),s.direction=s.direction==="inactive"?"sendonly":"sendrecv"}else{const s=this.peerConn.addTrack(r,e.stream),o=this.peerConn.getTransceivers().find(a=>a.sender===s);o?this.transceivers.set(i,o):k.warn(`Call ${this.callId} pushLocalFeed() didn't find a matching transceiver after adding track!`)}}k.info(`Call ${this.callId} pushLocalFeed() pushed stream (id=${e.stream.id}, active=${e.stream.active}, purpose=${e.purpose})`),this.emit("feeds_changed",this.feeds,this)}removeLocalFeed(e){const n=Na(e.purpose,"audio"),r=Na(e.purpose,"video");for(const i of[n,r])if(this.transceivers.has(i)){const s=this.transceivers.get(i);s.sender&&this.peerConn.removeTrack(s.sender)}e.purpose===fn.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(const e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit("feeds_changed",this.feeds,this)}deleteFeedByStream(e){const n=this.getFeedByStreamId(e.id);if(!n){k.warn(`Call ${this.callId} deleteFeedByStream() didn't find the feed to delete (streamId=${e.id})`);return}this.deleteFeed(n)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit("feeds_changed",this.feeds,this)}async getCurrentCallStats(){return this.callHasEnded()?this.callStatsAtEnd:this.collectCallStats()}async collectCallStats(){if(!this.peerConn)return;const e=await this.peerConn.getStats(),n=[];return e.forEach(r=>{n.push(r)}),n}async initWithInvite(e){var o;const n=e.getContent();this.direction="inbound",await this.client.checkTurnServers()||k.warn(`Call ${this.callId} initWithInvite() failed to get TURN credentials! Proceeding with call anyway...`);const i=n[nd];i?this.updateRemoteSDPStreamMetadata(i):k.debug(`Call ${this.callId} initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams`),this.peerConn=this.createPeerConnection(),this.emit("peer_connection_created",this.peerConn,this),this.chooseOpponent(e),await this.initOpponentCrypto();try{await this.peerConn.setRemoteDescription(n.offer),k.debug(`Call ${this.callId} initWithInvite() set remote description: ${n.offer.type}`),await this.addBufferedIceCandidates()}catch(a){k.debug(`Call ${this.callId} initWithInvite() failed to set remote description`,a),this.terminate("local","set_remote_description",!1);return}const s=(o=this.feeds.find(a=>!a.isLocal()))==null?void 0:o.stream;if(!this.isOnlyDataChannelAllowed&&(!s||s.getTracks().length===0)){k.error(`Call ${this.callId} initWithInvite() no remote stream or no tracks after setting remote description!`),this.terminate("local","set_remote_description",!1);return}if(this.state="ringing",e.getLocalAge()){const a=setTimeout(()=>{var l;this.state=="ringing"&&(k.debug(`Call ${this.callId} initWithInvite() invite has expired. Hanging up.`),this.hangupParty="remote",this.state="ended",this.stopAllMedia(),this.peerConn.signalingState!="closed"&&this.peerConn.close(),(l=this.stats)==null||l.removeStatsReportGatherer(this.callId),this.emit("hangup",this))},n.lifetime-e.getLocalAge()),c=l=>{l!=="ringing"&&(clearTimeout(a),this.off("state",c))};this.on("state",c)}}initWithHangup(e){this.state="ended"}shouldAnswerWithMediaType(e,n,r){return e&&!n?(k.warn(`Call ${this.callId} shouldAnswerWithMediaType() unable to answer with ${r} because the other side isn't sending it either.`),!1):!WW(e)&&e!==n&&!this.opponentSupportsSDPStreamMetadata()?(k.warn(`Call ${this.callId} shouldAnswerWithMediaType() unable to answer with ${r}=${e} because the other side doesn't support it. Answering with ${r}=${n}.`),n):e??n}async answer(e,n){if(!this.inviteOrAnswerSent){if(e===!1&&n===!1)throw new Error("You CANNOT answer a call without media");if(!this.localUsermediaStream&&!this.waitForLocalAVStream){const r=this.state,i=this.shouldAnswerWithMediaType(e,this.hasRemoteUserMediaAudioTrack,"audio"),s=this.shouldAnswerWithMediaType(n,this.hasRemoteUserMediaVideoTrack,"video");this.state="wait_local_media",this.waitForLocalAVStream=!0;try{const o=await this.client.getMediaHandler().getUserMediaStream(i,s);this.waitForLocalAVStream=!1;const c=[new tu({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId()??void 0,stream:o,purpose:fn.Usermedia,audioMuted:!1,videoMuted:!1})];this.localScreensharingFeed&&c.push(this.localScreensharingFeed),this.answerWithCallFeeds(c)}catch(o){if(s)k.warn(`Call ${this.callId} answer() failed to getUserMedia(), trying to getUserMedia() without video`),this.state=r,this.waitForLocalAVStream=!1,await this.answer(i,!1);else{this.getUserMediaFailed(o);return}}}else this.waitForLocalAVStream&&(this.state="wait_local_media")}}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){k.debug(`Call ${this.callId} replacedBy() running (newCallId=${e.callId})`),this.state==="wait_local_media"?(k.debug(`Call ${this.callId} replacedBy() telling new call to wait for local media (newCallId=${e.callId})`),e.waitForLocalAVStream=!0):["create_offer","invite_sent"].includes(this.state)&&(e.direction==="outbound"?e.queueGotCallFeedsForAnswer([]):(k.debug(`Call ${this.callId} replacedBy() handing local stream to new call(newCallId=${e.callId})`),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(n=>n.clone())))),this.successor=e,this.emit("replaced",e,this),this.hangup("replaced",!0)}hangup(e,n){if(this.callHasEnded()||(k.debug(`Call ${this.callId} hangup() ending call (reason=${e})`),this.terminate("local",e,!n),["fledgling","wait_local_media"].includes(this.state)))return;const r={};(this.opponentVersion&&this.opponentVersion!==0||e!=="user_hangup")&&(r.reason=e),this.sendVoipEvent(Z.CallHangup,r)}reject(){if(this.state!=="ringing")throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion===0){k.info(`Call ${this.callId} reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=${this.opponentVersion})`),this.hangup("user_hangup",!0);return}k.debug("Rejecting call: "+this.callId),this.terminate("local","user_hangup",!0),this.sendVoipEvent(Z.CallReject,{})}async upgradeCall(e,n){if(!(!e&&!n)&&this.opponentSupportsSDPStreamMetadata())try{k.debug(`Call ${this.callId} upgradeCall() upgrading call (audio=${e}, video=${n})`);const r=e||this.hasLocalUserMediaAudioTrack,i=n||this.hasLocalUserMediaVideoTrack,s=await this.client.getMediaHandler().getUserMediaStream(r,i,!1);await this.updateLocalUsermediaStream(s,e,n)}catch(r){k.error(`Call ${this.callId} upgradeCall() failed to upgrade the call`,r),this.emit("error",new Bl("no_user_media","Failed to get camera access: ",r),this)}}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}async setScreensharingEnabled(e,n){if(e&&this.isScreensharing())return k.warn(`Call ${this.callId} setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!`),!0;if(!e&&!this.isScreensharing())return k.warn(`Call ${this.callId} setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!`),!1;if(!this.opponentSupportsSDPStreamMetadata())return this.setScreensharingEnabledWithoutMetadataSupport(e,n);if(k.debug(`Call ${this.callId} setScreensharingEnabled() running (enabled=${e})`),e)try{const r=await this.client.getMediaHandler().getScreensharingStream(n);return r?(this.pushNewLocalFeed(r,fn.Screenshare),!0):!1}catch(r){return k.error(`Call ${this.callId} setScreensharingEnabled() failed to get screen-sharing stream:`,r),!1}else{const r=this.transceivers.get(Na(fn.Screenshare,"audio")),i=this.transceivers.get(Na(fn.Screenshare,"video"));for(const s of[r,i])s&&s.sender&&this.peerConn.removeTrack(s.sender);return this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}}async setScreensharingEnabledWithoutMetadataSupport(e,n){var r,i,s;if(k.debug(`Call ${this.callId} setScreensharingEnabledWithoutMetadataSupport() running (enabled=${e})`),e)try{const o=await this.client.getMediaHandler().getScreensharingStream(n);if(!o)return!1;const a=o.getTracks().find(l=>l.kind==="video"),c=(r=this.transceivers.get(Na(fn.Usermedia,"video")))==null?void 0:r.sender;return c==null||c.replaceTrack(a??null),this.pushNewLocalFeed(o,fn.Screenshare,!1),!0}catch(o){return k.error(`Call ${this.callId} setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:`,o),!1}else{const o=(i=this.localUsermediaStream)==null?void 0:i.getTracks().find(c=>c.kind==="video"),a=(s=this.transceivers.get(Na(fn.Usermedia,"video")))==null?void 0:s.sender;return a==null||a.replaceTrack(o??null),this.client.getMediaHandler().stopScreensharingStream(this.localScreensharingStream),this.deleteFeedByStream(this.localScreensharingStream),!1}}async updateLocalUsermediaStream(e,n=!1,r=!1){const i=this.localUsermediaFeed,s=n||!i.isAudioMuted()&&!this.remoteOnHold,o=r||!i.isVideoMuted()&&!this.remoteOnHold;k.log(`Call ${this.callId} updateLocalUsermediaStream() running (streamId=${e.id}, audio=${s}, video=${o})`),Ir(e.getAudioTracks(),s),Ir(e.getVideoTracks(),o);for(const a of this.localUsermediaStream.getTracks())this.localUsermediaStream.removeTrack(a),a.stop();for(const a of e.getTracks())this.localUsermediaStream.addTrack(a);for(const a of e.getTracks()){const c=Na(fn.Usermedia,a.kind),l=this.transceivers.get(c),u=l==null?void 0:l.sender;let d=!1;if(u)try{k.info(`Call ${this.callId} updateLocalUsermediaStream() replacing track (id=${a.id}, kind=${a.kind}, streamId=${e.id}, streamPurpose=${i.purpose})`),await u.replaceTrack(a),l.direction=l.direction==="inactive"?"sendonly":"sendrecv",d=!0}catch(f){k.warn(`Call ${this.callId} updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead`,f)}if(!d){k.info(`Call ${this.callId} updateLocalUsermediaStream() adding track to peer connection (id=${a.id}, kind=${a.kind}, streamId=${e.id}, streamPurpose=${i.purpose})`);const f=this.peerConn.addTrack(a,this.localUsermediaStream),p=this.peerConn.getTransceivers().find(m=>m.sender===f);p?this.transceivers.set(c,p):k.warn(`Call ${this.callId} updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!`)}}}async setLocalVideoMuted(e){var n,r;if(k.log(`Call ${this.callId} setLocalVideoMuted() running ${e}`),!e&&this.stopVideoTrackTimer!==void 0&&(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0),!await this.client.getMediaHandler().hasVideoDevice())return this.isLocalVideoMuted();if(!this.hasUserMediaVideoSender&&!e)return(n=this.localUsermediaFeed)==null||n.setAudioVideoMuted(null,e),await this.upgradeCall(!1,!0),this.isLocalVideoMuted();if(!e&&this.localUsermediaStream.getVideoTracks().length===0){const i=await this.client.getMediaHandler().getUserMediaStream(!0,!0);await this.updateLocalUsermediaStream(i)}return(r=this.localUsermediaFeed)==null||r.setAudioVideoMuted(null,e),this.updateMuteStatus(),await this.sendMetadataUpdate(),e&&(this.stopVideoTrackTimer=setTimeout(()=>{for(const i of this.localUsermediaStream.getVideoTracks())i.stop(),this.localUsermediaStream.removeTrack(i)},120)),this.isLocalVideoMuted()}isLocalVideoMuted(){var e;return((e=this.localUsermediaFeed)==null?void 0:e.isVideoMuted())??!1}async setMicrophoneMuted(e){var n;return k.log(`Call ${this.callId} setMicrophoneMuted() running ${e}`),await this.client.getMediaHandler().hasAudioDevice()?!e&&(!this.hasUserMediaAudioSender||!this.hasLocalUserMediaAudioTrack)?(await this.upgradeCall(!0,!1),this.isMicrophoneMuted()):((n=this.localUsermediaFeed)==null||n.setAudioVideoMuted(e,null),this.updateMuteStatus(),await this.sendMetadataUpdate(),this.isMicrophoneMuted()):this.isMicrophoneMuted()}isMicrophoneMuted(){var e;return((e=this.localUsermediaFeed)==null?void 0:e.isAudioMuted())??!1}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(const n of this.peerConn.getTransceivers())n.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit("remote_hold_unhold",this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!=="connected")return!1;let e=!0;for(const n of this.peerConn.getTransceivers())["inactive","recvonly"].includes(n.currentDirection)||(e=!1);return e}sendDtmfDigit(e){var n;for(const r of this.peerConn.getSenders())if(((n=r.track)==null?void 0:n.kind)==="audio"&&r.dtmf){r.dtmf.insertDTMF(e);return}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){const e=this.isMicrophoneMuted()||this.remoteOnHold,n=this.isLocalVideoMuted()||this.remoteOnHold;k.log(`Call ${this.callId} updateMuteStatus stream ${this.localUsermediaStream.id} micShouldBeMuted ${e} vidShouldBeMuted ${n}`),Ir(this.localUsermediaStream.getAudioTracks(),!e),Ir(this.localUsermediaStream.getVideoTracks(),!n)}async sendMetadataUpdate(){await this.sendVoipEvent(Z.CallSDPStreamMetadataChangedPrefix,{[nd]:this.getLocalSDPStreamMetadata()})}gotCallFeedsForInvite(e,n=!1){if(this.successor){this.successor.queueGotCallFeedsForAnswer(e);return}if(this.callHasEnded()){this.stopAllMedia();return}for(const r of e)this.pushLocalFeed(r);n&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state="create_offer",k.debug(`Call ${this.callId} gotUserMediaForInvite() run`)}async sendAnswer(){const e={answer:{sdp:this.peerConn.localDescription.sdp,type:this.peerConn.localDescription.type},[nd]:this.getLocalSDPStreamMetadata(!0)};e.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1};const n=this.discardDuplicateCandidates();k.info(`Call ${this.callId} sendAnswer() discarding ${n} candidates that will be sent in answer`);try{await this.sendVoipEvent(Z.CallAnswer,e),this.inviteOrAnswerSent=!0}catch(r){this.state="ringing",r instanceof Ii&&r.event&&this.client.cancelPendingEvent(r.event);let i="send_answer",s="Failed to send answer";throw r.name=="UnknownDeviceError"&&(i="unknown_devices",s="Unknown devices present in the room"),this.emit("error",new Bl(i,s,r),this),r}this.sendCandidateQueue()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,n){const r=sJ(e.sdp);r.media.forEach(i=>{const s=new Map,o=new Map;for(const a of i.rtp)s.set(a.payload,a.codec),o.set(a.codec,a.payload);for(const a of n){if(a.mediaType!==i.type)continue;if(!o.has(a.codec)){k.info(`Call ${this.callId} mungeSdp() ignoring SDP modifications for ${a.codec} as it's not present.`);continue}const c=[];a.enableDtx!==void 0&&c.push(`usedtx=${a.enableDtx?"1":"0"}`),a.maxAverageBitrate!==void 0&&c.push(`maxaveragebitrate=${a.maxAverageBitrate}`);let l=!1;for(const u of i.fmtp)s.get(u.payload)===a.codec&&(l=!0,u.config+=";"+c.join(";"));l||i.fmtp.push({payload:o.get(a.codec),config:c.join(";")})}}),e.sdp=TEe(r)}async createOffer(){const e=await this.peerConn.createOffer();return this.mungeSdp(e,bF(this.isPtt)),e}async createAnswer(){const e=await this.peerConn.createAnswer();return this.mungeSdp(e,bF(this.isPtt)),e}async gotCallFeedsForAnswer(e){if(this.callHasEnded())return;this.waitForLocalAVStream=!1;for(const r of e)this.pushLocalFeed(r);this.state="create_answer";let n;try{this.getRidOfRTXCodecs(),n=await this.createAnswer()}catch(r){k.debug(`Call ${this.callId} gotCallFeedsForAnswer() failed to create answer: `,r),this.terminate("local","create_answer",!0);return}try{if(await this.peerConn.setLocalDescription(n),this.callHasEnded()||(this.state="connecting",await new Promise(r=>{setTimeout(r,200)}),this.callHasEnded()))return;this.sendAnswer()}catch(r){k.debug(`Call ${this.callId} gotCallFeedsForAnswer() error setting local description!`,r),this.terminate("local","set_local_description",!0);return}}async onRemoteIceCandidatesReceived(e){if(this.callHasEnded())return;const n=e.getContent(),r=n.candidates;if(!r){k.info(`Call ${this.callId} onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!`);return}const i=n.version===0?null:n.party_id||null;if(this.opponentPartyId===void 0){if(i){k.info(`Call ${this.callId} onRemoteIceCandidatesReceived() buffering ${r.length} candidates until we pick an opponent`);const s=this.remoteCandidateBuffer.get(i)||[];s.push(...r),this.remoteCandidateBuffer.set(i,s)}return}if(!this.partyIdMatches(n)){k.info(`Call ${this.callId} onRemoteIceCandidatesReceived() ignoring candidates from party ID ${n.party_id}: we have chosen party ID ${this.opponentPartyId}`);return}await this.addIceCandidates(r)}async onAnswerReceived(e){const n=e.getContent();if(k.debug(`Call ${this.callId} onAnswerReceived() running (hangupParty=${n.party_id})`),this.callHasEnded()){k.debug(`Call ${this.callId} onAnswerReceived() ignoring answer because call has ended`);return}if(this.opponentPartyId!==void 0){k.info(`Call ${this.callId} onAnswerReceived() ignoring answer from party ID ${n.party_id}: we already have an answer/reject from ${this.opponentPartyId}`);return}this.chooseOpponent(e),await this.addBufferedIceCandidates(),this.state="connecting";const r=n[nd];r?this.updateRemoteSDPStreamMetadata(r):k.warn(`Call ${this.callId} onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams`);try{this.isSettingRemoteAnswerPending=!0,await this.peerConn.setRemoteDescription(n.answer),this.isSettingRemoteAnswerPending=!1,k.debug(`Call ${this.callId} onAnswerReceived() set remote description: ${n.answer.type}`)}catch(i){this.isSettingRemoteAnswerPending=!1,k.debug(`Call ${this.callId} onAnswerReceived() failed to set remote description`,i),this.terminate("local","set_remote_description",!1);return}if(this.opponentPartyId!==null)try{await this.sendVoipEvent(Z.CallSelectAnswer,{selected_party_id:this.opponentPartyId})}catch(i){k.warn(`Call ${this.callId} onAnswerReceived() failed to send select_answer event`,i)}}async onSelectAnswerReceived(e){if(this.direction!=="inbound"){k.warn(`Call ${this.callId} onSelectAnswerReceived() got select_answer for an outbound call: ignoring`);return}const n=e.getContent().selected_party_id;if(n==null){k.warn(`Call ${this.callId} onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring`);return}n!==this.ourPartyId&&(k.info(`Call ${this.callId} onSelectAnswerReceived() got select_answer for party ID ${n}: we are party ID ${this.ourPartyId}.`),await this.terminate("remote","answered_elsewhere",!0))}async onNegotiateReceived(e){var u;const n=e.getContent(),r=n.description;if(!r||!r.sdp||!r.type){k.info(`Call ${this.callId} onNegotiateReceived() ignoring invalid m.call.negotiate event`);return}const i=this.direction==="inbound",s=!this.makingOffer&&(this.peerConn.signalingState==="stable"||this.isSettingRemoteAnswerPending),o=r.type==="offer"&&!s;if(this.ignoreOffer=!i&&o,this.ignoreOffer){k.info(`Call ${this.callId} onNegotiateReceived() ignoring colliding negotiate event because we're impolite`);return}const a=this.isLocalOnHold(),c=n[nd];c?this.updateRemoteSDPStreamMetadata(c):k.warn(`Call ${this.callId} onNegotiateReceived() received negotiation event without SDPStreamMetadata!`);try{if(this.isSettingRemoteAnswerPending=r.type=="answer",await this.peerConn.setRemoteDescription(r),this.isSettingRemoteAnswerPending=!1,k.debug(`Call ${this.callId} onNegotiateReceived() set remote description: ${r.type}`),r.type==="offer"){let d;try{this.getRidOfRTXCodecs(),d=await this.createAnswer()}catch(f){k.debug(`Call ${this.callId} onNegotiateReceived() failed to create answer: `,f),this.terminate("local","create_answer",!0);return}await this.peerConn.setLocalDescription(d),k.debug(`Call ${this.callId} onNegotiateReceived() create an answer`),this.sendVoipEvent(Z.CallNegotiate,{lifetime:m3,description:(u=this.peerConn.localDescription)==null?void 0:u.toJSON(),[nd]:this.getLocalSDPStreamMetadata(!0)})}}catch(d){this.isSettingRemoteAnswerPending=!1,k.warn(`Call ${this.callId} onNegotiateReceived() failed to complete negotiation`,d)}const l=this.isLocalOnHold();a!==l&&(this.emit("local_hold_unhold",l,this),this.emit("hold_unhold",l))}updateRemoteSDPStreamMetadata(e){var n;this.remoteSDPStreamMetadata=YW(this.remoteSDPStreamMetadata||{},e,!0);for(const r of this.getRemoteFeeds()){const i=r.stream.id,s=this.remoteSDPStreamMetadata[i];r.setAudioVideoMuted(s==null?void 0:s.audio_muted,s==null?void 0:s.video_muted),r.purpose=(n=this.remoteSDPStreamMetadata[i])==null?void 0:n.purpose}}onSDPStreamMetadataChangedReceived(e){const r=e.getContent()[nd];this.updateRemoteSDPStreamMetadata(r)}async onAssertedIdentityReceived(e){const n=e.getContent();n.asserted_identity&&(this.remoteAssertedIdentity={id:n.asserted_identity.id,displayName:n.asserted_identity.display_name},this.emit("asserted_identity_changed",this))}callHasEnded(){return this.state==="ended"}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}async wrappedGotLocalOffer(){this.makingOffer=!0;try{await this.gotLocalOffer()}catch(e){this.getLocalOfferFailed(e);return}finally{this.makingOffer=!1}}async gotLocalOffer(){var s,o;if(k.debug(`Call ${this.callId} gotLocalOffer() running`),this.callHasEnded()){k.debug(`Call ${this.callId} gotLocalOffer() ignoring newly created offer because the call has ended"`);return}let e;try{this.getRidOfRTXCodecs(),e=await this.createOffer()}catch(a){k.debug(`Call ${this.callId} gotLocalOffer() failed to create offer: `,a),this.terminate("local","create_offer",!0);return}try{await this.peerConn.setLocalDescription(e)}catch(a){k.debug(`Call ${this.callId} gotLocalOffer() error setting local description!`,a),this.terminate("local","set_local_description",!0);return}if(this.peerConn.iceGatheringState==="gathering"&&await new Promise(a=>{setTimeout(a,200)}),this.callHasEnded())return;const n=this.state==="create_offer"?Z.CallInvite:Z.CallNegotiate,r={lifetime:m3};n===Z.CallInvite&&this.invitee&&(r.invitee=this.invitee),this.state==="create_offer"?r.offer=(s=this.peerConn.localDescription)==null?void 0:s.toJSON():r.description=(o=this.peerConn.localDescription)==null?void 0:o.toJSON(),r.capabilities={"m.call.transferee":this.client.supportsCallTransfer,"m.call.dtmf":!1},r[nd]=this.getLocalSDPStreamMetadata(!0);const i=this.discardDuplicateCandidates();k.info(`Call ${this.callId} gotLocalOffer() discarding ${i} candidates that will be sent in offer`);try{await this.sendVoipEvent(n,r)}catch(a){k.error(`Call ${this.callId} gotLocalOffer() failed to send invite`,a),a instanceof Ii&&a.event&&this.client.cancelPendingEvent(a.event);let c="signalling_timeout",l="Signalling failed";this.state==="create_offer"&&(c="send_invite",l="Failed to send invite"),a.name=="UnknownDeviceError"&&(c="unknown_devices",l="Unknown devices present in the room"),this.emit("error",new Bl(c,l,a),this),this.terminate("local",c,!1);return}this.sendCandidateQueue(),this.state==="create_offer"&&(this.inviteOrAnswerSent=!0,this.state="invite_sent",this.inviteTimeout=setTimeout(()=>{this.inviteTimeout=void 0,this.state==="invite_sent"&&this.hangup("invite_timeout",!1)},m3))}getRidOfRTXCodecs(){if(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)return;const e=this.transceivers.get(Na(fn.Screenshare,"video"));if(!e||!e.setCodecPreferences)return;const n=RTCRtpReceiver.getCapabilities("video").codecs,r=RTCRtpSender.getCapabilities("video").codecs,i=[];for(const s of[...n,...r])if(s.mimeType!=="video/rtx"){i.push(s);try{e.setCodecPreferences(i)}catch(o){k.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",s,o),i.pop()}}}async sendVoipEvent(e,n){var i,s;const r={...n,version:GEe,call_id:this.callId,party_id:this.ourPartyId,conf_id:this.groupCallId};if(this.opponentDeviceId){const o=this.toDeviceSeq++,a={...r,device_id:this.client.deviceId,sender_session_id:this.client.getSessionId(),dest_session_id:this.opponentSessionId,seq:o,[vs]:ac()};this.emit("send_voip_event",{type:"toDevice",eventType:e,userId:this.invitee||((i=this.getOpponentMember())==null?void 0:i.userId),opponentDeviceId:this.opponentDeviceId,content:a},this);const c=this.invitee||this.getOpponentMember().userId;if(this.client.getUseE2eForGroupCall()){if(!this.opponentDeviceInfo){k.warn(`Call ${this.callId} sendVoipEvent() failed: we do not have opponentDeviceInfo`);return}await this.client.encryptAndSendToDevices([{userId:c,deviceInfo:this.opponentDeviceInfo}],{type:e,content:a})}else await this.client.sendToDevice(e,new Map([[c,new Map([[this.opponentDeviceId,a]])]]))}else this.emit("send_voip_event",{type:"sendEvent",eventType:e,roomId:this.roomId,content:r,userId:this.invitee||((s=this.getOpponentMember())==null?void 0:s.userId)},this),await this.client.sendEvent(this.roomId,e,r)}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,this.state==="ringing"||!this.inviteOrAnswerSent)return;const n=this.direction==="inbound"?500:2e3;this.candidateSendTries===0&&setTimeout(()=>{this.sendCandidateQueue()},n)}discardDuplicateCandidates(){let e=0;const n=[];for(let r=0;r<this.candidateSendQueue.length;r++){const i=this.candidateSendQueue[r];i.candidate===""?n.push(i):e++}return this.candidateSendQueue=n,e}async transfer(e){const n=await this.client.getProfileInfo(e),r=ah(),i={replacement_id:ah(),target_user:{id:e,display_name:n.displayname,avatar_url:n.avatar_url},create_call:r};await this.sendVoipEvent(Z.CallReplaces,i),await this.terminate("local","transferred",!0)}async transferToCall(e){var l,u;const n=(l=e.getOpponentMember())==null?void 0:l.userId,r=n?await this.client.getProfileInfo(n):void 0,i=(u=this.getOpponentMember())==null?void 0:u.userId,s=i?await this.client.getProfileInfo(i):void 0,o=ah(),a={replacement_id:ah(),target_user:{id:i,display_name:s==null?void 0:s.displayname,avatar_url:s==null?void 0:s.avatar_url},await_call:o};await e.sendVoipEvent(Z.CallReplaces,a);const c={replacement_id:ah(),target_user:{id:n,display_name:r==null?void 0:r.displayname,avatar_url:r==null?void 0:r.avatar_url},create_call:o};await this.sendVoipEvent(Z.CallReplaces,c),await this.terminate("local","transferred",!0),await e.terminate("local","transferred",!0)}async terminate(e,n,r){var i;if(!this.callHasEnded()){this.hangupParty=e,this.hangupReason=n,this.state="ended",this.inviteTimeout&&(clearTimeout(this.inviteTimeout),this.inviteTimeout=void 0),this.iceDisconnectedTimeout!==void 0&&(clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0),this.callLengthInterval&&(clearInterval(this.callLengthInterval),this.callLengthInterval=void 0),this.stopVideoTrackTimer!==void 0&&(clearTimeout(this.stopVideoTrackTimer),this.stopVideoTrackTimer=void 0);for(const[s,o]of this.removeTrackListeners)s.removeEventListener("removetrack",o);this.removeTrackListeners.clear(),this.callStatsAtEnd=await this.collectCallStats(),this.stopAllMedia(),this.deleteAllFeeds(),this.peerConn&&this.peerConn.signalingState!=="closed"&&this.peerConn.close(),(i=this.stats)==null||i.removeStatsReportGatherer(this.callId),r&&this.emit("hangup",this),this.client.callEventHandler.calls.delete(this.callId)}}stopAllMedia(){k.debug(`Call ${this.callId} stopAllMedia() running`);for(const e of this.feeds)if(e.isLocal()&&e.purpose===fn.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===fn.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){k.debug(`Call ${this.callId} stopAllMedia() stopping stream (streamId=${e.stream.id})`);for(const n of e.stream.getTracks())n.stop()}}checkForErrorListener(){if(this.listeners(f4.Error).length===0)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}async sendCandidateQueue(){if(this.candidateSendQueue.length===0||this.callHasEnded())return;const e=this.candidateSendQueue;this.candidateSendQueue=[],++this.candidateSendTries;const n={candidates:e.map(r=>r.toJSON())};this.candidatesEnded&&n.candidates.push({candidate:""}),k.debug(`Call ${this.callId} sendCandidateQueue() attempting to send ${e.length} candidates`);try{await this.sendVoipEvent(Z.CallCandidates,n),this.candidateSendTries=0,this.sendCandidateQueue()}catch(r){if(r instanceof Ii&&r.event&&this.client.cancelPendingEvent(r.event),this.candidateSendQueue.push(...e),this.candidateSendTries>5){k.debug(`Call ${this.callId} sendCandidateQueue() failed to send candidates on attempt ${this.candidateSendTries}. Giving up on this call.`,r);const s="signalling_timeout",o="Signalling failed";this.emit("error",new Bl(s,o,r),this),this.hangup(s,!1);return}const i=500*Math.pow(2,this.candidateSendTries);++this.candidateSendTries,k.debug(`Call ${this.callId} sendCandidateQueue() failed to send candidates. Retrying in ${i}ms`,r),setTimeout(()=>{this.sendCandidateQueue()},i)}}async placeCall(e,n){if(!e)throw new Error("You CANNOT start a call without audio");this.state="wait_local_media";let r;try{const i=await this.client.getMediaHandler().getUserMediaStream(e,n);Ir(i.getAudioTracks(),!0),Ir(i.getVideoTracks(),!0),r=new tu({client:this.client,roomId:this.roomId,userId:this.client.getUserId(),deviceId:this.client.getDeviceId()??void 0,stream:i,purpose:fn.Usermedia,audioMuted:!1,videoMuted:!1})}catch(i){this.getUserMediaFailed(i);return}try{await this.placeCallWithCallFeeds([r])}catch(i){this.placeCallFailed(i);return}}async placeCallWithCallFeeds(e,n=!1){this.checkForErrorListener(),this.direction="outbound",await this.initOpponentCrypto(),this.client.callEventHandler.calls.set(this.callId,this),await this.client.checkTurnServers()||k.warn(`Call ${this.callId} placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...`),this.peerConn=this.createPeerConnection(),this.emit("peer_connection_created",this.peerConn,this),this.gotCallFeedsForInvite(e,n)}createPeerConnection(){var i;const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e.addEventListener("datachannel",this.onDataChannel);const n=this.getOpponentMember(),r=n?n.userId:"unknown";return(i=this.stats)==null||i.addStatsReportGatherer(this.callId,r,e),e}partyIdMatches(e){return(e.version===0?null:e.party_id||null)===this.opponentPartyId}chooseOpponent(e){var r;const n=e.getContent();k.debug(`Call ${this.callId} chooseOpponent() running (partyId=${n.party_id})`),this.opponentVersion=n.version,this.opponentVersion===0?this.opponentPartyId=null:this.opponentPartyId=n.party_id||null,this.opponentCaps=n.capabilities||{},this.opponentMember=this.client.getRoom(this.roomId).getMember(e.getSender())??void 0,this.opponentMember&&((r=this.stats)==null||r.updateOpponentMember(this.callId,this.opponentMember.userId))}async addBufferedIceCandidates(){const e=this.remoteCandidateBuffer.get(this.opponentPartyId);e&&(k.info(`Call ${this.callId} addBufferedIceCandidates() adding ${e.length} buffered candidates for opponent ${this.opponentPartyId}`),await this.addIceCandidates(e)),this.remoteCandidateBuffer.clear()}async addIceCandidates(e){for(const n of e){(n.sdpMid===null||n.sdpMid===void 0)&&(n.sdpMLineIndex===null||n.sdpMLineIndex===void 0)?k.debug(`Call ${this.callId} addIceCandidates() got remote ICE end-of-candidates`):k.debug(`Call ${this.callId} addIceCandidates() got remote ICE candidate (sdpMid=${n.sdpMid}, candidate=${n.candidate})`);try{await this.peerConn.addIceCandidate(n)}catch(r){this.ignoreOffer?k.debug(`Call ${this.callId} addIceCandidates() failed to add remote ICE candidate because ignoring offer`,r):k.info(`Call ${this.callId} addIceCandidates() failed to add remote ICE candidate`,r)}}}get hasPeerConnection(){return!!this.peerConn}initStats(e,n="unknown"){this.stats=e,this.stats.start()}}function Ir(t,e){for(const n of t)n.enabled=e}function nM(){if(typeof window>"u"||typeof document>"u")return!1;try{if(!!!(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices))return k.error("WebRTC is not supported in this browser / environment"),!1}catch(t){return k.error("Exception thrown when trying to access WebRTC",t),!1}return!0}function W0(t,e,n){if(!nM())return null;const r=n?n.forceTURN:!1,i={client:t,roomId:e,invitee:n==null?void 0:n.invitee,turnServers:t.getTurnServers(),forceTURN:t.forceTURN||r,opponentDeviceId:n==null?void 0:n.opponentDeviceId,opponentSessionId:n==null?void 0:n.opponentSessionId,groupCallId:n==null?void 0:n.groupCallId},s=new XEe(i);return t.reEmitter.reEmit(s,Object.values(Ds)),s}var uu=(t=>(t.DontNotify="dont_notify",t.Notify="notify",t.Coalesce="coalesce",t))(uu||{}),j2=(t=>(t.Highlight="highlight",t.Sound="sound",t))(j2||{}),pJ=(t=>(t.ExactEquals="==",t.LessThan="<",t.GreaterThan=">",t.GreaterThanOrEqual=">=",t.LessThanOrEqual="<=",t))(pJ||{});const ZEe="2";function QEe(t){return t==="==2"||t==="2"}var vr=(t=>(t.EventMatch="event_match",t.EventPropertyIs="event_property_is",t.EventPropertyContains="event_property_contains",t.ContainsDisplayName="contains_display_name",t.RoomMemberCount="room_member_count",t.SenderNotificationPermission="sender_notification_permission",t.CallStarted="call_started",t.CallStartedPrefix="org.matrix.msc3914.call_started",t))(vr||{}),Hr=(t=>(t.Override="override",t.ContentSpecific="content",t.RoomSpecific="room",t.SenderSpecific="sender",t.Underride="underride",t))(Hr||{}),Br=(t=>(t.Master=".m.rule.master",t.IsUserMention=".m.rule.is_user_mention",t.IsRoomMention=".m.rule.is_room_mention",t.ContainsDisplayName=".m.rule.contains_display_name",t.ContainsUserName=".m.rule.contains_user_name",t.AtRoomNotification=".m.rule.roomnotif",t.DM=".m.rule.room_one_to_one",t.EncryptedDM=".m.rule.encrypted_room_one_to_one",t.Message=".m.rule.message",t.EncryptedMessage=".m.rule.encrypted",t.InviteToSelf=".m.rule.invite_for_me",t.MemberEvent=".m.rule.member_event",t.IncomingCall=".m.rule.call",t.SuppressNotices=".m.rule.suppress_notices",t.Tombstone=".m.rule.tombstone",t.PollStart=".m.rule.poll_start",t.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",t.PollEnd=".m.rule.poll_end",t.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",t.PollStartOneToOne=".m.rule.poll_start_one_to_one",t.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",t.PollEndOneToOne=".m.rule.poll_end_one_to_one",t.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",t))(Br||{});const SF=[Hr.Override,Hr.ContentSpecific,Hr.RoomSpecific,Hr.SenderSpecific,Hr.Underride],eTe={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:vr.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:vr.SenderNotificationPermission,key:"room"}],actions:[uu.Notify,{set_tweak:j2.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:vr.EventMatch,key:"type",pattern:"m.reaction"}],actions:[uu.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:vr.EventMatch,key:"type",pattern:Z.RoomServerAcl},{kind:vr.EventMatch,key:"state_key",pattern:""}],actions:[]}},C4=Symbol("UserDefinedRules"),tTe=[Br.Master,C4,Br.SuppressNotices,Br.InviteToSelf,Br.MemberEvent,Br.IsUserMention,Br.ContainsDisplayName,Br.IsRoomMention,Br.AtRoomNotification,Br.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],nTe={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:vr.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:vr.CallStarted}],actions:[uu.Notify,{set_tweak:j2.Sound,value:"default"}]}},rTe=[C4,Br.IncomingCall,".org.matrix.msc3914.rule.room.call",Br.EncryptedDM,Br.DM,Br.Message,Br.EncryptedMessage];function wF(t,e,n,r){const i=e.filter(l=>l.default),s=e.filter(l=>!l.default);function o(l){l===C4?c.push(...s):l in n?(k.warn(`Adding default global ${t} push rule ${l}`),c.push(n[l])):k.warn(`Missing default global ${t} push rule ${l}`)}let a=0;const c=[];for(const l of i){const u=r.indexOf(l.rule_id);if(u===-1){c.push(l);continue}for(;u>a;){const d=r[a];o(d),a+=1}c.push(l),a+=1}for(const l of r.slice(a))o(l);return c}const $c=class $c{constructor(e){this.client=e,this.parsedKeys=new Map}static actionListToActionsObject(e){const n={notify:!1,tweaks:{}};for(const r of e)r===uu.Notify?n.notify=!0:typeof r=="object"&&(r.value===void 0&&(r.value=!0),n.tweaks[r.set_tweak]=r.value);return n}static rewriteDefaultRules(e,n=void 0){let r=JSON.parse(JSON.stringify(e));return r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.underride||(r.global.underride=[]),r.global.override=wF(Hr.Override,r.global.override,eTe,tTe),r.global.underride=wF(Hr.Underride,r.global.underride,nTe,rTe),r}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);const n=new Set(this.parsedKeys.keys());for(const r of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(const i of r)if(i.conditions)for(const s of i.conditions)s.kind===vr.EventMatch&&(n.delete(s.key),this.parsedKeys.set(s.key,$c.partsForDottedKey(s.key)));n.forEach(r=>this.parsedKeys.delete(r))}matchingRuleFromKindSet(e,n){for(const r of SF){const i=n[r];if(i)for(const s of i){if(!s.enabled)continue;const o=this.templateRuleToRaw(r,s);if(o&&this.ruleMatchesEvent(o,e))return{...s,kind:r}}}return null}templateRuleToRaw(e,n){const r={rule_id:n.rule_id,actions:n.actions,conditions:[]};switch(e){case Hr.Underride:case Hr.Override:r.conditions=n.conditions;break;case Hr.RoomSpecific:if(!n.rule_id)return null;r.conditions.push({kind:vr.EventMatch,key:"room_id",value:n.rule_id});break;case Hr.SenderSpecific:if(!n.rule_id)return null;r.conditions.push({kind:vr.EventMatch,key:"user_id",value:n.rule_id});break;case Hr.ContentSpecific:if(!n.pattern)return null;r.conditions.push({kind:vr.EventMatch,key:"content.body",pattern:n.pattern});break}return r}eventFulfillsCondition(e,n){switch(e.kind){case vr.EventMatch:return this.eventFulfillsEventMatchCondition(e,n);case vr.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,n);case vr.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,n);case vr.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,n);case vr.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,n);case vr.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,n);case vr.CallStarted:case vr.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,n)}return!1}eventFulfillsSenderNotifPermCondition(e,n){const r=e.key;if(!r)return!1;const i=this.client.getRoom(n.getRoomId());return i!=null&&i.currentState?i.currentState.mayTriggerNotifOfType(r,n.getSender()):!1}eventFulfillsRoomMemberCountCondition(e,n){if(!e.is)return!1;const r=this.client.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;const i=r.currentState.getJoinedMemberCount(),s=e.is.match(/^([=<>]*)(\d*)$/);if(!s)return!1;const o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,n){var c;let r=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(r=n.getClearContent()),!r||!r.body||typeof r.body!="string")return!1;const i=this.client.getRoom(n.getRoomId()),s=(c=i==null?void 0:i.currentState)==null?void 0:c.getMember(this.client.credentials.userId);if(!s)return!1;const o=s.name,a=new RegExp("(^|\\W)"+GW(o)+"(\\W|$)","i");return r.body.search(a)>-1}eventFulfillsEventMatchCondition(e,n){if(!e.key)return!1;const r=this.valueForDottedKey(e.key,n);if(typeof r!="string")return!1;if(e.value)return e.value===r;if(typeof e.pattern!="string")return!1;const i=e.key==="content.body"?this.createCachedRegex("(^|\\W)",e.pattern,"(\\W|$)"):this.createCachedRegex("^",e.pattern,"$");return!!r.match(i)}eventFulfillsEventPropertyIsCondition(e,n){return!e.key||e.value===void 0?!1:e.value===this.valueForDottedKey(e.key,n)}eventFulfillsEventPropertyContains(e,n){if(!e.key||e.value===void 0)return!1;const r=this.valueForDottedKey(e.key,n);return Array.isArray(r)?r.includes(e.value):!1}eventFulfillsCallStartedCondition(e,n){return["m.ring","m.prompt"].includes(n.getContent()["m.intent"])&&!("m.terminated"in n.getContent())&&(n.getPrevContent()["m.terminated"]!==n.getContent()["m.terminated"]||of(n.getPrevContent(),{}))}createCachedRegex(e,n,r){return $c.cachedGlobToRegex[n]||($c.cachedGlobToRegex[n]=new RegExp(e+zW(n)+r,"i")),$c.cachedGlobToRegex[n]}static partsForDottedKey(e){const n=[];let r="",i=!1;for(const s of e){if(i){s==="\\"||s==="."?r+=s:r+="\\"+s,i=!1;continue}s=="."?(n.push(r),r=""):s=="\\"?i=!0:r+=s}return i&&(r+="\\"),n.push(r),n}valueForDottedKey(e,n){let r=this.parsedKeys.get(e);r===void 0&&(r=$c.partsForDottedKey(e),this.parsedKeys.set(e,r));let i;const s=r[0];let o=0;for(s==="content"?(i=n.getContent(),++o):s==="type"?(i=n.getType(),++o):i=n.event;o<r.length;++o){if(WW(i))return;const a=r[o];i=i[a]}return i}matchingRuleForEventWithRulesets(e,n){return!n||e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,n.global)}pushActionsForEventAndRulesets(e,n){const r=this.matchingRuleForEventWithRulesets(e,n);if(!r)return{};const i=$c.actionListToActionsObject(r.actions);return i.tweaks.highlight===void 0&&(i.tweaks.highlight=r.kind==Hr.ContentSpecific),{actions:i,rule:r}}ruleMatchesEvent(e,n){var r;return this.client.supportsIntentionalMentions()&&n.getContent()["m.mentions"]!==void 0&&(e.rule_id===Br.ContainsUserName||e.rule_id===Br.ContainsDisplayName||e.rule_id===Br.AtRoomNotification)?!1:!((r=e.conditions)!=null&&r.some(i=>!this.eventFulfillsCondition(i,n)))}actionsForEvent(e){const{actions:n}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return n||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){const n=this.getPushRuleAndKindById(e);return(n==null?void 0:n.rule)??null}getPushRuleAndKindById(e){var n;for(const r of["global"])if(((n=this.client.pushRules)==null?void 0:n[r])!==void 0){for(const i of SF)if(this.client.pushRules[r][i]!==void 0){for(const s of this.client.pushRules[r][i])if(s.rule_id===e)return{rule:s,kind:i}}}return null}};$c.cachedGlobToRegex={};let hC=$c;const pC=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"];pC[0];pC[pC.length-1];var gJ=(t=>(t.SUCCESS="SUCCESS",t.IGNORE="IGNORE",t.PROMPT="PROMPT",t.FAIL_PROMPT="FAIL_PROMPT",t.FAIL_ERROR="FAIL_ERROR",t))(gJ||{}),k4=(t=>(t.Invalid="Invalid homeserver discovery response",t.GenericFailure="Failed to get autodiscovery configuration from server",t.InvalidHsBaseUrl="Invalid base_url for m.homeserver",t.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",t.InvalidIsBaseUrl="Invalid base_url for m.identity_server",t.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",t.InvalidIs="Invalid identity server discovery response",t.MissingWellknown="No .well-known JSON file found",t.InvalidJson="Invalid JSON",t.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",t))(k4||{});const pt=class pt{static async fromDiscoveryConfig(e){var c;const n={"m.homeserver":{state:pt.FAIL_ERROR,error:pt.ERROR_INVALID,base_url:null},"m.identity_server":{state:pt.PROMPT,error:null,base_url:null}};if(!(e!=null&&e["m.homeserver"]))return k.error("No m.homeserver key in config"),n["m.homeserver"].state=pt.FAIL_PROMPT,n["m.homeserver"].error=pt.ERROR_INVALID,Promise.resolve(n);if(!e["m.homeserver"].base_url)return k.error("No m.homeserver base_url in config"),n["m.homeserver"].state=pt.FAIL_PROMPT,n["m.homeserver"].error=pt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(n);const r=this.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!r)return k.error("Invalid base_url for m.homeserver"),n["m.homeserver"].error=pt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(n);const i=await this.fetchWellKnownObject(`${r}/_matrix/client/versions`);if(!i||!Array.isArray((c=i.raw)==null?void 0:c.versions))return k.error("Invalid /versions response"),n["m.homeserver"].error=pt.ERROR_INVALID_HOMESERVER,n["m.homeserver"].base_url=r,Promise.resolve(n);const s=new Set(i.raw.versions);let o=!1;for(const l of pC)if(s.has(l)){o=!0;break}if(!o)return k.error("Homeserver does not meet version requirements"),n["m.homeserver"].error=pt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,n["m.homeserver"].base_url=r,Promise.resolve(n);n["m.homeserver"]={state:pt.SUCCESS,error:null,base_url:r};let a="";if(e["m.identity_server"]){const l={"m.homeserver":n["m.homeserver"],"m.identity_server":{state:pt.FAIL_PROMPT,error:pt.ERROR_INVALID_IS,base_url:null}};if(a=this.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!a)return k.error("Invalid base_url for m.identity_server"),l["m.identity_server"].error=pt.ERROR_INVALID_IS_BASE_URL,Promise.resolve(l);const u=await this.fetchWellKnownObject(`${a}/_matrix/identity/v2`);if(!(u!=null&&u.raw)||u.action!=="SUCCESS")return k.error("Invalid /v2 response"),l["m.identity_server"].error=pt.ERROR_INVALID_IDENTITY_SERVER,l["m.identity_server"].base_url=a,Promise.resolve(l)}return a&&a.toString().length>0&&(n["m.identity_server"]={state:pt.SUCCESS,error:null,base_url:a}),Object.keys(e).forEach(l=>{if(l==="m.homeserver"||l==="m.identity_server"){const u=["error","state","base_url"];for(const d of Object.keys(e[l]))u.includes(d)||(n[l][d]=e[l][d])}else n[l]=e[l]}),Promise.resolve(n)}static async findClientConfig(e){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");const n={"m.homeserver":{state:pt.FAIL_ERROR,error:pt.ERROR_INVALID,base_url:null},"m.identity_server":{state:pt.PROMPT,error:null,base_url:null}},r=e.includes("://")?e:`https://${e}`,i=await this.fetchWellKnownObject(`${r}/.well-known/matrix/client`);return!i||i.action!=="SUCCESS"?(k.error("No response or error when parsing .well-known"),i.reason&&k.error(i.reason),i.action==="IGNORE"?n["m.homeserver"]={state:pt.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=pt.FAIL_PROMPT,n["m.homeserver"].error=pt.ERROR_INVALID),Promise.resolve(n)):pt.fromDiscoveryConfig(i.raw)}static async getRawClientConfig(e){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");const n=await this.fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return n?n.raw??{}:{}}static sanitizeWellKnownUrl(e){if(!e)return!1;try{let n;try{n=new URL(e)}catch(o){k.error("Could not parse url",o)}if(!(n!=null&&n.hostname)||n.protocol!=="http:"&&n.protocol!=="https:")return!1;const r=n.port?`:${n.port}`:"",i=n.pathname?n.pathname:"";let s=`${n.protocol}//${n.hostname}${r}${i}`;return s.endsWith("/")&&(s=s.substring(0,s.length-1)),s}catch(n){return k.error(n),!1}}static fetch(e,n){return this.fetchFn?this.fetchFn(e,n):global.fetch(e,n)}static setFetchFn(e){pt.fetchFn=e}static async fetchWellKnownObject(e){let n;try{if(n=await pt.fetch(e,{method:oe.Get,signal:N2(5e3)}),n.status===404)return{raw:{},action:"IGNORE",reason:pt.ERROR_MISSING_WELLKNOWN};if(!n.ok)return{raw:{},action:"FAIL_PROMPT",reason:"General failure"}}catch(r){const i=r;let s="";return typeof i=="object"&&(s=i==null?void 0:i.message),{error:i,raw:{},action:"FAIL_PROMPT",reason:s||"General failure"}}try{return{raw:await n.json(),action:"SUCCESS"}}catch(r){const i=r;return{error:i,raw:{},action:"FAIL_PROMPT",reason:(i==null?void 0:i.name)==="SyntaxError"?pt.ERROR_INVALID_JSON:pt.ERROR_INVALID}}}};pt.ERROR_INVALID="Invalid homeserver discovery response",pt.ERROR_GENERIC_FAILURE="Failed to get autodiscovery configuration from server",pt.ERROR_INVALID_HS_BASE_URL="Invalid base_url for m.homeserver",pt.ERROR_INVALID_HOMESERVER="Homeserver URL does not appear to be a valid Matrix homeserver",pt.ERROR_INVALID_IS_BASE_URL="Invalid base_url for m.identity_server",pt.ERROR_INVALID_IDENTITY_SERVER="Identity server URL does not appear to be a valid identity server",pt.ERROR_INVALID_IS="Invalid identity server discovery response",pt.ERROR_MISSING_WELLKNOWN="No .well-known JSON file found",pt.ERROR_INVALID_JSON="Invalid JSON",pt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION="The homeserver does not meet the version requirements",pt.ALL_ERRORS=Object.keys(k4),pt.FAIL_ERROR="FAIL_ERROR",pt.FAIL_PROMPT="FAIL_PROMPT",pt.PROMPT="PROMPT",pt.SUCCESS="SUCCESS";let gC=pt;var EF=/[\\\"\x00-\x1F]/g,Bu={};for(var aw=0;aw<32;++aw)Bu[String.fromCharCode(aw)]="\\U"+("0000"+aw.toString(16)).slice(-4).toUpperCase();Bu["\b"]="\\b";Bu["	"]="\\t";Bu[`
`]="\\n";Bu["\f"]="\\f";Bu["\r"]="\\r";Bu['"']='\\"';Bu["\\"]="\\\\";function mJ(t){return EF.lastIndex=0,t.replace(EF,function(e){return Bu[e]})}function R4(t){switch(typeof t){case"string":return'"'+mJ(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return t===null?"null":Array.isArray(t)?iTe(t):sTe(t);default:throw new Error("Cannot stringify: "+typeof t)}}function iTe(t){for(var e="[",n="",r=0;r<t.length;++r)n+=e,e=",",n+=R4(t[r]);return e!=","?"[]":n+"]"}function sTe(t){var e="{",n="",r=Object.keys(t);r.sort();for(var i=0;i<r.length;++i){var s=r[i];n+=e+'"'+mJ(s)+'":',e=",",n+=R4(t[s])}return e!=","?"{}":n+"}"}var oTe={stringify:R4};const du=es(oTe),ri="m.olm.v1.curve25519-aes-sha2",Ks="m.megolm.v1.aes-sha2",aTe="m.megolm_backup.v1.curve25519-aes-sha2";async function cf(t,e,n,r,i,s,o){const a=s.getIdentityKey(),c=await r.getSessionIdForDevice(a);if(c===null){k.log(`[olmlib.encryptMessageForDevice] Unable to find Olm session for device ${i}:${s.deviceId}`);return}k.log(`[olmlib.encryptMessageForDevice] Using Olm session ${c} for device ${i}:${s.deviceId}`);const l={sender:e,sender_device:n,keys:{ed25519:r.deviceEd25519Key},recipient:i,recipient_keys:{ed25519:s.getFingerprint()},...o};t[a]=await r.encryptMessage(a,c,JSON.stringify(l))}async function vJ(t,e,n){const r=new fr(()=>[]),i=new fr(()=>new Map),s=[];for(const[o,a]of Object.entries(n))for(const c of a){const l=c.deviceId,u=c.getIdentityKey();s.push((async()=>{const d=await t.getSessionIdForDevice(u,!0);d===null?r.getOrCreate(o).push(c):i.getOrCreate(o).set(l,{device:c,sessionId:d})})())}return await Promise.all(s),[r,i]}async function fu(t,e,n,r=!1,i,s,o=k){var v,S,_;const a=[],c=new Map,l=new Map;for(const w of n.values())for(const T of w){const C=T.getIdentityKey();C!==t.deviceCurve25519Key&&(t.sessionsInProgress[C]||(t.sessionsInProgress[C]=new Promise(I=>{l.set(C,R=>{delete t.sessionsInProgress[C],I(R)})})))}for(const[w,T]of n){const C=new Map;c.set(w,C);for(const I of T){const R=I.deviceId,O=I.getIdentityKey();if(O===t.deviceCurve25519Key){o.info("Attempted to start session with ourself! Ignoring"),C.set(R,{device:I,sessionId:null});continue}const A=`for ${O} (${w}:${R})`,U=await t.getSessionIdForDevice(O,!!l.get(O),o),N=l.get(O);U!==null&&N&&N(),(U===null||r)&&(r?o.info(`Forcing new Olm session ${A}`):o.info(`Making new Olm session ${A}`),a.push([w,R])),C.set(R,{device:I,sessionId:U})}}if(a.length===0)return c;const u="signed_curve25519";let d,f=`one-time keys for ${a.length} devices`;try{o.debug(`Claiming ${f}`),d=await e.claimOneTimeKeys(a,u,i),o.debug(`Claimed ${f}`)}catch(w){for(const T of l.values())T();throw o.debug(`Failed to claim ${f}`,w,a),w}s&&"failures"in d&&s.push(...Object.keys(d.failures));const p=d.one_time_keys||{},m=[];for(const[w,T]of n){const C=p[w]||{};for(const I of T){const R=I.deviceId,O=I.getIdentityKey();if(O===t.deviceCurve25519Key||(S=(v=c.get(w))==null?void 0:v.get(R))!=null&&S.sessionId&&!r)continue;const A=C[R]||{};let U=null;for(const N in A)N.indexOf(u+":")===0&&(U=A[N]);if(!U){o.warn(`No one-time keys (alg=${u}) for device ${w}:${R}`),(_=l.get(O))==null||_();continue}m.push(cTe(t,U,w,I).then(N=>{var j,X;(j=l.get(O))==null||j(N??void 0);const L=(X=c.get(w))==null?void 0:X.get(R);L&&(L.sessionId=N)},N=>{var L;throw(L=l.get(O))==null||L(),N}))}}return f=`Olm sessions for ${m.length} devices`,o.debug(`Starting ${f}`),await Promise.all(m),o.debug(`Started ${f}`),c}async function cTe(t,e,n,r){const i=r.deviceId;try{await Zm(t,e,n,i,r.getFingerprint())}catch(o){return k.error("Unable to verify signature on one-time key for device "+n+":"+i+":",o),null}let s;try{s=await t.createOutboundSession(r.getIdentityKey(),e.key)}catch(o){return k.error("Error starting olm session with device "+n+":"+i+": "+o),null}return k.log("Started new olm sessionid "+s+" for device "+n+":"+i),s}async function Zm(t,e,n,r,i){const s="ed25519:"+r,c=((e.signatures||{})[n]||{})[s];if(!c)throw Error("No signature");const l=Object.assign({},e);"unsigned"in l&&delete l.unsigned,delete l.signatures;const u=du.stringify(l);t.verifySignature(i,u,c)}function GE(t,e,n,r){let i=!1;if(e instanceof Uint8Array){const a=new global.Olm.PkSigning;r=a.init_with_seed(e),e=a,i=!0}const s=t.signatures||{};delete t.signatures;const o=t.unsigned;t.unsigned&&delete t.unsigned;try{const a=s[n]||{};return s[n]=a,a["ed25519:"+r]=e.sign(du.stringify(t))}finally{t.signatures=s,o&&(t.unsigned=o),i&&e.free()}}function Mg(t,e,n){const r="ed25519:"+e;if(!(t.signatures&&t.signatures[n]&&t.signatures[n][r]))throw new Error("No signature");const i=t.signatures[n][r],s=new global.Olm.Utility,o=t.signatures;delete t.signatures;const a=t.unsigned;t.unsigned&&delete t.unsigned;try{s.ed25519_verify(e,du.stringify(t),i)}finally{t.signatures=o,a&&(t.unsigned=a),s.free()}}function I4(t){return t.getSenderKey()?t.getWireType()!==Z.RoomMessageEncrypted||!["m.olm.v1.curve25519-aes-sha2"].includes(t.getWireContent().algorithm)?(k.error("Event was not encrypted using an appropriate algorithm"),!1):!0:(k.error("Event has no sender key (not encrypted?)"),!1)}const lTe=Object.freeze(Object.defineProperty({__proto__:null,MEGOLM_ALGORITHM:Ks,MEGOLM_BACKUP_ALGORITHM:aTe,OLM_ALGORITHM:ri,encryptMessageForDevice:cf,ensureOlmSessionsForDevices:fu,getExistingOlmSessions:vJ,isOlmEncrypted:I4,pkSign:GE,pkVerify:Mg,verifySignature:Zm},Symbol.toStringTag,{value:"Module"}));var mC=(t=>(t.IS="SERVICE_TYPE_IS",t.IM="SERVICE_TYPE_IM",t))(mC||{});const Js="crypto.",TF=Js+"migration",v3=Js+"account",CF=Js+"cross_signing_keys",kF=Js+"notified_error_devices",RF=Js+"device_data",ld=Js+"inboundgroupsessions/",uTe=Js+"inboundgroupsessions.withheld/",dTe=Js+"rooms/",Wf=Js+"sessionsneedingbackup";function Yf(t){return Js+"sessions/"+t}function IF(t){return Js+"session.problems/"+t}function cw(t,e){return ld+t+"/"+e}function xF(t,e){return uTe+t+"/"+e}function PF(t){return dTe+t}class H2 extends x2{constructor(e){super(),this.store=e}static exists(e){var r;const n=e.length;for(let i=0;i<n;i++)if((r=e.key(i))!=null&&r.startsWith(Js))return!0;return!1}async containsData(){return H2.exists(this.store)}async getMigrationState(){return mr(this.store,TF)??Wh.NOT_STARTED}async setMigrationState(e){Ps(this.store,TF,e)}countEndToEndSessions(e,n){let r=0;for(let i=0;i<this.store.length;++i){const s=this.store.key(i);if(s!=null&&s.startsWith(Yf(""))){const o=mr(this.store,s);r+=Object.keys(o??{}).length}}n(r)}_getEndToEndSessions(e){const n=mr(this.store,Yf(e)),r={};for(const[i,s]of Object.entries(n||{}))typeof s=="string"?r[i]={session:s}:r[i]=s;return r}getEndToEndSession(e,n,r,i){const s=this._getEndToEndSessions(e);i(s[n]||{})}getEndToEndSessions(e,n,r){r(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,n){var r;for(let i=0;i<this.store.length;++i)if((r=this.store.key(i))!=null&&r.startsWith(Yf(""))){const s=this.store.key(i).split("/")[1];for(const o of Object.values(this._getEndToEndSessions(s)))n(o)}}storeEndToEndSession(e,n,r,i){const s=this._getEndToEndSessions(e)||{};s[n]=r,Ps(this.store,Yf(e),s)}async storeEndToEndSessionProblem(e,n,r){const i=IF(e),s=mr(this.store,i)||[];s.push({type:n,fixed:r,time:Date.now()}),s.sort((o,a)=>o.time-a.time),Ps(this.store,i,s)}async getEndToEndSessionProblem(e,n){const r=IF(e),i=mr(this.store,r)||[];if(!i.length)return null;const s=i[i.length-1];for(const o of i)if(o.time>n)return Object.assign({},o,{fixed:s.fixed});return s.fixed?null:s}async filterOutNotifiedErrorDevices(e){const n=mr(this.store,kF)||{},r=[];for(const i of e){const{userId:s,deviceInfo:o}=i;s in n?o.deviceId in n[s]||(r.push(i),nl(n[s],o.deviceId,!0)):(r.push(i),nl(n,s,{[o.deviceId]:!0}))}return Ps(this.store,kF,n),r}async getEndToEndSessionsBatch(){var n;const e=[];for(let r=0;r<this.store.length;++r)if((n=this.store.key(r))!=null&&n.startsWith(Yf(""))){const i=this.store.key(r).split("/")[1];for(const s of Object.values(this._getEndToEndSessions(i)))if(e.push(s),e.length>=Xm)return e}return e.length===0?null:e}async deleteEndToEndSessionsBatch(e){for(const{deviceKey:n,sessionId:r}of e){const i=this._getEndToEndSessions(n)||{};delete i[r],Object.keys(i).length===0?this.store.removeItem(Yf(n)):Ps(this.store,Yf(n),i)}}getEndToEndInboundGroupSession(e,n,r,i){i(mr(this.store,cw(e,n)),mr(this.store,xF(e,n)))}getAllEndToEndInboundGroupSessions(e,n){for(let r=0;r<this.store.length;++r){const i=this.store.key(r);i!=null&&i.startsWith(ld)&&n({senderKey:i.slice(ld.length,ld.length+43),sessionId:i.slice(ld.length+44),sessionData:mr(this.store,i)})}n(null)}addEndToEndInboundGroupSession(e,n,r,i){mr(this.store,cw(e,n))||this.storeEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSession(e,n,r,i){Ps(this.store,cw(e,n),r)}storeEndToEndInboundGroupSessionWithheld(e,n,r,i){Ps(this.store,xF(e,n),r)}async countEndToEndInboundGroupSessions(){let e=0;for(let n=0;n<this.store.length;++n){const r=this.store.key(n);r!=null&&r.startsWith(ld)&&(e+=1)}return e}async getEndToEndInboundGroupSessionsBatch(){const e=mr(this.store,Wf)||{},n=[];for(let r=0;r<this.store.length;++r){const i=this.store.key(r);if(i!=null&&i.startsWith(ld)){const s=i.slice(ld.length);if(n.push({senderKey:s.slice(0,43),sessionId:s.slice(44),sessionData:mr(this.store,i),needsBackup:s in e}),n.length>=Xm)return n}}return n.length===0?null:n}async deleteEndToEndInboundGroupSessionsBatch(e){for(const{senderKey:n,sessionId:r}of e){const i=cw(n,r);this.store.removeItem(i)}}getEndToEndDeviceData(e,n){n(mr(this.store,RF))}storeEndToEndDeviceData(e,n){Ps(this.store,RF,e)}storeEndToEndRoom(e,n,r){Ps(this.store,PF(e),n)}getEndToEndRooms(e,n){const r={},i=PF("");for(let s=0;s<this.store.length;++s){const o=this.store.key(s);if(o!=null&&o.startsWith(i)){const a=o.slice(i.length);r[a]=mr(this.store,o)}}n(r)}getSessionsNeedingBackup(e){const n=mr(this.store,Wf)||{},r=[];for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){const s=i.slice(0,43),o=i.slice(44);if(this.getEndToEndInboundGroupSession(s,o,null,a=>{r.push({senderKey:s,sessionId:o,sessionData:a})}),e&&r.length>=e)break}return Promise.resolve(r)}countSessionsNeedingBackup(){const e=mr(this.store,Wf)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const n=mr(this.store,Wf)||{};for(const r of e)delete n[r.senderKey+"/"+r.sessionId];return Ps(this.store,Wf,n),Promise.resolve()}markSessionsNeedingBackup(e){const n=mr(this.store,Wf)||{};for(const r of e)n[r.senderKey+"/"+r.sessionId]=!0;return Ps(this.store,Wf,n),Promise.resolve()}deleteAllData(){return this.store.removeItem(v3),Promise.resolve()}getAccount(e,n){const r=mr(this.store,v3);n(r)}storeAccount(e,n){Ps(this.store,v3,n)}getCrossSigningKeys(e,n){const r=mr(this.store,CF);n(r)}getSecretStorePrivateKey(e,n,r){const i=mr(this.store,Js+`ssss_cache.${r}`);n(i)}storeCrossSigningKeys(e,n){Ps(this.store,CF,n)}storeSecretStorePrivateKey(e,n,r){Ps(this.store,Js+`ssss_cache.${n}`,r)}doTxn(e,n,r){return Promise.resolve(r(null))}}function mr(t,e){try{return JSON.parse(t.getItem(e))}catch(n){k.log("Error: Failed to get key %s: %s",e,n.message),k.log(n.stack)}return null}function Ps(t,e,n){t.setItem(e,JSON.stringify(n))}let fTe=class{constructor(e){this.db=e,this.nextTxnId=0,e.onversionchange=()=>{k.log(`versionchange for indexeddb ${this.db.name}: closing`),e.close()}}async containsData(){throw Error("Not implemented for Backend")}async startup(){return this}async deleteAllData(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")}async getMigrationState(){let e=Wh.NOT_STARTED;return await this.doTxn("readonly",[Be.STORE_ACCOUNT],n=>{const i=n.objectStore(Be.STORE_ACCOUNT).get(w6);i.onsuccess=()=>{e=i.result??Wh.NOT_STARTED}}),e}async setMigrationState(e){await this.doTxn("readwrite",[Be.STORE_ACCOUNT],n=>{n.objectStore(Be.STORE_ACCOUNT).put(e,w6)})}getOrAddOutgoingRoomKeyRequest(e){const n=e.requestBody;return new Promise((r,i)=>{const s=this.db.transaction("outgoingRoomKeyRequests","readwrite");s.onerror=i,this._getOutgoingRoomKeyRequest(s,n,o=>{if(o){k.log(`already have key request outstanding for ${n.room_id} / ${n.session_id}: not sending another`),r(o);return}k.log(`enqueueing key request for ${n.room_id} / `+n.session_id),s.oncomplete=()=>{r(e)},s.objectStore("outgoingRoomKeyRequests").add(e)})})}getOutgoingRoomKeyRequest(e){return new Promise((n,r)=>{const i=this.db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=r,this._getOutgoingRoomKeyRequest(i,e,s=>{n(s)})})}_getOutgoingRoomKeyRequest(e,n,r){const o=e.objectStore("outgoingRoomKeyRequests").index("session").openCursor([n.room_id,n.session_id]);o.onsuccess=()=>{const a=o.result;if(!a){r(null);return}const c=a.value;if(of(c.requestBody,n)){r(c);return}a.continue()}}getOutgoingRoomKeyRequestByState(e){if(e.length===0)return Promise.resolve(null);let n=0,r;function i(){const l=this.result;if(l){r=l.value;return}if(n++,n>=e.length)return;const u=e[n],d=this.source.openCursor(u);d.onsuccess=i}const s=this.db.transaction("outgoingRoomKeyRequests","readonly"),o=s.objectStore("outgoingRoomKeyRequests"),a=e[n],c=o.index("state").openCursor(a);return c.onsuccess=i,Jf(s).then(()=>r)}getAllOutgoingRoomKeyRequestsByState(e){return new Promise((n,r)=>{const a=this.db.transaction("outgoingRoomKeyRequests","readonly").objectStore("outgoingRoomKeyRequests").index("state").getAll(e);a.onsuccess=()=>n(a.result),a.onerror=()=>r(a.error)})}getOutgoingRoomKeyRequestsByTarget(e,n,r){let i=0;const s=[];function o(){const d=this.result;if(d){const f=d.value;f.recipients.some(p=>p.userId===e&&p.deviceId===n)&&s.push(f),d.continue()}else{if(i++,i>=r.length)return;const f=r[i],p=this.source.openCursor(f);p.onsuccess=o}}const a=this.db.transaction("outgoingRoomKeyRequests","readonly"),c=a.objectStore("outgoingRoomKeyRequests"),l=r[i],u=c.index("state").openCursor(l);return u.onsuccess=o,Jf(a).then(()=>s)}updateOutgoingRoomKeyRequest(e,n,r){let i=null;function s(){const c=this.result;if(!c)return;const l=c.value;if(l.state!=n){k.warn(`Cannot update room key request from ${n} as it was already updated to ${l.state}`);return}Object.assign(l,r),c.update(l),i=l}const o=this.db.transaction("outgoingRoomKeyRequests","readwrite"),a=o.objectStore("outgoingRoomKeyRequests").openCursor(e);return a.onsuccess=s,Jf(o).then(()=>i)}deleteOutgoingRoomKeyRequest(e,n){const r=this.db.transaction("outgoingRoomKeyRequests","readwrite"),i=r.objectStore("outgoingRoomKeyRequests").openCursor(e);return i.onsuccess=()=>{const s=i.result;if(!s)return;const o=s.value;if(o.state!=n){k.warn(`Cannot delete room key request in state ${o.state} (expected ${n})`);return}s.delete()},Jf(r)}getAccount(e,n){const i=e.objectStore("account").get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Jr(e,s)}}}storeAccount(e,n){e.objectStore("account").put(n,"-")}getCrossSigningKeys(e,n){const i=e.objectStore("account").get("crossSigningKeys");i.onsuccess=function(){try{n(i.result||null)}catch(s){Jr(e,s)}}}getSecretStorePrivateKey(e,n,r){const s=e.objectStore("account").get(`ssss_cache:${r}`);s.onsuccess=function(){try{n(s.result||null)}catch(o){Jr(e,o)}}}storeCrossSigningKeys(e,n){e.objectStore("account").put(n,"crossSigningKeys")}storeSecretStorePrivateKey(e,n,r){e.objectStore("account").put(r,`ssss_cache:${n}`)}countEndToEndSessions(e,n){const i=e.objectStore("sessions").count();i.onsuccess=function(){try{n(i.result)}catch(s){Jr(e,s)}}}getEndToEndSessions(e,n,r){const o=n.objectStore("sessions").index("deviceKey").openCursor(e),a={};o.onsuccess=function(){const c=o.result;if(c)a[c.value.sessionId]={session:c.value.session,lastReceivedMessageTs:c.value.lastReceivedMessageTs},c.continue();else try{r(a)}catch(l){Jr(n,l)}}}getEndToEndSession(e,n,r,i){const o=r.objectStore("sessions").get([e,n]);o.onsuccess=function(){try{o.result?i({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):i(null)}catch(a){Jr(r,a)}}}getAllEndToEndSessions(e,n){const i=e.objectStore("sessions").openCursor();i.onsuccess=function(){try{const s=i.result;s?(n(s.value),s.continue()):n(null)}catch(s){Jr(e,s)}}}storeEndToEndSession(e,n,r,i){i.objectStore("sessions").put({deviceKey:e,sessionId:n,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}async storeEndToEndSessionProblem(e,n,r){const i=this.db.transaction("session_problems","readwrite");i.objectStore("session_problems").put({deviceKey:e,type:n,fixed:r,time:Date.now()}),await Jf(i)}async getEndToEndSessionProblem(e,n){let r=null;const i=this.db.transaction("session_problems","readwrite"),a=i.objectStore("session_problems").index("deviceKey").getAll(e);return a.onsuccess=()=>{const c=a.result;if(!c.length){r=null;return}c.sort((u,d)=>u.time-d.time);const l=c[c.length-1];for(const u of c)if(u.time>n){r=Object.assign({},u,{fixed:l.fixed});return}l.fixed?r=null:r=l},await Jf(i),r}async filterOutNotifiedErrorDevices(e){const r=this.db.transaction("notified_error_devices","readwrite").objectStore("notified_error_devices"),i=[];return await Promise.all(e.map(s=>new Promise(o=>{const{userId:a,deviceInfo:c}=s,l=r.get([a,c.deviceId]);l.onsuccess=function(){l.result||(r.put({userId:a,deviceId:c.deviceId}),i.push(s)),o()}}))),i}async getEndToEndSessionsBatch(){const e=[];return await this.doTxn("readonly",[Be.STORE_SESSIONS],n=>{const i=n.objectStore(Be.STORE_SESSIONS).openCursor();i.onsuccess=function(){try{const s=i.result;s&&(e.push(s.value),e.length<Xm&&s.continue())}catch(s){Jr(n,s)}}}),e.length===0?null:e}async deleteEndToEndSessionsBatch(e){await this.doTxn("readwrite",[Be.STORE_SESSIONS],async n=>{try{const r=n.objectStore(Be.STORE_SESSIONS);for(const{deviceKey:i,sessionId:s}of e){const o=r.delete([i,s]);await new Promise(a=>{o.onsuccess=a})}}catch(r){Jr(n,r)}})}getEndToEndInboundGroupSession(e,n,r,i){let s=!1,o=!1;const c=r.objectStore("inbound_group_sessions").get([e,n]);c.onsuccess=function(){try{c.result?s=c.result.session:s=null,o!==!1&&i(s,o)}catch(d){Jr(r,d)}};const u=r.objectStore("inbound_group_sessions_withheld").get([e,n]);u.onsuccess=function(){try{u.result?o=u.result.session:o=null,s!==!1&&i(s,o)}catch(d){Jr(r,d)}}}getAllEndToEndInboundGroupSessions(e,n){const i=e.objectStore("inbound_group_sessions").openCursor();i.onsuccess=function(){const s=i.result;if(s){try{n({senderKey:s.value.senderCurve25519Key,sessionId:s.value.sessionId,sessionData:s.value.session})}catch(o){Jr(e,o)}s.continue()}else try{n(null)}catch(o){Jr(e,o)}}}addEndToEndInboundGroupSession(e,n,r,i){const o=i.objectStore("inbound_group_sessions").add({senderCurve25519Key:e,sessionId:n,session:r});o.onerror=a=>{var c;((c=o.error)==null?void 0:c.name)==="ConstraintError"?(a.stopPropagation(),a.preventDefault(),k.log("Ignoring duplicate inbound group session: "+e+" / "+n)):Jr(i,new Error("Failed to add inbound group session: "+o.error))}}storeEndToEndInboundGroupSession(e,n,r,i){i.objectStore("inbound_group_sessions").put({senderCurve25519Key:e,sessionId:n,session:r})}storeEndToEndInboundGroupSessionWithheld(e,n,r,i){i.objectStore("inbound_group_sessions_withheld").put({senderCurve25519Key:e,sessionId:n,session:r})}async countEndToEndInboundGroupSessions(){let e=0;return await this.doTxn("readonly",[Be.STORE_INBOUND_GROUP_SESSIONS],n=>{const i=n.objectStore(Be.STORE_INBOUND_GROUP_SESSIONS).count();i.onsuccess=()=>{e=i.result}}),e}async getEndToEndInboundGroupSessionsBatch(){const e=[];return await this.doTxn("readonly",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_BACKUP],n=>{const r=n.objectStore(Be.STORE_INBOUND_GROUP_SESSIONS),i=n.objectStore(Be.STORE_BACKUP),s=r.openCursor();s.onsuccess=function(){try{const o=s.result;if(o){const a=i.get(o.key);a.onsuccess=()=>{e.push({senderKey:o.value.senderCurve25519Key,sessionId:o.value.sessionId,sessionData:o.value.session,needsBackup:a.result!==void 0}),e.length<Xm&&o.continue()}}}catch(o){Jr(n,o)}}}),e.length===0?null:e}async deleteEndToEndInboundGroupSessionsBatch(e){await this.doTxn("readwrite",[Be.STORE_INBOUND_GROUP_SESSIONS],async n=>{try{const r=n.objectStore(Be.STORE_INBOUND_GROUP_SESSIONS);for(const{senderKey:i,sessionId:s}of e){const o=r.delete([i,s]);await new Promise(a=>{o.onsuccess=a})}}catch(r){Jr(n,r)}})}getEndToEndDeviceData(e,n){const i=e.objectStore("device_data").get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Jr(e,s)}}}storeEndToEndDeviceData(e,n){n.objectStore("device_data").put(e,"-")}storeEndToEndRoom(e,n,r){r.objectStore("rooms").put(n,e)}getEndToEndRooms(e,n){const r={},s=e.objectStore("rooms").openCursor();s.onsuccess=function(){const o=s.result;if(o)r[o.key]=o.value,o.continue();else try{n(r)}catch(a){Jr(e,a)}}}getSessionsNeedingBackup(e){return new Promise((n,r)=>{const i=[],s=this.db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");s.onerror=r,s.oncomplete=function(){n(i)};const o=s.objectStore("sessions_needing_backup"),a=s.objectStore("inbound_group_sessions"),c=o.openCursor();c.onsuccess=function(){const l=c.result;if(l){const u=a.get(l.key);u.onsuccess=function(){i.push({senderKey:u.result.senderCurve25519Key,sessionId:u.result.sessionId,sessionData:u.result.session})},(!e||i.length<e)&&l.continue()}}})}countSessionsNeedingBackup(e){e||(e=this.db.transaction("sessions_needing_backup","readonly"));const n=e.objectStore("sessions_needing_backup");return new Promise((r,i)=>{const s=n.count();s.onerror=i,s.onsuccess=()=>r(s.result)})}async unmarkSessionsNeedingBackup(e,n){n||(n=this.db.transaction("sessions_needing_backup","readwrite"));const r=n.objectStore("sessions_needing_backup");await Promise.all(e.map(i=>new Promise((s,o)=>{const a=r.delete([i.senderKey,i.sessionId]);a.onsuccess=s,a.onerror=o})))}async markSessionsNeedingBackup(e,n){n||(n=this.db.transaction("sessions_needing_backup","readwrite"));const r=n.objectStore("sessions_needing_backup");await Promise.all(e.map(i=>new Promise((s,o)=>{const a=r.put({senderCurve25519Key:i.senderKey,sessionId:i.sessionId});a.onsuccess=s,a.onerror=o})))}addSharedHistoryInboundGroupSession(e,n,r,i){i||(i=this.db.transaction("shared_history_inbound_group_sessions","readwrite"));const s=i.objectStore("shared_history_inbound_group_sessions"),o=s.get([e]);o.onsuccess=()=>{const{sessions:a}=o.result||{sessions:[]};a.push([n,r]),s.put({roomId:e,sessions:a})}}getSharedHistoryInboundGroupSessions(e,n){n||(n=this.db.transaction("shared_history_inbound_group_sessions","readonly"));const i=n.objectStore("shared_history_inbound_group_sessions").get([e]);return new Promise((s,o)=>{i.onsuccess=()=>{const{sessions:a}=i.result||{sessions:[]};s(a)},i.onerror=o})}addParkedSharedHistory(e,n,r){r||(r=this.db.transaction("parked_shared_history","readwrite"));const i=r.objectStore("parked_shared_history"),s=i.get([e]);s.onsuccess=()=>{const{parked:o}=s.result||{parked:[]};o.push(n),i.put({roomId:e,parked:o})}}takeParkedSharedHistory(e,n){n||(n=this.db.transaction("parked_shared_history","readwrite"));const r=n.objectStore("parked_shared_history").openCursor(e);return new Promise((i,s)=>{r.onsuccess=()=>{const o=r.result;if(!o){i([]);return}const a=o.value;o.delete(),i(a)},r.onerror=s})}doTxn(e,n,r,i=k){const s=this.db.transaction(n,e),o=Jf(s),a=r(s);return o.then(()=>a)}};const yJ=[t=>{pTe(t)},t=>{t.createObjectStore("account")},t=>{t.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]}).createIndex("deviceKey","deviceKey")},t=>{t.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("device_data")},t=>{t.createObjectStore("rooms")},t=>{t.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("session_problems",{keyPath:["deviceKey","time"]}).createIndex("deviceKey","deviceKey"),t.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},t=>{t.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t=>{t.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],_J=yJ.length;function hTe(t,e){k.log(`Upgrading IndexedDBCryptoStore from version ${e} to ${_J}`),yJ.forEach((n,r)=>{e<=r&&n(t)})}function pTe(t){const e=t.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});e.createIndex("session",["requestBody.room_id","requestBody.session_id"]),e.createIndex("state","state")}function Jr(t,e){t._mx_abortexception=e;try{t.abort()}catch{}}function Jf(t){return new Promise((e,n)=>{t.oncomplete=()=>{t._mx_abortexception!==void 0&&n(t._mx_abortexception),e(null)},t.onerror=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(k.log("Error performing indexeddb txn",r),n(t.error))},t.onabort=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(k.log("Error performing indexeddb txn",r),n(t.error))}})}var x4=(t=>(t.TooNew="TOO_NEW",t))(x4||{});const r7=class r7 extends Error{constructor(e){const n=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`;super(n),this.reason=e,this.name="InvalidCryptoStoreError"}};r7.TOO_NEW="TOO_NEW";let vC=r7;class x1 extends Error{constructor(e,n){super(e),this.value=n}}class gTe extends Error{constructor(){super("MatrixClient has been stopped")}}function bJ(t,e){return new Promise((n,r)=>{let i=!0;const s=t.open(e);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{s.result.close(),i||t.deleteDatabase(e),n(i)},s.onerror=()=>r(s.error)})}const ji=class ji{constructor(e,n){this.indexedDB=e,this.dbName=n}static exists(e,n){return bJ(e,n)}static existsAndIsNotMigrated(e,n){return new Promise((r,i)=>{let s=!0;const o=e.open(n);o.onupgradeneeded=()=>{s=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{const a=o.result;if(!s)a.close(),e.deleteDatabase(n),r(!1);else{const u=a.transaction([ji.STORE_ACCOUNT],"readonly").objectStore(ji.STORE_ACCOUNT).get(w6);u.onsuccess=()=>{const d=u.result??Wh.NOT_STARTED;r(d===Wh.NOT_STARTED)},u.onerror=()=>{i(u.error)},a.close()}},o.onerror=()=>i(o.error)})}async containsData(){return ji.exists(this.indexedDB,this.dbName)}startup(){return this.backendPromise?this.backendPromise:(this.backendPromise=new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}k.log(`connecting to indexeddb ${this.dbName}`);const r=this.indexedDB.open(this.dbName,_J);r.onupgradeneeded=i=>{const s=r.result,o=i.oldVersion;hTe(s,o)},r.onblocked=()=>{k.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{k.log("Error connecting to indexeddb",i),n(r.error)},r.onsuccess=()=>{const i=r.result;k.log(`connected to indexeddb ${this.dbName}`),e(new fTe(i))}}).then(e=>e.doTxn("readonly",[ji.STORE_INBOUND_GROUP_SESSIONS,ji.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{e.getEndToEndInboundGroupSession("","",n,()=>{})}).then(()=>e)).catch(e=>{if(e.name==="VersionError")throw k.warn("Crypto DB is too new for us to use!",e),new vC(x4.TooNew);k.warn(`unable to connect to indexeddb ${this.dbName}: falling back to localStorage store: ${e}`);try{return new H2(global.localStorage)}catch(n){return k.warn(`unable to open localStorage: falling back to in-memory store: ${n}`),new x2}}).then(e=>(this.backend=e,e)),this.backendPromise)}deleteAllData(){return new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}k.log(`Removing indexeddb instance: ${this.dbName}`);const r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{k.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{k.log("Error deleting data from indexeddb",i),n(r.error)},r.onsuccess=()=>{k.log(`Removed indexeddb instance: ${this.dbName}`),e()}}).catch(e=>{k.warn(`unable to delete IndexedDBCryptoStore: ${e}`)})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getOrAddOutgoingRoomKeyRequest(e){return this.backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this.backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this.backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this.backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,n,r){return this.backend.getOutgoingRoomKeyRequestsByTarget(e,n,r)}updateOutgoingRoomKeyRequest(e,n,r){return this.backend.updateOutgoingRoomKeyRequest(e,n,r)}deleteOutgoingRoomKeyRequest(e,n){return this.backend.deleteOutgoingRoomKeyRequest(e,n)}getAccount(e,n){this.backend.getAccount(e,n)}storeAccount(e,n){this.backend.storeAccount(e,n)}getCrossSigningKeys(e,n){this.backend.getCrossSigningKeys(e,n)}getSecretStorePrivateKey(e,n,r){this.backend.getSecretStorePrivateKey(e,n,r)}storeCrossSigningKeys(e,n){this.backend.storeCrossSigningKeys(e,n)}storeSecretStorePrivateKey(e,n,r){this.backend.storeSecretStorePrivateKey(e,n,r)}countEndToEndSessions(e,n){this.backend.countEndToEndSessions(e,n)}getEndToEndSession(e,n,r,i){this.backend.getEndToEndSession(e,n,r,i)}getEndToEndSessions(e,n,r){this.backend.getEndToEndSessions(e,n,r)}getAllEndToEndSessions(e,n){this.backend.getAllEndToEndSessions(e,n)}storeEndToEndSession(e,n,r,i){this.backend.storeEndToEndSession(e,n,r,i)}storeEndToEndSessionProblem(e,n,r){return this.backend.storeEndToEndSessionProblem(e,n,r)}getEndToEndSessionProblem(e,n){return this.backend.getEndToEndSessionProblem(e,n)}filterOutNotifiedErrorDevices(e){return this.backend.filterOutNotifiedErrorDevices(e)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,n,r,i){this.backend.getEndToEndInboundGroupSession(e,n,r,i)}getAllEndToEndInboundGroupSessions(e,n){this.backend.getAllEndToEndInboundGroupSessions(e,n)}addEndToEndInboundGroupSession(e,n,r,i){this.backend.addEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSession(e,n,r,i){this.backend.storeEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSessionWithheld(e,n,r,i){this.backend.storeEndToEndInboundGroupSessionWithheld(e,n,r,i)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}storeEndToEndDeviceData(e,n){this.backend.storeEndToEndDeviceData(e,n)}getEndToEndDeviceData(e,n){this.backend.getEndToEndDeviceData(e,n)}storeEndToEndRoom(e,n,r){this.backend.storeEndToEndRoom(e,n,r)}getEndToEndRooms(e,n){this.backend.getEndToEndRooms(e,n)}getSessionsNeedingBackup(e){return this.backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this.backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,n){return this.backend.unmarkSessionsNeedingBackup(e,n)}markSessionsNeedingBackup(e,n){return this.backend.markSessionsNeedingBackup(e,n)}addSharedHistoryInboundGroupSession(e,n,r,i){this.backend.addSharedHistoryInboundGroupSession(e,n,r,i)}getSharedHistoryInboundGroupSessions(e,n){return this.backend.getSharedHistoryInboundGroupSessions(e,n)}addParkedSharedHistory(e,n,r){this.backend.addParkedSharedHistory(e,n,r)}takeParkedSharedHistory(e,n){return this.backend.takeParkedSharedHistory(e,n)}doTxn(e,n,r,i){return this.backend.doTxn(e,n,r,i)}};ji.STORE_ACCOUNT="account",ji.STORE_SESSIONS="sessions",ji.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",ji.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",ji.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",ji.STORE_PARKED_SHARED_HISTORY="parked_shared_history",ji.STORE_DEVICE_DATA="device_data",ji.STORE_ROOMS="rooms",ji.STORE_BACKUP="sessions_needing_backup";let Be=ji;var hd=(t=>(t.Change="change",t))(hd||{}),Cf=(t=>(t[t.Unsent=1]="Unsent",t[t.Requested=2]="Requested",t[t.Ready=3]="Ready",t[t.Started=4]="Started",t[t.Cancelled=5]="Cancelled",t[t.Done=6]="Done",t))(Cf||{}),wb=(t=>(t.Cancel="cancel",t.ShowSas="show_sas",t.ShowReciprocateQr="show_reciprocate_qr",t))(wb||{});function SJ(t){return t.phase<3&&!t.accepting&&!t.declining}function mTe(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),d=u.charCodeAt(0);if(e[d]!==255)throw new TypeError(u+" is ambiguous");e[d]=l}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,d=0,f=0;const p=l.length;for(;f!==p&&l[f]===0;)f++,u++;const m=(p-f)*s+1>>>0,v=new Uint8Array(m);for(;f!==p;){let w=l[f],T=0;for(let C=m-1;(w!==0||T<d)&&C!==-1;C--,T++)w+=256*v[C]>>>0,v[C]=w%n>>>0,w=w/n>>>0;if(w!==0)throw new Error("Non-zero carry");d=T,f++}let S=m-d;for(;S!==m&&v[S]===0;)S++;let _=r.repeat(u);for(;S<m;++S)_+=t.charAt(v[S]);return _}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,d=0,f=0;for(;l[u]===r;)d++,u++;const p=(l.length-u)*i+1>>>0,m=new Uint8Array(p);for(;l[u];){let w=e[l.charCodeAt(u)];if(w===255)return;let T=0;for(let C=p-1;(w!==0||T<f)&&C!==-1;C--,T++)w+=n*m[C]>>>0,m[C]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");f=T,u++}let v=p-f;for(;v!==p&&m[v]===0;)v++;const S=new Uint8Array(d+(p-v));let _=d;for(;v!==p;)S[_++]=m[v++];return S}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var vTe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const wJ=mTe(vTe),wd=[139,1],OF=32;function yC(t){var i;const e=Buffer.alloc(wd.length+t.length+1);e.set(wd,0),e.set(t,wd.length);let n=0;for(let s=0;s<e.length-1;++s)n^=e[s];return e[e.length-1]=n,(i=wJ.encode(e).match(/.{1,4}/g))==null?void 0:i.join(" ")}function X1(t){const e=wJ.decode(t.replace(/ /g,""));let n=0;for(const r of e)n^=r;if(n!==0)throw new Error("Incorrect parity");for(let r=0;r<wd.length;++r)if(e[r]!==wd[r])throw new Error("Incorrect prefix");if(e.length!==wd.length+OF+1)throw new Error("Incorrect length");return Uint8Array.from(e.slice(wd.length,wd.length+OF))}const yTe=256;async function P4(t,e,n,r=yTe){if(!globalThis.crypto.subtle||!TextEncoder)throw new Error("Password-based backup is not available on this platform");const i=await globalThis.crypto.subtle.importKey("raw",new TextEncoder().encode(t),{name:"PBKDF2"},!1,["deriveBits"]),s=await globalThis.crypto.subtle.deriveBits({name:"PBKDF2",salt:new TextEncoder().encode(e),iterations:n,hash:"SHA-512"},i,r);return new Uint8Array(s)}var Gn=(t=>(t.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",t.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",t.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",t.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",t.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",t.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",t.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",t.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",t.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",t.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",t.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t.MEGOLM_BAD_ROOM="MEGOLM_BAD_ROOM",t.MEGOLM_MISSING_FIELDS="MEGOLM_MISSING_FIELDS",t.OLM_DECRYPT_GROUP_MESSAGE_ERROR="OLM_DECRYPT_GROUP_MESSAGE_ERROR",t.OLM_BAD_ENCRYPTED_MESSAGE="OLM_BAD_ENCRYPTED_MESSAGE",t.OLM_BAD_RECIPIENT="OLM_BAD_RECIPIENT",t.OLM_BAD_RECIPIENT_KEY="OLM_BAD_RECIPIENT_KEY",t.OLM_BAD_ROOM="OLM_BAD_ROOM",t.OLM_BAD_SENDER_CHECK_FAILED="OLM_BAD_SENDER_CHECK_FAILED",t.OLM_BAD_SENDER="OLM_BAD_SENDER",t.OLM_FORWARDED_MESSAGE="OLM_FORWARDED_MESSAGE",t.OLM_MISSING_CIPHERTEXT="OLM_MISSING_CIPHERTEXT",t.OLM_NOT_INCLUDED_IN_RECIPIENTS="OLM_NOT_INCLUDED_IN_RECIPIENTS",t.UNKNOWN_ENCRYPTION_ALGORITHM="UNKNOWN_ENCRYPTION_ALGORITHM",t))(Gn||{}),EJ=(t=>(t[t.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",t[t.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",t))(EJ||{});class _Te{constructor(e){this.errorOnVerifiedUserProblems=e,this.kind=0}}class bTe{constructor(){this.kind=1}}class Z1{constructor(e,n,r,i=!1){this.crossSigningVerified=e,this.crossSigningVerifiedBefore=n,this.tofu=r,this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class TJ{constructor(e){this.signedByOwner=e.signedByOwner??!1,this.crossSigningVerified=e.crossSigningVerified??!1,this.tofu=e.tofu??!1,this.localVerified=e.localVerified??!1,this.trustCrossSignedDevices=e.trustCrossSignedDevices??!1}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var K2=(t=>(t.Master="master",t.SelfSigning="self_signing",t.UserSigning="user_signing",t))(K2||{}),jl=(t=>(t[t.NONE=0]="NONE",t[t.GREY=1]="GREY",t[t.RED=2]="RED",t))(jl||{}),fh=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",t[t.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",t[t.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",t[t.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",t[t.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",t))(fh||{});const STe=Object.freeze(Object.defineProperty({__proto__:null,AllDevicesIsolationMode:_Te,CrossSigningKey:K2,DecryptionFailureCode:Gn,DeviceIsolationModeKind:EJ,DeviceVerificationStatus:TJ,EventShieldColour:jl,EventShieldReason:fh,OnlySignedDevicesIsolationMode:bTe,UserVerificationStatus:Z1,VerificationPhase:Cf,VerificationRequestEvent:hd,VerifierEvent:wb,canAcceptVerificationRequest:SJ,decodeRecoveryKey:X1,deriveRecoveryKeyFromPassphrase:P4,encodeRecoveryKey:yC},Symbol.toStringTag,{value:"Module"}));class jr extends Error{constructor(e,n,r){super(n),this.code=e,this.name="DecryptionError",this.detailedString=wTe(this,r)}}function wTe(t,e){let n=t.name+"[msg: "+t.message;return e&&(n+=", "+Object.keys(e).map(r=>r+": "+e[r]).join(", ")),n+="]",n}const MF=65536*3/4;class ETe extends Error{constructor(){super(...arguments),this.data={errcode:"M_TOO_LARGE",error:"Payload too large for encrypted message"}}}function AF(t){if(t===void 0)throw new Error("payloadString undefined");if(t.length>MF)throw new ETe(`Message too long (${t.length} bytes). The maximum for an encrypted message is ${MF} bytes.`)}class LF{constructor(e){this.cryptoStore=e,this.pickleKey="DEFAULT_KEY",this.deviceCurve25519Key=null,this.deviceEd25519Key=null,this.maxOneTimeKeys=null,this.outboundGroupSessionStore={},this.inboundGroupSessionMessageIndexes={},this.sessionsInProgress={},this.olmPrekeyPromise=Promise.resolve()}static getOlmVersion(){return global.Olm.get_library_version()}async init({pickleKey:e,fromExportedDevice:n}={}){let r;const i=new global.Olm.Account;try{n?(e&&k.warn("ignoring opts.pickleKey because opts.fromExportedDevice is present."),this.pickleKey=n.pickleKey,await this.initialiseFromExportedDevice(n,i)):(e&&(this.pickleKey=e),await this.initialiseAccount(i)),r=JSON.parse(i.identity_keys()),this.maxOneTimeKeys=i.max_number_of_one_time_keys()}finally{i.free()}this.deviceCurve25519Key=r.curve25519,this.deviceEd25519Key=r.ed25519}async initialiseFromExportedDevice(e,n){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT,Be.STORE_SESSIONS],r=>{this.cryptoStore.storeAccount(r,e.pickledAccount),e.sessions.forEach(i=>{const{deviceKey:s,sessionId:o}=i,a={session:i.session,lastReceivedMessageTs:i.lastReceivedMessageTs};this.cryptoStore.storeEndToEndSession(s,o,a,r)})}),n.unpickle(this.pickleKey,e.pickledAccount)}async initialiseAccount(e){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],n=>{this.cryptoStore.getAccount(n,r=>{r!==null?e.unpickle(this.pickleKey,r):(e.create(),r=e.pickle(this.pickleKey),this.cryptoStore.storeAccount(n,r))})})}getAccount(e,n){this.cryptoStore.getAccount(e,r=>{const i=new global.Olm.Account;try{i.unpickle(this.pickleKey,r),n(i)}finally{i.free()}})}storeAccount(e,n){this.cryptoStore.storeAccount(e,n.pickle(this.pickleKey))}async export(){const e={pickleKey:this.pickleKey};return await this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT,Be.STORE_SESSIONS],n=>{this.cryptoStore.getAccount(n,r=>{e.pickledAccount=r}),e.sessions=[],this.cryptoStore.getAllEndToEndSessions(n,r=>{e.sessions.push(r)})}),e}getSession(e,n,r,i){this.cryptoStore.getEndToEndSession(e,n,r,s=>{this.unpickleSession(s,i)})}unpickleSession(e,n){const r=new global.Olm.Session;try{r.unpickle(this.pickleKey,e.session);const i=Object.assign({},e,{session:r});n(i)}finally{r.free()}}saveSession(e,n,r){const i=n.session.session_id();k.debug(`Saving Olm session ${i} with device ${e}: ${n.session.describe()}`);const s=Object.assign(n,{session:n.session.pickle(this.pickleKey)});this.cryptoStore.storeEndToEndSession(e,i,s,r)}getUtility(e){const n=new global.Olm.Utility;try{return e(n)}finally{n.free()}}async sign(e){let n;return await this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],r=>{this.getAccount(r,i=>{n=i.sign(e)})}),n}async getOneTimeKeys(){let e;return await this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],n=>{this.getAccount(n,r=>{e=JSON.parse(r.one_time_keys())})}),e}maxNumberOfOneTimeKeys(){return this.maxOneTimeKeys??-1}async markKeysAsPublished(){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],e=>{this.getAccount(e,n=>{n.mark_keys_as_published(),this.storeAccount(e,n)})})}generateOneTimeKeys(e){return this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],n=>{this.getAccount(n,r=>{r.generate_one_time_keys(e),this.storeAccount(n,r)})})}async generateFallbackKey(){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],e=>{this.getAccount(e,n=>{n.generate_fallback_key(),this.storeAccount(e,n)})})}async getFallbackKey(){let e;return await this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],n=>{this.getAccount(n,r=>{e=JSON.parse(r.unpublished_fallback_key())})}),e}async forgetOldFallbackKey(){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],e=>{this.getAccount(e,n=>{n.forget_old_fallback_key(),this.storeAccount(e,n)})})}async createOutboundSession(e,n){let r;return await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT,Be.STORE_SESSIONS],i=>{this.getAccount(i,s=>{const o=new global.Olm.Session;try{o.create_outbound(s,e,n),r=o.session_id(),this.storeAccount(i,s);const a={session:o,lastReceivedMessageTs:Date.now()};this.saveSession(e,a,i)}finally{o.free()}})},k.getChild("[createOutboundSession]")),r}async createInboundSession(e,n,r){if(n!==0)throw new Error("Need messageType == 0 to create inbound session");let i;return await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT,Be.STORE_SESSIONS],s=>{this.getAccount(s,o=>{const a=new global.Olm.Session;try{a.create_inbound_from(o,e,r),o.remove_one_time_keys(a),this.storeAccount(s,o);const c=a.decrypt(n,r),l={session:a,lastReceivedMessageTs:Date.now()};this.saveSession(e,l,s),i={payload:c,session_id:a.session_id()}}finally{a.free()}})},k.getChild("[createInboundSession]")),i}async getSessionIdsForDevice(e){const n=k.getChild("[getSessionIdsForDevice]");if(e in this.sessionsInProgress){n.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch{}}let r;return await this.cryptoStore.doTxn("readonly",[Be.STORE_SESSIONS],i=>{this.cryptoStore.getEndToEndSessions(e,i,s=>{r=Object.keys(s)})},n),r}async getSessionIdForDevice(e,n=!1,r){const i=await this.getSessionInfoForDevice(e,n,r);if(i.length===0)return null;let s=0;for(let o=1;o<i.length;o++){const a=i[o],c=a.lastReceivedMessageTs===void 0?0:a.lastReceivedMessageTs,l=i[s],u=l.lastReceivedMessageTs===void 0?0:l.lastReceivedMessageTs;(c>u||c===u&&a.sessionId<l.sessionId)&&(s=o)}return i[s].sessionId}async getSessionInfoForDevice(e,n=!1,r=k){if(r=r.getChild("[getSessionInfoForDevice]"),e in this.sessionsInProgress&&!n){r.debug(`Waiting for Olm session for ${e} to be created`);try{await this.sessionsInProgress[e]}catch{}}const i=[];return await this.cryptoStore.doTxn("readonly",[Be.STORE_SESSIONS],s=>{this.cryptoStore.getEndToEndSessions(e,s,o=>{const a=Object.keys(o).sort();for(const c of a)this.unpickleSession(o[c],l=>{i.push({lastReceivedMessageTs:l.lastReceivedMessageTs,hasReceivedMessage:l.session.has_received_message(),sessionId:c})})})},r),i}async encryptMessage(e,n,r){AF(r);let i;return await this.cryptoStore.doTxn("readwrite",[Be.STORE_SESSIONS],s=>{this.getSession(e,n,s,o=>{const a=o.session.describe();k.log("encryptMessage: Olm Session ID "+n+" to "+e+": "+a),i=o.session.encrypt(r),this.saveSession(e,o,s)})},k.getChild("[encryptMessage]")),i}async decryptMessage(e,n,r,i){let s;return await this.cryptoStore.doTxn("readwrite",[Be.STORE_SESSIONS],o=>{this.getSession(e,n,o,a=>{const c=a.session.describe();k.log("decryptMessage: Olm Session ID "+n+" from "+e+": "+c),s=a.session.decrypt(r,i),a.lastReceivedMessageTs=Date.now(),this.saveSession(e,a,o)})},k.getChild("[decryptMessage]")),s}async matchesSession(e,n,r,i){if(r!==0)return!1;let s;return await this.cryptoStore.doTxn("readonly",[Be.STORE_SESSIONS],o=>{this.getSession(e,n,o,a=>{s=a.session.matches_inbound(i)})},k.getChild("[matchesSession]")),s}async recordSessionProblem(e,n,r){k.info(`Recording problem on olm session with ${e} of type ${n}. Recreating: ${r}`),await this.cryptoStore.storeEndToEndSessionProblem(e,n,r)}sessionMayHaveProblems(e,n){return this.cryptoStore.getEndToEndSessionProblem(e,n)}filterOutNotifiedErrorDevices(e){return this.cryptoStore.filterOutNotifiedErrorDevices(e)}saveOutboundGroupSession(e){this.outboundGroupSessionStore[e.session_id()]=e.pickle(this.pickleKey)}getOutboundGroupSession(e,n){const r=this.outboundGroupSessionStore[e];if(r===void 0)throw new Error("Unknown outbound group session "+e);const i=new global.Olm.OutboundGroupSession;try{return i.unpickle(this.pickleKey,r),n(i)}finally{i.free()}}createOutboundGroupSession(){const e=new global.Olm.OutboundGroupSession;try{return e.create(),this.saveOutboundGroupSession(e),e.session_id()}finally{e.free()}}encryptGroupMessage(e,n){return k.log(`encrypting msg with megolm session ${e}`),AF(n),this.getOutboundGroupSession(e,r=>{const i=r.encrypt(n);return this.saveOutboundGroupSession(r),i})}getOutboundGroupSessionKey(e){return this.getOutboundGroupSession(e,function(n){return{chain_index:n.message_index(),key:n.session_key()}})}unpickleInboundGroupSession(e,n){const r=new global.Olm.InboundGroupSession;try{return r.unpickle(this.pickleKey,e.session),n(r)}finally{r.free()}}getInboundGroupSession(e,n,r,i,s){this.cryptoStore.getEndToEndInboundGroupSession(n,r,i,(o,a)=>{if(o===null){s(null,null,a);return}if(e!==null&&e!==o.room_id)throw new Error("Mismatched room_id for inbound group session (expected "+o.room_id+", was "+e+")");this.unpickleInboundGroupSession(o,c=>{s(c,o,a)})})}async addInboundGroupSession(e,n,r,i,s,o,a,c={}){await this.cryptoStore.doTxn("readwrite",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_INBOUND_GROUP_SESSIONS_WITHHELD,Be.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],l=>{this.getInboundGroupSession(e,n,i,l,(u,d)=>{const f=new global.Olm.InboundGroupSession;try{if(a?f.import_session(s):f.create(s),i!=f.session_id())throw new Error("Mismatched group session ID from senderKey: "+n);if(u&&(k.log(`Update for megolm session ${n}|${i}`),u.first_known_index()<=f.first_known_index())){if(!d.untrusted||c.untrusted){k.log(`Keeping existing megolm session ${n}|${i}`);return}if(u.first_known_index()<f.first_known_index()){u.export_session(f.first_known_index())===f.export_session(f.first_known_index())?(k.info(`Upgrading trust of existing megolm session ${n}|${i} based on newly-received trusted session`),d.untrusted=!1,this.cryptoStore.storeEndToEndInboundGroupSession(n,i,d,l)):k.warn(`Newly-received megolm session ${n}|$sessionId} does not match existing session! Keeping existing session`);return}}k.debug(`Storing megolm session ${n}|${i} with first index `+f.first_known_index());const p=Object.assign({},c,{room_id:e,session:f.pickle(this.pickleKey),keysClaimed:o,forwardingCurve25519KeyChain:r});this.cryptoStore.storeEndToEndInboundGroupSession(n,i,p,l),!u&&c.sharedHistory&&this.cryptoStore.addSharedHistoryInboundGroupSession(e,n,i,l)}finally{f.free()}})},k.getChild("[addInboundGroupSession]"))}async addInboundGroupSessionWithheld(e,n,r,i,s){await this.cryptoStore.doTxn("readwrite",[Be.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],o=>{this.cryptoStore.storeEndToEndInboundGroupSessionWithheld(n,r,{room_id:e,code:i,reason:s},o)})}async decryptGroupMessage(e,n,r,i,s,o){let a=null,c;if(await this.cryptoStore.doTxn("readwrite",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],l=>{this.getInboundGroupSession(e,n,r,l,(u,d,f)=>{if(u===null||d===null){if(f){const v=f.code==="m.unverified"?Gn.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:Gn.MEGOLM_KEY_WITHHELD;c=new jr(v,DF(f),{session:n+"|"+r})}a=null;return}let p;try{p=u.decrypt(i)}catch(v){if((v==null?void 0:v.message)==="OLM.UNKNOWN_MESSAGE_INDEX"&&f){const S=f.code==="m.unverified"?Gn.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:Gn.MEGOLM_KEY_WITHHELD;c=new jr(S,DF(f),{session:n+"|"+r})}else c=v;return}let m=p.plaintext;if(m===void 0)m=p;else{const v=n+"|"+r+"|"+p.message_index;if(v in this.inboundGroupSessionMessageIndexes){const S=this.inboundGroupSessionMessageIndexes[v];if(S.id!==s||S.timestamp!==o){c=new Error("Duplicate message index, possible replay attack: "+v);return}}this.inboundGroupSessionMessageIndexes[v]={id:s,timestamp:o}}d.session=u.pickle(this.pickleKey),this.cryptoStore.storeEndToEndInboundGroupSession(n,r,d,l),a={result:m,keysClaimed:d.keysClaimed||{},senderKey:n,forwardingCurve25519KeyChain:d.forwardingCurve25519KeyChain||[],untrusted:!!d.untrusted}})},k.getChild("[decryptGroupMessage]")),c)throw c;return a}async hasInboundSessionKeys(e,n,r){let i;return await this.cryptoStore.doTxn("readonly",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],s=>{this.cryptoStore.getEndToEndInboundGroupSession(n,r,s,o=>{if(o===null){i=!1;return}e!==o.room_id?(k.warn(`requested keys for inbound group session ${n}|${r}, with incorrect room_id (expected ${o.room_id}, was ${e})`),i=!1):i=!0})},k.getChild("[hasInboundSessionKeys]")),i}async getInboundGroupSessionKey(e,n,r,i){let s=null;return await this.cryptoStore.doTxn("readonly",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],o=>{this.getInboundGroupSession(e,n,r,o,(a,c)=>{if(a===null||c===null){s=null;return}i===void 0&&(i=a.first_known_index());const l=a.export_session(i),d=(c.keysClaimed||{}).ed25519||null,f=c.forwardingCurve25519KeyChain||[],p="untrusted"in c?c.untrusted:f.length>0;s={chain_index:i,key:l,forwarding_curve25519_key_chain:f,sender_claimed_ed25519_key:d,shared_history:c.sharedHistory||!1,untrusted:p}})},k.getChild("[getInboundGroupSessionKey]")),s}exportInboundGroupSession(e,n,r){return this.unpickleInboundGroupSession(r,i=>{const s=i.first_known_index();return{sender_key:e,sender_claimed_keys:r.keysClaimed,room_id:r.room_id,session_id:n,session_key:i.export_session(s),forwarding_curve25519_key_chain:r.forwardingCurve25519KeyChain||[],first_known_index:i.first_known_index(),"org.matrix.msc3061.shared_history":r.sharedHistory||!1}})}async getSharedHistoryInboundGroupSessions(e){let n;return await this.cryptoStore.doTxn("readonly",[Be.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS],r=>{n=this.cryptoStore.getSharedHistoryInboundGroupSessions(e,r)},k.getChild("[getSharedHistoryInboundGroupSessionsForRoom]")),n}verifySignature(e,n,r){this.getUtility(function(i){i.ed25519_verify(e,n,r)})}}const _C={"m.unverified":"The sender has disabled encrypting to unverified devices.","m.blacklisted":"The sender has blocked you.","m.unauthorised":"You are not authorised to read the message.","m.no_olm":"Unable to establish a secure channel."};function DF(t){return t.code&&t.code in _C?_C[t.code]:t.reason?t.reason:"decryption key withheld"}const TTe=new Uint8Array(8);async function jv(t,e,n,r){let i;r?i=xi(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);const[s,o]=await CJ(e,n),a=new TextEncoder().encode(t),c=await globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},s,a),l=await globalThis.crypto.subtle.sign({name:"HMAC"},o,c);return{iv:hs(i),ciphertext:hs(c),mac:hs(l)}}async function Eb(t,e,n){const[r,i]=await CJ(e,n),s=xi(t.ciphertext);if(!await globalThis.crypto.subtle.verify({name:"HMAC"},i,xi(t.mac),s))throw new Error(`Error decrypting secret ${n}: bad MAC`);const o=await globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:xi(t.iv),length:64},r,s);return new TextDecoder().decode(new Uint8Array(o))}async function CJ(t,e){const n=await globalThis.crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]),r=await globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:TTe,info:new TextEncoder().encode(e),hash:"SHA-256"},n,512),i=r.slice(0,32),s=r.slice(32),o=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,a])}const CTe="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function dm(t,e){return jv(CTe,t,"",e)}const kTe=1e3*60;function lw(t){return Object.values(t.keys)[0]}class Ja{constructor(e,n={},r={}){this.userId=e,this.callbacks=n,this.cacheCallbacks=r,this.keys={},this.firstUse=!0,this.crossSigningVerifiedBefore=!1}static fromStorage(e,n){const r=new Ja(n);for(const i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return r}toStorage(){return{keys:this.keys,firstUse:this.firstUse,crossSigningVerifiedBefore:this.crossSigningVerifiedBefore}}async getCrossSigningKey(e,n){const r=["master","self_signing","user_signing"].indexOf(e)>=0;if(!this.callbacks.getCrossSigningKey)throw new Error("No getCrossSigningKey callback supplied");n===void 0&&(n=this.getId(e));function i(c){if(!c)return;const l=new global.Olm.PkSigning,u=l.init_with_seed(c);if(u===n)return[u,l];l.free()}let s=null;this.cacheCallbacks.getCrossSigningKeyCache&&r&&(s=await this.cacheCallbacks.getCrossSigningKeyCache(e,n));const o=i(s);if(o)return o;s=await this.callbacks.getCrossSigningKey(e,n);const a=i(s);if(a)return this.cacheCallbacks.storeCrossSigningKeyCache&&r&&await this.cacheCallbacks.storeCrossSigningKeyCache(e,s),a;throw s?new Error("Key type "+e+" from getCrossSigningKey callback did not match"):new Error("getCrossSigningKey callback for "+e+" returned falsey")}async isStoredInSecretStorage(e){const n=await e.isStored("m.cross_signing.master")||{};function r(i){for(const s of Object.keys(n))i[s]||delete n[s]}for(const i of["self_signing","user_signing"])r(await e.isStored(`m.cross_signing.${i}`)||{});return Object.keys(n).length?n:null}static async storeInSecretStorage(e,n){for(const[r,i]of e){const s=hs(i);await n.store(`m.cross_signing.${r}`,s)}}static async getFromSecretStorage(e,n){const r=await n.get(`m.cross_signing.${e}`);return r?xi(r):null}async isStoredInKeyCache(e){var i;const n=this.cacheCallbacks;if(!n)return!1;const r=e?[e]:["master","self_signing","user_signing"];for(const s of r)if(!await((i=n.getCrossSigningKeyCache)==null?void 0:i.call(n,s)))return!1;return!0}async getCrossSigningKeysFromCache(){var r;const e=new Map,n=this.cacheCallbacks;if(!n)return e;for(const i of["master","self_signing","user_signing"]){const s=await((r=n.getCrossSigningKeyCache)==null?void 0:r.call(n,i));s&&e.set(i,s)}return e}getId(e="master"){if(!this.keys[e])return null;const n=this.keys[e];return lw(n)}async resetKeys(e){if(!this.callbacks.saveCrossSigningKeys)throw new Error("No saveCrossSigningKeys callback supplied");if(e===void 0||e&4||!this.keys.master)e=7;else if(e===0)return;const n={},r={};let i,s;try{if(e&4?(i=new global.Olm.PkSigning,n.master=i.generate_seed(),s=i.init_with_seed(n.master),r.master={user_id:this.userId,usage:["master"],keys:{["ed25519:"+s]:s}}):[s,i]=await this.getCrossSigningKey("master"),e&1){const o=new global.Olm.PkSigning;try{n.self_signing=o.generate_seed();const a=o.init_with_seed(n.self_signing);r.self_signing={user_id:this.userId,usage:["self_signing"],keys:{["ed25519:"+a]:a}},GE(r.self_signing,i,this.userId,s)}finally{o.free()}}if(e&2){const o=new global.Olm.PkSigning;try{n.user_signing=o.generate_seed();const a=o.init_with_seed(n.user_signing);r.user_signing={user_id:this.userId,usage:["user_signing"],keys:{["ed25519:"+a]:a}},GE(r.user_signing,i,this.userId,s)}finally{o.free()}}Object.assign(this.keys,r),this.callbacks.saveCrossSigningKeys(n)}finally{i&&i.free()}}clearKeys(){this.keys={}}setKeys(e){const n={};if(e.master){if(e.master.user_id!==this.userId){const i="Mismatched user ID "+e.master.user_id+" in master key from "+this.userId;throw k.error(i),new Error(i)}this.keys.master?lw(e.master)!==this.getId()&&(this.firstUse=!1):this.firstUse=!0,n.master=e.master}else if(this.keys.master)n.master=this.keys.master;else throw new Error("Tried to set cross-signing keys without a master key");const r=lw(n.master);if(e.user_signing){if(e.user_signing.user_id!==this.userId){const i="Mismatched user ID "+e.master.user_id+" in user_signing key from "+this.userId;throw k.error(i),new Error(i)}try{Mg(e.user_signing,r,this.userId)}catch(i){throw k.error("invalid signature on user-signing key"),i}}if(e.self_signing){if(e.self_signing.user_id!==this.userId){const i="Mismatched user ID "+e.master.user_id+" in self_signing key from "+this.userId;throw k.error(i),new Error(i)}try{Mg(e.self_signing,r,this.userId)}catch(i){throw k.error("invalid signature on self-signing key"),i}}e.master&&(this.keys.master=e.master,delete this.keys.self_signing,delete this.keys.user_signing),e.self_signing&&(this.keys.self_signing=e.self_signing),e.user_signing&&(this.keys.user_signing=e.user_signing)}updateCrossSigningVerifiedBefore(e){!this.crossSigningVerifiedBefore&&e&&(this.crossSigningVerifiedBefore=!0)}async signObject(e,n){if(!this.keys[n])throw new Error("Attempted to sign with "+n+" key but no such key present");const[r,i]=await this.getCrossSigningKey(n);try{return GE(e,i,this.userId,r),e}finally{i.free()}}async signUser(e){if(!this.keys.user_signing){k.info("No user signing key: not signing user");return}return this.signObject(e.keys.master,"user_signing")}async signDevice(e,n){if(e!==this.userId)throw new Error(`Trying to sign ${e}'s device; can only sign our own device`);if(!this.keys.self_signing){k.info("No self signing key: not signing device");return}return this.signObject({algorithms:n.algorithms,keys:n.keys,device_id:n.deviceId,user_id:e},"self_signing")}checkUserTrust(e){if(this.userId===e.userId&&this.getId()&&this.getId()===e.getId()&&this.getId("self_signing")&&this.getId("self_signing")===e.getId("self_signing"))return new Z1(!0,!0,this.firstUse);if(!this.keys.user_signing)return new Z1(!1,!1,e.firstUse);let n;const r=e.keys.master,i=this.getId("user_signing");try{Mg(r,i,this.userId),n=!0}catch{n=!1}return new Z1(n,e.crossSigningVerifiedBefore,e.firstUse)}checkDeviceTrust(e,n,r,i){const s=this.checkUserTrust(e),o=e.keys.self_signing;if(!o)return new fm(!1,!1,r,i);const a=RTe(n,e.userId);try{return Mg(o,e.getId(),e.userId),Mg(a,lw(o),e.userId),fm.fromUserTrustLevel(s,r,i)}catch{return new fm(!1,!1,r,i)}}getCacheCallbacks(){return this.cacheCallbacks}}function RTe(t,e){return{algorithms:t.algorithms,keys:t.keys,device_id:t.deviceId,user_id:e,signatures:t.signatures}}class fm extends TJ{constructor(e,n,r,i,s=!1){super({crossSigningVerified:e,tofu:n,localVerified:r,trustCrossSignedDevices:i,signedByOwner:s})}static fromUserTrustLevel(e,n,r){return new fm(e.isCrossSigningVerified(),e.isTofu(),n,r,!0)}isCrossSigningVerified(){return this.crossSigningVerified}isLocallyVerified(){return this.localVerified}isTofu(){return this.tofu}}function kJ(t,e){return{getCrossSigningKeyCache:async function(n,r){const i=await new Promise(s=>{t.doTxn("readonly",[Be.STORE_ACCOUNT],o=>{t.getSecretStorePrivateKey(o,s,n)})});if(i&&i.ciphertext){const s=Buffer.from(e.pickleKey),o=await Eb(i,s,n);return xi(o)}else return i},storeCrossSigningKeyCache:async function(n,r){if(!(r instanceof Uint8Array))throw new Error(`storeCrossSigningKeyCache expects Uint8Array, got ${r}`);const i=Buffer.from(e.pickleKey),s=await jv(hs(r),i,n);return t.doTxn("readwrite",[Be.STORE_ACCOUNT],o=>{t.storeSecretStorePrivateKey(o,n,s)})}}}async function ITe(t,e,n){if(t.getUserId()===e)return k.log("Cross-signing: Self-verification done; requesting keys"),new Promise((r,i)=>{const s=t,o=s.crypto.crossSigningInfo,a=new Ja(o.userId,{getCrossSigningKey:async u=>{k.debug("Cross-signing: requesting secret",u,n);const{promise:d}=s.requestSecret(`m.cross_signing.${u}`,[n]),f=await d,p=xi(f);return Uint8Array.from(p)}},o.getCacheCallbacks());a.keys=o.keys;const c=new Promise(u=>{setTimeout(u,kTe,new Error("Timeout"))}),l=(async()=>{if(!await s.crypto.getSessionBackupPrivateKey()){k.info("No cached backup key found. Requesting...");const f=await s.requestSecret("m.megolm_backup.v1",[n]).promise;k.info("Got key backup key, decoding...");const p=xi(f);k.info("Decoded backup key, storing..."),await s.crypto.storeSessionBackupPrivateKey(Uint8Array.from(p)),k.info("Backup key stored. Starting backup restore...");const m=await s.getKeyBackupVersion();s.restoreKeyBackupWithCache(void 0,void 0,m).then(()=>{k.info("Backup restored.")})}})();Promise.race([Promise.all([a.getCrossSigningKey("master"),a.getCrossSigningKey("self_signing"),a.getCrossSigningKey("user_signing"),l]),c]).then(r,i)}).catch(r=>{k.warn("Cross-signing: failure while requesting keys:",r)})}class xTe extends Fn{constructor(e,n,r,i=250){super(),this.cryptoStore=n,this.keyDownloadChunkSize=i,this.devices={},this.crossSigningInfo={},this.userByIdentityKey={},this.deviceTrackingStatus={},this.syncToken=null,this.keyDownloadsInProgressByUser=new Map,this.dirty=!1,this.savePromise=null,this.resolveSavePromise=null,this.savePromiseTime=null,this.saveTimer=null,this.hasFetched=null,this.serialiser=new PTe(e,r,this)}async load(){await this.cryptoStore.doTxn("readonly",[Be.STORE_DEVICE_DATA],e=>{this.cryptoStore.getEndToEndDeviceData(e,n=>{this.hasFetched=!!(n!=null&&n.devices),this.devices=n?n.devices:{},this.crossSigningInfo=n?n.crossSigningInfo||{}:{},this.deviceTrackingStatus=n?n.trackingStatus:{},this.syncToken=(n==null?void 0:n.syncToken)??null,this.userByIdentityKey={};for(const r of Object.keys(this.devices)){const i=this.devices[r];for(const s of Object.keys(i)){const o=i[s].keys["curve25519:"+s];o!==void 0&&(this.userByIdentityKey[o]=r)}}})});for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]==2&&(this.deviceTrackingStatus[e]=1)}stop(){this.saveTimer!==null&&clearTimeout(this.saveTimer)}async saveIfDirty(e=500){if(!this.dirty)return Promise.resolve(!1);const n=Date.now()+e;this.savePromiseTime&&n<this.savePromiseTime&&(clearTimeout(this.saveTimer),this.saveTimer=null,this.savePromiseTime=null);let r=this.savePromise;if(r===null&&(r=new Promise(i=>{this.resolveSavePromise=i}),this.savePromise=r),this.saveTimer===null){const i=this.resolveSavePromise;this.savePromiseTime=n,this.saveTimer=setTimeout(()=>{k.log("Saving device tracking data",this.syncToken),this.savePromiseTime=null,this.saveTimer=null,this.savePromise=null,this.resolveSavePromise=null,this.cryptoStore.doTxn("readwrite",[Be.STORE_DEVICE_DATA],s=>{this.cryptoStore.storeEndToEndDeviceData({devices:this.devices,crossSigningInfo:this.crossSigningInfo,trackingStatus:this.deviceTrackingStatus,syncToken:this.syncToken??void 0},s)}).then(()=>{this.dirty=!1,i==null||i(!0)},s=>{k.error("Failed to save device tracking data",this.syncToken),k.error(s)})},e)}return r}getSyncToken(){return this.syncToken}setSyncToken(e){this.syncToken=e}downloadKeys(e,n){const r=[],i=[];if(e.forEach(s=>{const o=this.deviceTrackingStatus[s];this.keyDownloadsInProgressByUser.has(s)?(k.log(`downloadKeys: already have a download in progress for ${s}: awaiting its result`),i.push(this.keyDownloadsInProgressByUser.get(s))):(n||o!=3)&&r.push(s)}),r.length!=0){k.log("downloadKeys: downloading for",r);const s=this.doKeyDownload(r);i.push(s)}return i.length===0&&k.log("downloadKeys: already have all necessary keys"),Promise.all(i).then(()=>this.getDevicesFromStore(e))}getDevicesFromStore(e){const n=new Map;return e.forEach(r=>{var s;const i=new Map;(s=this.getStoredDevicesForUser(r))==null||s.forEach(function(o){i.set(o.deviceId,o)}),n.set(r,i)}),n}getKnownUserIds(){return Object.keys(this.devices)}getStoredDevicesForUser(e){const n=this.devices[e];if(!n)return null;const r=[];for(const i in n)n.hasOwnProperty(i)&&r.push(Ys.fromStorage(n[i],i));return r}getRawStoredDevicesForUser(e){return this.devices[e]}getStoredCrossSigningForUser(e){return this.crossSigningInfo[e]?Ja.fromStorage(this.crossSigningInfo[e],e):null}storeCrossSigningForUser(e,n){this.crossSigningInfo[e]=n,this.dirty=!0}getStoredDevice(e,n){const r=this.devices[e];if(r!=null&&r[n])return Ys.fromStorage(r[n],n)}getUserByIdentityKey(e,n){return e!==ri&&e!==Ks?null:this.userByIdentityKey[n]}getDeviceByIdentityKey(e,n){const r=this.getUserByIdentityKey(e,n);if(!r)return null;const i=this.devices[r];if(!i)return null;for(const s in i){if(!i.hasOwnProperty(s))continue;const o=i[s];for(const a in o.keys){if(!o.keys.hasOwnProperty(a)||a.indexOf("curve25519:")!==0)continue;if(o.keys[a]==n)return Ys.fromStorage(o,s)}}return null}storeDevicesForUser(e,n){this.setRawStoredDevicesForUser(e,n),this.dirty=!0}startTrackingDeviceList(e){if(typeof e!="string")throw new Error("userId must be a string; was "+e);this.deviceTrackingStatus[e]||(k.log("Now tracking device list for "+e),this.deviceTrackingStatus[e]=1,this.dirty=!0)}stopTrackingDeviceList(e){this.deviceTrackingStatus[e]&&(k.log("No longer tracking device list for "+e),this.deviceTrackingStatus[e]=0,this.dirty=!0)}stopTrackingAllDeviceLists(){for(const e of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[e]=0;this.dirty=!0}invalidateUserDeviceList(e){this.deviceTrackingStatus[e]&&(k.log("Marking device list outdated for",e),this.deviceTrackingStatus[e]=1,this.dirty=!0)}refreshOutdatedDeviceLists(){this.saveIfDirty();const e=[];for(const n of Object.keys(this.deviceTrackingStatus))this.deviceTrackingStatus[n]==1&&e.push(n);return this.doKeyDownload(e)}setRawStoredDevicesForUser(e,n){if(this.devices[e]!==void 0)for(const[r,i]of Object.entries(this.devices[e])){const s=i.keys["curve25519:"+r];delete this.userByIdentityKey[s]}this.devices[e]=n;for(const[r,i]of Object.entries(n)){const s=i.keys["curve25519:"+r];this.userByIdentityKey[s]=e}}setRawStoredCrossSigningForUser(e,n){this.crossSigningInfo[e]=n}doKeyDownload(e){if(e.length===0)return Promise.resolve();const n=this.serialiser.updateDevicesForUsers(e,this.syncToken).then(()=>{r(!0)},i=>{throw k.error("Error downloading keys for "+e+":",i),r(!1),i});e.forEach(i=>{this.keyDownloadsInProgressByUser.set(i,n),this.deviceTrackingStatus[i]==1&&(this.deviceTrackingStatus[i]=2)});const r=i=>{this.emit(Zt.WillUpdateDevices,e,!this.hasFetched),e.forEach(s=>{if(this.dirty=!0,this.keyDownloadsInProgressByUser.get(s)!==n){k.log("Another update in the queue for",s,"- not marking up-to-date");return}this.keyDownloadsInProgressByUser.delete(s),this.deviceTrackingStatus[s]==2&&(i?(this.deviceTrackingStatus[s]=3,k.log("Device list for",s,"now up to date")):this.deviceTrackingStatus[s]=1)}),this.saveIfDirty(),this.emit(Zt.DevicesUpdated,e,!this.hasFetched),this.hasFetched=!0};return n}}class PTe{constructor(e,n,r){this.baseApis=e,this.olmDevice=n,this.deviceList=r,this.downloadInProgress=!1,this.keyDownloadsQueuedByUser={}}updateDevicesForUsers(e,n){return e.forEach(r=>{this.keyDownloadsQueuedByUser[r]=!0}),this.queuedQueryDeferred||(this.queuedQueryDeferred=Ef()),this.syncToken=n,this.downloadInProgress?(k.log("Queued key download for",e),this.queuedQueryDeferred.promise):this.doQueuedQueries()}doQueuedQueries(){if(this.downloadInProgress)throw new Error("DeviceListUpdateSerialiser.doQueuedQueries called with request active");const e=Object.keys(this.keyDownloadsQueuedByUser);this.keyDownloadsQueuedByUser={};const n=this.queuedQueryDeferred;this.queuedQueryDeferred=void 0,k.log("Starting key download for",e),this.downloadInProgress=!0;const r={};this.syncToken&&(r.token=this.syncToken);const i=[];for(let s=0;s<e.length;s+=this.deviceList.keyDownloadChunkSize){const o=e.slice(s,s+this.deviceList.keyDownloadChunkSize);i.push(()=>this.baseApis.downloadKeysForUsers(o,r))}return F_e(i,3).then(async s=>{const o=Object.assign({},...s.map(u=>u.device_keys||{})),a=Object.assign({},...s.map(u=>u.master_keys||{})),c=Object.assign({},...s.map(u=>u.self_signing_keys||{})),l=Object.assign({},...s.map(u=>u.user_signing_keys||{}));for(const u of e){await Jm(5);try{await this.processQueryResponseForUser(u,o[u],{master:a==null?void 0:a[u],self_signing:c==null?void 0:c[u],user_signing:l==null?void 0:l[u]})}catch(d){k.error(`Error processing keys for ${u}:`,d)}}}).then(()=>{k.log("Completed key download for "+e),this.downloadInProgress=!1,n==null||n.resolve(),this.queuedQueryDeferred&&this.doQueuedQueries()},s=>{k.warn("Error downloading keys for "+e+":",s),this.downloadInProgress=!1,n==null||n.reject(s)}),n.promise}async processQueryResponseForUser(e,n,r){k.log("got device keys for "+e+":",n),k.log("got cross-signing keys for "+e+":",r);{const i={},s=this.deviceList.getRawStoredDevicesForUser(e);s&&Object.keys(s).forEach(a=>{const c=Ys.fromStorage(s[a],a);i[a]=c}),await OTe(this.olmDevice,e,i,n||{},this.baseApis.getUserId(),this.baseApis.deviceId);const o={};Object.keys(i).forEach(a=>{o[a]=i[a].toStorage()}),this.deviceList.setRawStoredDevicesForUser(e,o)}if(r&&(r.master||r.self_signing||r.user_signing)){const i=this.deviceList.getStoredCrossSigningForUser(e)||new Ja(e);i.setKeys(r),this.deviceList.setRawStoredCrossSigningForUser(e,i.toStorage()),this.deviceList.emit(Zt.UserCrossSigningUpdated,e)}}}async function OTe(t,e,n,r,i,s){let o=!1;for(const a in n)if(n.hasOwnProperty(a)&&!(a in r)){if(e===i&&a===s){k.warn(`Local device ${a} missing from sync, skipping removal`);continue}k.log("Device "+e+":"+a+" has been removed"),delete n[a],o=!0}for(const a in r){if(!r.hasOwnProperty(a))continue;const c=r[a];if(c.user_id!==e){k.warn("Mismatched user_id "+c.user_id+" in keys from "+e+":"+a);continue}if(c.device_id!==a){k.warn("Mismatched device_id "+c.device_id+" in keys from "+e+":"+a);continue}await MTe(t,n,c)&&(o=!0)}return o}async function MTe(t,e,n){if(!n.keys)return!1;const r=n.device_id,i=n.user_id,s="ed25519:"+r,o=n.keys[s];if(!o)return k.warn("Device "+i+":"+r+" has no ed25519 key"),!1;const a=n.unsigned||{},c=n.signatures||{};try{await Zm(t,n,i,r,o)}catch(u){return k.warn("Unable to verify signature on device "+i+":"+r+":"+u),!1}let l;if(r in e){if(l=e[r],l.getFingerprint()!=o)return k.warn("Ed25519 key for device "+i+":"+r+" has changed"),!1}else e[r]=l=new Ys(r);return l.keys=n.keys||{},l.algorithms=n.algorithms||[],l.unsigned=a,l.signatures=c,!0}const RJ=new Map,rM=new Map;class IJ{constructor(e){this.userId=e.userId,this.deviceId=e.deviceId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis}prepareToEncrypt(e){}onRoomMembership(e,n,r){}}class xJ{constructor(e){this.userId=e.userId,this.crypto=e.crypto,this.olmDevice=e.olmDevice,this.baseApis=e.baseApis}async onRoomKeyEvent(e){}async importRoomKey(e,n){}hasKeysForKeyRequest(e){return Promise.resolve(!1)}shareKeysWithDevice(e){throw new Error("shareKeysWithDevice not supported for this DecryptionAlgorithm")}async retryDecryptionFromSender(e){return!1}}class ATe extends Error{constructor(e,n,r){super(e),this.devices=n,this.event=r,this.name="UnknownDeviceError",this.devices=n}}function PJ(t,e,n){RJ.set(t,e),rM.set(t,n)}const LTe=Ys.DeviceVerification;class DTe extends IJ{constructor(){super(...arguments),this.sessionPrepared=!1,this.prepPromise=null}ensureSession(e){return this.prepPromise?this.prepPromise:this.sessionPrepared?Promise.resolve():(this.prepPromise=this.crypto.downloadKeys(e).then(()=>this.crypto.ensureOlmSessionsForUsers(e)).then(()=>{this.sessionPrepared=!0}).finally(()=>{this.prepPromise=null}),this.prepPromise)}async encryptMessage(e,n,r){const s=(await e.getEncryptionTargetMembers()).map(function(l){return l.userId});await this.ensureSession(s);const o={room_id:e.roomId,type:n,content:r},a={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{}},c=[];for(const l of s){const u=this.crypto.getStoredDevicesForUser(l)||[];for(const d of u)d.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&d.verified!=LTe.BLOCKED&&c.push(cf(a.ciphertext,this.userId,this.deviceId,this.olmDevice,l,d,o))}return Promise.all(c).then(()=>a)}}class NTe extends xJ{async decryptEvent(e){const n=e.getWireContent(),r=n.sender_key,i=n.ciphertext;if(!i)throw new jr(Gn.OLM_MISSING_CIPHERTEXT,"Missing ciphertext");if(!(this.olmDevice.deviceCurve25519Key in i))throw new jr(Gn.OLM_NOT_INCLUDED_IN_RECIPIENTS,"Not included in recipients");const s=i[this.olmDevice.deviceCurve25519Key];let o;try{o=await this.decryptMessage(r,s)}catch(u){throw new jr(Gn.OLM_BAD_ENCRYPTED_MESSAGE,"Bad Encrypted Message",{sender:r,err:u})}const a=JSON.parse(o);if(a.recipient!=this.userId)throw new jr(Gn.OLM_BAD_RECIPIENT,"Message was intended for "+a.recipient);if(a.recipient_keys.ed25519!=this.olmDevice.deviceEd25519Key)throw new jr(Gn.OLM_BAD_RECIPIENT_KEY,"Message not intended for this device",{intended:a.recipient_keys.ed25519,our_key:this.olmDevice.deviceEd25519Key});let c=this.crypto.deviceList.getUserByIdentityKey(ri,r);if(c==null){try{await this.crypto.deviceList.downloadKeys([e.getSender()],!1)}catch(u){throw new jr(Gn.OLM_BAD_SENDER_CHECK_FAILED,"Could not verify sender identity",{sender:r,err:u})}c=this.crypto.deviceList.getUserByIdentityKey(ri,r)}if(c!==e.getSender()&&c!==void 0&&c!==null)throw new jr(Gn.OLM_BAD_SENDER,"Message claimed to be from "+e.getSender(),{real_sender:c});if(a.sender!=e.getSender())throw new jr(Gn.OLM_FORWARDED_MESSAGE,"Message forwarded from "+a.sender,{reported_sender:e.getSender()});if(a.room_id!==e.getRoomId())throw new jr(Gn.OLM_BAD_ROOM,"Message intended for room "+a.room_id,{reported_room:e.getRoomId()||"ROOM_ID_UNDEFINED"});const l=a.keys||{};return{clearEvent:a,senderCurve25519Key:r,claimedEd25519Key:l.ed25519||null}}decryptMessage(e,n){if(n.type!==0)return this.reallyDecryptMessage(e,n);{const r=this.olmDevice.olmPrekeyPromise.then(()=>this.reallyDecryptMessage(e,n));return this.olmDevice.olmPrekeyPromise=r.catch(()=>{}),r}}async reallyDecryptMessage(e,n){const r=await this.olmDevice.getSessionIdsForDevice(e),i={};for(const o of r)try{const a=await this.olmDevice.decryptMessage(e,o,n.type,n.body);return k.log("Decrypted Olm message from "+e+" with session "+o),a}catch(a){if(await this.olmDevice.matchesSession(e,o,n.type,n.body))throw new Error("Error decrypting prekey message with existing session id "+o+": "+a.message);i[o]=a.message}if(n.type!==0)throw r.length===0?new Error("No existing sessions"):new Error("Error decrypting non-prekey message with existing sessions: "+JSON.stringify(i));let s;try{s=await this.olmDevice.createInboundSession(e,n.type,n.body)}catch(o){throw i["(new)"]=o.message,new Error("Error decrypting prekey message: "+JSON.stringify(i))}return k.log("created new inbound Olm session ID "+s.session_id+" with "+e),s.payload}}PJ(ri,DTe,NTe);const UTe=500;var OJ=(t=>(t[t.Unsent=0]="Unsent",t[t.Sent=1]="Sent",t[t.CancellationPending=2]="CancellationPending",t[t.CancellationPendingAndWillResend=3]="CancellationPendingAndWillResend",t))(OJ||{});class $Te{constructor(e,n,r){this.baseApis=e,this.deviceId=n,this.cryptoStore=r,this.sendOutgoingRoomKeyRequestsRunning=!1,this.clientRunning=!0}stop(){k.log("stopping OutgoingRoomKeyRequestManager"),this.clientRunning=!1}sendQueuedRequests(){this.startTimer()}async queueRoomKeyRequest(e,n,r=!1){const i=await this.cryptoStore.getOutgoingRoomKeyRequest(e);if(!i)await this.cryptoStore.getOrAddOutgoingRoomKeyRequest({requestBody:e,recipients:n,requestId:this.baseApis.makeTxnId(),state:0});else switch(i.state){case 3:case 0:return;case 2:{const s=r?3:1;await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,2,{state:s,cancellationTxnId:this.baseApis.makeTxnId()});break}case 1:{if(r){const o=await this.cryptoStore.updateOutgoingRoomKeyRequest(i.requestId,1,{state:3,cancellationTxnId:this.baseApis.makeTxnId(),requestTxnId:this.baseApis.makeTxnId()});if(!o)return this.queueRoomKeyRequest(e,n,r);try{await this.sendOutgoingRoomKeyRequestCancellation(o,!0)}catch(a){k.error("Error sending room key request cancellation; will retry later.",a)}}break}default:throw new Error("unhandled state: "+i.state)}}cancelRoomKeyRequest(e){return this.cryptoStore.getOutgoingRoomKeyRequest(e).then(n=>{if(n)switch(n.state){case 2:case 3:return;case 0:return k.log("deleting unnecessary room key request for "+uw(e)),this.cryptoStore.deleteOutgoingRoomKeyRequest(n.requestId,0);case 1:return this.cryptoStore.updateOutgoingRoomKeyRequest(n.requestId,1,{state:2,cancellationTxnId:this.baseApis.makeTxnId()}).then(r=>{if(!r){k.log("Tried to cancel room key request for "+uw(e)+" but it was already cancelled in another tab");return}this.sendOutgoingRoomKeyRequestCancellation(r).catch(i=>{k.error("Error sending room key request cancellation; will retry later.",i),this.startTimer()})});default:throw new Error("unhandled state: "+n.state)}})}getOutgoingSentRoomKeyRequest(e,n){return this.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e,n,[1])}async cancelAndResendAllOutgoingRequests(){const e=await this.cryptoStore.getAllOutgoingRoomKeyRequestsByState(1);return Promise.all(e.map(({requestBody:n,recipients:r})=>this.queueRoomKeyRequest(n,r,!0)))}startTimer(){if(this.sendOutgoingRoomKeyRequestsTimer)return;const e=()=>{if(this.sendOutgoingRoomKeyRequestsRunning)throw new Error("RoomKeyRequestSend already in progress!");this.sendOutgoingRoomKeyRequestsRunning=!0,this.sendOutgoingRoomKeyRequests().finally(()=>{this.sendOutgoingRoomKeyRequestsRunning=!1}).catch(n=>{k.warn(`error in OutgoingRoomKeyRequestManager: ${n}`)})};this.sendOutgoingRoomKeyRequestsTimer=setTimeout(e,UTe)}async sendOutgoingRoomKeyRequests(){if(!this.clientRunning){this.sendOutgoingRoomKeyRequestsTimer=void 0;return}const e=await this.cryptoStore.getOutgoingRoomKeyRequestByState([2,3,0]);if(!e){this.sendOutgoingRoomKeyRequestsTimer=void 0;return}try{switch(e.state){case 0:await this.sendOutgoingRoomKeyRequest(e);break;case 2:await this.sendOutgoingRoomKeyRequestCancellation(e);break;case 3:await this.sendOutgoingRoomKeyRequestCancellation(e,!0);break}return this.sendOutgoingRoomKeyRequests()}catch(n){k.error("Error sending room key request; will retry later.",n),this.sendOutgoingRoomKeyRequestsTimer=void 0}}sendOutgoingRoomKeyRequest(e){k.log(`Requesting keys for ${uw(e.requestBody)} from ${NF(e.recipients)}(id ${e.requestId})`);const n={action:"request",requesting_device_id:this.deviceId,request_id:e.requestId,body:e.requestBody};return this.sendMessageToDevices(n,e.recipients,e.requestTxnId||e.requestId).then(()=>this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,0,{state:1}))}sendOutgoingRoomKeyRequestCancellation(e,n=!1){k.log(`Sending cancellation for key request for ${uw(e.requestBody)} to ${NF(e.recipients)} (cancellation id ${e.cancellationTxnId})`);const r={action:"request_cancellation",requesting_device_id:this.deviceId,request_id:e.requestId};return this.sendMessageToDevices(r,e.recipients,e.cancellationTxnId).then(()=>n?this.cryptoStore.updateOutgoingRoomKeyRequest(e.requestId,3,{state:0}):this.cryptoStore.deleteOutgoingRoomKeyRequest(e.requestId,2))}sendMessageToDevices(e,n,r){const i=new fr(()=>new Map);for(const s of n)i.getOrCreate(s.userId).set(s.deviceId,{...e,[vs]:ac()});return this.baseApis.sendToDevice(Z.RoomKeyRequest,i,r)}}function uw(t){return t.room_id+" / "+t.session_id}function NF(t){return`[${t.map(e=>`${e.userId}:${e.deviceId}`).join(",")}]`}function MJ(t){var r,i;const e=(r=t==null?void 0:t.currentState)==null?void 0:r.getStateEvents("m.room.history_visibility",""),n=(i=e==null?void 0:e.getContent())==null?void 0:i.history_visibility;return["world_readable","shared"].includes(n)}const FTe=t=>typeof t.ciphertext=="string"?!!t.ciphertext.length:!!Object.keys(t.ciphertext).length;class BTe{constructor(e,n=!1){this.sessionId=e,this.sharedHistory=n,this.useCount=0,this.sharedWithDevices=new fr(()=>new Map),this.blockedDevicesNotified=new fr(()=>new Map),this.creationTime=new Date().getTime()}needsRotation(e,n){const r=new Date().getTime()-this.creationTime;return this.useCount>=e||r>=n?(k.log("Rotating megolm session after "+this.useCount+" messages, "+r+"ms"),!0):!1}markSharedWithDevice(e,n,r,i){this.sharedWithDevices.getOrCreate(e).set(n,{deviceKey:r,messageIndex:i})}markNotifiedBlockedDevice(e,n){this.blockedDevicesNotified.getOrCreate(e).set(n,!0)}sharedWithTooManyDevices(e){var n;for(const[r,i]of this.sharedWithDevices){if(!e.has(r))return k.log("Starting new megolm session because we shared with "+r),!0;for(const[s]of i)if(!((n=e.get(r))!=null&&n.get(s)))return k.log("Starting new megolm session because we shared with "+r+":"+s),!0}return!1}}class jTe extends IJ{constructor(e){var n,r;super(e),this.setupPromise=Promise.resolve(null),this.outboundSessions={},this.roomId=e.roomId,this.prefixedLogger=k.getChild(`[${this.roomId} encryption]`),this.sessionRotationPeriodMsgs=((n=e.config)==null?void 0:n.rotation_period_msgs)??100,this.sessionRotationPeriodMs=((r=e.config)==null?void 0:r.rotation_period_ms)??7*24*3600*1e3}async ensureOutboundSession(e,n,r,i=!1){const s=async a=>{const c=MJ(e),l=await this.prepareSession(n,c,a);return await this.shareSession(n,c,i,r,l),l},o=this.setupPromise.then(s);return this.setupPromise=o.catch(a=>(this.prefixedLogger.error("Failed to setup outbound session",a),null)),o}async prepareSession(e,n,r){return r&&n!==r.sharedHistory&&(r=null),r!=null&&r.needsRotation(this.sessionRotationPeriodMsgs,this.sessionRotationPeriodMs)&&(this.prefixedLogger.debug("Starting new megolm session because we need to rotate."),r=null),r!=null&&r.sharedWithTooManyDevices(e)&&(r=null),r||(this.prefixedLogger.debug("Starting new megolm session"),r=await this.prepareNewSession(n),this.prefixedLogger.debug(`Started new megolm session ${r.sessionId}`),this.outboundSessions[r.sessionId]=r),r}async shareSession(e,n,r,i,s){var d;const o={};for(const[f,p]of e)for(const[m,v]of p)v.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&((d=s.sharedWithDevices.get(f))!=null&&d.get(m)||(o[f]=o[f]||[],o[f].push(v)));const a=this.olmDevice.getOutboundGroupSessionKey(s.sessionId),c={type:"m.room_key",content:{algorithm:Ks,room_id:this.roomId,session_id:s.sessionId,session_key:a.key,chain_index:a.chain_index,"org.matrix.msc3061.shared_history":n}},[l,u]=await vJ(this.olmDevice,this.baseApis,o);await Promise.all([(async()=>{const f=Array.from(u.entries()).map(([p,m])=>Array.from(m.entries()).map(([v,S])=>`${p}/${v}: ${S.sessionId}`)).flat(1);this.prefixedLogger.debug("Sharing keys with devices with existing Olm sessions:",f),await this.shareKeyWithOlmSessions(s,a,c,u),this.prefixedLogger.debug("Shared keys with existing Olm sessions")})(),(async()=>{const f=Array.from(l.entries()).map(([S,_])=>_.map(w=>`${S}/${w.deviceId}`)).flat(1);this.prefixedLogger.debug("Sharing keys (start phase 1) with devices without existing Olm sessions:",f);const p=[],m=Date.now(),v=[];await this.shareKeyWithDevices(s,a,c,l,p,r?1e4:2e3,v),this.prefixedLogger.debug("Shared keys (end phase 1) with devices without existing Olm sessions"),!r&&Date.now()-m<1e4?(async()=>{const S=new fr(()=>[]),_=new Set;for(const C of v)_.add(C);const w=[];for(const{userId:C,deviceInfo:I}of p){const R=C.slice(C.indexOf(":")+1);_.has(R)?S.getOrCreate(C).push(I):w.push({userId:C,deviceInfo:I})}const T=Array.from(S.entries()).map(([C,I])=>I.map(R=>`${C}/${R.deviceId}`)).flat(1);T.length>0&&(this.prefixedLogger.debug("Sharing keys (start phase 2) with devices without existing Olm sessions:",T),await this.shareKeyWithDevices(s,a,c,S,w,3e4),this.prefixedLogger.debug("Shared keys (end phase 2) with devices without existing Olm sessions")),await this.notifyFailedOlmDevices(s,a,w)})():await this.notifyFailedOlmDevices(s,a,p)})(),(async()=>{var m;this.prefixedLogger.debug(`There are ${i.size} blocked devices:`,Array.from(i.entries()).map(([v,S])=>Array.from(S.entries()).map(([_,w])=>`${v}/${_}`)).flat(1));const f=new fr(()=>new Map);let p=0;for(const[v,S]of i)for(const[_,w]of S)((m=s.blockedDevicesNotified.get(v))==null?void 0:m.get(_))===void 0&&(f.getOrCreate(v).set(_,{device:w}),p++);p&&(this.prefixedLogger.debug(`Notifying ${p} newly blocked devices:`,Array.from(f.entries()).map(([v,S])=>Object.entries(S).map(([_,w])=>`${v}/${_}`)).flat(1)),await this.notifyBlockedDevices(s,f),this.prefixedLogger.debug(`Notified ${p} newly blocked devices`))})()])}async prepareNewSession(e){const n=this.olmDevice.createOutboundGroupSession(),r=this.olmDevice.getOutboundGroupSessionKey(n);return await this.olmDevice.addInboundGroupSession(this.roomId,this.olmDevice.deviceCurve25519Key,[],n,r.key,{ed25519:this.olmDevice.deviceEd25519Key},!1,{sharedHistory:e}),this.crypto.backupManager.backupGroupSession(this.olmDevice.deviceCurve25519Key,n),new BTe(n,e)}getDevicesWithoutSessions(e,n,r=[]){for(const[i,s]of n){const o=e.get(i);for(const a of s){const c=a.deviceId,l=o==null?void 0:o.get(c);if(!(l!=null&&l.sessionId)){r.push({userId:i,deviceInfo:a}),o==null||o.delete(c);continue}}}return r}splitDevices(e){let r=[];const i=[r];for(const[s,o]of e){for(const a of o.values())r.push({userId:s,deviceInfo:a.device});r.length>20&&(r=[],i.push(r))}return r.length===0&&i.pop(),i}encryptAndSendKeysToDevices(e,n,r,i){return this.crypto.encryptAndSendToDevices(r,i).then(()=>{for(const s of r)e.markSharedWithDevice(s.userId,s.deviceInfo.deviceId,s.deviceInfo.getIdentityKey(),n)}).catch(s=>{throw this.prefixedLogger.error("failed to encryptAndSendToDevices",s),s})}async sendBlockedNotificationsToDevices(e,n,r){const i=new fr(()=>new Map);for(const s of n){const o=s.userId,a=s.deviceInfo,l=a.deviceInfo.deviceId,u={...r,code:a.code,reason:a.reason,[vs]:ac()};u.code==="m.no_olm"&&(delete u.room_id,delete u.session_id),i.getOrCreate(o).set(l,u)}await this.baseApis.sendToDevice("m.room_key.withheld",i);for(const[s,o]of i)for(const a of o.keys())e.markNotifiedBlockedDevice(s,a)}async reshareKeyWithDevice(e,n,r,i){var u;const s=this.outboundSessions[n];if(!s){this.prefixedLogger.debug(`megolm session ${e}|${n} not found: not re-sharing keys`);return}if(!s.sharedWithDevices.has(r)){this.prefixedLogger.debug(`megolm session ${e}|${n} never shared with user ${r}`);return}const o=(u=s.sharedWithDevices.get(r))==null?void 0:u.get(i.deviceId);if(o===void 0){this.prefixedLogger.debug(`megolm session ${e}|${n} never shared with device ${r}:${i.deviceId}`);return}if(o.deviceKey!==i.getIdentityKey()){this.prefixedLogger.warn(`Megolm session ${e}|${n} has been shared with device ${i.deviceId} but with identity key ${o.deviceKey}. Key is now ${i.getIdentityKey()}!`);return}const a=await this.olmDevice.getInboundGroupSessionKey(this.roomId,e,n,o.messageIndex);if(!a){this.prefixedLogger.warn(`No inbound session key found for megolm session ${e}|${n}: not re-sharing keys`);return}await fu(this.olmDevice,this.baseApis,new Map([[r,[i]]]));const c={type:"m.forwarded_room_key",content:{algorithm:Ks,room_id:this.roomId,session_id:n,session_key:a.key,chain_index:a.chain_index,sender_key:e,sender_claimed_ed25519_key:a.sender_claimed_ed25519_key,forwarding_curve25519_key_chain:a.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":a.shared_history||!1}},l={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};await cf(l.ciphertext,this.userId,this.deviceId,this.olmDevice,r,i,c),await this.baseApis.sendToDevice("m.room.encrypted",new Map([[r,new Map([[i.deviceId,l]])]])),this.prefixedLogger.debug(`Re-shared key for megolm session ${e}|${n} with ${r}:${i.deviceId}`)}async shareKeyWithDevices(e,n,r,i,s,o,a){const c=await fu(this.olmDevice,this.baseApis,i,!1,o,a,this.prefixedLogger);this.getDevicesWithoutSessions(c,i,s),await this.shareKeyWithOlmSessions(e,n,r,c)}async shareKeyWithOlmSessions(e,n,r,i){const s=this.splitDevices(i);for(let o=0;o<s.length;o++){const a=`megolm keys for ${e.sessionId} (slice ${o+1}/${s.length})`;try{this.prefixedLogger.debug(`Sharing ${a}`,s[o].map(c=>`${c.userId}/${c.deviceInfo.deviceId}`)),await this.encryptAndSendKeysToDevices(e,n.chain_index,s[o],r),this.prefixedLogger.debug(`Shared ${a}`)}catch(c){throw this.prefixedLogger.error(`Failed to share ${a}`),c}}}async notifyFailedOlmDevices(e,n,r){this.prefixedLogger.debug(`Notifying ${r.length} devices we failed to create Olm sessions`);for(const{userId:o,deviceInfo:a}of r){const c=a.deviceId;e.markSharedWithDevice(o,c,a.getIdentityKey(),n.chain_index)}const i=await this.olmDevice.filterOutNotifiedErrorDevices(r);this.prefixedLogger.debug(`Need to notify ${i.length} failed devices which haven't been notified before`);const s=new fr(()=>new Map);for(const{userId:o,deviceInfo:a}of i)s.getOrCreate(o).set(a.deviceId,{device:{code:"m.no_olm",reason:_C["m.no_olm"],deviceInfo:a}});await this.notifyBlockedDevices(e,s),this.prefixedLogger.debug(`Notified ${i.length} devices we failed to create Olm sessions`)}async notifyBlockedDevices(e,n){const r={room_id:this.roomId,session_id:e.sessionId,algorithm:Ks,sender_key:this.olmDevice.deviceCurve25519Key},i=this.splitDevices(n);for(let s=0;s<i.length;s++)try{await this.sendBlockedNotificationsToDevices(e,i[s],r),this.prefixedLogger.debug(`Completed blacklist notification for ${e.sessionId} (slice ${s+1}/${i.length})`)}catch(o){throw this.prefixedLogger.debug(`blacklist notification for ${e.sessionId} (slice ${s+1}/${i.length}) failed`),o}}prepareToEncrypt(e){if(e.roomId!==this.roomId)throw new Error("MegolmEncryption.prepareToEncrypt called on unexpected room");if(this.encryptionPreparation!=null){const i=Date.now()-this.encryptionPreparation.startTime;return this.prefixedLogger.debug(`Already started preparing to encrypt for this room ${i}ms ago, skipping`),this.encryptionPreparation.cancel}this.prefixedLogger.debug("Preparing to encrypt events");let n=!1;const r=()=>n;return this.encryptionPreparation={startTime:Date.now(),promise:(async()=>{try{const i=await this.getDevicesInRoom(e,!1,r);if(i===null)return;const[s,o]=i;this.crypto.globalErrorOnUnknownDevices&&this.removeUnknownDevices(s),this.prefixedLogger.debug("Ensuring outbound megolm session"),await this.ensureOutboundSession(e,s,o,!0),this.prefixedLogger.debug("Ready to encrypt events")}catch(i){this.prefixedLogger.error("Failed to prepare to encrypt events",i)}finally{delete this.encryptionPreparation}})(),cancel:()=>{n=!0,delete this.encryptionPreparation}},this.encryptionPreparation.cancel}async encryptMessage(e,n,r){if(this.prefixedLogger.debug("Starting to encrypt event"),this.encryptionPreparation!=null)try{await this.encryptionPreparation.promise}catch{}const i=this.isVerificationEvent(n,r),[s,o]=await this.getDevicesInRoom(e,i);this.crypto.globalErrorOnUnknownDevices&&this.checkForUnknownDevices(s);const a=await this.ensureOutboundSession(e,s,o),c={room_id:this.roomId,type:n,content:r},l=this.olmDevice.encryptGroupMessage(a.sessionId,JSON.stringify(c)),u={algorithm:Ks,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:l,session_id:a.sessionId,device_id:this.deviceId};return a.useCount++,u}isVerificationEvent(e,n){switch(e){case Z.KeyVerificationCancel:case Z.KeyVerificationDone:case Z.KeyVerificationMac:case Z.KeyVerificationStart:case Z.KeyVerificationKey:case Z.KeyVerificationReady:case Z.KeyVerificationAccept:return!0;case Z.RoomMessage:return n.msgtype===Oa.KeyVerificationRequest;default:return!1}}forceDiscardSession(){this.setupPromise=this.setupPromise.then(()=>null)}checkForUnknownDevices(e){const n=new fr(()=>new Map);for(const[r,i]of e)for(const[s,o]of i)o.isUnverified()&&!o.isKnown()&&n.getOrCreate(r).set(s,o);if(n.size)throw new ATe("This room contains unknown devices which have not been verified. We strongly recommend you verify them before continuing.",n)}removeUnknownDevices(e){for(const[n,r]of e){for(const[i,s]of r)s.isUnverified()&&!s.isKnown()&&r.delete(i);r.size===0&&e.delete(n)}}async getDevicesInRoom(e,n=!1,r){const i=await e.getEncryptionTargetMembers();this.prefixedLogger.debug(`Encrypting for users (shouldEncryptForInvitedMembers: ${e.shouldEncryptForInvitedMembers()}):`,i.map(u=>`${u.userId} (${u.membership})`));const s=i.map(function(u){return u.userId});let o=this.crypto.globalBlacklistUnverifiedDevices;const a=e.getBlacklistUnverifiedDevices();typeof a=="boolean"&&(o=a);const c=await this.crypto.downloadKeys(s,!1);if((r==null?void 0:r())===!0)return null;const l=new fr(()=>new Map);for(const[u,d]of c)for(const[f,p]of d){if(r!==void 0&&await $_e(),(r==null?void 0:r())===!0)return null;const m=this.crypto.checkDeviceTrust(u,f);if(p.isBlocked()||!m.isVerified()&&o&&!n){const v=l.getOrCreate(u),S=p.isBlocked();v.set(f,{code:S?"m.blacklisted":"m.unverified",reason:_C[S?"m.blacklisted":"m.unverified"],deviceInfo:p}),d.delete(f)}}return[c,l]}}class HTe extends xJ{constructor(e){super(e),this.pendingEvents=new Map,this.olmlib=lTe,this.roomId=e.roomId,this.prefixedLogger=k.getChild(`[${this.roomId} decryption]`)}async decryptEvent(e){const n=e.getWireContent();if(!n.sender_key||!n.session_id||!n.ciphertext)throw new jr(Gn.MEGOLM_MISSING_FIELDS,"Missing fields in input");this.addEventToPendingList(e);let r;try{r=await this.olmDevice.decryptGroupMessage(e.getRoomId(),n.sender_key,n.session_id,n.ciphertext,e.getId(),e.getTs())}catch(s){if(s.name==="DecryptionError")throw s;let o=Gn.OLM_DECRYPT_GROUP_MESSAGE_ERROR;throw(s==null?void 0:s.message)==="OLM.UNKNOWN_MESSAGE_INDEX"&&(this.requestKeysForEvent(e),o=Gn.OLM_UNKNOWN_MESSAGE_INDEX),new jr(o,s instanceof Error?s.message:"Unknown Error: Error is undefined",{session:n.sender_key+"|"+n.session_id})}if(r===null){this.crypto.backupManager.queryKeyBackupRateLimited(e.getRoomId(),n.session_id).catch(()=>{}),this.requestKeysForEvent(e);const s=await this.olmDevice.sessionMayHaveProblems(n.sender_key,e.getTs()-12e4);if(s){this.prefixedLogger.info(`When handling UISI from ${e.getSender()} (sender key ${n.sender_key}): recent session problem with that sender:`,s);let o=UF[s.type]||UF.unknown;throw s.fixed&&(o+=" Trying to create a new secure channel and re-requesting the keys."),new jr(Gn.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,o,{session:n.sender_key+"|"+n.session_id})}throw new jr(Gn.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",{session:n.sender_key+"|"+n.session_id})}r.untrusted||this.removeEventFromPendingList(e);const i=JSON.parse(r.result);if(i.room_id!==e.getRoomId())throw new jr(Gn.MEGOLM_BAD_ROOM,"Message intended for room "+i.room_id);return{clearEvent:i,senderCurve25519Key:r.senderKey,claimedEd25519Key:r.keysClaimed.ed25519,forwardingCurve25519KeyChain:r.forwardingCurve25519KeyChain,untrusted:r.untrusted}}requestKeysForEvent(e){const n=e.getWireContent(),r=e.getKeyRequestRecipients(this.userId);this.crypto.requestRoomKey({room_id:e.getRoomId(),algorithm:n.algorithm,sender_key:n.sender_key,session_id:n.session_id},r)}addEventToPendingList(e){var o;const n=e.getWireContent(),r=n.sender_key,i=n.session_id;this.pendingEvents.has(r)||this.pendingEvents.set(r,new Map);const s=this.pendingEvents.get(r);s.has(i)||s.set(i,new Set),(o=s.get(i))==null||o.add(e)}removeEventFromPendingList(e){const n=e.getWireContent(),r=n.sender_key,i=n.session_id,s=this.pendingEvents.get(r),o=s==null?void 0:s.get(i);o&&(o.delete(e),o.size===0&&s.delete(i),s.size===0&&this.pendingEvents.delete(r))}roomKeyFromEvent(e){const n=e.getSenderKey(),r=e.getContent(),i={};if(!r.room_id||!r.session_key||!r.session_id||!r.algorithm){this.prefixedLogger.error("key event is missing fields");return}if(!I4(e)){this.prefixedLogger.error("key event not properly encrypted");return}return r["org.matrix.msc3061.shared_history"]&&(i.sharedHistory=!0),{senderKey:n,sessionId:r.session_id,sessionKey:r.session_key,extraSessionData:i,exportFormat:!1,roomId:r.room_id,algorithm:r.algorithm,forwardingKeyChain:[],keysClaimed:e.getKeysClaimed()}}forwardedRoomKeyFromEvent(e){const n=this.roomKeyFromEvent(e);if(!n)return;const r=e.getSenderKey(),i=e.getContent(),s=this.baseApis.crypto.deviceList.getUserByIdentityKey(ri,r),o=i.sender_key,a=i.sender_claimed_ed25519_key;let c=Array.isArray(i.forwarding_curve25519_key_chain)?i.forwarding_curve25519_key_chain:[];if(c=c.slice(),c.push(r),s!==e.getSender()){this.prefixedLogger.error("sending device does not belong to the user it claims to be from");return}if(!o){this.prefixedLogger.error("forwarded_room_key event is missing sender_key field");return}if(!a){this.prefixedLogger.error("forwarded_room_key_event is missing sender_claimed_ed25519_key field");return}const l={ed25519:a};return n.senderKey=o,n.keysClaimed=l,n.exportFormat=!0,n.forwardingKeyChain=c,n.extraSessionData.untrusted=!0,n}async shouldAcceptForwardedKey(e,n){const r=e.getSenderKey(),i=this.crypto.deviceList.getDeviceByIdentityKey(ri,r)??void 0,s=this.crypto.checkDeviceInfoTrust(e.getSender(),i),o=e.getSender()===this.baseApis.getUserId(),a=s.isVerified()&&o,c=await this.wasRoomKeyRequested(e,n),l=this.wasRoomKeyForwardedByInviter(e,n),u=this.wasRoomKeyForwardedAsHistory(n);return c&&a||l&&u}async wasRoomKeyRequested(e,n){return(await this.crypto.cryptoStore.getOutgoingRoomKeyRequestsByTarget(e.getSender(),"*",[OJ.Sent])).some(i=>i.requestBody.room_id===n.roomId&&i.requestBody.session_id===n.sessionId)}wasRoomKeyForwardedByInviter(e,n){var c,l,u;const r=this.baseApis.getRoom(n.roomId),i=e.getSenderKey();if(!i)return!1;const s=this.crypto.deviceList.getUserByIdentityKey(ri,i);if(!s)return!1;const o=(c=r==null?void 0:r.getMember(this.userId))==null?void 0:c.events.member,a=(o==null?void 0:o.getSender())===s||((l=o==null?void 0:o.getUnsigned())==null?void 0:l.prev_sender)===s&&((u=o==null?void 0:o.getPrevContent())==null?void 0:u.membership)===Ge.Invite;return!!(r&&a)}wasRoomKeyForwardedAsHistory(e){return!!(this.baseApis.getRoom(e.roomId)&&e.extraSessionData.sharedHistory)}shouldParkForwardedKey(e){return!!(!this.baseApis.getRoom(e.roomId)&&e.extraSessionData.sharedHistory)}async parkForwardedKey(e,n){const r={senderId:e.getSender(),senderKey:n.senderKey,sessionId:n.sessionId,sessionKey:n.sessionKey,keysClaimed:n.keysClaimed,forwardingCurve25519KeyChain:n.forwardingKeyChain};await this.crypto.cryptoStore.doTxn("readwrite",["parked_shared_history"],i=>this.crypto.cryptoStore.addParkedSharedHistory(n.roomId,r,i),k.getChild("[addParkedSharedHistory]"))}async addRoomKey(e){try{await this.olmDevice.addInboundGroupSession(e.roomId,e.senderKey,e.forwardingKeyChain,e.sessionId,e.sessionKey,e.keysClaimed,e.exportFormat,e.extraSessionData),await this.retryDecryption(e.senderKey,e.sessionId,!e.extraSessionData.untrusted)&&this.crypto.cancelRoomKeyRequest({algorithm:e.algorithm,room_id:e.roomId,session_id:e.sessionId,sender_key:e.senderKey}),await this.crypto.backupManager.backupGroupSession(e.senderKey,e.sessionId)}catch(n){this.prefixedLogger.error(`Error handling m.room_key_event: ${n}`)}}async onForwardedRoomKey(e){const n=this.forwardedRoomKeyFromEvent(e);n&&(await this.shouldAcceptForwardedKey(e,n)?await this.addRoomKey(n):this.shouldParkForwardedKey(n)&&await this.parkForwardedKey(e,n))}async onRoomKeyEvent(e){if(e.getType()=="m.forwarded_room_key")await this.onForwardedRoomKey(e);else{const n=this.roomKeyFromEvent(e);if(!n)return;await this.addRoomKey(n)}}async onRoomKeyWithheldEvent(e){const n=e.getContent(),r=n.sender_key;n.code==="m.no_olm"?await this.onNoOlmWithheldEvent(e):n.code==="m.unavailable"||await this.olmDevice.addInboundGroupSessionWithheld(n.room_id,r,n.session_id,n.code,n.reason),n.session_id?await this.retryDecryption(r,n.session_id):await this.retryDecryptionFromSender(r)}async onNoOlmWithheldEvent(e){const n=e.getContent(),r=n.sender_key,i=e.getSender();if(this.prefixedLogger.warn(`${i}:${r} was unable to establish an olm session with us`),await this.olmDevice.getSessionIdForDevice(r)){this.prefixedLogger.debug("New session already created.  Not creating a new one."),await this.olmDevice.recordSessionProblem(r,"no_olm",!0);return}let s=this.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r);if(!s&&(await this.crypto.downloadKeys([i],!1),s=this.crypto.deviceList.getDeviceByIdentityKey(n.algorithm,r),!s)){this.prefixedLogger.info("Couldn't find device for identity key "+r+": not establishing session"),await this.olmDevice.recordSessionProblem(r,"no_olm",!1);return}await fu(this.olmDevice,this.baseApis,new Map([[i,[s]]]),!1);const o={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};await cf(o.ciphertext,this.userId,void 0,this.olmDevice,i,s,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(r,"no_olm",!0),await this.baseApis.sendToDevice("m.room.encrypted",new Map([[i,new Map([[s.deviceId,o]])]]))}hasKeysForKeyRequest(e){const n=e.requestBody;return this.olmDevice.hasInboundSessionKeys(n.room_id,n.sender_key,n.session_id)}shareKeysWithDevice(e){const n=e.userId,r=e.deviceId,i=this.crypto.getStoredDevice(n,r),s=e.requestBody;this.olmlib.ensureOlmSessionsForDevices(this.olmDevice,this.baseApis,new Map([[n,[i]]])).then(o=>{var c;const a=(c=o.get(n))==null?void 0:c.get(r);return a!=null&&a.sessionId?(this.prefixedLogger.debug("sharing keys for session "+s.sender_key+"|"+s.session_id+" with device "+n+":"+r),this.buildKeyForwardingMessage(s.room_id,s.sender_key,s.session_id)):null}).then(o=>{const a={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};return this.olmlib.encryptMessageForDevice(a.ciphertext,this.userId,void 0,this.olmDevice,n,i,o).then(()=>this.baseApis.sendToDevice("m.room.encrypted",new Map([[n,new Map([[r,a]])]])))})}async buildKeyForwardingMessage(e,n,r){const i=await this.olmDevice.getInboundGroupSessionKey(e,n,r);return{type:"m.forwarded_room_key",content:{algorithm:Ks,room_id:e,sender_key:n,sender_claimed_ed25519_key:i.sender_claimed_ed25519_key,session_id:r,session_key:i.key,chain_index:i.chain_index,forwarding_curve25519_key_chain:i.forwarding_curve25519_key_chain,"org.matrix.msc3061.shared_history":i.shared_history||!1}}}importRoomKey(e,{untrusted:n,source:r}={}){const i={};return(n||e.untrusted)&&(i.untrusted=!0),e["org.matrix.msc3061.shared_history"]&&(i.sharedHistory=!0),this.olmDevice.addInboundGroupSession(e.room_id,e.sender_key,e.forwarding_curve25519_key_chain,e.session_id,e.session_key,e.sender_claimed_keys,!0,i).then(()=>{r!=="backup"&&this.crypto.backupManager.backupGroupSession(e.sender_key,e.session_id).catch(s=>{this.prefixedLogger.debug("Failed to back up megolm session",s)}),this.retryDecryption(e.sender_key,e.session_id,!i.untrusted)})}async retryDecryption(e,n,r){var a;const i=this.pendingEvents.get(e);if(!i)return!0;const s=i.get(n);if(!s)return!0;const o=[...s];return this.prefixedLogger.debug("Retrying decryption on events:",o.map(c=>`${c.getId()}`)),await Promise.all(o.map(async c=>{try{await c.attemptDecryption(this.crypto,{isRetry:!0,forceRedecryptIfUntrusted:r})}catch{}})),!((a=this.pendingEvents.get(e))!=null&&a.has(n))}async retryDecryptionFromSender(e){const n=this.pendingEvents.get(e);return n?(this.pendingEvents.delete(e),await Promise.all([...n].map(async([r,i])=>{await Promise.all([...i].map(async s=>{try{await s.attemptDecryption(this.crypto)}catch{}}))})),!this.pendingEvents.has(e)):!0}async sendSharedHistoryInboundSessions(e){await fu(this.olmDevice,this.baseApis,e);const n=await this.olmDevice.getSharedHistoryInboundGroupSessions(this.roomId);this.prefixedLogger.debug(`Sharing history in with users ${Array.from(e.keys())}`,n.map(([r,i])=>`${r}|${i}`));for(const[r,i]of n){const s=await this.buildKeyForwardingMessage(this.roomId,r,i),o=[],a=new Map;for(const[c,l]of e){const u=new Map;a.set(c,u);for(const d of l){const f={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};u.set(d.deviceId,f),o.push(cf(f.ciphertext,this.userId,void 0,this.olmDevice,c,d,s))}}await Promise.all(o);for(const[c,l]of a){for(const[u,d]of l)FTe(d)||(this.prefixedLogger.debug("No ciphertext for device "+c+":"+u+": pruning"),l.delete(u));l.size===0&&(this.prefixedLogger.debug("Pruned all devices for user "+c),a.delete(c))}if(a.size===0){this.prefixedLogger.debug("No users left to send to: aborting");return}await this.baseApis.sendToDevice("m.room.encrypted",a)}}}const UF={no_olm:"The sender was unable to establish a secure channel.",unknown:"The secure channel with the sender was corrupted."};PJ(Ks,jTe,HTe);class $F{constructor(e,n){this.accountDataClientAdapter=new VTe(e),this.crossSigningCallbacks=new qTe,this.ssssCryptoCallbacks=new GTe(n)}addCrossSigningKeys(e,n){this.crossSigningKeys={authUpload:e,keys:n}}addSessionBackup(e){this.keyBackupInfo=e}addSessionBackupPrivateKeyToCache(e){this.sessionBackupPrivateKey=e}addKeySignature(e,n,r){this.keySignatures||(this.keySignatures={});const i=this.keySignatures[e]||{};this.keySignatures[e]=i,i[n]=r}async setAccountData(e,n){await this.accountDataClientAdapter.setAccountData(e,n)}buildOperation(){const e=this.accountDataClientAdapter.values;return new KTe(e,this.crossSigningKeys,this.keyBackupInfo,this.keySignatures)}async persist(e){var n;if(this.crossSigningKeys){const r=kJ(e.cryptoStore,e.olmDevice);for(const i of["master","self_signing","user_signing"]){k.log(`Cache ${i} cross-signing private key locally`);const s=this.crossSigningCallbacks.privateKeys.get(i);await((n=r.storeCrossSigningKeyCache)==null?void 0:n.call(r,i,s))}await e.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],i=>{e.cryptoStore.storeCrossSigningKeys(i,this.crossSigningKeys.keys)})}this.sessionBackupPrivateKey&&await e.storeSessionBackupPrivateKey(this.sessionBackupPrivateKey)}}class KTe{constructor(e,n,r,i){this.accountData=e,this.crossSigningKeys=n,this.keyBackupInfo=r,this.keySignatures=i}async apply(e){var r,i;const n=e.baseApis;if(this.crossSigningKeys){const s={};for(const[o,a]of Object.entries(this.crossSigningKeys.keys))s[o+"_key"]=a;await((i=(r=this.crossSigningKeys).authUpload)==null?void 0:i.call(r,o=>n.uploadDeviceSigningKeys(o??void 0,s))),e.crossSigningInfo.setKeys(this.crossSigningKeys.keys)}if(this.accountData)for(const[s,o]of this.accountData)await n.setAccountData(s,o);this.keySignatures&&await n.uploadKeySignatures(this.keySignatures),this.keyBackupInfo&&(this.keyBackupInfo.version?await n.http.authedRequest(oe.Put,"/room_keys/version/"+this.keyBackupInfo.version,void 0,{algorithm:this.keyBackupInfo.algorithm,auth_data:this.keyBackupInfo.auth_data},{prefix:Nn.V3}):await n.http.authedRequest(oe.Post,"/room_keys/version",void 0,this.keyBackupInfo,{prefix:Nn.V3}),await e.backupManager.checkKeyBackup())}}class VTe extends Fn{constructor(e){super(),this.existingValues=e,this.values=new Map}getAccountDataFromServer(e){return Promise.resolve(this.getAccountData(e))}getAccountData(e){const n=this.values.get(e);if(n)return n;const r=this.existingValues.get(e);return r?r.getContent():null}setAccountData(e,n){const r=this.values.get(e);return this.values.set(e,n),Promise.resolve().then(()=>{const i=new oi({type:e,content:n});return this.emit(qe.AccountData,i,r),{}})}}class qTe{constructor(){this.privateKeys=new Map}getCrossSigningKeyCache(e,n){return this.getCrossSigningKey(e,n)}storeCrossSigningKeyCache(e,n){return this.privateKeys.set(e,n),Promise.resolve()}getCrossSigningKey(e,n){return Promise.resolve(this.privateKeys.get(e)??null)}saveCrossSigningKeys(e){for(const[n,r]of Object.entries(e))this.privateKeys.set(n,r)}}class GTe{constructor(e){this.delegateCryptoCallbacks=e,this.privateKeys=new Map}async getSecretStorageKey({keys:e},n){var r;for(const i of Object.keys(e)){const s=this.privateKeys.get(i);if(s)return[i,s]}if((r=this==null?void 0:this.delegateCryptoCallbacks)!=null&&r.getSecretStorageKey){const i=await this.delegateCryptoCallbacks.getSecretStorageKey({keys:e},n);if(i){const[s,o]=i;this.privateKeys.set(s,o)}return i}return null}addPrivateKey(e,n,r){var i,s;this.privateKeys.set(e,r),(s=(i=this.delegateCryptoCallbacks)==null?void 0:i.cacheSecretStorageKey)==null||s.call(i,e,n,r)}}const jc="m.secret_storage.v1.aes-hmac-sha2";class Y0{constructor(e,n){this.accountDataAdapter=e,this.callbacks=n}async getDefaultKeyId(){const e=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return e?e.key:null}setDefaultKeyId(e){return new Promise((n,r)=>{const i=s=>{s.getType()==="m.secret_storage.default_key"&&s.getContent().key===e&&(this.accountDataAdapter.removeListener(qe.AccountData,i),n())};this.accountDataAdapter.on(qe.AccountData,i),this.accountDataAdapter.setAccountData("m.secret_storage.default_key",{key:e}).catch(s=>{this.accountDataAdapter.removeListener(qe.AccountData,i),r(s)})})}async addKey(e,n,r){if(e!==jc)throw new Error(`Unknown key algorithm ${e}`);const i={algorithm:e};n.name&&(i.name=n.name),n.passphrase&&(i.passphrase=n.passphrase);const{iv:s,mac:o}=await dm(n.key);if(i.iv=s,i.mac=o,!r)do r=Zi(32);while(await this.accountDataAdapter.getAccountDataFromServer(`m.secret_storage.key.${r}`));return await this.accountDataAdapter.setAccountData(`m.secret_storage.key.${r}`,i),{keyId:r,keyInfo:i}}async getKey(e){if(e||(e=await this.getDefaultKeyId()),!e)return null;const n=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+e);return n?[e,n]:null}async hasKey(e){return!!await this.getKey(e)}async checkKey(e,n){if(n.algorithm===jc)if(n.mac){const{mac:r}=await dm(e,n.iv);return iM(n.mac)===iM(r)}else return!0;else throw new Error("Unknown algorithm")}async store(e,n,r){const i={};if(!r){const s=await this.getDefaultKeyId();if(!s)throw new Error("No keys specified and no default key present");r=[s]}if(r.length===0)throw new Error("Zero keys given to encrypt with!");for(const s of r){const o=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+s);if(!o)throw new Error("Unknown key: "+s);if(o.algorithm===jc){const a={[s]:o},[,c]=await this.getSecretStorageKey(a,e);i[s]=await c.encrypt(n)}else k.warn("unknown algorithm for secret storage key "+s+": "+o.algorithm)}await this.accountDataAdapter.setAccountData(e,{encrypted:i})}async get(e){const n=await this.accountDataAdapter.getAccountDataFromServer(e);if(!n)return;if(!n.encrypted)throw new Error("Content is not encrypted!");const r={};for(const a of Object.keys(n.encrypted)){const c=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+a),l=n.encrypted[a];(c==null?void 0:c.algorithm)===jc&&l.iv&&l.ciphertext&&l.mac&&(r[a]=c)}if(Object.keys(r).length===0)throw new Error(`Could not decrypt ${e} because none of the keys it is encrypted with are for a supported algorithm`);const[i,s]=await this.getSecretStorageKey(r,e),o=n.encrypted[i];return s.decrypt(o)}async isStored(e){const n=await this.accountDataAdapter.getAccountDataFromServer(e);if(!(n!=null&&n.encrypted))return null;const r={};for(const i of Object.keys(n.encrypted)){const s=await this.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key."+i);if(!s)continue;const o=n.encrypted[i];s.algorithm===jc&&o.iv&&o.ciphertext&&o.mac&&(r[i]=s)}return Object.keys(r).length?r:null}async getSecretStorageKey(e,n){if(!this.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");const r=await this.callbacks.getSecretStorageKey({keys:e},n);if(!r)throw new Error("getSecretStorageKey callback returned falsey");if(r.length<2)throw new Error("getSecretStorageKey callback returned invalid data");const[i,s]=r;if(!e[i])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[i].algorithm===jc)return[i,{encrypt:function(a){return jv(a,s,n)},decrypt:function(a){return Eb(a,s,n)}}];throw new Error("Unknown key type: "+e[i].algorithm)}}function iM(t){let e=t.length;for(;e>=1&&t.charCodeAt(e-1)==61;)e--;return e<t.length?t.substring(0,e):t}const zTe=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:jc,ServerSideSecretStorageImpl:Y0,trimTrailingEquals:iM},Symbol.toStringTag,{value:"Module"}));class WTe{constructor(e,n){this.baseApis=e,this.cryptoCallbacks=n,this.requests=new Map}request(e,n){const r=this.baseApis.makeTxnId(),i=Ef();this.requests.set(r,{name:e,devices:n,deferred:i});const s=c=>{const l={action:"request_cancellation",requesting_device_id:this.baseApis.deviceId,request_id:r},u=new Map;for(const d of n)u.set(d,l);this.baseApis.sendToDevice("m.secret.request",new Map([[this.baseApis.getUserId(),u]])),i.reject(new Error(c||"Cancelled"))},o={name:e,action:"request",requesting_device_id:this.baseApis.deviceId,request_id:r,[vs]:ac()},a=new Map;for(const c of n)a.set(c,o);return k.info(`Request secret ${e} from ${n}, id ${r}`),this.baseApis.sendToDevice("m.secret.request",new Map([[this.baseApis.getUserId(),a]])),{requestId:r,promise:i.promise,cancel:s}}async onRequestReceived(e){const n=e.getSender(),r=e.getContent();if(n!==this.baseApis.getUserId()||!(r.name&&r.action&&r.requesting_device_id&&r.request_id))return;const i=r.requesting_device_id;if(r.action!=="request_cancellation"){if(r.action==="request"){if(i===this.baseApis.deviceId||(k.info("received request for secret ("+n+", "+i+", "+r.request_id+")"),!this.cryptoCallbacks.onSecretRequested))return;const s=await this.cryptoCallbacks.onSecretRequested(n,i,r.request_id,r.name,this.baseApis.checkDeviceTrust(n,i));if(s){k.info(`Preparing ${r.name} secret for ${i}`);const o={type:"m.secret.send",content:{request_id:r.request_id,secret:s}},a={algorithm:ri,sender_key:this.baseApis.crypto.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};await fu(this.baseApis.crypto.olmDevice,this.baseApis,new Map([[n,[this.baseApis.getStoredDevice(n,i)]]])),await cf(a.ciphertext,this.baseApis.getUserId(),this.baseApis.deviceId,this.baseApis.crypto.olmDevice,n,this.baseApis.getStoredDevice(n,i),o);const c=new Map([[n,new Map([[i,a]])]]);k.info(`Sending ${r.name} secret for ${i}`),this.baseApis.sendToDevice("m.room.encrypted",c)}else k.info(`Request denied for ${r.name} secret for ${i}`)}}}onSecretReceived(e){if(e.getSender()!==this.baseApis.getUserId())return;if(!I4(e)){k.error("secret event not properly encrypted");return}const n=e.getContent();if(this.baseApis.crypto.deviceList.getUserByIdentityKey(ri,e.getSenderKey()||"")!==e.getSender()){k.error("sending device does not belong to the user it claims to be from");return}k.log("got secret share for request",n.request_id);const i=this.requests.get(n.request_id);if(i){const s=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(ri,e.getSenderKey());if(!s){k.log("secret share from unknown device with key",e.getSenderKey());return}if(!i.devices.includes(s.deviceId)){k.log("unsolicited secret share from device",s.deviceId);return}if(!this.baseApis.crypto.checkDeviceInfoTrust(e.getSender(),s).isVerified()){k.log("secret share from unverified device");return}k.log(`Successfully received secret ${i.name} from ${s.deviceId}`),i.deferred.resolve(n.secret)}}}class YTe{constructor(e,n,r){this.storageImpl=new Y0(e,n),this.sharingImpl=new WTe(r,n)}getDefaultKeyId(){return this.storageImpl.getDefaultKeyId()}setDefaultKeyId(e){return this.storageImpl.setDefaultKeyId(e)}addKey(e,n,r){return this.storageImpl.addKey(e,n,r)}getKey(e){return this.storageImpl.getKey(e)}hasKey(e){return this.storageImpl.hasKey(e)}checkKey(e,n){return this.storageImpl.checkKey(e,n)}store(e,n,r){return this.storageImpl.store(e,n,r)}get(e){return this.storageImpl.get(e)}async isStored(e){return this.storageImpl.isStored(e)}request(e,n){return this.sharingImpl.request(e,n)}onRequestReceived(e){return this.sharingImpl.onRequestReceived(e)}onSecretReceived(e){this.sharingImpl.onSecretReceived(e)}}function JTe(t,e,n){const r=Object.assign({},{code:t,reason:e},n);return new oi({type:Z.KeyVerificationCancel,content:r})}function ju(t,e){return function(n){return JTe(t,e,n)}}const AJ=ju("m.user","Cancelled by user"),XTe=ju("m.timeout","Timed out"),Q1=ju("m.unknown_method","Unknown method"),LJ=ju("m.unexpected_message","Unexpected message"),hh=ju("m.key_mismatch","Key mismatch"),ZTe=ju("m.invalid_message","Invalid message");function sM(t){const e=t.getContent();if(e){const{code:n,reason:r}=e;return{code:n,reason:r}}else return{code:"Unknown error",reason:"m.unknown"}}const FF=new Error("Verification timed out");class oM extends Error{constructor(e){super(),this.startEvent=e}}const QTe=wb;class O4 extends Fn{constructor(e,n,r,i,s,o){super(),this.channel=e,this.baseApis=n,this.userId=r,this.deviceId=i,this.startEvent=s,this.request=o,this.cancelled=!1,this._done=!1,this.promise=null,this.transactionTimeoutTimer=null}get initiatedByMe(){if(!this.startEvent)return!0;const e=this.startEvent.getSender(),n=this.startEvent.getContent();return e===this.baseApis.getUserId()&&n.from_device===this.baseApis.getDeviceId()}get hasBeenCancelled(){return this.cancelled}resetTimer(){k.info("Refreshing/starting the verification transaction timeout timer"),this.transactionTimeoutTimer!==null&&clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=setTimeout(()=>{!this._done&&!this.cancelled&&(k.info("Triggering verification timeout"),this.cancel(FF))},10*60*1e3)}endTimer(){this.transactionTimeoutTimer!==null&&(clearTimeout(this.transactionTimeoutTimer),this.transactionTimeoutTimer=null)}send(e,n){return this.channel.send(e,n)}waitForEvent(e){if(this._done)return Promise.reject(new Error("Verification is already done"));const n=this.request.getEventFromOtherParty(e);return n?Promise.resolve(n):(this.expectedEvent=e,new Promise((r,i)=>{this.resolveEvent=r,this.rejectEvent=i}))}canSwitchStartEvent(e){return!1}switchStartEvent(e){if(this.canSwitchStartEvent(e))if(k.log("Verification Base: switching verification start event",{restartingFlow:!!this.rejectEvent}),this.rejectEvent){const n=this.rejectEvent;this.rejectEvent=void 0,n(new oM(e))}else this.startEvent=e}handleEvent(e){var n;if(!this._done){if(e.getType()===this.expectedEvent)this.expectedEvent!==Z.KeyVerificationDone&&(this.expectedEvent=void 0,this.rejectEvent=void 0,this.resetTimer(),(n=this.resolveEvent)==null||n.call(this,e));else if(e.getType()===Z.KeyVerificationCancel){const r=this.reject;if(this.reject=void 0,r){const i=e.getContent(),{reason:s,code:o}=i;r(new Error(`Other side cancelled verification because ${s} (${o})`))}}else if(this.expectedEvent){const r=new Error("Unexpected message: expecting "+this.expectedEvent+" but got "+e.getType());if(this.expectedEvent=void 0,this.rejectEvent){const i=this.rejectEvent;this.rejectEvent=void 0,i(r)}this.cancel(r)}}}async done(){var e;if(this.endTimer(),!this._done)return this.request.onVerifierFinished(),(e=this.resolve)==null||e.call(this),ITe(this.baseApis,this.userId,this.deviceId)}cancel(e){if(this.endTimer(),!this._done){if(this.cancelled=!0,this.request.onVerifierCancelled(),this.userId&&this.deviceId)if(e===FF){const n=XTe();this.send(n.getType(),n.getContent())}else if(e instanceof oi){if(e.getSender()!==this.userId){const r=e.getContent();e.getType()===Z.KeyVerificationCancel?(r.code=r.code||"m.unknown",r.reason=r.reason||r.body||"Unknown reason",this.send(Z.KeyVerificationCancel,r)):this.send(Z.KeyVerificationCancel,{code:"m.unknown",reason:r.body||"Unknown reason"})}}else this.send(Z.KeyVerificationCancel,{code:"m.unknown",reason:e.toString()});this.promise!==null?this.reject&&this.reject(e):this.promise=Promise.reject(e),this.emit(QTe.Cancel,e)}}verify(){return this.promise?this.promise:(this.promise=new Promise((e,n)=>{this.resolve=(...r)=>{this._done=!0,this.endTimer(),e(...r)},this.reject=r=>{this._done=!0,this.endTimer(),n(r)}}),this.doVerification&&!this.started&&(this.started=!0,this.resetTimer(),new Promise((e,n)=>{var i;((i=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(this.userId))==null?void 0:i.getId())===this.deviceId&&n(new Error("Device ID is the same as the cross-signing ID")),e()}).then(()=>this.doVerification()).then(this.done.bind(this),this.cancel.bind(this))),this.promise)}async verifyKeys(e,n,r){const i=[];for(const[s,o]of Object.entries(n)){const a=s.split(":",2)[1],c=this.baseApis.getStoredDevice(e,a);if(c)r(s,c,o),i.push([a,s,c.keys[s]]);else{const l=this.baseApis.crypto.deviceList.getStoredCrossSigningForUser(e);l&&l.getId()===a?(r(s,Ys.fromStorage({keys:{[s]:a}},a),o),i.push([a,s,a])):k.warn(`verification: Could not find device ${a} to verify`)}}if(!i.length)throw new Error("No devices could be verified");k.info("Verification completed! Marking devices verified: ",i);for(const[s,o,a]of i)await this.baseApis.crypto.setDeviceVerification(e,s,!0,null,null,{[o]:a});e==this.baseApis.credentials.userId&&await this.baseApis.checkKeyBackup()}get events(){}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}var V2=(t=>(t.Sas="m.sas.v1",t.ShowQrCode="m.qr_code.show.v1",t.ScanQrCode="m.qr_code.scan.v1",t.Reciprocate="m.reciprocate.v1",t))(V2||{});const eCe=V2.ShowQrCode,DJ=V2.ScanQrCode,tCe=wb;class J0 extends O4{constructor(){super(...arguments),this.doVerification=async()=>{if(!this.startEvent)throw new Error("It is not currently possible to start verificationwith this method yet.");const{qrCodeData:e}=this.request;if(this.startEvent.getContent().secret!==(e==null?void 0:e.encodedSharedSecret))throw hh();await new Promise((r,i)=>{this.reciprocateQREvent={confirm:r,cancel:()=>i(AJ())},this.emit(tCe.ShowReciprocateQr,this.reciprocateQREvent)});const n={};switch(e==null?void 0:e.mode){case 0:{const r=e.otherUserMasterKey;n[`ed25519:${r}`]=r;break}case 1:{const r=this.request.targetDevice.deviceId;n[`ed25519:${r}`]=e.otherDeviceKey;break}case 2:{const r=e.myMasterKey;n[`ed25519:${r}`]=r;break}}await this.verifyKeys(this.userId,n,(r,i,s)=>{const o=n[r];if(!o)throw hh();if(s!==o)throw k.error("key ID from key info does not match"),hh();for(const a in i.keys){if(!a.startsWith("ed25519"))continue;const c=n[a];if(!c)throw hh();if(i.keys[a]!==c)throw k.error("master key does not match"),hh()}})}}static factory(e,n,r,i,s,o){return new J0(e,n,r,i,s,o)}static get NAME(){return"m.reciprocate.v1"}getReciprocateQrCodeCallbacks(){return this.reciprocateQREvent??null}}const nCe=2,rCe="MATRIX";class pd{constructor(e,n,r,i,s,o){this.mode=e,this.sharedSecret=n,this.otherUserMasterKey=r,this.otherDeviceKey=i,this.myMasterKey=s,this.buffer=o}static async create(e,n){const r=pd.generateSharedSecret(),i=pd.determineMode(e,n);let s=null,o=null,a=null;if(i===0)s=n.getStoredCrossSigningForUser(e.otherUserId).getId("master");else if(i===1)o=await pd.getOtherDeviceKey(e,n);else if(i===2){const u=n.getUserId();a=n.getStoredCrossSigningForUser(u).getId("master")}const c=pd.generateQrData(e,n,i,r,s,o,a),l=pd.generateBuffer(c);return new pd(i,r,s,o,a,l)}get encodedSharedSecret(){return this.sharedSecret}getBuffer(){return this.buffer}static generateSharedSecret(){const e=new Uint8Array(11);return globalThis.crypto.getRandomValues(e),$2(e)}static async getOtherDeviceKey(e,n){const r=n.getUserId(),i=e.targetDevice,s=i.deviceId?n.getStoredDevice(r,i.deviceId):void 0;if(!s)throw new Error("could not find device "+(i==null?void 0:i.deviceId));return s.getFingerprint()}static determineMode(e,n){const r=n.getUserId(),i=e.otherUserId;let s=0;return r===i&&(n.checkUserTrust(r).isCrossSigningVerified()?s=1:s=2),s}static generateQrData(e,n,r,i,s,o,a){const c=n.getUserId(),l=e.channel.transactionId,u={prefix:rCe,version:nCe,mode:r,transactionId:l,firstKeyB64:"",secondKeyB64:"",secretB64:i},d=n.getStoredCrossSigningForUser(c);return r===0?(u.firstKeyB64=d.getId("master"),u.secondKeyB64=s):r===1?(u.firstKeyB64=d.getId("master"),u.secondKeyB64=o):r===2&&(u.firstKeyB64=n.getDeviceEd25519Key(),u.secondKeyB64=a),u}static generateBuffer(e){let n=Buffer.alloc(0);const r=a=>{const c=Buffer.from([a]);n=Buffer.concat([n,c])},i=a=>{const c=Buffer.alloc(2);c.writeInt16BE(a,0),n=Buffer.concat([n,c])},s=(a,c,l=!0)=>{const u=Buffer.from(a,c);l&&i(u.byteLength),n=Buffer.concat([n,u])},o=a=>{const c=xi(a),l=Buffer.from(c);n=Buffer.concat([n,l])};return s(e.prefix,"ascii",!1),r(e.version),r(e.mode),s(e.transactionId,"utf-8"),o(e.firstKeyB64),o(e.secondKeyB64),o(e.secretB64),n}}function iCe(t){return[(t[0]<<5|t[1]>>3)+1e3,((t[1]&7)<<10|t[2]<<2|t[3]>>6)+1e3,((t[3]&63)<<7|t[4]>>1)+1e3]}const y3=Z.KeyVerificationStart,sCe=[Z.KeyVerificationAccept,Z.KeyVerificationKey,Z.KeyVerificationMac];let dw;const oCe=ju("m.mismatched_sas","Mismatched short authentication string"),aCe=ju("m.mismatched_commitment","Mismatched commitment"),cCe=[["🐶","dog"],["🐱","cat"],["🦁","lion"],["🐎","horse"],["🦄","unicorn"],["🐷","pig"],["🐘","elephant"],["🐰","rabbit"],["🐼","panda"],["🐓","rooster"],["🐧","penguin"],["🐢","turtle"],["🐟","fish"],["🐙","octopus"],["🦋","butterfly"],["🌷","flower"],["🌳","tree"],["🌵","cactus"],["🍄","mushroom"],["🌏","globe"],["🌙","moon"],["☁️","cloud"],["🔥","fire"],["🍌","banana"],["🍎","apple"],["🍓","strawberry"],["🌽","corn"],["🍕","pizza"],["🎂","cake"],["❤️","heart"],["😀","smiley"],["🤖","robot"],["🎩","hat"],["👓","glasses"],["🔧","spanner"],["🎅","santa"],["👍","thumbs up"],["☂️","umbrella"],["⌛","hourglass"],["⏰","clock"],["🎁","gift"],["💡","light bulb"],["📕","book"],["✏️","pencil"],["📎","paperclip"],["✂️","scissors"],["🔒","lock"],["🔑","key"],["🔨","hammer"],["☎️","telephone"],["🏁","flag"],["🚂","train"],["🚲","bicycle"],["✈️","aeroplane"],["🚀","rocket"],["🏆","trophy"],["⚽","ball"],["🎸","guitar"],["🎺","trumpet"],["🔔","bell"],["⚓","anchor"],["🎧","headphones"],["📁","folder"],["📌","pin"]];function lCe(t){return[t[0]>>2,(t[0]&3)<<4|t[1]>>4,(t[1]&15)<<2|t[2]>>6,t[2]&63,t[3]>>2,(t[3]&3)<<4|t[4]>>4,(t[4]&15)<<2|t[5]>>6].map(n=>cCe[n])}const aM={decimal:iCe,emoji:lCe};function uCe(t,e){const n={};for(const r of e)r in aM&&(n[r]=aM[r](Array.from(t)));return n}const dCe={"hkdf-hmac-sha256":"calculate_mac","org.matrix.msc3783.hkdf-hmac-sha256":"calculate_mac_fixed_base64","hkdf-hmac-sha256.v2":"calculate_mac_fixed_base64","hmac-sha256":"calculate_mac_long_kdf"};function Dy(t,e){return function(n,r){const i=t[dCe[e]](n,r);return k.log("SAS calculateMAC:",e,[n,r],i),i}}const fCe={"curve25519-hkdf-sha256":function(t,e,n){const r=`${t.baseApis.getUserId()}|${t.baseApis.deviceId}|${t.ourSASPubKey}|`,i=`${t.userId}|${t.deviceId}|${t.theirSASPubKey}|`,s="MATRIX_KEY_VERIFICATION_SAS|"+(t.initiatedByMe?r+i:i+r)+t.channel.transactionId;return e.generate_bytes(s,n)},curve25519:function(t,e,n){const r=`${t.baseApis.getUserId()}${t.baseApis.deviceId}`,i=`${t.userId}${t.deviceId}`,s="MATRIX_KEY_VERIFICATION_SAS"+(t.initiatedByMe?r+i:i+r)+t.channel.transactionId;return e.generate_bytes(s,n)}},cM=["curve25519-hkdf-sha256","curve25519"],lM=["sha256"],uM=["hkdf-hmac-sha256.v2","org.matrix.msc3783.hkdf-hmac-sha256","hkdf-hmac-sha256","hmac-sha256"],NJ=Object.keys(aM),hCe=new Set(cM),pCe=new Set(lM),gCe=new Set(uM),BF=new Set(NJ);function Ny(t,e){return Array.isArray(t)?t.filter(n=>e.has(n)):[]}const mCe=wb;class Qm extends O4{constructor(){super(...arguments),this.doVerification=async()=>{await global.Olm.init(),dw=dw||new global.Olm.Utility,await this.baseApis.downloadKeys([this.userId]);let e=!1;do try{return this.initiatedByMe?await this.doSendVerification():await this.doRespondVerification()}catch(n){if(n instanceof oM)this.startEvent=n.startEvent,e=!0;else throw n}while(e)}}static get NAME(){return V2.Sas}get events(){return sCe}canSwitchStartEvent(e){if(e.getType()!==y3)return!1;const n=e.getContent();return(n==null?void 0:n.method)===Qm.NAME&&!!this.waitingForAccept}async sendStart(){const e=this.channel.completeContent(y3,{method:Qm.NAME,from_device:this.baseApis.deviceId,key_agreement_protocols:cM,hashes:lM,message_authentication_codes:uM,short_authentication_string:NJ});return await this.channel.sendCompleted(y3,e),e}async verifyAndCheckMAC(e,n,r,i){const s=fCe[e](this,r,6),o=new Promise((l,u)=>{this.sasEvent={sas:uCe(s,n),confirm:async()=>{try{await this.sendMAC(r,i),l()}catch(d){u(d)}},cancel:()=>u(AJ()),mismatch:()=>u(oCe())},this.emit(mCe.ShowSas,this.sasEvent)}),[a]=await Promise.all([this.waitForEvent(Z.KeyVerificationMac).then(l=>(this.expectedEvent=Z.KeyVerificationDone,l)),o]),c=a.getContent();await this.checkMAC(r,c,i)}async doSendVerification(){this.waitingForAccept=!0;let e;if(this.startEvent?e=this.channel.completedContentFromEvent(this.startEvent):e=await this.sendStart(),!this.initiatedByMe)throw new oM(this.startEvent);let n;try{n=await this.waitForEvent(Z.KeyVerificationAccept)}finally{this.waitingForAccept=!1}let r=n.getContent();const i=Ny(r.short_authentication_string,BF);if(!(hCe.has(r.key_agreement_protocol)&&pCe.has(r.hash)&&gCe.has(r.message_authentication_code)&&i.length))throw Q1();if(typeof r.commitment!="string")throw ZTe();const s=r.key_agreement_protocol,o=r.message_authentication_code,a=r.commitment,c=new global.Olm.SAS;try{this.ourSASPubKey=c.get_pubkey(),await this.send(Z.KeyVerificationKey,{key:this.ourSASPubKey}),n=await this.waitForEvent(Z.KeyVerificationKey),r=n.getContent();const l=r.key+du.stringify(e);if(dw.sha256(l)!==a)throw aCe();this.theirSASPubKey=r.key,c.set_their_key(r.key),await this.verifyAndCheckMAC(s,i,c,o)}finally{c.free()}}async doRespondVerification(){let e=this.channel.completedContentFromEvent(this.startEvent);const n=Ny(cM,new Set(e.key_agreement_protocols))[0],r=Ny(lM,new Set(e.hashes))[0],i=Ny(uM,new Set(e.message_authentication_codes))[0],s=Ny(e.short_authentication_string,BF);if(!(n!==void 0&&r!==void 0&&i!==void 0&&s.length))throw Q1();const o=new global.Olm.SAS;try{const a=o.get_pubkey()+du.stringify(e);await this.send(Z.KeyVerificationAccept,{key_agreement_protocol:n,hash:r,message_authentication_code:i,short_authentication_string:s,commitment:dw.sha256(a)}),e=(await this.waitForEvent(Z.KeyVerificationKey)).getContent(),this.theirSASPubKey=e.key,o.set_their_key(e.key),this.ourSASPubKey=o.get_pubkey(),await this.send(Z.KeyVerificationKey,{key:this.ourSASPubKey}),await this.verifyAndCheckMAC(n,s,o,i)}finally{o.free()}}sendMAC(e,n){const r={},i=[],s="MATRIX_KEY_VERIFICATION_MAC"+this.baseApis.getUserId()+this.baseApis.deviceId+this.userId+this.deviceId+this.channel.transactionId,o=`ed25519:${this.baseApis.deviceId}`;r[o]=Dy(e,n)(this.baseApis.getDeviceEd25519Key(),s+o),i.push(o);const a=this.baseApis.getCrossSigningId();if(a){const l=`ed25519:${a}`;r[l]=Dy(e,n)(a,s+l),i.push(l)}const c=Dy(e,n)(i.sort().join(","),s+"KEY_IDS");return this.send(Z.KeyVerificationMac,{mac:r,keys:c})}async checkMAC(e,n,r){const i="MATRIX_KEY_VERIFICATION_MAC"+this.userId+this.deviceId+this.baseApis.getUserId()+this.baseApis.deviceId+this.channel.transactionId;if(n.keys!==Dy(e,r)(Object.keys(n.mac).sort().join(","),i+"KEY_IDS"))throw hh();await this.verifyKeys(this.userId,n.mac,(s,o,a)=>{if(a!==Dy(e,r)(o.keys[s],i+s))throw hh()})}getShowSasCallbacks(){return this.sasEvent??null}}function jF(t,e){if(!t.private_key_salt||!t.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return P4(e,t.private_key_salt,t.private_key_iterations,t.private_key_bits)}const HF=5e5;async function M4(t){const e=Zi(32);return{key:await P4(t,e,HF),salt:e,iterations:HF}}const vCe=10*60*1e3,yCe=2*60*1e3,_Ce=3*1e3,Hv="m.key.verification.",Kt=Hv+"request",Qr=Hv+"start",Xa=Hv+"cancel",bCe=Hv+"done",qa=Hv+"ready",Pl=Cf.Unsent,Ua=Cf.Requested,Mc=Cf.Ready,Hl=Cf.Started,Uy=Cf.Cancelled,$y=Cf.Done;class ph extends Fn{constructor(e,n,r){super(),this.channel=e,this.verificationMethods=n,this.client=r,this.eventsByUs=new Map,this.eventsByThem=new Map,this._observeOnly=!1,this.timeoutTimer=null,this._accepting=!1,this._declining=!1,this.verifierHasFinished=!1,this._cancelled=!1,this._chosenMethod=null,this._qrCodeData=null,this.requestReceivedAt=null,this.commonMethods=[],this.cancelOnTimeout=async()=>{try{this.initiatedByMe?await this.cancel({reason:"Other party didn't accept in time",code:"m.timeout"}):await this.cancel({reason:"User didn't accept in time",code:"m.timeout"})}catch(i){k.error("Error while cancelling verification request",i)}},this.channel.request=this,this.setPhase(Pl,!1)}static validateEvent(e,n,r){const i=n.getContent();return!e||!e.startsWith(Hv)?!1:i?(e===Kt||e===qa)&&!Array.isArray(i.methods)?(k.log("VerificationRequest: validateEvent: fail because methods"),!1):(e===Kt||e===qa||e===Qr)&&(typeof i.from_device!="string"||i.from_device.length===0)?(k.log("VerificationRequest: validateEvent: fail because from_device"),!1):!0:(k.log("VerificationRequest: validateEvent: no content"),!1)}get transactionId(){return this.channel.transactionId}get roomId(){return this.channel.roomId}get invalid(){return this.phase===Pl}get requested(){return this.phase===Ua}get cancelled(){return this.phase===Uy}get ready(){return this.phase===Mc}get started(){return this.phase===Hl}get done(){return this.phase===$y}get methods(){return this.commonMethods}get chosenMethod(){return this._chosenMethod}calculateEventTimeout(e){let n=this.channel.getTimestamp(e)+vCe;if(this.requestReceivedAt&&!this.initiatedByMe&&this.phase<=Ua){const r=this.requestReceivedAt+yCe;n=Math.min(n,r)}return Math.max(0,n-Date.now())}get timeout(){const e=this.getEventByEither(Kt);return e?this.calculateEventTimeout(e):0}get requestEvent(){return this.getEventByEither(Kt)}get phase(){return this._phase}get verifier(){return this._verifier}get canAccept(){return SJ(this)}get accepting(){return this._accepting}get declining(){return this._declining}get pending(){return!this.observeOnly&&this._phase!==$y&&this._phase!==Uy}get qrCodeData(){return this._qrCodeData}getQRCodeBytes(){var e;return(e=this._qrCodeData)==null?void 0:e.getBuffer()}async generateQRCode(){return this.getQRCodeBytes()}otherPartySupportsMethod(e,n=!1){if(!n&&!this.ready&&!this.started)return!1;const r=this.eventsByThem.get(Kt)||this.eventsByThem.get(qa);if(!r){if(this.started&&this.initiatedByMe){const o=this.eventsByUs.get(Qr),a=o&&o.getContent(),c=a&&a.method;return e==c}return!1}const i=r.getContent();if(!i)return!1;const{methods:s}=i;return Array.isArray(s)?s.includes(e):!1}get initiatedByMe(){const e=this.eventsByUs.size+this.eventsByThem.size===0;if(this._phase===Pl&&e)return!0;const n=this.eventsByUs.has(Kt),r=this.eventsByThem.has(Kt);if(n&&!r)return!0;if(!n&&r)return!1;const i=this.eventsByUs.has(Qr),s=this.eventsByThem.has(Qr);return!!(i&&!s)}get requestingUserId(){return this.initiatedByMe?this.client.getUserId():this.otherUserId}get receivingUserId(){return this.initiatedByMe?this.otherUserId:this.client.getUserId()}get otherUserId(){return this.channel.userId}get otherDeviceId(){return this.channel.deviceId}get isSelfVerification(){return this.client.getUserId()===this.otherUserId}get cancellingUserId(){const e=this.eventsByUs.get(Xa),n=this.eventsByThem.get(Xa);if(e&&(!n||e.getId()<n.getId()))return e.getSender();if(n)return n.getSender()}get cancellationCode(){const e=this.getEventByEither(Xa);return e?e.getContent().code:null}get observeOnly(){return this._observeOnly}get targetDevice(){const e=this.eventsByThem.get(Kt)||this.eventsByThem.get(qa)||this.eventsByThem.get(Qr),n=e==null?void 0:e.getContent(),r=n==null?void 0:n.from_device;return{userId:this.otherUserId,deviceId:r}}beginKeyVerification(e,n=null){if(!this.observeOnly&&!this._verifier&&(this.phase===Ua||this.phase===Mc||this.phase===Pl&&this.channel.canCreateRequest(Qr))){if(this.commonMethods.length&&!this.commonMethods.includes(e)||(this._verifier=this.createVerifier(e,null,n),!this._verifier))throw Q1();this._chosenMethod=e}return this._verifier}async startVerification(e){const n=this.beginKeyVerification(e);return n.verify(),n}scanQRCode(e){throw new Error("QR code scanning not supported by legacy crypto")}async sendRequest(){if(!this.observeOnly&&this._phase===Pl){const e=[...this.verificationMethods.keys()];await this.channel.send(Kt,{methods:e})}}async cancel({reason:e="User declined",code:n="m.user"}={}){if(!this.observeOnly&&this._phase!==Uy){if(this._declining=!0,this.emit(hd.Change),this._verifier)return this._verifier.cancel(ju(n,e)());this._cancellingUserId=this.client.getUserId(),await this.channel.send(Xa,{code:n,reason:e})}}async accept(){if(!this.observeOnly&&this.phase===Ua&&!this.initiatedByMe){const e=[...this.verificationMethods.keys()];this._accepting=!0,this.emit(hd.Change),await this.channel.send(qa,{methods:e})}}waitFor(e){return new Promise((n,r)=>{const i=()=>{let s=!1;return e(this)?(n(this),s=!0):this.cancelled&&(r(new Error("cancelled")),s=!0),s&&this.off(hd.Change,i),s};i()||this.on(hd.Change,i)})}setPhase(e,n=!0){this._phase=e,n&&this.emit(hd.Change)}getEventByEither(e){return this.eventsByThem.get(e)||this.eventsByUs.get(e)}getEventBy(e,n=!1){return n?this.eventsByThem.get(e):this.eventsByUs.get(e)}calculatePhaseTransitions(){const e=[{phase:Pl}],n=()=>e[e.length-1].phase,r=this.eventsByThem.has(Kt),i=this.getEventBy(Kt,r);i&&e.push({phase:Ua,event:i});const s=i&&this.getEventBy(qa,!r);s&&n()===Ua&&e.push({phase:Mc,event:s});let o;if(s||!i){const l=this.eventsByThem.get(Qr),u=this.eventsByUs.get(Qr);l&&u?o=l.getSender()<u.getSender()?l:u:o=l||u}else o=this.getEventBy(Qr,!r);if(o){const l=n()===Ua&&(i==null?void 0:i.getSender())!==o.getSender(),u=n()===Pl&&this.channel.canCreateRequest(Qr);(l||n()===Mc||u)&&e.push({phase:Hl,event:o})}const a=this.eventsByUs.get(bCe);(this.verifierHasFinished||a&&n()===Hl)&&e.push({phase:$y});const c=this.getEventByEither(Xa);return(this._cancelled||c)&&n()!==$y&&e.push({phase:Uy,event:c}),e}transitionToPhase(e){const{phase:n,event:r}=e;if((n===Ua||n===Mc)&&!this.wasSentByOwnDevice(r)){const i=r.getContent();this.commonMethods=i.methods.filter(s=>this.verificationMethods.has(s))}if(this.observeOnly||(n===Ua||n===Hl||n===Mc)&&this.channel.receiveStartFromOtherDevices&&this.wasSentByOwnUser(r)&&!this.wasSentByOwnDevice(r)&&(this._observeOnly=!0),n===Hl){const{method:i}=r.getContent();!this._verifier&&!this.observeOnly&&(this._verifier=this.createVerifier(i,r),this._verifier?this._chosenMethod=i:this.cancel({code:"m.unknown_method",reason:`Unknown method: ${i}`}))}}applyPhaseTransitions(){const e=this.calculatePhaseTransitions(),n=e.findIndex(i=>i.phase===this.phase),r=e.slice(n+1);for(const i of r)this.transitionToPhase(i);return r}isWinningStartRace(e){if(e.getType()!==Qr)return!1;const n=this._verifier.startEvent;let r;if(this.isSelfVerification)if(n){const s=n.getContent();r=s&&s.from_device}else r=this.client.getDeviceId();else n?r=n.getSender():r=this.client.getUserId();let i;if(this.isSelfVerification){const s=e.getContent();i=s&&s.from_device}else i=e.getSender();return i<r}hasEventId(e){for(const n of this.eventsByUs.values())if(n.getId()===e)return!0;for(const n of this.eventsByThem.values())if(n.getId()===e)return!0;return!1}async handleEvent(e,n,r,i,s){var u;if(this.done||this.cancelled)return;const o=this._observeOnly;if(this.adjustObserveOnly(n,r),!this.observeOnly&&!i&&await this.cancelOnError(e,n)||(s?this.eventsByUs.has(e):this.eventsByThem.has(e)))return;const c=this.phase;this.addEvent(e,n,s);const l=this.applyPhaseTransitions();try{if(this._verifier&&!this.observeOnly){const d=this.isWinningStartRace(n);this._verifier.canSwitchStartEvent(n)&&d?this._verifier.switchStartEvent(n):i||(e===Xa||(u=this._verifier.events)!=null&&u.includes(e))&&this._verifier.handleEvent(n)}if(l.length){r&&l.some(p=>p.phase===Mc)&&this.otherPartySupportsMethod(DJ,!0)&&(this._qrCodeData=await pd.create(this,this.client));const d=l[l.length-1],{phase:f}=d;this.setupTimeout(f),this.setPhase(f)}else this._observeOnly!==o&&this.emit(hd.Change)}finally{k.log(`Verification request ${this.channel.transactionId}: ${e} event with id:${n.getId()}, content:${JSON.stringify(n.getContent())} deviceId:${this.channel.deviceId}, sender:${n.getSender()}, isSentByUs:${s}, isLiveEvent:${r}, isRemoteEcho:${i}, phase:${c}=>${this.phase}, observeOnly:${o}=>${this._observeOnly}`)}}setupTimeout(e){!this.timeoutTimer&&!this.observeOnly&&e===Ua&&(this.timeoutTimer=setTimeout(this.cancelOnTimeout,this.timeout)),this.timeoutTimer&&(e===Hl||e===Mc||e===$y||e===Uy)&&(clearTimeout(this.timeoutTimer),this.timeoutTimer=null)}async cancelOnError(e,n){if(e===Qr){const s=n.getContent().method;if(!this.verificationMethods.has(s))return await this.cancel(sM(Q1())),!0}const r=e===Kt&&this.phase!==Pl,i=e===qa&&this.phase!==Ua&&this.phase!==Hl;if(this.phase!==Pl&&(r||i)){k.warn(`Cancelling, unexpected ${e} verification event from ${n.getSender()}`);const s=`Unexpected ${e} event in phase ${this.phase}`;return await this.cancel(sM(LJ({reason:s}))),!0}return!1}adjustObserveOnly(e,n=!1){n||(this._observeOnly=!0),this.calculateEventTimeout(e)<_Ce&&(this._observeOnly=!0)}addEvent(e,n,r=!1){if(r?this.eventsByUs.set(e,n):this.eventsByThem.set(e,n),e===Kt){for(const[i,s]of this.eventsByThem.entries())s.getSender()!==this.otherUserId&&this.eventsByThem.delete(i);this.requestReceivedAt=Date.now()}}createVerifier(e,n=null,r=null){r||(r=this.targetDevice);const{userId:i,deviceId:s}=r,o=this.verificationMethods.get(e);if(!o){k.warn("could not find verifier constructor for method",e);return}return new o(this.channel,this.client,i,s,n,this)}wasSentByOwnUser(e){return(e==null?void 0:e.getSender())===this.client.getUserId()}wasSentByOwnDevice(e){if(!this.wasSentByOwnUser(e))return!1;const n=e.getContent();return!(!n||n.from_device!==this.client.getDeviceId())}onVerifierCancelled(){this._cancelled=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}onVerifierFinished(){this.channel.send(Z.KeyVerificationDone,{}),this.verifierHasFinished=!0;const e=this.applyPhaseTransitions();e.length&&this.setPhase(e[e.length-1].phase)}getEventFromOtherParty(e){return this.eventsByThem.get(e)}}const KF=Z.RoomMessage,VF="m.reference",qF="m.relates_to";class qi{constructor(e,n,r){this.client=e,this.roomId=n,this.userId=r}get receiveStartFromOtherDevices(){return!0}get transactionId(){return this.requestEventId}static getOtherPartyUserId(e,n){if(qi.getEventType(e)!==Kt)return;const i=n.getUserId(),s=e.getSender(),a=e.getContent().to;if(s===i)return a;if(a===i)return s}getTimestamp(e){return e.getTs()}static canCreateRequest(e){return e===Kt}canCreateRequest(e){return qi.canCreateRequest(e)}static getTransactionId(e){if(qi.getEventType(e)===Kt)return e.getId();{const n=e.getRelation();if((n==null?void 0:n.rel_type)===VF)return n.event_id}}static validateEvent(e,n){const r=qi.getTransactionId(e);if(typeof r!="string"||r.length===0)return!1;const i=qi.getEventType(e),s=e.getContent();if(i===Kt){if(!s||typeof s.to!="string"||!s.to.length)return k.log("InRoomChannel: validateEvent: no valid to "+s.to),!1;if(!qi.getOtherPartyUserId(e,n))return k.log(`InRoomChannel: validateEvent: not directed to or sent by me: ${e.getSender()}, ${s.to}`),!1}return ph.validateEvent(i,e,n)}static getEventType(e){const n=e.getType();if(n===KF){const r=e.getContent();if(r){const{msgtype:i}=r;if(i===Kt)return Kt}}return n&&n!==Kt?n:""}async handleEvent(e,n,r=!1){if(n.hasEventId(e.getId()))return;const i=qi.getEventType(e);if(e.getRoomId()!==this.roomId)return;if(!this.userId){const u=qi.getOtherPartyUserId(e,this.client);u&&(this.userId=u)}const s=this.client.getUserId(),o=e.getSender();if(this.userId&&o!==s&&o!==this.userId){k.log(`InRoomChannel: ignoring verification event from non-participating sender ${o}`);return}this.requestEventId||(this.requestEventId=qi.getTransactionId(e));const a=!!e.getTxnId(),c=!!e.getUnsigned().transaction_id,l=e.getSender()===this.client.getUserId();return n.handleEvent(i,e,r,a||c,l)}completedContentFromEvent(e){const n=Object.assign({},e.getContent());return n[qF]=e.getRelation(),n}completeContent(e,n){return n=Object.assign({},n),(e===Kt||e===qa||e===Qr)&&(n.from_device=this.client.getDeviceId()),e===Kt?n={body:this.client.getUserId()+" is requesting to verify your key, but your client does not support in-chat key verification.  You will need to use legacy key verification to verify keys.",msgtype:Kt,to:this.userId,from_device:n.from_device,methods:n.methods}:n[qF]={rel_type:VF,event_id:this.transactionId},n}send(e,n){const r=this.completeContent(e,n);return this.sendCompleted(e,r)}async sendCompleted(e,n){let r=e;e===Kt&&(r=KF);const i=await this.client.sendEvent(this.roomId,r,n);e===Kt&&(this.requestEventId=i.event_id)}}class SCe{constructor(){this.requestsByRoomId=new Map}getRequest(e){const n=e.getRoomId(),r=qi.getTransactionId(e);return this.getRequestByTxnId(n,r)}getRequestByChannel(e){return this.getRequestByTxnId(e.roomId,e.transactionId)}getRequestByTxnId(e,n){const r=this.requestsByRoomId.get(e);if(r)return r.get(n)}setRequest(e,n){this.doSetRequest(e.getRoomId(),qi.getTransactionId(e),n)}setRequestByChannel(e,n){this.doSetRequest(e.roomId,e.transactionId,n)}doSetRequest(e,n,r){let i=this.requestsByRoomId.get(e);i||(i=new Map,this.requestsByRoomId.set(e,i)),i.set(n,r)}removeRequest(e){const n=e.getRoomId(),r=this.requestsByRoomId.get(n);r&&(r.delete(qi.getTransactionId(e)),r.size===0&&this.requestsByRoomId.delete(n))}findRequestInProgress(e,n){const r=this.requestsByRoomId.get(e);if(r){for(const i of r.values())if(i.pending&&(n===void 0||i.requestingUserId===n))return i}}}class Ki{constructor(e,n,r,i,s){this.client=e,this.userId=n,this.devices=r,this.transactionId=i,this.deviceId=s}isToDevices(e){if(e.length===this.devices.length){for(const n of e)if(!this.devices.includes(n))return!1;return!0}else return!1}static getEventType(e){return e.getType()}static getTransactionId(e){const n=e.getContent();return n&&n.transaction_id}static canCreateRequest(e){return e===Kt||e===Qr}canCreateRequest(e){return Ki.canCreateRequest(e)}static validateEvent(e,n){if(e.isCancelled())return k.warn("Ignoring flagged verification request from "+e.getSender()),!1;const r=e.getContent();if(!r)return k.warn("ToDeviceChannel.validateEvent: invalid: no content"),!1;if(!r.transaction_id)return k.warn("ToDeviceChannel.validateEvent: invalid: no transaction_id"),!1;const i=e.getType();if(i===Kt){if(!Number.isFinite(r.timestamp))return k.warn("ToDeviceChannel.validateEvent: invalid: no timestamp"),!1;if(e.getSender()===n.getUserId()&&r.from_device==n.getDeviceId())return k.warn("ToDeviceChannel.validateEvent: invalid: from own device"),!1}return ph.validateEvent(i,e,n)}getTimestamp(e){const n=e.getContent();return n&&n.timestamp}async handleEvent(e,n,r=!1){const i=e.getType(),s=e.getContent();if(i===Kt||i===qa||i===Qr){this.transactionId||(this.transactionId=s.transaction_id);const l=s.from_device;if(!this.deviceId&&this.devices.includes(l)&&(this.deviceId=l),!this.deviceId||this.deviceId!==l){const u=this.completeContent(Xa,sM(LJ()));return this.sendToDevices(Xa,u,[l])}}const o=n.phase===Hl||n.phase===Mc;await n.handleEvent(e.getType(),e,r,!1,!1);const a=n.phase===Hl||n.phase===Mc;if((i===Qr||i===qa)&&!o&&a&&this.deviceId){const l=this.devices.filter(u=>u!==this.deviceId&&u!==this.client.getDeviceId());if(l.length){const u=this.completeContent(Xa,{code:"m.accepted",reason:"Verification request accepted by another device"});await this.sendToDevices(Xa,u,l)}}}completedContentFromEvent(e){return e.getContent()}completeContent(e,n){return n=Object.assign({},n),this.transactionId&&(n.transaction_id=this.transactionId),(e===Kt||e===qa||e===Qr)&&(n.from_device=this.client.getDeviceId()),e===Kt&&(n.timestamp=Date.now()),n}send(e,n={}){(e===Kt||e===Qr)&&!this.transactionId&&(this.transactionId=Ki.makeTransactionId());const r=this.completeContent(e,n);return this.sendCompleted(e,r)}async sendCompleted(e,n){let r;e===Kt||e===Xa&&!this.deviceId?r=await this.sendToDevices(e,n,this.devices):r=await this.sendToDevices(e,n,[this.deviceId]);const i=new oi({sender:this.client.getUserId(),content:n,type:e});return await this.request.handleEvent(e,i,!0,!0,!0),r}async sendToDevices(e,n,r){if(r.length){const i=new Map;for(const s of r)i.set(s,n);await this.client.sendToDevice(e,new Map([[this.userId,i]]))}}static makeTransactionId(){return Zi(32)}}class wCe{constructor(){this.requestsByUserId=new Map}getRequest(e){return this.getRequestBySenderAndTxnId(e.getSender(),Ki.getTransactionId(e))}getRequestByChannel(e){return this.getRequestBySenderAndTxnId(e.userId,e.transactionId)}getRequestBySenderAndTxnId(e,n){const r=this.requestsByUserId.get(e);if(r)return r.get(n)}setRequest(e,n){this.setRequestBySenderAndTxnId(e.getSender(),Ki.getTransactionId(e),n)}setRequestByChannel(e,n){this.setRequestBySenderAndTxnId(e.userId,e.transactionId,n)}setRequestBySenderAndTxnId(e,n,r){let i=this.requestsByUserId.get(e);i||(i=new Map,this.requestsByUserId.set(e,i)),i.set(n,r)}removeRequest(e){const n=e.getSender(),r=this.requestsByUserId.get(n);r&&(r.delete(Ki.getTransactionId(e)),r.size===0&&this.requestsByUserId.delete(n))}findRequestInProgress(e,n){const r=this.requestsByUserId.get(e);if(r){for(const i of r.values())if(i.pending&&i.channel.isToDevices(n))return i}}getRequestsInProgress(e){const n=this.requestsByUserId.get(e);return n?Array.from(n.values()).filter(r=>r.pending):[]}}class bC extends O4{constructor(){super(...arguments),this.doVerification=async()=>{throw new Error("Verification is not possible with this method")}}static factory(e,n,r,i,s,o){return new bC(e,n,r,i,s,o)}static get NAME(){return"org.matrix.illegal_method"}}const zE="org.matrix.msc2697.v1.olm.libolm_pickle",GF=7*24*60*60*1e3;class ECe{constructor(e){this.crypto=e,this.inProgress=!1,this.getDehydrationKeyFromCache()}getDehydrationKeyFromCache(){return this.crypto.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],e=>{this.crypto.cryptoStore.getSecretStorePrivateKey(e,async n=>{if(n){const{key:r,keyInfo:i,deviceDisplayName:s,time:o}=n,a=Buffer.from(this.crypto.olmDevice.pickleKey),c=await Eb(r,a,zE);this.key=xi(c),this.keyInfo=i,this.deviceDisplayName=s;const l=Date.now(),u=Math.max(1,o+GF-l);this.timeoutId=global.setTimeout(this.dehydrateDevice.bind(this),u)}},"dehydration")})}async setKeyAndQueueDehydration(e,n={},r){await this.setKey(e,n,r)||this.dehydrateDevice()}async setKey(e,n={},r){if(!e){this.timeoutId&&(global.clearTimeout(this.timeoutId),this.timeoutId=void 0),await this.crypto.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],s=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(s,"dehydration",null)}),this.key=void 0,this.keyInfo=void 0;return}let i=!!this.key&&e.length==this.key.length;for(let s=0;i&&s<e.length;s++)e[s]!=this.key[s]&&(i=!1);return i||(this.key=e,this.keyInfo=n,this.deviceDisplayName=r),i}async dehydrateDevice(){if(this.inProgress){k.log("Dehydration already in progress -- not starting new dehydration");return}this.inProgress=!0,this.timeoutId&&(global.clearTimeout(this.timeoutId),this.timeoutId=void 0);try{const e=Buffer.from(this.crypto.olmDevice.pickleKey),n=await jv(hs(this.key),e,zE);await this.crypto.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],S=>{this.crypto.cryptoStore.storeSecretStorePrivateKey(S,"dehydration",{keyInfo:this.keyInfo,key:n,deviceDisplayName:this.deviceDisplayName,time:Date.now()})}),k.log("Attempting to dehydrate device"),k.log("Creating account");const r=new global.Olm.Account;r.create();const i=JSON.parse(r.identity_keys()),s=r.max_number_of_one_time_keys();r.generate_one_time_keys(s/2),r.generate_fallback_key();const o=JSON.parse(r.one_time_keys()),a=JSON.parse(r.fallback_key());r.mark_keys_as_published();const c=r.pickle(new Uint8Array(this.key)),l={algorithm:zE,account:c};this.keyInfo.passphrase&&(l.passphrase=this.keyInfo.passphrase),k.log("Uploading account to server");const d=(await this.crypto.baseApis.http.authedRequest(oe.Put,"/dehydrated_device",void 0,{device_data:l,initial_device_display_name:this.deviceDisplayName},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).device_id;k.log("Preparing device keys",d);const f={algorithms:this.crypto.supportedAlgorithms,device_id:d,user_id:this.crypto.userId,keys:{[`ed25519:${d}`]:i.ed25519,[`curve25519:${d}`]:i.curve25519}},p=r.sign(du.stringify(f));f.signatures={[this.crypto.userId]:{[`ed25519:${d}`]:p}},this.crypto.crossSigningInfo.getId("self_signing")&&await this.crypto.crossSigningInfo.signObject(f,"self_signing"),k.log("Preparing one-time keys");const m={};for(const[S,_]of Object.entries(o.curve25519)){const w={key:_},T=r.sign(du.stringify(w));w.signatures={[this.crypto.userId]:{[`ed25519:${d}`]:T}},m[`signed_curve25519:${S}`]=w}k.log("Preparing fallback keys");const v={};for(const[S,_]of Object.entries(a.curve25519)){const w={key:_,fallback:!0},T=r.sign(du.stringify(w));w.signatures={[this.crypto.userId]:{[`ed25519:${d}`]:T}},v[`signed_curve25519:${S}`]=w}return k.log("Uploading keys to server"),await this.crypto.baseApis.http.authedRequest(oe.Post,"/keys/upload/"+encodeURI(d),void 0,{device_keys:f,one_time_keys:m,"org.matrix.msc2732.fallback_keys":v}),k.log("Done dehydrating"),this.timeoutId=global.setTimeout(this.dehydrateDevice.bind(this),GF),d}finally{this.inProgress=!1}}stop(){this.timeoutId&&(global.clearTimeout(this.timeoutId),this.timeoutId=void 0)}}const TCe=200,CCe=5e3;class Mh{constructor(e,n){this.baseApis=e,this.getKey=n,this.sessionLastCheckAttemptedTime={},this.clientRunning=!0,this.checkedForBackup=!1,this.sendingBackups=!1}stop(){this.clientRunning=!1}get version(){return this.backupInfo&&this.backupInfo.version}static checkBackupVersion(e){const n=_3[e.algorithm];if(!n)throw new Error("Unknown backup algorithm: "+e.algorithm);if(typeof e.auth_data!="object")throw new Error("Invalid backup data returned");return n.checkBackupVersion(e)}static makeAlgorithm(e,n){const r=_3[e.algorithm];if(!r)throw new Error("Unknown backup algorithm");return r.init(e.auth_data,n)}async enableKeyBackup(e){this.backupInfo=e,this.algorithm&&this.algorithm.free(),this.algorithm=await Mh.makeAlgorithm(e,this.getKey),this.baseApis.emit(Zt.KeyBackupStatus,!0),this.scheduleKeyBackupSend()}disableKeyBackup(){this.algorithm&&this.algorithm.free(),this.algorithm=void 0,this.backupInfo=void 0,this.baseApis.emit(Zt.KeyBackupStatus,!1)}getKeyBackupEnabled(){return this.checkedForBackup?!!this.algorithm:null}async prepareKeyBackupVersion(e,n){const r=n?_3[n]:ICe;if(!r)throw new Error("Unknown backup algorithm");const[i,s]=await r.prepare(e),o=yC(i);return{algorithm:r.algorithmName,auth_data:s,recovery_key:o,privateKey:i}}async createKeyBackupVersion(e){this.algorithm=await Mh.makeAlgorithm(e,this.getKey)}async deleteAllKeyBackupVersions(){var n,r;let e=((n=await this.baseApis.getKeyBackupVersion())==null?void 0:n.version)??null;for(;e!=null;)await this.deleteKeyBackupVersion(e),this.disableKeyBackup(),e=((r=await this.baseApis.getKeyBackupVersion())==null?void 0:r.version)??null}async deleteKeyBackupVersion(e){const n=Me("/room_keys/version/$version",{$version:e});await this.baseApis.http.authedRequest(oe.Delete,n,void 0,void 0,{prefix:Nn.V3})}async checkAndStart(){if(k.log("Checking key backup status..."),this.baseApis.isGuest())return k.log("Skipping key backup check since user is guest"),this.checkedForBackup=!0,null;let e;try{e=await this.baseApis.getKeyBackupVersion()??void 0}catch(r){return k.log("Error checking for active key backup",r),r.httpStatus===404&&(this.checkedForBackup=!0),null}this.checkedForBackup=!0;const n=await this.isKeyBackupTrusted(e);return n.usable&&!this.backupInfo?(k.log(`Found usable key backup v${e.version}: enabling key backups`),await this.enableKeyBackup(e)):!n.usable&&this.backupInfo?(k.log("No usable key backup: disabling key backup"),this.disableKeyBackup()):!n.usable&&!this.backupInfo?k.log("No usable key backup: not enabling key backup"):n.usable&&this.backupInfo&&(e.version!==this.backupInfo.version?(k.log(`On backup version ${this.backupInfo.version} but found version ${e.version}: switching.`),this.disableKeyBackup(),await this.enableKeyBackup(e),await this.scheduleAllGroupSessionsForBackup()):k.log(`Backup version ${e.version} still current`)),{backupInfo:e,trustInfo:n}}async checkKeyBackup(){return this.checkedForBackup=!1,this.checkAndStart()}async queryKeyBackupRateLimited(e,n){if(!this.backupInfo)return;const r=new Date().getTime();(!this.sessionLastCheckAttemptedTime[n]||r-this.sessionLastCheckAttemptedTime[n]>CCe)&&(this.sessionLastCheckAttemptedTime[n]=r,await this.baseApis.restoreKeyBackupWithCache(e,n,this.backupInfo,{}))}async isKeyBackupTrusted(e){const n={usable:!1,trusted_locally:!1,sigs:[]};if(!e||!e.algorithm||!e.auth_data||!e.auth_data.signatures)return k.info(`Key backup is absent or missing required data: ${JSON.stringify(e)}`),n;const r=this.baseApis.getUserId(),i=await this.baseApis.crypto.getSessionBackupPrivateKey();if(i){let o=null;try{o=await Mh.makeAlgorithm(e,async()=>i),await o.keyMatches(i)&&(k.info("Backup is trusted locally"),n.trusted_locally=!0)}catch{}finally{o==null||o.free()}}const s=e.auth_data.signatures[r]||{};for(const o of Object.keys(s)){const a=o.split(":");if(a[0]!=="ed25519"){k.log("Ignoring unknown signature type: "+a[0]);continue}const c={deviceId:a[1]},l=this.baseApis.crypto.crossSigningInfo.getId();if(l===c.deviceId){c.crossSigningId=!0;try{await Zm(this.baseApis.crypto.olmDevice,e.auth_data,r,c.deviceId,l),c.valid=!0}catch(d){k.warn("Bad signature from cross signing key "+l,d),c.valid=!1}n.sigs.push(c);continue}const u=this.baseApis.crypto.deviceList.getStoredDevice(r,c.deviceId);if(u){c.device=u,c.deviceTrust=this.baseApis.checkDeviceTrust(r,c.deviceId);try{await Zm(this.baseApis.crypto.olmDevice,e.auth_data,r,u.deviceId,u.getFingerprint()),c.valid=!0}catch(d){k.info("Bad signature from key ID "+o+" userID "+this.baseApis.getUserId()+" device ID "+u.deviceId+" fingerprint: "+u.getFingerprint(),e.auth_data,d),c.valid=!1}}else c.valid=null,k.info("Ignoring signature from unknown key "+o);n.sigs.push(c)}return n.usable=n.sigs.some(o=>{var a;return o.valid&&(o.device&&((a=o.deviceTrust)==null?void 0:a.isVerified())||o.crossSigningId)}),n}async scheduleKeyBackupSend(e=1e4){if(k.debug(`Key backup: scheduleKeyBackupSend currentSending:${this.sendingBackups} delay:${e}`),!this.sendingBackups){this.sendingBackups=!0;try{const n=Math.random()*e;if(await Jm(n),!this.clientRunning){this.sendingBackups=!1;return}let r=0;for(;;){if(!this.algorithm)return;try{if(await this.backupPendingKeys(TCe)===0){this.sendingBackups=!1;return}r=0}catch(i){if(r++,k.log("Key backup request failed",i),i instanceof Ii){const s=i.data.errcode;if(s=="M_NOT_FOUND"||s=="M_WRONG_ROOM_KEYS_VERSION"){this.sendingBackups=!1,this.baseApis.crypto.emit(Zt.KeyBackupFailed,s),await this.checkKeyBackup();return}}}if(r&&await Jm(1e3*Math.pow(2,Math.min(r-1,4))),!this.clientRunning){k.debug("Key backup send loop aborted, client stopped"),this.sendingBackups=!1;return}}}catch(n){k.log(`Backup loop failed ${n}`),this.sendingBackups=!1}}}async backupPendingKeys(e){const n=await this.baseApis.crypto.cryptoStore.getSessionsNeedingBackup(e);if(!n.length)return 0;let r=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();this.baseApis.crypto.emit(Zt.KeyBackupSessionsRemaining,r);const i={};for(const s of n){const o=s.sessionData.room_id;nl(i,o,i[o]||{sessions:{}});const a=this.baseApis.crypto.olmDevice.exportInboundGroupSession(s.senderKey,s.sessionId,s.sessionData);a.algorithm=Ks;const c=(a.forwarding_curve25519_key_chain||[]).length,l=this.baseApis.crypto.deviceList.getUserByIdentityKey(Ks,s.senderKey),u=this.baseApis.crypto.deviceList.getDeviceByIdentityKey(Ks,s.senderKey)??void 0,d=this.baseApis.crypto.checkDeviceInfoTrust(l,u).isVerified();nl(i[o].sessions,s.sessionId,{first_message_index:a.first_known_index,forwarded_count:c,is_verified:d,session_data:await this.algorithm.encryptSession(a)})}return await this.baseApis.sendKeyBackup(void 0,void 0,this.backupInfo.version,{rooms:i}),await this.baseApis.crypto.cryptoStore.unmarkSessionsNeedingBackup(n),r=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup(),this.baseApis.crypto.emit(Zt.KeyBackupSessionsRemaining,r),n.length}async backupGroupSession(e,n){await this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([{senderKey:e,sessionId:n}]),this.backupInfo&&this.scheduleKeyBackupSend()}async scheduleAllGroupSessionsForBackup(){await this.flagAllGroupSessionsForBackup(),this.scheduleKeyBackupSend(0)}async flagAllGroupSessionsForBackup(){await this.baseApis.crypto.cryptoStore.doTxn("readwrite",[Be.STORE_INBOUND_GROUP_SESSIONS,Be.STORE_BACKUP],n=>{this.baseApis.crypto.cryptoStore.getAllEndToEndInboundGroupSessions(n,r=>{r!==null&&this.baseApis.crypto.cryptoStore.markSessionsNeedingBackup([r],n)})});const e=await this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup();return this.baseApis.emit(Zt.KeyBackupSessionsRemaining,e),e}countSessionsNeedingBackup(){return this.baseApis.crypto.cryptoStore.countSessionsNeedingBackup()}}const w2=class w2{constructor(e,n,r){this.authData=e,this.publicKey=n,this.getKey=r}static async init(e,n){if(!e||!("public_key"in e))throw new Error("auth_data missing required information");const r=new global.Olm.PkEncryption;return r.set_recipient_key(e.public_key),new w2(e,r,n)}static async prepare(e){const n=new global.Olm.PkDecryption;try{const r={};if(!e)r.public_key=n.generate_key();else if(e instanceof Uint8Array)r.public_key=n.init_with_private_key(e);else{const s=await M4(e);r.private_key_salt=s.salt,r.private_key_iterations=s.iterations,r.public_key=n.init_with_private_key(s.key)}return new global.Olm.PkEncryption().set_recipient_key(r.public_key),[n.get_private_key(),r]}finally{n.free()}}static checkBackupVersion(e){if(!("public_key"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!0}async encryptSession(e){const n=Object.assign({},e);return delete n.session_id,delete n.room_id,delete n.first_known_index,this.publicKey.encrypt(JSON.stringify(n))}async decryptSessions(e){const n=await this.getKey(),r=new global.Olm.PkDecryption;try{if(r.init_with_private_key(n)!==this.authData.public_key)throw new Ii({errcode:Qh.RESTORE_BACKUP_ERROR_BAD_KEY});const s=[];for(const[o,a]of Object.entries(e))try{const c=JSON.parse(r.decrypt(a.session_data.ephemeral,a.session_data.mac,a.session_data.ciphertext));c.session_id=o,s.push(c)}catch(c){k.log("Failed to decrypt megolm session from backup",c,a)}return s}finally{r.free()}}async keyMatches(e){const n=new global.Olm.PkDecryption;let r;try{r=n.init_with_private_key(e)}finally{n.free()}return r===this.authData.public_key}free(){this.publicKey.free()}};w2.algorithmName="m.megolm_backup.v1.curve25519-aes-sha2";let X0=w2;function kCe(t){const e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),e}const RCe=new or("m.megolm_backup.v1.aes-hmac-sha2","org.matrix.msc3270.v1.aes-hmac-sha2"),E2=class E2{constructor(e,n){this.authData=e,this.key=n}static async init(e,n){if(!e)throw new Error("auth_data missing");const r=await n();if(e.mac){const{mac:i}=await dm(r,e.iv);if(e.mac.replace(/=+$/g,"")!==i.replace(/=+/g,""))throw new Error("Key does not match")}return new E2(e,r)}static async prepare(e){let n;const r={};if(!e)n=kCe(32);else if(e instanceof Uint8Array)n=new Uint8Array(e);else{const o=await M4(e);r.private_key_salt=o.salt,r.private_key_iterations=o.iterations,n=o.key}const{iv:i,mac:s}=await dm(n);return r.iv=i,r.mac=s,[n,r]}static checkBackupVersion(e){if(!("iv"in e.auth_data&&"mac"in e.auth_data))throw new Error("Invalid backup data returned")}get untrusted(){return!1}encryptSession(e){const n=Object.assign({},e);return delete n.session_id,delete n.room_id,delete n.first_known_index,jv(JSON.stringify(n),this.key,e.session_id)}async decryptSessions(e){const n=[];for(const[r,i]of Object.entries(e))try{const s=JSON.parse(await Eb(i.session_data,this.key,r));s.session_id=r,n.push(s)}catch(s){k.log("Failed to decrypt megolm session from backup",s,i)}return n}async keyMatches(e){if(this.authData.mac){const{mac:n}=await dm(e,this.authData.iv);return this.authData.mac.replace(/=+$/g,"")===n.replace(/=+/g,"")}else return!0}free(){this.key.fill(0)}};E2.algorithmName=RCe.name;let SC=E2;const _3={[X0.algorithmName]:X0,[SC.algorithmName]:SC},ICe=X0;function zF(t){return{trusted:t.usable,matchesDecryptionKey:t.trusted_locally??!1}}class xCe{constructor(e){this.algorithm=e,this.sourceTrusted=!e.untrusted}free(){this.algorithm.free()}async decryptSessions(e){return await this.algorithm.decryptSessions(e)}}class PCe{constructor(e){this.cryptoStore=e,this.roomEncryption={}}async init(){await this.cryptoStore.doTxn("readwrite",[Be.STORE_ROOMS],e=>{this.cryptoStore.getEndToEndRooms(e,n=>{this.roomEncryption=n})})}getRoomEncryption(e){return this.roomEncryption[e]||null}isRoomEncrypted(e){return!!this.getRoomEncryption(e)}async setRoomEncryption(e,n){this.roomEncryption[e]=n,await this.cryptoStore.doTxn("readwrite",[Be.STORE_ROOMS],r=>{this.cryptoStore.storeEndToEndRoom(e,n,r)})}}function WF(t,e){const n=new Map(Object.entries(t.keys)),r=t.getDisplayName()||void 0,i=new Map;if(t.signatures)for(const s in t.signatures)i.set(s,new Map(Object.entries(t.signatures[s])));return new cJ({deviceId:t.deviceId,userId:e,keys:n,algorithms:t.algorithms,verified:t.verified,signatures:i,displayName:r})}const Ol=Ys.DeviceVerification,b3={[J0.NAME]:J0,[Qm.NAME]:Qm,[eCe]:bC,[DJ]:bC};J0.NAME,Qm.NAME;function UJ(){return!!globalThis.Olm}const OCe=60*60*1e3,MCe=5*60*1e3;var Zt=(t=>(t.DeviceVerificationChanged="deviceVerificationChanged",t.UserTrustStatusChanged="userTrustStatusChanged",t.UserCrossSigningUpdated="userCrossSigningUpdated",t.RoomKeyRequest="crypto.roomKeyRequest",t.RoomKeyRequestCancellation="crypto.roomKeyRequestCancellation",t.KeyBackupStatus="crypto.keyBackupStatus",t.KeyBackupFailed="crypto.keyBackupFailed",t.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",t.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",t.KeySignatureUploadFailure="crypto.keySignatureUploadFailure",t.VerificationRequest="crypto.verification.request",t.VerificationRequestReceived="crypto.verificationRequestReceived",t.Warning="crypto.warning",t.WillUpdateDevices="crypto.willUpdateDevices",t.DevicesUpdated="crypto.devicesUpdated",t.KeysChanged="crossSigning.keysChanged",t.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",t))(Zt||{});class wC extends Fn{constructor(e,n,r,i,s,o){if(super(),this.baseApis=e,this.userId=n,this.deviceId=r,this.clientStore=i,this.cryptoStore=s,this.trustCrossSignedDevices=!0,this.lastOneTimeKeyCheck=null,this.oneTimeKeyCheckInProgress=!1,this.roomEncryptors=new Map,this.roomDecryptors=new Map,this.deviceKeys={},this.globalBlacklistUnverifiedDevices=!1,this.globalErrorOnUnknownDevices=!0,this.receivedRoomKeyRequests=[],this.receivedRoomKeyRequestCancellations=[],this.processingRoomKeyRequests=!1,this.lazyLoadMembers=!1,this.roomDeviceTrackingState={},this.forceNewSessionRetryTime=new fr(()=>new fr(()=>0)),this.sendKeyRequestsImmediately=!1,this.onDeviceListUserCrossSigningUpdated=async l=>{if(l===this.userId){const u=this.deviceList.getStoredCrossSigningForUser(l),d=u?u.getId():null,f=this.crossSigningInfo.getId();f&&d&&!(f!==d)?await this.checkOwnCrossSigningTrust():(this.storeTrustedSelfKeys(null),this.emit("crossSigning.keysChanged",{}),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(l)))}else{await this.checkDeviceVerifications(l);const u=this.deviceList.getStoredCrossSigningForUser(l);u&&(u.updateCrossSigningVerifiedBefore(this.checkUserTrust(l).isCrossSigningVerified()),this.deviceList.setRawStoredCrossSigningForUser(l,u.toStorage())),this.emit("userTrustStatusChanged",l,this.checkUserTrust(l))}},this.onMembership=(l,u,d)=>{try{this.onRoomMembership(l,u,d)}catch(f){k.error("Error handling membership change:",f)}},this.onToDeviceEvent=l=>{try{k.log(`received to-device ${l.getType()} from: ${l.getSender()} id: ${l.getContent()[vs]}`),l.getType()=="m.room_key"||l.getType()=="m.forwarded_room_key"?this.onRoomKeyEvent(l):l.getType()=="m.room_key_request"?this.onRoomKeyRequestEvent(l):l.getType()==="m.secret.request"?this.secretStorage.onRequestReceived(l):l.getType()==="m.secret.send"?this.secretStorage.onSecretReceived(l):l.getType()==="m.room_key.withheld"?this.onRoomKeyWithheldEvent(l):l.getContent().transaction_id?this.onKeyVerificationMessage(l):l.getContent().msgtype==="m.bad.encrypted"?this.onToDeviceBadEncrypted(l):(l.isBeingDecrypted()||l.shouldAttemptDecryption())&&(l.isBeingDecrypted()||l.attemptDecryption(this),l.once(sn.Decrypted,u=>{this.onToDeviceEvent(u)}))}catch(u){k.error("Error handling toDeviceEvent:",u)}},this.onTimelineEvent=(l,u,d,f,{liveEvent:p=!0}={})=>{if(!qi.validateEvent(l,this.baseApis))return;const m=v=>{const S=new qi(this.baseApis,v.getRoomId());return new ph(S,this.verificationMethods,this.baseApis)};this.handleVerificationEvent(l,this.inRoomVerificationRequests,m,p)},k.debug("Crypto: initialising roomlist..."),this.roomList=new PCe(s),this.reEmitter=new Bv(this),o){this.verificationMethods=new Map;for(const l of o)typeof l=="string"?b3[l]&&this.verificationMethods.set(l,b3[l]):l.NAME?this.verificationMethods.set(l.NAME,l):k.warn(`Excluding unknown verification method ${l}`)}else this.verificationMethods=new Map(Object.entries(b3));this.backupManager=new Mh(e,async()=>{const l=await this.getSessionBackupPrivateKey();if(l)return l;const u=await this.secretStorage.get("m.megolm_backup.v1");if(u){const d=WE(u);if(d){const f=await this.secretStorage.getKey();await this.secretStorage.store("m.megolm_backup.v1",d,[f[0]])}return xi(d||u)}if(this.baseApis.cryptoCallbacks&&this.baseApis.cryptoCallbacks.getBackupKey)return this.baseApis.cryptoCallbacks.getBackupKey();throw new Error("Unable to get private key")}),this.olmDevice=new LF(s),this.deviceList=new xTe(e,s,this.olmDevice),this.deviceList.on("userCrossSigningUpdated",this.onDeviceListUserCrossSigningUpdated),this.reEmitter.reEmit(this.deviceList,["crypto.devicesUpdated","crypto.willUpdateDevices"]),this.supportedAlgorithms=Array.from(rM.keys()),this.outgoingRoomKeyRequestManager=new $Te(e,this.deviceId,this.cryptoStore),this.toDeviceVerificationRequests=new wCe,this.inRoomVerificationRequests=new SCe;const a=this.baseApis.cryptoCallbacks||{},c=kJ(s,this.olmDevice);this.crossSigningInfo=new Ja(n,a,c),this.secretStorage=new YTe(e,a,e),this.dehydrationManager=new ECe(this),!a.getCrossSigningKey&&a.getSecretStorageKey&&(a.getCrossSigningKey=async l=>Ja.getFromSecretStorage(l,this.secretStorage))}static getOlmVersion(){return LF.getOlmVersion()}async init({exportedOlmDevice:e,pickleKey:n}={}){k.log("Crypto: initialising Olm..."),await global.Olm.init(),k.log(e?"Crypto: initialising Olm device from exported device...":"Crypto: initialising Olm device..."),await this.olmDevice.init({fromExportedDevice:e,pickleKey:n}),k.log("Crypto: loading device list..."),await this.deviceList.load(),this.deviceKeys["ed25519:"+this.deviceId]=this.olmDevice.deviceEd25519Key,this.deviceKeys["curve25519:"+this.deviceId]=this.olmDevice.deviceCurve25519Key,k.log("Crypto: fetching own devices...");let r=this.deviceList.getRawStoredDevicesForUser(this.userId);if(r||(r={}),!r[this.deviceId]){k.log("Crypto: adding this device to the store...");const i={keys:this.deviceKeys,algorithms:this.supportedAlgorithms,verified:Ol.VERIFIED,known:!0};r[this.deviceId]=i,this.deviceList.storeDevicesForUser(this.userId,r),this.deviceList.saveIfDirty()}await this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],i=>{this.cryptoStore.getCrossSigningKeys(i,s=>{s&&Object.keys(s).length!==0&&(k.log("Loaded cross-signing public keys from crypto store"),this.crossSigningInfo.setKeys(s))})}),this.deviceList.startTrackingDeviceList(this.userId),k.debug("Crypto: initialising roomlist..."),await this.roomList.init(),k.log("Crypto: checking for key backup..."),this.backupManager.checkAndStart()}setDeviceIsolationMode(e){throw new Error("Not supported")}getVersion(){const e=wC.getOlmVersion();return`Olm ${e[0]}.${e[1]}.${e[2]}`}getTrustCrossSignedDevices(){return this.trustCrossSignedDevices}getCryptoTrustCrossSignedDevices(){return this.trustCrossSignedDevices}setTrustCrossSignedDevices(e){this.trustCrossSignedDevices=e;for(const n of this.deviceList.getKnownUserIds()){const r=this.deviceList.getRawStoredDevicesForUser(n);for(const i of Object.keys(r)){const s=this.checkDeviceTrust(n,i);if(!s.isLocallyVerified()&&s.isCrossSigningVerified()){const o=this.deviceList.getStoredDevice(n,i);this.emit("deviceVerificationChanged",n,i,o)}}}}setCryptoTrustCrossSignedDevices(e){this.setTrustCrossSignedDevices(e)}async createRecoveryKeyFromPassphrase(e){const n=new global.Olm.PkDecryption;try{if(e){const r=await M4(e);n.init_with_private_key(r.key);const i=n.get_private_key();return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:r.iterations,salt:r.salt}},privateKey:i,encodedPrivateKey:yC(i)}}else{n.generate_key();const r=n.get_private_key();return{privateKey:r,encodedPrivateKey:yC(r)}}}finally{n==null||n.free()}}async userHasCrossSigningKeys(e=this.userId){return await this.downloadKeys([e]),this.deviceList.getStoredCrossSigningForUser(e)!==null}async isCrossSigningReady(){const e=this.crossSigningInfo.getId(),n=await this.crossSigningInfo.isStoredInKeyCache()||await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage);return!!(e&&n)}async isSecretStorageReady(){const e=await this.secretStorage.hasKey(),n=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),r=!this.backupManager.getKeyBackupEnabled()||await this.baseApis.isKeyBackupKeyStored();return!!(e&&n&&r)}async getCrossSigningStatus(){var a,c,l;const e=!!this.crossSigningInfo.getId(),n=!!await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),r=this.crossSigningInfo.getCacheCallbacks(),i=!!await((a=r.getCrossSigningKeyCache)==null?void 0:a.call(r,"master")),s=!!await((c=r.getCrossSigningKeyCache)==null?void 0:c.call(r,"self_signing")),o=!!await((l=r.getCrossSigningKeyCache)==null?void 0:l.call(r,"user_signing"));return{publicKeysOnDevice:e,privateKeysInSecretStorage:n,privateKeysCachedLocally:{masterKey:i,selfSigningKey:s,userSigningKey:o}}}async bootstrapCrossSigning({authUploadDeviceSigningKeys:e,setupNewCrossSigning:n}={}){k.log("Bootstrapping cross-signing");const r=this.baseApis.cryptoCallbacks,i=new $F(this.baseApis.store.accountData,r),s=new Ja(this.userId,i.crossSigningCallbacks,i.crossSigningCallbacks),o=async()=>{s.resetKeys(),await this.signObject(s.keys.master),i.addCrossSigningKeys(e,s.keys);const p=this.deviceList.getStoredDevice(this.userId,this.deviceId),m=await s.signDevice(this.userId,p);i.addKeySignature(this.userId,this.deviceId,m),this.backupManager.backupInfo&&(await s.signObject(this.backupManager.backupInfo.auth_data,"master"),i.addSessionBackup(this.backupManager.backupInfo))},a=this.crossSigningInfo.getId(),c=await this.crossSigningInfo.isStoredInKeyCache(),l=await this.crossSigningInfo.isStoredInSecretStorage(this.secretStorage),u=c||l;k.log({setupNewCrossSigning:n,publicKeysOnDevice:a,privateKeysInCache:c,privateKeysInStorage:l,privateKeysExistSomewhere:u}),!u||n?(k.log("Cross-signing private keys not found locally or in secret storage, creating new keys"),await o()):a&&c?k.log("Cross-signing public keys trusted and private keys found locally"):l&&(k.log("Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally"),await this.checkOwnCrossSigningTrust({allowPrivateKeyRequests:!0}));const d=i.crossSigningCallbacks.privateKeys;if(d.size&&!this.baseApis.cryptoCallbacks.saveCrossSigningKeys){const p=new Y0(i.accountDataClientAdapter,i.ssssCryptoCallbacks);await p.hasKey()&&(k.log("Storing new cross-signing private keys in secret storage"),await Ja.storeInSecretStorage(d,p))}await i.buildOperation().apply(this),await i.persist(this),k.log("Cross-signing ready")}async bootstrapSecretStorage({createSecretStorageKey:e=async()=>({}),keyBackupInfo:n,setupNewKeyBackup:r,setupNewSecretStorage:i,getKeyBackupPassphrase:s}={}){k.log("Bootstrapping Secure Secret Storage");const o=this.baseApis.cryptoCallbacks,a=new $F(this.baseApis.store.accountData,o),c=new Y0(a.accountDataClientAdapter,a.ssssCryptoCallbacks);let l=null;const u=async T=>{const{keyId:C,keyInfo:I}=await c.addKey(jc,T);return a.ssssCryptoCallbacks.addPrivateKey(C,I,T.key),await c.setDefaultKeyId(C),C},d=async(T,C)=>{var I,R;if(!C.mac){const O=await((R=(I=this.baseApis.cryptoCallbacks).getSecretStorageKey)==null?void 0:R.call(I,{keys:{[T]:C}},""));if(O){const A=O[1];a.ssssCryptoCallbacks.addPrivateKey(T,C,A);const{iv:U,mac:N}=await dm(A);C.iv=U,C.mac=N,await a.setAccountData(`m.secret_storage.key.${T}`,C)}}},f=async T=>{if(this.crossSigningInfo.getId()&&await this.crossSigningInfo.isStoredInKeyCache("master"))try{k.log("Adding cross-signing signature to key backup"),await this.crossSigningInfo.signObject(T,"master")}catch(C){k.error("Signing key backup with cross-signing keys failed",C)}else k.warn("Cross-signing keys not available, skipping signature on key backup")},p=await this.secretStorage.getKey(),[m,v]=p||[null,null],S=!i&&v&&v.algorithm===jc;if(k.log({keyBackupInfo:n,setupNewKeyBackup:r,setupNewSecretStorage:i,storageExists:S,oldKeyInfo:v}),!S&&!n){k.log("Secret storage does not exist, creating new storage key");const{keyInfo:T,privateKey:C}=await e();l=await u({passphrase:T==null?void 0:T.passphrase,key:C,name:T==null?void 0:T.name})}else if(!S&&n){k.log("Secret storage does not exist, using key backup key");const T=await this.getSessionBackupPrivateKey()||await(s==null?void 0:s()),C={key:T};n.auth_data.private_key_salt&&n.auth_data.private_key_iterations&&(C.passphrase={algorithm:"m.pbkdf2",iterations:n.auth_data.private_key_iterations,salt:n.auth_data.private_key_salt,bits:256}),l=await u(C),await c.store("m.megolm_backup.v1",hs(T),[l]),await f(n.auth_data),a.addSessionBackup(n)}else k.log("Secret storage exists"),v&&v.algorithm===jc&&await d(m,v);if(!this.baseApis.cryptoCallbacks.saveCrossSigningKeys&&await this.isCrossSigningReady()&&(l||!await this.crossSigningInfo.isStoredInSecretStorage(c))){k.log("Copying cross-signing private keys from cache to secret storage");const T=await this.crossSigningInfo.getCrossSigningKeysFromCache();await Ja.storeInSecretStorage(T,c)}if(r&&!n){k.log("Creating new message key backup version");const T=await this.baseApis.prepareKeyBackupVersion(null,{secureSecretStorage:!1}),C=X1(T.recovery_key);await c.store("m.megolm_backup.v1",hs(C));const I={algorithm:T.algorithm,auth_data:T.auth_data};await f(I.auth_data),await this.signObject(I.auth_data),a.addSessionBackup(I)}const _=await c.get("m.megolm_backup.v1");if(_){k.info("Got session backup key from secret storage: caching");const T=WE(_);if(T){const I=l||m;await c.store("m.megolm_backup.v1",T,I?[I]:null)}const C=new Uint8Array(xi(T||_));a.addSessionBackupPrivateKeyToCache(C)}else if(this.backupManager.getKeyBackupEnabled()){const T=await this.getSessionBackupPrivateKey()||await(s==null?void 0:s());if(!T){k.error("Key backup is enabled but couldn't get key backup key!");return}k.info("Got session backup key from cache/user that wasn't in SSSS: saving to SSSS"),await c.store("m.megolm_backup.v1",hs(T))}await a.buildOperation().apply(this),await a.persist(this),k.log("Secure Secret Storage ready")}async resetKeyBackup(){await this.backupManager.deleteAllKeyBackupVersions();const e=await this.backupManager.prepareKeyBackupVersion();await this.signObject(e.auth_data);const{version:n}=await this.baseApis.http.authedRequest(oe.Post,"/room_keys/version",void 0,e,{prefix:Nn.V3});k.log(`Created backup version ${n}`);const r=e.privateKey;await this.secretStorage.store("m.megolm_backup.v1",hs(r)),await this.storeSessionBackupPrivateKey(r),await this.backupManager.checkAndStart(),await this.backupManager.scheduleAllGroupSessionsForBackup()}async deleteKeyBackupVersion(e){await this.backupManager.deleteKeyBackupVersion(e)}addSecretStorageKey(e,n,r){return this.secretStorage.addKey(e,n,r)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}getSecretStorageKey(e){return this.secretStorage.getKey(e)}storeSecret(e,n,r){return this.secretStorage.store(e,n,r)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,n){return n||(n=Object.keys(this.deviceList.getRawStoredDevicesForUser(this.userId))),this.secretStorage.request(e,n)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStorageKey(e,n){return this.secretStorage.checkKey(e,n)}checkSecretStoragePrivateKey(e,n){let r=null;try{return r=new global.Olm.PkDecryption,r.init_with_private_key(e)===n}finally{r==null||r.free()}}async getSessionBackupPrivateKey(){const e=await new Promise(r=>{this.cryptoStore.doTxn("readonly",[Be.STORE_ACCOUNT],i=>{this.cryptoStore.getSecretStorePrivateKey(i,r,"m.megolm_backup.v1")})});let n=null;if(typeof e=="string"&&(n=new Uint8Array(xi(WE(e)||e)),await this.storeSessionBackupPrivateKey(n)),e&&typeof e=="object"&&"ciphertext"in e){const r=Buffer.from(this.olmDevice.pickleKey),i=await Eb(e,r,"m.megolm_backup.v1");n=xi(i)}return n}async storeSessionBackupPrivateKey(e,n){if(!(e instanceof Uint8Array))throw new Error(`storeSessionBackupPrivateKey expects Uint8Array, got ${e}`);const r=Buffer.from(this.olmDevice.pickleKey),i=await jv(hs(e),r,"m.megolm_backup.v1");return this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],s=>{this.cryptoStore.storeSecretStorePrivateKey(s,"m.megolm_backup.v1",i)})}async getActiveSessionBackupVersion(){return this.backupManager.getKeyBackupEnabled()?this.backupManager.version??null:null}async isKeyBackupTrusted(e){const n=await this.backupManager.isKeyBackupTrusted(e);return zF(n)}async checkKeyBackupAndEnable(){const e=await this.backupManager.checkKeyBackup();return!e||!e.backupInfo?null:{backupInfo:e.backupInfo,trustInfo:zF(e.trustInfo)}}checkCrossSigningPrivateKey(e,n){let r=null;try{return r=new global.Olm.PkSigning,r.init_with_seed(e)===n}finally{r==null||r.free()}}async afterCrossSigningLocalKeyChange(){k.info("Starting cross-signing key change post-processing");const e=this.deviceList.getStoredDevice(this.userId,this.deviceId),n=await this.crossSigningInfo.signDevice(this.userId,e);k.info(`Starting background key sig upload for ${this.deviceId}`);const r=({shouldEmit:s=!1})=>this.baseApis.uploadKeySignatures({[this.userId]:{[this.deviceId]:n}}).then(o=>{const{failures:a}=o||{};if(Object.keys(a||[]).length>0)throw s&&this.baseApis.emit("crypto.keySignatureUploadFailure",a,"afterCrossSigningLocalKeyChange",r),new x1("Key upload failed",{failures:a});k.info(`Finished background key sig upload for ${this.deviceId}`)}).catch(o=>{k.error(`Error during background key sig upload for ${this.deviceId}`,o)});r({shouldEmit:!0});const i=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(i){k.info("Starting device verification upgrade");const s={};for(const[o,a]of Object.entries(this.deviceList.crossSigningInfo)){const c=await this.checkForDeviceVerificationUpgrade(o,Ja.fromStorage(a,o));c&&(s[o]=c)}if(Object.keys(s).length>0){k.info(`Found ${Object.keys(s).length} verif users to upgrade`);try{const o=await i({users:s});if(o)for(const a of o)a in s&&await this.baseApis.setDeviceVerified(a,s[a].crossSigningInfo.getId())}catch(o){k.log("shouldUpgradeDeviceVerifications threw an error: not upgrading",o)}}k.info("Finished device verification upgrade")}k.info("Finished cross-signing key change post-processing")}async checkForDeviceVerificationUpgrade(e,n){const r=this.crossSigningInfo.checkUserTrust(n);if(n.firstUse&&!r.isVerified()){const i=this.deviceList.getRawStoredDevicesForUser(e),s=await this.checkForValidDeviceSignature(e,n.keys.master,i);if(s.length)return{devices:s.map(o=>Ys.fromStorage(i[o],o)),crossSigningInfo:n}}}async checkForValidDeviceSignature(e,n,r){const i=[];if(r&&n.signatures&&n.signatures[e])for(const s of Object.keys(n.signatures[e])){const[,o]=s.split(":",2);if(o in r&&r[o].verified===Ol.VERIFIED)try{await Zm(this.olmDevice,n,e,o,r[o].keys[s]),i.push(o)}catch{}}return i}getCrossSigningKeyId(e=K2.Master){return Promise.resolve(this.getCrossSigningId(e))}getCrossSigningId(e){return this.crossSigningInfo.getId(e)}getStoredCrossSigningForUser(e){return this.deviceList.getStoredCrossSigningForUser(e)}checkUserTrust(e){const n=this.deviceList.getStoredCrossSigningForUser(e);return n?this.crossSigningInfo.checkUserTrust(n):new Z1(!1,!1,!1)}async getUserVerificationStatus(e){return this.checkUserTrust(e)}async pinCurrentUserIdentity(e){throw new Error("not implemented")}async getDeviceVerificationStatus(e,n){const r=this.deviceList.getStoredDevice(e,n);return r?this.checkDeviceInfoTrust(e,r):null}checkDeviceTrust(e,n){const r=this.deviceList.getStoredDevice(e,n);return this.checkDeviceInfoTrust(e,r)}checkDeviceInfoTrust(e,n){const r=!!(n!=null&&n.isVerified()),i=this.deviceList.getStoredCrossSigningForUser(e);if(n&&i){const s=this.trustCrossSignedDevices||e===this.userId;return this.crossSigningInfo.checkDeviceTrust(i,n,r,s)}else return new fm(!1,!1,r,!1)}checkIfOwnDeviceCrossSigned(e){const n=this.deviceList.getStoredDevice(this.userId,e);if(!n)return!1;const r=this.deviceList.getStoredCrossSigningForUser(this.userId);return(r==null?void 0:r.checkDeviceTrust(r,n,!1,!0).isCrossSigningVerified())??!1}async checkOwnCrossSigningTrust({allowPrivateKeyRequests:e=!1}={}){const n=this.userId;await this.downloadKeys([this.userId]);const r=await this.crossSigningInfo.getCrossSigningKeysFromCache(),i=this.deviceList.getStoredCrossSigningForUser(n);if(!i){k.error("Got cross-signing update event for user "+n+" but no new cross-signing information found!");return}const s=i.getId(),o=this.crossSigningInfo.getId()!==s,a=i.getId()&&!r.has("master");if(o&&k.info("Got new master public key",s),e&&(o||a)){k.info("Attempting to retrieve cross-signing master private key");let S=null;try{S=(await this.crossSigningInfo.getCrossSigningKey("master",s))[1],k.info("Got cross-signing master private key")}finally{S==null||S.free()}}const c=this.crossSigningInfo.getId("self_signing"),l=this.crossSigningInfo.getId("user_signing");this.storeTrustedSelfKeys(i.keys);const u=c!==i.getId("self_signing"),d=l!==i.getId("user_signing"),f=i.getId("self_signing")&&!r.has("self_signing"),p=i.getId("user_signing")&&!r.has("user_signing"),m={};if(u&&k.info("Got new self-signing key",i.getId("self_signing")),e&&(u||f)){k.info("Attempting to retrieve cross-signing self-signing private key");let S=null;try{S=(await this.crossSigningInfo.getCrossSigningKey("self_signing",i.getId("self_signing")))[1],k.info("Got cross-signing self-signing private key")}finally{S==null||S.free()}const _=this.deviceList.getStoredDevice(this.userId,this.deviceId),w=await this.crossSigningInfo.signDevice(this.userId,_);m[this.deviceId]=w}if(d&&k.info("Got new user-signing key",i.getId("user_signing")),e&&(d||p)){k.info("Attempting to retrieve cross-signing user-signing private key");let S=null;try{S=(await this.crossSigningInfo.getCrossSigningKey("user_signing",i.getId("user_signing")))[1],k.info("Got cross-signing user-signing private key")}finally{S==null||S.free()}}if(o){const S=this.crossSigningInfo.keys.master;await this.signObject(S);const _=S.signatures[this.userId]["ed25519:"+this.deviceId];m[this.crossSigningInfo.getId()]=Object.assign({},S,{signatures:{[this.userId]:{["ed25519:"+this.deviceId]:_}}})}const v=Object.keys(m);if(v.length){const S=({shouldEmit:_=!1})=>(k.info(`Starting background key sig upload for ${v}`),this.baseApis.uploadKeySignatures({[this.userId]:m}).then(w=>{const{failures:T}=w||{};if(k.info(`Finished background key sig upload for ${v}`),Object.keys(T||[]).length>0)throw _&&this.baseApis.emit("crypto.keySignatureUploadFailure",T,"checkOwnCrossSigningTrust",S),new x1("Key upload failed",{failures:T})}).catch(w=>{k.error(`Error during background key sig upload for ${v}`,w)}));S({shouldEmit:!0})}this.emit("userTrustStatusChanged",n,this.checkUserTrust(n)),o&&(this.emit("crossSigning.keysChanged",{}),await this.afterCrossSigningLocalKeyChange()),await this.backupManager.checkKeyBackup()}async getBackupDecryptor(e,n){if(!(n instanceof Uint8Array))throw new Error("getBackupDecryptor expects Uint8Array");const r=await Mh.makeAlgorithm(e,async()=>n);return await r.keyMatches(n)?new xCe(r):Promise.reject(new Ii({errcode:Qh.RESTORE_BACKUP_ERROR_BAD_KEY}))}importBackedUpRoomKeys(e,n,r={}){return r.source="backup",this.importRoomKeys(e,r)}async storeTrustedSelfKeys(e){e?this.crossSigningInfo.setKeys(e):this.crossSigningInfo.clearKeys(),await this.cryptoStore.doTxn("readwrite",[Be.STORE_ACCOUNT],n=>{this.cryptoStore.storeCrossSigningKeys(n,this.crossSigningInfo.keys)})}async checkDeviceVerifications(e){const n=this.baseApis.cryptoCallbacks.shouldUpgradeDeviceVerifications;if(n){if(k.info(`Starting device verification upgrade for ${e}`),this.crossSigningInfo.keys.user_signing){const r=this.deviceList.getStoredCrossSigningForUser(e);if(r){const i=await this.checkForDeviceVerificationUpgrade(e,r);i&&(await n({users:{[e]:i}})).includes(e)&&await this.baseApis.setDeviceVerified(e,r.getId())}}k.info(`Finished device verification upgrade for ${e}`)}}enableLazyLoading(){this.lazyLoadMembers=!0}registerEventHandlers(e){e.on(Hs.Membership,this.onMembership),e.on(qe.ToDeviceEvent,this.onToDeviceEvent),e.on(ct.Timeline,this.onTimelineEvent),e.on(sn.Decrypted,this.onTimelineEvent)}start(){k.warn("MatrixClient.crypto.start() is deprecated")}stop(){this.outgoingRoomKeyRequestManager.stop(),this.deviceList.stop(),this.dehydrationManager.stop(),this.backupManager.stop()}getDeviceEd25519Key(){return this.olmDevice.deviceEd25519Key}getDeviceCurve25519Key(){return this.olmDevice.deviceCurve25519Key}async getOwnDeviceKeys(){if(!this.olmDevice.deviceCurve25519Key)throw new Error("Curve25519 key not yet created");if(!this.olmDevice.deviceEd25519Key)throw new Error("Ed25519 key not yet created");return{ed25519:this.olmDevice.deviceEd25519Key,curve25519:this.olmDevice.deviceCurve25519Key}}setGlobalBlacklistUnverifiedDevices(e){this.globalBlacklistUnverifiedDevices=e}getGlobalBlacklistUnverifiedDevices(){return this.globalBlacklistUnverifiedDevices}uploadDeviceKeys(){const e={algorithms:this.supportedAlgorithms,device_id:this.deviceId,keys:this.deviceKeys,user_id:this.userId};return this.signObject(e).then(()=>this.baseApis.uploadKeysRequest({device_keys:e}))}getNeedsNewFallback(){return!!this.needsNewFallback}maybeUploadOneTimeKeys(){if(this.oneTimeKeyCheckInProgress)return;const r=Date.now();if(this.lastOneTimeKeyCheck!==null&&r-this.lastOneTimeKeyCheck<6e4)return;this.lastOneTimeKeyCheck=r;const i=this.olmDevice.maxNumberOfOneTimeKeys(),s=Math.floor(i/2),o=async a=>{for(;s>a||this.getNeedsNewFallback();){if(s>a){k.info("generating oneTimeKeys");const l=Math.min(s-a,5);await this.olmDevice.generateOneTimeKeys(l)}if(this.getNeedsNewFallback()){const l=await this.olmDevice.getFallbackKey();(!l.curve25519||Object.keys(l.curve25519).length==0)&&(k.info("generating fallback key"),this.fallbackCleanup&&(clearTimeout(this.fallbackCleanup),delete this.fallbackCleanup),await this.olmDevice.generateFallbackKey())}k.info("calling uploadOneTimeKeys");const c=await this.uploadOneTimeKeys();if(c.one_time_key_counts&&c.one_time_key_counts.signed_curve25519)a=c.one_time_key_counts.signed_curve25519;else throw new Error("response for uploading keys does not contain one_time_key_counts.signed_curve25519")}};this.oneTimeKeyCheckInProgress=!0,Promise.resolve().then(()=>this.oneTimeKeyCount!==void 0?Promise.resolve(this.oneTimeKeyCount):this.baseApis.uploadKeysRequest({}).then(a=>a.one_time_key_counts.signed_curve25519||0)).then(a=>o(a)).catch(a=>{k.error("Error uploading one-time keys",a.stack||a)}).finally(()=>{this.oneTimeKeyCount=void 0,this.oneTimeKeyCheckInProgress=!1})}async uploadOneTimeKeys(){const e=[];let n;if(this.getNeedsNewFallback()){n={};const a=await this.olmDevice.getFallbackKey();for(const[c,l]of Object.entries(a.curve25519)){const u={key:l,fallback:!0};n["signed_curve25519:"+c]=u,e.push(this.signObject(u))}this.needsNewFallback=!1}const r=await this.olmDevice.getOneTimeKeys(),i={};for(const a in r.curve25519)if(r.curve25519.hasOwnProperty(a)){const c={key:r.curve25519[a]};i["signed_curve25519:"+a]=c,e.push(this.signObject(c))}await Promise.all(e);const s={one_time_keys:i};n&&(s["org.matrix.msc2732.fallback_keys"]=n,s.fallback_keys=n);const o=await this.baseApis.uploadKeysRequest(s);return n&&(this.fallbackCleanup=setTimeout(()=>{delete this.fallbackCleanup,this.olmDevice.forgetOldFallbackKey()},60*60*1e3)),await this.olmDevice.markKeysAsPublished(),o}downloadKeys(e,n){return this.deviceList.downloadKeys(e,!!n)}getStoredDevicesForUser(e){return this.deviceList.getStoredDevicesForUser(e)}async getUserDeviceInfo(e,n=!1){const r=new Map,i=[];for(const s of e){const o=await this.getStoredDevicesForUser(s);if(o){const a=new Map(o.map(c=>[c.deviceId,WF(c,s)]));r.set(s,a)}else i.push(s)}return n&&i.length>0&&(await this.downloadKeys(i)).forEach((o,a)=>{const c=new Map;o.forEach((l,u)=>c.set(u,WF(l,a))),r.set(a,c)}),r}getStoredDevice(e,n){return this.deviceList.getStoredDevice(e,n)}saveDeviceList(e){return this.deviceList.saveIfDirty(e)}async setDeviceVerified(e,n,r=!0){await this.setDeviceVerification(e,n,r)}async crossSignDevice(e){await this.setDeviceVerified(this.userId,e,!0)}async setDeviceVerification(e,n,r=null,i=null,s=null,o){const a=this.deviceList.getStoredCrossSigningForUser(e);if((a==null?void 0:a.getId())===n){if(i!==null||s!==null)throw new Error("Cannot set blocked or known for a cross-signing key");if(!r)throw new Error("Cannot set a cross-signing key as unverified");const p=o?Object.values(o)[0]:null;if(o&&(Object.values(o).length!==1||p!==a.getId()))throw new Error(`Key did not match expected value: expected ${a.getId()}, got ${p}`);if(!this.crossSigningInfo.getId()&&e===this.crossSigningInfo.userId&&(this.storeTrustedSelfKeys(a.keys),this.emit("userTrustStatusChanged",this.userId,this.checkUserTrust(e))),e!==this.userId){k.info("Master key "+a.getId()+" for "+e+" marked verified. Signing...");const m=await this.crossSigningInfo.signUser(a);if(m){const v=async({shouldEmit:S=!1})=>{k.info("Uploading signature for "+e+"...");const _=await this.baseApis.uploadKeySignatures({[e]:{[n]:m}}),{failures:w}=_||{};if(Object.keys(w||[]).length>0)throw S&&this.baseApis.emit("crypto.keySignatureUploadFailure",w,"setDeviceVerification",v),new x1("Key upload failed",{failures:w})};await v({shouldEmit:!0})}return m}else return a}const c=this.deviceList.getRawStoredDevicesForUser(e);if(!c||!c[n])throw new Error("Unknown device "+e+":"+n);const l=c[n];let u=l.verified;if(r){if(o){for(const[p,m]of Object.entries(o))if(l.keys[p]!==m)throw new Error(`Key did not match expected value: expected ${m}, got ${l.keys[p]}`)}u=Ol.VERIFIED}else r!==null&&u==Ol.VERIFIED&&(u=Ol.UNVERIFIED);i?u=Ol.BLOCKED:i!==null&&u==Ol.BLOCKED&&(u=Ol.UNVERIFIED);let d=l.known;if(s!==null&&(d=s),(l.verified!==u||l.known!==d)&&(l.verified=u,l.known=d,this.deviceList.storeDevicesForUser(e,c),this.deviceList.saveIfDirty()),r&&e===this.userId){k.info("Own device "+n+" marked verified: signing");let p;if(this.checkDeviceTrust(e,n).isCrossSigningVerified()?k.log(`Own device ${n} already cross-signing verified`):p=await this.crossSigningInfo.signDevice(e,Ys.fromStorage(l,n)),p){const v=async({shouldEmit:S=!1})=>{k.info("Uploading signature for "+n);const _=await this.baseApis.uploadKeySignatures({[e]:{[n]:p}}),{failures:w}=_||{};if(Object.keys(w||[]).length>0)throw S&&this.baseApis.emit("crypto.keySignatureUploadFailure",w,"setDeviceVerification",v),new x1("Key upload failed",{failures:w})};await v({shouldEmit:!0})}}const f=Ys.fromStorage(l,n);return this.emit("deviceVerificationChanged",e,n,f),f}findVerificationRequestDMInProgress(e,n){return this.inRoomVerificationRequests.findRequestInProgress(e,n)}getVerificationRequestsToDeviceInProgress(e){return this.toDeviceVerificationRequests.getRequestsInProgress(e)}requestVerificationDM(e,n){const r=this.inRoomVerificationRequests.findRequestInProgress(n);if(r)return Promise.resolve(r);const i=new qi(this.baseApis,n,e);return this.requestVerificationWithChannel(e,i,this.inRoomVerificationRequests)}requestVerification(e,n){n||(n=Object.keys(this.deviceList.getRawStoredDevicesForUser(e)));const r=this.toDeviceVerificationRequests.findRequestInProgress(e,n);if(r)return Promise.resolve(r);const i=new Ki(this.baseApis,e,n,Ki.makeTransactionId());return this.requestVerificationWithChannel(e,i,this.toDeviceVerificationRequests)}requestOwnUserVerification(){return this.requestVerification(this.userId)}requestDeviceVerification(e,n){return this.requestVerification(e,[n])}async requestVerificationWithChannel(e,n,r){let i=new ph(n,this.verificationMethods,this.baseApis);n.transactionId&&r.setRequestByChannel(n,i),await i.sendRequest();const s=r.getRequestByChannel(n);return s?i=s:(k.log(`Crypto: adding new request to requestsByTxnId with id ${n.transactionId} ${n.roomId}`),r.setRequestByChannel(n,i)),i}beginKeyVerification(e,n,r,i=null){let s;if(i){if(s=this.toDeviceVerificationRequests.getRequestBySenderAndTxnId(n,i),!s)throw new Error(`No request found for user ${n} with transactionId ${i}`)}else{i=Ki.makeTransactionId();const o=new Ki(this.baseApis,n,[r],i,r);s=new ph(o,this.verificationMethods,this.baseApis),this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(n,i,s)}return s.beginKeyVerification(e,{userId:n,deviceId:r})}async legacyDeviceVerification(e,n,r){const i=Ki.makeTransactionId(),s=new Ki(this.baseApis,e,[n],i,n),o=new ph(s,this.verificationMethods,this.baseApis);this.toDeviceVerificationRequests.setRequestBySenderAndTxnId(e,i,o);const a=o.beginKeyVerification(r,{userId:e,deviceId:n});return await Promise.race([a.verify(),o.waitFor(c=>c.started)]),o}async getOlmSessionsForUser(e){const n=this.getStoredDevicesForUser(e)||[],r={};for(const i of n){const s=i.getIdentityKey(),o=await this.olmDevice.getSessionInfoForDevice(s);r[i.deviceId]={deviceIdKey:s,sessions:o}}return r}getEventSenderDeviceInfo(e){const n=e.getSenderKey(),r=e.getWireContent().algorithm;if(!n||!r||e.isKeySourceUntrusted())return null;const i=this.deviceList.getDeviceByIdentityKey(r,n);if(i===null)return null;const s=e.getClaimedEd25519Key();return s?s!==i.getFingerprint()?(k.warn("Event "+e.getId()+" claims ed25519 key "+s+" but sender device has key "+i.getFingerprint()),null):i:(k.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),null)}getEventEncryptionInfo(e){const n={};if(n.senderKey=e.getSenderKey()??void 0,n.algorithm=e.getWireContent().algorithm,!n.senderKey||!n.algorithm)return n.encrypted=!1,n;n.encrypted=!0,e.isKeySourceUntrusted()?n.authenticated=!1:n.authenticated=!0,n.sender=this.deviceList.getDeviceByIdentityKey(n.algorithm,n.senderKey)??void 0;const r=e.getClaimedEd25519Key();return r||(k.warn("Event "+e.getId()+" claims no ed25519 key: cannot verify sending device"),n.mismatchedSender=!0),n.sender&&r!==n.sender.getFingerprint()&&(k.warn("Event "+e.getId()+" claims ed25519 key "+r+"but sender device has key "+n.sender.getFingerprint()),n.mismatchedSender=!0),n}async getEncryptionInfoForEvent(e){const n=this.getEventEncryptionInfo(e);if(!n.encrypted)return null;const r=e.getSender();if(!r||n.mismatchedSender)return{shieldColour:jl.RED,shieldReason:fh.MISMATCHED_SENDER_KEY};if(!this.checkUserTrust(r).isCrossSigningVerified())return n.authenticated?{shieldColour:jl.NONE,shieldReason:null}:{shieldColour:jl.GREY,shieldReason:fh.AUTHENTICITY_NOT_GUARANTEED};const s=r&&n.sender&&await this.getDeviceVerificationStatus(r,n.sender.deviceId);return s?s.isVerified()?n.authenticated?{shieldColour:jl.NONE,shieldReason:null}:{shieldColour:jl.GREY,shieldReason:fh.AUTHENTICITY_NOT_GUARANTEED}:{shieldColour:jl.RED,shieldReason:fh.UNSIGNED_DEVICE}:{shieldColour:jl.GREY,shieldReason:fh.UNKNOWN_DEVICE}}forceDiscardSession(e){const n=this.roomEncryptors.get(e);if(n===void 0)throw new Error("Room not encrypted");if(n.forceDiscardSession===void 0)throw new Error("Room encryption algorithm doesn't support session discarding");return n.forceDiscardSession(),Promise.resolve()}async setRoomEncryption(e,n,r){const i=this.clientStore.getRoom(e);if(!i)throw new Error(`Unable to enable encryption tracking devices in unknown room ${e}`);await this.setRoomEncryptionImpl(i,n),!this.lazyLoadMembers&&!r&&this.deviceList.refreshOutdatedDeviceLists()}async setRoomEncryptionImpl(e,n){const r=e.roomId;if(!n.algorithm){k.log("Ignoring setRoomEncryption with no algorithm");return}const i=this.roomList.getRoomEncryption(r);if(i&&JSON.stringify(i)!=JSON.stringify(n)){k.error("Ignoring m.room.encryption event which requests a change of config in "+r);return}if(this.roomEncryptors.get(r))return;let o=null;i||(o=this.roomList.setRoomEncryption(r,n));const a=RJ.get(n.algorithm);if(!a)throw new Error("Unable to encrypt with "+n.algorithm);const c=new a({userId:this.userId,deviceId:this.deviceId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:r,config:n});if(this.roomEncryptors.set(r,c),o&&await o,k.log(`Enabling encryption in ${r}`),e.membersLoaded())await this.trackRoomDevicesImpl(e);else{const l=u=>{e.off(xt.Update,l),e.membersLoaded()&&this.trackRoomDevicesImpl(e).catch(d=>{k.error(`Error enabling device tracking in ${r}`,d)})};e.on(xt.Update,l)}}trackRoomDevices(e){const n=this.clientStore.getRoom(e);if(!n)throw new Error(`Unable to start tracking devices in unknown room ${e}`);return this.trackRoomDevicesImpl(n)}trackRoomDevicesImpl(e){const n=e.roomId,r=async()=>{if(!this.roomEncryptors.has(n))return;k.log(`Starting to track devices for room ${n} ...`),(await e.getEncryptionTargetMembers()).forEach(o=>{this.deviceList.startTrackingDeviceList(o.userId)})};let i=this.roomDeviceTrackingState[n];return i||(i=r(),this.roomDeviceTrackingState[n]=i.catch(s=>{throw delete this.roomDeviceTrackingState[n],s})),i}ensureOlmSessionsForUsers(e,n){const r=new Map;for(const i of e){const s=[];r.set(i,s);const o=this.getStoredDevicesForUser(i)||[];for(const a of o)a.getIdentityKey()!=this.olmDevice.deviceCurve25519Key&&a.verified!=Ol.BLOCKED&&s.push(a)}return fu(this.olmDevice,this.baseApis,r,n)}async exportRoomKeys(){const e=[];return await this.cryptoStore.doTxn("readonly",[Be.STORE_INBOUND_GROUP_SESSIONS],n=>{this.cryptoStore.getAllEndToEndInboundGroupSessions(n,r=>{if(r===null)return;const i=this.olmDevice.exportInboundGroupSession(r.senderKey,r.sessionId,r.sessionData);delete i.first_known_index,i.algorithm=Ks,e.push(i)})}),e}async exportRoomKeysAsJson(){return JSON.stringify(await this.exportRoomKeys())}importRoomKeys(e,n={}){let r=0,i=0;const s=e.length;function o(){var a;(a=n.progressCallback)==null||a.call(n,{stage:"load_keys",successes:r,failures:i,total:s})}return Promise.all(e.map(a=>!a.room_id||!a.algorithm?(k.warn("ignoring room key entry with missing fields",a),i++,n.progressCallback&&o(),null):this.getRoomDecryptor(a.room_id,a.algorithm).importRoomKey(a,n).finally(()=>{r++,n.progressCallback&&o()}))).then()}async importRoomKeysAsJson(e,n){return await this.importRoomKeys(JSON.parse(e))}countSessionsNeedingBackup(){return this.backupManager.countSessionsNeedingBackup()}prepareToEncrypt(e){const n=this.roomEncryptors.get(e.roomId);n&&n.prepareToEncrypt(e)}async encryptEvent(e,n){const r=e.getRoomId(),i=this.roomEncryptors.get(r);if(!i)throw new Error("Room "+r+" was previously configured to use encryption, but is no longer. Perhaps the homeserver is hiding the configuration event.");await this.trackRoomDevicesImpl(n);let s=e.getContent();const o=s["m.relates_to"];o&&(s=Object.assign({},s),delete s["m.relates_to"]);const a=s["io.element.performance_metrics"];a&&(s=Object.assign({},s),delete s["io.element.performance_metrics"]);const c=await i.encryptMessage(n,e.getType(),s);o&&(c["m.relates_to"]=o),a&&(c["io.element.performance_metrics"]=a),e.makeEncrypted("m.room.encrypted",c,this.olmDevice.deviceCurve25519Key,this.olmDevice.deviceEd25519Key)}async decryptEvent(e){if(e.isRedacted()){const n=new oi({room_id:e.getRoomId(),...e.getUnsigned().redacted_because});let r=e.getUnsigned().redacted_because;if(n.isEncrypted())try{r=(await this.decryptEvent(n)).clearEvent}catch(i){k.warn("Decryption of redaction failed. Falling back to unencrypted event.",i)}return{clearEvent:{room_id:e.getRoomId(),type:"m.room.message",content:{},unsigned:{redacted_because:r}}}}else{const n=e.getWireContent();return this.getRoomDecryptor(e.getRoomId(),n.algorithm).decryptEvent(e)}}async processDeviceLists(e){await this.evalDeviceListChanges(e)}requestRoomKey(e,n,r=!1){return this.outgoingRoomKeyRequestManager.queueRoomKeyRequest(e,n,r).then(()=>{this.sendKeyRequestsImmediately&&this.outgoingRoomKeyRequestManager.sendQueuedRequests()}).catch(i=>{k.error("Error requesting key for event",i)})}cancelRoomKeyRequest(e){this.outgoingRoomKeyRequestManager.cancelRoomKeyRequest(e).catch(n=>{k.warn("Error clearing pending room key requests",n)})}async cancelAndResendAllOutgoingKeyRequests(){await this.outgoingRoomKeyRequestManager.cancelAndResendAllOutgoingRequests()}async onCryptoEvent(e,n){const r=n.getContent();await this.setRoomEncryptionImpl(e,r)}async onSyncWillProcess(e){e.oldSyncToken||(k.log("Initial sync performed - resetting device tracking state"),this.deviceList.stopTrackingAllDeviceLists(),this.deviceList.startTrackingDeviceList(this.userId),this.roomDeviceTrackingState={}),this.sendKeyRequestsImmediately=!1}async onSyncCompleted(e){this.deviceList.setSyncToken(e.nextSyncToken??null),this.deviceList.saveIfDirty(),this.deviceList.startTrackingDeviceList(this.userId),this.deviceList.refreshOutdatedDeviceLists(),e.catchingUp||(this.maybeUploadOneTimeKeys(),this.processReceivedRoomKeyRequests(),this.outgoingRoomKeyRequestManager.sendQueuedRequests(),this.sendKeyRequestsImmediately=!0)}async evalDeviceListChanges(e){if(Array.isArray(e==null?void 0:e.changed)&&e.changed.forEach(n=>{this.deviceList.invalidateUserDeviceList(n)}),Array.isArray(e==null?void 0:e.left)&&e.left.length){const n=new Set(await this.getTrackedE2eUsers());e.left.forEach(r=>{n.has(r)||this.deviceList.stopTrackingDeviceList(r)})}}async getTrackedE2eUsers(){const e=[];for(const n of this.getTrackedE2eRooms()){const r=await n.getEncryptionTargetMembers();for(const i of r)e.push(i.userId)}return e}getTrackedE2eRooms(){return this.clientStore.getRooms().filter(e=>{if(!this.roomEncryptors.get(e.roomId)||!this.roomDeviceTrackingState[e.roomId])return!1;const r=e.getMyMembership();return r===Ge.Join||r===Ge.Invite})}async encryptAndSendToDevices(e,n){const r={eventType:Z.RoomMessageEncrypted,batch:[]};try{await Promise.all(e.map(async({userId:i,deviceInfo:s})=>{const o=s.deviceId,a={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};r.batch.push({userId:i,deviceId:o,payload:a}),await fu(this.olmDevice,this.baseApis,new Map([[i,[s]]])),await cf(a.ciphertext,this.userId,this.deviceId,this.olmDevice,i,s,n)})),r.batch=r.batch.filter(i=>Object.keys(i.payload.ciphertext).length>0?!0:(k.log(`No ciphertext for device ${i.userId}:${i.deviceId}: pruning`),!1));try{await this.baseApis.queueToDevice(r)}catch(i){throw k.error("sendToDevice failed",i),i}}catch(i){throw k.error("encryptAndSendToDevices promises failed",i),i}}async preprocessToDeviceMessages(e){return e.filter(n=>{var r;return n.type===Z.RoomMessageEncrypted&&!["m.olm.v1.curve25519-aes-sha2"].includes((r=n.content)==null?void 0:r.algorithm)?(k.log("Ignoring invalid encrypted to-device event from "+n.sender),!1):!0})}updateOneTimeKeyCount(e){if(isFinite(e))this.oneTimeKeyCount=e;else throw new TypeError("Parameter for updateOneTimeKeyCount has to be a number")}processKeyCounts(e,n){return e!==void 0&&this.updateOneTimeKeyCount(e.signed_curve25519||0),n!==void 0&&(this.needsNewFallback=!n.includes("signed_curve25519")),Promise.resolve()}onRoomKeyEvent(e){const n=e.getContent();if(!n.room_id||!n.algorithm){k.error("key event is missing fields");return}this.backupManager.checkedForBackup||this.backupManager.checkAndStart(),this.getRoomDecryptor(n.room_id,n.algorithm).onRoomKeyEvent(e)}onRoomKeyWithheldEvent(e){const n=e.getContent();if(n.code!=="m.no_olm"&&(!n.room_id||!n.session_id)||!n.algorithm||!n.sender_key){k.error("key withheld event is missing fields");return}k.info(`Got room key withheld event from ${e.getSender()} for ${n.algorithm} session ${n.sender_key}|${n.session_id} in room ${n.room_id} with code ${n.code} (${n.reason})`);const r=this.getRoomDecryptor(n.room_id,n.algorithm);if(r.onRoomKeyWithheldEvent&&r.onRoomKeyWithheldEvent(e),!n.room_id){const i=this.getRoomDecryptors(n.algorithm);for(const s of i)s.retryDecryptionFromSender(n.sender_key)}}onKeyVerificationMessage(e){if(!Ki.validateEvent(e,this.baseApis))return;const n=r=>{if(!Ki.canCreateRequest(Ki.getEventType(r)))return;const i=r.getContent(),s=i&&i.from_device;if(!s)return;const o=r.getSender(),a=new Ki(this.baseApis,o,[s]);return new ph(a,this.verificationMethods,this.baseApis)};this.handleVerificationEvent(e,this.toDeviceVerificationRequests,n)}async handleVerificationEvent(e,n,r,i=!0){if(e.isSending()&&e.status!=Ze.SENT){let c,l;try{await new Promise((u,d)=>{c=u,l=()=>{e.status==Ze.CANCELLED&&d(new Error("Event status set to CANCELLED."))},e.once(sn.LocalEventIdReplaced,c),e.on(sn.Status,l)})}catch(u){k.error("error while waiting for the verification event to be sent: ",u);return}finally{e.removeListener(sn.LocalEventIdReplaced,c),e.removeListener(sn.Status,l)}}let s=n.getRequest(e),o=!1;if(!s){if(s=r(e),!s){k.log(`Crypto: could not find VerificationRequest for ${e.getType()}, and could not create one, so ignoring.`);return}o=!0,n.setRequest(e,s)}e.setVerificationRequest(s);try{await s.channel.handleEvent(e,s,i)}catch(c){k.error("error while handling verification event",c)}o&&!s.initiatedByMe&&!s.invalid&&!s.observeOnly&&(this.baseApis.emit("crypto.verification.request",s),this.baseApis.emit("crypto.verificationRequestReceived",s))}async onToDeviceBadEncrypted(e){const n=e.getWireContent(),r=e.getSender(),i=n.algorithm,s=n.sender_key;this.baseApis.emit(qe.UndecryptableToDeviceEvent,e);const o=()=>{const p=this.getRoomDecryptors(Ks);for(const m of p)m.retryDecryptionFromSender(s)};if(r===void 0||s===void 0||s===void 0)return;const a=this.forceNewSessionRetryTime.getOrCreate(r),c=a.getOrCreate(s);if(c>Date.now()){k.debug(`New session already forced with device ${r}:${s}: not forcing another until at least ${new Date(c).toUTCString()}`),await this.olmDevice.recordSessionProblem(s,"wedged",!0),o();return}a.set(s,Date.now()+MCe);let l=this.deviceList.getDeviceByIdentityKey(i,s);if(!l&&(await this.downloadKeys([r],!1),l=this.deviceList.getDeviceByIdentityKey(i,s),!l)){k.info("Couldn't find device for identity key "+s+": not re-establishing session"),await this.olmDevice.recordSessionProblem(s,"wedged",!1),o();return}const u=new Map([[r,[l]]]);await fu(this.olmDevice,this.baseApis,u,!0),a.set(s,Date.now()+OCe);const d={algorithm:ri,sender_key:this.olmDevice.deviceCurve25519Key,ciphertext:{},[vs]:ac()};await cf(d.ciphertext,this.userId,this.deviceId,this.olmDevice,r,l,{type:"m.dummy"}),await this.olmDevice.recordSessionProblem(s,"wedged",!0),o(),await this.baseApis.sendToDevice("m.room.encrypted",new Map([[r,new Map([[l.deviceId,d]])]]));const f=await this.outgoingRoomKeyRequestManager.getOutgoingSentRoomKeyRequest(r,l.deviceId);for(const p of f)this.requestRoomKey(p.requestBody,p.recipients,!0)}onRoomMembership(e,n,r){var o;const i=n.roomId,s=this.roomEncryptors.get(i);s&&(i in this.roomDeviceTrackingState&&(n.membership==Ge.Join?(k.log("Join event for "+n.userId+" in "+i),this.deviceList.startTrackingDeviceList(n.userId)):n.membership==Ge.Invite&&((o=this.clientStore.getRoom(i))!=null&&o.shouldEncryptForInvitedMembers())&&(k.log("Invite event for "+n.userId+" in "+i),this.deviceList.startTrackingDeviceList(n.userId))),s.onRoomMembership(e,n,r))}onRoomKeyRequestEvent(e){const n=e.getContent();if(n.action==="request"){const r=new ACe(e);this.receivedRoomKeyRequests.push(r)}else if(n.action==="request_cancellation"){const r=new LCe(e);this.receivedRoomKeyRequestCancellations.push(r)}}async processReceivedRoomKeyRequests(){if(!this.processingRoomKeyRequests){this.processingRoomKeyRequests=!0;try{const e=this.receivedRoomKeyRequests;this.receivedRoomKeyRequests=[];const n=this.receivedRoomKeyRequestCancellations;this.receivedRoomKeyRequestCancellations=[],await Promise.all(e.map(r=>this.processReceivedRoomKeyRequest(r))),await Promise.all(n.map(r=>this.processReceivedRoomKeyRequestCancellation(r)))}catch(e){k.error(`Error processing room key requsts: ${e}`)}finally{this.processingRoomKeyRequests=!1}}}async processReceivedRoomKeyRequest(e){const n=e.userId,r=e.deviceId,i=e.requestBody,s=i.room_id,o=i.algorithm;if(k.log(`m.room_key_request from ${n}:${r} for ${s} / ${i.session_id} (id ${e.requestId})`),n!==this.userId){if(!this.roomEncryptors.get(s)){k.debug(`room key request for unencrypted room ${s}`);return}const c=this.roomEncryptors.get(s),l=this.deviceList.getStoredDevice(n,r);if(!l){k.debug(`Ignoring keyshare for unknown device ${n}:${r}`);return}try{await c.reshareKeyWithDevice(i.sender_key,i.session_id,n,l)}catch(u){k.warn("Failed to re-share keys for session "+i.session_id+" with device "+n+":"+l.deviceId,u)}return}if(r===this.deviceId){k.log("Ignoring room key request from ourselves");return}if(!this.roomDecryptors.has(s)){k.log(`room key request for unencrypted room ${s}`);return}const a=this.roomDecryptors.get(s).get(o);if(!a){k.log(`room key request for unknown alg ${o} in room ${s}`);return}if(!await a.hasKeysForKeyRequest(e)){k.log(`room key request for unknown session ${s} / `+i.session_id);return}if(e.share=()=>{a.shareKeysWithDevice(e)},this.checkDeviceTrust(n,r).isVerified()){k.log("device is already verified: sharing keys"),e.share();return}this.emit("crypto.roomKeyRequest",e)}async processReceivedRoomKeyRequestCancellation(e){k.log(`m.room_key_request cancellation for ${e.userId}:${e.deviceId} (id ${e.requestId})`),this.emit("crypto.roomKeyRequestCancellation",e)}getRoomDecryptor(e,n){let r,i;if(e&&(r=this.roomDecryptors.get(e),r||(r=new Map,this.roomDecryptors.set(e,r)),i=r.get(n),i))return i;const s=rM.get(n);if(!s)throw new jr(Gn.UNKNOWN_ENCRYPTION_ALGORITHM,'Unknown encryption algorithm "'+n+'".');return i=new s({userId:this.userId,crypto:this,olmDevice:this.olmDevice,baseApis:this.baseApis,roomId:e??void 0}),r&&r.set(n,i),i}getRoomDecryptors(e){const n=[];for(const r of this.roomDecryptors.values())r.has(e)&&n.push(r.get(e));return n}async signObject(e){const n=new Map(Object.entries(e.signatures||{})),r=e.unsigned;delete e.signatures,delete e.unsigned;const i=n.get(this.userId)||{};n.set(this.userId,i),i["ed25519:"+this.deviceId]=await this.olmDevice.sign(du.stringify(e)),e.signatures=xh(n),r!==void 0&&(e.unsigned=r)}isRoomEncrypted(e){return this.roomList.isRoomEncrypted(e)}async isEncryptionEnabledInRoom(e){return this.isRoomEncrypted(e)}getRoomEncryption(e){return this.roomList.getRoomEncryption(e)}async isDehydrationSupported(){return!1}async startDehydration(e){throw new Error("Not implemented")}}function WE(t){if(typeof t!="string"||t.indexOf(",")<0)return null;const e=Uint8Array.from(t.split(","),n=>parseInt(n));return hs(e)}class ACe{constructor(e){const n=e.getContent();this.userId=e.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id,this.requestBody=n.body||{},this.share=()=>{throw new Error("don't know how to share keys for this request yet")}}}class LCe{constructor(e){const n=e.getContent();this.userId=e.getSender(),this.deviceId=n.requesting_device_id,this.requestId=n.request_id}}class DCe{constructor(e){this.ourEvent=e,this.ourEventIndex=0,this.paginateTokens={[It.Backward]:null,[It.Forward]:null},this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(e=!1){return this.paginateTokens[e?It.Backward:It.Forward]}setPaginateToken(e,n=!1){this.paginateTokens[n?It.Backward:It.Forward]=e??null}addEvents(e,n=!1){n?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class q2{constructor(e,n){this.rank=e,this.context=n}static fromJson(e,n){const r=e.context||{};let i=(r.events_before||[]).map(n),s=(r.events_after||[]).map(n);const o=new DCe(n(e.result)),a=o.ourEvent.threadRootId;return i=i.filter(c=>c.threadRootId===a),s=s.filter(c=>c.threadRootId===a),o.setPaginateToken(r.start,!0),o.addEvents(i,!0),o.addEvents(s,!1),o.setPaginateToken(r.end,!1),new q2(e.rank,o)}}var A4=(t=>(t.Public="public",t.Private="private",t))(A4||{}),Tb=(t=>(t.PrivateChat="private_chat",t.TrustedPrivateChat="trusted_private_chat",t.PublicChat="public_chat",t))(Tb||{}),hu=(t=>(t.Public="public",t.Invite="invite",t.Private="private",t.Knock="knock",t.Restricted="restricted",t))(hu||{}),$J=(t=>(t.RoomMembership="m.room_membership",t))($J||{}),Z0=(t=>(t.CanJoin="can_join",t.Forbidden="forbidden",t))(Z0||{}),G2=(t=>(t.Invited="invited",t.Joined="joined",t.Shared="shared",t.WorldReadable="world_readable",t))(G2||{});function NCe(t,e){let n=!!e.preventReEmit;const r=e.decrypt!==!1;function i(s){e.toDevice&&delete s.room_id;const o=t.getRoom(s.room_id);let a;o&&s.state_key===void 0&&(a=o.findEventById(s.event_id)),!a||a.status?a=new oi(s):(a.setUnsigned({...a.getUnsigned(),...s.unsigned}),n=!0);const c=a.getServerAggregatedRelation(qn.Replace);if(c!=null&&c.content){const u=i(c);a.makeReplaced(u)}const l=o==null?void 0:o.findThreadForEvent(a);return l&&a.setThread(l),a.isEncrypted()&&(n||t.reEmitter.reEmit(a,[sn.Decrypted]),r&&t.decryptEventIfNeeded(a)),n||(t.reEmitter.reEmit(a,[sn.Replaced,sn.VisibilityChange]),o==null||o.reEmitter.reEmit(a,[sn.BeforeRedaction])),a}return i}class YF{constructor(e,n,r){this.client=e,this.indexEvent=n,this.directory=r}get id(){const e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return this.indexEvent.getContent().active===!0}get version(){return this.indexEvent.getContent().version??1}get roomId(){return this.indexEvent.getRoomId()}async delete(){await this.client.sendStateEvent(this.roomId,eu.name,{},this.id),await this.client.redactEvent(this.roomId,this.id);const e=(await this.getVersionHistory())[1];e&&await e.delete()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}async setName(e){await this.client.sendStateEvent(this.roomId,eu.name,{...this.indexEvent.getContent(),name:e},this.id)}isLocked(){return this.indexEvent.getContent().locked||!1}async setLocked(e){await this.client.sendStateEvent(this.roomId,eu.name,{...this.indexEvent.getContent(),locked:e},this.id)}async getFileInfo(){const n=(await this.getFileEvent()).getOriginalContent().file,r=this.client.mxcUrlToHttp(n.url);if(!r)throw new Error(`No HTTP URL available for ${n.url}`);return{info:n,httpUrl:r}}async getFileEvent(){const e=this.client.getRoom(this.roomId);if(!e)throw new Error("Unknown room");let n=e.getUnfilteredTimelineSet().findEventById(this.id);for(;!n&&e.getLiveTimeline().getState(He.BACKWARDS).paginationToken;)await this.client.scrollback(e,100),n=e.getUnfilteredTimelineSet().findEventById(this.id);if(!n)throw new Error("Failed to find event");return await this.client.decryptEventIfNeeded(n),n}async createNewVersion(e,n,r,i){const s=await this.directory.createFile(e,n,r,{...i??{},"m.new_content":!0,"m.relates_to":{rel_type:qn.Replace,event_id:this.id}});return await this.client.sendStateEvent(this.roomId,eu.name,{active:!0,name:e,version:this.version+1},s.event_id),await this.client.sendStateEvent(this.roomId,eu.name,{...this.indexEvent.getContent(),active:!1},this.id),s}async getVersionHistory(){const e=[];e.push(this);const n=this.client.getRoom(this.roomId);if(!n)throw new Error("Invalid or unknown room");const r=[...n.getLiveTimeline().getEvents()].reverse();let i,s=await this.getFileEvent();do if(i=r.find(o=>o.replacingEventId()===s.getId()),i){const o=this.directory.getFile(i.getId());if(o)e.push(o),s=i;else break}while(i);return e}}const UCe={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[Z.RoomPowerLevels]:100,[Z.RoomHistoryVisibility]:100,[Z.RoomTombstone]:100,[Z.RoomEncryption]:100,[Z.RoomName]:50,[Z.RoomMessage]:50,[Z.RoomMessageEncrypted]:50,[Z.Sticker]:50},users:{}};class JF{constructor(e,n){if(this.client=e,this.roomId=n,this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){const e=this.room.currentState.getStateEvents(Z.SpaceParent);return e!=null&&e.length?e.every(n=>{var r;return!((r=n.getContent())!=null&&r.via)}):!0}async setName(e){await this.client.sendStateEvent(this.roomId,Z.RoomName,{name:e},"")}async invite(e,n=!0,r=!0){const i=[this.retryInvite(e)];return n&&i.push(...this.getDirectories().map(s=>s.invite(e,n,r))),Promise.all(i).then(()=>{r&&MJ(this.room)&&this.client.sendSharedHistoryKeys(this.roomId,[e])})}retryInvite(e){return B_e(async()=>{await this.client.invite(this.roomId,e).catch(n=>{throw(n==null?void 0:n.errcode)==="M_FORBIDDEN"?new VW.AbortError(n):n})})}async setPermissions(e,n){var l;const r=this.room.currentState.getStateEvents(Z.RoomPowerLevels,"");if(Array.isArray(r))throw new Error("Unexpected return type for power levels");const i=(r==null?void 0:r.getContent())||{},s=i.users_default||0,o=i.events_default||50,a=((l=i.events)==null?void 0:l[Z.RoomPowerLevels])||100,c=i.users||{};switch(n){case"viewer":c[e]=s;break;case"editor":c[e]=o;break;case"owner":c[e]=a;break;default:throw new Error("Invalid role: "+n)}i.users=c,await this.client.sendStateEvent(this.roomId,Z.RoomPowerLevels,i,"")}getPermissions(e){var c,l;const n=this.room.currentState.getStateEvents(Z.RoomPowerLevels,"");if(Array.isArray(n))throw new Error("Unexpected return type for power levels");const r=(n==null?void 0:n.getContent())||{},i=r.users_default||0,s=r.events_default||50,o=((c=r.events)==null?void 0:c[Z.RoomPowerLevels])||100,a=((l=r.users)==null?void 0:l[e])||i;return a>=o?"owner":a>=s?"editor":"viewer"}async createDirectory(e){const n=await this.client.unstableCreateFileTree(e);return await this.client.sendStateEvent(this.roomId,Z.SpaceChild,{via:[this.client.getDomain()]},n.roomId),await this.client.sendStateEvent(n.roomId,Z.SpaceParent,{via:[this.client.getDomain()]},this.roomId),n}getDirectories(){const e=[],n=this.room.currentState.getStateEvents(Z.SpaceChild);for(const r of n)try{const i=r.getStateKey();if(i){const s=this.client.unstableGetFileTreeSpace(i);s&&e.push(s)}}catch(i){k.warn("Unable to create tree space instance for listing. Are we joined?",i)}return e}getDirectory(e){return this.getDirectories().find(n=>n.roomId===e)}async delete(){const e=this.getDirectories();for(const i of e)await i.delete();const n=[Ge.Invite,Ge.Knock,Ge.Join],r=this.room.currentState.getStateEvents(Z.RoomMember);for(const i of r)if(i.getStateKey()!==this.client.getUserId()&&n.includes(i.getContent().membership)){const o=i.getStateKey();if(!o)throw new Error("State key not found for branch");await this.client.kick(this.roomId,o,"Room deleted")}await this.client.leave(this.roomId)}getOrderedChildren(e){const n=e.map(r=>({roomId:r.getStateKey(),order:r.getContent().order})).filter(r=>r.roomId);return n.sort((r,i)=>{var s,o;if(r.order&&!i.order)return-1;if(!r.order&&i.order)return 1;if(!r.order&&!i.order){const a=this.client.getRoom(r.roomId),c=this.client.getRoom(i.roomId);if(!a||!c)return BE(r.roomId,i.roomId);const l=((s=a.currentState.getStateEvents(Z.RoomCreate,""))==null?void 0:s.getTs())??0,u=((o=c.currentState.getStateEvents(Z.RoomCreate,""))==null?void 0:o.getTs())??0;return l===u?BE(r.roomId,i.roomId):l-u}else return BE(r.order,i.order)}),n}getParentRoom(){const n=this.room.currentState.getStateEvents(Z.SpaceParent)[0];if(!n)throw new Error("Expected to have a parent in a non-top level space");const r=n.getStateKey();if(!r)throw new Error("No state key found for parent");const i=this.client.getRoom(r);if(!i)throw new Error("Unable to locate room for parent");return i}getOrder(){if(this.isTopLevel)return-1;const n=this.getParentRoom().currentState.getStateEvents(Z.SpaceChild);return this.getOrderedChildren(n).findIndex(i=>i.roomId===this.roomId)}async setOrder(e){if(this.isTopLevel)throw new Error("Cannot set order of top level spaces currently");const n=this.getParentRoom(),r=n.currentState.getStateEvents(Z.SpaceChild),i=this.getOrderedChildren(r);e=Math.max(Math.min(e,i.length-1),0);const o=this.getOrder()<e;o&&e===i.length-1?e--:!o&&e===0&&e++;const a=i[o?e:e-1],c=i[o?e+1:e];let l=af[0],u=!1;if(!a)c!=null&&c.order&&(l=U$(c.order));else if(e===i.length-1)c!=null&&c.order&&(l=Py(c.order));else{const p=a==null?void 0:a.order,m=c==null?void 0:c.order;p&&m?p===m?l=Py(p):l=j_e(p,m):p?l=Py(p):m?l=U$(m):u=!0}if(u){let p;for(let m=0;m<=e;m++){const v=i[m];if(m===0&&(p=v.order),v.order)p=v.order;else{p=p?Py(p):af[0];const S=n.currentState.getStateEvents(Z.SpaceChild,v.roomId),_=(S==null?void 0:S.getContent())??{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,Z.SpaceChild,{..._,order:p},v.roomId)}}p&&(l=Py(p))}const d=n.currentState.getStateEvents(Z.SpaceChild,this.roomId),f=(d==null?void 0:d.getContent())??{via:[this.client.getDomain()]};await this.client.sendStateEvent(n.roomId,Z.SpaceChild,{...f,order:l},this.roomId)}async createFile(e,n,r,i){const{content_uri:s}=await this.client.uploadContent(n,{includeFilename:!1});r.url=s;const o={msgtype:Oa.File,body:e,url:s,file:r};i=i??{},i["m.new_content"]&&(i["m.new_content"]=o);const a=await this.client.sendMessage(this.roomId,{...i,...o,[sY.name]:{}});return await this.client.sendStateEvent(this.roomId,eu.name,{active:!0,name:e},a.event_id),a}getFile(e){const n=this.room.currentState.getStateEvents(eu.name,e);return n?new YF(this.client,n,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){return(this.room.currentState.getStateEvents(eu.name)??[]).map(n=>new YF(this.client,n,this))}}var L4=(t=>(t.Recent="recent",t.Rank="rank",t))(L4||{}),FJ=(t=>(t.LocalStreamsChanged="local_streams_changed",t))(FJ||{});class $Ce extends Fn{constructor(e){super(),this.client=e,this.userMediaStreams=[],this.screensharingStreams=[]}restoreMediaSettings(e,n){this.audioInput=e,this.videoInput=n}async setAudioInput(e){k.info(`MediaHandler setAudioInput() running (deviceId=${e})`),this.audioInput!==e&&(this.audioInput=e,await this.updateLocalUsermediaStreams())}async setAudioSettings(e){k.info(`MediaHandler setAudioSettings() running (opts=${JSON.stringify(e)})`),this.audioSettings=Object.assign({},e),await this.updateLocalUsermediaStreams()}async setVideoInput(e){k.info(`MediaHandler setVideoInput() running (deviceId=${e})`),this.videoInput!==e&&(this.videoInput=e,await this.updateLocalUsermediaStreams())}async setMediaInputs(e,n){k.log(`MediaHandler setMediaInputs() running (audioInput: ${e} videoInput: ${n})`),this.audioInput=e,this.videoInput=n,await this.updateLocalUsermediaStreams()}async updateLocalUsermediaStreams(){if(this.userMediaStreams.length===0)return;const e=new Map;for(const n of this.client.callEventHandler.calls.values())e.set(n.callId,{audio:n.hasLocalUserMediaAudioTrack,video:n.hasLocalUserMediaVideoTrack});for(const n of this.userMediaStreams){k.log(`MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=${n.id})`);for(const r of n.getTracks())r.stop()}this.userMediaStreams=[],this.localUserMediaStream=void 0;for(const n of this.client.callEventHandler.calls.values()){if(n.callHasEnded()||!e.has(n.callId))continue;const{audio:r,video:i}=e.get(n.callId);k.log(`MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=${n.callId})`);const s=await this.getUserMediaStream(r,i);n.callHasEnded()||await n.updateLocalUsermediaStream(s)}for(const n of this.client.groupCallEventHandler.groupCalls.values()){if(!n.localCallFeed)continue;k.log(`MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=${n.groupCallId})`);const r=await this.getUserMediaStream(!0,n.type===B2.Video);n.state!==E4.Ended&&await n.updateLocalUsermediaStream(r)}this.emit("local_streams_changed")}async hasAudioDevice(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="audioinput").length>0}catch(e){return k.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}async hasVideoDevice(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput").length>0}catch(e){return k.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",e),!1}}async getUserMediaStream(e,n,r=!0){return this.getMediaStreamPromise?this.getMediaStreamPromise=this.getMediaStreamPromise.then(()=>this.getUserMediaStreamInternal(e,n,r)):this.getMediaStreamPromise=this.getUserMediaStreamInternal(e,n,r),this.getMediaStreamPromise}async getUserMediaStreamInternal(e,n,r){var c,l,u,d,f;const i=e&&await this.hasAudioDevice(),s=n&&await this.hasVideoDevice();let o,a=!0;if(this.localUserMediaStream?(i!==this.localUserMediaStream.getAudioTracks().length>0&&(a=!1),s!==this.localUserMediaStream.getVideoTracks().length>0&&(a=!1),i&&((l=(c=this.localUserMediaStream.getAudioTracks()[0])==null?void 0:c.getSettings())==null?void 0:l.deviceId)!==this.audioInput&&(a=!1),s&&((d=(u=this.localUserMediaStream.getVideoTracks()[0])==null?void 0:u.getSettings())==null?void 0:d.deviceId)!==this.videoInput&&(a=!1)):a=!1,a){if(o=this.localUserMediaStream.clone(),k.log(`MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=${(f=this.localUserMediaStream)==null?void 0:f.id} newStreamId=${o.id} shouldRequestAudio=${i} shouldRequestVideo=${s})`),!i)for(const p of o.getAudioTracks())o.removeTrack(p);if(!s)for(const p of o.getVideoTracks())o.removeTrack(p)}else{const p=this.getUserMediaContraints(i,s);o=await navigator.mediaDevices.getUserMedia(p),k.log(`MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=${o.id}, shouldRequestAudio=${i}, shouldRequestVideo=${s}, constraints=${JSON.stringify(p)})`);for(const m of o.getTracks()){const v=m.getSettings();m.kind==="audio"?this.audioInput=v.deviceId:m.kind==="video"&&(this.videoInput=v.deviceId)}r&&(this.localUserMediaStream=o)}return r&&this.userMediaStreams.push(o),this.emit("local_streams_changed"),o}stopUserMediaStream(e){var r;k.log(`MediaHandler stopUserMediaStream() stopping (streamId=${e.id})`);for(const i of e.getTracks())i.stop();const n=this.userMediaStreams.indexOf(e);if(n!==-1&&(k.debug(`MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=${e.id})`,e.id),this.userMediaStreams.splice(n,1)),this.emit("local_streams_changed"),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(const i of e.getTracks())if((r=this.localUserMediaStream)!=null&&r.getTrackById(i.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}async getScreensharingStream(e={},n=!0){let r;if(this.screensharingStreams.length===0){const i=this.getScreenshareContraints(e);e.desktopCapturerSourceId?(k.debug(`MediaHandler getScreensharingStream() calling getUserMedia() (opts=${JSON.stringify(e)})`),r=await navigator.mediaDevices.getUserMedia(i)):(k.debug(`MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=${JSON.stringify(e)})`),r=await navigator.mediaDevices.getDisplayMedia(i))}else{const i=this.screensharingStreams[this.screensharingStreams.length-1];k.log(`MediaHandler getScreensharingStream() cloning (streamId=${i.id})`),r=i.clone()}return n&&this.screensharingStreams.push(r),this.emit("local_streams_changed"),r}stopScreensharingStream(e){k.debug(`MediaHandler stopScreensharingStream() stopping stream (streamId=${e.id})`);for(const r of e.getTracks())r.stop();const n=this.screensharingStreams.indexOf(e);n!==-1&&(k.debug(`MediaHandler stopScreensharingStream() splicing stream out (streamId=${e.id})`),this.screensharingStreams.splice(n,1)),this.emit("local_streams_changed")}stopAllStreams(){for(const e of this.userMediaStreams){k.log(`MediaHandler stopAllStreams() stopping (streamId=${e.id})`);for(const n of e.getTracks())n.stop()}for(const e of this.screensharingStreams)for(const n of e.getTracks())n.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit("local_streams_changed")}getUserMediaContraints(e,n){const r=!!navigator.webkitGetUserMedia;return{audio:e?{deviceId:this.audioInput?{ideal:this.audioInput}:void 0,autoGainControl:this.audioSettings?{ideal:this.audioSettings.autoGainControl}:void 0,echoCancellation:this.audioSettings?{ideal:this.audioSettings.echoCancellation}:void 0,noiseSuppression:this.audioSettings?{ideal:this.audioSettings.noiseSuppression}:void 0}:!1,video:n?{deviceId:this.videoInput?{ideal:this.videoInput}:void 0,width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}:!1}}getScreenshareContraints(e){const{desktopCapturerSourceId:n,audio:r}=e;return n?{audio:r??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n}}}:{audio:r??!1,video:!0}}}var dM=(t=>(t.RequestFinished="FINISHED",t.Complete="COMPLETE",t))(dM||{}),Kv=(t=>(t.PreProcess="ExtState.PreProcess",t.PostProcess="ExtState.PostProcess",t))(Kv||{}),EC=(t=>(t.RoomData="SlidingSync.RoomData",t.Lifecycle="SlidingSync.Lifecycle",t.List="SlidingSync.List",t))(EC||{});const FCe=3;class BCe{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return Kv.PreProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){e.device_lists&&await this.crypto.processDeviceLists(e.device_lists),await this.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),this.crypto.onSyncCompleted({})}}class jCe{constructor(e,n){this.client=e,this.cryptoCallbacks=n,this.nextBatch=null}name(){return"to_device"}when(){return Kv.PreProcess}onRequest(e){const n={since:this.nextBatch!==null?this.nextBatch:void 0};return e&&(n.limit=100,n.enabled=!0),n}async onResponse(e){const n=[];let r=e.events||[];r.length>0&&this.cryptoCallbacks&&(r=await this.cryptoCallbacks.preprocessToDeviceMessages(r)),r.map(this.client.getEventMapper()).map(i=>{if(i.getType()==="m.key.verification.cancel"){const s=i.getContent().transaction_id;s&&n.push(s)}return i}).forEach(i=>{const s=i.getContent();if(i.getType()=="m.room.message"&&s.msgtype=="m.bad.encrypted"){k.log("Ignoring undecryptable to-device event from "+i.getSender());return}if(i.getType()==="m.key.verification.start"||i.getType()==="m.key.verification.request"){const o=s.transaction_id;n.includes(o)&&i.flagCancelled()}this.client.emit(qe.ToDeviceEvent,i)}),this.nextBatch=e.next_batch}}class HCe{constructor(e){this.client=e}name(){return"account_data"}when(){return Kv.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){e.global&&e.global.length>0&&this.processGlobalAccountData(e.global);for(const n in e.rooms){const r=hm(this.client,n,e.rooms[n]),i=this.client.getRoom(n);if(!i){k.warn("got account data for room but room doesn't exist on client:",n);continue}i.addAccountData(r),r.forEach(s=>{this.client.emit(qe.Event,s)})}}processGlobalAccountData(e){const n=hm(this.client,void 0,e),r=n.reduce((i,s)=>(i[s.getType()]=this.client.store.getAccountData(s.getType()),i),{});this.client.store.storeAccountDataEvents(n),n.forEach(i=>{if(i.getType()===Z.PushRules){const o=i.getContent();this.client.setPushRules(o)}const s=r[i.getType()];return this.client.emit(qe.AccountData,i,s),i})}}class KCe{constructor(e){this.client=e}name(){return"typing"}when(){return Kv.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e!=null&&e.rooms)for(const n in e.rooms)jJ(this.client,n,[e.rooms[n]])}}class VCe{constructor(e){this.client=e}name(){return"receipts"}when(){return Kv.PostProcess}onRequest(e){if(e)return{enabled:!0}}async onResponse(e){if(e!=null&&e.rooms)for(const n in e.rooms)jJ(this.client,n,[e.rooms[n]])}}class BJ{constructor(e,n,r,i){this.slidingSync=e,this.client=n,this.syncState=null,this.lastPos=null,this.failCount=0,this.notifEvents=[],this.opts=QY(r),this.syncOpts=eJ(i),n.getNotifTimelineSet()&&n.reEmitter.reEmit(n.getNotifTimelineSet(),[ct.Timeline,ct.TimelineReset]),this.slidingSync.on(EC.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(EC.RoomData,this.onRoomData.bind(this));const s=[new jCe(this.client,this.syncOpts.cryptoCallbacks),new HCe(this.client),new KCe(this.client),new VCe(this.client)];this.syncOpts.crypto&&s.push(new BCe(this.syncOpts.crypto)),s.forEach(o=>{this.slidingSync.registerExtension(o)})}async onRoomData(e,n){let r=this.client.store.getRoom(e);if(!r){if(!n.initial){k.debug("initial flag not set but no stored room exists for room ",e,n);return}r=tJ(this.client,e,this.opts)}await this.processRoomData(this.client,r,n)}onLifecycle(e,n,r){switch(r&&k.debug("onLifecycle",e,r),e){case dM.Complete:if(this.purgeNotifications(),!n)break;this.lastPos||this.updateSyncState(ii.Prepared,{oldSyncToken:void 0,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(ii.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.lastPos=n.pos;break;case dM.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>FCe?ii.Error:ii.Reconnecting,{error:new Ii(r)}),this.shouldAbortSync(new Ii(r)))return}else this.failCount=0;break}}async syncLeftRooms(){return[]}async peek(e){return null}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){return this.syncStateData??null}createRoom(e){const{timelineSupport:n}=this.client,r=new U2(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n});return this.client.reEmitter.reEmit(r,[ct.Name,ct.Redaction,ct.RedactionCancelled,ct.Receipt,ct.Tags,ct.LocalEchoUpdated,ct.AccountData,ct.MyMembership,ct.Timeline,ct.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[xt.Events,xt.Members,xt.NewMember,xt.Update]),e.currentState.on(xt.NewMember,(n,r,i)=>{i.user=this.client.getUser(i.userId)??void 0,this.client.reEmitter.reEmit(i,[Hs.Name,Hs.Typing,Hs.PowerLevel,Hs.Membership])})}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(k.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(ii.Error,{error:e}),!0):!1}async processRoomData(e,n,r){r=qCe(e,n.roomId,r);const i=hm(this.client,n.roomId,r.required_state);let s=hm(this.client,n.roomId,r.timeline,!1);const o=[];if(r.initial){const l=new Set;n.getLiveTimeline().getEvents().forEach(p=>{l.add(p.getId())});const u=[],d=[];let f=!1;for(let p=s.length-1;p>=0;p--){const m=s[p];if(l.has(m.getId())){f=!0;continue}f?u.push(m):d.unshift(m)}s=d,u.length>0&&n.addEventsToTimeline(u,!0,n.getLiveTimeline(),r.prev_batch)}const a=n.hasEncryptionStateEvent();if(r.notification_count!=null&&n.setUnreadNotificationCount(xr.Total,r.notification_count),r.highlight_count!=null&&(!a||a&&n.getUnreadNotificationCount(xr.Highlight)<=0)&&n.setUnreadNotificationCount(xr.Highlight,r.highlight_count),Number.isInteger(r.invited_count)&&n.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&n.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){const l=hm(this.client,n.roomId,r.invite_state);await this.injectRoomEvents(n,l),r.initial&&(n.recalculate(),this.client.store.storeRoom(n),this.client.emit(qe.Room,n)),l.forEach(u=>{this.client.emit(qe.Event,u)}),n.updateMyMembership(Ge.Invite);return}r.initial&&n.getLiveTimeline().setPaginationToken(r.prev_batch??null,He.BACKWARDS),await this.injectRoomEvents(n,i,s,r.num_live),n.addEphemeralEvents(o),n.updateMyMembership(Ge.Join),n.recalculate(),r.initial&&(e.store.storeRoom(n),e.emit(qe.Room,n)),this.addNotifications(s);const c=async l=>{e.emit(qe.Event,l),l.isState()&&l.getType()==Z.RoomEncryption&&this.syncOpts.cryptoCallbacks&&await this.syncOpts.cryptoCallbacks.onCryptoEvent(n,l)};await Bg(i,c),await Bg(s,c),o.forEach(function(l){e.emit(qe.Event,l)}),n.decryptCriticalEvents()}async injectRoomEvents(e,n,r,i){r=r||[],n=n||[],i=i||0;const s=e.getLiveTimeline(),o=s.getEvents().length==0;if(o){for(const c of n)this.client.getPushActionsForEvent(c);s.initialiseState(n)}o||(e.oldState.setStateEvents(n),e.currentState.setStateEvents(n));let a=[];i>0&&(a=r.slice(-1*i),r=r.slice(0,-1*a.length)),await e.addLiveEvents(r,{fromCache:!0}),a.length>0&&await e.addLiveEvents(a,{fromCache:!1}),e.recalculate(),this.resolveInvites(e)}resolveInvites(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const n=this.client;e.getMembersWithMembership(Ge.Invite).forEach(function(r){if(r.requestedProfileInfo)return;r.requestedProfileInfo=!0;const i=n.getUser(r.userId);let s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){const a=r.events.member;a.getContent().membership===Ge.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})})}retryImmediately(){return!0}async sync(){for(k.debug("Sliding sync init loop");!this.client.isGuest();)try{k.debug("Getting push rules...");const e=await this.client.getPushRules();k.debug("Got push rules"),this.client.pushRules=e;break}catch(e){if(k.error("Getting push rules failed",e),this.shouldAbortSync(e))return}await this.slidingSync.start()}stop(){k.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,n){const r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(qe.Sync,this.syncState,r,n)}addNotifications(e){if(this.client.getNotifTimelineSet())for(const n of e){const r=this.client.getPushActionsForEvent(n);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(n)}}purgeNotifications(){this.notifEvents.sort(function(e,n){return e.getTs()-n.getTs()}),this.notifEvents.forEach(e=>{var n;(n=this.client.getNotifTimelineSet())==null||n.addLiveEvent(e)}),this.notifEvents=[]}}function qCe(t,e,n){if(!n.name)return n;for(const r of n.required_state)if(r.type===Z.RoomName&&r.state_key==="")return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+e,state_key:"",type:Z.RoomName,content:{name:n.name},sender:t.getUserId(),origin_server_ts:new Date().getTime()}),n}function hm(t,e,n,r=!0){const i=t.getEventMapper({decrypt:r});return n.map(function(s){return s.room_id=e,i(s)})}function jJ(t,e,n){const r=hm(t,e,n),i=t.getRoom(e);if(!i){k.warn("got ephemeral events for room but room doesn't exist on client:",e);return}i.addEphemeralEvents(r),r.forEach(s=>{t.emit(qe.Event,s)})}const D4=new or("m.beacon_info","org.matrix.msc3672.beacon_info"),fM=new or("m.beacon","org.matrix.msc3672.beacon");class ev{constructor(e=ev.RETRY_BACKOFF_RATELIMIT,n=ev.QUEUE_MESSAGES){this.retryAlgorithm=e,this.queueAlgorithm=n,this.queues={},this.activeQueues=[],this.procFn=null,this.processQueue=r=>{const i=this.peekNextEvent(r);if(!i){this.disableQueue(r);return}fw("Queue '%s' has %s pending events",r,this.queues[r].length),Promise.resolve().then(()=>this.procFn(i.event)).then(s=>{this.removeNextEvent(r),fw("Queue '%s' sent event %s",r,i.event.getId()),i.defer.resolve(s),this.processQueue(r)},s=>{i.attempts+=1;const o=this.retryAlgorithm(i.event,i.attempts,s);fw("retry(%s) err=%s event_id=%s waitTime=%s",i.attempts,s,i.event.getId(),o),o===-1?(k.info("Queue '%s' giving up on event %s",r,i.event.getId()),this.clearQueue(r,s)):setTimeout(this.processQueue,o,r)})}}static RETRY_BACKOFF_RATELIMIT(e,n,r){return zY(r,n,!1)}static QUEUE_MESSAGES(e){return e.getType()===Z.RoomMessage||e.hasAssociation()?"message":null}getQueueForEvent(e){const n=this.queueAlgorithm(e);return!n||!this.queues[n]?null:this.queues[n].map(function(r){return r.event})}removeEventFromQueue(e){const n=this.queueAlgorithm(e);if(!n||!this.queues[n])return!1;let r=!1;return ZT(this.queues[n],i=>i.event.getId()===e.getId()?(r=!0,!0):!1),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){const n=this.queueAlgorithm(e);if(!n)return null;this.queues[n]||(this.queues[n]=[]);const r=Ef();return this.queues[n].push({event:e,defer:r,attempts:0}),fw("Queue algorithm dumped event %s into queue '%s'",e.getId(),n),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>this.activeQueues.indexOf(e)===-1&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){const n=this.activeQueues.indexOf(e);n>=0&&this.activeQueues.splice(n,1),k.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,n){k.info("clearing queue '%s'",e);let r;for(;r=this.removeNextEvent(e);)r.defer.reject(n);this.disableQueue(e)}peekNextEvent(e){const n=this.queues[e];if(Array.isArray(n))return n[0]}removeNextEvent(e){const n=this.queues[e];if(Array.isArray(n))return n.shift()}}function fw(...t){}const XF=20;class GCe{constructor(e){this.client=e,this.sending=!1,this.running=!0,this.retryTimeout=null,this.retryAttempts=0,this.sendQueue=async()=>{if(this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.sending||!this.running)return;k.debug("Attempting to send queued to-device messages"),this.sending=!0;let n;try{for(;this.running&&(n=await this.client.store.getOldestToDeviceBatch(),n!==null);)await this.sendBatch(n),await this.client.store.removeToDeviceBatch(n.id),this.retryAttempts=0;if(!this.running)return;k.debug("All queued to-device messages sent")}catch(r){++this.retryAttempts;const i=ev.RETRY_BACKOFF_RATELIMIT(null,this.retryAttempts,r);if(i===-1){Math.floor(r.httpStatus/100)===4?(k.error("Fatal error when sending to-device message - dropping to-device batch!",r),await this.client.store.removeToDeviceBatch(n.id)):k.info("Automatic retry limit reached for to-device messages.");return}k.info(`Failed to send batch of to-device messages. Will retry in ${i}ms`,r),this.retryTimeout=setTimeout(this.sendQueue,i)}finally{this.sending=!1}},this.onResumedSync=(n,r)=>{n===ii.Syncing&&r!==ii.Syncing&&(k.info("Resuming queue after resumed sync"),this.sendQueue())}}start(){this.running=!0,this.sendQueue(),this.client.on(qe.Sync,this.onResumedSync)}stop(){this.running=!1,this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(qe.Sync,this.onResumedSync)}async queueBatch(e){const n=[];for(let r=0;r<e.batch.length;r+=XF){const i={eventType:e.eventType,batch:e.batch.slice(r,r+XF),txnId:this.client.makeTxnId()};n.push(i);const s=i.batch.map(o=>`${o.userId}/${o.deviceId} (msgid ${o.payload[vs]})`);k.info(`Enqueuing batch of to-device messages. type=${e.eventType} txnid=${i.txnId}`,s)}await this.client.store.saveToDeviceBatches(n),this.sendQueue()}async sendBatch(e){const n=new fr(()=>new Map);for(const r of e.batch)n.getOrCreate(r.userId).set(r.deviceId,r.payload);k.info(`Sending batch of ${e.batch.length} to-device messages with ID ${e.id} and txnId ${e.txnId}`),await this.client.sendToDevice(e.eventType,n,e.txnId)}}const S3=new ws.UnstableValue("m.policies","org.matrix.msc3847.policies"),hw=new ws.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),ZF={"m.policy.user":Z.PolicyRuleUser,"m.policy.room":Z.PolicyRuleRoom,"m.policy.server":Z.PolicyRuleServer};class zCe{constructor(e){this.client=e}async addRule(e,n,r){const i=await this.getOrCreateTargetRoom();return(await this.client.sendStateEvent(i.roomId,ZF[e],{entity:n,reason:r,recommendation:"m.ban"})).event_id}async removeRule(e){await this.client.redactEvent(e.getRoomId(),e.getId())}async addSource(e){await this.client.joinRoom(e);const n=(await this.getOrCreateSourceRooms()).map(r=>r.roomId);return n.includes(e)?!1:(n.push(e),await this.withIgnoreInvitesPolicies(r=>{r.sources=n}),!0)}async getRuleForInvite({sender:e,roomId:n}){const r=await this.getOrCreateSourceRooms(),i=e.split(":")[1],s=n.split(":")[1];for(const o of r){const a=o.getUnfilteredTimelineSet().getLiveTimeline().getState(He.FORWARDS);for(const{scope:c,entities:l}of[{scope:"m.policy.room",entities:[n]},{scope:"m.policy.user",entities:[e]},{scope:"m.policy.server",entities:[i,s]}]){const u=a.getStateEvents(ZF[c]);for(const d of u){const f=d.getContent();if((f==null?void 0:f.recommendation)!="m.ban")continue;const p=f==null?void 0:f.entity;if(!p)continue;let m;try{m=new RegExp(zW(p))}catch{continue}for(const v of l)if(v&&m.test(v))return d}}}return null}async getOrCreateTargetRoom(){let n=this.getIgnoreInvitesPolicies().target;if(typeof n!="string"&&(n=null),n){const r=this.client.getRoom(n);if(r)return r;n=null}return n=(await this.client.createRoom({name:"Individual Policy Room",preset:Tb.PrivateChat})).room_id,await this.withIgnoreInvitesPolicies(r=>{r.target=n}),this.client.getRoom(n)}async getOrCreateSourceRooms(){let n=this.getIgnoreInvitesPolicies().sources,r=!1;Array.isArray(n)||(r=!0,n=[]);let i=n.filter(s=>typeof s=="string").map(s=>this.client.getRoom(s)).filter(s=>!!s);if(i.length!=n.length&&(r=!0),i.length==0){const s=await this.getOrCreateTargetRoom();r=!0,i=[s]}return r&&await this.withIgnoreInvitesPolicies(s=>{s.sources=n}),i}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}async withIgnoreInvitesPolicies(e){const{policies:n,ignoreInvitesPolicies:r}=this.getPoliciesAndIgnoreInvitesPolicies();e(r),n[hw.name]=r,await this.client.setAccountData(S3.name,n)}getPoliciesAndIgnoreInvitesPolicies(){var i;let e={};for(const s of[S3.name,S3.altName]){if(!s)continue;const o=(i=this.client.getAccountData(s))==null?void 0:i.getContent();if(o){e=o;break}}let n={},r=!1;for(const s of[hw.name,hw.altName]){if(!s)continue;const o=e[s];if(o&&typeof o=="object"){n=o,r=!0;break}}return r||(e[hw.name]=n),{policies:e,ignoreInvitesPolicies:n}}}const w3="matrix-js-sdk";var N4=(t=>(t.Cancel="cancel",t.Restart="restart",t.Send="send",t))(N4||{});const HJ=t=>t.type==="livekit"&&"livekit_service_url"in t,hM=t=>HJ(t)&&"livekit_alias"in t,KJ=t=>t.type==="livekit"&&"focus_selection"in t,WCe=(t,e)=>{var r;const n="Malformed session membership event: ";return typeof t.device_id!="string"&&e.push(n+"device_id must be string"),typeof t.call_id!="string"&&e.push(n+"call_id must be string"),typeof t.application!="string"&&e.push(n+"application must be a string"),typeof((r=t.focus_active)==null?void 0:r.type)!="string"&&e.push(n+"focus_active.type must be a string"),Array.isArray(t.foci_preferred)||e.push(n+"foci_preferred must be an array"),t.created_ts&&typeof t.created_ts!="number"&&e.push(n+"created_ts must be number"),t.scope&&typeof t.scope!="string"&&e.push(n+"scope must be string"),e.length===0},ud=t=>"membershipID"in t,YCe=(t,e)=>{const n="Malformed legacy rtc membership event: ";return"expires"in t||"expires_ts"in t||e.push(n+"expires_ts or expires must be present"),"expires"in t&&typeof t.expires!="number"&&e.push(n+"expires must be numeric"),"expires_ts"in t&&typeof t.expires_ts!="number"&&e.push(n+"expires_ts must be numeric"),typeof t.device_id!="string"&&e.push(n+"device_id must be string"),typeof t.call_id!="string"&&e.push(n+"call_id must be string"),typeof t.application!="string"&&e.push(n+"application must be a string"),typeof t.membershipID!="string"&&e.push(n+"membershipID must be a string"),t.created_ts&&typeof t.created_ts!="number"&&e.push(n+"created_ts must be number"),t.scope&&typeof t.scope!="string"&&e.push(n+"scope must be string"),e.length===0};class Fy{constructor(e,n){this.parentEvent=e;const r=[],i=[];if(!WCe(n,r)&&!YCe(n,i))throw Error(`unknown CallMembership data. Does not match legacy call.member (${i.join(" & ")}) events nor MSC4143 (${r.join(" & ")})`);this.membershipData=n}static equal(e,n){return of(e.membershipData,n.membershipData)}get sender(){return this.parentEvent.getSender()}get eventId(){return this.parentEvent.getId()}get callId(){return this.membershipData.call_id}get deviceId(){return this.membershipData.device_id}get application(){return this.membershipData.application}get scope(){return this.membershipData.scope}get membershipID(){return ud(this.membershipData)?this.membershipData.membershipID:this.createdTs().toString()}createdTs(){return this.membershipData.created_ts??this.parentEvent.getTs()}getAbsoluteExpiry(){if(ud(this.membershipData))return"expires"in this.membershipData?this.createdTs()+this.membershipData.expires:this.membershipData.expires_ts}getLocalExpiry(){if(ud(this.membershipData))if("expires"in this.membershipData){const e=this.parentEvent.getTs()-this.createdTs();return this.parentEvent.localTimestamp-e+this.membershipData.expires}else return this.membershipData.expires_ts}getMsUntilExpiry(){if(ud(this.membershipData))return this.getAbsoluteExpiry()-Date.now()}isExpired(){return ud(this.membershipData)?this.getMsUntilExpiry()<=0:!1}getPreferredFoci(){return ud(this.membershipData)?this.membershipData.foci_active??[]:this.membershipData.foci_preferred}getFocusSelection(){if(ud(this.membershipData))return"oldest_membership";{const e=this.membershipData.focus_active;if(KJ(e))return e.focus_selection}}}const kt=k.getChild("MatrixRTCSession"),E3=60*60*1e3,QF=2*60*1e3,JCe=3e3,eB=3e3,tB=3e3,XCe=5e3,YE=(t,e)=>`${t}:${e}`,T3=t=>YE(t.sender,t.deviceId);function ZCe(t,e){return t===e?!0:!!t&&!!e&&t.length===e.length&&t.every((n,r)=>n===e[r])}var Su=(t=>(t.MembershipsChanged="memberships_changed",t.JoinStateChanged="join_state_changed",t.EncryptionKeyChanged="encryption_key_changed",t))(Su||{});class pm extends Fn{constructor(e,n,r){var s;super(),this.client=e,this.room=n,this.memberships=r,this.setNewKeyTimeouts=new Set,this.updateCallMembershipRunning=!1,this.needCallMembershipUpdate=!1,this.manageMediaKeys=!1,this.useLegacyMemberEvents=!0,this.encryptionKeys=new Map,this.currentEncryptionKeyIndex=-1,this.statistics={counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}},this.sendEncryptionKeysEvent=async o=>{var f;if(this.keysEventUpdateTimeout!==void 0&&(clearTimeout(this.keysEventUpdateTimeout),this.keysEventUpdateTimeout=void 0),this.lastEncryptionKeyUpdateRequest=Date.now(),!this.isJoined())return;kt.info(`Sending encryption keys event. indexToSend=${o}`);const a=this.client.getUserId(),c=this.client.getDeviceId();if(!a)throw new Error("No userId");if(!c)throw new Error("No deviceId");const l=this.getKeysForParticipant(a,c);if(!l){kt.warn("Tried to send encryption keys event but no keys found!");return}if(typeof o!="number"&&this.currentEncryptionKeyIndex===-1){kt.warn("Tried to send encryption keys event but no current key index found!");return}const u=o??this.currentEncryptionKeyIndex,d=l[u];try{const p={keys:[{index:u,key:$2(d)}],device_id:c,call_id:"",sent_ts:Date.now()};this.statistics.counters.roomEventEncryptionKeysSent+=1,await this.client.sendEvent(this.room.roomId,Z.CallEncryptionKeysPrefix,p),kt.debug(`Embedded-E2EE-LOG updateEncryptionKeyEvent participantId=${a}:${c} numKeys=${l.length} currentKeyIndex=${this.currentEncryptionKeyIndex} keyIndexToSend=${u}`,this.encryptionKeys)}catch(p){const m=p;if(m.event&&this.client.cancelPendingEvent(m.event),this.keysEventUpdateTimeout===void 0){const v=((f=m.data)==null?void 0:f.retry_after_ms)??5e3;kt.warn(`Failed to send m.call.encryption_key, retrying in ${v}`,p),this.keysEventUpdateTimeout=setTimeout(this.sendEncryptionKeysEvent,v)}else kt.info("Not scheduling key resend as another re-send is already pending")}},this.onCallEncryption=o=>{const a=o.getSender(),c=o.getContent(),l=c.device_id,u=c.call_id;if(!a){kt.warn(`Received m.call.encryption_keys with no userId: callId=${u}`);return}if(u!==""){kt.warn(`Received m.call.encryption_keys with unsupported callId: userId=${a}, deviceId=${l}, callId=${u}`);return}if(!Array.isArray(c.keys)){kt.warn(`Received m.call.encryption_keys where keys wasn't an array: callId=${u}`);return}if(a===this.client.getUserId()&&l===this.client.getDeviceId()){kt.info("Ignoring our own keys event");return}this.statistics.counters.roomEventEncryptionKeysReceived+=1;const d=Date.now()-(typeof c.sent_ts=="number"?c.sent_ts:o.getTs());this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=d;for(const f of c.keys){if(!f){kt.info("Ignoring false-y key in keys event");continue}const p=f.key,m=f.index;!p||m===void 0||m===null||u===void 0||u===null||typeof l!="string"||typeof u!="string"||typeof p!="string"||typeof m!="number"?kt.warn(`Malformed call encryption_key: userId=${a}, deviceId=${l}, encryptionKeyIndex=${m} callId=${u}`):(kt.debug(`Embedded-E2EE-LOG onCallEncryption userId=${a}:${l} encryptionKeyIndex=${m} age=${d}ms`,this.encryptionKeys),this.setEncryptionKey(a,l,m,p,o.getTs()))}},this.isMyMembership=o=>o.sender===this.client.getUserId()&&o.deviceId===this.client.getDeviceId(),this.onMembershipUpdate=()=>{var c;const o=this.memberships;if(this.memberships=pm.callMembershipsForRoom(this.room),this._callId=this._callId??((c=this.memberships[0])==null?void 0:c.callId),(o.length!=this.memberships.length||o.some((l,u)=>!Fy.equal(l,this.memberships[u])))&&(kt.info(`Memberships for call in room ${this.room.roomId} have changed: emitting`),this.emit("memberships_changed",o,this.memberships)),this.manageMediaKeys&&this.isJoined()&&this.makeNewKeyTimeout===void 0){const l=new Set(o.filter(m=>!this.isMyMembership(m)).map(T3)),u=new Set(this.memberships.filter(m=>!this.isMyMembership(m)).map(T3)),d=Array.from(l).some(m=>!u.has(m)),f=Array.from(u).some(m=>!l.has(m)),p=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),d)kt.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,tB);else if(f)kt.debug("New member(s) have joined: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,tB);else if(p){const m=this.lastMembershipFingerprints;(Array.from(p).some(S=>!m.has(S))||Array.from(m).some(S=>!p.has(S)))&&(kt.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestKeyEventSend())}}this.setExpiryTimer()},this.triggerCallMembershipEventUpdate=async()=>{if(this.updateCallMembershipRunning){this.needCallMembershipUpdate=!0;return}this.updateCallMembershipRunning=!0;try{do this.needCallMembershipUpdate=!1,await this.updateCallMembershipEvent();while(this.needCallMembershipUpdate)}finally{this.updateCallMembershipRunning=!1}},this.onRotateKeyTimeout=()=>{if(!this.manageMediaKeys)return;this.makeNewKeyTimeout=void 0,kt.info("Making new sender key for key rotation");const o=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(o)},this._callId=(s=r[0])==null?void 0:s.callId;const i=this.room.getLiveTimeline().getState(He.FORWARDS);i==null||i.on(xt.Members,this.onMembershipUpdate),this.setExpiryTimer()}get callId(){return this._callId}static callMembershipsForRoom(e){const n=e.getLiveTimeline().getState(He.FORWARDS);if(!n)throw kt.warn("Couldn't get state for room "+e.roomId),new Error("Could't get state for room "+e.roomId);const r=n.getStateEvents(Z.GroupCallMemberPrefix),i=[];for(const s of r){const o=s.getContent(),a=Object.keys(o).length;if(a===0)continue;let c=[];if(a>1&&"focus_active"in o)c.push(o);else if(a===1&&"memberships"in o){if(!Array.isArray(o.memberships)){kt.warn(`Malformed member event from ${s.getSender()}: memberships is not an array`);continue}c=o.memberships}if(c.length!==0)for(const l of c)try{const u=new Fy(s,l);if(u.callId!==""||u.scope!=="m.room"){kt.info("Ignoring user-scoped call");continue}if(u.isExpired()){kt.info(`Ignoring expired device membership ${u.sender}/${u.deviceId}`);continue}if(!e.hasMembershipState(u.sender??"",Ge.Join)){kt.info(`Ignoring membership of user ${u.sender} who is not in the room.`);continue}i.push(u)}catch(u){kt.warn("Couldn't construct call membership: ",u)}}return i.sort((s,o)=>s.createdTs()-o.createdTs()),i.length>1&&kt.debug(`Call memberships in room ${e.roomId}, in order: `,i.map(s=>[s.createdTs(),s.sender])),i}static roomSessionForRoom(e,n){const r=pm.callMembershipsForRoom(n);return new pm(e,n,r)}isJoined(){return this.relativeExpiry!==void 0}async stop(){await this.leaveRoomSession(1e3),this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0),this.memberEventTimeout&&(clearTimeout(this.memberEventTimeout),this.memberEventTimeout=void 0);const e=this.room.getLiveTimeline().getState(He.FORWARDS);e==null||e.off(xt.Members,this.onMembershipUpdate)}joinRoomSession(e,n,r){if(this.isJoined()){kt.info(`Already joined to session in room ${this.room.roomId}: ignoring join call`);return}this.ownFocusActive=n,this.ownFociPreferred=e,this.relativeExpiry=E3,this.manageMediaKeys=(r==null?void 0:r.manageMediaKeys)??this.manageMediaKeys,this.useLegacyMemberEvents=(r==null?void 0:r.useLegacyMemberEvents)??this.useLegacyMemberEvents,this.membershipId=Zi(5),kt.info(`Joining call session in room ${this.room.roomId} with manageMediaKeys=${this.manageMediaKeys}`),r!=null&&r.manageMediaKeys&&(this.makeNewSenderKey(),this.requestKeyEventSend()),this.triggerCallMembershipEventUpdate(),this.emit("join_state_changed",!0)}async leaveRoomSession(e=void 0){if(!this.isJoined())return kt.info(`Not joined to session in room ${this.room.roomId}: ignoring leave call`),new Promise(s=>s(!1));const n=this.client.getUserId(),r=this.client.getDeviceId();if(!n)throw new Error("No userId");if(!r)throw new Error("No deviceId");this.encryptionKeys.set(YE(n,r),[]),this.makeNewKeyTimeout!==void 0&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0);for(const s of this.setNewKeyTimeouts)clearTimeout(s);this.setNewKeyTimeouts.clear(),kt.info(`Leaving call session in room ${this.room.roomId}`),this.relativeExpiry=void 0,this.ownFocusActive=void 0,this.manageMediaKeys=!1,this.membershipId=void 0,this.emit("join_state_changed",!1);const i=new Promise(s=>{e&&setTimeout(s,e,"timeout")});return new Promise(s=>{Promise.race([this.triggerCallMembershipEventUpdate(),i]).then(o=>{s(o!="timeout")})})}getActiveFocus(){if(this.ownFocusActive&&KJ(this.ownFocusActive)&&this.ownFocusActive.focus_selection==="oldest_membership"){const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}if(!this.ownFocusActive){const e=this.getOldestMembership();return e==null?void 0:e.getPreferredFoci()[0]}}reemitEncryptionKeys(){this.encryptionKeys.forEach((e,n)=>{e.forEach((r,i)=>{this.emit("encryption_key_changed",r.key,i,n)})})}getKeysForParticipant(e,n){return this.getKeysForParticipantInternal(e,n)}getKeysForParticipantInternal(e,n){var r;return(r=this.encryptionKeys.get(YE(e,n)))==null?void 0:r.map(i=>i.key)}getEncryptionKeys(){return Array.from(this.encryptionKeys.entries()).map(([e,n])=>[e,n.map(r=>r.key)]).values()}getNewEncryptionKeyIndex(){var r;const e=this.client.getUserId(),n=this.client.getDeviceId();if(!e)throw new Error("No userId!");if(!n)throw new Error("No deviceId!");return(((r=this.getKeysForParticipantInternal(e,n))==null?void 0:r.length)??0)%16}setEncryptionKey(e,n,r,i,s,o=!1){const a=xi(i),c=YE(e,n);this.encryptionKeys.has(c)||this.encryptionKeys.set(c,[]);const l=this.encryptionKeys.get(c),u=l[r];if(u){if(u.timestamp>s){kt.info(`Ignoring new key at index ${r} for ${c} as it is older than existing known key`);return}if(ZCe(u.key,a)){u.timestamp=s;return}}if(l[r]={key:a,timestamp:s},o){const d=setTimeout(()=>{this.setNewKeyTimeouts.delete(d),kt.info(`Delayed-emitting key changed event for ${c} idx ${r}`),e===this.client.getUserId()&&n===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=r),this.emit("encryption_key_changed",a,r,c)},XCe);this.setNewKeyTimeouts.add(d)}else e===this.client.getUserId()&&n===this.client.getDeviceId()&&(this.currentEncryptionKeyIndex=r),this.emit("encryption_key_changed",a,r,c)}makeNewSenderKey(e=!1){const n=this.client.getUserId(),r=this.client.getDeviceId();if(!n)throw new Error("No userId");if(!r)throw new Error("No deviceId");const i=oJ(16),s=this.getNewEncryptionKeyIndex();return kt.info("Generated new key at index "+s),this.setEncryptionKey(n,r,s,i,Date.now(),e),s}requestKeyEventSend(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+eB>Date.now()){kt.info("Last encryption key event sent too recently: postponing"),this.keysEventUpdateTimeout===void 0&&(this.keysEventUpdateTimeout=setTimeout(this.sendEncryptionKeysEvent,eB));return}this.sendEncryptionKeysEvent()}}setExpiryTimer(){this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);let e;for(const n of this.memberships){const r=n.getMsUntilExpiry();r!==void 0&&(e===void 0||r<e)&&(e=r)}e!=null&&(this.expiryTimeout=setTimeout(this.onMembershipUpdate,e))}getOldestMembership(){return this.memberships[0]}getFocusInUse(){const e=this.getOldestMembership();if((e==null?void 0:e.getFocusSelection())==="oldest_membership")return e.getPreferredFoci()[0]}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.memberships.filter(e=>!this.isMyMembership(e)).map(e=>`${T3(e)}:${e.membershipID}:${e.createdTs()}`))}makeMyMembershipLegacy(e,n){if(this.relativeExpiry===void 0)throw new Error("Tried to create our own membership event when we're not joined!");if(this.membershipId===void 0)throw new Error("Tried to create our own membership event when we have no membership ID!");const r=n==null?void 0:n.createdTs();return{call_id:"",scope:"m.room",application:"m.call",device_id:e,expires:this.relativeExpiry,expires_ts:this.relativeExpiry+(r??Date.now()),foci_active:this.ownFociPreferred,membershipID:this.membershipId,...r?{created_ts:r}:{}}}makeMyMembership(e){return{call_id:"",scope:"m.room",application:"m.call",device_id:e,focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:this.ownFociPreferred??[]}}membershipEventNeedsUpdate(e,n){if(n&&n.getMsUntilExpiry()===void 0)return!1;if(!this.isJoined())return!!e;if(!n)return!0;const r=n.getMsUntilExpiry();return r!==void 0&&r<E3/2?(this.relativeExpiry+=E3,!0):!1}makeNewMembership(e){return this.isJoined()?this.makeMyMembership(e):{}}makeNewLegacyMemberships(e,n,r,i){const s=c=>{let l;try{l=new Fy(r,c)}catch{return!1}return!l.isExpired()},o=c=>(c.created_ts===void 0&&(c.created_ts=r.getTs()),c);let a=e.filter(s).filter(c=>c.device_id!==n);return a=a.map(o),this.isJoined()&&a.push(this.makeMyMembershipLegacy(n,i)),{memberships:a}}async updateCallMembershipEvent(){this.memberEventTimeout&&(clearTimeout(this.memberEventTimeout),this.memberEventTimeout=void 0);const e=this.room.getLiveTimeline().getState(He.FORWARDS);if(!e)throw new Error("Couldn't get room state for room "+this.room.roomId);const n=this.client.getUserId(),r=this.client.getDeviceId();if(!n||!r)throw new Error("User ID or device ID was null!");const i=e.events.get(Z.GroupCallMemberPrefix),s=this.stateEventsContainOngoingLegacySession(i);let o={};if(s){const c=i==null?void 0:i.get(n),l=(c==null?void 0:c.getContent())??{};let u;const d=Array.isArray(l.memberships)?l.memberships:[],f=d.find(p=>p.device_id===r);try{c&&f&&ud(f)&&f.membershipID===this.membershipId&&(u=new Fy(c,f))}catch(p){kt.warn("Our previous call membership was invalid - this shouldn't happen.",p)}if(u&&kt.debug(`${u.getMsUntilExpiry()} until our membership expires`),!this.membershipEventNeedsUpdate(f,u)){this.memberEventTimeout=setTimeout(this.triggerCallMembershipEventUpdate,QF);return}o=this.makeNewLegacyMemberships(d,r,c,u)}else o=this.makeNewMembership(r);const a=s?n:this.makeMembershipStateKey(n,r);try{if(await this.client.sendStateEvent(this.room.roomId,Z.GroupCallMemberPrefix,o,a),kt.info("Sent updated call member event."),this.isJoined())if(s)this.memberEventTimeout=setTimeout(this.triggerCallMembershipEventUpdate,QF);else try{const c=await this.client._unstable_sendDelayedStateEvent(this.room.roomId,{delay:8e3},Z.GroupCallMemberPrefix,{},a);this.scheduleDelayDisconnection(c.delay_id)}catch(c){kt.error("Failed to send delayed event:",c)}}catch(c){const l=JCe+Math.random()*2e3;kt.warn(`Failed to send call member event (retrying in ${l}): ${c}`),await new Promise(u=>setTimeout(u,l)),await this.triggerCallMembershipEventUpdate()}}scheduleDelayDisconnection(e){this.memberEventTimeout=setTimeout(()=>this.delayDisconnection(e),5e3)}async delayDisconnection(e){try{await this.client._unstable_updateDelayedEvent(e,N4.Restart),this.scheduleDelayDisconnection(e)}catch(n){kt.error("Failed to delay our disconnection event",n)}}stateEventsContainOngoingLegacySession(e){if(!(e!=null&&e.size))return this.useLegacyMemberEvents;let n=!1,r=!1;for(const i of e.values()){const s=i.getContent();if(Array.isArray(s.memberships)){for(const o of s.memberships)if(!new Fy(i,o).isExpired())return!0}else Object.keys(s).length>0&&(n||(n=!0),r||(r=!("focus_active"in s)))}return n&&!r?!1:this.useLegacyMemberEvents}makeMembershipStateKey(e,n){const r=`${e}_${n}`;return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?r:`_${r}`}}const By=k.getChild("MatrixRTCSessionManager");var pM=(t=>(t.SessionStarted="session_started",t.SessionEnded="session_ended",t))(pM||{});class QCe extends Fn{constructor(e){super(),this.client=e,this.roomSessions=new Map,this.onTimeline=n=>{this.consumeCallEncryptionEvent(n)},this.onRoom=n=>{this.refreshRoom(n)},this.onRoomState=(n,r)=>{const i=this.client.getRoom(n.getRoomId());if(!i){By.error(`Got room state event for unknown room ${n.getRoomId()}!`);return}n.getType()==Z.GroupCallMemberPrefix&&this.refreshRoom(i)}}start(){for(const e of this.client.getRooms()??[]){const n=pm.roomSessionForRoom(this.client,e);n.memberships.length>0&&this.roomSessions.set(e.roomId,n)}this.client.on(qe.Room,this.onRoom),this.client.on(ct.Timeline,this.onTimeline),this.client.on(xt.Events,this.onRoomState)}stop(){for(const e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(qe.Room,this.onRoom),this.client.off(ct.Timeline,this.onTimeline),this.client.off(xt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,pm.roomSessionForRoom(this.client,e)),this.roomSessions.get(e.roomId)}async consumeCallEncryptionEvent(e,n=!1){if(await this.client.decryptEventIfNeeded(e),e.isDecryptionFailure()){n?By.warn(`Decryption failed for event ${e.getId()}: ${e.decryptionFailureReason}`):(By.warn(`Decryption failed for event ${e.getId()}: ${e.decryptionFailureReason} will retry once only`),setTimeout(()=>this.consumeCallEncryptionEvent(e,!0),1e3));return}else n&&By.info(`Decryption succeeded for event ${e.getId()} after retry`);if(e.getType()!==Z.CallEncryptionKeysPrefix)return Promise.resolve();const r=this.client.getRoom(e.getRoomId());if(!r)return By.error(`Got room state event for unknown room ${e.getRoomId()}!`),Promise.resolve();this.getRoomSession(r).onCallEncryption(e)}refreshRoom(e){const n=!this.roomSessions.has(e.roomId),r=this.getRoomSession(e),i=r.memberships.length>0&&!n;r.onMembershipUpdate();const s=r.memberships.length>0;i&&!s?this.emit("session_ended",e.roomId,this.roomSessions.get(e.roomId)):!i&&s&&this.emit("session_started",e.roomId,this.roomSessions.get(e.roomId))}}function C3(t){return e=>{var n,r,i,s;return((r=(n=e.content)==null?void 0:n["m.relates_to"])==null?void 0:r.event_id)!==t||((s=(i=e.content)==null?void 0:i["m.relates_to"])==null?void 0:s.rel_type)===hn.name}}async function VJ(t){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");const e=new TextEncoder().encode(t);return await globalThis.crypto.subtle.digest("SHA-256",e)}const eke=3e3,tke=UJ(),nB=10*60*1e3,nke=new or("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent");var Zh=(t=>(t.Chronological="chronological",t.Detached="detached",t))(Zh||{});const rke=new k2("m.get_login_token","org.matrix.msc3882.get_login_token"),qJ="uk.half-shot.msc2666",GJ="uk.half-shot.msc2666.mutual_rooms",zJ="uk.half-shot.msc2666.query_mutual_rooms",Hc="org.matrix.msc4140",WJ="uk.tcpip.msc4133",Tc="$";var qe=(t=>(t.Sync="sync",t.Event="event",t.ToDeviceEvent="toDeviceEvent",t.AccountData="accountData",t.Room="Room",t.DeleteRoom="deleteRoom",t.SyncUnexpectedError="sync.unexpectedError",t.ClientWellKnown="WellKnown.client",t.ReceivedVoipEvent="received_voip_event",t.UndecryptableToDeviceEvent="toDeviceEvent.undecryptable",t.TurnServers="turnServers",t.TurnServersError="turnServers.error",t))(qe||{});const ike=new or("action","org.matrix.msc3824.action"),i7=class i7 extends Fn{constructor(e){super(),this.reEmitter=new Bv(this),this.olmVersion=null,this.usingExternalCrypto=!1,this.clientRunning=!1,this.timelineSupport=!1,this.urlPreviewCache={},this.supportsCallTransfer=!1,this.forceTURN=!1,this.iceCandidatePoolSize=0,this.canSupportVoip=!1,this.peekSync=null,this.isGuestAccount=!1,this.ongoingScrollbacks={},this.notifTimelineSet=null,this.fallbackICEServerAllowed=!1,this.syncedLeftRooms=!1,this.canSupport=new Map,this.pushProcessor=new hC(this),this.turnServers=[],this.turnServersExpiry=0,this.txnCtr=0,this.mediaHandler=new $Ce(this),this.eventsBeingEncrypted=new Set,this.useE2eForGroupCall=!0,this.startCallEventHandler=()=>{this.isInitialSyncComplete()&&(nM()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off("sync",this.startCallEventHandler))},this.startMatrixRTC=()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off("sync",this.startMatrixRTC))},this.fixupRoomNotifications=()=>{if(this.isInitialSyncComplete()){const r=(this.getRooms()??[]).filter(i=>i.getUnreadNotificationCount(xr.Total)>0);for(const i of r){const s=this.getSafeUserId();i.fixupNotifications(s)}this.off("sync",this.fixupRoomNotifications)}},this.logger=e.logger??k,e.baseUrl=n3(e.baseUrl),e.idBaseUrl=n3(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=e.usingExternalCrypto??!1,this.store=e.store||new hEe,this.deviceId=e.deviceId||null,this.sessionId=Zi(10);const n=e.userId||null;this.credentials={userId:n},this.http=new WY(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:Nn.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.deviceToImport?this.deviceId?this.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?this.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this.exportedOlmDeviceToImport=e.deviceToImport.olmDevice):this.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction(async r=>{const i=this.getRoom(r.getRoomId());r.status!==Ze.SENDING&&this.updatePendingEventStatus(i,r,Ze.SENDING);const s=await this.sendEventHttpRequest(r);return i&&i.updatePendingEvent(r,Ze.SENT,s.event_id),s}),nM()&&(this.callEventHandler=new LEe(this),this.groupCallEventHandler=new DEe(this),this.canSupportVoip=!0,this.on("sync",this.startCallEventHandler)),this.matrixRTC=new QCe(this),this.serverCapabilitiesService=new YY(this.http),this.on("sync",this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.cryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=e.iceCandidatePoolSize===void 0?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,e.useE2eForGroupCall!==void 0&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new GCe(this),this.on(sn.Decrypted,r=>{YJ(this,r)}),this.ignoredInvites=new zCe(this),this._secretStorage=new Y0(this,e.cryptoCallbacks??{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(n=>lu.createUser(n,this))}get store(){return this._store}async startClient(e){if(this.clientRunning)return;this.clientRunning=!0,this.on("sync",this.startMatrixRTC);const n=this.getUserId();n&&this.store.storeUser(new lu(n)),this.canSupportVoip&&(this.checkTurnServersIntervalID=setInterval(()=>{this.checkTurnServers()},nB),this.checkTurnServers()),this.syncApi&&(this.logger.error("Still have sync object whilst not running: stopping old one"),this.syncApi.stop());try{await this.getVersions();const{threads:r,list:i,fwdPagination:s}=await this.doesServerSupportThread();wi.setServerSideSupport(r),wi.setServerSideListSupport(i),wi.setServerSideFwdPaginationSupport(s)}catch(r){this.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",r)}this.clientOpts=e??{},this.clientOpts.slidingSync?this.syncApi=new BJ(this.clientOpts.slidingSync,this,this.clientOpts,this.buildSyncApiOptions()):this.syncApi=new I1(this,this.clientOpts,this.buildSyncApiOptions()),this.syncApi.sync().catch(r=>this.logger.info("Sync startup aborted with an error:",r)),this.clientOpts.clientWellKnownPollPeriod!==void 0&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*this.clientOpts.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.toDeviceMessageQueue.start(),this.serverCapabilitiesService.start()}buildSyncApiOptions(){return{crypto:this.crypto,cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>this.canResetTimelineCallback?this.canResetTimelineCallback(e):!1}}stopClient(){var e,n,r,i,s;(e=this.cryptoBackend)==null||e.stop(),this.off("sync",this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,(n=this.syncApi)==null||n.stop(),this.syncApi=void 0,(r=this.peekSync)==null||r.stopPeeking(),(i=this.callEventHandler)==null||i.stop(),(s=this.groupCallEventHandler)==null||s.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,global.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.clientWellKnownIntervalID!==void 0&&global.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}async rehydrateDevice(){if(this.crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this.cryptoCallbacks.getDehydrationKey)return;const e=await this.getDehydratedDevice();if(!e)return;if(!e.device_data||!e.device_id){this.logger.info("no dehydrated device found");return}const n=new global.Olm.Account;try{const r=e.device_data;if(r.algorithm!==zE){this.logger.warn("Wrong algorithm for dehydrated device");return}this.logger.debug("unpickling dehydrated device");const i=await this.cryptoCallbacks.getDehydrationKey(r,o=>{n.unpickle(new Uint8Array(o),r.account)});if(n.unpickle(i,r.account),this.logger.debug("unpickled device"),(await this.http.authedRequest(oe.Post,"/dehydrated_device/claim",void 0,{device_id:e.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})).success){this.deviceId=e.device_id,this.logger.info("using dehydrated device");const o=this.pickleKey||"DEFAULT_KEY";return this.exportedOlmDeviceToImport={pickledAccount:n.pickle(o),sessions:[],pickleKey:o},n.free(),this.deviceId}else{n.free(),this.logger.info("not using dehydrated device");return}}catch(r){n.free(),this.logger.warn("could not unpickle",r)}}async getDehydratedDevice(){try{return await this.http.authedRequest(oe.Get,"/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){this.logger.info("could not get dehydrated device",e);return}}async setDehydrationKey(e,n,r){if(!this.crypto){this.logger.warn("not dehydrating device if crypto is not enabled");return}return this.crypto.dehydrationManager.setKeyAndQueueDehydration(e,n,r)}async createDehydratedDevice(e,n,r){if(!this.crypto){this.logger.warn("not dehydrating device if crypto is not enabled");return}return await this.crypto.dehydrationManager.setKey(e,n,r),this.crypto.dehydrationManager.dehydrateDevice()}async exportDevice(){if(!this.crypto){this.logger.warn("not exporting device if crypto is not enabled");return}return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:await this.crypto.olmDevice.export()}}clearStores(){if(this.clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];e.push(this.store.deleteAllData()),this.cryptoStore&&e.push(this.cryptoStore.deleteAllData());const n=async()=>{let r;try{if(r=global.indexedDB,!r)return}catch{return}for(const i of[`${w3}::matrix-sdk-crypto`,`${w3}::matrix-sdk-crypto-meta`])await new Promise((o,a)=>{this.logger.info(`Removing IndexedDB instance ${i}`);const c=r.deleteDatabase(i);c.onsuccess=l=>{this.logger.info(`Removed IndexedDB instance ${i}`),o(0)},c.onerror=l=>{this.logger.warn(`Failed to remove IndexedDB instance ${i}:`,l),o(0)},c.onblocked=l=>{this.logger.info(`cannot yet remove IndexedDB instance ${i}`)}})};return e.push(n()),Promise.all(e).then()}getUserId(){return this.credentials&&this.credentials.userId?this.credentials.userId:null}getSafeUserId(){const e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return W0(this,e)}async createGroupCall(e,n,r,i,s,o){if(this.getGroupCallForRoom(e))throw new Error(`${e} already has an existing group call`);const a=this.getRoom(e);if(!a)throw new Error(`Cannot find room ${e}`);return new T4(this,a,n,r,i,void 0,s||this.isVoipWithNoMediaAllowed,o,this.isVoipWithNoMediaAllowed,this.useLivekitForGroupCalls,this.livekitServiceURL).create()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e;return((e=this.syncApi)==null?void 0:e.getSyncState())??null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){const e=this.getSyncState();return e?e===ii.Prepared||e===ii.Syncing:!1}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e;return this.toDeviceMessageQueue.sendQueue(),((e=this.syncApi)==null?void 0:e.retryImmediately())??!1}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}async getCapabilities(){const e=this.serverCapabilitiesService.getCachedCapabilities();return e||this.serverCapabilitiesService.fetchCapabilities()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}async initCrypto(){if(!UJ())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this.cryptoBackend){this.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}if(!this.cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");this.logger.debug("Crypto: Starting up crypto store..."),await this.cryptoStore.startup();const e=this.getUserId();if(e===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(this.deviceId===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const n=new wC(this,e,this.deviceId,this.store,this.cryptoStore,this.verificationMethods);this.reEmitter.reEmit(n,[Zt.KeyBackupFailed,Zt.KeyBackupSessionsRemaining,Zt.RoomKeyRequest,Zt.RoomKeyRequestCancellation,Zt.Warning,Zt.DevicesUpdated,Zt.WillUpdateDevices,Zt.DeviceVerificationChanged,Zt.UserTrustStatusChanged,Zt.KeysChanged]),this.logger.debug("Crypto: initialising crypto object..."),await n.init({exportedOlmDevice:this.exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this.exportedOlmDeviceToImport,this.olmVersion=wC.getOlmVersion(),n.registerEventHandlers(this),this.cryptoBackend=this.crypto=n,this.crypto.uploadDeviceKeys().catch(r=>{this.logger.error("Error uploading device keys",r)})}async initRustCrypto(e={}){if(this.cryptoBackend){this.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}const n=this.getUserId();if(n===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");const r=this.getDeviceId();if(r===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");this.logger.debug("Downloading Rust crypto library");const s=await(await Swe(()=>import("./index-CCxDOCKy.js"),[])).initRustCrypto({logger:this.logger,http:this.http,userId:n,deviceId:r,secretStorage:this.secretStorage,cryptoCallbacks:this.cryptoCallbacks,storePrefix:e.useIndexedDB===!1?null:w3,storeKey:e.storageKey,storePassphrase:e.storagePassword,legacyCryptoStore:this.cryptoStore,legacyPickleKey:this.pickleKey??"DEFAULT_KEY",legacyMigrationProgressListener:(o,a)=>{this.emit(Zt.LegacyCryptoStoreMigrationProgress,o,a)}});s.setSupportedVerificationMethods(this.verificationMethods),this.cryptoBackend=s,this.on(Hs.Membership,s.onRoomMembership.bind(s)),this.on("event",o=>{s.onLiveEventFromSync(o)}),this.reEmitter.reEmit(s,[Zt.VerificationRequestReceived,Zt.UserTrustStatusChanged,Zt.KeyBackupStatus,Zt.KeyBackupSessionsRemaining,Zt.KeyBackupFailed,Zt.KeyBackupDecryptionKeyCached,Zt.KeysChanged,Zt.DevicesUpdated,Zt.WillUpdateDevices])}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isCryptoEnabled(){return!!this.cryptoBackend}getDeviceEd25519Key(){var e;return((e=this.crypto)==null?void 0:e.getDeviceEd25519Key())??null}getDeviceCurve25519Key(){var e;return((e=this.crypto)==null?void 0:e.getDeviceCurve25519Key())??null}async uploadKeys(){this.logger.warn("MatrixClient.uploadKeys is deprecated")}downloadKeys(e,n){return this.crypto?this.crypto.downloadKeys(e,n):Promise.reject(new Error("End-to-end encryption disabled"))}getStoredDevicesForUser(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevicesForUser(e)||[]}getStoredDevice(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getStoredDevice(e,n)||null}setDeviceVerified(e,n,r=!0){const i=this.setDeviceVerification(e,n,r,null,null);return e==this.credentials.userId&&this.checkKeyBackup(),i}setDeviceBlocked(e,n,r=!0){return this.setDeviceVerification(e,n,null,r,null)}setDeviceKnown(e,n,r=!0){return this.setDeviceVerification(e,n,null,null,r)}async setDeviceVerification(e,n,r,i,s){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.setDeviceVerification(e,n,r,i,s)}requestVerificationDM(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerificationDM(e,n)}findVerificationRequestDMInProgress(e){if(this.cryptoBackend){if(!this.crypto)return}else throw new Error("End-to-end encryption disabled");return this.crypto.findVerificationRequestDMInProgress(e)}getVerificationRequestsToDeviceInProgress(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getVerificationRequestsToDeviceInProgress(e)}requestVerification(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestVerification(e,n)}beginKeyVerification(e,n,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.beginKeyVerification(e,n,r)}checkSecretStorageKey(e,n){return this.secretStorage.checkKey(e,n)}setGlobalBlacklistUnverifiedDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices=e,e}getGlobalBlacklistUnverifiedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalBlacklistUnverifiedDevices}setGlobalErrorOnUnknownDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.globalErrorOnUnknownDevices=e}getGlobalErrorOnUnknownDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.globalErrorOnUnknownDevices}getCrossSigningId(e=K2.Master){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.getCrossSigningId(e)}getStoredCrossSigningForUser(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getStoredCrossSigningForUser(e)}checkUserTrust(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkUserTrust(e)}checkDeviceTrust(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkDeviceTrust(e,n)}checkIfOwnDeviceCrossSigned(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkIfOwnDeviceCrossSigned(e)}checkOwnCrossSigningTrust(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.checkOwnCrossSigningTrust(e)}checkCrossSigningPrivateKey(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkCrossSigningPrivateKey(e,n)}legacyDeviceVerification(e,n,r){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.legacyDeviceVerification(e,n,r)}prepareToEncrypt(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.prepareToEncrypt(e)}userHasCrossSigningKeys(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.userHasCrossSigningKeys()}isCrossSigningReady(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.isCrossSigningReady()}bootstrapCrossSigning(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.bootstrapCrossSigning(e)}getCryptoTrustCrossSignedDevices(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getTrustCrossSignedDevices()}setCryptoTrustCrossSignedDevices(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");this.cryptoBackend.setTrustCrossSignedDevices(e)}countSessionsNeedingBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.countSessionsNeedingBackup()}getEventEncryptionInfo(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.getEventEncryptionInfo(e)}createRecoveryKeyFromPassphrase(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.createRecoveryKeyFromPassphrase(e)}isSecretStorageReady(){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.isSecretStorageReady()}bootstrapSecretStorage(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.bootstrapSecretStorage(e)}addSecretStorageKey(e,n,r){return this.secretStorage.addKey(e,n,r)}hasSecretStorageKey(e){return this.secretStorage.hasKey(e)}storeSecret(e,n,r){return this.secretStorage.store(e,n,r)}getSecret(e){return this.secretStorage.get(e)}isSecretStored(e){return this.secretStorage.isStored(e)}requestSecret(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.requestSecret(e,n)}getDefaultSecretStorageKeyId(){return this.secretStorage.getDefaultKeyId()}setDefaultSecretStorageKeyId(e){return this.secretStorage.setDefaultKeyId(e)}checkSecretStoragePrivateKey(e,n){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.checkSecretStoragePrivateKey(e,n)}async getEventSenderDeviceInfo(e){return this.crypto?this.crypto.getEventSenderDeviceInfo(e):null}async isEventSenderVerified(e){const n=await this.getEventSenderDeviceInfo(e);return n?n.isVerified():!1}getOutgoingRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");const n=e.getWireContent(),r={session_id:n.session_id,sender_key:n.sender_key,algorithm:n.algorithm,room_id:e.getRoomId()};return!r.session_id||!r.sender_key||!r.algorithm||!r.room_id?Promise.resolve(null):this.crypto.cryptoStore.getOutgoingRoomKeyRequest(r)}cancelAndResendEventRoomKeyRequest(e){if(!this.crypto)throw new Error("End-to-End encryption disabled");return e.cancelAndResendKeyRequest(this.crypto,this.getUserId())}setRoomEncryption(e,n){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.setRoomEncryption(e,n)}isRoomEncrypted(e){var r;const n=this.getRoom(e);return n?n.hasEncryptionStateEvent()?!0:((r=this.crypto)==null?void 0:r.isRoomEncrypted(e))??!1:!1}encryptAndSendToDevices(e,n){if(!this.crypto)throw new Error("End-to-End encryption disabled");return this.crypto.encryptAndSendToDevices(e,n)}forceDiscardSession(e){if(!this.cryptoBackend)throw new Error("End-to-End encryption disabled");this.cryptoBackend.forceDiscardSession(e)}exportRoomKeys(){return this.cryptoBackend?this.cryptoBackend.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))}importRoomKeys(e,n){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");return this.cryptoBackend.importRoomKeys(e,n)}checkKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.checkKeyBackup()}async getKeyBackupVersion(){let e;try{e=await this.http.authedRequest(oe.Get,"/room_keys/version",void 0,void 0,{prefix:Nn.V3})}catch(n){if(n.errcode==="M_NOT_FOUND")return null;throw n}return Mh.checkBackupVersion(e),e}isKeyBackupTrusted(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.isKeyBackupTrusted(e)}getKeyBackupEnabled(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.getKeyBackupEnabled()}enableKeyBackup(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.enableKeyBackup(e)}disableKeyBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");this.crypto.backupManager.disableKeyBackup()}async prepareKeyBackupVersion(e,n={secureSecretStorage:!1}){if(!this.crypto)throw new Error("End-to-end encryption disabled");const{algorithm:r,auth_data:i,recovery_key:s,privateKey:o}=await this.crypto.backupManager.prepareKeyBackupVersion(e);return n.secureSecretStorage&&(await this.secretStorage.store("m.megolm_backup.v1",hs(o)),this.logger.info("Key backup private key stored in secret storage")),{algorithm:r,auth_data:i,recovery_key:s}}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}async createKeyBackupVersion(e){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.createKeyBackupVersion(e);const n={algorithm:e.algorithm,auth_data:e.auth_data};await this.crypto.signObject(n.auth_data),this.cryptoCallbacks.getCrossSigningKey&&this.crypto.crossSigningInfo.getId()&&await this.crypto.crossSigningInfo.signObject(n.auth_data,"master");const r=await this.http.authedRequest(oe.Post,"/room_keys/version",void 0,n);return await this.checkKeyBackup(),this.getKeyBackupEnabled()||this.logger.error("Key backup not usable even though we just created it"),r}async deleteKeyBackupVersion(e){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");await this.cryptoBackend.deleteKeyBackupVersion(e)}makeKeyBackupPath(e,n,r){let i;return n!==void 0?i=Me("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:n}):e!==void 0?i=Me("/room_keys/keys/$roomId",{$roomId:e}):i="/room_keys/keys",{path:i,queryData:r===void 0?void 0:{version:r}}}async sendKeyBackup(e,n,r,i){if(!this.crypto)throw new Error("End-to-end encryption disabled");const s=this.makeKeyBackupPath(e,n,r);await this.http.authedRequest(oe.Put,s.path,s.queryData,i,{prefix:Nn.V3})}async scheduleAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");await this.crypto.backupManager.scheduleAllGroupSessionsForBackup()}flagAllGroupSessionsForBackup(){if(!this.crypto)throw new Error("End-to-end encryption disabled");return this.crypto.backupManager.flagAllGroupSessionsForBackup()}isValidRecoveryKey(e){try{return X1(e),!0}catch{return!1}}keyBackupKeyFromPassword(e,n){return jF(n.auth_data,e)}keyBackupKeyFromRecoveryKey(e){return X1(e)}async restoreKeyBackupWithPassword(e,n,r,i,s){const o=await jF(i.auth_data,e);return this.restoreKeyBackup(o,n,r,i,s)}async restoreKeyBackupWithSecretStorage(e,n,r,i){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");const s=await this.secretStorage.get("m.megolm_backup.v1"),o=WE(s);if(o){const c=await this.secretStorage.getKey();await this.secretStorage.store("m.megolm_backup.v1",o,[c[0]])}const a=xi(o||s);return this.restoreKeyBackup(a,n,r,e,i)}restoreKeyBackupWithRecoveryKey(e,n,r,i,s){const o=X1(e);return this.restoreKeyBackup(o,n,r,i,s)}async restoreKeyBackupWithCache(e,n,r,i){if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");const s=await this.cryptoBackend.getSessionBackupPrivateKey();if(!s)throw new Error("Couldn't get key");return this.restoreKeyBackup(s,e,n,r,i)}async restoreKeyBackup(e,n,r,i,s){const o=s==null?void 0:s.cacheCompleteCallback,a=s==null?void 0:s.progressCallback;if(!this.cryptoBackend)throw new Error("End-to-end encryption disabled");if(!i.version)throw new Error("Backup version must be defined");const c=i.version;let l=0,u=0,d=0;const f=this.makeKeyBackupPath(n,r,c),p=await this.cryptoBackend.getBackupDecryptor(i,e),m=!p.sourceTrusted;try{if(!(e instanceof Uint8Array))throw new Error(`restoreKeyBackup expects Uint8Array, got ${e}`);this.cryptoBackend.storeSessionBackupPrivateKey(e,c).catch(S=>{this.logger.warn("Error caching session backup key:",S)}).then(o),a&&a({stage:"fetch"});const v=await this.http.authedRequest(oe.Get,f.path,f.queryData,void 0,{prefix:Nn.V3});if(a&&a({stage:"load_keys"}),v.rooms)l=this.getTotalKeyCount(v),await this.handleDecryptionOfAFullBackup(v,p,200,async S=>{try{const _=i.version;await this.cryptoBackend.importBackedUpRoomKeys(S,_,{untrusted:m}),d+=S.length}catch(_){u+=S.length,k.error("Error importing keys from backup",_)}a&&a({total:l,successes:d,stage:"load_keys",failures:u})});else if(v.sessions){const S=v.sessions;l=Object.keys(S).length;const _=await p.decryptSessions(S);for(const w of _)w.room_id=n;await this.cryptoBackend.importBackedUpRoomKeys(_,c,{progressCallback:a,untrusted:m}),d=_.length}else{l=1;try{const[S]=await p.decryptSessions({[r]:v});S.room_id=n,S.session_id=r,await this.cryptoBackend.importBackedUpRoomKeys([S],c,{progressCallback:a,untrusted:m}),d=1}catch(S){this.logger.debug("Failed to decrypt megolm session from backup",S)}}}finally{p.free()}return await this.cryptoBackend.checkKeyBackupAndEnable(),{total:l,imported:d}}getTotalKeyCount(e){const n=e.rooms;let r=0;for(const i of Object.values(n))i.sessions&&(r+=Object.keys(i.sessions).length);return r}async handleDecryptionOfAFullBackup(e,n,r,i){const s=e.rooms;let o=0,a=new Map;const c=async l=>{const u=[];for(const d of l.keys()){const f=await n.decryptSessions(l.get(d));for(const p in f){const m=f[p];m.room_id=d,u.push(m)}}await i(u)};for(const[l,u]of Object.entries(s))if(u.sessions){a.set(l,{});for(const[d,f]of Object.entries(u.sessions)){const p=a.get(l);p[d]=f,o+=1,o>=r&&(await c(a),a=new Map,a.set(l,{}),o=0)}}o>0&&await c(a)}async deleteKeysFromBackup(e,n,r){const i=this.makeKeyBackupPath(e,n,r);await this.http.authedRequest(oe.Delete,i.path,i.queryData,void 0,{prefix:Nn.V3})}async sendSharedHistoryKeys(e,n){var a;if(!this.crypto)throw new Error("End-to-end encryption disabled");const r=(a=this.crypto)==null?void 0:a.getRoomEncryption(e);if(!r){this.logger.error("Unknown room.  Not sharing decryption keys");return}const i=await this.crypto.downloadKeys(n),s=new Map;for(const[c,l]of i)s.set(c,Array.from(l.values()));const o=this.crypto.getRoomDecryptor(e,r.algorithm);o.sendSharedHistoryInboundSessions?await o.sendSharedHistoryInboundSessions(s):this.logger.warn("Algorithm does not support sharing previous keys",r.algorithm)}getMediaConfig(){return this.http.authedRequest(oe.Get,"/config",void 0,void 0,{prefix:Oh.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(e=!1){var i;const n=this.store.getRooms(),r=new Set;for(const s of n){const o=(i=s.findPredecessor(e))==null?void 0:i.roomId;o&&r.add(o)}return n.filter(s=>!(s.currentState.getStateEvents(Z.RoomTombstone,"")&&r.has(s.roomId)))}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,n){const r=Me("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return GY(5,()=>this.http.authedRequest(oe.Put,r,void 0,n))}getAccountData(e){return this.store.getAccountData(e)}async getAccountDataFromServer(e){var r;if(this.isInitialSyncComplete()){const i=this.store.getAccountData(e);return i?i.getContent():null}const n=Me("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});try{return await this.http.authedRequest(oe.Get,n)}catch(i){if(((r=i.data)==null?void 0:r.errcode)==="M_NOT_FOUND")return null;throw i}}async deleteAccountData(e){const n=this.canSupport.get(vo.AccountDataDeletion);if(n===Si.Unsupported){await this.setAccountData(e,{});return}const r=Me("/user/$userId/account_data/$type",{$userId:this.getSafeUserId(),$type:e}),i=n===Si.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return await this.http.authedRequest(oe.Delete,r,void 0,void 0,i)}getIgnoredUsers(){const e=this.getAccountData("m.ignored_user_list");return!e||!e.getContent()||!e.getContent().ignored_users?[]:Object.keys(e.getContent().ignored_users)}setIgnoredUsers(e){const n={ignored_users:{}};return e.forEach(r=>{n.ignored_users[r]={}}),this.setAccountData("m.ignored_user_list",n)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}async joinRoom(e,n={}){n.syncRoom===void 0&&(n.syncRoom=!0);const r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,Ge.Join))return r;let i=Promise.resolve();if(n.inviteSignUrl){const m=new URL(n.inviteSignUrl);m.searchParams.set("mxid",this.credentials.userId),i=this.http.requestOtherUrl(oe.Post,m)}const s={};n.viaServers&&(s.server_name=n.viaServers,s.via=n.viaServers);const o={},a=await i;a&&(o.third_party_signed=a);const c=Me("/join/$roomid",{$roomid:e}),u=(await this.http.authedRequest(oe.Post,c,s,o)).room_id,d=this.getRoom(u);if(d!=null&&d.hasMembershipState(this.credentials.userId,Ge.Join))return d;const p=new I1(this,this.clientOpts,this.buildSyncApiOptions()).createRoom(u);return n.syncRoom,p}knockRoom(e,n={}){const r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,Ge.Knock))return Promise.resolve({room_id:r.roomId});const i=Me("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),s={};n.viaServers&&(s.server_name=n.viaServers,s.via=n.viaServers);const o={};return n.reason&&(o.reason=n.reason),this.http.authedRequest(oe.Post,i,s,o)}resendEvent(e,n){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(n,e,Ze.SENDING),this.encryptAndSendEvent(n,e)}cancelPendingEvent(e){if(![Ze.QUEUED,Ze.NOT_SENT,Ze.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===Ze.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===Ze.QUEUED&&this.scheduler.removeEventFromQueue(e);const n=this.getRoom(e.getRoomId());this.updatePendingEventStatus(n,e,Ze.CANCELLED)}setRoomName(e,n){return this.sendStateEvent(e,Z.RoomName,{name:n})}setRoomTopic(e,n,r){const i=DY(n,r);return this.sendStateEvent(e,Z.RoomTopic,i)}getRoomTags(e){const n=Me("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(oe.Get,n)}setRoomTag(e,n,r={}){const i=Me("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(oe.Put,i,void 0,r)}deleteRoomTag(e,n){const r=Me("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(oe.Delete,r)}setRoomAccountData(e,n,r){const i=Me("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:n});return this.http.authedRequest(oe.Put,i,void 0,r)}async setPowerLevel(e,n,r){var o,a,c;let i;if(this.clientRunning&&this.isInitialSyncComplete()&&(i=(c=(a=(o=this.getRoom(e))==null?void 0:o.currentState)==null?void 0:a.getStateEvents(Z.RoomPowerLevels,""))==null?void 0:c.getContent()),!i)try{i=await this.getStateEvent(e,Z.RoomPowerLevels,"")}catch(l){if(l instanceof Ii&&l.errcode==="M_NOT_FOUND")i={};else throw l}i=I2(i),i!=null&&i.users||(i.users={});const s=Array.isArray(n)?n:[n];for(const l of s)r==null?delete i.users[l]:i.users[l]=r;return this.sendStateEvent(e,Z.RoomPowerLevels,i,"")}async unstable_createLiveBeacon(e,n){return this.unstable_setLiveBeacon(e,n)}async unstable_setLiveBeacon(e,n){return this.sendStateEvent(e,D4.name,n,this.getUserId())}sendEvent(e,n,r,i,s){let o,a,c,l;return!(n!=null&&n.startsWith(Tc))&&n!==null?(l=i,c=r,a=n,o=null):(l=s,c=i,a=r,o=n),this.addThreadRelationIfNeeded(c,o,e),this.sendCompleteEvent(e,o,{type:a,content:c},l)}addThreadRelationIfNeeded(e,n,r){var i,s,o,a;if(n&&!((i=e["m.relates_to"])!=null&&i.rel_type)){const c=!!((s=e["m.relates_to"])!=null&&s["m.in_reply_to"]);e["m.relates_to"]={...e["m.relates_to"],rel_type:hn.name,event_id:n,is_falling_back:!c};const l=(o=this.getRoom(r))==null?void 0:o.getThread(n);l&&!c&&(e["m.relates_to"]["m.in_reply_to"]={event_id:((a=l.lastReply(u=>u.isRelation(hn.name)&&!u.status))==null?void 0:a.getId())??n})}}sendCompleteEvent(e,n,r,i,s){let o,a;typeof i=="string"?a=i:(o=i,a=s),a||(a=this.makeTxnId());const c=new oi(Object.assign(r,{event_id:"~"+e+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:new Date().getTime()})),l=this.getRoom(e),u=n?l==null?void 0:l.getThread(n):void 0;u&&c.setThread(u),o||(this.reEmitter.reEmit(c,[sn.Replaced,sn.VisibilityChange]),l==null||l.reEmitter.reEmit(c,[sn.BeforeRedaction]));const d=c.getAssociatedId();if(d!=null&&d.startsWith("~")){const p=l==null?void 0:l.getPendingEvents().find(m=>m.getId()===d);p==null||p.once(sn.LocalEventIdReplaced,()=>{c.updateAssociatedId(p.getId())})}const f=c.getType();return this.logger.debug(`sendEvent of type ${f} in ${e} with txnId ${a}${o?" (delayed event)":""}`),c.setTxnId(a),c.setStatus(Ze.SENDING),o?this.encryptAndSendEvent(l,c,o):(l==null||l.addPendingEvent(c,a),c.status===Ze.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,c))}async encryptAndSendEvent(e,n,r){if(r)return this.sendEventHttpRequest(n,r);try{let i;this.eventsBeingEncrypted.add(n.getId());try{await this.encryptEventIfNeeded(n,e??void 0)}finally{i=!this.eventsBeingEncrypted.delete(n.getId())}if(i)return{};n.status===Ze.ENCRYPTING&&this.updatePendingEventStatus(e,n,Ze.SENDING);let s=null;return this.scheduler&&(s=this.scheduler.queueEvent(n),s&&this.scheduler.getQueueForEvent(n).length>1&&this.updatePendingEventStatus(e,n,Ze.QUEUED)),s||(s=this.sendEventHttpRequest(n),e&&(s=s.then(o=>(e.updatePendingEvent(n,Ze.SENT,o.event_id),o)))),await s}catch(i){this.logger.error("Error sending event",i);try{n.error=i,this.updatePendingEventStatus(e,n,Ze.NOT_SENT)}catch(s){this.logger.error("Exception in error handler!",s)}throw i instanceof Ii&&(i.event=n),i}}async encryptEventIfNeeded(e,n){if(n&&await this.shouldEncryptEventForRoom(e,n)&&!(!this.cryptoBackend&&this.usingExternalCrypto)){if(!this.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");this.updatePendingEventStatus(n,e,Ze.ENCRYPTING),await this.cryptoBackend.encryptEvent(e,n)}}async shouldEncryptEventForRoom(e,n){var r;return e.isEncrypted()||e.getType()===Z.Reaction||e.isRedaction()?!1:!!(n.hasEncryptionStateEvent()||await((r=this.cryptoBackend)==null?void 0:r.isEncryptionEnabledInRoom(n.roomId)))}getEncryptedIfNeededEventType(e,n){var r;return n===Z.Reaction?n:(r=this.getRoom(e))!=null&&r.hasEncryptionStateEvent()?Z.RoomMessageEncrypted:n}updatePendingEventStatus(e,n,r){e?e.updatePendingEvent(n,r):n.setStatus(r)}sendEventHttpRequest(e,n){let r=e.getTxnId();r||(r=this.makeTxnId(),e.setTxnId(r));const i={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:r};let s;if(e.isState()){let a="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(a="/rooms/$roomId/state/$eventType/$stateKey"),s=Me(a,i)}else e.isRedaction()&&e.event.redacts?s=Me("/rooms/$roomId/redact/$redactsEventId/$txnId",{$redactsEventId:e.event.redacts,...i}):s=Me("/rooms/$roomId/send/$eventType/$txnId",i);const o=e.getWireContent();return n?this.http.authedRequest(oe.Put,s,rB(n),o):this.http.authedRequest(oe.Put,s,void 0,o).then(a=>(this.logger.debug(`Event sent to ${e.getRoomId()} with event id ${a.event_id}`),a))}redactEvent(e,n,r,i,s){r!=null&&r.startsWith(Tc)||(s=i,i=r,r=n,n=null);const a={reason:s==null?void 0:s.reason};if((s==null?void 0:s.with_rel_types)!==void 0){if(this.canSupport.get(vo.RelationBasedRedactions)===Si.Unsupported)throw new Error(`Server does not support relation based redactions roomId ${e} eventId ${r} txnId: ${i} threadId ${n}`);const c=this.canSupport.get(vo.RelationBasedRedactions)===Si.Stable?k6.stable:k6.unstable;a[c]=s.with_rel_types}return this.sendCompleteEvent(e,n,{type:Z.RoomRedaction,content:a,redacts:r},i)}sendMessage(e,n,r,i){typeof n!="string"&&n!==null&&(i=r,r=n,n=null);const s=Z.RoomMessage,o=r;return this.sendEvent(e,n,s,o,i)}sendTextMessage(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=PY(r);return this.sendMessage(e,n,s,i)}sendNotice(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=OY(r);return this.sendMessage(e,n,s,i)}sendEmoteMessage(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=MY(r);return this.sendMessage(e,n,s,i)}sendImageMessage(e,n,r,i,s="Image"){!(n!=null&&n.startsWith(Tc))&&n!==null&&(s=i||"Image",i=r,r=n,n=null);const o={msgtype:Oa.Image,url:r,info:i,body:s};return this.sendMessage(e,n,o)}sendStickerMessage(e,n,r,i,s="Sticker"){!(n!=null&&n.startsWith(Tc))&&n!==null&&(s=i||"Sticker",i=r,r=n,n=null);const o={url:r,info:i,body:s};return this.sendEvent(e,n,Z.Sticker,o)}sendHtmlMessage(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=RY(r,i);return this.sendMessage(e,n,s)}sendHtmlNotice(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=IY(r,i);return this.sendMessage(e,n,s)}sendHtmlEmote(e,n,r,i){!(n!=null&&n.startsWith(Tc))&&n!==null&&(i=r,r=n,n=null);const s=xY(r,i);return this.sendMessage(e,n,s)}async _unstable_sendDelayedEvent(e,n,r,i,s,o){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");return this.addThreadRelationIfNeeded(s,r,e),this.sendCompleteEvent(e,r,{type:i,content:s},n,o)}async _unstable_sendDelayedStateEvent(e,n,r,i,s="",o={}){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");const a={$roomId:e,$eventType:r,$stateKey:s};let c=Me("/rooms/$roomId/state/$eventType",a);return s!==void 0&&(c=Me(c+"/$stateKey",a)),this.http.authedRequest(oe.Put,c,rB(n),i,o)}async _unstable_getDelayedEvents(e){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");const n=e?{from:e}:void 0;return await this.http.authedRequest(oe.Get,"/delayed_events",n,void 0,{prefix:`${Nn.Unstable}/${Hc}`})}async _unstable_updateDelayedEvent(e,n){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");const r=Me("/delayed_events/$delayId",{$delayId:e}),i={action:n};return await this.http.authedRequest(oe.Post,r,void 0,i,{prefix:`${Nn.Unstable}/${Hc}`})}async sendReceipt(e,n,r,i=!1){if(this.isGuest())return Promise.resolve({});const s=Me("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:n,$eventId:e.getId()}),a=!i&&this.supportsThreads()?{...r,thread_id:tv(e)}:r,c=this.http.authedRequest(oe.Post,s,void 0,a||{}),l=this.getRoom(e.getRoomId());return l&&this.credentials.userId&&l.addLocalEchoReceipt(this.credentials.userId,e,n,i),c}async sendReadReceipt(e,n=Wi.Read,r=!1){if(!e)return;const i=e.getId(),s=this.getRoom(e.getRoomId());if(s!=null&&s.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);return this.sendReceipt(e,n,{},r)}async setRoomReadMarkers(e,n,r,i){const s=this.getRoom(e);if(s!=null&&s.hasPendingEvent(n))throw new Error(`Cannot set read marker to a pending event (${n})`);let o;if(r){if(o=r.getId(),s!=null&&s.hasPendingEvent(o))throw new Error(`Cannot set read receipt to a pending event (${o})`);s==null||s.addLocalEchoReceipt(this.credentials.userId,r,Wi.Read)}let a;if(i){if(a=i.getId(),s!=null&&s.hasPendingEvent(a))throw new Error(`Cannot set read receipt to a pending event (${a})`);s==null||s.addLocalEchoReceipt(this.credentials.userId,i,Wi.ReadPrivate)}return await this.setRoomReadMarkersHttpRequest(e,n,o,a)}getUrlPreview(e,n){n=Math.floor(n/6e4)*6e4;const r=new URL(e);r.hash="",e=r.toString();const i=n+"_"+e;if(i in this.urlPreviewCache)return this.urlPreviewCache[i];const s=this.http.authedRequest(oe.Get,"/preview_url",{url:e,ts:n.toString()},void 0,{prefix:Oh.V3,priority:"low"});return this.urlPreviewCache[i]=s,s}sendTyping(e,n,r){if(this.isGuest())return Promise.resolve({});const i=Me("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),s={typing:n};return n&&(s.timeout=r||2e4),this.http.authedRequest(oe.Put,i,void 0,s)}getRoomUpgradeHistory(e,n=!1,r=!1){const i=this.getRoom(e);if(!i)return[];const s=this.findPredecessorRooms(i,n,r),o=this.findSuccessorRooms(i,n,r);return[...s,i,...o]}findPredecessorRooms(e,n,r){var a,c;const i=[],s=new Set([e.roomId]);let o=(a=e.findPredecessor(r))==null?void 0:a.roomId;for(;o!==null;){if(o){if(s.has(o))break;s.add(o)}const l=this.getRoom(o);if(l===null)break;if(n){const u=l.currentState.getStateEvents(Z.RoomTombstone,"");if(!u||u.getContent().replacement_room!==e.roomId)break}i.splice(0,0,l),e=l,o=(c=e.findPredecessor(r))==null?void 0:c.roomId}return i}findSuccessorRooms(e,n,r){var o;const i=[];let s=e.currentState.getStateEvents(Z.RoomTombstone,"");for(;s;){const a=this.getRoom(s.getContent().replacement_room);if(!a||a.roomId===e.roomId)break;if(n){const l=(o=a.findPredecessor(r))==null?void 0:o.roomId;if(!l||l!==e.roomId)break}if(i.push(a),new Set(i.map(l=>l.roomId)).size<i.length)return i.slice(0,i.length-1);e=a,s=e.currentState.getStateEvents(Z.RoomTombstone,"")}return i}invite(e,n,r){return this.membershipChange(e,n,Ge.Invite,r)}inviteByEmail(e,n){return this.inviteByThreePid(e,"email",n)}async inviteByThreePid(e,n,r){var a;const i=Me("/rooms/$roomId/invite",{$roomId:e}),s=this.getIdentityServerUrl(!0);if(!s)return Promise.reject(new Ii({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const o={id_server:s,medium:n,address:r};if((a=this.identityServer)!=null&&a.getAccessToken){const c=await this.identityServer.getAccessToken();c&&(o.id_access_token=c)}return this.http.authedRequest(oe.Post,i,void 0,o)}leave(e){return this.membershipChange(e,void 0,Ge.Leave)}leaveRoomChain(e,n=!0){const r=this.getRoomUpgradeHistory(e);let i=r;if(!n){i=[];for(const c of r)if(i.push(c),c.roomId===e)break}const s={},o=[],a=c=>this.leave(c).then(()=>{delete s[c]}).catch(l=>{s[c]=l});for(const c of i)o.push(a(c.roomId));return Promise.all(o).then(()=>s)}ban(e,n,r){return this.membershipChange(e,n,Ge.Ban,r)}forget(e,n=!0){const r=this.membershipChange(e,void 0,"forget");return n?r.then(i=>(this.store.removeRoom(e),this.emit("deleteRoom",e),i)):r}unban(e,n){const r=Me("/rooms/$roomId/unban",{$roomId:e}),i={user_id:n};return this.http.authedRequest(oe.Post,r,void 0,i)}kick(e,n,r){const i=Me("/rooms/$roomId/kick",{$roomId:e}),s={user_id:n,reason:r};return this.http.authedRequest(oe.Post,i,void 0,s)}membershipChange(e,n,r,i){const s=Me("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(oe.Post,s,void 0,{user_id:n,reason:i})}getPushActionsForEvent(e,n=!1){if(!e.getPushActions()||n){const{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushActions()}getPushDetailsForEvent(e,n=!1){if(!e.getPushDetails()||n){const{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushDetails()}setProfileInfo(e,n){const r=Me("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(oe.Put,r,void 0,n)}async setDisplayName(e){const n=await this.setProfileInfo("displayname",{displayname:e}),r=this.getUser(this.getUserId());return r&&(r.displayName=e,r.emit(Id.DisplayName,r.events.presence,r)),n}async setAvatarUrl(e){const n=await this.setProfileInfo("avatar_url",{avatar_url:e}),r=this.getUser(this.getUserId());return r&&(r.avatarUrl=e,r.emit(Id.AvatarUrl,r.events.presence,r)),n}mxcUrlToHttp(e,n,r,i,s,o,a){return P2(this.baseUrl,e,n,r,i,s,o,a)}async setSyncPresence(e){var n;(n=this.syncApi)==null||n.setPresence(e)}async setPresence(e){const n=Me("/presence/$userId/status",{$userId:this.credentials.userId});if(["offline","online","unavailable"].indexOf(e.presence)===-1)throw new Error("Bad presence value: "+e.presence);await this.http.authedRequest(oe.Put,n,void 0,e)}getPresence(e){const n=Me("/presence/$userId/status",{$userId:e});return this.http.authedRequest(oe.Get,n)}scrollback(e,n=30){let r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){const a=Date.now()-i.errorTs;r=Math.max(eke-a,0)}if(e.oldState.paginationToken===null)return Promise.resolve(e);const s=this.store.scrollback(e,n).length;if(s===n)return Promise.resolve(e);n=n-s;const o=new Promise((a,c)=>{Jm(r).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,n,It.Backward)).then(l=>{const u=l.chunk.map(this.getEventMapper());if(l.state){const m=l.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(m)}const[d,f,p]=e.partitionThreadedEvents(u);this.processAggregatedTimelineEvents(e,d),e.addEventsToTimeline(d,!0,e.getLiveTimeline()),this.processThreadEvents(e,f,!0),p.forEach(m=>e.relations.aggregateChildEvent(m)),e.oldState.paginationToken=l.end??null,l.chunk.length===0&&(e.oldState.paginationToken=null),this.store.storeEvents(e,u,l.end??null,!0),delete this.ongoingScrollbacks[e.roomId],a(e)}).catch(l=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},c(l)})});return i={promise:o},this.ongoingScrollbacks[e.roomId]=i,o}getEventMapper(e){return NCe(this,e||{})}async getEventTimeline(e,n){var p,m;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!(e!=null&&e.room))throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);if(e.thread&&this.supportsThreads())return this.getThreadTimeline(e,n);const r=Me("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n});let i;(p=this.clientOpts)!=null&&p.lazyLoadMembers&&(i={filter:JSON.stringify(_o.LAZY_LOADING_MESSAGES_FILTER)});const s=await this.http.authedRequest(oe.Get,r,i);if(!s.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);const o=this.getEventMapper(),a=o(s.event);if(a.isRelation(hn.name)){this.logger.warn("Tried loading a regular timeline at the position of a thread event");return}const c=[...s.events_after.reverse().map(o),a,...s.events_before.map(o)];let l=e.getTimelineForEvent(c[0].getId());l?l.getState(He.BACKWARDS).setUnknownStateEvents(s.state.map(o)):(l=e.addTimeline(),l.initialiseState(s.state.map(o)),l.getState(He.FORWARDS).paginationToken=s.end);const[u,d,f]=e.room.partitionThreadedEvents(c);return e.addEventsToTimeline(u,!0,l,s.start),this.processThreadEvents(e.room,d,!0),this.processAggregatedTimelineEvents(e.room,u),f.forEach(v=>e.relations.aggregateChildEvent(v)),e.getTimelineForEvent(n)??((m=e.room.findThreadForEvent(a))==null?void 0:m.liveTimeline)??l}async getThreadTimeline(e,n){var l,u,d;if(!this.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const r=Me("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:n}),i={limit:"0"};(l=this.clientOpts)!=null&&l.lazyLoadMembers&&(i.filter=JSON.stringify(_o.LAZY_LOADING_MESSAGES_FILTER));const s=await this.http.authedRequest(oe.Get,r,i),o=this.getEventMapper(),a=o(s.event);if(!e.canContain(a))return;const c=this.canSupport.get(vo.RelationsRecursion)!==Si.Unsupported;if(wi.hasServerSideSupport)if(wi.hasServerSideFwdPaginationSupport){if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");const f=e.thread,p=await this.fetchRelations(e.room.roomId,f.id,null,null,{dir:It.Backward,from:s.start,recurse:c||void 0}),m=await this.fetchRelations(e.room.roomId,f.id,null,null,{dir:It.Forward,from:s.end,recurse:c||void 0}),v=[...m.chunk.reverse().filter(C3(f.id)).map(o),a,...p.chunk.filter(C3(f.id)).map(o)];for(const _ of v)await((u=e.thread)==null?void 0:u.processEvent(_));let S=e.getTimelineForEvent(a.getId());if(S?S.getState(He.BACKWARDS).setUnknownStateEvents(s.state.map(o)):(S=e.addTimeline(),S.initialiseState(s.state.map(o))),e.addEventsToTimeline(v,!0,S,m.next_batch),!p.next_batch){const _=await this.fetchRoomEvent(e.room.roomId,f.id);e.addEventsToTimeline([o(_)],!0,S,null)}return S.setPaginationToken(p.next_batch??null,It.Backward),S.setPaginationToken(m.next_batch??null,It.Forward),this.processAggregatedTimelineEvents(e.room,v),e.getTimelineForEvent(n)??S}else{const f=e.thread,p=await this.fetchRelations(e.room.roomId,f.id,hn.name,null,{dir:It.Backward,from:s.start,recurse:c||void 0}),m=[];let v=s.end;for(;v;){const w=await this.fetchRelations(e.room.roomId,f.id,hn.name,null,{dir:It.Forward,from:v,recurse:c||void 0});v=w.next_batch??null,m.push(...w.chunk)}const S=[...m.reverse().map(o),a,...p.chunk.map(o)];for(const w of S)await((d=e.thread)==null?void 0:d.processEvent(w));const _=e.getLiveTimeline();if(_.getState(He.BACKWARDS).setUnknownStateEvents(s.state.map(o)),e.addEventsToTimeline(S,!0,_,null),!p.next_batch){const w=await this.fetchRoomEvent(e.room.roomId,f.id);e.addEventsToTimeline([o(w)],!0,_,null)}return _.setPaginationToken(p.next_batch??null,It.Backward),_.setPaginationToken(null,It.Forward),this.processAggregatedTimelineEvents(e.room,S),_}}async getLatestTimeline(e){var r,i,s,o;if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");let n;if(e.threadListType!==null)n=(r=(await this.createThreadListMessagesRequest(e.room.roomId,null,1,It.Backward,e.threadListType,e.getFilter())).chunk)==null?void 0:r[0];else if(e.thread&&wi.hasServerSideSupport){const a=this.canSupport.get(vo.RelationsRecursion)!==Si.Unsupported;n=(i=(await this.fetchRelations(e.room.roomId,e.thread.id,hn.name,null,{dir:It.Backward,limit:1,recurse:a||void 0})).chunk)==null?void 0:i[0]}else{const a=Me("/rooms/$roomId/messages",{$roomId:e.room.roomId}),c={dir:"b"};(s=this.clientOpts)!=null&&s.lazyLoadMembers&&(c.filter=JSON.stringify(_o.LAZY_LOADING_MESSAGES_FILTER)),n=(o=(await this.http.authedRequest(oe.Get,a,c)).chunk)==null?void 0:o[0]}if(!n)throw new Error("No message returned when trying to construct getLatestTimeline");return this.getEventTimeline(e,n.event_id)}createMessagesRequest(e,n,r=30,i,s){var l,u;const o=Me("/rooms/$roomId/messages",{$roomId:e}),a={limit:r.toString(),dir:i};n&&(a.from=n);let c=null;return(l=this.clientOpts)!=null&&l.lazyLoadMembers&&(c=Object.assign({},_o.LAZY_LOADING_MESSAGES_FILTER)),s&&(c=c||{},Object.assign(c,(u=s.getRoomTimelineFilterComponent())==null?void 0:u.toJSON())),c&&(a.filter=JSON.stringify(c)),this.http.authedRequest(oe.Get,o,a)}createThreadListMessagesRequest(e,n,r=30,i=It.Backward,s=Ka.All,o){var d,f;const a=Me("/rooms/$roomId/threads",{$roomId:e}),c={limit:r.toString(),dir:i,include:JJ(s)};n&&(c.from=n);let l={};(d=this.clientOpts)!=null&&d.lazyLoadMembers&&(l={..._o.LAZY_LOADING_MESSAGES_FILTER}),o&&(l={...l,...(f=o.getRoomTimelineFilterComponent())==null?void 0:f.toJSON()}),Object.keys(l).length&&(c.filter=JSON.stringify(l));const u={prefix:wi.hasServerSideListSupport===Ac.Stable?Nn.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(oe.Get,a,c,void 0,u).then(p=>{var m;return{...p,chunk:(m=p.chunk)==null?void 0:m.reverse(),start:p.prev_batch,end:p.next_batch}})}paginateEventTimeline(e,n){const r=e.getTimelineSet()===this.notifTimelineSet,i=this.getRoom(e.getRoomId()),s=e.getTimelineSet().threadListType,o=e.getTimelineSet().thread;n=n||{};const a=n.backwards||!1;if(r&&!a)throw new Error("paginateNotifTimeline can only paginate backwards");const c=a?He.BACKWARDS:He.FORWARDS,l=e.getPaginationToken(c),u=e.paginationRequests[c];if(u)return u;let d,f,p;if(r)d="/notifications",f={limit:(n.limit??30).toString(),only:"highlight"},l&&l!=="end"&&(f.from=l),p=this.http.authedRequest(oe.Get,d,f).then(async m=>{const v=m.next_token,S=[];m.notifications=m.notifications.filter(Ya);for(let w=0;w<m.notifications.length;w++){const T=m.notifications[w],C=this.getEventMapper()(T.event);this.getPushDetailsForEvent(C,!0),C.event.room_id=T.room_id,S[w]=C}const _=e.getTimelineSet();return _.addEventsToTimeline(S,a,e,v),this.processAggregatedTimelineEvents(_.room,S),a&&!m.next_token&&e.setPaginationToken(null,c),!!m.next_token}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=p;else if(s!==null){if(!i)throw new Error("Unknown room "+e.getRoomId());if(!wi.hasServerSideFwdPaginationSupport&&c===It.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");p=this.createThreadListMessagesRequest(e.getRoomId(),l,n.limit,c,s,e.getFilter()).then(m=>{if(m.state){const w=e.getState(c),T=m.state.filter(Ya).map(this.getEventMapper());w.setUnknownStateEvents(T)}const v=m.end,S=m.chunk.filter(Ya).map(this.getEventMapper());return e.getTimelineSet().addEventsToTimeline(S,a,e,v),this.processAggregatedTimelineEvents(i,S),this.processThreadRoots(i,S,a),a&&m.end==m.start&&e.setPaginationToken(null,c),m.end!==m.start}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=p}else if(o){const m=this.getRoom(e.getRoomId()??void 0);if(!m)throw new Error("Unknown room "+e.getRoomId());const v=this.canSupport.get(vo.RelationsRecursion)!==Si.Unsupported;p=this.fetchRelations(e.getRoomId()??"",o.id,null,null,{dir:c,limit:n.limit,from:l??void 0,recurse:v||void 0}).then(async S=>{const _=this.getEventMapper(),w=S.chunk.filter(Ya).filter(C3(o.id)).map(_);for(const I of w.slice().reverse()){await(o==null?void 0:o.processEvent(I));const R=I.getSender();(!a||(o==null?void 0:o.getEventReadUpTo(R))===null)&&m.addLocalEchoReceipt(R,I,Wi.Read)}const T=S.next_batch,C=e.getTimelineSet();if(C.addEventsToTimeline(w,a,e,T??null),!T&&a){const I=o.rootEvent??_(await this.fetchRoomEvent(e.getRoomId()??"",o.id));C.addEventsToTimeline([I],!0,e,null)}return this.processAggregatedTimelineEvents(C.room,w),a&&!T&&e.setPaginationToken(null,c),!!T}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=p}else{if(!i)throw new Error("Unknown room "+e.getRoomId());p=this.createMessagesRequest(e.getRoomId(),l,n.limit,c,e.getFilter()).then(m=>{if(m.state){const I=e.getState(c),R=m.state.filter(Ya).map(this.getEventMapper());I.setUnknownStateEvents(R)}const v=m.end,S=m.chunk.filter(Ya).map(this.getEventMapper()),_=e.getTimelineSet(),[w,,T]=i.partitionThreadedEvents(S);_.addEventsToTimeline(w,a,e,v),this.processAggregatedTimelineEvents(i,w),this.processThreadRoots(i,w.filter(I=>I.getServerAggregatedRelation(hn.name)),!1),T.forEach(I=>i.relations.aggregateChildEvent(I));const C=m.end===void 0||m.end===m.start;return a&&C&&e.setPaginationToken(null,c),!C}).finally(()=>{e.paginationRequests[c]=null}),e.paginationRequests[c]=p}return p}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e,n=20){var r;return(r=this.peekSync)==null||r.stopPeeking(),this.peekSync=new I1(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,n)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,n){const r=this.sendStateEvent(e,Z.RoomGuestAccess,{guest_access:n.allowJoin?Z0.CanJoin:Z0.Forbidden},"");let i=Promise.resolve();return n.allowRead&&(i=this.sendStateEvent(e,Z.RoomHistoryVisibility,{history_visibility:G2.WorldReadable},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestAdd3pidEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestPasswordEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}async requestTokenFromEndpoint(e,n){const r=Object.assign({},n);return this.http.request(oe.Post,e,void 0,r)}getRoomPushRule(e,n){var r,i;if(this.pushRules)return(i=(r=this.pushRules[e])==null?void 0:r.room)==null?void 0:i.find(s=>s.rule_id===n);throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,n,r){let i,s=!1;const o=this.getRoomPushRule(e,n);if(o!=null&&o.actions.includes(uu.DontNotify)&&(s=!0),!r)s&&(i=this.deletePushRule(e,Hr.RoomSpecific,o.rule_id));else if(!o)i=this.addPushRule(e,Hr.RoomSpecific,n,{actions:[uu.DontNotify]});else if(!s){const a=Ef();this.deletePushRule(e,Hr.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,Hr.RoomSpecific,n,{actions:[uu.DontNotify]}).then(()=>{a.resolve()}).catch(c=>{a.reject(c)})}).catch(c=>{a.reject(c)}),i=a.promise}if(i)return new Promise((a,c)=>{i.then(()=>{this.getPushRules().then(l=>{this.pushRules=l,a()}).catch(l=>{c(l)})}).catch(l=>{this.getPushRules().then(u=>{this.pushRules=u,c(l)}).catch(u=>{c(l)})})})}searchMessageText(e){const n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}})}searchRoomEvents(e){const n={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:L4.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:n,results:[],highlights:[]};return this.search({body:n}).then(i=>this.processRoomEventsSearch(r,i))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const n={body:e._query,next_batch:e.next_batch},r=this.search(n,e.abortSignal).then(i=>this.processRoomEventsSearch(e,i)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=r,r}processRoomEventsSearch(e,n){var a;const r=n.search_categories.room_events;e.count=r.count,e.next_batch=r.next_batch;const i=new Set(r.highlights);e.highlights.forEach(c=>{i.add(c)}),e.highlights=Array.from(i);const s=this.getEventMapper(),o=((a=r.results)==null?void 0:a.length)??0;for(let c=0;c<o;c++){const l=q2.fromJson(r.results[c],s),u=this.getRoom(l.context.getEvent().getRoomId());if(u)for(const d of l.context.getTimeline()){const f=u.getMember(d.getSender());!d.sender&&f&&(d.sender=f)}e.results.push(l)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;const e=new I1(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){const n=Me("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(oe.Post,n,void 0,e).then(r=>{const i=_o.fromJson(this.credentials.userId,r.filter_id,e);return this.store.storeFilter(i),i})}getFilter(e,n,r){if(r){const s=this.store.getFilter(e,n);if(s)return Promise.resolve(s)}const i=Me("/user/$userId/filter/$filterId",{$userId:e,$filterId:n});return this.http.authedRequest(oe.Get,i).then(s=>{const o=_o.fromJson(e,n,s);return this.store.storeFilter(o),o})}async getOrCreateFilter(e,n){const r=this.store.getFilterIdByName(e);let i;if(r){try{const o=await this.getFilter(this.credentials.userId,r,!0);if(o){const a=o.getDefinition(),c=n.getDefinition();of(a,c)&&(i=r)}}catch(o){if(o.errcode!=="M_UNKNOWN"&&o.errcode!=="M_NOT_FOUND")throw o}i||this.store.setFilterIdByName(e,void 0)}if(i)return i;const s=await this.createFilter(n.getDefinition());return this.store.setFilterIdByName(e,s.filterId),s.filterId}getOpenIdToken(){const e=Me("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(oe.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(oe.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return this.checkTurnServersIntervalID!==void 0}async checkTurnServers(){if(!this.canSupportVoip)return;let e=!1;const n=this.turnServersExpiry-Date.now();if(n>nB)this.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),e=!0;else{this.logger.debug("Fetching new TURN credentials");try{const r=await this.turnServer();if(r.uris){this.logger.debug("Got TURN URIs: "+r.uris+" refresh in "+r.ttl+" secs");const i={urls:r.uris,username:r.username,credential:r.password};this.turnServers=[i],this.turnServersExpiry=Date.now()+r.ttl*1e3,e=!0,this.emit("turnServers",this.turnServers)}}catch(r){this.logger.error("Failed to get TURN URIs",r),r.httpStatus===403?(this.logger.info("TURN access unavailable for this account: stopping credentials checks"),this.checkTurnServersIntervalID!==null&&global.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.emit("turnServers.error",r,!0)):this.emit("turnServers.error",r,!1)}}return e}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){const e=Me("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(oe.Get,e,void 0,void 0,{prefix:""}).then(n=>n.admin)}whoisSynapseUser(e){const n=Me("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(oe.Get,n,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){const n=Me("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(oe.Post,n,void 0,void 0,{prefix:""})}async fetchClientWellKnown(){this.clientWellKnownPromise=gC.getRawClientConfig(this.getDomain()??void 0),this.clientWellKnown=await this.clientWellKnownPromise,this.emit("WellKnown.client",this.clientWellKnown)}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){const e=["boolean","string","number"],n=Object.entries(this.clientOpts).filter(([r,i])=>e.includes(typeof i)).reduce((r,[i,s])=>(r[i]=s,r),{});return this.store.storeClientOptions(n)}async _unstable_getSharedRooms(e){const n=await this.doesServerSupportUnstableFeature(qJ),r=await this.doesServerSupportUnstableFeature(GJ),i=await this.doesServerSupportUnstableFeature(zJ);if(!n&&!r&&!i)throw Error("Server does not support the Mutual Rooms API");let s,o;i?(s="/uk.half-shot.msc2666/user/mutual_rooms",o={user_id:e}):(s=Me(`/uk.half-shot.msc2666/user/${r?"mutual_rooms":"shared_rooms"}/$userId`,{$userId:e}),o={});const a=[];let c=null;do{const l={};c!=null&&i&&(l.batch_token=c);const u=await this.http.authedRequest(oe.Get,s,{...o,...l},void 0,{prefix:Nn.Unstable});a.push(...u.joined),u.next_batch_token!==void 0?c=u.next_batch_token:c=null}while(c!=null);return a}async getVersions(){if(this.serverVersionsPromise)return this.serverVersionsPromise;this.serverVersionsPromise=this.http.authedRequest(oe.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(n=>{throw this.serverVersionsPromise=void 0,n});const e=await this.serverVersionsPromise;return this.canSupport=await uEe(e),this.serverVersionsPromise}async isVersionSupported(e){const{versions:n}=await this.getVersions();return n&&n.includes(e)}async doesServerSupportUnstableFeature(e){const n=await this.getVersions();if(!n)return!1;const r=n.unstable_features;return r&&!!r[e]}async doesServerForceEncryptionForPreset(e){const n=await this.getVersions();if(!n)return!1;const r=n.unstable_features,i=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return r&&!!r[`io.element.e2ee_forced.${i}`]}async doesServerSupportThread(){if(await this.isVersionSupported("v1.4"))return{threads:Ac.Stable,list:Ac.Stable,fwdPagination:Ac.Stable};try{const[e,n,r,i,s,o]=await Promise.all([this.doesServerSupportUnstableFeature("org.matrix.msc3440"),this.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3856"),this.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),this.doesServerSupportUnstableFeature("org.matrix.msc3715"),this.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:JE(n,e),list:JE(i,r),fwdPagination:JE(o,s)}}catch{return{threads:Ac.None,list:Ac.None,fwdPagination:Ac.None}}}hasLazyLoadMembersEnabled(){var e;return!!((e=this.clientOpts)!=null&&e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}async relations(e,n,r,i,s={dir:It.Backward}){const o=i?this.getEncryptedIfNeededEventType(e,i):null,[a,c]=await Promise.all([this.fetchRoomEvent(e,n),this.fetchRelations(e,n,r,o,s)]),l=this.getEventMapper(),u=a?l(a):void 0;let d=c.chunk.map(l);if(o===Z.RoomMessageEncrypted){const f=u?d.concat(u):d;await Promise.all(f.map(p=>this.decryptEventIfNeeded(p))),i!==null&&(d=d.filter(p=>p.getType()===i))}return u&&r===qn.Replace&&(d=d.filter(f=>f.getSender()===u.getSender())),{originalEvent:u??null,events:d,nextBatch:c.next_batch??null,prevBatch:c.prev_batch??null}}getCrossSigningCacheCallbacks(){var e;return(e=this.crypto)==null?void 0:e.crossSigningInfo.getCacheCallbacks()}generateClientSecret(){return Zi(32)}decryptEventIfNeeded(e,n){return e.shouldAttemptDecryption()&&this.isCryptoEnabled()&&e.attemptDecryption(this.cryptoBackend,n),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve()}termsUrlForService(e,n){switch(e){case mC.IS:return this.http.getUrl("/terms",void 0,Oc.V2,n);case mC.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",n);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(e=!1){var n,r;return e&&((n=this.idBaseUrl)!=null&&n.startsWith("http://")||(r=this.idBaseUrl)!=null&&r.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=n3(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){return this.http.opts.refreshToken??null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return this.http.opts.accessToken!==void 0}makeTxnId(){return"m"+new Date().getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(oe.Get,"/register/available",{username:e}).then(n=>n.available).catch(n=>n.errcode==="M_USER_IN_USE"?!1:Promise.reject(n))}register(e,n,r,i,s,o,a){r&&(i.session=r);const c={auth:i,refresh_token:!0};return e!=null&&(c.username=e),n!=null&&(c.password=n),o!=null&&(c.guest_access_token=o),a!=null&&(c.inhibit_login=a),this.registerRequest(c)}registerGuest({body:e}={}){return this.registerRequest(e||{},"guest")}registerRequest(e,n){const r={};return n&&(r.kind=n),this.http.request(oe.Post,"/register",r,e)}refreshToken(e){const n=r=>this.http.authedRequest(oe.Post,"/refresh",void 0,{refresh_token:e},{prefix:r,inhibitLogoutEmit:!0});return n(Nn.V3).catch(r=>{if(r.errcode==="M_UNRECOGNIZED")return n(Nn.V1);throw r})}loginFlows(){return this.http.request(oe.Get,"/login")}login(e,n){return this.http.authedRequest(oe.Post,"/login",void 0,{...n,type:e}).then(r=>(r.access_token&&r.user_id&&(this.http.opts.accessToken=r.access_token,this.credentials={userId:r.user_id}),r))}loginWithPassword(e,n){return this.login("m.login.password",{user:e,password:n})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e,n="sso",r,i){let s="/login/"+n+"/redirect";r&&(s+="/"+r);const o={redirectUrl:e,[ike.unstable]:i};return this.http.getUrl(s,o).href}loginWithToken(e){return this.login("m.login.token",{token:e})}async logout(e=!1){var n,r;if((r=(n=this.crypto)==null?void 0:n.backupManager)!=null&&r.getKeyBackupEnabled())try{for(;await this.crypto.backupManager.backupPendingKeys(200)>0;);}catch(i){this.logger.error("Key backup request failed when logging out. Some keys may be missing from backup",i)}return e&&(this.stopClient(),this.http.abort()),this.http.authedRequest(oe.Post,"/logout")}deactivateAccount(e,n){const r={};return e&&(r.auth=e),n!==void 0&&(r.erase=n),this.http.authedRequest(oe.Post,"/account/deactivate",void 0,r)}async requestLoginToken(e){const n={auth:e};return this.http.authedRequest(oe.Post,"/login/get_token",void 0,n,{prefix:Nn.V1})}getFallbackAuthUrl(e,n){const r=Me("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:n}).href}async createRoom(e){var r;const n=(e.invite_3pid||[]).filter(i=>!i.id_access_token);if(n.length>0&&((r=this.identityServer)!=null&&r.getAccessToken)){const i=await this.identityServer.getAccessToken();if(i)for(const s of n)s.id_access_token=i}return this.http.authedRequest(oe.Post,"/createRoom",void 0,e)}fetchRelations(e,n,r,i,s={dir:It.Backward}){let o=s;wi.hasServerSideFwdPaginationSupport===Ac.Experimental&&(o=L$("dir","org.matrix.msc3715.dir",o)),this.canSupport.get(vo.RelationsRecursion)===Si.Unstable&&(o=L$("recurse","org.matrix.msc3981.recurse",o));const a=XT(o);let c="/rooms/$roomId/relations/$eventId";r!==null?(c+="/$relationType",i!==null&&(c+="/$eventType")):i!==null&&(this.logger.warn(`eventType: ${i} ignored when fetching
            relations as relationType is null`),i=null);const l=Me(c+"?"+a,{$roomId:e,$eventId:n,$relationType:r,$eventType:i});return this.http.authedRequest(oe.Get,l,void 0,void 0,{prefix:Nn.V1})}roomState(e){const n=Me("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(oe.Get,n)}fetchRoomEvent(e,n){const r=Me("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(oe.Get,r)}members(e,n,r,i){const s={};n&&(s.membership=n),r&&(s.not_membership=r),i&&(s.at=i);const o=XT(s),a=Me("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(oe.Get,a)}upgradeRoom(e,n){const r=Me("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(oe.Post,r,void 0,{new_version:n})}getStateEvent(e,n,r){const i={$roomId:e,$eventType:n,$stateKey:r};let s=Me("/rooms/$roomId/state/$eventType",i);return r!==void 0&&(s=Me(s+"/$stateKey",i)),this.http.authedRequest(oe.Get,s)}sendStateEvent(e,n,r,i="",s={}){const o={$roomId:e,$eventType:n,$stateKey:i};let a=Me("/rooms/$roomId/state/$eventType",o);return i!==void 0&&(a=Me(a+"/$stateKey",o)),this.http.authedRequest(oe.Put,a,void 0,r,s)}roomInitialSync(e,n){const r=Me("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(oe.Get,r,{limit:(n==null?void 0:n.toString())??"30"})}async setRoomReadMarkersHttpRequest(e,n,r,i){const s=Me("/rooms/$roomId/read_markers",{$roomId:e}),o={[Wi.FullyRead]:n,[Wi.Read]:r};return(await this.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await this.isVersionSupported("v1.4"))&&(o[Wi.ReadPrivate]=i),this.http.authedRequest(oe.Post,s,void 0,o)}getJoinedRooms(){const e=Me("/joined_rooms",{});return this.http.authedRequest(oe.Get,e)}getJoinedRoomMembers(e){const n=Me("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(oe.Get,n)}publicRooms({server:e,limit:n,since:r,...i}={}){if(Object.keys(i).length===0){const s={server:e,limit:n,since:r};return this.http.authedRequest(oe.Get,"/publicRooms",s)}else{const s={server:e},o={limit:n,since:r,...i};return this.http.authedRequest(oe.Post,"/publicRooms",s,o)}}createAlias(e,n){const r=Me("/directory/room/$alias",{$alias:e}),i={room_id:n};return this.http.authedRequest(oe.Put,r,void 0,i)}deleteAlias(e){const n=Me("/directory/room/$alias",{$alias:e});return this.http.authedRequest(oe.Delete,n)}getLocalAliases(e){const n=Me("/rooms/$roomId/aliases",{$roomId:e}),r=Nn.V3;return this.http.authedRequest(oe.Get,n,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){const n=Me("/directory/room/$alias",{$alias:e});return this.http.authedRequest(oe.Get,n)}getRoomDirectoryVisibility(e){const n=Me("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(oe.Get,n)}setRoomDirectoryVisibility(e,n){const r=Me("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(oe.Put,r,void 0,{visibility:n})}searchUserDirectory({term:e,limit:n}){const r={search_term:e};return n!==void 0&&(r.limit=n),this.http.authedRequest(oe.Post,"/user_directory/search",void 0,r)}uploadContent(e,n){return this.http.uploadContent(e,n)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,n){const r=n?Me("/profile/$userId/$info",{$userId:e,$info:n}):Me("/profile/$userId",{$userId:e});return this.http.authedRequest(oe.Get,r)}async doesServerSupportExtendedProfiles(){return this.doesServerSupportUnstableFeature(WJ)}async getExtendedProfileRequestPrefix(){return await this.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable")?Nn.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"}async getExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");return this.http.authedRequest(oe.Get,Me("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()})}async getExtendedProfileProperty(e,n){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");return(await this.http.authedRequest(oe.Get,Me("/profile/$userId/$key",{$userId:e,$key:n}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()}))[n]}async setExtendedProfileProperty(e,n){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const r=this.getUserId();await this.http.authedRequest(oe.Put,Me("/profile/$userId/$key",{$userId:r,$key:e}),void 0,{[e]:n},{prefix:await this.getExtendedProfileRequestPrefix()})}async deleteExtendedProfileProperty(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const n=this.getUserId();await this.http.authedRequest(oe.Delete,Me("/profile/$userId/$key",{$userId:n,$key:e}),void 0,void 0,{prefix:await this.getExtendedProfileRequestPrefix()})}async patchExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const n=this.getUserId();return this.http.authedRequest(oe.Patch,Me("/profile/$userId",{$userId:n}),{},e,{prefix:await this.getExtendedProfileRequestPrefix()})}async setExtendedProfile(e){if(!await this.doesServerSupportExtendedProfiles())throw new Error("Server does not support extended profiles");const n=this.getUserId();await this.http.authedRequest(oe.Put,Me("/profile/$userId",{$userId:n}),{},e,{prefix:await this.getExtendedProfileRequestPrefix()})}getThreePids(){return this.http.authedRequest(oe.Get,"/account/3pid")}async addThreePidOnly(e){return this.http.authedRequest(oe.Post,"/account/3pid/add",void 0,e)}async bindThreePid(e){return this.http.authedRequest(oe.Post,"/account/3pid/bind",void 0,e)}async unbindThreePid(e,n){const r="/account/3pid/unbind",i={medium:e,address:n,id_server:this.getIdentityServerUrl(!0)};return this.http.authedRequest(oe.Post,r,void 0,i)}deleteThreePid(e,n){return this.http.authedRequest(oe.Post,"/account/3pid/delete",void 0,{medium:e,address:n})}setPassword(e,n,r){const i="/account/password",s={auth:e,new_password:n,logout_devices:r};return this.http.authedRequest(oe.Post,i,void 0,s)}getDevices(){return this.http.authedRequest(oe.Get,"/devices")}getDevice(e){const n=Me("/devices/$device_id",{$device_id:e});return this.http.authedRequest(oe.Get,n)}setDeviceDetails(e,n){const r=Me("/devices/$device_id",{$device_id:e});return this.http.authedRequest(oe.Put,r,void 0,n)}deleteDevice(e,n){const r=Me("/devices/$device_id",{$device_id:e}),i={};return n&&(i.auth=n),this.http.authedRequest(oe.Delete,r,void 0,i)}deleteMultipleDevices(e,n){const r={devices:e};return n&&(r.auth=n),this.http.authedRequest(oe.Post,"/delete_devices",void 0,r)}async getPushers(){const e=await this.http.authedRequest(oe.Get,"/pushers");return await this.doesServerSupportUnstableFeature("org.matrix.msc3881")||(e.pushers=e.pushers.map(n=>(n.hasOwnProperty(R6.name)||(n[R6.name]=!0),n))),e}setPusher(e){return this.http.authedRequest(oe.Post,"/pushers/set",void 0,e)}removePusher(e,n){const r="/pushers/set",i={pushkey:e,app_id:n,kind:null};return this.http.authedRequest(oe.Post,r,void 0,i)}setLocalNotificationSettings(e,n){const r=`${cY.name}.${e}`;return this.setAccountData(r,n)}getPushRules(){return this.http.authedRequest(oe.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=hC.rewriteDefaultRules(e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,n,r,i){const s=Me("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(oe.Put,s,void 0,i)}deletePushRule(e,n,r){const i=Me("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(oe.Delete,i)}setPushRuleEnabled(e,n,r,i){const s=Me("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:n,$ruleId:r});return this.http.authedRequest(oe.Put,s,void 0,{enabled:i})}setPushRuleActions(e,n,r,i){const s=Me("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:n,$ruleId:r});return this.http.authedRequest(oe.Put,s,void 0,{actions:i})}search({body:e,next_batch:n},r){const i={};return n&&(i.next_batch=n),this.http.authedRequest(oe.Post,"/search",i,e,{abortSignal:r})}uploadKeysRequest(e,n){return this.http.authedRequest(oe.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(oe.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e,{token:n}={}){const r={device_keys:{}};return n!==void 0&&(r.token=n),e.forEach(i=>{r.device_keys[i]=[]}),this.http.authedRequest(oe.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e,n="signed_curve25519",r){const i={};n===void 0&&(n="signed_curve25519");for(const[a,c]of e){const l=i[a]||{};nl(i,a,l),nl(l,c,n)}const s={one_time_keys:i};return r&&(s.timeout=r),this.http.authedRequest(oe.Post,"/keys/claim",void 0,s)}getKeyChanges(e,n){const r={from:e,to:n};return this.http.authedRequest(oe.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,n){const r=Object.assign({},n);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(oe.Post,"/keys/device_signing/upload",void 0,r,{prefix:Nn.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");const n=this.http.getUrl("/account/register",void 0,Oc.V2,this.idBaseUrl);return this.http.requestOtherUrl(oe.Post,n,e)}requestEmailToken(e,n,r,i,s){const o={client_secret:n,email:e,send_attempt:r==null?void 0:r.toString()};return i&&(o.next_link=i),this.http.idServerRequest(oe.Post,"/validate/email/requestToken",o,Oc.V2,s)}requestMsisdnToken(e,n,r,i,s,o){const a={client_secret:r,country:e,phone_number:n,send_attempt:i==null?void 0:i.toString()};return s&&(a.next_link=s),this.http.idServerRequest(oe.Post,"/validate/msisdn/requestToken",a,Oc.V2,o)}submitMsisdnToken(e,n,r,i){const s={sid:e,client_secret:n,token:r};return this.http.idServerRequest(oe.Post,"/validate/msisdn/submitToken",s,Oc.V2,i??void 0)}submitMsisdnTokenOtherUrl(e,n,r,i){const s={sid:n,client_secret:r,token:i};return this.http.requestOtherUrl(oe.Post,e,s)}getIdentityHashDetails(e){return this.http.idServerRequest(oe.Get,"/hash_details",void 0,Oc.V2,e)}async identityHashedLookup(e,n){const r={},i=await this.getIdentityHashDetails(n);if(!i||!i.lookup_pepper||!i.algorithms)throw new Error("Unsupported identity server: bad response");r.pepper=i.lookup_pepper;const s={};if(i.algorithms.includes("sha256"))r.addresses=await Promise.all(e.map(async c=>{const l=c[0].toLowerCase(),u=c[1].toLowerCase(),d=await VJ(`${l} ${u} ${r.pepper}`),f=F2(d);return s[f]=c[0],f})),r.algorithm="sha256";else if(i.algorithms.includes("none"))r.addresses=e.map(c=>{const l=c[0].toLowerCase(),u=c[1].toLowerCase(),d=`${l} ${u}`;return s[d]=c[0],d}),r.algorithm="none";else throw new Error("Unsupported identity server: unknown hash algorithm");const o=await this.http.idServerRequest(oe.Post,"/lookup",r,Oc.V2,n);if(!(o!=null&&o.mappings))return[];const a=[];for(const c of Object.keys(o.mappings)){const l=o.mappings[c],u=s[c];if(!u)throw new Error("Identity server returned more results than expected");a.push({address:u,mxid:l})}return a}async lookupThreePid(e,n,r){const s=(await this.identityHashedLookup([[n,e]],r)).find(a=>a.address===n);return s?{address:n,medium:e,mxid:s.mxid}:{}}async bulkLookupThreePids(e,n){const r=await this.identityHashedLookup(e.map(s=>[s[1],s[0]]),n),i=[];for(const s of r){const o=e.find(a=>a[1]===s.address);if(!o)throw new Error("Identity sever returned unexpected results");i.push([o[0],s.address,s.mxid])}return{threepids:i}}getIdentityAccount(e){return this.http.idServerRequest(oe.Get,"/account",void 0,Oc.V2,e)}sendToDevice(e,n,r){const i=Me("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),s={messages:xh(n)},o=new Map;for(const[a,c]of n)o.set(a,Array.from(c.keys()));return this.logger.debug(`PUT ${i}`,o),this.http.authedRequest(oe.Put,i,void 0,s)}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(oe.Get,"/thirdparty/protocols").then(e=>{if(!e||typeof e!="object")throw new Error(`/thirdparty/protocols did not return an object: ${e}`);return e})}getThirdpartyLocation(e,n){const r=Me("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(oe.Get,r,n)}getThirdpartyUser(e,n){const r=Me("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(oe.Get,r,n)}getTerms(e,n){const r=this.termsUrlForService(e,n);return this.http.requestOtherUrl(oe.Get,r)}agreeToTerms(e,n,r,i){const s=this.termsUrlForService(e,n),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(oe.Post,s,{user_accepts:i},{headers:o})}reportEvent(e,n,r,i){const s=Me("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(oe.Post,s,void 0,{score:r,reason:i})}getRoomHierarchy(e,n,r,i=!1,s){const o=Me("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(i),max_depth:r==null?void 0:r.toString(),from:s,limit:n==null?void 0:n.toString()};return this.http.authedRequest(oe.Get,o,a,void 0,{prefix:Nn.V1}).catch(c=>{if(c.errcode==="M_UNRECOGNIZED")return this.http.authedRequest(oe.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw c})}async unstableCreateFileTree(e){const{room_id:n}=await this.createRoom({name:e,preset:Tb.PrivateChat,power_level_content_override:{...UCe,users:{[this.getUserId()]:100}},creation_content:{[eC]:Ph.Space},initial_state:[{type:E6.name,state_key:C6.name,content:{[T6.name]:!0}},{type:Z.RoomEncryption,state_key:"",content:{algorithm:Ks}}]});return new JF(this,n)}unstableGetFileTreeSpace(e){var s,o;const n=this.getRoom(e);if((n==null?void 0:n.getMyMembership())!==Ge.Join)return null;const r=n.currentState.getStateEvents(Z.RoomCreate,""),i=n.currentState.getStateEvents(E6.name,C6.name);if(!r)throw new Error("Expected single room create event");return!((s=i==null?void 0:i.getContent())!=null&&s[T6.name])||((o=r.getContent())==null?void 0:o[eC])!==Ph.Space?null:new JF(this,e)}slidingSync(e,n,r){const i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);const s=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(oe.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.msc3575",baseUrl:n,localTimeoutMs:s,abortSignal:r})}supportsThreads(){var e;return((e=this.clientOpts)==null?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(vo.IntentionalMentions)!==Si.Unsupported}async getRoomSummary(e,n){const r={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{const i=Me("/summary/$roomid",{$roomid:e});return await this.http.authedRequest(oe.Get,i,{via:n},void 0,r)}catch(i){if(i instanceof Ii&&i.errcode==="M_UNRECOGNIZED"){const s=Me("/rooms/$roomid/summary",{$roomid:e});return await this.http.authedRequest(oe.Get,s,{via:n},void 0,r)}else throw i}}processThreadEvents(e,n,r){e.processThreadedEvents(n,r)}processThreadRoots(e,n,r){this.supportsThreads()&&e.processThreadRoots(n,r)}processBeaconEvents(e,n){this.processAggregatedTimelineEvents(e,n)}processAggregatedTimelineEvents(e,n){n!=null&&n.length&&e&&(e.currentState.processBeaconEvents(n,this),e.processPollEvents(n))}async whoami(){return this.http.authedRequest(oe.Get,"/account/whoami")}async timestampToEvent(e,n,r){const i=Me("/rooms/$roomId/timestamp_to_event",{$roomId:e}),s={ts:n.toString(),dir:r};try{return await this.http.authedRequest(oe.Get,i,s,void 0,{prefix:Nn.V1})}catch(o){if(o.errcode==="M_UNRECOGNIZED"&&(o.httpStatus===400||o.httpStatus===404||o.httpStatus===405))return await this.http.authedRequest(oe.Get,i,s,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw o}}async getAuthIssuer(){return this.http.request(oe.Get,"/auth_issuer",void 0,void 0,{prefix:Nn.Unstable+"/org.matrix.msc2965"})}};i7.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY";let Qh=i7;function rB(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[`${Hc}.${e}`,n]))}function YJ(t,e){var u;const n=t.getUserId(),r=e.getId(),i=t.getRoom(e.getRoomId());if(!i||!n||!r)return;if(!i.findEventById(r)){k.info(`Decrypted event ${e.getId()} is not in room ${i.roomId}: ignoring`);return}const s=!!e.threadRootId&&!e.isThreadRoot;let o;if(s){const d=i.getThread(e.threadRootId);o=d?d.hasUserReadEvent(n,r):!0}else o=i.hasUserReadEvent(n,r);if(o)return;const a=t.getPushActionsForEvent(e,!0);if(!!((u=a==null?void 0:a.tweaks)!=null&&u.highlight)){const d=i.getUnreadCountForEventContext(xr.Highlight,e)+1;s?i.setThreadUnreadNotificationCount(e.threadRootId,xr.Highlight,d):i.setUnreadNotificationCount(xr.Highlight,d)}if(!!(a!=null&&a.notify)){const d=i.getUnreadCountForEventContext(xr.Total,e)+1;s?i.setThreadUnreadNotificationCount(e.threadRootId,xr.Total,d):i.setUnreadNotificationCount(xr.Total,d)}}function tv(t){return Q0(t)?pb:t.threadRootId}function Q0(t){return!t.threadRootId||t.isThreadRoot?!0:t.isRelation()?t.isRelation(hn.name)?!1:t.relationEventId===t.threadRootId:(k.warn(`Event is not a relation or a thread root, but still has a threadRootId! id=${t.getId()}`),!0)}var Ga=(t=>(t.New="Thread.new",t.Update="Thread.update",t.NewReply="Thread.newReply",t.ViewThread="Thread.viewThread",t.Delete="Thread.delete",t))(Ga||{}),Ac=(t=>(t[t.None=0]="None",t[t.Experimental=1]="Experimental",t[t.Stable=2]="Stable",t))(Ac||{});function JE(t,e){return t?2:e?1:0}const Xo=class Xo extends FY{constructor(e,n,r){if(super(),this.id=e,this.rootEvent=n,this._currentUserParticipated=!1,this.replyCount=0,this.pendingReplyCount=0,this.initialEventsFetched=!Xo.hasServerSideSupport,this.replayEvents=[],this.onTimelineReset=async()=>{await this.processRootEventPromise,this.processRootEventPromise=void 0},this.onBeforeRedaction=(i,s)=>{i!=null&&i.isRelation(hn.name)&&this.room.eventShouldLiveIn(i).threadId===this.id&&i.getId()!==this.id&&!s.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit("Thread.update",this))},this.onRedaction=async(i,s,o)=>{var a;if(o===this.id)if(this.replyCount<=0){for(const c of this.timeline)this.clearEventMetadata(c);this.lastEvent=this.rootEvent,this._currentUserParticipated=!1,this.emit("Thread.delete",this)}else((a=this.lastEvent)==null?void 0:a.getId())===i.getAssociatedId()&&(await this.processRootEventPromise,this.processRootEventPromise=void 0),await this.updateThreadMetadata()},this.onTimelineEvent=(i,s,o)=>{if(!o){const a=i.getSender();a&&s&&this.shouldSendLocalEchoReceipt(a,i)&&s.addLocalEchoReceipt(a,i,Wi.Read),i.getId()!==this.id&&i.isRelation(hn.name)&&this.replyCount++}this.onEcho(i,o??!1)},this.onLocalEcho=i=>{this.onEcho(i,!1)},this.onEcho=async(i,s)=>{i.threadRootId===this.id&&this.lastEvent!==i&&(await this.updateThreadMetadata(),i.isRelation(hn.name)&&(s||(this.lastEvent=void 0,this.emit("Thread.newReply",this,i))))},this.setMaxListeners(1e3),!(r!=null&&r.room))throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=r.pendingEventOrdering??Zh.Chronological,this.timelineSet=new jg(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new Bv(this),this.reEmitter.reEmit(this.timelineSet,[ct.Timeline,ct.TimelineReset]),this.room.on(sn.BeforeRedaction,this.onBeforeRedaction),this.room.on(ct.Redaction,this.onRedaction),this.room.on(ct.LocalEchoUpdated,this.onLocalEcho),this.room.on(ct.TimelineReset,this.onTimelineReset),this.timelineSet.on(ct.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}async fetchRootEvent(){try{const e=await this.client.fetchRoomEvent(this.roomId,this.id),n=this.client.getEventMapper();this.rootEvent=n(e)}catch(e){k.error("Failed to fetch thread root to construct thread with",e)}await this.processEvent(this.rootEvent)}static setServerSideSupport(e){Xo.hasServerSideSupport=e,e!==2&&(gm.setPreferUnstable(!0),mm.setPreferUnstable(!0),hn.setPreferUnstable(!0))}static setServerSideListSupport(e){Xo.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){Xo.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,n){var i;if((this.client.canSupport.get(vo.RelationsRecursion)??Si.Unsupported)===Si.Unsupported){const s=(i=this.getReadReceiptForUserId(e))==null?void 0:i.eventId;if(s){const o=this.findEventById(s);if(o&&o.getTs()>n.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(He.FORWARDS)}addEventToTimeline(e,n){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:n,fromCache:!1,roomState:this.roomState})}insertEventIntoTimeline(e){const n=e.getId();n&&(this.findEventById(n)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState))}addEvents(e,n){e.forEach(r=>this.addEvent(r,n,!1)),this.updateThreadMetadata()}addEvent(e,n,r=!0){this.setEventMetadata(e);const i=this.lastReply(),s=!i||e.localTimestamp>=i.localTimestamp;if(!Xo.hasServerSideSupport)this.addEventToTimeline(e,n),this.client.decryptEventIfNeeded(e);else if(e.isRelation(qn.Annotation)||e.isRelation(qn.Replace)){this.addRelatedThreadEvent(e,n);return}else!n&&s?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):n?this.addEventToTimeline(e,n):this.insertEventIntoTimeline(e);e.getId()!==this.id&&e.isRelation(hn.name)&&!n&&s&&(this.lastEvent=void 0),r&&(this.emit("Thread.newReply",this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,n){var r,i,s;this.initialEventsFetched?(this.client.canSupport.get(vo.RelationsRecursion)??Si.Unsupported)===Si.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,n):(r=this.replayEvents)==null||r.push(e),(i=this.timelineSet.relations)==null||i.aggregateParentEvent(e),(s=this.timelineSet.relations)==null||s.aggregateChildEvent(e,this.timelineSet)}async processEvent(e){e&&(this.setEventMetadata(e),await this.fetchEditsWhereNeeded(e))}processReceipts(e=[]){for(const{eventId:n,receiptType:r,userId:i,receipt:s,synthetic:o}of e)this.addReceiptToStructure(n,r,i,s,o)}getRootEventBundledRelationship(e=this.rootEvent){return e==null?void 0:e.getServerAggregatedRelation(hn.name)}async processRootEvent(){const e=this.getRootEventBundledRelationship();if(Xo.hasServerSideSupport&&e){this.replyCount=e.count,this._currentUserParticipated=!!e.current_user_participated;const n=this.client.getEventMapper();this.lastEvent=n({...e.latest_event,room_id:this.roomId}),this.updatePendingReplyCount(),await this.processEvent(this.lastEvent)}}updatePendingReplyCount(){const n=(this.pendingEventOrdering===Zh.Detached?this.room.getPendingEvents():this.events).filter(r=>{var i;return r.threadRootId===this.id&&r.isRelation(hn.name)&&r.status!==null&&r.getId()!==((i=this.lastEvent)==null?void 0:i.getId())});this.lastPendingEvent=n.length?n[n.length-1]:void 0,this.pendingReplyCount=n.length}async resetLiveTimeline(e,n){const r=this.liveTimeline;this.timelineSet.resetLiveTimeline(e??void 0,n??void 0);const i=this.liveTimeline;let s,o;e&&(s=(await this.client.createMessagesRequest(this.roomId,e,1,It.Forward)).end),n&&(o=(await this.client.createMessagesRequest(this.roomId,n,1,It.Backward)).start),n&&r.getPaginationToken(It.Forward)===n&&r.setPaginationToken(o??null,It.Forward),e&&i.getPaginationToken(It.Backward)===e&&i.setPaginationToken(s??null,It.Backward)}async updateThreadFromRootEvent(){Xo.hasServerSideSupport&&(!this.initialEventsFetched&&!this.lastEvent&&await this.processRootEvent(),await this.fetchRootEvent()),await this.processRootEvent()}async updateThreadMetadata(){if(this.updatePendingReplyCount(),this.processRootEventPromise||(this.processRootEventPromise=this.updateThreadFromRootEvent()),await this.processRootEventPromise,!this.initialEventsFetched)if(this.initalEventFetchProm)await this.initalEventFetchProm;else try{this.timelineSet.resetLiveTimeline(),this.replyCount===0&&this.rootEvent?(this.timelineSet.addEventsToTimeline([this.rootEvent],!0,this.liveTimeline,null),this.liveTimeline.setPaginationToken(null,It.Backward)):(this.initalEventFetchProm=this.client.paginateEventTimeline(this.liveTimeline,{backwards:!0}),await this.initalEventFetchProm),this.initialEventsFetched=!0;for(const e of this.replayEvents)this.addEvent(e,!1);this.replayEvents=null,this.emit(ct.TimelineReset,this.room,this.timelineSet,!0)}catch(e){k.error("Failed to load start of newly created thread: ",e),this.initialEventsFetched=!1}this.emit("Thread.update",this)}async fetchEditsWhereNeeded(...e){if((this.client.canSupport.get(vo.RelationsRecursion)??Si.Unsupported)===Si.Unsupported)return Promise.all(e.filter(ske).map(async r=>{try{const i=await this.client.relations(this.roomId,r.getId(),qn.Replace,r.getType(),{limit:1});if(i.events.length){const s=i.events[0];r.makeReplaced(s),this.insertEventIntoTimeline(s)}}catch(i){k.error("Failed to load edits for encrypted thread event",i)}}))}setEventMetadata(e){e&&(He.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){var n,r,i;e&&(e.setThread(void 0),(i=(r=(n=e.event)==null?void 0:n.unsigned)==null?void 0:r["m.relations"])==null||delete i[hn.name])}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(e=n=>n.isRelation(hn.name)){for(let n=this.timeline.length-1;n>=0;n--){const r=this.timeline[n];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){return this.lastPendingEvent??this.lastEvent??this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof oi}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,n){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,n){var o;const r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){const a=i.getTs()<this.room.getOldestThreadedReceiptTs(),c=i.getId();if(a&&c)return c}const s=super.getEventReadUpTo(e,n);if(i){const a=this.room.getLastUnthreadedReceiptFor(e);if(!a)return s;for(let c=((o=this.timeline)==null?void 0:o.length)-1;c>=0;--c){const l=this.timeline[c];if(l.getId()===s)return s;if(l.getTs()<a.ts)return l.getId()??s}}return s}hasUserReadEvent(e,n){var r,i,s;if(e===this.client.getUserId()){const o=(((r=this.lastReply())==null?void 0:r.getTs())??0)<this.room.getOldestThreadedReceiptTs(),a=((i=this.room.getLastUnthreadedReceiptFor(e))==null?void 0:i.ts)??0,c=(((s=this==null?void 0:this.lastReply())==null?void 0:s.getTs())??0)<a;if(o||c)return!0}return this.room.hasUserReadEvent(e,n)}setUnread(e,n){return this.room.setThreadUnreadNotificationCount(this.id,e,n)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}};Xo.hasServerSideSupport=0,Xo.hasServerSideListSupport=0,Xo.hasServerSideFwdPaginationSupport=0;let wi=Xo;function ske(t){return t.isEncrypted()&&(t.isRelation(hn.name)||t.isThreadRoot)}const gm=new R2("related_by_senders","io.element.relation_senders"),mm=new R2("related_by_rel_types","io.element.relation_types"),hn=new R2("m.thread","io.element.thread");var Ka=(t=>(t[t.My=0]="My",t[t.All=1]="All",t))(Ka||{});function JJ(t){switch(t){case 0:return"participated";default:return"all"}}const iB=Object.freeze({visible:!0});var sn=(t=>(t.Decrypted="Event.decrypted",t.BeforeRedaction="Event.beforeRedaction",t.VisibilityChange="Event.visibilityChange",t.LocalEventIdReplaced="Event.localEventIdReplaced",t.Status="Event.status",t.Replaced="Event.replaced",t.RelationsCreated="Event.relationsCreated",t))(sn||{});class oi extends Fn{constructor(e={}){super(),this.event=e,this.pushDetails={},this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this.visibility=iB,this._hasCachedExtEv=!1,this._cachedExtEv=void 0,this._decryptionFailureReason=null,this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=null,this.decryptionPromise=null,this.retryDecryption=!1,this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,["state_key","type","sender","room_id","membership"].forEach(r=>{typeof e[r]=="string"&&(e[r]=t3(e[r]))}),["membership","avatar_url","displayname"].forEach(r=>{var i;typeof((i=e.content)==null?void 0:i[r])=="string"&&(e.content[r]=t3(e.content[r]))}),["rel_type"].forEach(r=>{var i,s;typeof((s=(i=e.content)==null?void 0:i["m.relates_to"])==null?void 0:s[r])=="string"&&(e.content["m.relates_to"][r]=t3(e.content["m.relates_to"][r]))}),this.txnId=e.txn_id;const n=this.getAge();this.localTimestamp=n!==void 0?Date.now()-n:this.getTs()??Date.now(),this.reEmitter=new Bv(this)}get unstableExtensibleEvent(){return this._hasCachedExtEv||(this._cachedExtEv=ws.ExtensibleEvents.parse(this.getEffectiveEvent())),this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){const e=Object.assign({},this.getContent());if(this.getWireType()===Z.RoomMessageEncrypted)for(const[n,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(n)||e[n]===void 0&&(e[n]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var n;const e=this.getRoomId();return e?`id=${this.getId()} type=${this.getWireType()} sender=${this.getSender()} room=${e} ts=${(n=this.getDate())==null?void 0:n.toISOString()}`:`msgid=${this.getContent()[vs]} type=${this.getWireType()} sender=${this.getSender()}`}getOriginalContent(){return this._localRedactionEvent?{}:this.clearEvent?this.clearEvent.content||{}:this.event.content||{}}getContent(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var r;if(this.isState())return;const e=(r=this.getWireContent())==null?void 0:r["m.relates_to"];if((e==null?void 0:e.rel_type)===hn.name)return e.event_id;if(this.thread)return this.thread.id;if(this.threadId!==void 0)return this.threadId;const n=this.getUnsigned();if(typeof n[tC.name]=="string")return n[tC.name]}get isThreadRoot(){return this.isState()?!1:!!this.getServerAggregatedRelation(hn.name)||this.threadRootId===this.getId()}get replyEventId(){var e,n;return(n=(e=this.getWireContent()["m.relates_to"])==null?void 0:e["m.in_reply_to"])==null?void 0:n.event_id}get relationEventId(){var e,n;return(n=(e=this.getWireContent())==null?void 0:e["m.relates_to"])==null?void 0:n.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.event.state_key}isState(){return this.event.state_key!==void 0}getMembershipAtEvent(){const e=this.getUnsigned();return lY.findIn(e)}makeEncrypted(e,n,r,i){this.clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=n,this.senderCurve25519Key=r,this.claimedEd25519Key=i}isBeingDecrypted(){return this.decryptionPromise!=null}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return this._decryptionFailureReason!==null}get decryptionFailureReason(){return this._decryptionFailureReason}get isEncryptedDisabledForUnverifiedDevices(){return this.decryptionFailureReason===Gn.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}async attemptDecryption(e,n={}){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");const r=this.clearEvent&&!this.isDecryptionFailure(),i=n.forceRedecryptIfUntrusted&&this.isKeySourceUntrusted();if(r&&!i)throw new Error("Attempt to decrypt event which has already been decrypted");return this.decryptionPromise?(k.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this.retryDecryption=!0,this.decryptionPromise):(this.decryptionPromise=this.decryptionLoop(e,n),this.decryptionPromise)}cancelAndResendKeyRequest(e,n){const r=this.getWireContent();return e.requestRoomKey({algorithm:r.algorithm,room_id:this.getRoomId(),session_id:r.session_id,sender_key:r.sender_key},this.getKeyRequestRecipients(n),!0)}getKeyRequestRecipients(e){return[{userId:e,deviceId:"*"}]}async decryptionLoop(e,n={}){for(await Promise.resolve();;){this.retryDecryption=!1;let r;try{const i=await e.decryptEvent(this);n.isRetry===!0&&k.info(`Decrypted event on retry (${this.getDetails()})`),this.setClearData(i),this._decryptionFailureReason=null}catch(i){const s=i instanceof jr?i.detailedString:String(i);if(r=i,this.retryDecryption){k.log(`Error decrypting event (${this.getDetails()}), but retrying: ${s}`);continue}k.warn(`Error decrypting event (${this.getDetails()}): ${s}`),this.setClearDataForDecryptionFailure(String(i)),this._decryptionFailureReason=i instanceof jr?i.code:Gn.UNKNOWN_ERROR}this.decryptionPromise=null,this.retryDecryption=!1,this.setPushDetails(),n.emit!==!1&&this.emit("Event.decrypted",this,r);return}}setClearData(e){this.clearEvent=e.clearEvent,this.senderCurve25519Key=e.senderCurve25519Key??null,this.claimedEd25519Key=e.claimedEd25519Key??null,this.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this.untrusted=e.untrusted||!1,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:Z.RoomMessage,content:{msgtype:"m.bad.encrypted",body:`** Unable to decrypt: ${e} **`}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.forwardingCurve25519KeyChain=[],this.untrusted=!1,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return!this.isState()&&this.event.type===Z.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return this.forwardingCurve25519KeyChain}isKeySourceUntrusted(){return!!this.untrusted}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){const n=(e==null?void 0:e.visible)??!0,r=(e==null?void 0:e.reason)??null;let i=!1;(this.visibility.visible!==n||!this.visibility.visible&&this.visibility.reason!==r)&&(i=!0),i&&(n?this.visibility=iB:this.visibility=Object.freeze({visible:!1,reason:r}),this.emit("Event.visibilityChange",this,n))}messageVisibility(){return this.visibility}makeRedacted(e,n){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(const s in this.event)this.event.hasOwnProperty(s)&&!oke.has(s)&&delete this.event[s];this.isEncrypted()&&(this.clearEvent=void 0);const r=this.getType()in sB?sB[this.getType()]:{},i=this.getContent();for(const s in i)i.hasOwnProperty(s)&&!r[s]&&delete i[s];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(n),e.moveToMainTimeline(n)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var r;const n=this.thread;if(this.moveToMainTimeline(e),n)for(const i of n.events)((r=i.getRelation())==null?void 0:r.event_id)===this.getId()&&i.moveAllRelatedToMainTimeline(e)}moveToMainTimeline(e){var r;(r=this.thread)==null||r.timelineSet.removeEvent(this.getId()),this.setThread(void 0);const n=e.getLiveTimeline();n.getTimelineSet().insertEventIntoTimeline(this,n,n.getState(He.FORWARDS))}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===Z.RoomRedaction}asVisibilityChange(){if(!vh.matches(this.getType()))return null;const e=this.getRelation();if(!e||e.rel_type!="m.reference")return null;const n=e.event_id;if(!n)return null;const r=this.getWireContent(),i=!!r.visible,s=r.reason;return s&&typeof s!="string"?null:{visible:i,reason:s,eventId:n}}isVisibilityEvent(){return vh.matches(this.getType())}getRedactionEvent(){var e,n,r;return this.isRedacted()?(e=this.clearEvent)!=null&&e.unsigned?((n=this.clearEvent)==null?void 0:n.unsigned.redacted_because)??null:(r=this.event.unsigned)!=null&&r.redacted_because?this.event.unsigned.redacted_because:{}:null}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,n){this.pushDetails={actions:e,rule:n}}handleRemoteEcho(e){const n=this.getUnsigned(),r=this.getId();this.event=e,n.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=n.redacted_because),this.setStatus(null),this.getId()!==r&&this.emit("Event.localEventIdReplaced",this),this.localTimestamp=Date.now()-this.getAge()}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit("Event.status",this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)}isRelation(e){var r;const n=(r=this.getWireContent())==null?void 0:r["m.relates_to"];return this.isState()&&(n!=null&&n.rel_type)&&[qn.Replace,qn.Thread].includes(n.rel_type)?!1:!!(n!=null&&n.rel_type&&n.event_id&&(!e||n.rel_type===e))}getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]??null:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit("Event.replaced",this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var n;return(n=this.getUnsigned()["m.relations"])==null?void 0:n[e]}replacingEventId(){const e=this.getServerAggregatedRelation(qn.Replace);if(e)return e.event_id;if(this._replacingEvent)return this._replacingEvent.getId()}replacingEvent(){return this._replacingEvent}replacingEventDate(){const e=this.getServerAggregatedRelation(qn.Replace);if(e){const n=e.origin_server_ts;if(Number.isFinite(n))return new Date(n)}else if(this._replacingEvent)return this._replacingEvent.getDate()??void 0}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){const e=this.getRelation();if(this.replyEventId)return this.replyEventId;if(e)return e.event_id;if(this.isRedaction())return this.event.redacts}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){const n=this.getRelation();n?n.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(e=!0){this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){const e=new oi(JSON.parse(JSON.stringify(this.event)));for(const[n,r]of Object.entries(this))n!=="event"&&(e[n]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;const n=b6(this.event),r=b6(e.event);return JSON.stringify(n)===JSON.stringify(r)}toJSON(){const e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setVerificationRequest(e){this.verificationRequest=e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[Ga.Update]),this.thread=e,this.setThreadId(e==null?void 0:e.id),e&&this.reEmitter.reEmit(e,[Ga.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}}const oke=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),sB={[Z.RoomMember]:{membership:1},[Z.RoomJoinRules]:{join_rule:1},[Z.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}};var xt=(t=>(t.Events="RoomState.events",t.Members="RoomState.members",t.NewMember="RoomState.newMember",t.Update="RoomState.update",t.BeaconLiveness="RoomState.BeaconLiveness",t.Marker="RoomState.Marker",t))(xt||{});class e_ extends Fn{constructor(e,n={status:0},r=!1){super(),this.roomId=e,this.oobMemberFlags=n,this.isStartTimelineState=r,this.reEmitter=new Bv(this),this.sentinels={},this.displayNameToUserIds=new Map,this.userIdsToDisplayNames={},this.tokenToInvite={},this.joinedMemberCount=null,this.summaryJoinedMemberCount=null,this.invitedMemberCount=null,this.summaryInvitedMemberCount=null,this.modified=-1,this.members={},this.events=new Map,this.paginationToken=null,this.beacons=new Map,this._liveBeaconIds=[],this.updateModifiedTime()}getJoinedMemberCount(){return this.summaryJoinedMemberCount!==null?this.summaryJoinedMemberCount:(this.joinedMemberCount===null&&(this.joinedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Ge.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return this.summaryInvitedMemberCount!==null?this.summaryInvitedMemberCount:(this.invitedMemberCount===null&&(this.invitedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Ge.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(n=>!e.includes(n.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;let n=this.sentinels[e];if(n===void 0){n=new nC(this.roomId,e);const r=this.members[e];r!=null&&r.events.member&&n.setMembershipEvent(r.events.member,this),this.sentinels[e]=n}return n}getStateEvents(e,n){if(!this.events.has(e))return n===void 0?[]:null;if(n===void 0)return Array.from(this.events.get(e).values());const r=this.events.get(e).get(n);return r||null}get hasLiveBeacons(){var e;return!!((e=this.liveBeaconIds)!=null&&e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){const e=new e_(this.roomId,this.oobMemberFlags),n=this.oobMemberFlags.status;return this.oobMemberFlags.status=0,Array.from(this.events.values()).forEach(r=>{e.setStateEvents(Array.from(r.values()))}),this.oobMemberFlags.status=n,this.summaryInvitedMemberCount!==null&&e.setInvitedMemberCount(this.getInvitedMemberCount()),this.summaryJoinedMemberCount!==null&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==2&&this.getMembers().forEach(r=>{var i;r.isOutOfBand()&&((i=e.getMember(r.userId))==null||i.markOutOfBand())}),e}setUnknownStateEvents(e){const n=e.filter(r=>!this.events.has(r.getType())||!this.events.get(r.getType()).has(r.getStateKey()));this.setStateEvents(n)}setStateEvents(e,n){this.updateModifiedTime(),e.forEach(r=>{var l,u;if(r.getRoomId()!==this.roomId||!r.isState())return;D4.matches(r.getType())&&this.setBeacon(r);const i=this.getStateEventMatching(r),s=(l=i==null?void 0:i.event.unsigned)==null?void 0:l.replaces_state,o=i==null?void 0:i.event.event_id,a=(u=r.event.unsigned)==null?void 0:u.replaces_state,c=r.event.event_id;if(this.isStartTimelineState){if(a&&o&&a===o)return}else if(s&&c&&s===c)return;this.setStateEvent(r),r.getType()===Z.RoomMember&&(this.updateDisplayNameCache(r.getStateKey(),r.getContent().displayname??""),this.updateThirdPartyTokenCache(r)),this.emit("RoomState.events",r,this,i)}),this.onBeaconLivenessChange(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState()))if(r.getType()===Z.RoomMember){const i=r.getStateKey();(r.getContent().membership===Ge.Leave||r.getContent().membership===Ge.Ban)&&(r.getContent().avatar_url=r.getContent().avatar_url||r.getPrevContent().avatar_url,r.getContent().displayname=r.getContent().displayname||r.getPrevContent().displayname);const s=this.getOrCreateMember(i,r);s.setMembershipEvent(r,this),this.updateMember(s),this.emit("RoomState.members",r,this,s)}else if(r.getType()===Z.RoomPowerLevels){if(r.getStateKey()!=="")return;Object.values(this.members).forEach(s=>{const o=s.getLastModifiedTime();s.setPowerLevelEvent(r),o!==s.getLastModifiedTime()&&this.emit("RoomState.members",r,this,s)}),this.sentinels={}}else oY.matches(r.getType())&&this.emit("RoomState.Marker",r,n)}),this.emit("RoomState.update",this)}async processBeaconEvents(e,n){var s;if(!e.length||!this.beacons.size)return;const r=[...this.beacons.values()].reduce((o,a)=>(o[a.beaconInfoId]=a,o),{}),i=(o,a)=>{if(!fM.matches(a.getType()))return;const c=r[o];c&&c.addLocations([a])};for(const o of e){const a=(s=o.getRelation())==null?void 0:s.event_id;if(!a||!r[a]||!fM.matches(o.getType())&&!o.isEncrypted())return;try{await n.decryptEventIfNeeded(o),i(a,o)}catch{o.isDecryptionFailure()&&o.once(sn.Decrypted,async()=>{i(a,o)})}}}getOrCreateMember(e,n){let r=this.members[e];return r||(r=new nC(this.roomId,e),this.members[e]=r,this.emit("RoomState.newMember",n,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var i;const n=cC(e);if(this.beacons.has(n)){const s=this.beacons.get(n);if(e.isRedacted()){s.beaconInfoId===((i=e.getRedactionEvent())==null?void 0:i.redacts)&&(s.destroy(),this.beacons.delete(n));return}return s.update(e)}if(e.isRedacted())return;const r=new UY(e);this.reEmitter.reEmit(r,[_r.New,_r.Update,_r.Destroy,_r.LivenessChange]),this.emit(_r.New,e,r),r.on(_r.LivenessChange,this.onBeaconLivenessChange.bind(this)),r.on(_r.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(r.identifier,r)}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit("RoomState.BeaconLiveness",this,this.hasLiveBeacons)}getStateEventMatching(e){var n;return((n=this.events.get(e.getType()))==null?void 0:n.get(e.getStateKey()))??null}updateMember(e){const n=this.getStateEvents(Z.RoomPowerLevels,"");n&&e.setPowerLevelEvent(n),delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===0}outOfBandMembersReady(){return this.oobMemberFlags.status===2}markOutOfBandMembersStarted(){this.oobMemberFlags.status===0&&(this.oobMemberFlags.status=1)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===1&&(this.oobMemberFlags.status=0)}clearOutOfBandMembers(){let e=0;Object.keys(this.members).forEach(n=>{this.members[n].isOutOfBand()&&(++e,delete this.members[n])}),k.log(`LL: RoomState removed ${e} members...`),this.oobMemberFlags.status=0}setOutOfBandMembers(e){k.log(`LL: RoomState about to set ${e.length} OOB members ...`),this.oobMemberFlags.status===1&&(k.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=2,e.forEach(n=>this.setOutOfBandMember(n)),this.emit("RoomState.update",this))}setOutOfBandMember(e){if(e.getType()!==Z.RoomMember)return;const n=e.getStateKey(),r=this.getMember(n);if(r&&!r.isOutOfBand())return;const i=this.getOrCreateMember(n,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit("RoomState.members",e,this,i)}setTypingEvent(e){Object.values(this.members).forEach(function(n){n.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){return this.displayNameToUserIds.get(Ih(e))??[]}maySendRedactionForEvent(e,n){const r=this.getMember(n);return!r||r.membership===Ge.Leave||e.status||e.isRedacted()||!this.maySendEvent(Z.RoomRedaction,n)?!1:e.getSender()===n?!0:this.hasSufficientPowerLevelFor("redact",r.powerLevel)}hasSufficientPowerLevelFor(e,n){const r=this.getStateEvents(Z.RoomPowerLevels,"");let i={};r&&(i=r.getContent());let s=50;return D$(i[e])&&(s=i[e]),n>=s}maySendMessage(e){return this.maySendEventOfType(Z.RoomMessage,e,!1)}maySendEvent(e,n){return this.maySendEventOfType(e,n,!1)}mayClientSendStateEvent(e,n){return n.isGuest()||!n.credentials.userId?!1:this.maySendStateEvent(e,n.credentials.userId)}maySendStateEvent(e,n){return this.maySendEventOfType(e,n,!0)}maySendEventOfType(e,n,r){const i=this.getStateEvents(Z.RoomPowerLevels,"");let s,o={},a=0,c=0,l=0;if(i){s=i.getContent(),o=s.events||{},Number.isSafeInteger(s.state_default)?a=s.state_default:a=50;const d=s.users&&s.users[n];Number.isSafeInteger(d)?l=d:Number.isSafeInteger(s.users_default)&&(l=s.users_default),Number.isSafeInteger(s.events_default)&&(c=s.events_default)}let u=r?a:c;return Number.isSafeInteger(o[e])&&(u=o[e]),l>=u}mayTriggerNotifOfType(e,n){const r=this.getMember(n);if(!r)return!1;const i=this.getStateEvents(Z.RoomPowerLevels,"");let s=50;return i&&i.getContent()&&i.getContent().notifications&&D$(i.getContent().notifications[e])&&(s=i.getContent().notifications[e]),r.powerLevel>=s}getJoinRule(){const e=this.getStateEvents(Z.RoomJoinRules,"");return((e==null?void 0:e.getContent())??{}).join_rule||hu.Invite}getHistoryVisibility(){const e=this.getStateEvents(Z.RoomHistoryVisibility,"");return((e==null?void 0:e.getContent())??{}).history_visibility||G2.Shared}getGuestAccess(){const e=this.getStateEvents(Z.RoomGuestAccess,"");return((e==null?void 0:e.getContent())??{}).guest_access||Z0.Forbidden}findPredecessor(e=!1){if(e){const r=this.getStateEvents(Z.RoomPredecessor,"");if(r){const i=r.getContent(),s=i.predecessor_room_id;let o=i.last_known_event_id;typeof o!="string"&&(o=void 0);let a=i.via_servers;if(Array.isArray(a)||(a=void 0),typeof s=="string")return{roomId:s,eventId:o,viaServers:a}}}const n=this.getStateEvents(Z.RoomCreate,"");if(n){const r=n.getContent().predecessor;if(r){const i=r.room_id;if(typeof i=="string"){let s=r.event_id;return(typeof s!="string"||s==="")&&(s=void 0),{roomId:i,eventId:s}}}}return null}updateThirdPartyTokenCache(e){if(!e.getContent().third_party_invite)return;const n=(e.getContent().third_party_invite.signed||{}).token;!n||!this.getStateEvents(Z.RoomThirdPartyInvite,n)||(this.tokenToInvite[n]=e)}updateDisplayNameCache(e,n){const r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){const s=Ih(r),o=this.displayNameToUserIds.get(s);if(o){const a=o.filter(c=>c!==e);this.displayNameToUserIds.set(s,a)}}this.userIdsToDisplayNames[e]=n;const i=n&&Ih(n);if(i){const s=this.displayNameToUserIds.get(i)??[];s.push(e),this.displayNameToUserIds.set(i,s)}}}function oB(t){return typeof t=="string"&&!!t&&t!=="undefined"&&t!=="null"||typeof t=="number"}class t_{constructor(e={}){this.rooms={},this.users={},this.syncToken=null,this.filters=new fr(()=>new Map),this.accountData=new Map,this.oobMembers=new Map,this.pendingEvents={},this.pendingToDeviceBatches=[],this.nextToDeviceBatchId=0,this.onRoomMember=(n,r,i)=>{var o;if(i.membership===Ge.Invite)return;const s=this.users[i.userId]||((o=this.createUser)==null?void 0:o.call(this,i.userId));i.name&&(s.setDisplayName(i.name),i.events.member&&s.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&s.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[s.userId]=s},this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(xt.Members,this.onRoomMember),e.currentState.getMembers().forEach(n=>{this.onRoomMember(null,e.currentState,n)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(xt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,n){return[]}storeEvents(e,n,r,i){}storeFilter(e){!(e!=null&&e.userId)||!(e!=null&&e.filterId)||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,n){var r;return((r=this.filters.get(e))==null?void 0:r.get(n))||null}getFilterIdByName(e){if(!this.localStorage)return null;const n="mxjssdk_memory_filter_"+e;try{const r=this.localStorage.getItem(n);if(oB(r))return r}catch{}return null}setFilterIdByName(e,n){if(!this.localStorage)return;const r="mxjssdk_memory_filter_"+e;try{oB(n)?this.localStorage.setItem(r,n):this.localStorage.removeItem(r)}catch{}}storeAccountDataEvents(e){e.forEach(n=>{!Object.keys(n.getContent()).length?this.accountData.delete(n.getType()):this.accountData.set(n.getType(),n)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new fr(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,n){return this.oobMembers.set(e,n),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}async getPendingEvents(e){return this.pendingEvents[e]??[]}async setPendingEvents(e,n){this.pendingEvents[e]=n}saveToDeviceBatches(e){for(const n of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:n.eventType,txnId:n.txnId,batch:n.batch});return Promise.resolve()}async getOldestToDeviceBatch(){return this.pendingToDeviceBatches.length===0?null:this.pendingToDeviceBatches[0]}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(n=>n.id!==e),Promise.resolve()}async destroy(){}}var XJ=(t=>(t.ToWidget="toWidget",t.FromWidget="fromWidget",t))(XJ||{});function ake(t){if(t==="toWidget")return"fromWidget";if(t==="fromWidget")return"toWidget";throw new Error("Invalid direction")}var dd=(t=>(t.MSC2762="org.matrix.msc2762",t.MSC2871="org.matrix.msc2871",t.MSC2931="org.matrix.msc2931",t.MSC2974="org.matrix.msc2974",t.MSC2876="org.matrix.msc2876",t.MSC3819="org.matrix.msc3819",t.MSC3846="town.robin.msc3846",t.MSC3869="org.matrix.msc3869",t.MSC3973="org.matrix.msc3973",t.MSC4039="org.matrix.msc4039",t))(dd||{});const cke=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2871","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class lke extends M2.EventEmitter{constructor(e,n,r,i){super(),this.sendDirection=e,this.initialWidgetId=n,this.transportWindow=r,this.inboundWindow=i,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this._widgetId=null,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=n}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let n=0,r=e;for(;this.outboundRequests.has(r);)r=`${e}-${n++}`;return this.outboundRequests.set(r,null),r}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,n){return this.sendInternal({...e,response:n})}send(e,n){return this.sendComplete(e,n).then(r=>r.response)}sendComplete(e,n){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:n};return e===Vi.UpdateVisibility&&(r.visible=n.visible),new Promise((i,s)=>{const o=d=>{u(),i(d)},a=d=>{u(),s(d)},c=setTimeout(()=>a(new Error("Request timed out")),(this.timeoutSeconds||1)*1e3),l=()=>a(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",l);const u=()=>{this.outboundRequests.delete(r.requestId),clearTimeout(c),this.stopController.signal.removeEventListener("abort",l)};this.outboundRequests.set(r.requestId,{request:r,resolve:o,reject:a}),this.sendInternal(r)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==window.origin)return;const n=e.data;if(!(!n.action||!n.requestId||!n.widgetId))if(n.response){if(n.api!==this.sendDirection)return;this.handleResponse(n)}else{const r=n;if(r.api!==ake(this.sendDirection))return;this.handleRequest(r)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const n=this.outboundRequests.get(e.requestId);if(n)if(dke(e.response)){const r=e.response;n.reject(new Error(r.error.message))}else n.resolve(e)}}var Vi=(t=>(t.SupportedApiVersions="supported_api_versions",t.Capabilities="capabilities",t.NotifyCapabilities="notify_capabilities",t.TakeScreenshot="screenshot",t.UpdateVisibility="visibility",t.OpenIDCredentials="openid_credentials",t.WidgetConfig="widget_config",t.CloseModalWidget="close_modal",t.ButtonClicked="button_clicked",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.UpdateTurnServers="update_turn_servers",t))(Vi||{}),Kn=(t=>(t.SupportedApiVersions="supported_api_versions",t.ContentLoaded="content_loaded",t.SendSticker="m.sticker",t.UpdateAlwaysOnScreen="set_always_on_screen",t.GetOpenIDCredentials="get_openid",t.CloseModalWidget="close_modal",t.OpenModalWidget="open_modal",t.SetModalButtonEnabled="set_button_enabled",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.WatchTurnServers="watch_turn_servers",t.UnwatchTurnServers="unwatch_turn_servers",t.BeeperReadRoomAccountData="com.beeper.read_room_account_data",t.MSC2876ReadEvents="org.matrix.msc2876.read_events",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",t.MSC3869ReadRelations="org.matrix.msc3869.read_relations",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",t.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",t.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(Kn||{}),Ag=(t=>(t.Allowed="allowed",t.Blocked="blocked",t.PendingUserConfirmation="request",t))(Ag||{}),ZJ=(t=>(t.Custom="m.custom",t.JitsiMeet="m.jitsi",t.Stickerpicker="m.stickerpicker",t))(ZJ||{}),QJ=(t=>(t.Close="m.close",t))(QJ||{}),Ic=(t=>(t.Send="send",t.Receive="receive",t))(Ic||{});class Gi{constructor(e,n,r,i,s){this.direction=e,this.eventType=n,this.kind=r,this.keyStr=i,this.raw=s}matchesAsStateEvent(e,n,r){return this.kind!=="state_event"||this.direction!==e||this.eventType!==n?!1:this.keyStr===null||this.keyStr===r}matchesAsToDeviceEvent(e,n){return!(this.kind!=="to_device"||this.direction!==e||this.eventType!==n)}matchesAsRoomEvent(e,n,r=null){if(this.kind!=="event"||this.direction!==e||this.eventType!==n)return!1;if(this.eventType==="m.room.message"){if(this.keyStr===null||this.keyStr===r)return!0}else return!0;return!1}matchesAsRoomAccountData(e,n){return!(this.kind!=="room_account"||this.direction!==e||this.eventType!==n)}static forStateEvent(e,n,r){n=n.replace(/#/g,"\\#"),r=r!=null?`#${r}`:"";const i=`org.matrix.msc2762.${e}.state_event:${n}${r}`;return Gi.findEventCapabilities([i])[0]}static forToDeviceEvent(e,n){const r=`org.matrix.msc3819.${e}.to_device:${n}`;return Gi.findEventCapabilities([r])[0]}static forRoomEvent(e,n){const r=`org.matrix.msc2762.${e}.event:${n}`;return Gi.findEventCapabilities([r])[0]}static forRoomMessageEvent(e,n){n=n??"";const r=`org.matrix.msc2762.${e}.event:m.room.message#${n}`;return Gi.findEventCapabilities([r])[0]}static forRoomAccountData(e,n){const r=`com.beeper.capabilities.${e}.room_account_data:${n}`;return Gi.findEventCapabilities([r])[0]}static findEventCapabilities(e){const n=[];for(const r of e){let i=null,s,o=null;if(r.startsWith("org.matrix.msc2762.send.event:")?(i="send",o="event",s=r.substring(30)):r.startsWith("org.matrix.msc2762.send.state_event:")?(i="send",o="state_event",s=r.substring(36)):r.startsWith("org.matrix.msc3819.send.to_device:")?(i="send",o="to_device",s=r.substring(34)):r.startsWith("org.matrix.msc2762.receive.event:")?(i="receive",o="event",s=r.substring(33)):r.startsWith("org.matrix.msc2762.receive.state_event:")?(i="receive",o="state_event",s=r.substring(39)):r.startsWith("org.matrix.msc3819.receive.to_device:")?(i="receive",o="to_device",s=r.substring(37)):r.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(i="receive",o="room_account",s=r.substring(50)),i===null||o===null||s===void 0)continue;const a=s.startsWith("m.room.message#")||o==="state_event";let c=null;if(s.includes("#")&&a){const l=s.split("#"),u=l.findIndex(d=>!d.endsWith("\\"));s=l.slice(0,u+1).map(d=>d.endsWith("\\")?d.substring(0,d.length-1):d).join("#"),c=l.slice(u+1).join("#")}n.push(new Gi(i,s,o,c,r))}return n}}var ch=(t=>(t.AnyRoom="*",t))(ch||{});class uke extends M2.EventEmitter{constructor(e=null,n=null){if(super(),this.clientOrigin=n,this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!window.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new lke(XJ.FromWidget,e,window.parent,window),this.transport.targetOrigin=n,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){e.forEach(n=>this.requestCapability(n))}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,n){this.requestCapability(Gi.forStateEvent(Ic.Send,e,n).raw)}requestCapabilityToReceiveState(e,n){this.requestCapability(Gi.forStateEvent(Ic.Receive,e,n).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(Gi.forToDeviceEvent(Ic.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(Gi.forToDeviceEvent(Ic.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(Gi.forRoomEvent(Ic.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(Gi.forRoomEvent(Ic.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(Gi.forRoomMessageEvent(Ic.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(Gi.forRoomMessageEvent(Ic.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(Gi.forRoomAccountData(Ic.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,n)=>{this.transport.sendComplete(Kn.GetOpenIDCredentials,{}).then(r=>{const i=r.response;if(i.state===Ag.Allowed)e(i);else if(i.state===Ag.Blocked)n(new Error("User declined to verify their identity"));else if(i.state===Ag.PendingUserConfirmation){const s=o=>{o.preventDefault();const a=o.detail;a.data.original_request_id===r.requestId&&(a.data.state===Ag.Allowed?(e(a.data),this.transport.reply(a,{})):a.data.state===Ag.Blocked?(n(new Error("User declined to verify their identity")),this.transport.reply(a,{})):(n(new Error("Invalid state on reply: "+i.state)),this.transport.reply(a,{error:{message:"Invalid state"}})),this.off(`action:${Vi.OpenIDCredentials}`,s))};this.on(`action:${Vi.OpenIDCredentials}`,s)}else n(new Error("Invalid state: "+i.state))}).catch(n)})}updateRequestedCapabilities(){return this.transport.send(Kn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Kn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Kn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Kn.UpdateAlwaysOnScreen,{value:e}).then(n=>n.success)}openModalWidget(e,n,r=[],i={},s=ZJ.Custom){return this.transport.send(Kn.OpenModalWidget,{type:s,url:e,name:n,buttons:r,data:i}).then()}closeModalWidget(e={}){return this.transport.send(Kn.CloseModalWidget,e).then()}sendRoomEvent(e,n,r,i,s){return this.sendEvent(e,void 0,n,r,i,s)}sendStateEvent(e,n,r,i,s,o){return this.sendEvent(e,n,r,i,s,o)}sendEvent(e,n,r,i,s,o){return this.transport.send(Kn.SendEvent,{type:e,content:r,...n!==void 0&&{state_key:n},...i!==void 0&&{room_id:i},...s!==void 0&&{delay:s},...o!==void 0&&{parent_delay_id:o}})}updateDelayedEvent(e,n){return this.transport.send(Kn.MSC4157UpdateDelayedEvent,{delay_id:e,action:n})}sendToDevice(e,n,r){return this.transport.send(Kn.SendToDevice,{type:e,encrypted:n,messages:r})}readRoomAccountData(e,n){const r={type:e};return n&&(n.includes(ch.AnyRoom)?r.room_ids=ch.AnyRoom:r.room_ids=n),this.transport.send(Kn.BeeperReadRoomAccountData,r).then(i=>i.events)}readRoomEvents(e,n,r,i,s){const o={type:e,msgtype:r};return n!==void 0&&(o.limit=n),i&&(i.includes(ch.AnyRoom)?o.room_ids=ch.AnyRoom:o.room_ids=i),s&&(o.since=s),this.transport.send(Kn.MSC2876ReadEvents,o).then(a=>a.events)}async readEventRelations(e,n,r,i,s,o,a,c){if(!(await this.getClientVersions()).includes(dd.MSC3869))throw new Error("The read_relations action is not supported by the client.");const u={event_id:e,rel_type:r,event_type:i,room_id:n,to:a,from:o,limit:s,direction:c};return this.transport.send(Kn.MSC3869ReadRelations,u)}readStateEvents(e,n,r,i){const s={type:e,state_key:r===void 0?!0:r};return n!==void 0&&(s.limit=n),i&&(i.includes(ch.AnyRoom)?s.room_ids=ch.AnyRoom:s.room_ids=i),this.transport.send(Kn.MSC2876ReadEvents,s).then(o=>o.events)}setModalButtonEnabled(e,n){if(e===QJ.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Kn.SetModalButtonEnabled,{button:e,enabled:n}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Kn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const n=async r=>{r.preventDefault(),e(r.detail.data),await this.transport.reply(r.detail,{})};if(this.on(`action:${Vi.UpdateTurnServers}`,n),this.turnServerWatchers===0)try{await this.transport.send(Kn.WatchTurnServers,{})}catch(r){throw this.off(`action:${Vi.UpdateTurnServers}`,n),r}this.turnServerWatchers++;try{for(;;)yield await new Promise(r=>e=r)}finally{this.off(`action:${Vi.UpdateTurnServers}`,n),this.turnServerWatchers--,this.turnServerWatchers===0&&await this.transport.send(Kn.UnwatchTurnServers,{})}}async searchUserDirectory(e,n){if(!(await this.getClientVersions()).includes(dd.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const i={search_term:e,limit:n};return this.transport.send(Kn.MSC3973UserDirectorySearch,i)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(dd.MSC4039))throw new Error("The get_media_config action is not supported by the client.");const n={};return this.transport.send(Kn.MSC4039GetMediaConfigAction,n)}async uploadFile(e){if(!(await this.getClientVersions()).includes(dd.MSC4039))throw new Error("The upload_file action is not supported by the client.");const r={file:e};return this.transport.send(Kn.MSC4039UploadFileAction,r)}async downloadFile(e){if(!(await this.getClientVersions()).includes(dd.MSC4039))throw new Error("The download_file action is not supported by the client.");const r={content_uri:e};return this.transport.send(Kn.MSC4039DownloadFileAction,r)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(dd.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const n=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,n),!n.defaultPrevented)switch(e.detail.action){case Vi.SupportedApiVersions:return this.replyVersions(e.detail);case Vi.Capabilities:return this.handleCapabilities(e.detail);case Vi.UpdateVisibility:return this.transport.reply(e.detail,{});case Vi.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:cke})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Kn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(n=>(n.includes(dd.MSC2871)?this.once(`action:${Vi.NotifyCapabilities}`,r=>{this.approvedCapabilities=r.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var e0=(t=>(t.Screenshots="m.capability.screenshot",t.StickerSending="m.sticker",t.AlwaysOnScreen="m.always_on_screen",t.RequiresClient="io.element.requires_client",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC3846TurnServers="town.robin.msc3846.turn_servers",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039UploadFile="org.matrix.msc4039.upload_file",t.MSC4039DownloadFile="org.matrix.msc4039.download_file",t.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(e0||{});function dke(t){return"error"in t?!!t.error.message:!1}class eX extends Qh{constructor(e,n,r,i,s){var o,a,c,l,u,d,f,p,m,v,S,_;super(i),this.widgetApi=e,this.capabilities=n,this.roomId=r,this.syncState=null,this.onEvent=async w=>{if(w.preventDefault(),w.detail.data.room_id===this.roomId){const T=new oi(w.detail.data);await this.syncApi.injectRoomEvents(this.room,[],[T]),this.emit(qe.Event,T),this.setSyncState(ii.Syncing),k.info(`Received event ${T.getId()} ${T.getType()} ${T.getStateKey()}`)}else{const{event_id:T,room_id:C}=w.detail.data;k.info(`Received event ${T} for a different room ${C}; discarding`)}await this.ack(w)},this.onToDevice=async w=>{w.preventDefault();const T=new oi({type:w.detail.data.type,sender:w.detail.data.sender,content:w.detail.data.content});w.detail.data.encrypted&&T.makeEncrypted(Z.RoomMessageEncrypted,{},"",""),this.emit(qe.ToDeviceEvent,T),this.setSyncState(ii.Syncing),await this.ack(w)},this.widgetApiReady=new Promise(w=>this.widgetApi.once("ready",w)),((o=n.sendEvent)!=null&&o.length||(a=n.receiveEvent)!=null&&a.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||n.receiveMessage===!0||Array.isArray(n.receiveMessage)&&n.receiveMessage.length||(c=n.sendState)!=null&&c.length||(l=n.receiveState)!=null&&l.length)&&e.requestCapabilityForRoomTimeline(r),(u=n.sendEvent)==null||u.forEach(w=>e.requestCapabilityToSendEvent(w)),(d=n.receiveEvent)==null||d.forEach(w=>e.requestCapabilityToReceiveEvent(w)),n.sendMessage===!0?e.requestCapabilityToSendMessage():Array.isArray(n.sendMessage)&&n.sendMessage.forEach(w=>e.requestCapabilityToSendMessage(w)),n.receiveMessage===!0?e.requestCapabilityToReceiveMessage():Array.isArray(n.receiveMessage)&&n.receiveMessage.forEach(w=>e.requestCapabilityToReceiveMessage(w)),(f=n.sendState)==null||f.forEach(({eventType:w,stateKey:T})=>e.requestCapabilityToSendState(w,T)),(p=n.receiveState)==null||p.forEach(({eventType:w,stateKey:T})=>e.requestCapabilityToReceiveState(w,T)),(m=n.sendToDevice)==null||m.forEach(w=>e.requestCapabilityToSendToDevice(w)),(v=n.receiveToDevice)==null||v.forEach(w=>e.requestCapabilityToReceiveToDevice(w)),n.sendDelayedEvents&&((S=n.sendEvent)!=null&&S.length||n.sendMessage===!0||Array.isArray(n.sendMessage)&&n.sendMessage.length||(_=n.sendState)!=null&&_.length)&&e.requestCapability(e0.MSC4157SendDelayedEvent),n.updateDelayedEvents&&e.requestCapability(e0.MSC4157UpdateDelayedEvent),n.turnServers&&e.requestCapability(e0.MSC3846TurnServers),e.on(`action:${Vi.SendEvent}`,this.onEvent),e.on(`action:${Vi.SendToDevice}`,this.onToDevice),e.start(),s&&e.sendContentLoaded()}async startClient(e={}){var r;this.lifecycle=new AbortController;const n=this.getUserId();n&&this.store.storeUser(new lu(n)),e.slidingSync?this.syncApi=new BJ(e.slidingSync,this,e,this.buildSyncApiOptions()):this.syncApi=new I1(this,e,this.buildSyncApiOptions()),this.room=this.syncApi.createRoom(this.roomId),this.store.storeRoom(this.room),await this.widgetApiReady,await Promise.all(((r=this.capabilities.receiveState)==null?void 0:r.map(async({eventType:i,stateKey:s})=>{const a=(await this.widgetApi.readStateEvents(i,void 0,s,[this.roomId])).map(c=>new oi(c));await this.syncApi.injectRoomEvents(this.room,[],a),a.forEach(c=>{this.emit(qe.Event,c),k.info(`Backfilled event ${c.getId()} ${c.getType()} ${c.getStateKey()}`)})}))??[]),e.clientWellKnownPollPeriod!==void 0&&(this.clientWellKnownIntervalID=setInterval(()=>{this.fetchClientWellKnown()},1e3*e.clientWellKnownPollPeriod),this.fetchClientWellKnown()),this.setSyncState(ii.Syncing),k.info("Finished backfilling events"),this.matrixRTC.start(),this.capabilities.turnServers&&this.watchTurnServers()}stopClient(){this.widgetApi.off(`action:${Vi.SendEvent}`,this.onEvent),this.widgetApi.off(`action:${Vi.SendToDevice}`,this.onToDevice),super.stopClient(),this.lifecycle.abort()}async joinRoom(e){if(e===this.roomId)return this.room;throw new Error(`Unknown room: ${e}`)}async encryptAndSendEvent(e,n,r){const i=n.event.redacts?{...n.getContent(),redacts:n.event.redacts}:n.getContent();if(r){const o=await this.widgetApi.sendRoomEvent(n.getType(),i,e.roomId,"delay"in r?r.delay:void 0,"parent_delay_id"in r?r.parent_delay_id:void 0);return this.validateSendDelayedEventResponse(o)}let s;try{s=await this.widgetApi.sendRoomEvent(n.getType(),i,e.roomId)}catch(o){throw this.updatePendingEventStatus(e,n,Ze.NOT_SENT),o}return e.updatePendingEvent(n,Ze.SENT,s.event_id),{event_id:s.event_id}}async sendStateEvent(e,n,r,i=""){const s=await this.widgetApi.sendStateEvent(n,i,r,e);if(s.event_id===void 0)throw new Error("'event_id' absent from response to an event request");return{event_id:s.event_id}}async _unstable_sendDelayedStateEvent(e,n,r,i,s=""){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");const o=await this.widgetApi.sendStateEvent(r,s,i,e,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0);return this.validateSendDelayedEventResponse(o)}validateSendDelayedEventResponse(e){if(e.delay_id===void 0)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}async _unstable_updateDelayedEvent(e,n){if(!await this.doesServerSupportUnstableFeature(Hc))throw Error("Server does not support the delayed events API");return await this.widgetApi.updateDelayedEvent(e,n)}async sendToDevice(e,n){return await this.widgetApi.sendToDevice(e,!1,xh(n)),{}}async getOpenIdToken(){const e=await this.widgetApi.requestOpenIDConnectToken();return{access_token:e.access_token,expires_in:e.expires_in,matrix_server_name:e.matrix_server_name,token_type:e.token_type}}async queueToDevice({eventType:e,batch:n}){const r=new fr(()=>new Map);for(const{userId:i,deviceId:s,payload:o}of n)r.getOrCreate(i).set(s,o);await this.widgetApi.sendToDevice(e,!1,xh(r))}async encryptAndSendToDevices(e,n){const r=new fr(()=>new Map);for(const{userId:i,deviceInfo:{deviceId:s}}of e)r.getOrCreate(i).set(s,n);await this.widgetApi.sendToDevice(n.type,!0,xh(r))}async checkTurnServers(){return this.turnServers.length>0}getSyncState(){return this.syncState}setSyncState(e){const n=this.syncState;this.syncState=e,this.emit(qe.Sync,e,n)}async ack(e){await this.widgetApi.transport.reply(e.detail,{})}async watchTurnServers(){const e=this.widgetApi.getTurnServers(),n=()=>{e.return(void 0)};this.lifecycle.signal.addEventListener("abort",n);try{for await(const r of e)this.turnServers=[{urls:r.uris,username:r.username,credential:r.password}],this.emit(qe.TurnServers,this.turnServers),k.log(`Received TURN server: ${r.uris}`)}catch(r){k.warn("Error watching TURN servers",r)}finally{this.lifecycle.signal.removeEventListener("abort",n)}}}class fke{constructor(){this.unthreadedReadReceipts=new Map,this.threadedReadReceipts=new fr(()=>new Map)}setUnthreaded(e,n){this.unthreadedReadReceipts.set(e,n)}setThreaded(e,n,r){this.threadedReadReceipts.getOrCreate(e).set(n,r)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(const e of this.threadedReadReceipts.values())for(const n of e.entries())yield n}consumeEphemeralEvents(e){e==null||e.forEach(n=>{n.type!==Z.Receipt||!n.content||Object.keys(n.content).forEach(r=>{Object.entries(n.content[r]).forEach(([i,s])=>{if(l4(i))for(const o of Object.keys(s)){const a=n.content[r][i][o],c={data:n.content[r][i][o],type:i,eventId:r};a.thread_id?this.setThreaded(a.thread_id,o,c):this.setUnthreaded(o,c)}})})})}buildAccumulatedReceiptEvent(e){const n={type:Z.Receipt,room_id:e,content:{}},r=new fr(()=>new fr(()=>new Map));for(const[i,s]of this.allUnthreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);for(const[i,s]of this.allThreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);return n.content=xh(r),r.size>0?n:null}}var tX=(t=>(t.Invite="invite",t.Leave="leave",t.Join="join",t.Knock="knock",t))(tX||{});function hke(t){return"_localTs"in t&&t._localTs!==void 0}class nX{constructor(e={}){this.opts=e,this.accountData={},this.inviteRooms={},this.knockRooms={},this.joinRooms={},this.nextBatch=null,this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e,n=!1){this.accumulateRooms(e,n),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(n=>{this.accountData[n.type]=n})}accumulateRooms(e,n=!1){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(r=>{this.accumulateRoom(r,"invite",e.rooms.invite[r],n)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(r=>{this.accumulateRoom(r,"join",e.rooms.join[r],n)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(r=>{this.accumulateRoom(r,"leave",e.rooms.leave[r],n)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(r=>{this.accumulateRoom(r,"knock",e.rooms.knock[r],n)}))}accumulateRoom(e,n,r,i=!1){switch(n){case"invite":this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,r);break;case"knock":this.accumulateKnockState(e,r);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case"leave":this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:k.error("Unknown cateogory: ",n)}}accumulateInviteState(e,n){if(!n.invite_state||!n.invite_state.events)return;if(!this.inviteRooms[e]){this.inviteRooms[e]={invite_state:n.invite_state};return}const r=this.inviteRooms[e];n.invite_state.events.forEach(i=>{let s=!1;for(let o=0;o<r.invite_state.events.length;o++){const a=r.invite_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.invite_state.events[o]=i,s=!0)}s||r.invite_state.events.push(i)})}accumulateKnockState(e,n){if(!n.knock_state||!n.knock_state.events)return;if(!this.knockRooms[e]){this.knockRooms[e]={knock_state:n.knock_state};return}const r=this.knockRooms[e];n.knock_state.events.forEach(i=>{let s=!1;for(let o=0;o<r.knock_state.events.length;o++){const a=r.knock_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.knock_state.events[o]=i,s=!0)}s||r.knock_state.events.push(i)})}accumulateJoinState(e,n,r=!1){var s,o,a,c,l;this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new fke});const i=this.joinRooms[e];if(n.account_data&&n.account_data.events&&n.account_data.events.forEach(u=>{i._accountData[u.type]=u}),n.unread_notifications&&(i._unreadNotifications=n.unread_notifications),i._unreadThreadNotifications=n[G0.stable]??n[G0.unstable]??void 0,n.summary){const u="m.heroes",d="m.invited_member_count",f="m.joined_member_count",p=i._summary,m=n.summary;p[u]=m[u]??p[u],p[f]=m[f]??p[f],p[d]=m[d]??p[d]}if(i._receipts.consumeEphemeralEvents((s=n.ephemeral)==null?void 0:s.events),n.timeline&&n.timeline.limited&&(i._timeline=[]),(a=(o=n.state)==null?void 0:o.events)==null||a.forEach(u=>{k3(i._currentState,u)}),(l=(c=n.timeline)==null?void 0:c.events)==null||l.forEach((u,d)=>{var p;k3(i._currentState,u);let f;if(r)f=u;else{f=Object.assign({},u),f.unsigned!==void 0&&(f.unsigned=Object.assign({},f.unsigned));const m=(p=u.unsigned)==null?void 0:p.age;m!==void 0&&(f._localTs=Date.now()-m)}i._timeline.push({event:f,token:d===0?n.timeline.prev_batch??null:null})}),i._timeline.length>this.opts.maxTimelineEntries){const u=i._timeline.length-this.opts.maxTimelineEntries;for(let d=u;d<i._timeline.length;d++)if(i._timeline[d].token){i._timeline=i._timeline.slice(d,i._timeline.length);break}}}getJSON(e=!1){const n={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(i=>{n.invite[i]=this.inviteRooms[i]}),Object.keys(this.knockRooms).forEach(i=>{n.knock[i]=this.knockRooms[i]}),Object.keys(this.joinRooms).forEach(i=>{const s=this.joinRooms[i],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:s._unreadNotifications,unread_thread_notifications:s._unreadThreadNotifications,summary:s._summary};Object.keys(s._accountData).forEach(l=>{o.account_data.events.push(s._accountData[l])});const a=s._receipts.buildAccumulatedReceiptEvent(i);a&&o.ephemeral.events.push(a),s._timeline.forEach(l=>{if(!o.timeline.prev_batch){if(!l.token)return;o.timeline.prev_batch=l.token}let u;!e&&hke(l.event)?(u=Object.assign({},l.event),u.unsigned!==void 0&&(u.unsigned=Object.assign({},u.unsigned)),delete u._localTs,u.unsigned=u.unsigned||{},u.unsigned.age=Date.now()-l.event._localTs):u=l.event,o.timeline.events.push(u)});const c=Object.create(null);for(let l=o.timeline.events.length-1;l>=0;l--){const u=o.timeline.events[l];if(u.state_key===null||u.state_key===void 0)continue;const d=I2(u);d.unsigned&&(d.unsigned.prev_content&&(d.content=d.unsigned.prev_content),d.unsigned.prev_sender&&(d.sender=d.unsigned.prev_sender)),k3(c,d)}Object.keys(s._currentState).forEach(l=>{Object.keys(s._currentState[l]).forEach(u=>{let d=s._currentState[l][u];c[l]&&c[l][u]&&(d=c[l][u]),o.state.events.push(d)})}),n.join[i]=o});const r=[];return Object.keys(this.accountData).forEach(i=>{r.push(this.accountData[i])}),{nextBatch:this.nextBatch,roomsData:n,accountData:r}}getNextBatchToken(){return this.nextBatch}}function k3(t,e){e.state_key===null||e.state_key===void 0||!e.type||(t[e.type]||(t[e.type]=Object.create(null)),t[e.type][e.state_key]=e)}class P1 extends Error{}P1.prototype.name="InvalidTokenError";function pke(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function gke(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return pke(e)}catch{return atob(e)}}function rX(t,e){if(typeof t!="string")throw new P1("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new P1(`Invalid token specified: missing part #${n+1}`);let i;try{i=gke(r)}catch(s){throw new P1(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new P1(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var mke={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},Lc,Dc,n_=(t=>(t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t))(n_||{});(t=>{function e(){Lc=3,Dc=mke}t.reset=e;function n(i){if(!(0<=i&&i<=4))throw new Error("Invalid log level");Lc=i}t.setLevel=n;function r(i){Dc=i}t.setLogger=r})(n_||(n_={}));var Tr=class xc{constructor(e){this._name=e}debug(...e){Lc>=4&&Dc.debug(xc._format(this._name,this._method),...e)}info(...e){Lc>=3&&Dc.info(xc._format(this._name,this._method),...e)}warn(...e){Lc>=2&&Dc.warn(xc._format(this._name,this._method),...e)}error(...e){Lc>=1&&Dc.error(xc._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const n=Object.create(this);return n._method=e,n.debug("begin"),n}static createStatic(e,n){const r=new xc(`${e}.${n}`);return r.debug("begin"),r}static _format(e,n){const r=`[${e}]`;return n?`${r} ${n}:`:r}static debug(e,...n){Lc>=4&&Dc.debug(xc._format(e),...n)}static info(e,...n){Lc>=3&&Dc.info(xc._format(e),...n)}static warn(e,...n){Lc>=2&&Dc.warn(xc._format(e),...n)}static error(e,...n){Lc>=1&&Dc.error(xc._format(e),...n)}};n_.reset();var vke="10000000-1000-4000-8000-100000000000",aB=t=>btoa([...new Uint8Array(t)].map(e=>String.fromCharCode(e)).join("")),vm=class O1{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return vke.replace(/[018]/g,n=>(+n^O1._randomWord()&15>>+n/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return O1.generateUUIDv4()+O1.generateUUIDv4()+O1.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return aB(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(n){throw Tr.error("CryptoUtils.generateCodeChallenge",n),n}}static generateBasicAuth(e,n){const i=new TextEncoder().encode([e,n].join(":"));return aB(i)}},yke=class{constructor(e){this._name=e,this._logger=new Tr(`Event('${this._name}')`),this._callbacks=[]}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const n=this._callbacks.lastIndexOf(e);n>=0&&this._callbacks.splice(n,1)}async raise(...e){this._logger.debug("raise:",...e);for(const n of this._callbacks)await n(...e)}},gM=class{static decode(t){try{return rX(t)}catch(e){throw Tr.error("JwtUtils.decode",e),e}}},TC=class XE extends yke{constructor(){super(...arguments),this._logger=new Tr(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-XE.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=XE.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const n=this._logger.create("init");e=Math.max(Math.floor(e),1);const r=XE.getEpochTime()+e;if(this.expiration===r&&this._timerHandle){n.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),n.debug("using duration",e),this._expiration=r;const i=Math.min(e,5);this._timerHandle=setInterval(this._callback,i*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},cB=class{static readParams(t,e="query"){if(!t)throw new TypeError("Invalid URL");const r=new URL(t,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(r.slice(1))}},mM=";",r_=class extends Error{constructor(t,e){var n,r,i;if(super(t.error_description||t.error||""),this.form=e,this.name="ErrorResponse",!t.error)throw Tr.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=t.error,this.error_description=(n=t.error_description)!=null?n:null,this.error_uri=(r=t.error_uri)!=null?r:null,this.state=t.userState,this.session_state=(i=t.session_state)!=null?i:null,this.url_state=t.url_state}},_ke=class extends Error{constructor(t){super(t),this.name="ErrorTimeout"}},bke=class{constructor(){this._logger=new Tr("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(t){return this._logger.create(`getItem('${t}')`),this._data[t]}setItem(t,e){this._logger.create(`setItem('${t}')`),this._data[t]=e}removeItem(t){this._logger.create(`removeItem('${t}')`),delete this._data[t]}get length(){return Object.getOwnPropertyNames(this._data).length}key(t){return Object.getOwnPropertyNames(this._data)[t]}},U4=class{constructor(t=[],e=null,n={}){this._jwtHandler=e,this._extraHeaders=n,this._logger=new Tr("JsonService"),this._contentTypes=[],this._contentTypes.push(...t,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(t,e={}){const{timeoutInSeconds:n,...r}=e;if(!n)return await fetch(t,r);const i=new AbortController,s=setTimeout(()=>i.abort(),n*1e3);try{return await fetch(t,{...e,signal:i.signal})}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new _ke("Network timed out"):o}finally{clearTimeout(s)}}async getJson(t,{token:e,credentials:n}={}){const r=this._logger.create("getJson"),i={Accept:this._contentTypes.join(", ")};e&&(r.debug("token passed, setting Authorization header"),i.Authorization="Bearer "+e),this.appendExtraHeaders(i);let s;try{r.debug("url:",t),s=await this.fetchWithTimeout(t,{method:"GET",headers:i,credentials:n})}catch(c){throw r.error("Network Error"),c}r.debug("HTTP response received, status",s.status);const o=s.headers.get("Content-Type");if(o&&!this._contentTypes.find(c=>o.startsWith(c))&&r.throw(new Error(`Invalid response Content-Type: ${o??"undefined"}, from URL: ${t}`)),s.ok&&this._jwtHandler&&(o!=null&&o.startsWith("application/jwt")))return await this._jwtHandler(await s.text());let a;try{a=await s.json()}catch(c){throw r.error("Error parsing JSON response",c),s.ok?c:new Error(`${s.statusText} (${s.status})`)}if(!s.ok)throw r.error("Error from server:",a),a.error?new r_(a):new Error(`${s.statusText} (${s.status}): ${JSON.stringify(a)}`);return a}async postForm(t,{body:e,basicAuth:n,timeoutInSeconds:r,initCredentials:i}){const s=this._logger.create("postForm"),o={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded"};n!==void 0&&(o.Authorization="Basic "+n),this.appendExtraHeaders(o);let a;try{s.debug("url:",t),a=await this.fetchWithTimeout(t,{method:"POST",headers:o,body:e,timeoutInSeconds:r,credentials:i})}catch(d){throw s.error("Network error"),d}s.debug("HTTP response received, status",a.status);const c=a.headers.get("Content-Type");if(c&&!this._contentTypes.find(d=>c.startsWith(d)))throw new Error(`Invalid response Content-Type: ${c??"undefined"}, from URL: ${t}`);const l=await a.text();let u={};if(l)try{u=JSON.parse(l)}catch(d){throw s.error("Error parsing JSON response",d),a.ok?d:new Error(`${a.statusText} (${a.status})`)}if(!a.ok)throw s.error("Error from server:",u),u.error?new r_(u,e):new Error(`${a.statusText} (${a.status}): ${JSON.stringify(u)}`);return u}appendExtraHeaders(t){const e=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];n.length!==0&&n.forEach(i=>{if(r.includes(i.toLocaleLowerCase())){e.warn("Protected header could not be overridden",i,r);return}const s=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];s&&s!==""&&(t[i]=s)})}},iX=class{constructor(t){this._settings=t,this._logger=new Tr("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new U4(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const t=this._logger.create("getMetadata");if(this._metadata)return t.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw t.throw(new Error("No authority or metadataUrl configured on settings")),null;t.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials});return t.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,e),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(t=!0){return this._getMetadataProperty("token_endpoint",t)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(t=!0){return this._getMetadataProperty("revocation_endpoint",t)}getKeysEndpoint(t=!0){return this._getMetadataProperty("jwks_uri",t)}async _getMetadataProperty(t,e=!1){const n=this._logger.create(`_getMetadataProperty('${t}')`),r=await this.getMetadata();if(n.debug("resolved"),r[t]===void 0){if(e===!0){n.warn("Metadata does not contain optional property");return}n.throw(new Error("Metadata does not contain property "+t))}return r[t]}async getSigningKeys(){const t=this._logger.create("getSigningKeys");if(this._signingKeys)return t.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);t.debug("got jwks_uri",e);const n=await this._jsonService.getJson(e);if(t.debug("got key set",n),!Array.isArray(n.keys))throw t.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},z2=class{constructor({prefix:t="oidc.",store:e=localStorage}={}){this._logger=new Tr("WebStorageStateStore"),this._store=e,this._prefix=t}async set(t,e){this._logger.create(`set('${t}')`),t=this._prefix+t,await this._store.setItem(t,e)}async get(t){return this._logger.create(`get('${t}')`),t=this._prefix+t,await this._store.getItem(t)}async remove(t){this._logger.create(`remove('${t}')`),t=this._prefix+t;const e=await this._store.getItem(t);return await this._store.removeItem(t),e}async getAllKeys(){this._logger.create("getAllKeys");const t=await this._store.length,e=[];for(let n=0;n<t;n++){const r=await this._store.key(n);r&&r.indexOf(this._prefix)===0&&e.push(r.substr(this._prefix.length))}return e}},Ske="code",wke="openid",Eke="client_secret_post",Tke=60*15,vM=class{constructor({authority:t,metadataUrl:e,metadata:n,signingKeys:r,metadataSeed:i,client_id:s,client_secret:o,response_type:a=Ske,scope:c=wke,redirect_uri:l,post_logout_redirect_uri:u,client_authentication:d=Eke,prompt:f,display:p,max_age:m,ui_locales:v,acr_values:S,resource:_,response_mode:w,filterProtocolClaims:T=!0,loadUserInfo:C=!1,staleStateAgeInSeconds:I=Tke,mergeClaimsStrategy:R={array:"replace"},disablePKCE:O=!1,stateStore:A,revokeTokenAdditionalContentTypes:U,fetchRequestCredentials:N,refreshTokenAllowedScope:L,extraQueryParams:j={},extraTokenParams:X={},extraHeaders:G={}}){if(this.authority=t,e?this.metadataUrl=e:(this.metadataUrl=t,t&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=l,this.post_logout_redirect_uri=u,this.client_authentication=d,this.prompt=f,this.display=p,this.max_age=m,this.ui_locales=v,this.acr_values=S,this.resource=_,this.response_mode=w,this.filterProtocolClaims=T??!0,this.loadUserInfo=!!C,this.staleStateAgeInSeconds=I,this.mergeClaimsStrategy=R,this.disablePKCE=!!O,this.revokeTokenAdditionalContentTypes=U,this.fetchRequestCredentials=N||"same-origin",A)this.stateStore=A;else{const F=typeof window<"u"?window.localStorage:new bke;this.stateStore=new z2({store:F})}this.refreshTokenAllowedScope=L,this.extraQueryParams=j,this.extraTokenParams=X,this.extraHeaders=G}},Cke=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new Tr("UserInfoService"),this._getClaimsFromJwt=async n=>{const r=this._logger.create("_getClaimsFromJwt");try{const i=gM.decode(n);return r.debug("JWT decoding successful"),i}catch(i){throw r.error("Error parsing JWT response"),i}},this._jsonService=new U4(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(t){const e=this._logger.create("getClaims");t||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:t,credentials:this._settings.fetchRequestCredentials});return e.debug("got claims",r),r}},sX=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new Tr("TokenClient"),this._jsonService=new U4(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:t="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,...i}){const s=this._logger.create("exchangeCode");n||s.throw(new Error("A client_id is required")),e||s.throw(new Error("A redirect_uri is required")),i.code||s.throw(new Error("A code is required"));const o=new URLSearchParams({grant_type:t,redirect_uri:e});for(const[u,d]of Object.entries(i))d!=null&&o.set(u,d);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw s.throw(new Error("A client_secret is required")),null;a=vm.generateBasicAuth(n,r);break;case"client_secret_post":o.append("client_id",n),r&&o.append("client_secret",r);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeCredentials({grant_type:t="password",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const s=this._logger.create("exchangeCredentials");e||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:t,scope:r});for(const[u,d]of Object.entries(i))d!=null&&o.set(u,d);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=vm.generateBasicAuth(e,n);break;case"client_secret_post":o.append("client_id",e),n&&o.append("client_secret",n);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeRefreshToken({grant_type:t="refresh_token",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,...i}){const s=this._logger.create("exchangeRefreshToken");e||s.throw(new Error("A client_id is required")),i.refresh_token||s.throw(new Error("A refresh_token is required"));const o=new URLSearchParams({grant_type:t});for(const[u,d]of Object.entries(i))Array.isArray(d)?d.forEach(f=>o.append(u,f)):d!=null&&o.set(u,d);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=vm.generateBasicAuth(e,n);break;case"client_secret_post":o.append("client_id",e),n&&o.append("client_secret",n);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async revoke(t){var e;const n=this._logger.create("revoke");t.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${(e=t.token_type_hint)!=null?e:"default token type"}`);const i=new URLSearchParams;for(const[s,o]of Object.entries(t))o!=null&&i.set(s,o);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i}),n.debug("got response")}},kke=class{constructor(t,e,n){this._settings=t,this._metadataService=e,this._claimsService=n,this._logger=new Tr("ResponseValidator"),this._userInfoService=new Cke(this._settings,this._metadataService),this._tokenClient=new sX(this._settings,this._metadataService)}async validateSigninResponse(t,e){const n=this._logger.create("validateSigninResponse");this._processSigninState(t,e),n.debug("state processed"),await this._processCode(t,e),n.debug("code processed"),t.isOpenId&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),await this._processClaims(t,e==null?void 0:e.skipUserInfo,t.isOpenId),n.debug("claims processed")}async validateCredentialsResponse(t,e){const n=this._logger.create("validateCredentialsResponse");t.isOpenId&&t.id_token&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),await this._processClaims(t,e,t.isOpenId),n.debug("claims processed")}async validateRefreshResponse(t,e){var n,r;const i=this._logger.create("validateRefreshResponse");t.userState=e.data,(n=t.session_state)!=null||(t.session_state=e.session_state),(r=t.scope)!=null||(t.scope=e.scope),t.isOpenId&&t.id_token&&(this._validateIdTokenAttributes(t,e.id_token),i.debug("ID Token validated")),t.id_token||(t.id_token=e.id_token,t.profile=e.profile);const s=t.isOpenId&&!!t.id_token;await this._processClaims(t,!1,s),i.debug("claims processed")}validateSignoutResponse(t,e){const n=this._logger.create("validateSignoutResponse");if(e.id!==t.state&&n.throw(new Error("State does not match")),n.debug("state validated"),t.userState=e.data,t.error)throw n.warn("Response was error",t.error),new r_(t)}_processSigninState(t,e){var n;const r=this._logger.create("_processSigninState");if(e.id!==t.state&&r.throw(new Error("State does not match")),e.client_id||r.throw(new Error("No client_id on state")),e.authority||r.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),t.userState=e.data,t.url_state=e.url_state,(n=t.scope)!=null||(t.scope=e.scope),t.error)throw r.warn("Response was error",t.error),new r_(t);e.code_verifier&&!t.code&&r.throw(new Error("Expected code in response"))}async _processClaims(t,e=!1,n=!0){const r=this._logger.create("_processClaims");if(t.profile=this._claimsService.filterProtocolClaims(t.profile),e||!this._settings.loadUserInfo||!t.access_token){r.debug("not loading user info");return}r.debug("loading user info");const i=await this._userInfoService.getClaims(t.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==t.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),t.profile=this._claimsService.mergeClaims(t.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",t.profile)}async _processCode(t,e){const n=this._logger.create("_processCode");if(t.code){n.debug("Validating code");const r=await this._tokenClient.exchangeCode({client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,...e.extraTokenParams});Object.assign(t,r)}else n.debug("No code to process")}_validateIdTokenAttributes(t,e){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=gM.decode((n=t.id_token)!=null?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),e){const s=gM.decode(e);i.sub!==s.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}t.profile=i}},CC=class yM{constructor(e){this.id=e.id||vm.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=TC.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new Tr("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return Tr.createStatic("State","fromStorageString"),Promise.resolve(new yM(JSON.parse(e)))}static async clearStaleState(e,n){const r=Tr.createStatic("State","clearStaleState"),i=TC.getEpochTime()-n,s=await e.getAllKeys();r.debug("got keys",s);for(let o=0;o<s.length;o++){const a=s[o],c=await e.get(a);let l=!1;if(c)try{const u=await yM.fromStorageString(c);r.debug("got item from key:",a,u.created),u.created<=i&&(l=!0)}catch(u){r.error("Error parsing state for key:",a,u),l=!0}else r.debug("no item in storage for key:",a),l=!0;l&&(r.debug("removed item for key:",a),e.remove(a))}}},$4=class _M extends CC{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const n=e.code_verifier===!0?vm.generateCodeVerifier():e.code_verifier||void 0,r=n?await vm.generateCodeChallenge(n):void 0;return new _M({...e,code_verifier:n,code_challenge:r})}toStorageString(){return new Tr("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){Tr.createStatic("SigninState","fromStorageString");const n=JSON.parse(e);return _M.create(n)}},oX=class aX{constructor(e){this.url=e.url,this.state=e.state}static async create({url:e,authority:n,client_id:r,redirect_uri:i,response_type:s,scope:o,state_data:a,response_mode:c,request_type:l,client_secret:u,nonce:d,url_state:f,resource:p,skipUserInfo:m,extraQueryParams:v,extraTokenParams:S,disablePKCE:_,...w}){if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!s)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!o)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const T=await $4.create({data:a,request_type:l,url_state:f,code_verifier:!_,client_id:r,authority:n,redirect_uri:i,response_mode:c,client_secret:u,scope:o,extraTokenParams:S,skipUserInfo:m}),C=new URL(e);C.searchParams.append("client_id",r),C.searchParams.append("redirect_uri",i),C.searchParams.append("response_type",s),C.searchParams.append("scope",o),d&&C.searchParams.append("nonce",d);let I=T.id;f&&(I=`${I}${mM}${f}`),C.searchParams.append("state",I),T.code_challenge&&(C.searchParams.append("code_challenge",T.code_challenge),C.searchParams.append("code_challenge_method","S256")),p&&(Array.isArray(p)?p:[p]).forEach(O=>C.searchParams.append("resource",O));for(const[R,O]of Object.entries({response_mode:c,...w,...v}))O!=null&&C.searchParams.append(R,O.toString());return new aX({url:C.href,state:T})}};oX._logger=new Tr("SigninRequest");var Rke=oX,Ike="openid",ZE=class{constructor(t){if(this.access_token="",this.token_type="",this.profile={},this.state=t.get("state"),this.session_state=t.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(mM);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(mM))}this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri"),this.code=t.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-TC.getEpochTime()}set expires_in(t){typeof t=="string"&&(t=Number(t)),t!==void 0&&t>=0&&(this.expires_at=Math.floor(t)+TC.getEpochTime())}get isOpenId(){var t;return((t=this.scope)==null?void 0:t.split(" ").includes(Ike))||!!this.id_token}},xke=class{constructor({url:t,state_data:e,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:s,client_id:o}){if(this._logger=new Tr("SignoutRequest"),!t)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(t);n&&a.searchParams.append("id_token_hint",n),o&&a.searchParams.append("client_id",o),r&&(a.searchParams.append("post_logout_redirect_uri",r),e&&(this.state=new CC({data:e,request_type:s}),a.searchParams.append("state",this.state.id)));for(const[c,l]of Object.entries({...i}))l!=null&&a.searchParams.append(c,l.toString());this.url=a.href}},Pke=class{constructor(t){this.state=t.get("state"),this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri")}},Oke=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],Mke=["sub","iss","aud","exp","iat"],Ake=class{constructor(t){this._settings=t,this._logger=new Tr("ClaimsService")}filterProtocolClaims(t){const e={...t};if(this._settings.filterProtocolClaims){let n;Array.isArray(this._settings.filterProtocolClaims)?n=this._settings.filterProtocolClaims:n=Oke;for(const r of n)Mke.includes(r)||delete e[r]}return e}mergeClaims(t,e){const n={...t};for(const[r,i]of Object.entries(e))if(n[r]!==i)if(Array.isArray(n[r])||Array.isArray(i))if(this._settings.mergeClaimsStrategy.array=="replace")n[r]=i;else{const s=Array.isArray(n[r])?n[r]:[n[r]];for(const o of Array.isArray(i)?i:[i])s.includes(o)||s.push(o);n[r]=s}else typeof n[r]=="object"&&typeof i=="object"?n[r]=this.mergeClaims(n[r],i):n[r]=i;return n}},F4=class{constructor(t,e){this._logger=new Tr("OidcClient"),this.settings=t instanceof vM?t:new vM(t),this.metadataService=e??new iX(this.settings),this._claimsService=new Ake(this.settings),this._validator=new kke(this.settings,this.metadataService,this._claimsService),this._tokenClient=new sX(this.settings,this.metadataService)}async createSigninRequest({state:t,request:e,request_uri:n,request_type:r,id_token_hint:i,login_hint:s,skipUserInfo:o,nonce:a,url_state:c,response_type:l=this.settings.response_type,scope:u=this.settings.scope,redirect_uri:d=this.settings.redirect_uri,prompt:f=this.settings.prompt,display:p=this.settings.display,max_age:m=this.settings.max_age,ui_locales:v=this.settings.ui_locales,acr_values:S=this.settings.acr_values,resource:_=this.settings.resource,response_mode:w=this.settings.response_mode,extraQueryParams:T=this.settings.extraQueryParams,extraTokenParams:C=this.settings.extraTokenParams}){const I=this._logger.create("createSigninRequest");if(l!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const R=await this.metadataService.getAuthorizationEndpoint();I.debug("Received authorization endpoint",R);const O=await Rke.create({url:R,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:d,response_type:l,scope:u,state_data:t,url_state:c,prompt:f,display:p,max_age:m,ui_locales:v,id_token_hint:i,login_hint:s,acr_values:S,resource:_,request:e,request_uri:n,extraQueryParams:T,extraTokenParams:C,request_type:r,response_mode:w,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE});await this.clearStaleState();const A=O.state;return await this.settings.stateStore.set(A.id,A.toStorageString()),O}async readSigninResponseState(t,e=!1){const n=this._logger.create("readSigninResponseState"),r=new ZE(cB.readParams(t,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await $4.fromStorageString(i),response:r}}async processSigninResponse(t){const e=this._logger.create("processSigninResponse"),{state:n,response:r}=await this.readSigninResponseState(t,!0);return e.debug("received state from storage; validating response"),await this._validator.validateSigninResponse(r,n),r}async processResourceOwnerPasswordCredentials({username:t,password:e,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:t,password:e,...r}),s=new ZE(new URLSearchParams);return Object.assign(s,i),await this._validator.validateCredentialsResponse(s,n),s}async useRefreshToken({state:t,redirect_uri:e,resource:n,timeoutInSeconds:r,extraTokenParams:i}){var s;const o=this._logger.create("useRefreshToken");let a;if(this.settings.refreshTokenAllowedScope===void 0)a=t.scope;else{const u=this.settings.refreshTokenAllowedScope.split(" ");a=(((s=t.scope)==null?void 0:s.split(" "))||[]).filter(f=>u.includes(f)).join(" ")}const c=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:a,redirect_uri:e,resource:n,timeoutInSeconds:r,...i}),l=new ZE(new URLSearchParams);return Object.assign(l,c),o.debug("validating response",l),await this._validator.validateRefreshResponse(l,{...t,scope:a}),l}async createSignoutRequest({state:t,id_token_hint:e,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:s=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",a),!n&&i&&!e&&(n=this.settings.client_id);const c=new xke({url:a,id_token_hint:e,client_id:n,post_logout_redirect_uri:i,state_data:t,extraQueryParams:s,request_type:r});await this.clearStaleState();const l=c.state;return l&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(l.id,l.toStorageString())),c}async readSignoutResponseState(t,e=!1){const n=this._logger.create("readSignoutResponseState"),r=new Pke(cB.readParams(t,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new r_(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await CC.fromStorageString(i),response:r}}async processSignoutResponse(t){const e=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(t,!0);return n?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):e.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),CC.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(t,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:t,token_type_hint:e})}},Ti=(t=>(t.NotSupported="OIDC authentication not supported",t.Misconfigured="OIDC is misconfigured",t.General="Something went wrong with OIDC discovery",t.OpSupport="Configured OIDC OP does not support required functions",t.DynamicRegistrationNotSupported="Dynamic registration not supported",t.DynamicRegistrationFailed="Dynamic registration failed",t.DynamicRegistrationInvalid="Dynamic registration invalid response",t.CodeExchangeFailed="Failed to exchange code for token",t.InvalidBearerTokenResponse="Invalid bearer token response",t.InvalidIdToken="Invalid ID token",t.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",t))(Ti||{});const B4=t=>!!t&&typeof t=="object"&&!Array.isArray(t),Bd=(t,e)=>!t[e]||!t0(t,e)?(k.error(`Missing or invalid property: ${e}`),!1):!0,t0=(t,e)=>t[e]&&typeof t[e]!="string"?(k.error(`Invalid property: ${e}`),!1):!0,Lke=(t,e)=>t[e]&&(!Array.isArray(t[e])||!t[e].every(n=>typeof n=="string"))?(k.error(`Invalid property: ${e}`),!1):!0,R3=(t,e,n)=>{const r=t[e];return!r||!Array.isArray(r)||!r.includes(n)?(k.error(`Invalid property: ${e}. ${n} is required.`),!1):!0},j4=t=>{if(!B4(t))throw k.error("Issuer configuration not found or malformed"),new Error(Ti.OpSupport);if(![Bd(t,"authorization_endpoint"),Bd(t,"token_endpoint"),Bd(t,"revocation_endpoint"),t0(t,"registration_endpoint"),t0(t,"account_management_uri"),t0(t,"device_authorization_endpoint"),Lke(t,"account_management_actions_supported"),R3(t,"response_types_supported","code"),R3(t,"grant_types_supported","authorization_code"),R3(t,"code_challenge_methods_supported","S256")].some(n=>!n))return{authorizationEndpoint:t.authorization_endpoint,tokenEndpoint:t.token_endpoint,registrationEndpoint:t.registration_endpoint,accountManagementEndpoint:t.account_management_uri,accountManagementActionsSupported:t.account_management_actions_supported};throw k.error("Issuer configuration not valid"),new Error(Ti.OpSupport)};function cX(t){j4(t)}const lX=t=>{try{return rX(t)}catch(e){throw k.error("Could not decode id_token",e),e}},uX=(t,e,n,r)=>{try{if(!t)throw new Error("No ID token");const i=lX(t);if(i.iss!==e)throw new Error("Invalid issuer");if(i.aud!==n)throw new Error("Invalid audience");if(r!==void 0&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>i.exp*1e3)throw new Error("Invalid expiry")}catch(i){throw k.error("Invalid ID token",i),new Error(Ti.InvalidIdToken)}};function dX(t){if(!B4(t))throw k.error("Stored user state not found"),new Error(Ti.MissingOrInvalidStoredState);if([Bd(t,"homeserverUrl"),Bd(t,"nonce"),t0(t,"identityServerUrl")].some(n=>!n))throw new Error(Ti.MissingOrInvalidStoredState)}const Dke=t=>B4(t)&&Bd(t,"token_type")&&t.token_type.toLowerCase()==="bearer"&&Bd(t,"access_token")&&Bd(t,"refresh_token")&&(!("expires_in"in t)||typeof t.expires_in=="number");function fX(t){if(!Dke(t))throw new Error(Ti.InvalidBearerTokenResponse)}const W2=t=>`openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:${t??Zi(10)}`,Nke=async t=>{if(!globalThis.crypto.subtle)return k.warn("A secure context is required to generate code challenge. Using plain text code challenge"),t;const e=await VJ(t);return F2(e)},Uke=({redirectUri:t})=>({scope:W2(),redirectUri:t,state:Zi(8),nonce:Zi(8),codeVerifier:Zi(64)}),$ke=async(t,e,{scope:n,redirectUri:r,state:i,nonce:s,codeVerifier:o})=>{const a=new URL(t);return a.searchParams.append("response_mode","query"),a.searchParams.append("response_type","code"),a.searchParams.append("redirect_uri",r),a.searchParams.append("client_id",e),a.searchParams.append("state",i),a.searchParams.append("scope",n),a.searchParams.append("nonce",s),a.searchParams.append("code_challenge_method","S256"),a.searchParams.append("code_challenge",await Nke(o)),a.toString()},Fke=async({metadata:t,redirectUri:e,clientId:n,homeserverUrl:r,identityServerUrl:i,nonce:s,prompt:o,urlState:a})=>{const c=W2(),l=new F4({...t,client_id:n,redirect_uri:e,authority:t.issuer,response_mode:"query",response_type:"code",scope:c,stateStore:new z2({prefix:"mx_oidc_",store:window.sessionStorage})}),u={homeserverUrl:r,nonce:s,identityServerUrl:i};return(await l.createSigninRequest({state:u,nonce:s,prompt:o,url_state:a})).url},Bke=t=>({id_token:t.id_token,scope:t.scope,expires_at:t.expires_at,refresh_token:t.refresh_token,access_token:t.access_token,token_type:"Bearer"}),jke=async(t,e)=>{const n=new URL(window.location.origin);n.searchParams.append("code",t),n.searchParams.append("state",e),n_.setLogger(k);try{const r=new ZE(n.searchParams),i=new z2({prefix:"mx_oidc_",store:window.sessionStorage}),s=await i.get(r.state);if(!s)throw new Error(Ti.MissingOrInvalidStoredState);const o=await $4.fromStorageString(s),a=new F4({...o,stateStore:i}),c=await a.processSigninResponse(n.href),l=c.userState;dX(l),fX(c),uX(c.id_token,a.settings.authority,a.settings.client_id,l.nonce);const u=Bke(c);return{oidcClientSettings:{clientId:a.settings.client_id,issuer:a.settings.authority},tokenResponse:u,homeserverUrl:l.homeserverUrl,identityServerUrl:l.identityServerUrl,idTokenClaims:c.profile}}catch(r){k.error("Oidc login failed",r);const i=r.message;throw Object.values(Ti).includes(i)?r:new Error(Ti.CodeExchangeFailed)}},hX=async t=>{const e=new URL(".well-known/openid-configuration",t),r=await(await fetch(e,{method:oe.Get,signal:N2(5e3)})).json(),i=j4(r),s=new vM({authority:t,redirect_uri:"",client_id:""}),o=new iX(s),a=await o.getMetadata(),c=await o.getSigningKeys()??void 0;return cX(a),{...i,metadata:a,signingKeys:c}},Hke="urn:ietf:params:oauth:grant-type:device_code",Kke=async(t,e)=>{if(!t.registrationEndpoint)throw new Error(Ti.DynamicRegistrationNotSupported);const n=["authorization_code","refresh_token"];if(n.some(s=>!t.metadata.grant_types_supported.includes(s)))throw new Error(Ti.DynamicRegistrationNotSupported);const r={client_name:e.clientName,client_uri:e.clientUri,response_types:["code"],grant_types:n,redirect_uris:e.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:e.applicationType,logo_uri:e.logoUri,contacts:e.contacts,policy_uri:e.policyUri,tos_uri:e.tosUri},i={Accept:"application/json","Content-Type":"application/json"};try{const s=await fetch(t.registrationEndpoint,{method:oe.Post,headers:i,body:JSON.stringify(r)});if(s.status>=400)throw new Error(Ti.DynamicRegistrationFailed);const a=(await s.json()).client_id;if(!a||typeof a!="string")throw new Error(Ti.DynamicRegistrationInvalid);return a}catch(s){throw Object.values(Ti).includes(s.message)?s:(k.error("Dynamic registration request failed",s),new Error(Ti.DynamicRegistrationFailed))}};class Vke{constructor(e,n,r,i,s){this.idTokenClaims=s,this.oidcClientReady=this.initialiseOidcClient(e,n,i,r)}async initialiseOidcClient(e,n,r,i){try{const s=await hX(e),o=W2(r);this.oidcClient=new F4({...s.metadata,client_id:n,scope:o,redirect_uri:i,authority:s.metadata.issuer,stateStore:new z2({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(s){throw k.error("Failed to initialise OIDC client.",s),new Error("Failed to initialise OIDC client.")}}async doRefreshAccessToken(e){this.inflightRefreshRequest||(this.inflightRefreshRequest=this.getNewTokens(e));try{return await this.inflightRefreshRequest}finally{this.inflightRefreshRequest=void 0}}async persistTokens(e){}async getNewTokens(e){if(!this.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");const n={refresh_token:e,session_state:"test",data:void 0,profile:this.idTokenClaims},r=await this.oidcClient.useRefreshToken({state:n,timeoutInSeconds:300}),i={accessToken:r.access_token,refreshToken:r.refresh_token};return await this.persistTokens(i),i}}const lB=function(){},qke=10;class Gke{constructor(e,n,r={}){var i;this.client=e,this.timelineSet=n,this.eventCount=0,this.windowLimit=r.windowLimit||1e3,(i=n.room)==null||i.on(ct.Timeline,this.onTimelineEvent.bind(this))}load(e,n=20){const r=i=>{if(!i)throw new Error("No timeline given to initFields");let s;const o=i.getEvents();if(!e)s=o.length;else if(s=o.findIndex(l=>l.getId()===e),s<0)throw new Error("getEventTimeline result didn't include requested event");const a=Math.min(o.length,s+Math.ceil(n/2)),c=Math.max(0,a-n);this.start=new bM(i,c-i.getBaseIndex()),this.end=new bM(i,a-i.getBaseIndex()),this.eventCount=a-c};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){if(e==He.BACKWARDS)return this.start??null;if(e==He.FORWARDS)return this.end??null;throw new Error("Invalid direction '"+e+"'")}extend(e,n){const r=this.getTimelineIndex(e);if(!r)return!1;const i=e==He.BACKWARDS?r.retreat(n):r.advance(n);if(i){this.eventCount+=i,lB("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");const s=this.eventCount-this.windowLimit;return s>0&&this.unpaginate(s,e!=He.BACKWARDS),!0}return!1}onTimelineEvent(e,n,r,i){i&&this.onEventRemoved()}onEventRemoved(){const e=this.getEvents();e.length>0&&e[e.length-1]===void 0&&this.end&&this.end.index--}canPaginate(e){const n=this.getTimelineIndex(e);if(!n)return!1;if(e==He.BACKWARDS){if(n.index>n.minIndex())return!0}else if(n.index<n.maxIndex())return!0;const r=n.timeline.getNeighbouringTimeline(e),i=n.timeline.getPaginationToken(e);return!!r||!!i}async paginate(e,n,r=!0,i=qke){const s=this.getTimelineIndex(e);if(!s)return!1;if(s.pendingPaginate)return s.pendingPaginate;if(this.extend(e,n))return!0;if(!r||i===0||!s.timeline.getPaginationToken(e))return!1;const a=this.client.paginateEventTimeline(s.timeline,{backwards:e==He.BACKWARDS,limit:n}).finally(function(){s.pendingPaginate=void 0}).then(c=>c?this.paginate(e,n,!0,i-1):this.paginate(e,n,!1,0));return s.pendingPaginate=a,a}unpaginate(e,n){const r=n?this.start:this.end;if(!r)throw new Error(`Attempting to unpaginate startOfTimeline=${n} but don't have this direction`);if(e>this.eventCount||e<0)throw new Error(`Attemting to unpaginate ${e} events, but only have ${this.eventCount} in the timeline`);for(;e>0;){const i=n?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,lB("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){var r,i;if(!this.start)return[];const e=[];let n=this.start.timeline;for(;n;){const s=n.getEvents();let o=0,a=s.length;n===this.start.timeline&&(o=this.start.index+n.getBaseIndex()),n===((r=this.end)==null?void 0:r.timeline)&&(a=this.end.index+n.getBaseIndex());for(let c=o;c<a;c++)e.push(s[c]);if(n===((i=this.end)==null?void 0:i.timeline))break;n=n.getNeighbouringTimeline(He.FORWARDS)}return e}}class bM{constructor(e,n){this.timeline=e,this.index=n}minIndex(){return this.timeline.getBaseIndex()*-1}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;let n;if(e<0){if(n=Math.max(e,this.minIndex()-this.index),n<0)return this.index+=n,n}else if(n=Math.min(e,this.maxIndex()-this.index),n>0)return this.index+=n,n;const r=this.timeline.getNeighbouringTimeline(e<0?He.BACKWARDS:He.FORWARDS);return r?(this.timeline=r,e<0?this.index=this.maxIndex():this.index=this.minIndex(),this.advance(e)):0}retreat(e){return this.advance(e*-1)*-1}}const jy="m.login.email.identity",uB="m.login.msisdn";var pX=(t=>(t.Password="m.login.password",t.Recaptcha="m.login.recaptcha",t.Terms="m.login.terms",t.Email="m.login.email.identity",t.Msisdn="m.login.msisdn",t.Sso="m.login.sso",t.SsoUnstable="org.matrix.login.sso",t.Dummy="m.login.dummy",t.RegistrationToken="m.login.registration_token",t.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",t))(pX||{});class gX extends Error{constructor(e,n,r){super(e),this.required_stages=n,this.flows=r,this.name="NoAuthFlowFoundError"}}class H4{constructor(e){this.requestingEmailToken=!1,this.attemptAuthDeferred=null,this.chosenFlow=null,this.currentStage=null,this.emailAttempt=1,this.submitPromise=null,this.requestEmailToken=async()=>{if(this.requestingEmailToken)k.warn("Could not request email token: Already requesting");else{k.trace("Requesting email token. Attempt: "+this.emailAttempt),this.requestingEmailToken=!0;try{const n=await this.requestEmailTokenCallback(this.inputs.emailAddress,this.clientSecret,this.emailAttempt++,this.data.session);this.emailSid=n.sid,k.trace("Email token request succeeded")}finally{this.requestingEmailToken=!1}}},this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,e.supportedStages!==void 0&&(this.supportedStages=new Set(e.supportedStages))}async attemptAuth(){var n,r,i;this.attemptAuthDeferred=Ef();const e=this.attemptAuthDeferred.promise;if((r=(n=this.data)==null?void 0:n.flows)!=null&&r.length)this.startNextAuthStage();else{(i=this.busyChangedCallback)==null||i.call(this,!0);const s=this.data.session?{session:this.data.session}:null;this.doRequest(s).finally(()=>{var o;(o=this.busyChangedCallback)==null||o.call(this,!1)})}return e}async poll(){if(!this.data.session||!this.attemptAuthDeferred||this.submitPromise)return;let e={};if(this.currentStage==jy&&this.emailSid){const n={sid:this.emailSid,client_secret:this.clientSecret},r=this.matrixClient.getIdentityServerUrl();r&&(n.id_server=new URL(r).host),e={type:jy,threepid_creds:n}}this.submitAuthDict(e,!0)}getSessionId(){var e;return(e=this.data)==null?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var n,r;return(r=(n=this.data)==null?void 0:n.params)==null?void 0:r[e]}getChosenFlow(){return this.chosenFlow}async submitAuthDict(e,n=!1){var i,s,o;if(!this.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");for(n||(i=this.busyChangedCallback)==null||i.call(this,!0);this.submitPromise;)try{await this.submitPromise}catch{}let r;(s=this.data)!=null&&s.session?(r={session:this.data.session},Object.assign(r,e)):r=e;try{this.submitPromise=this.doRequest(r,n),await this.submitPromise}finally{this.submitPromise=null,n||(o=this.busyChangedCallback)==null||o.call(this,!1)}}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}async doRequest(e,n=!1){var r,i,s,o;try{const a=await this.requestCallback(e,n);this.attemptAuthDeferred.resolve(a),this.attemptAuthDeferred=null}catch(a){const c=a instanceof Ii?a:null,l=((r=c==null?void 0:c.data)==null?void 0:r.flows)??null,u=((i=this.data)==null?void 0:i.flows)||!!l;(!c||c.httpStatus!==401||!c.data||!u)&&(n?k.log("Background poll request failed doing UI auth: ignoring",a):(s=this.attemptAuthDeferred)==null||s.reject(a)),c&&!c.data&&(c.data={}),c&&!c.data.flows&&!c.data.completed&&!c.data.session&&(c.data.flows=this.data.flows,c.data.completed=this.data.completed,c.data.session=this.data.session),c&&(this.data=c.data);try{this.startNextAuthStage()}catch(d){this.attemptAuthDeferred.reject(d),this.attemptAuthDeferred=null;return}if(!this.emailSid&&((o=this.chosenFlow)!=null&&o.stages.includes("m.login.email.identity")))try{await this.requestEmailToken()}catch(d){this.attemptAuthDeferred.reject(d),this.attemptAuthDeferred=null}}}startNextAuthStage(){var n,r,i,s;const e=this.chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this.currentStage=e,e==="m.login.dummy"){this.submitAuthDict({type:"m.login.dummy"});return}if((n=this.data)!=null&&n.errcode||(r=this.data)!=null&&r.error){this.stateUpdatedCallback(e,{errcode:((i=this.data)==null?void 0:i.errcode)||"",error:((s=this.data)==null?void 0:s.error)||""});return}this.stateUpdatedCallback(e,e===jy?{emailSid:this.emailSid}:{})}chooseStage(){this.chosenFlow===null&&(this.chosenFlow=this.chooseFlow()),k.log("Active flow => %s",JSON.stringify(this.chosenFlow));const e=this.firstUncompletedStage(this.chosenFlow);return k.log("Next stage: %s",e),e}scoreFlow(e){let n=e.stages.length;return this.supportedStages!==void 0&&(n+=e.stages.filter(r=>!this.supportedStages.has(r)).length*10),n}chooseFlow(){var s;const e=((s=this.data)==null?void 0:s.flows)||[],n=!!this.inputs.emailAddress||!!this.emailSid,r=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;e.sort((o,a)=>this.scoreFlow(o)-this.scoreFlow(a));for(const o of e){let a=!1,c=!1;for(const l of o.stages)l===jy?a=!0:l==uB&&(c=!0);if(a==n&&c==r)return o}const i=[];throw n&&i.push(jy),r&&i.push(uB),new gX("No appropriate authentication flow found",i,e)}firstUncompletedStage(e){var r;const n=((r=this.data)==null?void 0:r.completed)||[];return e.stages.find(i=>!n.includes(i))}}const mX=[t=>{t.createObjectStore("users",{keyPath:["userId"]}),t.createObjectStore("accountData",{keyPath:["type"]}),t.createObjectStore("sync",{keyPath:["clobber"]})},t=>{t.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]}).createIndex("room","room_id")},t=>{t.createObjectStore("client_options",{keyPath:["clobber"]})},t=>{t.createObjectStore("to_device_queue",{autoIncrement:!0})}],zke=mX.length;function pw(t,e,n){const r=t.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{s(new Error("Query failed: "+r.error))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}function Xf(t){return new Promise((e,n)=>{t.oncomplete=function(r){e(r)},t.onerror=function(){n(t.error)}})}function vX(t){return new Promise((e,n)=>{t.onsuccess=function(r){e(r)},t.onerror=function(){n(t.error)}})}function Wke(t){return new Promise((e,n)=>{t.onsuccess=()=>e(t),t.onerror=r=>n(r)})}function I3(t){return vX(t).then(e=>t.result)}class dB{constructor(e,n="default"){this.indexedDB=e,this.disconnected=!0,this._isNewlyCreated=!1,this.pendingUserPresenceData=[],this.dbName="matrix-js-sdk:"+n,this.syncAccumulator=new nX}static exists(e,n){return n="matrix-js-sdk:"+(n||"default"),bJ(e,n)}connect(e){if(!this.disconnected)return k.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,k.log("LocalIndexedDBStoreBackend.connect: connecting...");const n=this.indexedDB.open(this.dbName,zke);return n.onupgradeneeded=r=>{const i=n.result,s=r.oldVersion;k.log(`LocalIndexedDBStoreBackend.connect: upgrading from ${s}`),s<1&&(this._isNewlyCreated=!0),mX.forEach((o,a)=>{s<=a&&o(i)})},n.onblocked=()=>{k.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},k.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),vX(n).then(async()=>{k.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=n.result,this.db.onversionchange=()=>{var r;(r=this.db)==null||r.close(),this.disconnected=!0,this.db=void 0},this.db.onclose=()=>{this.disconnected=!0,this.db=void 0,e==null||e()},await this.init()})}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(([e,n])=>{k.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:n.nextBatch,rooms:n.roomsData,account_data:{events:e}},!0)})}getOutOfBandMembers(e){return new Promise((n,r)=>{const o=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),a=IDBKeyRange.only(e),c=o.openCursor(a),l=[];let u=!1;c.onsuccess=()=>{const d=c.result;if(!d)return!l.length&&!u?n(null):n(l);const f=d.value;f.oob_written?u=!0:l.push(f),d.continue()},c.onerror=d=>{r(d)}}).then(n=>(k.log(`LL: got ${n==null?void 0:n.length} membershipEvents from storage for room ${e} ...`),n))}async setOutOfBandMembers(e,n){k.log(`LL: backend about to store ${n.length} members for ${e}`);const r=this.db.transaction(["oob_membership_events"],"readwrite"),i=r.objectStore("oob_membership_events");n.forEach(o=>{i.put(o)});const s={room_id:e,oob_written:!0,state_key:0};i.put(s),await Xf(r),k.log(`LL: backend done storing for ${e}!`)}async clearOutOfBandMembers(e){const i=this.db.transaction(["oob_membership_events"],"readonly").objectStore("oob_membership_events").index("room"),s=IDBKeyRange.only(e),o=I3(i.openKeyCursor(s,"next")).then(p=>(p==null?void 0:p.primaryKey)[1]),a=I3(i.openKeyCursor(s,"prev")).then(p=>(p==null?void 0:p.primaryKey)[1]),[c,l]=await Promise.all([o,a]),d=this.db.transaction(["oob_membership_events"],"readwrite").objectStore("oob_membership_events"),f=IDBKeyRange.bound([e,c],[e,l]);k.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,c],[e,l]),await Wke(d.delete(f))}clearDatabase(){return new Promise(e=>{var r;k.log(`Removing indexeddb instance: ${this.dbName}`),(r=this.db)==null||r.close();const n=this.indexedDB.deleteDatabase(this.dbName);n.onblocked=()=>{k.log(`can't yet delete indexeddb ${this.dbName} because it is open elsewhere`)},n.onerror=()=>{k.warn(`unable to delete js-sdk store indexeddb: ${n.error}`),e()},n.onsuccess=()=>{k.log(`Removed indexeddb instance: ${this.dbName}`),e()}})}getSavedSync(e=!0){const n=this.syncAccumulator.getJSON();return n.nextBatch?e?Promise.resolve(I2(n)):Promise.resolve(n):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}async syncToDatabase(e){return this.syncToDatabasePromise?(k.warn("Skipping syncToDatabase() as persist already in flight"),this.pendingUserPresenceData.push(...e),this.syncToDatabasePromise):(e.unshift(...this.pendingUserPresenceData),this.syncToDatabasePromise=this.doSyncToDatabase(e),this.syncToDatabasePromise)}async doSyncToDatabase(e){try{const n=this.syncAccumulator.getJSON(!0);await Promise.all([this.persistUserPresenceEvents(e),this.persistAccountData(n.accountData),this.persistSyncData(n.nextBatch,n.roomsData)])}finally{this.syncToDatabasePromise=void 0}}persistSyncData(e,n){return k.log("Persisting sync data up to",e),ih(()=>{const r=this.db.transaction(["sync"],"readwrite");return r.objectStore("sync").put({clobber:"-",nextBatch:e,roomsData:n}),Xf(r).then(()=>{k.log("Persisted sync data up to",e)})})}persistAccountData(e){return ih(()=>{const n=this.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData");for(const i of e)r.put(i);return Xf(n).then()})}persistUserPresenceEvents(e){return ih(()=>{const n=this.db.transaction(["users"],"readwrite"),r=n.objectStore("users");for(const i of e)r.put({userId:i[0],event:i[1]});return Xf(n).then()})}getUserPresenceEvents(){return ih(()=>{const n=this.db.transaction(["users"],"readonly").objectStore("users");return pw(n,void 0,r=>[r.value.userId,r.value.event])})}loadAccountData(){return k.log("LocalIndexedDBStoreBackend: loading account data..."),ih(()=>{const n=this.db.transaction(["accountData"],"readonly").objectStore("accountData");return pw(n,void 0,r=>r.value).then(r=>(k.log("LocalIndexedDBStoreBackend: loaded account data"),r))})}loadSyncData(){return k.log("LocalIndexedDBStoreBackend: loading sync data..."),ih(()=>{const n=this.db.transaction(["sync"],"readonly").objectStore("sync");return pw(n,void 0,r=>r.value).then(r=>(k.log("LocalIndexedDBStoreBackend: loaded sync data"),r.length>1&&k.warn("loadSyncData: More than 1 sync row found."),r.length>0?r[0]:{}))})}getClientOptions(){return Promise.resolve().then(()=>{const n=this.db.transaction(["client_options"],"readonly").objectStore("client_options");return pw(n,void 0,r=>{var i;return(i=r.value)==null?void 0:i.options}).then(r=>r[0])})}async storeClientOptions(e){const n=this.db.transaction(["client_options"],"readwrite");n.objectStore("client_options").put({clobber:"-",options:e}),await Xf(n)}async saveToDeviceBatches(e){const n=this.db.transaction(["to_device_queue"],"readwrite"),r=n.objectStore("to_device_queue");for(const i of e)r.add(i);await Xf(n)}async getOldestToDeviceBatch(){const n=this.db.transaction(["to_device_queue"],"readonly").objectStore("to_device_queue"),r=await I3(n.openCursor());if(!r)return null;const i=r.value;return{id:r.key,txnId:i.txnId,eventType:i.eventType,batch:i.batch}}async removeToDeviceBatch(e){const n=this.db.transaction(["to_device_queue"],"readwrite");n.objectStore("to_device_queue").delete(e),await Xf(n)}async destroy(){var e;(e=this.db)==null||e.close()}}class Yke{constructor(e,n){this.workerFactory=e,this.dbName=n,this.nextSeq=0,this.inFlight={},this.onWorkerMessage=r=>{var s;const i=r.data;if(i.command=="closed")(s=this.onClose)==null||s.call(this);else if(i.command=="cmd_success"||i.command=="cmd_fail"){if(i.seq===void 0){k.error("Got reply from worker with no seq");return}const o=this.inFlight[i.seq];if(o===void 0){k.error("Got reply for unknown seq "+i.seq);return}if(delete this.inFlight[i.seq],i.command=="cmd_success")o.resolve(i.result);else{const a=new Error(i.error.message);a.name=i.error.name,o.reject(a)}}else k.warn("Unrecognised message from worker: ",i)}}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,n){return this.doCmd("setOutOfBandMembers",[e,n])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}async saveToDeviceBatches(e){return this.doCmd("saveToDeviceBatches",[e])}async getOldestToDeviceBatch(){return this.doCmd("getOldestToDeviceBatch")}async removeToDeviceBatch(e){return this.doCmd("removeToDeviceBatch",[e])}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{k.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,n){return Promise.resolve().then(()=>{var s;const r=this.nextSeq++,i=Ef();return this.inFlight[r]=i,(s=this.worker)==null||s.postMessage({command:e,seq:r,args:n}),i.promise})}async destroy(){var e;(e=this.worker)==null||e.terminate()}}const Jke=1e3*60*5;class yX extends t_{constructor(e){if(super(e),this.startedUp=!1,this.syncTs=0,this.userModifiedMap={},this.emitter=new Fn,this.on=this.emitter.on.bind(this.emitter),this.onClose=()=>{this.emitter.emit("closed")},this.getSavedSync=this.degradable(()=>this.backend.getSavedSync(),"getSavedSync"),this.isNewlyCreated=this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated"),this.getSavedSyncToken=this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken"),this.deleteAllData=this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{k.log("Deleted indexeddb data.")},n=>{throw k.error(`Failed to delete indexeddb data: ${n}`),n}))),this.reallySave=this.degradable(()=>{this.syncTs=Date.now();const n=[];for(const r of this.getUsers())this.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&r.events.presence&&(n.push([r.userId,r.events.presence.event]),this.userModifiedMap[r.userId]=r.getLastModifiedTime());return this.backend.syncToDatabase(n)}),this.setSyncData=this.degradable(n=>this.backend.setSyncData(n),"setSyncData"),this.getOutOfBandMembers=this.degradable(n=>this.backend.getOutOfBandMembers(n),"getOutOfBandMembers"),this.setOutOfBandMembers=this.degradable((n,r)=>(super.setOutOfBandMembers(n,r),this.backend.setOutOfBandMembers(n,r)),"setOutOfBandMembers"),this.clearOutOfBandMembers=this.degradable(n=>(super.clearOutOfBandMembers(n),this.backend.clearOutOfBandMembers(n)),"clearOutOfBandMembers"),this.getClientOptions=this.degradable(()=>this.backend.getClientOptions(),"getClientOptions"),this.storeClientOptions=this.degradable(n=>(super.storeClientOptions(n),this.backend.storeClientOptions(n)),"storeClientOptions"),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new Yke(e.workerFactory,e.dbName):this.backend=new dB(e.indexedDB,e.dbName)}static exists(e,n){return dB.exists(e,n)}startup(){return this.startedUp?(k.log("IndexedDBStore.startup: already started"),Promise.resolve()):(k.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(k.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{k.log("IndexedDBStore.startup: processing presence events"),e.forEach(([n,r])=>{if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");const i=this.createUser(n);r&&i.setPresenceEvent(new oi(r)),this.userModifiedMap[i.userId]=i.getLastModifiedTime(),this.storeUser(i)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){return Date.now()-this.syncTs>Jke}save(e=!1){return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,n){const r=n?super[n]:null;return async(...i)=>{try{return await e.call(this,...i)}catch(s){k.error("IndexedDBStore failure, degrading to MemoryStore",s),this.emitter.emit("degraded",s);try{k.log("IndexedDBStore trying to delete degraded data"),await this.backend.clearDatabase(),k.log("IndexedDBStore delete after degrading succeeded")}catch(o){k.warn("IndexedDBStore delete after degrading failed",o)}if(r)return r.call(this,...i)}}}async getPendingEvents(e){if(!this.localStorage)return super.getPendingEvents(e);const n=this.localStorage.getItem(x3(e));if(n)try{return JSON.parse(n)}catch(r){k.error("Could not parse persisted pending events",r)}return[]}async setPendingEvents(e,n){if(!this.localStorage)return super.setPendingEvents(e,n);n.length>0?this.localStorage.setItem(x3(e),JSON.stringify(n)):this.localStorage.removeItem(x3(e))}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function x3(t){return`mx_pending_events_${t}`}var _X=(t=>(t.Email="email",t.Phone="msisdn",t))(_X||{});const Xke=new or("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility");var bX=(t=>(t.Gitlab="gitlab",t.Github="github",t.Apple="apple",t.Google="google",t.Facebook="facebook",t.Twitter="twitter",t))(bX||{}),SX=(t=>(t.LOGIN="login",t.REGISTER="register",t))(SX||{}),wX=(t=>(t.Global="Global",t.SetItemError="setItem",t.GetItemError="getItem",t.RemoveItemError="removeItem",t.ClearError="clear",t.QuotaExceededError="QuotaExceededError",t))(wX||{});class Zke extends Fn{}new Zke;let EX=()=>new x2;function TX(t){EX=t}function CX(t){return t.store=t.store??new t_({localStorage:global.localStorage}),t.scheduler=t.scheduler??new ev,t.cryptoStore=t.cryptoStore??EX(),t}function Y2(t){return new Qh(CX(t))}function kX(t,e,n,r,i=!0){return new eX(t,e,n,CX(r),i)}const Qke=Object.freeze(Object.defineProperty({__proto__:null,AuthType:pX,AutoDiscovery:gC,AutoDiscoveryAction:gJ,AutoDiscoveryError:k4,Beacon:UY,BeaconEvent:_r,CRYPTO_ENABLED:tke,CallEvent:Ds,CallFeedEvent:aJ,Category:tX,ClientEvent:qe,ClientPrefix:Nn,ClientStoppedError:gTe,ConditionKind:vr,ConditionOperator:pJ,ConnectionError:Sb,ContentHelpers:Owe,Crypto:STe,CryptoEvent:Zt,DELEGATED_OIDC_COMPATIBILITY:Xke,DEVICE_CODE_SCOPE:Hke,DMMemberCountCondition:ZEe,Device:cJ,DeviceVerification:$l,Direction:It,DuplicateStrategy:Y1,EVENT_VISIBILITY_CHANGE_TYPE:vh,EventEmitterEvents:f4,EventStatus:Ze,EventTimeline:He,EventTimelineSet:jg,EventType:Z,FILTER_RELATED_BY_REL_TYPES:mm,FILTER_RELATED_BY_SENDERS:gm,FeatureSupport:Ac,Filter:_o,GET_LOGIN_TOKEN_CAPABILITY:rke,GroupCall:T4,GroupCallEvent:fC,GroupCallIntent:w4,GroupCallState:E4,GroupCallStatsReportEvent:uJ,GroupCallType:B2,GuestAccess:Z0,HTTPError:uC,HistoryVisibility:G2,HttpApiEvent:dC,IdentityPrefix:Oc,IdentityProviderBrand:bX,IndexedDBCryptoStore:Be,IndexedDBStore:yX,InteractiveAuth:H4,InvalidCryptoStoreError:vC,InvalidCryptoStoreState:x4,JoinRule:hu,KNOWN_SAFE_ROOM_VERSION:JY,KeySignatureUploadError:x1,KnownMembership:Ge,LOCAL_NOTIFICATION_SETTINGS_PREFIX:cY,LocalStorageCryptoStore:H2,LocalStorageErrors:wX,LocationAssetType:zh,MAIN_ROOM_TIMELINE:pb,MSC3912_RELATION_BASED_REDACTIONS_PROP:k6,M_ASSET:fb,M_BEACON:fM,M_BEACON_INFO:D4,M_HTML:Cwe,M_LOCATION:hb,M_MESSAGE:Twe,M_POLL_END:lC,M_POLL_KIND_DISCLOSED:Mwe,M_POLL_KIND_UNDISCLOSED:Awe,M_POLL_RESPONSE:z0,M_POLL_START:Lwe,M_TEXT:g4,M_TIMESTAMP:wf,M_TOPIC:m4,MatrixClient:Qh,MatrixError:Ii,MatrixEvent:oi,MatrixEventEvent:sn,MatrixHttpApi:WY,MatrixScheduler:ev,MediaHandlerEvent:FJ,MediaPrefix:Oh,MemoryCryptoStore:x2,MemoryStore:t_,Method:oe,MsgType:Oa,NoAuthFlowFoundError:gX,NotificationCountType:xr,OidcError:Ti,OidcTokenRefresher:Vke,PUSHER_DEVICE_ID:Y_e,PUSHER_ENABLED:R6,PendingEventOrdering:Zh,Poll:BY,PollEvent:v4,Preset:Tb,PushRuleActionName:uu,PushRuleKind:Hr,REFERENCE_RELATION:kY,ReceiptType:Wi,RelationType:qn,Relations:h4,RelationsEvent:wY,RestrictedAllowType:$J,Room:U2,RoomCreateTypeField:eC,RoomEvent:ct,RoomMember:nC,RoomMemberEvent:Hs,RoomNameType:XY,RoomState:e_,RoomStateEvent:xt,RoomSummary:TY,RoomType:Ph,RoomVersionStability:S4,RoomWidgetClient:eX,RuleId:Br,SERVICE_TYPES:mC,SSOAction:SX,SearchOrderBy:L4,SearchResult:q2,SecretStorage:zTe,ServerCapabilities:YY,SetPresence:ZY,SlidingSyncEvent:EC,StatsReport:Zc,SyncAccumulator:nX,SyncState:ii,THREAD_RELATION_TYPE:hn,Thread:wi,ThreadEvent:Ga,ThreadFilterType:Ka,ThreepidMedium:_X,TimelineIndex:bM,TimelineWindow:Gke,ToDeviceMessageId:vs,TweakName:j2,TypedEventEmitter:Fn,UNSIGNED_MEMBERSHIP_FIELD:lY,UNSIGNED_THREAD_ID_FIELD:tC,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:aY,UNSTABLE_MSC2666_MUTUAL_ROOMS:GJ,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:zJ,UNSTABLE_MSC2666_SHARED_ROOMS:qJ,UNSTABLE_MSC2716_MARKER:oY,UNSTABLE_MSC3088_ENABLED:T6,UNSTABLE_MSC3088_PURPOSE:E6,UNSTABLE_MSC3089_BRANCH:eu,UNSTABLE_MSC3089_LEAF:sY,UNSTABLE_MSC3089_TREE_SUBTYPE:C6,UNSTABLE_MSC3852_LAST_SEEN_UA:nke,UNSTABLE_MSC4133_EXTENDED_PROFILES:WJ,UNSTABLE_MSC4140_DELAYED_EVENTS:Hc,UpdateDelayedEventAction:N4,User:lu,UserEvent:Id,Visibility:A4,anySignal:VY,calculateRetryBackoff:zY,completeAuthorizationCodeGrant:jke,createClient:Y2,createNewMatrixCall:W0,createRoomWidgetClient:kX,decodeBase64:xi,decodeIdToken:lX,determineFeatureSupport:JE,discoverAndValidateOIDCIssuerWellKnown:hX,encodeBase64:hs,encodeUnpaddedBase64:$2,encodeUnpaddedBase64Url:F2,fixNotificationCountOnDecryption:YJ,generateAuthorizationParams:Uke,generateAuthorizationUrl:$ke,generateOidcAuthorizationUrl:Fke,generateScope:W2,getBeaconInfoIdentifier:cC,getHttpUriForMxc:P2,inMainTimelineForReceipt:Q0,isDmMemberCountCondition:QEe,isEventTypeSame:kwe,isPollEvent:jY,isTimestampInDuration:Y6,isValidatedIssuerMetadata:cX,parseErrorResponse:_4,registerOidcClient:Kke,retryNetworkOperation:GY,setCryptoStoreFactory:TX,threadFilterTypeToFilter:JJ,threadIdForReceipt:tv,timeoutSignal:N2,validateBearerTokenResponse:fX,validateIdToken:uX,validateOIDCIssuerWellKnown:j4,validateStoredUserState:dX},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;let SM;try{SM=globalThis.indexedDB}catch{}SM&&TX(()=>new Be(SM,"matrix-js-sdk:crypto"));globalThis.matrixcs=Qke;var RX={exports:{}},No={},IX={exports:{}},xX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,W){var Y=K.length;K.push(W);e:for(;0<Y;){var ce=Y-1>>>1,ue=K[ce];if(0<i(ue,W))K[ce]=W,K[Y]=ue,Y=ce;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var W=K[0],Y=K.pop();if(Y!==W){K[0]=Y;e:for(var ce=0,ue=K.length,Te=ue>>>1;ce<Te;){var Re=2*(ce+1)-1,Oe=K[Re],De=Re+1,ze=K[De];if(0>i(Oe,Y))De<ue&&0>i(ze,Oe)?(K[ce]=ze,K[De]=Y,ce=De):(K[ce]=Oe,K[Re]=Y,ce=Re);else if(De<ue&&0>i(ze,Y))K[ce]=ze,K[De]=Y,ce=De;else break e}}return W}function i(K,W){var Y=K.sortIndex-W.sortIndex;return Y!==0?Y:K.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,f=3,p=!1,m=!1,v=!1,S=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(K){for(var W=n(l);W!==null;){if(W.callback===null)r(l);else if(W.startTime<=K)r(l),W.sortIndex=W.expirationTime,e(c,W);else break;W=n(l)}}function C(K){if(v=!1,T(K),!m)if(n(c)!==null)m=!0,V(I);else{var W=n(l);W!==null&&J(C,W.startTime-K)}}function I(K,W){m=!1,v&&(v=!1,_(A),A=-1),p=!0;var Y=f;try{for(T(W),d=n(c);d!==null&&(!(d.expirationTime>W)||K&&!L());){var ce=d.callback;if(typeof ce=="function"){d.callback=null,f=d.priorityLevel;var ue=ce(d.expirationTime<=W);W=t.unstable_now(),typeof ue=="function"?d.callback=ue:d===n(c)&&r(c),T(W)}else r(c);d=n(c)}if(d!==null)var Te=!0;else{var Re=n(l);Re!==null&&J(C,Re.startTime-W),Te=!1}return Te}finally{d=null,f=Y,p=!1}}var R=!1,O=null,A=-1,U=5,N=-1;function L(){return!(t.unstable_now()-N<U)}function j(){if(O!==null){var K=t.unstable_now();N=K;var W=!0;try{W=O(!0,K)}finally{W?X():(R=!1,O=null)}}else R=!1}var X;if(typeof w=="function")X=function(){w(j)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,F=G.port2;G.port1.onmessage=j,X=function(){F.postMessage(null)}}else X=function(){S(j,0)};function V(K){O=K,R||(R=!0,X())}function J(K,W){A=S(function(){K(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,V(I))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(f){case 1:case 2:case 3:var W=3;break;default:W=f}var Y=f;f=W;try{return K()}finally{f=Y}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,W){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var Y=f;f=K;try{return W()}finally{f=Y}},t.unstable_scheduleCallback=function(K,W,Y){var ce=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?ce+Y:ce):Y=ce,K){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=Y+ue,K={id:u++,callback:W,priorityLevel:K,startTime:Y,expirationTime:ue,sortIndex:-1},Y>ce?(K.sortIndex=Y,e(l,K),n(c)===null&&K===n(l)&&(v?(_(A),A=-1):v=!0,J(C,Y-ce))):(K.sortIndex=ue,e(c,K),m||p||(m=!0,V(I))),K},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(K){var W=f;return function(){var Y=f;f=W;try{return K.apply(this,arguments)}finally{f=Y}}}})(xX);IX.exports=xX;var e2e=IX.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t2e=y,Po=e2e;function Ce(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var PX=new Set,i_={};function kp(t,e){nv(t,e),nv(t+"Capture",e)}function nv(t,e){for(i_[t]=e,t=0;t<e.length;t++)PX.add(e[t])}var wu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wM=Object.prototype.hasOwnProperty,n2e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fB={},hB={};function r2e(t){return wM.call(hB,t)?!0:wM.call(fB,t)?!1:n2e.test(t)?hB[t]=!0:(fB[t]=!0,!1)}function i2e(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function s2e(t,e,n,r){if(e===null||typeof e>"u"||i2e(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Es(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Li={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Li[t]=new Es(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Li[e]=new Es(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Li[t]=new Es(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Li[t]=new Es(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Li[t]=new Es(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Li[t]=new Es(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Li[t]=new Es(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Li[t]=new Es(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Li[t]=new Es(t,5,!1,t.toLowerCase(),null,!1,!1)});var K4=/[\-:]([a-z])/g;function V4(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(K4,V4);Li[e]=new Es(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(K4,V4);Li[e]=new Es(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(K4,V4);Li[e]=new Es(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Li[t]=new Es(t,1,!1,t.toLowerCase(),null,!1,!1)});Li.xlinkHref=new Es("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Li[t]=new Es(t,1,!1,t.toLowerCase(),null,!0,!0)});function q4(t,e,n,r){var i=Li.hasOwnProperty(e)?Li[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(s2e(e,n,i,r)&&(n=null),r||i===null?r2e(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Hu=t2e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gw=Symbol.for("react.element"),Hg=Symbol.for("react.portal"),Kg=Symbol.for("react.fragment"),G4=Symbol.for("react.strict_mode"),EM=Symbol.for("react.profiler"),OX=Symbol.for("react.provider"),MX=Symbol.for("react.context"),z4=Symbol.for("react.forward_ref"),TM=Symbol.for("react.suspense"),CM=Symbol.for("react.suspense_list"),W4=Symbol.for("react.memo"),gd=Symbol.for("react.lazy"),AX=Symbol.for("react.offscreen"),pB=Symbol.iterator;function Hy(t){return t===null||typeof t!="object"?null:(t=pB&&t[pB]||t["@@iterator"],typeof t=="function"?t:null)}var sr=Object.assign,P3;function M1(t){if(P3===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);P3=e&&e[1]||""}return`
`+P3+t}var O3=!1;function M3(t,e){if(!t||O3)return"";O3=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{O3=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?M1(t):""}function o2e(t){switch(t.tag){case 5:return M1(t.type);case 16:return M1("Lazy");case 13:return M1("Suspense");case 19:return M1("SuspenseList");case 0:case 2:case 15:return t=M3(t.type,!1),t;case 11:return t=M3(t.type.render,!1),t;case 1:return t=M3(t.type,!0),t;default:return""}}function kM(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Kg:return"Fragment";case Hg:return"Portal";case EM:return"Profiler";case G4:return"StrictMode";case TM:return"Suspense";case CM:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case MX:return(t.displayName||"Context")+".Consumer";case OX:return(t._context.displayName||"Context")+".Provider";case z4:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case W4:return e=t.displayName||null,e!==null?e:kM(t.type)||"Memo";case gd:e=t._payload,t=t._init;try{return kM(t(e))}catch{}}return null}function a2e(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kM(e);case 8:return e===G4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function lf(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function LX(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function c2e(t){var e=LX(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function mw(t){t._valueTracker||(t._valueTracker=c2e(t))}function DX(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=LX(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function kC(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function RM(t,e){var n=e.checked;return sr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function gB(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=lf(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function NX(t,e){e=e.checked,e!=null&&q4(t,"checked",e,!1)}function IM(t,e){NX(t,e);var n=lf(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?xM(t,e.type,n):e.hasOwnProperty("defaultValue")&&xM(t,e.type,lf(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function mB(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xM(t,e,n){(e!=="number"||kC(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var A1=Array.isArray;function ym(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+lf(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function PM(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return sr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function vB(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ce(92));if(A1(n)){if(1<n.length)throw Error(Ce(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:lf(n)}}function UX(t,e){var n=lf(e.value),r=lf(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function yB(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $X(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function OM(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$X(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vw,FX=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vw=vw||document.createElement("div"),vw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vw.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function s_(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var n0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},l2e=["Webkit","ms","Moz","O"];Object.keys(n0).forEach(function(t){l2e.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),n0[e]=n0[t]})});function BX(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||n0.hasOwnProperty(t)&&n0[t]?(""+e).trim():e+"px"}function jX(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=BX(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var u2e=sr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function MM(t,e){if(e){if(u2e[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ce(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ce(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ce(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ce(62))}}function AM(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var LM=null;function Y4(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var DM=null,_m=null,bm=null;function _B(t){if(t=Rb(t)){if(typeof DM!="function")throw Error(Ce(280));var e=t.stateNode;e&&(e=eR(e),DM(t.stateNode,t.type,e))}}function HX(t){_m?bm?bm.push(t):bm=[t]:_m=t}function KX(){if(_m){var t=_m,e=bm;if(bm=_m=null,_B(t),e)for(t=0;t<e.length;t++)_B(e[t])}}function VX(t,e){return t(e)}function qX(){}var A3=!1;function GX(t,e,n){if(A3)return t(e,n);A3=!0;try{return VX(t,e,n)}finally{A3=!1,(_m!==null||bm!==null)&&(qX(),KX())}}function o_(t,e){var n=t.stateNode;if(n===null)return null;var r=eR(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ce(231,e,typeof n));return n}var NM=!1;if(wu)try{var Ky={};Object.defineProperty(Ky,"passive",{get:function(){NM=!0}}),window.addEventListener("test",Ky,Ky),window.removeEventListener("test",Ky,Ky)}catch{NM=!1}function d2e(t,e,n,r,i,s,o,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var r0=!1,RC=null,IC=!1,UM=null,f2e={onError:function(t){r0=!0,RC=t}};function h2e(t,e,n,r,i,s,o,a,c){r0=!1,RC=null,d2e.apply(f2e,arguments)}function p2e(t,e,n,r,i,s,o,a,c){if(h2e.apply(this,arguments),r0){if(r0){var l=RC;r0=!1,RC=null}else throw Error(Ce(198));IC||(IC=!0,UM=l)}}function Rp(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function zX(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function bB(t){if(Rp(t)!==t)throw Error(Ce(188))}function g2e(t){var e=t.alternate;if(!e){if(e=Rp(t),e===null)throw Error(Ce(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return bB(i),t;if(s===r)return bB(i),e;s=s.sibling}throw Error(Ce(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(Ce(189))}}if(n.alternate!==r)throw Error(Ce(190))}if(n.tag!==3)throw Error(Ce(188));return n.stateNode.current===n?t:e}function WX(t){return t=g2e(t),t!==null?YX(t):null}function YX(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=YX(t);if(e!==null)return e;t=t.sibling}return null}var JX=Po.unstable_scheduleCallback,SB=Po.unstable_cancelCallback,m2e=Po.unstable_shouldYield,v2e=Po.unstable_requestPaint,br=Po.unstable_now,y2e=Po.unstable_getCurrentPriorityLevel,J4=Po.unstable_ImmediatePriority,XX=Po.unstable_UserBlockingPriority,xC=Po.unstable_NormalPriority,_2e=Po.unstable_LowPriority,ZX=Po.unstable_IdlePriority,J2=null,rl=null;function b2e(t){if(rl&&typeof rl.onCommitFiberRoot=="function")try{rl.onCommitFiberRoot(J2,t,void 0,(t.current.flags&128)===128)}catch{}}var cc=Math.clz32?Math.clz32:E2e,S2e=Math.log,w2e=Math.LN2;function E2e(t){return t>>>=0,t===0?32:31-(S2e(t)/w2e|0)|0}var yw=64,_w=4194304;function L1(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function PC(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=L1(a):(s&=o,s!==0&&(r=L1(s)))}else o=n&~i,o!==0?r=L1(o):s!==0&&(r=L1(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-cc(e),i=1<<n,r|=t[n],e&=~i;return r}function T2e(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function C2e(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-cc(s),a=1<<o,c=i[o];c===-1?(!(a&n)||a&r)&&(i[o]=T2e(a,e)):c<=e&&(t.expiredLanes|=a),s&=~a}}function $M(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function QX(){var t=yw;return yw<<=1,!(yw&4194240)&&(yw=64),t}function L3(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Cb(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-cc(e),t[e]=n}function k2e(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-cc(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function X4(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-cc(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var an=0;function eZ(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var tZ,Z4,nZ,rZ,iZ,FM=!1,bw=[],jd=null,Hd=null,Kd=null,a_=new Map,c_=new Map,Ed=[],R2e="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wB(t,e){switch(t){case"focusin":case"focusout":jd=null;break;case"dragenter":case"dragleave":Hd=null;break;case"mouseover":case"mouseout":Kd=null;break;case"pointerover":case"pointerout":a_.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":c_.delete(e.pointerId)}}function Vy(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Rb(e),e!==null&&Z4(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function I2e(t,e,n,r,i){switch(e){case"focusin":return jd=Vy(jd,t,e,n,r,i),!0;case"dragenter":return Hd=Vy(Hd,t,e,n,r,i),!0;case"mouseover":return Kd=Vy(Kd,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return a_.set(s,Vy(a_.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,c_.set(s,Vy(c_.get(s)||null,t,e,n,r,i)),!0}return!1}function sZ(t){var e=_h(t.target);if(e!==null){var n=Rp(e);if(n!==null){if(e=n.tag,e===13){if(e=zX(n),e!==null){t.blockedOn=e,iZ(t.priority,function(){nZ(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function QE(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=BM(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);LM=r,n.target.dispatchEvent(r),LM=null}else return e=Rb(n),e!==null&&Z4(e),t.blockedOn=n,!1;e.shift()}return!0}function EB(t,e,n){QE(t)&&n.delete(e)}function x2e(){FM=!1,jd!==null&&QE(jd)&&(jd=null),Hd!==null&&QE(Hd)&&(Hd=null),Kd!==null&&QE(Kd)&&(Kd=null),a_.forEach(EB),c_.forEach(EB)}function qy(t,e){t.blockedOn===e&&(t.blockedOn=null,FM||(FM=!0,Po.unstable_scheduleCallback(Po.unstable_NormalPriority,x2e)))}function l_(t){function e(i){return qy(i,t)}if(0<bw.length){qy(bw[0],t);for(var n=1;n<bw.length;n++){var r=bw[n];r.blockedOn===t&&(r.blockedOn=null)}}for(jd!==null&&qy(jd,t),Hd!==null&&qy(Hd,t),Kd!==null&&qy(Kd,t),a_.forEach(e),c_.forEach(e),n=0;n<Ed.length;n++)r=Ed[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ed.length&&(n=Ed[0],n.blockedOn===null);)sZ(n),n.blockedOn===null&&Ed.shift()}var Sm=Hu.ReactCurrentBatchConfig,OC=!0;function P2e(t,e,n,r){var i=an,s=Sm.transition;Sm.transition=null;try{an=1,Q4(t,e,n,r)}finally{an=i,Sm.transition=s}}function O2e(t,e,n,r){var i=an,s=Sm.transition;Sm.transition=null;try{an=4,Q4(t,e,n,r)}finally{an=i,Sm.transition=s}}function Q4(t,e,n,r){if(OC){var i=BM(t,e,n,r);if(i===null)V3(t,e,r,MC,n),wB(t,r);else if(I2e(i,t,e,n,r))r.stopPropagation();else if(wB(t,r),e&4&&-1<R2e.indexOf(t)){for(;i!==null;){var s=Rb(i);if(s!==null&&tZ(s),s=BM(t,e,n,r),s===null&&V3(t,e,r,MC,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else V3(t,e,r,null,n)}}var MC=null;function BM(t,e,n,r){if(MC=null,t=Y4(r),t=_h(t),t!==null)if(e=Rp(t),e===null)t=null;else if(n=e.tag,n===13){if(t=zX(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return MC=t,null}function oZ(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(y2e()){case J4:return 1;case XX:return 4;case xC:case _2e:return 16;case ZX:return 536870912;default:return 16}default:return 16}}var Pd=null,e8=null,eT=null;function aZ(){if(eT)return eT;var t,e=e8,n=e.length,r,i="value"in Pd?Pd.value:Pd.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return eT=i.slice(t,1<r?1-r:void 0)}function tT(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Sw(){return!0}function TB(){return!1}function Uo(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Sw:TB,this.isPropagationStopped=TB,this}return sr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Sw)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Sw)},persist:function(){},isPersistent:Sw}),e}var Vv={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},t8=Uo(Vv),kb=sr({},Vv,{view:0,detail:0}),M2e=Uo(kb),D3,N3,Gy,X2=sr({},kb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:n8,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Gy&&(Gy&&t.type==="mousemove"?(D3=t.screenX-Gy.screenX,N3=t.screenY-Gy.screenY):N3=D3=0,Gy=t),D3)},movementY:function(t){return"movementY"in t?t.movementY:N3}}),CB=Uo(X2),A2e=sr({},X2,{dataTransfer:0}),L2e=Uo(A2e),D2e=sr({},kb,{relatedTarget:0}),U3=Uo(D2e),N2e=sr({},Vv,{animationName:0,elapsedTime:0,pseudoElement:0}),U2e=Uo(N2e),$2e=sr({},Vv,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),F2e=Uo($2e),B2e=sr({},Vv,{data:0}),kB=Uo(B2e),j2e={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},H2e={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},K2e={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function V2e(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=K2e[t])?!!e[t]:!1}function n8(){return V2e}var q2e=sr({},kb,{key:function(t){if(t.key){var e=j2e[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=tT(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?H2e[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:n8,charCode:function(t){return t.type==="keypress"?tT(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?tT(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),G2e=Uo(q2e),z2e=sr({},X2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),RB=Uo(z2e),W2e=sr({},kb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:n8}),Y2e=Uo(W2e),J2e=sr({},Vv,{propertyName:0,elapsedTime:0,pseudoElement:0}),X2e=Uo(J2e),Z2e=sr({},X2,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Q2e=Uo(Z2e),eRe=[9,13,27,32],r8=wu&&"CompositionEvent"in window,i0=null;wu&&"documentMode"in document&&(i0=document.documentMode);var tRe=wu&&"TextEvent"in window&&!i0,cZ=wu&&(!r8||i0&&8<i0&&11>=i0),IB=" ",xB=!1;function lZ(t,e){switch(t){case"keyup":return eRe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uZ(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vg=!1;function nRe(t,e){switch(t){case"compositionend":return uZ(e);case"keypress":return e.which!==32?null:(xB=!0,IB);case"textInput":return t=e.data,t===IB&&xB?null:t;default:return null}}function rRe(t,e){if(Vg)return t==="compositionend"||!r8&&lZ(t,e)?(t=aZ(),eT=e8=Pd=null,Vg=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cZ&&e.locale!=="ko"?null:e.data;default:return null}}var iRe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PB(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!iRe[t.type]:e==="textarea"}function dZ(t,e,n,r){HX(r),e=AC(e,"onChange"),0<e.length&&(n=new t8("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var s0=null,u_=null;function sRe(t){wZ(t,0)}function Z2(t){var e=zg(t);if(DX(e))return t}function oRe(t,e){if(t==="change")return e}var fZ=!1;if(wu){var $3;if(wu){var F3="oninput"in document;if(!F3){var OB=document.createElement("div");OB.setAttribute("oninput","return;"),F3=typeof OB.oninput=="function"}$3=F3}else $3=!1;fZ=$3&&(!document.documentMode||9<document.documentMode)}function MB(){s0&&(s0.detachEvent("onpropertychange",hZ),u_=s0=null)}function hZ(t){if(t.propertyName==="value"&&Z2(u_)){var e=[];dZ(e,u_,t,Y4(t)),GX(sRe,e)}}function aRe(t,e,n){t==="focusin"?(MB(),s0=e,u_=n,s0.attachEvent("onpropertychange",hZ)):t==="focusout"&&MB()}function cRe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Z2(u_)}function lRe(t,e){if(t==="click")return Z2(e)}function uRe(t,e){if(t==="input"||t==="change")return Z2(e)}function dRe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var dc=typeof Object.is=="function"?Object.is:dRe;function d_(t,e){if(dc(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!wM.call(e,i)||!dc(t[i],e[i]))return!1}return!0}function AB(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function LB(t,e){var n=AB(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=AB(n)}}function pZ(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pZ(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function gZ(){for(var t=window,e=kC();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=kC(t.document)}return e}function i8(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function fRe(t){var e=gZ(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&pZ(n.ownerDocument.documentElement,n)){if(r!==null&&i8(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=LB(n,s);var o=LB(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var hRe=wu&&"documentMode"in document&&11>=document.documentMode,qg=null,jM=null,o0=null,HM=!1;function DB(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;HM||qg==null||qg!==kC(r)||(r=qg,"selectionStart"in r&&i8(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),o0&&d_(o0,r)||(o0=r,r=AC(jM,"onSelect"),0<r.length&&(e=new t8("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=qg)))}function ww(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Gg={animationend:ww("Animation","AnimationEnd"),animationiteration:ww("Animation","AnimationIteration"),animationstart:ww("Animation","AnimationStart"),transitionend:ww("Transition","TransitionEnd")},B3={},mZ={};wu&&(mZ=document.createElement("div").style,"AnimationEvent"in window||(delete Gg.animationend.animation,delete Gg.animationiteration.animation,delete Gg.animationstart.animation),"TransitionEvent"in window||delete Gg.transitionend.transition);function Q2(t){if(B3[t])return B3[t];if(!Gg[t])return t;var e=Gg[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in mZ)return B3[t]=e[n];return t}var vZ=Q2("animationend"),yZ=Q2("animationiteration"),_Z=Q2("animationstart"),bZ=Q2("transitionend"),SZ=new Map,NB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kf(t,e){SZ.set(t,e),kp(e,[t])}for(var j3=0;j3<NB.length;j3++){var H3=NB[j3],pRe=H3.toLowerCase(),gRe=H3[0].toUpperCase()+H3.slice(1);kf(pRe,"on"+gRe)}kf(vZ,"onAnimationEnd");kf(yZ,"onAnimationIteration");kf(_Z,"onAnimationStart");kf("dblclick","onDoubleClick");kf("focusin","onFocus");kf("focusout","onBlur");kf(bZ,"onTransitionEnd");nv("onMouseEnter",["mouseout","mouseover"]);nv("onMouseLeave",["mouseout","mouseover"]);nv("onPointerEnter",["pointerout","pointerover"]);nv("onPointerLeave",["pointerout","pointerover"]);kp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));kp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));kp("onBeforeInput",["compositionend","keypress","textInput","paste"]);kp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));kp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));kp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var D1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mRe=new Set("cancel close invalid load scroll toggle".split(" ").concat(D1));function UB(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,p2e(r,e,void 0,t),t.currentTarget=null}function wZ(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==s&&i.isPropagationStopped())break e;UB(i,a,l),s=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,l=a.currentTarget,a=a.listener,c!==s&&i.isPropagationStopped())break e;UB(i,a,l),s=c}}}if(IC)throw t=UM,IC=!1,UM=null,t}function Ln(t,e){var n=e[zM];n===void 0&&(n=e[zM]=new Set);var r=t+"__bubble";n.has(r)||(EZ(e,t,2,!1),n.add(r))}function K3(t,e,n){var r=0;e&&(r|=4),EZ(n,t,r,e)}var Ew="_reactListening"+Math.random().toString(36).slice(2);function f_(t){if(!t[Ew]){t[Ew]=!0,PX.forEach(function(n){n!=="selectionchange"&&(mRe.has(n)||K3(n,!1,t),K3(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ew]||(e[Ew]=!0,K3("selectionchange",!1,e))}}function EZ(t,e,n,r){switch(oZ(e)){case 1:var i=P2e;break;case 4:i=O2e;break;default:i=Q4}n=i.bind(null,e,n,t),i=void 0,!NM||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function V3(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;a!==null;){if(o=_h(a),o===null)return;if(c=o.tag,c===5||c===6){r=s=o;continue e}a=a.parentNode}}r=r.return}GX(function(){var l=s,u=Y4(n),d=[];e:{var f=SZ.get(t);if(f!==void 0){var p=t8,m=t;switch(t){case"keypress":if(tT(n)===0)break e;case"keydown":case"keyup":p=G2e;break;case"focusin":m="focus",p=U3;break;case"focusout":m="blur",p=U3;break;case"beforeblur":case"afterblur":p=U3;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=CB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=L2e;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Y2e;break;case vZ:case yZ:case _Z:p=U2e;break;case bZ:p=X2e;break;case"scroll":p=M2e;break;case"wheel":p=Q2e;break;case"copy":case"cut":case"paste":p=F2e;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=RB}var v=(e&4)!==0,S=!v&&t==="scroll",_=v?f!==null?f+"Capture":null:f;v=[];for(var w=l,T;w!==null;){T=w;var C=T.stateNode;if(T.tag===5&&C!==null&&(T=C,_!==null&&(C=o_(w,_),C!=null&&v.push(h_(w,C,T)))),S)break;w=w.return}0<v.length&&(f=new p(f,m,null,n,u),d.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==LM&&(m=n.relatedTarget||n.fromElement)&&(_h(m)||m[Eu]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=l,m=m?_h(m):null,m!==null&&(S=Rp(m),m!==S||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(v=CB,C="onMouseLeave",_="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(v=RB,C="onPointerLeave",_="onPointerEnter",w="pointer"),S=p==null?f:zg(p),T=m==null?f:zg(m),f=new v(C,w+"leave",p,n,u),f.target=S,f.relatedTarget=T,C=null,_h(u)===l&&(v=new v(_,w+"enter",m,n,u),v.target=T,v.relatedTarget=S,C=v),S=C,p&&m)t:{for(v=p,_=m,w=0,T=v;T;T=dg(T))w++;for(T=0,C=_;C;C=dg(C))T++;for(;0<w-T;)v=dg(v),w--;for(;0<T-w;)_=dg(_),T--;for(;w--;){if(v===_||_!==null&&v===_.alternate)break t;v=dg(v),_=dg(_)}v=null}else v=null;p!==null&&$B(d,f,p,v,!1),m!==null&&S!==null&&$B(d,S,m,v,!0)}}e:{if(f=l?zg(l):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var I=oRe;else if(PB(f))if(fZ)I=uRe;else{I=cRe;var R=aRe}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(I=lRe);if(I&&(I=I(t,l))){dZ(d,I,n,u);break e}R&&R(t,f,l),t==="focusout"&&(R=f._wrapperState)&&R.controlled&&f.type==="number"&&xM(f,"number",f.value)}switch(R=l?zg(l):window,t){case"focusin":(PB(R)||R.contentEditable==="true")&&(qg=R,jM=l,o0=null);break;case"focusout":o0=jM=qg=null;break;case"mousedown":HM=!0;break;case"contextmenu":case"mouseup":case"dragend":HM=!1,DB(d,n,u);break;case"selectionchange":if(hRe)break;case"keydown":case"keyup":DB(d,n,u)}var O;if(r8)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Vg?lZ(t,n)&&(A="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(A="onCompositionStart");A&&(cZ&&n.locale!=="ko"&&(Vg||A!=="onCompositionStart"?A==="onCompositionEnd"&&Vg&&(O=aZ()):(Pd=u,e8="value"in Pd?Pd.value:Pd.textContent,Vg=!0)),R=AC(l,A),0<R.length&&(A=new kB(A,t,null,n,u),d.push({event:A,listeners:R}),O?A.data=O:(O=uZ(n),O!==null&&(A.data=O)))),(O=tRe?nRe(t,n):rRe(t,n))&&(l=AC(l,"onBeforeInput"),0<l.length&&(u=new kB("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=O))}wZ(d,e)})}function h_(t,e,n){return{instance:t,listener:e,currentTarget:n}}function AC(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=o_(t,n),s!=null&&r.unshift(h_(t,s,i)),s=o_(t,e),s!=null&&r.push(h_(t,s,i))),t=t.return}return r}function dg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function $B(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&l!==null&&(a=l,i?(c=o_(n,s),c!=null&&o.unshift(h_(n,c,a))):i||(c=o_(n,s),c!=null&&o.push(h_(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var vRe=/\r\n?/g,yRe=/\u0000|\uFFFD/g;function FB(t){return(typeof t=="string"?t:""+t).replace(vRe,`
`).replace(yRe,"")}function Tw(t,e,n){if(e=FB(e),FB(t)!==e&&n)throw Error(Ce(425))}function LC(){}var KM=null,VM=null;function qM(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var GM=typeof setTimeout=="function"?setTimeout:void 0,_Re=typeof clearTimeout=="function"?clearTimeout:void 0,BB=typeof Promise=="function"?Promise:void 0,bRe=typeof queueMicrotask=="function"?queueMicrotask:typeof BB<"u"?function(t){return BB.resolve(null).then(t).catch(SRe)}:GM;function SRe(t){setTimeout(function(){throw t})}function q3(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),l_(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);l_(e)}function Vd(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function jB(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qv=Math.random().toString(36).slice(2),zc="__reactFiber$"+qv,p_="__reactProps$"+qv,Eu="__reactContainer$"+qv,zM="__reactEvents$"+qv,wRe="__reactListeners$"+qv,ERe="__reactHandles$"+qv;function _h(t){var e=t[zc];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Eu]||n[zc]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=jB(t);t!==null;){if(n=t[zc])return n;t=jB(t)}return e}t=n,n=t.parentNode}return null}function Rb(t){return t=t[zc]||t[Eu],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function zg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ce(33))}function eR(t){return t[p_]||null}var WM=[],Wg=-1;function Rf(t){return{current:t}}function $n(t){0>Wg||(t.current=WM[Wg],WM[Wg]=null,Wg--)}function On(t,e){Wg++,WM[Wg]=t.current,t.current=e}var uf={},Qi=Rf(uf),Xs=Rf(!1),ep=uf;function rv(t,e){var n=t.type.contextTypes;if(!n)return uf;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Zs(t){return t=t.childContextTypes,t!=null}function DC(){$n(Xs),$n(Qi)}function HB(t,e,n){if(Qi.current!==uf)throw Error(Ce(168));On(Qi,e),On(Xs,n)}function TZ(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Ce(108,a2e(t)||"Unknown",i));return sr({},n,r)}function NC(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||uf,ep=Qi.current,On(Qi,t),On(Xs,Xs.current),!0}function KB(t,e,n){var r=t.stateNode;if(!r)throw Error(Ce(169));n?(t=TZ(t,e,ep),r.__reactInternalMemoizedMergedChildContext=t,$n(Xs),$n(Qi),On(Qi,t)):$n(Xs),On(Xs,n)}var Wl=null,tR=!1,G3=!1;function CZ(t){Wl===null?Wl=[t]:Wl.push(t)}function TRe(t){tR=!0,CZ(t)}function If(){if(!G3&&Wl!==null){G3=!0;var t=0,e=an;try{var n=Wl;for(an=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Wl=null,tR=!1}catch(i){throw Wl!==null&&(Wl=Wl.slice(t+1)),JX(J4,If),i}finally{an=e,G3=!1}}return null}var Yg=[],Jg=0,UC=null,$C=0,ta=[],na=0,tp=null,au=1,cu="";function lh(t,e){Yg[Jg++]=$C,Yg[Jg++]=UC,UC=t,$C=e}function kZ(t,e,n){ta[na++]=au,ta[na++]=cu,ta[na++]=tp,tp=t;var r=au;t=cu;var i=32-cc(r)-1;r&=~(1<<i),n+=1;var s=32-cc(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,au=1<<32-cc(e)+i|n<<i|r,cu=s+t}else au=1<<s|n<<i|r,cu=t}function s8(t){t.return!==null&&(lh(t,1),kZ(t,1,0))}function o8(t){for(;t===UC;)UC=Yg[--Jg],Yg[Jg]=null,$C=Yg[--Jg],Yg[Jg]=null;for(;t===tp;)tp=ta[--na],ta[na]=null,cu=ta[--na],ta[na]=null,au=ta[--na],ta[na]=null}var ko=null,wo=null,zn=!1,Za=null;function RZ(t,e){var n=ha(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function VB(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ko=t,wo=Vd(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ko=t,wo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=tp!==null?{id:au,overflow:cu}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ha(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ko=t,wo=null,!0):!1;default:return!1}}function YM(t){return(t.mode&1)!==0&&(t.flags&128)===0}function JM(t){if(zn){var e=wo;if(e){var n=e;if(!VB(t,e)){if(YM(t))throw Error(Ce(418));e=Vd(n.nextSibling);var r=ko;e&&VB(t,e)?RZ(r,n):(t.flags=t.flags&-4097|2,zn=!1,ko=t)}}else{if(YM(t))throw Error(Ce(418));t.flags=t.flags&-4097|2,zn=!1,ko=t}}}function qB(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ko=t}function Cw(t){if(t!==ko)return!1;if(!zn)return qB(t),zn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!qM(t.type,t.memoizedProps)),e&&(e=wo)){if(YM(t))throw IZ(),Error(Ce(418));for(;e;)RZ(t,e),e=Vd(e.nextSibling)}if(qB(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ce(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){wo=Vd(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}wo=null}}else wo=ko?Vd(t.stateNode.nextSibling):null;return!0}function IZ(){for(var t=wo;t;)t=Vd(t.nextSibling)}function iv(){wo=ko=null,zn=!1}function a8(t){Za===null?Za=[t]:Za.push(t)}var CRe=Hu.ReactCurrentBatchConfig;function zy(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ce(309));var r=n.stateNode}if(!r)throw Error(Ce(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Ce(284));if(!n._owner)throw Error(Ce(290,t))}return t}function kw(t,e){throw t=Object.prototype.toString.call(e),Error(Ce(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function GB(t){var e=t._init;return e(t._payload)}function xZ(t){function e(_,w){if(t){var T=_.deletions;T===null?(_.deletions=[w],_.flags|=16):T.push(w)}}function n(_,w){if(!t)return null;for(;w!==null;)e(_,w),w=w.sibling;return null}function r(_,w){for(_=new Map;w!==null;)w.key!==null?_.set(w.key,w):_.set(w.index,w),w=w.sibling;return _}function i(_,w){return _=Wd(_,w),_.index=0,_.sibling=null,_}function s(_,w,T){return _.index=T,t?(T=_.alternate,T!==null?(T=T.index,T<w?(_.flags|=2,w):T):(_.flags|=2,w)):(_.flags|=1048576,w)}function o(_){return t&&_.alternate===null&&(_.flags|=2),_}function a(_,w,T,C){return w===null||w.tag!==6?(w=Q3(T,_.mode,C),w.return=_,w):(w=i(w,T),w.return=_,w)}function c(_,w,T,C){var I=T.type;return I===Kg?u(_,w,T.props.children,C,T.key):w!==null&&(w.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===gd&&GB(I)===w.type)?(C=i(w,T.props),C.ref=zy(_,w,T),C.return=_,C):(C=cT(T.type,T.key,T.props,null,_.mode,C),C.ref=zy(_,w,T),C.return=_,C)}function l(_,w,T,C){return w===null||w.tag!==4||w.stateNode.containerInfo!==T.containerInfo||w.stateNode.implementation!==T.implementation?(w=eP(T,_.mode,C),w.return=_,w):(w=i(w,T.children||[]),w.return=_,w)}function u(_,w,T,C,I){return w===null||w.tag!==7?(w=Lh(T,_.mode,C,I),w.return=_,w):(w=i(w,T),w.return=_,w)}function d(_,w,T){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Q3(""+w,_.mode,T),w.return=_,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case gw:return T=cT(w.type,w.key,w.props,null,_.mode,T),T.ref=zy(_,null,w),T.return=_,T;case Hg:return w=eP(w,_.mode,T),w.return=_,w;case gd:var C=w._init;return d(_,C(w._payload),T)}if(A1(w)||Hy(w))return w=Lh(w,_.mode,T,null),w.return=_,w;kw(_,w)}return null}function f(_,w,T,C){var I=w!==null?w.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return I!==null?null:a(_,w,""+T,C);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case gw:return T.key===I?c(_,w,T,C):null;case Hg:return T.key===I?l(_,w,T,C):null;case gd:return I=T._init,f(_,w,I(T._payload),C)}if(A1(T)||Hy(T))return I!==null?null:u(_,w,T,C,null);kw(_,T)}return null}function p(_,w,T,C,I){if(typeof C=="string"&&C!==""||typeof C=="number")return _=_.get(T)||null,a(w,_,""+C,I);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case gw:return _=_.get(C.key===null?T:C.key)||null,c(w,_,C,I);case Hg:return _=_.get(C.key===null?T:C.key)||null,l(w,_,C,I);case gd:var R=C._init;return p(_,w,T,R(C._payload),I)}if(A1(C)||Hy(C))return _=_.get(T)||null,u(w,_,C,I,null);kw(w,C)}return null}function m(_,w,T,C){for(var I=null,R=null,O=w,A=w=0,U=null;O!==null&&A<T.length;A++){O.index>A?(U=O,O=null):U=O.sibling;var N=f(_,O,T[A],C);if(N===null){O===null&&(O=U);break}t&&O&&N.alternate===null&&e(_,O),w=s(N,w,A),R===null?I=N:R.sibling=N,R=N,O=U}if(A===T.length)return n(_,O),zn&&lh(_,A),I;if(O===null){for(;A<T.length;A++)O=d(_,T[A],C),O!==null&&(w=s(O,w,A),R===null?I=O:R.sibling=O,R=O);return zn&&lh(_,A),I}for(O=r(_,O);A<T.length;A++)U=p(O,_,A,T[A],C),U!==null&&(t&&U.alternate!==null&&O.delete(U.key===null?A:U.key),w=s(U,w,A),R===null?I=U:R.sibling=U,R=U);return t&&O.forEach(function(L){return e(_,L)}),zn&&lh(_,A),I}function v(_,w,T,C){var I=Hy(T);if(typeof I!="function")throw Error(Ce(150));if(T=I.call(T),T==null)throw Error(Ce(151));for(var R=I=null,O=w,A=w=0,U=null,N=T.next();O!==null&&!N.done;A++,N=T.next()){O.index>A?(U=O,O=null):U=O.sibling;var L=f(_,O,N.value,C);if(L===null){O===null&&(O=U);break}t&&O&&L.alternate===null&&e(_,O),w=s(L,w,A),R===null?I=L:R.sibling=L,R=L,O=U}if(N.done)return n(_,O),zn&&lh(_,A),I;if(O===null){for(;!N.done;A++,N=T.next())N=d(_,N.value,C),N!==null&&(w=s(N,w,A),R===null?I=N:R.sibling=N,R=N);return zn&&lh(_,A),I}for(O=r(_,O);!N.done;A++,N=T.next())N=p(O,_,A,N.value,C),N!==null&&(t&&N.alternate!==null&&O.delete(N.key===null?A:N.key),w=s(N,w,A),R===null?I=N:R.sibling=N,R=N);return t&&O.forEach(function(j){return e(_,j)}),zn&&lh(_,A),I}function S(_,w,T,C){if(typeof T=="object"&&T!==null&&T.type===Kg&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case gw:e:{for(var I=T.key,R=w;R!==null;){if(R.key===I){if(I=T.type,I===Kg){if(R.tag===7){n(_,R.sibling),w=i(R,T.props.children),w.return=_,_=w;break e}}else if(R.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===gd&&GB(I)===R.type){n(_,R.sibling),w=i(R,T.props),w.ref=zy(_,R,T),w.return=_,_=w;break e}n(_,R);break}else e(_,R);R=R.sibling}T.type===Kg?(w=Lh(T.props.children,_.mode,C,T.key),w.return=_,_=w):(C=cT(T.type,T.key,T.props,null,_.mode,C),C.ref=zy(_,w,T),C.return=_,_=C)}return o(_);case Hg:e:{for(R=T.key;w!==null;){if(w.key===R)if(w.tag===4&&w.stateNode.containerInfo===T.containerInfo&&w.stateNode.implementation===T.implementation){n(_,w.sibling),w=i(w,T.children||[]),w.return=_,_=w;break e}else{n(_,w);break}else e(_,w);w=w.sibling}w=eP(T,_.mode,C),w.return=_,_=w}return o(_);case gd:return R=T._init,S(_,w,R(T._payload),C)}if(A1(T))return m(_,w,T,C);if(Hy(T))return v(_,w,T,C);kw(_,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,w!==null&&w.tag===6?(n(_,w.sibling),w=i(w,T),w.return=_,_=w):(n(_,w),w=Q3(T,_.mode,C),w.return=_,_=w),o(_)):n(_,w)}return S}var sv=xZ(!0),PZ=xZ(!1),FC=Rf(null),BC=null,Xg=null,c8=null;function l8(){c8=Xg=BC=null}function u8(t){var e=FC.current;$n(FC),t._currentValue=e}function XM(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function wm(t,e){BC=t,c8=Xg=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Vs=!0),t.firstContext=null)}function Ca(t){var e=t._currentValue;if(c8!==t)if(t={context:t,memoizedValue:e,next:null},Xg===null){if(BC===null)throw Error(Ce(308));Xg=t,BC.dependencies={lanes:0,firstContext:t}}else Xg=Xg.next=t;return e}var bh=null;function d8(t){bh===null?bh=[t]:bh.push(t)}function OZ(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,d8(e)):(n.next=i.next,i.next=n),e.interleaved=n,Tu(t,r)}function Tu(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var md=!1;function f8(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function MZ(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function pu(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function qd(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ht&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Tu(t,n)}return i=r.interleaved,i===null?(e.next=e,d8(r)):(e.next=i.next,i.next=e),r.interleaved=e,Tu(t,n)}function nT(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,X4(t,n)}}function zB(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function jC(t,e,n,r){var i=t.updateQueue;md=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,l=c.next;c.next=null,o===null?s=l:o.next=l,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(s!==null){var d=i.baseState;o=0,u=l=c=null,a=s;do{var f=a.lane,p=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,v=a;switch(f=e,p=n,v.tag){case 1:if(m=v.payload,typeof m=="function"){d=m.call(p,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=v.payload,f=typeof m=="function"?m.call(p,d,f):m,f==null)break e;d=sr({},d,f);break e;case 2:md=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else p={eventTime:p,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);rp|=o,t.lanes=o,t.memoizedState=d}}function WB(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Ce(191,i));i.call(r)}}}var Ib={},il=Rf(Ib),g_=Rf(Ib),m_=Rf(Ib);function Sh(t){if(t===Ib)throw Error(Ce(174));return t}function h8(t,e){switch(On(m_,e),On(g_,t),On(il,Ib),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:OM(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=OM(e,t)}$n(il),On(il,e)}function ov(){$n(il),$n(g_),$n(m_)}function AZ(t){Sh(m_.current);var e=Sh(il.current),n=OM(e,t.type);e!==n&&(On(g_,t),On(il,n))}function p8(t){g_.current===t&&($n(il),$n(g_))}var tr=Rf(0);function HC(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var z3=[];function g8(){for(var t=0;t<z3.length;t++)z3[t]._workInProgressVersionPrimary=null;z3.length=0}var rT=Hu.ReactCurrentDispatcher,W3=Hu.ReactCurrentBatchConfig,np=0,ir=null,Kr=null,ni=null,KC=!1,a0=!1,v_=0,kRe=0;function $i(){throw Error(Ce(321))}function m8(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!dc(t[n],e[n]))return!1;return!0}function v8(t,e,n,r,i,s){if(np=s,ir=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,rT.current=t===null||t.memoizedState===null?PRe:ORe,t=n(r,i),a0){s=0;do{if(a0=!1,v_=0,25<=s)throw Error(Ce(301));s+=1,ni=Kr=null,e.updateQueue=null,rT.current=MRe,t=n(r,i)}while(a0)}if(rT.current=VC,e=Kr!==null&&Kr.next!==null,np=0,ni=Kr=ir=null,KC=!1,e)throw Error(Ce(300));return t}function y8(){var t=v_!==0;return v_=0,t}function Nc(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ni===null?ir.memoizedState=ni=t:ni=ni.next=t,ni}function ka(){if(Kr===null){var t=ir.alternate;t=t!==null?t.memoizedState:null}else t=Kr.next;var e=ni===null?ir.memoizedState:ni.next;if(e!==null)ni=e,Kr=t;else{if(t===null)throw Error(Ce(310));Kr=t,t={memoizedState:Kr.memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},ni===null?ir.memoizedState=ni=t:ni=ni.next=t}return ni}function y_(t,e){return typeof e=="function"?e(t):e}function Y3(t){var e=ka(),n=e.queue;if(n===null)throw Error(Ce(311));n.lastRenderedReducer=t;var r=Kr,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,c=null,l=s;do{var u=l.lane;if((np&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,o=r):c=c.next=d,ir.lanes|=u,rp|=u}l=l.next}while(l!==null&&l!==s);c===null?o=r:c.next=a,dc(r,e.memoizedState)||(Vs=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,ir.lanes|=s,rp|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function J3(t){var e=ka(),n=e.queue;if(n===null)throw Error(Ce(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);dc(s,e.memoizedState)||(Vs=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function LZ(){}function DZ(t,e){var n=ir,r=ka(),i=e(),s=!dc(r.memoizedState,i);if(s&&(r.memoizedState=i,Vs=!0),r=r.queue,_8($Z.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||ni!==null&&ni.memoizedState.tag&1){if(n.flags|=2048,__(9,UZ.bind(null,n,r,i,e),void 0,null),ai===null)throw Error(Ce(349));np&30||NZ(n,e,i)}return i}function NZ(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ir.updateQueue,e===null?(e={lastEffect:null,stores:null},ir.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function UZ(t,e,n,r){e.value=n,e.getSnapshot=r,FZ(e)&&BZ(t)}function $Z(t,e,n){return n(function(){FZ(e)&&BZ(t)})}function FZ(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!dc(t,n)}catch{return!0}}function BZ(t){var e=Tu(t,1);e!==null&&lc(e,t,1,-1)}function YB(t){var e=Nc();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:y_,lastRenderedState:t},e.queue=t,t=t.dispatch=xRe.bind(null,ir,t),[e.memoizedState,t]}function __(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ir.updateQueue,e===null?(e={lastEffect:null,stores:null},ir.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function jZ(){return ka().memoizedState}function iT(t,e,n,r){var i=Nc();ir.flags|=t,i.memoizedState=__(1|e,n,void 0,r===void 0?null:r)}function nR(t,e,n,r){var i=ka();r=r===void 0?null:r;var s=void 0;if(Kr!==null){var o=Kr.memoizedState;if(s=o.destroy,r!==null&&m8(r,o.deps)){i.memoizedState=__(e,n,s,r);return}}ir.flags|=t,i.memoizedState=__(1|e,n,s,r)}function JB(t,e){return iT(8390656,8,t,e)}function _8(t,e){return nR(2048,8,t,e)}function HZ(t,e){return nR(4,2,t,e)}function KZ(t,e){return nR(4,4,t,e)}function VZ(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function qZ(t,e,n){return n=n!=null?n.concat([t]):null,nR(4,4,VZ.bind(null,e,t),n)}function b8(){}function GZ(t,e){var n=ka();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&m8(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function zZ(t,e){var n=ka();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&m8(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function WZ(t,e,n){return np&21?(dc(n,e)||(n=QX(),ir.lanes|=n,rp|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Vs=!0),t.memoizedState=n)}function RRe(t,e){var n=an;an=n!==0&&4>n?n:4,t(!0);var r=W3.transition;W3.transition={};try{t(!1),e()}finally{an=n,W3.transition=r}}function YZ(){return ka().memoizedState}function IRe(t,e,n){var r=zd(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},JZ(t))XZ(e,n);else if(n=OZ(t,e,n,r),n!==null){var i=ys();lc(n,t,r,i),ZZ(n,e,r)}}function xRe(t,e,n){var r=zd(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(JZ(t))XZ(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,dc(a,o)){var c=e.interleaved;c===null?(i.next=i,d8(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=OZ(t,e,i,r),n!==null&&(i=ys(),lc(n,t,r,i),ZZ(n,e,r))}}function JZ(t){var e=t.alternate;return t===ir||e!==null&&e===ir}function XZ(t,e){a0=KC=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ZZ(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,X4(t,n)}}var VC={readContext:Ca,useCallback:$i,useContext:$i,useEffect:$i,useImperativeHandle:$i,useInsertionEffect:$i,useLayoutEffect:$i,useMemo:$i,useReducer:$i,useRef:$i,useState:$i,useDebugValue:$i,useDeferredValue:$i,useTransition:$i,useMutableSource:$i,useSyncExternalStore:$i,useId:$i,unstable_isNewReconciler:!1},PRe={readContext:Ca,useCallback:function(t,e){return Nc().memoizedState=[t,e===void 0?null:e],t},useContext:Ca,useEffect:JB,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,iT(4194308,4,VZ.bind(null,e,t),n)},useLayoutEffect:function(t,e){return iT(4194308,4,t,e)},useInsertionEffect:function(t,e){return iT(4,2,t,e)},useMemo:function(t,e){var n=Nc();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Nc();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=IRe.bind(null,ir,t),[r.memoizedState,t]},useRef:function(t){var e=Nc();return t={current:t},e.memoizedState=t},useState:YB,useDebugValue:b8,useDeferredValue:function(t){return Nc().memoizedState=t},useTransition:function(){var t=YB(!1),e=t[0];return t=RRe.bind(null,t[1]),Nc().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ir,i=Nc();if(zn){if(n===void 0)throw Error(Ce(407));n=n()}else{if(n=e(),ai===null)throw Error(Ce(349));np&30||NZ(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,JB($Z.bind(null,r,s,t),[t]),r.flags|=2048,__(9,UZ.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Nc(),e=ai.identifierPrefix;if(zn){var n=cu,r=au;n=(r&~(1<<32-cc(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=v_++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kRe++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ORe={readContext:Ca,useCallback:GZ,useContext:Ca,useEffect:_8,useImperativeHandle:qZ,useInsertionEffect:HZ,useLayoutEffect:KZ,useMemo:zZ,useReducer:Y3,useRef:jZ,useState:function(){return Y3(y_)},useDebugValue:b8,useDeferredValue:function(t){var e=ka();return WZ(e,Kr.memoizedState,t)},useTransition:function(){var t=Y3(y_)[0],e=ka().memoizedState;return[t,e]},useMutableSource:LZ,useSyncExternalStore:DZ,useId:YZ,unstable_isNewReconciler:!1},MRe={readContext:Ca,useCallback:GZ,useContext:Ca,useEffect:_8,useImperativeHandle:qZ,useInsertionEffect:HZ,useLayoutEffect:KZ,useMemo:zZ,useReducer:J3,useRef:jZ,useState:function(){return J3(y_)},useDebugValue:b8,useDeferredValue:function(t){var e=ka();return Kr===null?e.memoizedState=t:WZ(e,Kr.memoizedState,t)},useTransition:function(){var t=J3(y_)[0],e=ka().memoizedState;return[t,e]},useMutableSource:LZ,useSyncExternalStore:DZ,useId:YZ,unstable_isNewReconciler:!1};function Va(t,e){if(t&&t.defaultProps){e=sr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function ZM(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:sr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var rR={isMounted:function(t){return(t=t._reactInternals)?Rp(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=ys(),i=zd(t),s=pu(r,i);s.payload=e,n!=null&&(s.callback=n),e=qd(t,s,i),e!==null&&(lc(e,t,i,r),nT(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=ys(),i=zd(t),s=pu(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=qd(t,s,i),e!==null&&(lc(e,t,i,r),nT(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ys(),r=zd(t),i=pu(n,r);i.tag=2,e!=null&&(i.callback=e),e=qd(t,i,r),e!==null&&(lc(e,t,r,n),nT(e,t,r))}};function XB(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!d_(n,r)||!d_(i,s):!0}function QZ(t,e,n){var r=!1,i=uf,s=e.contextType;return typeof s=="object"&&s!==null?s=Ca(s):(i=Zs(e)?ep:Qi.current,r=e.contextTypes,s=(r=r!=null)?rv(t,i):uf),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=rR,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function ZB(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&rR.enqueueReplaceState(e,e.state,null)}function QM(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},f8(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Ca(s):(s=Zs(e)?ep:Qi.current,i.context=rv(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ZM(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&rR.enqueueReplaceState(i,i.state,null),jC(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function av(t,e){try{var n="",r=e;do n+=o2e(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function X3(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function eA(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ARe=typeof WeakMap=="function"?WeakMap:Map;function eQ(t,e,n){n=pu(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){GC||(GC=!0,uA=r),eA(t,e)},n}function tQ(t,e,n){n=pu(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){eA(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){eA(t,e),typeof r!="function"&&(Gd===null?Gd=new Set([this]):Gd.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function QB(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new ARe;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=zRe.bind(null,t,e,n),e.then(t,t))}function ej(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function tj(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=pu(-1,1),e.tag=2,qd(n,e,1))),n.lanes|=1),t)}var LRe=Hu.ReactCurrentOwner,Vs=!1;function as(t,e,n,r){e.child=t===null?PZ(e,null,n,r):sv(e,t.child,n,r)}function nj(t,e,n,r,i){n=n.render;var s=e.ref;return wm(e,i),r=v8(t,e,n,r,s,i),n=y8(),t!==null&&!Vs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cu(t,e,i)):(zn&&n&&s8(e),e.flags|=1,as(t,e,r,i),e.child)}function rj(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!I8(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,nQ(t,e,s,r,i)):(t=cT(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:d_,n(o,r)&&t.ref===e.ref)return Cu(t,e,i)}return e.flags|=1,t=Wd(s,r),t.ref=e.ref,t.return=e,e.child=t}function nQ(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(d_(s,r)&&t.ref===e.ref)if(Vs=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(Vs=!0);else return e.lanes=t.lanes,Cu(t,e,i)}return tA(t,e,n,r,i)}function rQ(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},On(Qg,yo),yo|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,On(Qg,yo),yo|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,On(Qg,yo),yo|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,On(Qg,yo),yo|=r;return as(t,e,i,n),e.child}function iQ(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function tA(t,e,n,r,i){var s=Zs(n)?ep:Qi.current;return s=rv(e,s),wm(e,i),n=v8(t,e,n,r,s,i),r=y8(),t!==null&&!Vs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Cu(t,e,i)):(zn&&r&&s8(e),e.flags|=1,as(t,e,n,i),e.child)}function ij(t,e,n,r,i){if(Zs(n)){var s=!0;NC(e)}else s=!1;if(wm(e,i),e.stateNode===null)sT(t,e),QZ(e,n,r),QM(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,l=n.contextType;typeof l=="object"&&l!==null?l=Ca(l):(l=Zs(n)?ep:Qi.current,l=rv(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==l)&&ZB(e,o,r,l),md=!1;var f=e.memoizedState;o.state=f,jC(e,r,o,i),c=e.memoizedState,a!==r||f!==c||Xs.current||md?(typeof u=="function"&&(ZM(e,n,u,r),c=e.memoizedState),(a=md||XB(e,n,a,r,f,c,l))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=l,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,MZ(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Va(e.type,a),o.props=l,d=e.pendingProps,f=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ca(c):(c=Zs(n)?ep:Qi.current,c=rv(e,c));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==c)&&ZB(e,o,r,c),md=!1,f=e.memoizedState,o.state=f,jC(e,r,o,i);var m=e.memoizedState;a!==d||f!==m||Xs.current||md?(typeof p=="function"&&(ZM(e,n,p,r),m=e.memoizedState),(l=md||XB(e,n,l,r,f,m,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=c,r=l):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return nA(t,e,n,r,s,i)}function nA(t,e,n,r,i,s){iQ(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&KB(e,n,!1),Cu(t,e,s);r=e.stateNode,LRe.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=sv(e,t.child,null,s),e.child=sv(e,null,a,s)):as(t,e,a,s),e.memoizedState=r.state,i&&KB(e,n,!0),e.child}function sQ(t){var e=t.stateNode;e.pendingContext?HB(t,e.pendingContext,e.pendingContext!==e.context):e.context&&HB(t,e.context,!1),h8(t,e.containerInfo)}function sj(t,e,n,r,i){return iv(),a8(i),e.flags|=256,as(t,e,n,r),e.child}var rA={dehydrated:null,treeContext:null,retryLane:0};function iA(t){return{baseLanes:t,cachePool:null,transitions:null}}function oQ(t,e,n){var r=e.pendingProps,i=tr.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),On(tr,i&1),t===null)return JM(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=oR(o,r,0,null),t=Lh(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=iA(n),e.memoizedState=rA,t):S8(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return DRe(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Wd(i,c),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Wd(a,s):(s=Lh(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?iA(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=rA,r}return s=t.child,t=s.sibling,r=Wd(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function S8(t,e){return e=oR({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Rw(t,e,n,r){return r!==null&&a8(r),sv(e,t.child,null,n),t=S8(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function DRe(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=X3(Error(Ce(422))),Rw(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=oR({mode:"visible",children:r.children},i,0,null),s=Lh(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&sv(e,t.child,null,o),e.child.memoizedState=iA(o),e.memoizedState=rA,s);if(!(e.mode&1))return Rw(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(Ce(419)),r=X3(s,r,void 0),Rw(t,e,o,r)}if(a=(o&t.childLanes)!==0,Vs||a){if(r=ai,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Tu(t,i),lc(r,t,i,-1))}return R8(),r=X3(Error(Ce(421))),Rw(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=WRe.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,wo=Vd(i.nextSibling),ko=e,zn=!0,Za=null,t!==null&&(ta[na++]=au,ta[na++]=cu,ta[na++]=tp,au=t.id,cu=t.overflow,tp=e),e=S8(e,r.children),e.flags|=4096,e)}function oj(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),XM(t.return,e,n)}function Z3(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function aQ(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(as(t,e,r.children,n),r=tr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&oj(t,n,e);else if(t.tag===19)oj(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(On(tr,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&HC(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Z3(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&HC(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Z3(e,!0,n,null,s);break;case"together":Z3(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function sT(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Cu(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),rp|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ce(153));if(e.child!==null){for(t=e.child,n=Wd(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Wd(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function NRe(t,e,n){switch(e.tag){case 3:sQ(e),iv();break;case 5:AZ(e);break;case 1:Zs(e.type)&&NC(e);break;case 4:h8(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;On(FC,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(On(tr,tr.current&1),e.flags|=128,null):n&e.child.childLanes?oQ(t,e,n):(On(tr,tr.current&1),t=Cu(t,e,n),t!==null?t.sibling:null);On(tr,tr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return aQ(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),On(tr,tr.current),r)break;return null;case 22:case 23:return e.lanes=0,rQ(t,e,n)}return Cu(t,e,n)}var cQ,sA,lQ,uQ;cQ=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};sA=function(){};lQ=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Sh(il.current);var s=null;switch(n){case"input":i=RM(t,i),r=RM(t,r),s=[];break;case"select":i=sr({},i,{value:void 0}),r=sr({},r,{value:void 0}),s=[];break;case"textarea":i=PM(t,i),r=PM(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=LC)}MM(n,r);var o;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(i_.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var c=r[l];if(a=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(s=s||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(s=s||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(i_.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&Ln("scroll",t),s||a===c||(s=[])):(s=s||[]).push(l,c))}n&&(s=s||[]).push("style",n);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};uQ=function(t,e,n,r){n!==r&&(e.flags|=4)};function Wy(t,e){if(!zn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Fi(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function URe(t,e,n){var r=e.pendingProps;switch(o8(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fi(e),null;case 1:return Zs(e.type)&&DC(),Fi(e),null;case 3:return r=e.stateNode,ov(),$n(Xs),$n(Qi),g8(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Cw(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Za!==null&&(hA(Za),Za=null))),sA(t,e),Fi(e),null;case 5:p8(e);var i=Sh(m_.current);if(n=e.type,t!==null&&e.stateNode!=null)lQ(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Ce(166));return Fi(e),null}if(t=Sh(il.current),Cw(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[zc]=e,r[p_]=s,t=(e.mode&1)!==0,n){case"dialog":Ln("cancel",r),Ln("close",r);break;case"iframe":case"object":case"embed":Ln("load",r);break;case"video":case"audio":for(i=0;i<D1.length;i++)Ln(D1[i],r);break;case"source":Ln("error",r);break;case"img":case"image":case"link":Ln("error",r),Ln("load",r);break;case"details":Ln("toggle",r);break;case"input":gB(r,s),Ln("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Ln("invalid",r);break;case"textarea":vB(r,s),Ln("invalid",r)}MM(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Tw(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Tw(r.textContent,a,t),i=["children",""+a]):i_.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Ln("scroll",r)}switch(n){case"input":mw(r),mB(r,s,!0);break;case"textarea":mw(r),yB(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=LC)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$X(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[zc]=e,t[p_]=r,cQ(t,e,!1,!1),e.stateNode=t;e:{switch(o=AM(n,r),n){case"dialog":Ln("cancel",t),Ln("close",t),i=r;break;case"iframe":case"object":case"embed":Ln("load",t),i=r;break;case"video":case"audio":for(i=0;i<D1.length;i++)Ln(D1[i],t);i=r;break;case"source":Ln("error",t),i=r;break;case"img":case"image":case"link":Ln("error",t),Ln("load",t),i=r;break;case"details":Ln("toggle",t),i=r;break;case"input":gB(t,r),i=RM(t,r),Ln("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=sr({},r,{value:void 0}),Ln("invalid",t);break;case"textarea":vB(t,r),i=PM(t,r),Ln("invalid",t);break;default:i=r}MM(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var c=a[s];s==="style"?jX(t,c):s==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&FX(t,c)):s==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&s_(t,c):typeof c=="number"&&s_(t,""+c):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(i_.hasOwnProperty(s)?c!=null&&s==="onScroll"&&Ln("scroll",t):c!=null&&q4(t,s,c,o))}switch(n){case"input":mw(t),mB(t,r,!1);break;case"textarea":mw(t),yB(t);break;case"option":r.value!=null&&t.setAttribute("value",""+lf(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?ym(t,!!r.multiple,s,!1):r.defaultValue!=null&&ym(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=LC)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Fi(e),null;case 6:if(t&&e.stateNode!=null)uQ(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Ce(166));if(n=Sh(m_.current),Sh(il.current),Cw(e)){if(r=e.stateNode,n=e.memoizedProps,r[zc]=e,(s=r.nodeValue!==n)&&(t=ko,t!==null))switch(t.tag){case 3:Tw(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Tw(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[zc]=e,e.stateNode=r}return Fi(e),null;case 13:if($n(tr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(zn&&wo!==null&&e.mode&1&&!(e.flags&128))IZ(),iv(),e.flags|=98560,s=!1;else if(s=Cw(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(Ce(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ce(317));s[zc]=e}else iv(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Fi(e),s=!1}else Za!==null&&(hA(Za),Za=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||tr.current&1?Gr===0&&(Gr=3):R8())),e.updateQueue!==null&&(e.flags|=4),Fi(e),null);case 4:return ov(),sA(t,e),t===null&&f_(e.stateNode.containerInfo),Fi(e),null;case 10:return u8(e.type._context),Fi(e),null;case 17:return Zs(e.type)&&DC(),Fi(e),null;case 19:if($n(tr),s=e.memoizedState,s===null)return Fi(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Wy(s,!1);else{if(Gr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=HC(t),o!==null){for(e.flags|=128,Wy(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return On(tr,tr.current&1|2),e.child}t=t.sibling}s.tail!==null&&br()>cv&&(e.flags|=128,r=!0,Wy(s,!1),e.lanes=4194304)}else{if(!r)if(t=HC(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Wy(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!zn)return Fi(e),null}else 2*br()-s.renderingStartTime>cv&&n!==1073741824&&(e.flags|=128,r=!0,Wy(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=br(),e.sibling=null,n=tr.current,On(tr,r?n&1|2:n&1),e):(Fi(e),null);case 22:case 23:return k8(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?yo&1073741824&&(Fi(e),e.subtreeFlags&6&&(e.flags|=8192)):Fi(e),null;case 24:return null;case 25:return null}throw Error(Ce(156,e.tag))}function $Re(t,e){switch(o8(e),e.tag){case 1:return Zs(e.type)&&DC(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ov(),$n(Xs),$n(Qi),g8(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return p8(e),null;case 13:if($n(tr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ce(340));iv()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return $n(tr),null;case 4:return ov(),null;case 10:return u8(e.type._context),null;case 22:case 23:return k8(),null;case 24:return null;default:return null}}var Iw=!1,Yi=!1,FRe=typeof WeakSet=="function"?WeakSet:Set,Ve=null;function Zg(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){dr(t,e,r)}else n.current=null}function oA(t,e,n){try{n()}catch(r){dr(t,e,r)}}var aj=!1;function BRe(t,e){if(KM=OC,t=gZ(),i8(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,l=0,u=0,d=t,f=null;t:for(;;){for(var p;d!==n||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(c=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===t)break t;if(f===n&&++l===i&&(a=o),f===s&&++u===r&&(c=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(VM={focusedElem:t,selectionRange:n},OC=!1,Ve=e;Ve!==null;)if(e=Ve,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ve=t;else for(;Ve!==null;){e=Ve;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var v=m.memoizedProps,S=m.memoizedState,_=e.stateNode,w=_.getSnapshotBeforeUpdate(e.elementType===e.type?v:Va(e.type,v),S);_.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var T=e.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(C){dr(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,Ve=t;break}Ve=e.return}return m=aj,aj=!1,m}function c0(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&oA(e,n,s)}i=i.next}while(i!==r)}}function iR(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function aA(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dQ(t){var e=t.alternate;e!==null&&(t.alternate=null,dQ(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[zc],delete e[p_],delete e[zM],delete e[wRe],delete e[ERe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function fQ(t){return t.tag===5||t.tag===3||t.tag===4}function cj(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||fQ(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function cA(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=LC));else if(r!==4&&(t=t.child,t!==null))for(cA(t,e,n),t=t.sibling;t!==null;)cA(t,e,n),t=t.sibling}function lA(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(lA(t,e,n),t=t.sibling;t!==null;)lA(t,e,n),t=t.sibling}var mi=null,za=!1;function rd(t,e,n){for(n=n.child;n!==null;)hQ(t,e,n),n=n.sibling}function hQ(t,e,n){if(rl&&typeof rl.onCommitFiberUnmount=="function")try{rl.onCommitFiberUnmount(J2,n)}catch{}switch(n.tag){case 5:Yi||Zg(n,e);case 6:var r=mi,i=za;mi=null,rd(t,e,n),mi=r,za=i,mi!==null&&(za?(t=mi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):mi.removeChild(n.stateNode));break;case 18:mi!==null&&(za?(t=mi,n=n.stateNode,t.nodeType===8?q3(t.parentNode,n):t.nodeType===1&&q3(t,n),l_(t)):q3(mi,n.stateNode));break;case 4:r=mi,i=za,mi=n.stateNode.containerInfo,za=!0,rd(t,e,n),mi=r,za=i;break;case 0:case 11:case 14:case 15:if(!Yi&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&oA(n,e,o),i=i.next}while(i!==r)}rd(t,e,n);break;case 1:if(!Yi&&(Zg(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){dr(n,e,a)}rd(t,e,n);break;case 21:rd(t,e,n);break;case 22:n.mode&1?(Yi=(r=Yi)||n.memoizedState!==null,rd(t,e,n),Yi=r):rd(t,e,n);break;default:rd(t,e,n)}}function lj(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new FRe),e.forEach(function(r){var i=YRe.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function $a(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:mi=a.stateNode,za=!1;break e;case 3:mi=a.stateNode.containerInfo,za=!0;break e;case 4:mi=a.stateNode.containerInfo,za=!0;break e}a=a.return}if(mi===null)throw Error(Ce(160));hQ(s,o,i),mi=null,za=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(l){dr(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)pQ(e,t),e=e.sibling}function pQ(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if($a(e,t),Cc(t),r&4){try{c0(3,t,t.return),iR(3,t)}catch(v){dr(t,t.return,v)}try{c0(5,t,t.return)}catch(v){dr(t,t.return,v)}}break;case 1:$a(e,t),Cc(t),r&512&&n!==null&&Zg(n,n.return);break;case 5:if($a(e,t),Cc(t),r&512&&n!==null&&Zg(n,n.return),t.flags&32){var i=t.stateNode;try{s_(i,"")}catch(v){dr(t,t.return,v)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&NX(i,s),AM(a,o);var l=AM(a,s);for(o=0;o<c.length;o+=2){var u=c[o],d=c[o+1];u==="style"?jX(i,d):u==="dangerouslySetInnerHTML"?FX(i,d):u==="children"?s_(i,d):q4(i,u,d,l)}switch(a){case"input":IM(i,s);break;case"textarea":UX(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?ym(i,!!s.multiple,p,!1):f!==!!s.multiple&&(s.defaultValue!=null?ym(i,!!s.multiple,s.defaultValue,!0):ym(i,!!s.multiple,s.multiple?[]:"",!1))}i[p_]=s}catch(v){dr(t,t.return,v)}}break;case 6:if($a(e,t),Cc(t),r&4){if(t.stateNode===null)throw Error(Ce(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(v){dr(t,t.return,v)}}break;case 3:if($a(e,t),Cc(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{l_(e.containerInfo)}catch(v){dr(t,t.return,v)}break;case 4:$a(e,t),Cc(t);break;case 13:$a(e,t),Cc(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(T8=br())),r&4&&lj(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Yi=(l=Yi)||u,$a(e,t),Yi=l):$a(e,t),Cc(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(Ve=t,u=t.child;u!==null;){for(d=Ve=u;Ve!==null;){switch(f=Ve,p=f.child,f.tag){case 0:case 11:case 14:case 15:c0(4,f,f.return);break;case 1:Zg(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(v){dr(r,n,v)}}break;case 5:Zg(f,f.return);break;case 22:if(f.memoizedState!==null){dj(d);continue}}p!==null?(p.return=f,Ve=p):dj(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=BX("display",o))}catch(v){dr(t,t.return,v)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){dr(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:$a(e,t),Cc(t),r&4&&lj(t);break;case 21:break;default:$a(e,t),Cc(t)}}function Cc(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(fQ(n)){var r=n;break e}n=n.return}throw Error(Ce(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(s_(i,""),r.flags&=-33);var s=cj(t);lA(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=cj(t);cA(t,a,o);break;default:throw Error(Ce(161))}}catch(c){dr(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function jRe(t,e,n){Ve=t,gQ(t)}function gQ(t,e,n){for(var r=(t.mode&1)!==0;Ve!==null;){var i=Ve,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Iw;if(!o){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Yi;a=Iw;var l=Yi;if(Iw=o,(Yi=c)&&!l)for(Ve=i;Ve!==null;)o=Ve,c=o.child,o.tag===22&&o.memoizedState!==null?fj(i):c!==null?(c.return=o,Ve=c):fj(i);for(;s!==null;)Ve=s,gQ(s),s=s.sibling;Ve=i,Iw=a,Yi=l}uj(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Ve=s):uj(t)}}function uj(t){for(;Ve!==null;){var e=Ve;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Yi||iR(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Yi)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Va(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&WB(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}WB(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&l_(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}Yi||e.flags&512&&aA(e)}catch(f){dr(e,e.return,f)}}if(e===t){Ve=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function dj(t){for(;Ve!==null;){var e=Ve;if(e===t){Ve=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ve=n;break}Ve=e.return}}function fj(t){for(;Ve!==null;){var e=Ve;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{iR(4,e)}catch(c){dr(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){dr(e,i,c)}}var s=e.return;try{aA(e)}catch(c){dr(e,s,c)}break;case 5:var o=e.return;try{aA(e)}catch(c){dr(e,o,c)}}}catch(c){dr(e,e.return,c)}if(e===t){Ve=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ve=a;break}Ve=e.return}}var HRe=Math.ceil,qC=Hu.ReactCurrentDispatcher,w8=Hu.ReactCurrentOwner,va=Hu.ReactCurrentBatchConfig,Ht=0,ai=null,Pr=null,Mi=0,yo=0,Qg=Rf(0),Gr=0,b_=null,rp=0,sR=0,E8=0,l0=null,Bs=null,T8=0,cv=1/0,Kl=null,GC=!1,uA=null,Gd=null,xw=!1,Od=null,zC=0,u0=0,dA=null,oT=-1,aT=0;function ys(){return Ht&6?br():oT!==-1?oT:oT=br()}function zd(t){return t.mode&1?Ht&2&&Mi!==0?Mi&-Mi:CRe.transition!==null?(aT===0&&(aT=QX()),aT):(t=an,t!==0||(t=window.event,t=t===void 0?16:oZ(t.type)),t):1}function lc(t,e,n,r){if(50<u0)throw u0=0,dA=null,Error(Ce(185));Cb(t,n,r),(!(Ht&2)||t!==ai)&&(t===ai&&(!(Ht&2)&&(sR|=n),Gr===4&&Td(t,Mi)),Qs(t,r),n===1&&Ht===0&&!(e.mode&1)&&(cv=br()+500,tR&&If()))}function Qs(t,e){var n=t.callbackNode;C2e(t,e);var r=PC(t,t===ai?Mi:0);if(r===0)n!==null&&SB(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&SB(n),e===1)t.tag===0?TRe(hj.bind(null,t)):CZ(hj.bind(null,t)),bRe(function(){!(Ht&6)&&If()}),n=null;else{switch(eZ(r)){case 1:n=J4;break;case 4:n=XX;break;case 16:n=xC;break;case 536870912:n=ZX;break;default:n=xC}n=EQ(n,mQ.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function mQ(t,e){if(oT=-1,aT=0,Ht&6)throw Error(Ce(327));var n=t.callbackNode;if(Em()&&t.callbackNode!==n)return null;var r=PC(t,t===ai?Mi:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=WC(t,r);else{e=r;var i=Ht;Ht|=2;var s=yQ();(ai!==t||Mi!==e)&&(Kl=null,cv=br()+500,Ah(t,e));do try{qRe();break}catch(a){vQ(t,a)}while(!0);l8(),qC.current=s,Ht=i,Pr!==null?e=0:(ai=null,Mi=0,e=Gr)}if(e!==0){if(e===2&&(i=$M(t),i!==0&&(r=i,e=fA(t,i))),e===1)throw n=b_,Ah(t,0),Td(t,r),Qs(t,br()),n;if(e===6)Td(t,r);else{if(i=t.current.alternate,!(r&30)&&!KRe(i)&&(e=WC(t,r),e===2&&(s=$M(t),s!==0&&(r=s,e=fA(t,s))),e===1))throw n=b_,Ah(t,0),Td(t,r),Qs(t,br()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Ce(345));case 2:uh(t,Bs,Kl);break;case 3:if(Td(t,r),(r&130023424)===r&&(e=T8+500-br(),10<e)){if(PC(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){ys(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=GM(uh.bind(null,t,Bs,Kl),e);break}uh(t,Bs,Kl);break;case 4:if(Td(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-cc(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=br()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*HRe(r/1960))-r,10<r){t.timeoutHandle=GM(uh.bind(null,t,Bs,Kl),r);break}uh(t,Bs,Kl);break;case 5:uh(t,Bs,Kl);break;default:throw Error(Ce(329))}}}return Qs(t,br()),t.callbackNode===n?mQ.bind(null,t):null}function fA(t,e){var n=l0;return t.current.memoizedState.isDehydrated&&(Ah(t,e).flags|=256),t=WC(t,e),t!==2&&(e=Bs,Bs=n,e!==null&&hA(e)),t}function hA(t){Bs===null?Bs=t:Bs.push.apply(Bs,t)}function KRe(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!dc(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Td(t,e){for(e&=~E8,e&=~sR,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-cc(e),r=1<<n;t[n]=-1,e&=~r}}function hj(t){if(Ht&6)throw Error(Ce(327));Em();var e=PC(t,0);if(!(e&1))return Qs(t,br()),null;var n=WC(t,e);if(t.tag!==0&&n===2){var r=$M(t);r!==0&&(e=r,n=fA(t,r))}if(n===1)throw n=b_,Ah(t,0),Td(t,e),Qs(t,br()),n;if(n===6)throw Error(Ce(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,uh(t,Bs,Kl),Qs(t,br()),null}function C8(t,e){var n=Ht;Ht|=1;try{return t(e)}finally{Ht=n,Ht===0&&(cv=br()+500,tR&&If())}}function ip(t){Od!==null&&Od.tag===0&&!(Ht&6)&&Em();var e=Ht;Ht|=1;var n=va.transition,r=an;try{if(va.transition=null,an=1,t)return t()}finally{an=r,va.transition=n,Ht=e,!(Ht&6)&&If()}}function k8(){yo=Qg.current,$n(Qg)}function Ah(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,_Re(n)),Pr!==null)for(n=Pr.return;n!==null;){var r=n;switch(o8(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&DC();break;case 3:ov(),$n(Xs),$n(Qi),g8();break;case 5:p8(r);break;case 4:ov();break;case 13:$n(tr);break;case 19:$n(tr);break;case 10:u8(r.type._context);break;case 22:case 23:k8()}n=n.return}if(ai=t,Pr=t=Wd(t.current,null),Mi=yo=e,Gr=0,b_=null,E8=sR=rp=0,Bs=l0=null,bh!==null){for(e=0;e<bh.length;e++)if(n=bh[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}bh=null}return t}function vQ(t,e){do{var n=Pr;try{if(l8(),rT.current=VC,KC){for(var r=ir.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}KC=!1}if(np=0,ni=Kr=ir=null,a0=!1,v_=0,w8.current=null,n===null||n.return===null){Gr=1,b_=e,Pr=null;break}e:{var s=t,o=n.return,a=n,c=e;if(e=Mi,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=ej(o);if(p!==null){p.flags&=-257,tj(p,o,a,s,e),p.mode&1&&QB(s,l,e),e=p,c=l;var m=e.updateQueue;if(m===null){var v=new Set;v.add(c),e.updateQueue=v}else m.add(c);break e}else{if(!(e&1)){QB(s,l,e),R8();break e}c=Error(Ce(426))}}else if(zn&&a.mode&1){var S=ej(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),tj(S,o,a,s,e),a8(av(c,a));break e}}s=c=av(c,a),Gr!==4&&(Gr=2),l0===null?l0=[s]:l0.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var _=eQ(s,c,e);zB(s,_);break e;case 1:a=c;var w=s.type,T=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Gd===null||!Gd.has(T)))){s.flags|=65536,e&=-e,s.lanes|=e;var C=tQ(s,a,e);zB(s,C);break e}}s=s.return}while(s!==null)}bQ(n)}catch(I){e=I,Pr===n&&n!==null&&(Pr=n=n.return);continue}break}while(!0)}function yQ(){var t=qC.current;return qC.current=VC,t===null?VC:t}function R8(){(Gr===0||Gr===3||Gr===2)&&(Gr=4),ai===null||!(rp&268435455)&&!(sR&268435455)||Td(ai,Mi)}function WC(t,e){var n=Ht;Ht|=2;var r=yQ();(ai!==t||Mi!==e)&&(Kl=null,Ah(t,e));do try{VRe();break}catch(i){vQ(t,i)}while(!0);if(l8(),Ht=n,qC.current=r,Pr!==null)throw Error(Ce(261));return ai=null,Mi=0,Gr}function VRe(){for(;Pr!==null;)_Q(Pr)}function qRe(){for(;Pr!==null&&!m2e();)_Q(Pr)}function _Q(t){var e=wQ(t.alternate,t,yo);t.memoizedProps=t.pendingProps,e===null?bQ(t):Pr=e,w8.current=null}function bQ(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=$Re(n,e),n!==null){n.flags&=32767,Pr=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Gr=6,Pr=null;return}}else if(n=URe(n,e,yo),n!==null){Pr=n;return}if(e=e.sibling,e!==null){Pr=e;return}Pr=e=t}while(e!==null);Gr===0&&(Gr=5)}function uh(t,e,n){var r=an,i=va.transition;try{va.transition=null,an=1,GRe(t,e,n,r)}finally{va.transition=i,an=r}return null}function GRe(t,e,n,r){do Em();while(Od!==null);if(Ht&6)throw Error(Ce(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ce(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(k2e(t,s),t===ai&&(Pr=ai=null,Mi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xw||(xw=!0,EQ(xC,function(){return Em(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=va.transition,va.transition=null;var o=an;an=1;var a=Ht;Ht|=4,w8.current=null,BRe(t,n),pQ(n,t),fRe(VM),OC=!!KM,VM=KM=null,t.current=n,jRe(n),v2e(),Ht=a,an=o,va.transition=s}else t.current=n;if(xw&&(xw=!1,Od=t,zC=i),s=t.pendingLanes,s===0&&(Gd=null),b2e(n.stateNode),Qs(t,br()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(GC)throw GC=!1,t=uA,uA=null,t;return zC&1&&t.tag!==0&&Em(),s=t.pendingLanes,s&1?t===dA?u0++:(u0=0,dA=t):u0=0,If(),null}function Em(){if(Od!==null){var t=eZ(zC),e=va.transition,n=an;try{if(va.transition=null,an=16>t?16:t,Od===null)var r=!1;else{if(t=Od,Od=null,zC=0,Ht&6)throw Error(Ce(331));var i=Ht;for(Ht|=4,Ve=t.current;Ve!==null;){var s=Ve,o=s.child;if(Ve.flags&16){var a=s.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(Ve=l;Ve!==null;){var u=Ve;switch(u.tag){case 0:case 11:case 15:c0(8,u,s)}var d=u.child;if(d!==null)d.return=u,Ve=d;else for(;Ve!==null;){u=Ve;var f=u.sibling,p=u.return;if(dQ(u),u===l){Ve=null;break}if(f!==null){f.return=p,Ve=f;break}Ve=p}}}var m=s.alternate;if(m!==null){var v=m.child;if(v!==null){m.child=null;do{var S=v.sibling;v.sibling=null,v=S}while(v!==null)}}Ve=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Ve=o;else e:for(;Ve!==null;){if(s=Ve,s.flags&2048)switch(s.tag){case 0:case 11:case 15:c0(9,s,s.return)}var _=s.sibling;if(_!==null){_.return=s.return,Ve=_;break e}Ve=s.return}}var w=t.current;for(Ve=w;Ve!==null;){o=Ve;var T=o.child;if(o.subtreeFlags&2064&&T!==null)T.return=o,Ve=T;else e:for(o=w;Ve!==null;){if(a=Ve,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:iR(9,a)}}catch(I){dr(a,a.return,I)}if(a===o){Ve=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,Ve=C;break e}Ve=a.return}}if(Ht=i,If(),rl&&typeof rl.onPostCommitFiberRoot=="function")try{rl.onPostCommitFiberRoot(J2,t)}catch{}r=!0}return r}finally{an=n,va.transition=e}}return!1}function pj(t,e,n){e=av(n,e),e=eQ(t,e,1),t=qd(t,e,1),e=ys(),t!==null&&(Cb(t,1,e),Qs(t,e))}function dr(t,e,n){if(t.tag===3)pj(t,t,n);else for(;e!==null;){if(e.tag===3){pj(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Gd===null||!Gd.has(r))){t=av(n,t),t=tQ(e,t,1),e=qd(e,t,1),t=ys(),e!==null&&(Cb(e,1,t),Qs(e,t));break}}e=e.return}}function zRe(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=ys(),t.pingedLanes|=t.suspendedLanes&n,ai===t&&(Mi&n)===n&&(Gr===4||Gr===3&&(Mi&130023424)===Mi&&500>br()-T8?Ah(t,0):E8|=n),Qs(t,e)}function SQ(t,e){e===0&&(t.mode&1?(e=_w,_w<<=1,!(_w&130023424)&&(_w=4194304)):e=1);var n=ys();t=Tu(t,e),t!==null&&(Cb(t,e,n),Qs(t,n))}function WRe(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),SQ(t,n)}function YRe(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Ce(314))}r!==null&&r.delete(e),SQ(t,n)}var wQ;wQ=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Xs.current)Vs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Vs=!1,NRe(t,e,n);Vs=!!(t.flags&131072)}else Vs=!1,zn&&e.flags&1048576&&kZ(e,$C,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;sT(t,e),t=e.pendingProps;var i=rv(e,Qi.current);wm(e,n),i=v8(null,e,r,t,i,n);var s=y8();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zs(r)?(s=!0,NC(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,f8(e),i.updater=rR,e.stateNode=i,i._reactInternals=e,QM(e,r,t,n),e=nA(null,e,r,!0,s,n)):(e.tag=0,zn&&s&&s8(e),as(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(sT(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=XRe(r),t=Va(r,t),i){case 0:e=tA(null,e,r,t,n);break e;case 1:e=ij(null,e,r,t,n);break e;case 11:e=nj(null,e,r,t,n);break e;case 14:e=rj(null,e,r,Va(r.type,t),n);break e}throw Error(Ce(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Va(r,i),tA(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Va(r,i),ij(t,e,r,i,n);case 3:e:{if(sQ(e),t===null)throw Error(Ce(387));r=e.pendingProps,s=e.memoizedState,i=s.element,MZ(t,e),jC(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=av(Error(Ce(423)),e),e=sj(t,e,r,n,i);break e}else if(r!==i){i=av(Error(Ce(424)),e),e=sj(t,e,r,n,i);break e}else for(wo=Vd(e.stateNode.containerInfo.firstChild),ko=e,zn=!0,Za=null,n=PZ(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(iv(),r===i){e=Cu(t,e,n);break e}as(t,e,r,n)}e=e.child}return e;case 5:return AZ(e),t===null&&JM(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,qM(r,i)?o=null:s!==null&&qM(r,s)&&(e.flags|=32),iQ(t,e),as(t,e,o,n),e.child;case 6:return t===null&&JM(e),null;case 13:return oQ(t,e,n);case 4:return h8(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=sv(e,null,r,n):as(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Va(r,i),nj(t,e,r,i,n);case 7:return as(t,e,e.pendingProps,n),e.child;case 8:return as(t,e,e.pendingProps.children,n),e.child;case 12:return as(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,On(FC,r._currentValue),r._currentValue=o,s!==null)if(dc(s.value,o)){if(s.children===i.children&&!Xs.current){e=Cu(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(s.tag===1){c=pu(-1,n&-n),c.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}s.lanes|=n,c=s.alternate,c!==null&&(c.lanes|=n),XM(s.return,n,e),a.lanes|=n;break}c=c.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Ce(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),XM(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}as(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,wm(e,n),i=Ca(i),r=r(i),e.flags|=1,as(t,e,r,n),e.child;case 14:return r=e.type,i=Va(r,e.pendingProps),i=Va(r.type,i),rj(t,e,r,i,n);case 15:return nQ(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Va(r,i),sT(t,e),e.tag=1,Zs(r)?(t=!0,NC(e)):t=!1,wm(e,n),QZ(e,r,i),QM(e,r,i,n),nA(null,e,r,!0,t,n);case 19:return aQ(t,e,n);case 22:return rQ(t,e,n)}throw Error(Ce(156,e.tag))};function EQ(t,e){return JX(t,e)}function JRe(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ha(t,e,n,r){return new JRe(t,e,n,r)}function I8(t){return t=t.prototype,!(!t||!t.isReactComponent)}function XRe(t){if(typeof t=="function")return I8(t)?1:0;if(t!=null){if(t=t.$$typeof,t===z4)return 11;if(t===W4)return 14}return 2}function Wd(t,e){var n=t.alternate;return n===null?(n=ha(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function cT(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")I8(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Kg:return Lh(n.children,i,s,e);case G4:o=8,i|=8;break;case EM:return t=ha(12,n,e,i|2),t.elementType=EM,t.lanes=s,t;case TM:return t=ha(13,n,e,i),t.elementType=TM,t.lanes=s,t;case CM:return t=ha(19,n,e,i),t.elementType=CM,t.lanes=s,t;case AX:return oR(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case OX:o=10;break e;case MX:o=9;break e;case z4:o=11;break e;case W4:o=14;break e;case gd:o=16,r=null;break e}throw Error(Ce(130,t==null?t:typeof t,""))}return e=ha(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Lh(t,e,n,r){return t=ha(7,t,r,e),t.lanes=n,t}function oR(t,e,n,r){return t=ha(22,t,r,e),t.elementType=AX,t.lanes=n,t.stateNode={isHidden:!1},t}function Q3(t,e,n){return t=ha(6,t,null,e),t.lanes=n,t}function eP(t,e,n){return e=ha(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ZRe(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=L3(0),this.expirationTimes=L3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=L3(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function x8(t,e,n,r,i,s,o,a,c){return t=new ZRe(t,e,n,a,c),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ha(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},f8(s),t}function QRe(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hg,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function TQ(t){if(!t)return uf;t=t._reactInternals;e:{if(Rp(t)!==t||t.tag!==1)throw Error(Ce(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ce(171))}if(t.tag===1){var n=t.type;if(Zs(n))return TZ(t,n,e)}return e}function CQ(t,e,n,r,i,s,o,a,c){return t=x8(n,r,!0,t,i,s,o,a,c),t.context=TQ(null),n=t.current,r=ys(),i=zd(n),s=pu(r,i),s.callback=e??null,qd(n,s,i),t.current.lanes=i,Cb(t,i,r),Qs(t,r),t}function aR(t,e,n,r){var i=e.current,s=ys(),o=zd(i);return n=TQ(n),e.context===null?e.context=n:e.pendingContext=n,e=pu(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=qd(i,e,o),t!==null&&(lc(t,i,o,s),nT(t,i,o)),o}function YC(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function gj(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function P8(t,e){gj(t,e),(t=t.alternate)&&gj(t,e)}function eIe(){return null}var kQ=typeof reportError=="function"?reportError:function(t){console.error(t)};function O8(t){this._internalRoot=t}cR.prototype.render=O8.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ce(409));aR(t,e,null,null)};cR.prototype.unmount=O8.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ip(function(){aR(null,t,null,null)}),e[Eu]=null}};function cR(t){this._internalRoot=t}cR.prototype.unstable_scheduleHydration=function(t){if(t){var e=rZ();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ed.length&&e!==0&&e<Ed[n].priority;n++);Ed.splice(n,0,t),n===0&&sZ(t)}};function M8(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function lR(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function mj(){}function tIe(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var l=YC(o);s.call(l)}}var o=CQ(e,r,t,0,null,!1,!1,"",mj);return t._reactRootContainer=o,t[Eu]=o.current,f_(t.nodeType===8?t.parentNode:t),ip(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var l=YC(c);a.call(l)}}var c=x8(t,0,!1,null,null,!1,!1,"",mj);return t._reactRootContainer=c,t[Eu]=c.current,f_(t.nodeType===8?t.parentNode:t),ip(function(){aR(e,c,n,r)}),c}function uR(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var c=YC(o);a.call(c)}}aR(e,o,t,i)}else o=tIe(n,e,t,i,r);return YC(o)}tZ=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=L1(e.pendingLanes);n!==0&&(X4(e,n|1),Qs(e,br()),!(Ht&6)&&(cv=br()+500,If()))}break;case 13:ip(function(){var r=Tu(t,1);if(r!==null){var i=ys();lc(r,t,1,i)}}),P8(t,1)}};Z4=function(t){if(t.tag===13){var e=Tu(t,134217728);if(e!==null){var n=ys();lc(e,t,134217728,n)}P8(t,134217728)}};nZ=function(t){if(t.tag===13){var e=zd(t),n=Tu(t,e);if(n!==null){var r=ys();lc(n,t,e,r)}P8(t,e)}};rZ=function(){return an};iZ=function(t,e){var n=an;try{return an=t,e()}finally{an=n}};DM=function(t,e,n){switch(e){case"input":if(IM(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=eR(r);if(!i)throw Error(Ce(90));DX(r),IM(r,i)}}}break;case"textarea":UX(t,n);break;case"select":e=n.value,e!=null&&ym(t,!!n.multiple,e,!1)}};VX=C8;qX=ip;var nIe={usingClientEntryPoint:!1,Events:[Rb,zg,eR,HX,KX,C8]},Yy={findFiberByHostInstance:_h,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rIe={bundleType:Yy.bundleType,version:Yy.version,rendererPackageName:Yy.rendererPackageName,rendererConfig:Yy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hu.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=WX(t),t===null?null:t.stateNode},findFiberByHostInstance:Yy.findFiberByHostInstance||eIe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pw.isDisabled&&Pw.supportsFiber)try{J2=Pw.inject(rIe),rl=Pw}catch{}}No.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nIe;No.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!M8(e))throw Error(Ce(200));return QRe(t,e,null,n)};No.createRoot=function(t,e){if(!M8(t))throw Error(Ce(299));var n=!1,r="",i=kQ;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=x8(t,1,!1,null,null,n,!1,r,i),t[Eu]=e.current,f_(t.nodeType===8?t.parentNode:t),new O8(e)};No.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ce(188)):(t=Object.keys(t).join(","),Error(Ce(268,t)));return t=WX(e),t=t===null?null:t.stateNode,t};No.flushSync=function(t){return ip(t)};No.hydrate=function(t,e,n){if(!lR(e))throw Error(Ce(200));return uR(null,t,e,!0,n)};No.hydrateRoot=function(t,e,n){if(!M8(t))throw Error(Ce(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=kQ;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=CQ(e,null,t,1,n??null,i,!1,s,o),t[Eu]=e.current,f_(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new cR(e)};No.render=function(t,e,n){if(!lR(e))throw Error(Ce(200));return uR(null,t,e,!1,n)};No.unmountComponentAtNode=function(t){if(!lR(t))throw Error(Ce(40));return t._reactRootContainer?(ip(function(){uR(null,null,t,!1,function(){t._reactRootContainer=null,t[Eu]=null})}),!0):!1};No.unstable_batchedUpdates=C8;No.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!lR(n))throw Error(Ce(200));if(t==null||t._reactInternals===void 0)throw Error(Ce(38));return uR(t,e,n,!1,r)};No.version="18.3.1-next-f1338f8080-20240426";function RQ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(RQ)}catch(t){console.error(t)}}RQ(),RX.exports=No;var Ip=RX.exports;const IQ=es(Ip);var xQ,vj=Ip;xQ=vj.createRoot,vj.hydrateRoot;function lv(){return lv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},lv.apply(this,arguments)}function Ow(t){return t.charAt(0)==="/"}function tP(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function iIe(t,e){e===void 0&&(e="");var n=t&&t.split("/")||[],r=e&&e.split("/")||[],i=t&&Ow(t),s=e&&Ow(e),o=i||s;if(t&&Ow(t)?r=n:n.length&&(r.pop(),r=r.concat(n)),!r.length)return"/";var a;if(r.length){var c=r[r.length-1];a=c==="."||c===".."||c===""}else a=!1;for(var l=0,u=r.length;u>=0;u--){var d=r[u];d==="."?tP(r,u):d===".."?(tP(r,u),l++):l&&(tP(r,u),l--)}if(!o)for(;l--;l)r.unshift("..");o&&r[0]!==""&&(!r[0]||!Ow(r[0]))&&r.unshift("");var f=r.join("/");return a&&f.substr(-1)!=="/"&&(f+="/"),f}var sIe="Invariant failed";function xp(t,e){throw new Error(sIe)}function d0(t){return t.charAt(0)==="/"?t:"/"+t}function yj(t){return t.charAt(0)==="/"?t.substr(1):t}function oIe(t,e){return t.toLowerCase().indexOf(e.toLowerCase())===0&&"/?#".indexOf(t.charAt(e.length))!==-1}function PQ(t,e){return oIe(t,e)?t.substr(e.length):t}function OQ(t){return t.charAt(t.length-1)==="/"?t.slice(0,-1):t}function aIe(t){var e=t||"/",n="",r="",i=e.indexOf("#");i!==-1&&(r=e.substr(i),e=e.substr(0,i));var s=e.indexOf("?");return s!==-1&&(n=e.substr(s),e=e.substr(0,s)),{pathname:e,search:n==="?"?"":n,hash:r==="#"?"":r}}function cs(t){var e=t.pathname,n=t.search,r=t.hash,i=e||"/";return n&&n!=="?"&&(i+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(i+=r.charAt(0)==="#"?r:"#"+r),i}function Eo(t,e,n,r){var i;typeof t=="string"?(i=aIe(t),i.state=e):(i=lv({},t),i.pathname===void 0&&(i.pathname=""),i.search?i.search.charAt(0)!=="?"&&(i.search="?"+i.search):i.search="",i.hash?i.hash.charAt(0)!=="#"&&(i.hash="#"+i.hash):i.hash="",e!==void 0&&i.state===void 0&&(i.state=e));try{i.pathname=decodeURI(i.pathname)}catch(s){throw s instanceof URIError?new URIError('Pathname "'+i.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):s}return n&&(i.key=n),r?i.pathname?i.pathname.charAt(0)!=="/"&&(i.pathname=iIe(i.pathname,r.pathname)):i.pathname=r.pathname:i.pathname||(i.pathname="/"),i}function A8(){var t=null;function e(o){return t=o,function(){t===o&&(t=null)}}function n(o,a,c,l){if(t!=null){var u=typeof t=="function"?t(o,a):t;typeof u=="string"?typeof c=="function"?c(u,l):l(!0):l(u!==!1)}else l(!0)}var r=[];function i(o){var a=!0;function c(){a&&o.apply(void 0,arguments)}return r.push(c),function(){a=!1,r=r.filter(function(l){return l!==c})}}function s(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];r.forEach(function(l){return l.apply(void 0,a)})}return{setPrompt:e,confirmTransitionTo:n,appendListener:i,notifyListeners:s}}var MQ=!!(typeof window<"u"&&window.document&&window.document.createElement);function AQ(t,e){e(window.confirm(t))}function cIe(){var t=window.navigator.userAgent;return(t.indexOf("Android 2.")!==-1||t.indexOf("Android 4.0")!==-1)&&t.indexOf("Mobile Safari")!==-1&&t.indexOf("Chrome")===-1&&t.indexOf("Windows Phone")===-1?!1:window.history&&"pushState"in window.history}function lIe(){return window.navigator.userAgent.indexOf("Trident")===-1}function uIe(){return window.navigator.userAgent.indexOf("Firefox")===-1}function dIe(t){return t.state===void 0&&navigator.userAgent.indexOf("CriOS")===-1}var _j="popstate",bj="hashchange";function Sj(){try{return window.history.state||{}}catch{return{}}}function LQ(t){t===void 0&&(t={}),MQ||xp();var e=window.history,n=cIe(),r=!lIe(),i=t,s=i.forceRefresh,o=s===void 0?!1:s,a=i.getUserConfirmation,c=a===void 0?AQ:a,l=i.keyLength,u=l===void 0?6:l,d=t.basename?OQ(d0(t.basename)):"";function f(W){var Y=W||{},ce=Y.key,ue=Y.state,Te=window.location,Re=Te.pathname,Oe=Te.search,De=Te.hash,ze=Re+Oe+De;return d&&(ze=PQ(ze,d)),Eo(ze,ue,ce)}function p(){return Math.random().toString(36).substr(2,u)}var m=A8();function v(W){lv(K,W),K.length=e.length,m.notifyListeners(K.location,K.action)}function S(W){dIe(W)||T(f(W.state))}function _(){T(f(Sj()))}var w=!1;function T(W){if(w)w=!1,v();else{var Y="POP";m.confirmTransitionTo(W,Y,c,function(ce){ce?v({action:Y,location:W}):C(W)})}}function C(W){var Y=K.location,ce=R.indexOf(Y.key);ce===-1&&(ce=0);var ue=R.indexOf(W.key);ue===-1&&(ue=0);var Te=ce-ue;Te&&(w=!0,N(Te))}var I=f(Sj()),R=[I.key];function O(W){return d+cs(W)}function A(W,Y){var ce="PUSH",ue=Eo(W,Y,p(),K.location);m.confirmTransitionTo(ue,ce,c,function(Te){if(Te){var Re=O(ue),Oe=ue.key,De=ue.state;if(n)if(e.pushState({key:Oe,state:De},null,Re),o)window.location.href=Re;else{var ze=R.indexOf(K.location.key),et=R.slice(0,ze+1);et.push(ue.key),R=et,v({action:ce,location:ue})}else window.location.href=Re}})}function U(W,Y){var ce="REPLACE",ue=Eo(W,Y,p(),K.location);m.confirmTransitionTo(ue,ce,c,function(Te){if(Te){var Re=O(ue),Oe=ue.key,De=ue.state;if(n)if(e.replaceState({key:Oe,state:De},null,Re),o)window.location.replace(Re);else{var ze=R.indexOf(K.location.key);ze!==-1&&(R[ze]=ue.key),v({action:ce,location:ue})}else window.location.replace(Re)}})}function N(W){e.go(W)}function L(){N(-1)}function j(){N(1)}var X=0;function G(W){X+=W,X===1&&W===1?(window.addEventListener(_j,S),r&&window.addEventListener(bj,_)):X===0&&(window.removeEventListener(_j,S),r&&window.removeEventListener(bj,_))}var F=!1;function V(W){W===void 0&&(W=!1);var Y=m.setPrompt(W);return F||(G(1),F=!0),function(){return F&&(F=!1,G(-1)),Y()}}function J(W){var Y=m.appendListener(W);return G(1),function(){G(-1),Y()}}var K={length:e.length,action:"POP",location:I,createHref:O,push:A,replace:U,go:N,goBack:L,goForward:j,block:V,listen:J};return K}var wj="hashchange",fIe={hashbang:{encodePath:function(e){return e.charAt(0)==="!"?e:"!/"+yj(e)},decodePath:function(e){return e.charAt(0)==="!"?e.substr(1):e}},noslash:{encodePath:yj,decodePath:d0},slash:{encodePath:d0,decodePath:d0}};function DQ(t){var e=t.indexOf("#");return e===-1?t:t.slice(0,e)}function Jy(){var t=window.location.href,e=t.indexOf("#");return e===-1?"":t.substring(e+1)}function hIe(t){window.location.hash=t}function nP(t){window.location.replace(DQ(window.location.href)+"#"+t)}function pIe(t){t===void 0&&(t={}),MQ||xp();var e=window.history;uIe();var n=t,r=n.getUserConfirmation,i=r===void 0?AQ:r,s=n.hashType,o=s===void 0?"slash":s,a=t.basename?OQ(d0(t.basename)):"",c=fIe[o],l=c.encodePath,u=c.decodePath;function d(){var Y=u(Jy());return a&&(Y=PQ(Y,a)),Eo(Y)}var f=A8();function p(Y){lv(W,Y),W.length=e.length,f.notifyListeners(W.location,W.action)}var m=!1,v=null;function S(Y,ce){return Y.pathname===ce.pathname&&Y.search===ce.search&&Y.hash===ce.hash}function _(){var Y=Jy(),ce=l(Y);if(Y!==ce)nP(ce);else{var ue=d(),Te=W.location;if(!m&&S(Te,ue)||v===cs(ue))return;v=null,w(ue)}}function w(Y){if(m)m=!1,p();else{var ce="POP";f.confirmTransitionTo(Y,ce,i,function(ue){ue?p({action:ce,location:Y}):T(Y)})}}function T(Y){var ce=W.location,ue=O.lastIndexOf(cs(ce));ue===-1&&(ue=0);var Te=O.lastIndexOf(cs(Y));Te===-1&&(Te=0);var Re=ue-Te;Re&&(m=!0,L(Re))}var C=Jy(),I=l(C);C!==I&&nP(I);var R=d(),O=[cs(R)];function A(Y){var ce=document.querySelector("base"),ue="";return ce&&ce.getAttribute("href")&&(ue=DQ(window.location.href)),ue+"#"+l(a+cs(Y))}function U(Y,ce){var ue="PUSH",Te=Eo(Y,void 0,void 0,W.location);f.confirmTransitionTo(Te,ue,i,function(Re){if(Re){var Oe=cs(Te),De=l(a+Oe),ze=Jy()!==De;if(ze){v=Oe,hIe(De);var et=O.lastIndexOf(cs(W.location)),lt=O.slice(0,et+1);lt.push(Oe),O=lt,p({action:ue,location:Te})}else p()}})}function N(Y,ce){var ue="REPLACE",Te=Eo(Y,void 0,void 0,W.location);f.confirmTransitionTo(Te,ue,i,function(Re){if(Re){var Oe=cs(Te),De=l(a+Oe),ze=Jy()!==De;ze&&(v=Oe,nP(De));var et=O.indexOf(cs(W.location));et!==-1&&(O[et]=Oe),p({action:ue,location:Te})}})}function L(Y){e.go(Y)}function j(){L(-1)}function X(){L(1)}var G=0;function F(Y){G+=Y,G===1&&Y===1?window.addEventListener(wj,_):G===0&&window.removeEventListener(wj,_)}var V=!1;function J(Y){Y===void 0&&(Y=!1);var ce=f.setPrompt(Y);return V||(F(1),V=!0),function(){return V&&(V=!1,F(-1)),ce()}}function K(Y){var ce=f.appendListener(Y);return F(1),function(){F(-1),ce()}}var W={length:e.length,action:"POP",location:R,createHref:A,push:U,replace:N,go:L,goBack:j,goForward:X,block:J,listen:K};return W}function Ej(t,e,n){return Math.min(Math.max(t,e),n)}function gIe(t){t===void 0&&(t={});var e=t,n=e.getUserConfirmation,r=e.initialEntries,i=r===void 0?["/"]:r,s=e.initialIndex,o=s===void 0?0:s,a=e.keyLength,c=a===void 0?6:a,l=A8();function u(A){lv(O,A),O.length=O.entries.length,l.notifyListeners(O.location,O.action)}function d(){return Math.random().toString(36).substr(2,c)}var f=Ej(o,0,i.length-1),p=i.map(function(A){return typeof A=="string"?Eo(A,void 0,d()):Eo(A,void 0,A.key||d())}),m=cs;function v(A,U){var N="PUSH",L=Eo(A,U,d(),O.location);l.confirmTransitionTo(L,N,n,function(j){if(j){var X=O.index,G=X+1,F=O.entries.slice(0);F.length>G?F.splice(G,F.length-G,L):F.push(L),u({action:N,location:L,index:G,entries:F})}})}function S(A,U){var N="REPLACE",L=Eo(A,U,d(),O.location);l.confirmTransitionTo(L,N,n,function(j){j&&(O.entries[O.index]=L,u({action:N,location:L}))})}function _(A){var U=Ej(O.index+A,0,O.entries.length-1),N="POP",L=O.entries[U];l.confirmTransitionTo(L,N,n,function(j){j?u({action:N,location:L,index:U}):u()})}function w(){_(-1)}function T(){_(1)}function C(A){var U=O.index+A;return U>=0&&U<O.entries.length}function I(A){return A===void 0&&(A=!1),l.setPrompt(A)}function R(A){return l.appendListener(A)}var O={length:p.length,action:"POP",location:p[f],index:f,entries:p,createHref:m,push:v,replace:S,go:_,goBack:w,goForward:T,canGo:C,block:I,listen:R};return O}var Tj={};function mIe(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function hr(t,e){if(!t)throw new Error(e)}const vIe=34028234663852886e22,yIe=-34028234663852886e22,_Ie=4294967295,bIe=2147483647,SIe=-2147483648;function lT(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>bIe||t<SIe)throw new Error("invalid int 32: "+t)}function pA(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>_Ie||t<0)throw new Error("invalid uint 32: "+t)}function NQ(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>vIe||t<yIe))throw new Error("invalid float 32: "+t)}const UQ=Symbol("@bufbuild/protobuf/enum-type");function wIe(t){const e=t[UQ];return hr(e,"missing enum type on enum object"),e}function $Q(t,e,n,r){t[UQ]=FQ(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function FQ(t,e,n){const r=Object.create(null),i=Object.create(null),s=[];for(const o of e){const a=BQ(o);s.push(a),r[o.name]=a,i[o.no]=a}return{typeName:t,values:s,findName(o){return r[o]},findNumber(o){return i[o]}}}function EIe(t,e,n){const r={};for(const i of e){const s=BQ(i);r[s.localName]=s.no,r[s.no]=s.localName}return $Q(r,t,e),r}function BQ(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}let L8=class{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(n);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(n);return i.readMessage(r,e,s,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}};function TIe(t,e,n,r){var i;const s=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new L8),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function CIe(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,!(i&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function rP(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const r=t>>>28&15|(e&7)<<4,i=!!(e>>3);if(n.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const uT=4294967296;function Cj(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function s(o,a){const c=Number(t.slice(o,a));i*=n,r=r*n+c,r>=uT&&(i=i+(r/uT|0),r=r%uT)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?HQ(r,i):D8(r,i)}function kIe(t,e){let n=D8(t,e);const r=n.hi&2147483648;r&&(n=HQ(n.lo,n.hi));const i=jQ(n.lo,n.hi);return r?"-"+i:i}function jQ(t,e){if({lo:t,hi:e}=RIe(t,e),e<=2097151)return String(uT*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let s=n+r*6777216+i*6710656,o=r+i*8147497,a=i*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+kj(o)+kj(s)}function RIe(t,e){return{lo:t>>>0,hi:e>>>0}}function D8(t,e){return{lo:t|0,hi:e|0}}function HQ(t,e){return e=~e,t?t=~t+1:e+=1,D8(t,e)}const kj=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Rj(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function IIe(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function xIe(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Tj!="object"||Tj.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=i=>hr(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>hr(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),n(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),n(i),Cj(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),Cj(i)},dec(i,s){return kIe(i,s)},uDec(i,s){return jQ(i,s)}}}const Yn=xIe();var Se;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(Se||(Se={}));var df;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(df||(df={}));function id(t,e,n){if(e===n)return!0;if(t==Se.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return e==n}return!1}function uv(t,e){switch(t){case Se.BOOL:return!1;case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return e==0?Yn.zero:"0";case Se.DOUBLE:case Se.FLOAT:return 0;case Se.BYTES:return new Uint8Array(0);case Se.STRING:return"";default:return 0}}function KQ(t,e){switch(t){case Se.BOOL:return e===!1;case Se.STRING:return e==="";case Se.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Sr;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Sr||(Sr={}));class PIe{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(pA(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return lT(e),Rj(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){NQ(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){pA(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){lT(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return lT(e),e=(e<<1^e>>31)>>>0,Rj(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=Yn.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=Yn.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=Yn.enc(e);return rP(n.lo,n.hi,this.buf),this}sint64(e){let n=Yn.enc(e),r=n.hi>>31,i=n.lo<<1^r,s=(n.hi<<1|n.lo>>>31)^r;return rP(i,s,this.buf),this}uint64(e){let n=Yn.uEnc(e);return rP(n.lo,n.hi,this.buf),this}}class OIe{constructor(e,n){this.varint64=CIe,this.uint32=IIe,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case Sr.Varint:for(;this.buf[this.pos++]&128;);break;case Sr.Bit64:this.pos+=4;case Sr.Bit32:this.pos+=4;break;case Sr.LengthDelimited:let i=this.uint32();this.pos+=i;break;case Sr.StartGroup:for(;;){const[s,o]=this.tag();if(o===Sr.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Yn.dec(...this.varint64())}uint64(){return Yn.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,Yn.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Yn.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Yn.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function MIe(t,e,n,r){let i;return{typeName:e,extendee:n,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=t.util.newFieldList([s]).list()[0]}return i},runtime:t}}function VQ(t){const e=t.field.localName,n=Object.create(null);return n[e]=AIe(t),[n,()=>n[e]]}function AIe(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return uv(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function LIe(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let nu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),dR=[];for(let t=0;t<nu.length;t++)dR[nu[t].charCodeAt(0)]=t;dR[45]=nu.indexOf("+");dR[95]=nu.indexOf("/");const qQ={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,s,o=0;for(let a=0;a<t.length;a++){if(s=dR[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=s,i=1;break;case 1:n[r++]=o<<2|(s&48)>>4,o=s,i=2;break;case 2:n[r++]=(o&15)<<4|(s&60)>>2,o=s,i=3;break;case 3:n[r++]=(o&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let s=0;s<t.length;s++)switch(r=t[s],n){case 0:e+=nu[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=nu[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=nu[i|r>>6],e+=nu[r&63],n=0;break}return n&&(e+=nu[i],e+="=",n==1&&(e+="=")),e}};function DIe(t,e,n){zQ(e,t);const r=e.runtime.bin.makeReadOptions(n),i=LIe(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=VQ(e);for(const a of i)e.runtime.bin.readField(s,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function NIe(t,e,n,r){zQ(e,t);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(GQ(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of l)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=i.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),d=c.skip(u,l);t.getType().runtime.bin.onUnknownField(t,l,u,d)}}function GQ(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(r=>r.no==e.field.no)}function zQ(t,e){hr(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function WQ(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!KQ(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Ij(t,e){const n=t.localName,r=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=r?t.T.values[0].no:void 0;break;case"scalar":e[n]=r?uv(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Dh(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(L8.prototype).every(r=>r in t&&typeof t[r]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function YQ(t,e){return Dh(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}Se.DOUBLE,Se.FLOAT,Se.INT64,Se.UINT64,Se.INT32,Se.UINT32,Se.BOOL,Se.STRING,Se.BYTES;const xj={ignoreUnknownFields:!1},Pj={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function UIe(t){return t?Object.assign(Object.assign({},xj),t):xj}function $Ie(t){return t?Object.assign(Object.assign({},Pj),t):Pj}const JC=Symbol(),dT=Symbol();function FIe(){return{makeReadOptions:UIe,makeWriteOptions:$Ie,readMessage(t,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Fc(e)));r=r??new t;const i=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=i.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));i.set(c.oneof,o)}Oj(r,a,c,n,t)}else{let l=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){l=!0;const[d,f]=VQ(u);Oj(d,a,u.field,n,u),NIe(r,u,f(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(t,e){const n=t.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!WQ(i,t)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!jIe(i))continue}const o=i.oneof?t[i.oneof.localName].value:t[i.localName],a=Mj(i,o,e);a!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&GQ(t,a)){const c=DIe(t,a,e),l=Mj(a.field,c,e);l!==void 0&&(r[a.field.jsonName]=l)}}}catch(s){const o=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return r},readScalar(t,e,n){return f0(t,e,n??df.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||KQ(t,e)))return fT(t,e)},debug:Fc}}function Fc(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Oj(t,e,n,r,i){let s=n.localName;if(n.repeated){if(hr(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,r));break;case"enum":const c=iP(n.T,a,r.ignoreUnknownFields,!0);c!==dT&&o.push(c);break;case"scalar":try{o.push(f0(n.T,a,n.L,!0))}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(a));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=BIe(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,r);break;case"enum":const u=iP(n.V.T,c,r.ignoreUnknownFields,!0);u!==dT&&(o[l]=u);break;case"scalar":try{o[l]=f0(n.V.T,c,df.BIGINT,!0)}catch(d){let f="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];Dh(a)?a.fromJson(e,r):(t[s]=a=o.fromJson(e,r),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=iP(n.T,e,r.ignoreUnknownFields,!1);switch(c){case JC:Ij(n,t);break;case dT:break;default:t[s]=c;break}break;case"scalar":try{const l=f0(n.T,e,n.L,!1);switch(l){case JC:Ij(n,t);break;default:t[s]=l;break}}catch(l){let u="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(Fc(e));throw l instanceof Error&&l.message.length>0&&(u+=": ".concat(l.message)),new Error(u)}break}}function BIe(t,e){if(t===Se.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return f0(t,e,df.BIGINT,!0).toString()}function f0(t,e,n,r){if(e===null)return r?uv(t,n):JC;switch(t){case Se.DOUBLE:case Se.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return t==Se.FLOAT&&NQ(i),i;case Se.INT32:case Se.FIXED32:case Se.SFIXED32:case Se.SINT32:case Se.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==Se.UINT32||t==Se.FIXED32?pA(s):lT(s),s;case Se.INT64:case Se.SFIXED64:case Se.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Yn.parse(e);return n?o.toString():o;case Se.FIXED64:case Se.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=Yn.uParse(e);return n?a.toString():a;case Se.BOOL:if(typeof e!="boolean")break;return e;case Se.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Se.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return qQ.dec(e)}throw new Error}function iP(t,e,n,r){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:r?t.values[0].no:JC;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=t.findName(e);if(i!==void 0)return i.no;if(n)return dT;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Fc(e)))}function jIe(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Mj(t,e,n){if(t.kind=="map"){hr(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of i)r[o.toString()]=fT(t.V.T,a);break;case"message":for(const[o,a]of i)r[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of i)r[o.toString()]=sP(s,a,n.enumAsInteger);break}return n.emitDefaultValues||i.length>0?r:void 0}if(t.repeated){hr(Array.isArray(e));const r=[];switch(t.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(fT(t.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(sP(t.T,e[i],n.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(t.kind){case"scalar":return fT(t.T,e);case"enum":return sP(t.T,e,n.enumAsInteger);case"message":return YQ(t.T,e).toJson(n)}}function sP(t,e,n){var r;if(hr(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const i=t.findNumber(e);return(r=i==null?void 0:i.name)!==null&&r!==void 0?r:e}function fT(t,e){switch(t){case Se.INT32:case Se.SFIXED32:case Se.SINT32:case Se.FIXED32:case Se.UINT32:return hr(typeof e=="number"),e;case Se.FLOAT:case Se.DOUBLE:return hr(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Se.STRING:return hr(typeof e=="string"),e;case Se.BOOL:return hr(typeof e=="boolean"),e;case Se.UINT64:case Se.FIXED64:case Se.INT64:case Se.SFIXED64:case Se.SINT64:return hr(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Se.BYTES:return hr(e instanceof Uint8Array),qQ.enc(e)}}const fg=Symbol("@bufbuild/protobuf/unknown-fields"),Aj={readUnknownFields:!0,readerFactory:t=>new OIe(t)},Lj={writeUnknownFields:!0,writerFactory:()=>new PIe};function HIe(t){return t?Object.assign(Object.assign({},Aj),t):Aj}function KIe(t){return t?Object.assign(Object.assign({},Lj),t):Lj}function VIe(){return{makeReadOptions:HIe,makeWriteOptions:KIe,listUnknownFields(t){var e;return(e=t[fg])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[fg]},writeUnknownFields(t,e){const r=t[fg];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[fg])||(i[fg]=[]),i[fg].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r,i){const s=t.getType(),o=i?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(i===!0&&c==Sr.EndGroup));){const l=s.fields.find(a);if(!l){const u=e.skip(c,a);r.readUnknownFields&&this.onUnknownField(t,a,c,u);continue}Dj(t,e,l,c,r)}if(i&&(c!=Sr.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:Dj,writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){if(!WQ(i,t)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?t[i.oneof.localName].value:t[i.localName];Nj(i,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,r){e!==void 0&&Nj(t,e,n,r)}}}function Dj(t,e,n,r,i){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?Se.INT32:n.T;let c=XC;if(n.kind=="scalar"&&n.L>0&&(c=GIe),s){let f=t[o];if(r==Sr.LengthDelimited&&a!=Se.STRING&&a!=Se.BYTES){let m=e.uint32()+e.pos;for(;e.pos<m;)f.push(c(e,a))}else f.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(hT(e,new l,i,n)):Dh(t[o])?hT(e,t[o],i,n):(t[o]=hT(e,new l,i,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=qIe(n,e,i);t[o][u]=d;break}}function hT(t,e,n,r){const i=e.getType().runtime.bin,s=r==null?void 0:r.delimited;return i.readMessage(e,t,s?r.no:t.uint32(),n,s),e}function qIe(t,e,n){const r=e.uint32(),i=e.pos+r;let s,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:s=XC(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=XC(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=hT(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=uv(t.K,df.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=uv(t.V.T,df.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function GIe(t,e){const n=XC(t,e);return typeof n=="bigint"?n.toString():n}function XC(t,e){switch(e){case Se.STRING:return t.string();case Se.BOOL:return t.bool();case Se.DOUBLE:return t.double();case Se.FLOAT:return t.float();case Se.INT32:return t.int32();case Se.INT64:return t.int64();case Se.UINT64:return t.uint64();case Se.FIXED64:return t.fixed64();case Se.BYTES:return t.bytes();case Se.FIXED32:return t.fixed32();case Se.SFIXED32:return t.sfixed32();case Se.SFIXED64:return t.sfixed64();case Se.SINT64:return t.sint64();case Se.UINT32:return t.uint32();case Se.SINT32:return t.sint32()}}function Nj(t,e,n,r){hr(e!==void 0);const i=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?Se.INT32:t.T;if(i)if(hr(Array.isArray(e)),t.packed)WIe(n,s,t.no,e);else for(const o of e)h0(n,s,t.no,o);else h0(n,s,t.no,e);break;case"message":if(i){hr(Array.isArray(e));for(const o of e)Uj(n,r,t,o)}else Uj(n,r,t,e);break;case"map":hr(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))zIe(n,r,t,o,a);break}}function zIe(t,e,n,r,i){t.tag(n.no,Sr.LengthDelimited),t.fork();let s=r;switch(n.K){case Se.INT32:case Se.FIXED32:case Se.UINT32:case Se.SFIXED32:case Se.SINT32:s=Number.parseInt(r);break;case Se.BOOL:hr(r=="true"||r=="false"),s=r=="true";break}switch(h0(t,n.K,1,s),n.V.kind){case"scalar":h0(t,n.V.T,2,i);break;case"enum":h0(t,Se.INT32,2,i);break;case"message":hr(i!==void 0),t.tag(2,Sr.LengthDelimited).bytes(i.toBinary(e));break}t.join()}function Uj(t,e,n,r){const i=YQ(n.T,r);n.delimited?t.tag(n.no,Sr.StartGroup).raw(i.toBinary(e)).tag(n.no,Sr.EndGroup):t.tag(n.no,Sr.LengthDelimited).bytes(i.toBinary(e))}function h0(t,e,n,r){hr(r!==void 0);let[i,s]=JQ(e);t.tag(n,i)[s](r)}function WIe(t,e,n,r){if(!r.length)return;t.tag(n,Sr.LengthDelimited).fork();let[,i]=JQ(e);for(let s=0;s<r.length;s++)t[i](r[s]);t.join()}function JQ(t){let e=Sr.Varint;switch(t){case Se.BYTES:case Se.STRING:e=Sr.LengthDelimited;break;case Se.DOUBLE:case Se.FIXED64:case Se.SFIXED64:e=Sr.Bit64;break;case Se.FIXED32:case Se.SFIXED32:case Se.FLOAT:e=Sr.Bit32;break}const n=Se[t].toLowerCase();return[e,n]}function YIe(){return{setEnumType:$Q,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,s=e,o=t;if(o[i]!=null)switch(r.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const c=r.findField(a);let l=o[i].value;c&&c.kind=="message"&&!Dh(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===Se.BYTES&&(l=Xy(l)),s[i]={case:a,value:l};break;case"scalar":case"enum":let u=o[i];r.T===Se.BYTES&&(u=r.repeated?u.map(Xy):Xy(u)),s[i]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===Se.BYTES)for(const[p,m]of Object.entries(o[i]))s[i][p]=Xy(m);else Object.assign(s[i],o[i]);break;case"message":const f=r.V.T;for(const p of Object.keys(o[i])){let m=o[i][p];f.fieldWrapper||(m=new f(m)),s[i][p]=m}break}break;case"message":const d=r.T;if(r.repeated)s[i]=o[i].map(f=>Dh(f,d)?f:new d(f));else{const f=o[i];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[i]=Xy(f):s[i]=f:s[i]=Dh(f,d)?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],s=n[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((o,a)=>r.T.equals(o,s[a]));case"scalar":return i.every((o,a)=>id(r.T,o,s[a]));case"enum":return i.every((o,a)=>id(Se.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(i,s);case"enum":return id(Se.INT32,i,s);case"scalar":return id(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const o=r.findField(i.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(i.value,s.value);case"enum":return id(Se.INT32,i.value,s.value);case"scalar":return id(o.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(o.kind));case"map":const a=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const c=r.V.T;return a.every(u=>c.equals(i[u],s[u]));case"enum":return a.every(u=>id(Se.INT32,i[u],s[u]));case"scalar":const l=r.V.T;return a.every(u=>id(l,i[u],s[u]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const s=t[i.localName];let o;if(i.repeated)o=s.map(Mw);else if(i.kind=="map"){o=r[i.localName];for(const[a,c]of Object.entries(s))o[a]=Mw(c)}else i.kind=="oneof"?o=i.findField(s.case)?{case:s.case,value:Mw(s.value)}:{case:void 0}:o=Mw(s);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return n}}}function Mw(t){if(t===void 0)return t;if(Dh(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Xy(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function JIe(t,e,n){return{syntax:t,json:FIe(),bin:VIe(),util:Object.assign(Object.assign({},YIe()),{newFieldList:e,initFields:n}),makeMessageType(r,i,s){return TIe(this,r,i,s)},makeEnum:EIe,makeEnumType:FQ,getEnumType:wIe,makeExtension(r,i,s){return MIe(this,r,i,s)}}}class XIe{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function XQ(t,e){const n=ZQ(t);return e?n:rxe(nxe(n))}function ZIe(t){return XQ(t,!1)}const QIe=ZQ;function ZQ(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const exe=new Set(["constructor","toString","toJSON","valueOf"]),txe=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),QQ=t=>"".concat(t,"$"),nxe=t=>txe.has(t)?QQ(t):t,rxe=t=>exe.has(t)?QQ(t):t;class ixe{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=ZIe(e)}addField(e){hr(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function sxe(t,e){var n,r,i,s,o,a;const c=[];let l;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=XQ(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:QIe(u.name),d.repeated=(r=u.repeated)!==null&&r!==void 0?r:!1,u.kind=="scalar"&&(d.L=(i=u.L)!==null&&i!==void 0?i:df.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=Se.BYTES&&u.T!=Se.STRING),u.oneof!==void 0){const f=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=f)&&(l=new ixe(f)),d.oneof=l,l.addField(d)}c.push(d)}return c}const me=JIe("proto3",t=>new XIe(t,e=>sxe(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=uv(e.T,e.L);break}}});class js extends L8{constructor(e){super(),this.seconds=Yn.zero,this.nanos=0,me.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(me.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Yn.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return js.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new js({seconds:Yn.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new js().fromBinary(e,n)}static fromJson(e,n){return new js().fromJson(e,n)}static fromJsonString(e,n){return new js().fromJsonString(e,n)}static equals(e,n){return me.util.equals(js,e,n)}}js.runtime=me;js.typeName="google.protobuf.Timestamp";js.fields=me.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const oxe=me.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:js},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:axe,repeated:!0},{no:5,name:"events",kind:"message",T:lxe,repeated:!0}]),axe=me.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:cxe,repeated:!0}]),cxe=me.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:js},{no:3,name:"value",kind:"scalar",T:2}]),lxe=me.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:js},{no:7,name:"normalized_end_timestamp",kind:"message",T:js,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9}]),tc=me.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),zi=me.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),N8=me.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),N1=me.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),S_=me.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),Tm=me.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"}]),hg=me.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),uxe=me.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Kc=me.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"}]),U8=me.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:ZC,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:oee}]),ZC=me.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),dxe=me.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:me.getEnumType(zi),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),w_=me.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:me.getEnumType(gA)},{no:4,name:"tracks",kind:"message",T:em,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:dxe},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:me.getEnumType(QC)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:me.getEnumType(Tm)}]),gA=me.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),QC=me.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),ra=me.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),fxe=me.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Nh,repeated:!0}]),em=me.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:me.getEnumType(tc)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:me.getEnumType(zi)},{no:10,name:"layers",kind:"message",T:Nh,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:fxe,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:me.getEnumType(ra)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:oee},{no:19,name:"audio_features",kind:"enum",T:me.getEnumType(Kc),repeated:!0}]),Nh=me.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:me.getEnumType(N8)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]),pT=me.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:me.getEnumType(vi)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:tee,oneof:"value"},{no:3,name:"speaker",kind:"message",T:hxe,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:pxe,oneof:"value"},{no:7,name:"transcription",kind:"message",T:gxe,oneof:"value"},{no:8,name:"metrics",kind:"message",T:oxe,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:mA,oneof:"value"}]),vi=me.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),hxe=me.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:eee,repeated:!0}]),eee=me.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),tee=me.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0}]),pxe=me.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),gxe=me.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:mxe,repeated:!0}]),mxe=me.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),mA=me.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),nee=me.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),vxe=me.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:me.getEnumType(ree)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),ree=me.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),yxe=me.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:me.getEnumType(iee)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]),iee=me.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"}]),see=me.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:$j},{no:2,name:"screen",kind:"message",T:$j},{no:3,name:"resume_connection",kind:"enum",T:me.getEnumType(S_)},{no:4,name:"disabled_codecs",kind:"message",T:_xe},{no:5,name:"force_relay",kind:"enum",T:me.getEnumType(S_)}]),$j=me.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:me.getEnumType(S_)}]),_xe=me.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:ZC,repeated:!0},{no:2,name:"publish",kind:"message",T:ZC,repeated:!0}]),oee=me.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),nc=me.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),vA=me.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),bxe=me.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),Sxe=me.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:sp,oneof:"message"},{no:2,name:"answer",kind:"message",T:sp,oneof:"message"},{no:3,name:"trickle",kind:"message",T:$8,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_A,oneof:"message"},{no:5,name:"mute",kind:"message",T:F8,oneof:"message"},{no:6,name:"subscription",kind:"message",T:fR,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:aee,oneof:"message"},{no:8,name:"leave",kind:"message",T:hR,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:lee,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:hee,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:pee,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Pc,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:uee,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:mee,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:cee,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:kxe,oneof:"message"}]),Fj=me.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:wxe,oneof:"message"},{no:2,name:"answer",kind:"message",T:sp,oneof:"message"},{no:3,name:"offer",kind:"message",T:sp,oneof:"message"},{no:4,name:"trickle",kind:"message",T:$8,oneof:"message"},{no:5,name:"update",kind:"message",T:Cxe,oneof:"message"},{no:6,name:"track_published",kind:"message",T:B8,oneof:"message"},{no:8,name:"leave",kind:"message",T:hR,oneof:"message"},{no:9,name:"mute",kind:"message",T:F8,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:Rxe,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Ixe,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Pxe,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Mxe,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Lxe,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Dxe,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:Txe,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:Exe,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:Nxe,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Fxe,oneof:"message"},{no:22,name:"request_response",kind:"message",T:Bxe,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:jxe,oneof:"message"}]),yA=me.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]),_A=me.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:me.getEnumType(tc)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:me.getEnumType(zi)},{no:9,name:"layers",kind:"message",T:Nh,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:yA,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:me.getEnumType(ra)},{no:15,name:"stream",kind:"scalar",T:9}]),$8=me.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:me.getEnumType(nc)},{no:3,name:"final",kind:"scalar",T:8}]),F8=me.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),wxe=me.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:U8},{no:2,name:"participant",kind:"message",T:w_},{no:3,name:"other_participants",kind:"message",T:w_,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:dee,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:see},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:vxe},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:ZC,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),Exe=me.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:dee,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:see}]),B8=me.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:em}]),Txe=me.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),sp=me.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]),Cxe=me.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:w_,repeated:!0}]),fR=me.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:nee,repeated:!0}]),aee=me.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:me.getEnumType(N8)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),cee=me.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:me.getEnumType(Kc),repeated:!0}]),kxe=me.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),hR=me.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:me.getEnumType(Tm)},{no:3,name:"action",kind:"enum",T:me.getEnumType(Cm)},{no:4,name:"regions",kind:"message",T:Uxe}]),Cm=me.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),lee=me.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Nh,repeated:!0}]),uee=me.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),dee=me.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),Rxe=me.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:eee,repeated:!0}]),Ixe=me.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:U8}]),xxe=me.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:me.getEnumType(N1)},{no:3,name:"score",kind:"scalar",T:2}]),Pxe=me.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:xxe,repeated:!0}]),Oxe=me.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:me.getEnumType(vA)}]),Mxe=me.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Oxe,repeated:!0}]),j8=me.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:me.getEnumType(N8)},{no:2,name:"enabled",kind:"scalar",T:8}]),Axe=me.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:j8,repeated:!0}]),Lxe=me.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:j8,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Axe,repeated:!0}]),fee=me.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),hee=me.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:fee,repeated:!0}]),Dxe=me.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),pee=me.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:sp},{no:2,name:"subscription",kind:"message",T:fR},{no:3,name:"publish_tracks",kind:"message",T:B8,repeated:!0},{no:4,name:"data_channels",kind:"message",T:gee,repeated:!0},{no:5,name:"offer",kind:"message",T:sp},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0}]),gee=me.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:me.getEnumType(nc)}]),Pc=me.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:me.getEnumType(bxe),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),mee=me.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),Nxe=me.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),Uxe=me.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:$xe,repeated:!0}]),$xe=me.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),Fxe=me.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:me.getEnumType(uxe)}]),Bxe=me.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:me.getEnumType(vee)},{no:3,name:"message",kind:"scalar",T:9}]),vee=me.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"}]),jxe=me.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);var Hxe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kxe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yee={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Hxe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,S){var _=v[S];if(typeof _.bind=="function")return _.bind(v);try{return Function.prototype.bind.call(_,v)}catch{return function(){return Function.prototype.apply.apply(_,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),S=0;S<i.length;S++){var _=i[S];this[_]=S<v?e:this.methodFactory(_,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function f(v,S,_){return l(v)||d.apply(this,arguments)}function p(v,S){var _=this,w,T,C,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function R(L){var j=(i[L]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=j;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+j+";"}catch{}}}function O(){var L;if(!(typeof window===n||!I)){try{L=window.localStorage[I]}catch{}if(typeof L===n)try{var j=window.document.cookie,X=encodeURIComponent(I),G=j.indexOf(X+"=");G!==-1&&(L=/^([^;]+)/.exec(j.slice(G+X.length+1))[1])}catch{}return _.levels[L]===void 0&&(L=void 0),L}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function U(L){var j=L;if(typeof j=="string"&&_.levels[j.toUpperCase()]!==void 0&&(j=_.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=_.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+L)}_.name=v,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=S||f,_.getLevel=function(){return C??T??w},_.setLevel=function(L,j){return C=U(L),j!==!1&&R(C),u.call(_)},_.setDefaultLevel=function(L){T=U(L),O()||_.setLevel(L,!1)},_.resetLevel=function(){C=null,A(),u.call(_)},_.enableAll=function(L){_.setLevel(_.levels.TRACE,L)},_.disableAll=function(L){_.setLevel(_.levels.SILENT,L)},_.rebuild=function(){if(o!==_&&(w=U(o.getLevel())),u.call(_),o===_)for(var L in s)s[L].rebuild()},w=U(o?o.getLevel():"WARN");var N=O();N!=null&&(C=U(N)),u.call(_)}o=new p,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var _=s[S];return _||(_=s[S]=new p(S,o.methodFactory)),_};var m=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=m),o},o.getLoggers=function(){return s},o.default=o,o})})(yee);var pR=yee.exports,E_;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(E_||(E_={}));var fc;(function(t){t.Default="livekit",t.Room="livekit-room",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(fc||(fc={}));let Ot=pR.getLogger("livekit");const _ee=Object.values(fc).map(t=>pR.getLogger(t));Ot.setDefaultLevel(E_.info);function ku(t){const e=pR.getLogger(t);return e.setDefaultLevel(Ot.getLevel()),e}function Vxe(t,e){for(const n of _ee)n.setLevel(t)}function qxe(t,e){_ee.forEach(r=>{const i=r.methodFactory;r.methodFactory=(s,o,a)=>{const c=i(s,o,a),l=E_[s],u=l>=o&&l<E_.silent;return(d,f)=>{f?c(d,f):c(d),u&&t(l,d,f)}},r.setLevel(r.getLevel())})}const Gxe=pR.getLogger("lk-e2ee"),Zy=7e3,zxe=[0,300,2*2*300,3*3*300,4*4*300,Zy,Zy,Zy,Zy,Zy];class bee{constructor(e){this._retryDelays=e!==void 0?[...e]:zxe}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function te(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function Bj(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Lg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Bj=="function"?Bj(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var H8={exports:{}},km=typeof Reflect=="object"?Reflect:null,jj=km&&typeof km.apply=="function"?km.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},gT;km&&typeof km.ownKeys=="function"?gT=km.ownKeys:Object.getOwnPropertySymbols?gT=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:gT=function(e){return Object.getOwnPropertyNames(e)};function Wxe(t){console&&console.warn&&console.warn(t)}var See=Number.isNaN||function(e){return e!==e};function vn(){vn.init.call(this)}H8.exports=vn;H8.exports.once=Zxe;vn.EventEmitter=vn;vn.prototype._events=void 0;vn.prototype._eventsCount=0;vn.prototype._maxListeners=void 0;var Hj=10;function gR(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(vn,"defaultMaxListeners",{enumerable:!0,get:function(){return Hj},set:function(t){if(typeof t!="number"||t<0||See(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Hj=t}});vn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};vn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||See(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function wee(t){return t._maxListeners===void 0?vn.defaultMaxListeners:t._maxListeners}vn.prototype.getMaxListeners=function(){return wee(this)};vn.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")jj(c,this,n);else for(var l=c.length,u=Ree(c,l),r=0;r<l;++r)jj(u[r],this,n);return!0};function Eee(t,e,n,r){var i,s,o;if(gR(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=wee(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Wxe(a)}return t}vn.prototype.addListener=function(e,n){return Eee(this,e,n,!1)};vn.prototype.on=vn.prototype.addListener;vn.prototype.prependListener=function(e,n){return Eee(this,e,n,!0)};function Yxe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Tee(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=Yxe.bind(r);return i.listener=n,r.wrapFn=i,i}vn.prototype.once=function(e,n){return gR(n),this.on(e,Tee(this,e,n)),this};vn.prototype.prependOnceListener=function(e,n){return gR(n),this.prependListener(e,Tee(this,e,n)),this};vn.prototype.removeListener=function(e,n){var r,i,s,o,a;if(gR(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():Jxe(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};vn.prototype.off=vn.prototype.removeListener;vn.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Cee(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?Xxe(i):Ree(i,i.length)}vn.prototype.listeners=function(e){return Cee(this,e,!0)};vn.prototype.rawListeners=function(e){return Cee(this,e,!1)};vn.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):kee.call(t,e)};vn.prototype.listenerCount=kee;function kee(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}vn.prototype.eventNames=function(){return this._eventsCount>0?gT(this._events):[]};function Ree(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Jxe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Xxe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Zxe(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}Iee(t,e,s,{once:!0}),e!=="error"&&Qxe(t,i,{once:!0})})}function Qxe(t,e,n){typeof t.on=="function"&&Iee(t,"error",e,n)}function Iee(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ml=H8.exports;let xee=!0,Pee=!0;function mT(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Pp(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=n(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function e3e(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(xee=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function t3e(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Pee=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Oee(){if(typeof window=="object"){if(xee)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function K8(t,e){Pee&&console.warn(t+" is deprecated, please use "+e+" instead.")}function n3e(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=mT(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=mT(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=mT(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Kj(t){return Object.prototype.toString.call(t)==="[object Object]"}function Mee(t){return Kj(t)?Object.keys(t).reduce(function(e,n){const r=Kj(t[n]),i=r?Mee(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function bA(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?bA(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{bA(t,t.get(i),n)})}))}function Vj(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&bA(t,a,i)})}),i}const qj=Oee;function Aee(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",l)]=u.ideal,c.optional.push(f),f={},f[d("max",l)]=u.ideal,c.optional.push(f)):(f[d("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(m=>m.kind==="videoinput");let p=f.find(m=>d.some(v=>m.label.toLowerCase().includes(v)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=r(a.video),qj("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return qj("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{n.webkitGetUserMedia(u,c,d=>{l&&l(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function Lee(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Dee(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Pp(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Nee(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Uee(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>Vj(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Pp(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>Vj(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function $ee(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Fee(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return $ee(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}r.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[d.id];if(m)m.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([u]);this._streams[d.id]=v,this._reverseStreams[v.id]=d,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function s(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],m=l._streams[p.id];d=d.replace(new RegExp(m.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const p=l._reverseStreams[f],m=l._streams[p.id];d=d.replace(new RegExp(p.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=t.RTCPeerConnection.prototype[l],d={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[m=>{const v=s(this,m);f[0].apply(null,[v])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(m=>s(this,m))}};t.RTCPeerConnection.prototype[l]=d[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(v=>u.track===v)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function SA(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function Bee(t,e){Pp(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var Gj=Object.freeze({__proto__:null,fixNegotiationNeeded:Bee,shimAddTrackRemoveTrack:Fee,shimAddTrackRemoveTrackWithNative:$ee,shimGetSendersWithDtmf:Nee,shimGetUserMedia:Aee,shimMediaStream:Lee,shimOnTrack:Dee,shimPeerConnection:SA,shimSenderReceiverGetStats:Uee});function jee(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){K8("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function r3e(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function Hee(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wA(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return c}).then(o,a)}}function Kee(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Vee(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Pp(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function qee(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){K8("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Gee(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function zee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Wee(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Yee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Jee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var zj=Object.freeze({__proto__:null,shimAddTransceiver:zee,shimCreateAnswer:Jee,shimCreateOffer:Yee,shimGetDisplayMedia:r3e,shimGetParameters:Wee,shimGetUserMedia:jee,shimOnTrack:Hee,shimPeerConnection:wA,shimRTCDataChannel:Gee,shimReceiverGetStats:Vee,shimRemoveStream:qee,shimSenderGetStats:Kee});function Xee(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function Zee(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function Qee(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const d=i.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function ete(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(tte(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function tte(t){return t&&t.video!==void 0?Object.assign({},t,{video:Mee(t.video)}):t}function nte(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(K8("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function rte(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ite(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ste(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Wj=Object.freeze({__proto__:null,shimAudioContext:ste,shimCallbacksAPI:Qee,shimConstraints:tte,shimCreateOfferLegacy:ite,shimGetUserMedia:ete,shimLocalStreamsAPI:Xee,shimRTCIceServerUrls:nte,shimRemoteStreamsAPI:Zee,shimTrackEventTransceiver:rte}),ote={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(m=>parseInt(m,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(p.rtx={ssrc:l}),r.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&c&&r.push({ssrc:c});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(f=>{f.maxBitrate=d})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(ote);var ate=ote.exports,Rm=Kxe(ate),i3e=mIe({__proto__:null,default:Rm},[ate]);function vT(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=Rm.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Pp(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function EA(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Pp(t,"icecandidate",e=>{if(e.candidate){const n=Rm.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function yT(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=Rm.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=Rm.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=Rm.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function _T(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Pp(t,"datachannel",r=>(e(r.channel,r.target),r))}function TA(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function CA(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function bT(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ST(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var s3e=Object.freeze({__proto__:null,removeExtmapAllowMixed:CA,shimAddIceCandidateNullOrEmpty:bT,shimConnectionState:TA,shimMaxMessageSize:yT,shimParameterlessSetLocalDescription:ST,shimRTCIceCandidate:vT,shimRTCIceCandidateRelayProtocol:EA,shimSendThrowTypeError:_T});function o3e(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Oee,r=n3e(t),i={browserDetails:r,commonShim:s3e,extractVersion:mT,disableLog:e3e,disableWarnings:t3e,sdp:i3e};switch(r.browser){case"chrome":if(!Gj||!SA||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=Gj,bT(t,r),ST(t),Aee(t,r),Lee(t),SA(t,r),Dee(t),Fee(t,r),Nee(t),Uee(t),Bee(t,r),vT(t),EA(t),TA(t),yT(t,r),_T(t),CA(t,r);break;case"firefox":if(!zj||!wA||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=zj,bT(t,r),ST(t),jee(t,r),wA(t,r),Hee(t),qee(t),Kee(t),Vee(t),Gee(t),zee(t),Wee(t),Yee(t),Jee(t),vT(t),TA(t),yT(t,r),_T(t);break;case"safari":if(!Wj||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Wj,bT(t,r),ST(t),nte(t),ite(t),Qee(t),Xee(t),Zee(t),rte(t),ete(t),ste(t),vT(t),EA(t),yT(t,r),_T(t),CA(t,r);break;default:n("Unsupported browser!");break}return i}o3e({window:typeof window>"u"?void 0:window});const a3e=10,Aw="lk_e2ee",c3e="LKFrameEncryptionKey",l3e={sharedKey:!1,ratchetSalt:c3e,ratchetWindowSize:8,failureTolerance:a3e,keyringSize:16};var Yd;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Yd||(Yd={}));var Yj;(function(t){t.KeyRatcheted="keyRatcheted"})(Yj||(Yj={}));var Md;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Md||(Md={}));var Jj;(function(t){t.Error="cryptorError"})(Jj||(Jj={}));function cte(){return u3e()||kA()}function kA(){return typeof window.RTCRtpScriptTransform<"u"}function u3e(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function d3e(t){return te(this,void 0,void 0,function*(){let e=new TextEncoder;return yield crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function lte(t){return te(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"])})}class ute extends ml.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r)=>{Ot.debug("key ratcheted event received",{material:n,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},l3e),e),this.on(Yd.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(Yd.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Yd.RatchetRequest,e,n)}}class f3e extends ute{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});super(n)}setKey(e){return te(this,void 0,void 0,function*(){const n=typeof e=="string"?yield d3e(e):yield lte(e);this.onSetEncryptionKey(n)})}}class Op extends Error{constructor(e,n){super(n||"an error has occured"),this.code=e}}class xn extends Op{constructor(e,n,r){super(1,e),this.status=r,this.reason=n}}class V8 extends Op{constructor(e){super(21,e??"device is unsupported")}}class Vc extends Op{constructor(e){super(20,e??"track is invalid")}}class h3e extends Op{constructor(e){super(10,e??"unsupported server")}}class Ur extends Op{constructor(e){super(12,e??"unexpected connection state")}}class RA extends Op{constructor(e){super(13,e??"unable to negotiate")}}class Xj extends Op{constructor(e,n){super(15,e),this.reason=n}}var ek;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(ek||(ek={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(ek||(ek={}));var Zj;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(Zj||(Zj={}));var fe;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed"})(fe||(fe={}));var le;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage"})(le||(le={}));var $e;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse"})($e||($e={}));var Ie;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate"})(Ie||(Ie={}));function q8(t,e,n){var r,i,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(r=n.isImmediate)!=null&&r,a=(i=n.callback)!=null&&i,c=n.maxWait,l=Date.now(),u=[];function d(){if(c!==void 0){var p=Date.now()-l;if(p+e>=c)return c-p}return e}var f=function(){var p=[].slice.call(arguments),m=this;return new Promise(function(v,S){var _=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var T=t.apply(m,p);a&&a(T),u.forEach(function(C){return(0,C.resolve)(T)}),u=[]}},d()),_){var w=t.apply(m,p);return a&&a(w),v(w)}u.push({resolve:v,reject:S})})};return f.cancel=function(p){s!==void 0&&clearTimeout(s),u.forEach(function(m){return(0,m.reject)(p)}),u=[]},f}const p3e=/version\/(\d+(\.?_?\d+)+)/i;let oP;function Ru(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(oP===void 0||e){const r=g3e.find(i=>{let{test:s}=i;return s.test(n)});oP=r==null?void 0:r.describe(n)}return oP}const g3e=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:wT(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:aP(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:wT(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:aP(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:wT(p3e,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:aP(t)}}}];function wT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}function aP(t){return t.includes("mac os")?wT(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var m3e="2.5.6";const v3e=m3e,y3e=15;class Pi{}Pi.setTimeout=function(){return setTimeout(...arguments)};Pi.setInterval=function(){return setInterval(...arguments)};Pi.clearTimeout=function(){return clearTimeout(...arguments)};Pi.clearInterval=function(){return clearInterval(...arguments)};class pn{constructor(e,n,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const _3e=["vp8","h264"],dte=["vp8","h264","vp9","av1"];function b3e(t){return!!_3e.find(e=>e===t)}var tk;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:2e4},t.music={maxBitrate:32e3},t.musicStereo={maxBitrate:48e3},t.musicHighQuality={maxBitrate:64e3},t.musicHighQualityStereo={maxBitrate:96e3}})(tk||(tk={}));const Qc={h90:new pn(160,90,9e4,20),h180:new pn(320,180,16e4,20),h216:new pn(384,216,18e4,20),h360:new pn(640,360,45e4,20),h540:new pn(960,540,8e5,25),h720:new pn(1280,720,17e5,30),h1080:new pn(1920,1080,3e6,30),h1440:new pn(2560,1440,5e6,30),h2160:new pn(3840,2160,8e6,30)},IA={h120:new pn(160,120,7e4,20),h180:new pn(240,180,125e3,20),h240:new pn(320,240,14e4,20),h360:new pn(480,360,33e4,20),h480:new pn(640,480,5e5,20),h540:new pn(720,540,6e5,25),h720:new pn(960,720,13e5,30),h1080:new pn(1440,1080,23e5,30),h1440:new pn(1920,1440,38e5,30)},mR={h360fps3:new pn(640,360,2e5,3,"medium"),h360fps15:new pn(640,360,4e5,15,"medium"),h720fps5:new pn(1280,720,8e5,5,"medium"),h720fps15:new pn(1280,720,15e5,15,"medium"),h720fps30:new pn(1280,720,2e6,30,"medium"),h1080fps15:new pn(1920,1080,25e5,15,"medium"),h1080fps30:new pn(1920,1080,5e6,30,"medium"),original:new pn(0,0,7e6,30,"medium")};function S3e(t){if(!(typeof t>"u"))return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}const w3e=5e3,Qy=[];var pa;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(pa||(pa={}));let ve=class Dg extends ml.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=Dg.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ot,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),w3e):this.handleAppVisibilityChanged()},this.log=ku((i=r.loggerName)!==null&&i!==void 0?i:fc.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Dg.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Sn(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===Dg.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===Dg.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Qy.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Qy.splice(Qy.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),tm(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?Ie.AudioPlaybackStarted:Ie.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?Ie.AudioPlaybackFailed:Ie.VideoPlaybackFailed,s):s.name==="AbortError"?Ot.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):Ot.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ie.ElementAttached,e),e}detach(e){try{if(e){Im(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Ie.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{Im(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(Ie.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ku(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Qy.forEach(r=>{r.parentElement||(n=!1)}),n&&Qy.push(e)}}handleAppVisibilityChanged(){return te(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Dg.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ro()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ro()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function tm(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),(!op()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(op()||dv())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Im(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(l){switch(l){case e.Audio:return tc.AUDIO;case e.Video:return tc.VIDEO;default:return tc.DATA}}t.kindToProto=i;function s(l){switch(l){case tc.AUDIO:return e.Audio;case tc.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return zi.CAMERA;case n.Microphone:return zi.MICROPHONE;case n.ScreenShare:return zi.SCREEN_SHARE;case n.ScreenShareAudio:return zi.SCREEN_SHARE_AUDIO;default:return zi.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case zi.CAMERA:return n.Camera;case zi.MICROPHONE:return n.Microphone;case zi.SCREEN_SHARE:return n.ScreenShare;case zi.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case vA.ACTIVE:return r.Active;case vA.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=c})(ve||(ve={}));function fte(t,e,n){var r;const i=(r=S3e(t))!==null&&r!==void 0?r:{};return i.audio===!0&&(i.audio={}),i.video===!0&&(i.video={}),i.audio&&xA(i.audio,e),i.video&&xA(i.video,n),i}function xA(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function vR(t){const e={};if(t.video)if(typeof t.video=="object"){const n={},r=n,i=t.video;Object.keys(i).forEach(s=>{switch(s){case"resolution":xA(r,i.resolution);break;default:r[s]=i[s]}}),e.video=n}else e.video=t.video;else e.video=!1;return t.audio?typeof t.audio=="object"?e.audio=t.audio:e.audio=!0:e.audio=!1,e}function E3e(t){return te(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const r=hte();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,o=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield sl(n),i.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return r.close(),!c}return!1}()})}function hte(){const t=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(t)return new t({latencyHint:"interactive"})}function Qj(t){return t===ve.Source.Microphone?"audioinput":t===ve.Source.Camera?"videoinput":void 0}function T3e(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(r=typeof r=="boolean"?{}:r,op()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function ET(t){const e=t.split("/")[1].toLowerCase();if(!dte.includes(e))throw Error("Video codec not supported: ".concat(e));return e}function C3e(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new B8({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Sn(t){return t instanceof ve?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Sn(t.track):{})}}function k3e(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function R3e(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(t)],i={};for(const s of r)t[s]!==e[s]&&(i[s]=(n=e[s])!==null&&n!==void 0?n:"");return i}const I3e="|",eH="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function x3e(t){const e=t.split(I3e);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function sl(t){return te(this,void 0,void 0,function*(){return new Promise(e=>Pi.setTimeout(e,t))})}function PA(){return"addTransceiver"in RTCPeerConnection.prototype}function OA(){return"addTrack"in RTCPeerConnection.prototype}function P3e(){if(!("getCapabilities"in RTCRtpSender)||op())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/AV1"){e=!0;break}}return e}function O3e(){if(!("getCapabilities"in RTCRtpSender)||dv())return!1;if(op()){const n=Ru();if(n!=null&&n.version&&T_(n.version,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType==="video/VP9"){e=!0;break}}return e}function p0(t){return t==="av1"||t==="vp9"}function MA(t){return document?(t||(t=document.createElement("audio")),"setSinkId"in t):!1}function M3e(){return typeof RTCPeerConnection>"u"?!1:PA()||OA()}function dv(){var t;return((t=Ru())===null||t===void 0?void 0:t.name)==="Firefox"}function op(){var t;return((t=Ru())===null||t===void 0?void 0:t.name)==="Safari"}function A3e(){const t=Ru();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")}function pte(){var t,e;return Ro()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function L3e(){const t=Ru(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&T_(e,t.osVersion)>=0?!0:t.name==="Safari"&&T_(e,t.version)>=0}function Ro(){return typeof document<"u"}function Iu(){return navigator.product=="ReactNative"}function AA(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function gte(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function mte(){if(!Iu())return;let t=gte();if(t)return t.platform}function tH(){if(Ro())return window.devicePixelRatio;if(Iu()){let t=gte();if(t)return t.devicePixelRatio}return 1}function T_(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let s=0;s<i;++s){const o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1;if(s===i-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function D3e(t){for(const e of t)e.target.handleResize(e)}function N3e(t){for(const e of t)e.target.handleVisibilityChanged(e)}let cP=null;const nH=()=>(cP||(cP=new ResizeObserver(D3e)),cP);let lP=null;const rH=()=>(lP||(lP=new IntersectionObserver(N3e,{root:null,rootMargin:"0px"})),lP);function U3e(){var t;const e=new yxe({sdk:iee.JS,protocol:y3e,version:v3e});return Iu()&&(e.os=(t=mte())!==null&&t!==void 0?t:""),e}function iH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d");s==null||s.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=i.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let e1;function uP(){if(!e1){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[e1]=r.stream.getAudioTracks(),!e1)throw Error("Could not get empty media stream audio track");e1.enabled=!1}return e1.clone()}class vte{constructor(e,n){this.onFinally=n,this.promise=new Promise((r,i)=>te(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}class qs{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}}function $3e(t){return dte.includes(t)}function gu(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function F3e(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function sH(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function B3e(t,e){return t.segments.map(n=>{let{id:r,text:i,language:s,startTime:o,endTime:a,final:c}=n;var l;const u=(l=e.get(r))!==null&&l!==void 0?l:Date.now(),d=Date.now();return c?e.delete(r):e.set(r,u),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function j3e(t){const{id:e,timestamp:n,message:r,editTimestamp:i}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}const dP="default";class Ci{static getInstance(){return this.instance===void 0&&(this.instance=new Ci),this.instance}getDevices(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Ci.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Ot.debug("awaiting getUserMedia promise");try{n?yield Ci.userMediaPromiseMap.get(n):yield Promise.all(Ci.userMediaPromiseMap.values())}catch{Ot.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(op()&&r.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",u=n?c.kind===n:!0;return l&&u}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(u=>{u.stop()})}return n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,r){return te(this,void 0,void 0,function*(){if(n!==dP)return n;const i=yield this.getDevices(e),s=i.find(a=>a.deviceId===dP);if(!s){Ot.warn("could not reliably determine default device");return}const o=i.find(a=>a.deviceId!==dP&&a.groupId===(r??s.groupId));if(!o){Ot.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Ci.userMediaPromiseMap.has(e):Ci.userMediaPromiseMap.size>0}}Ci.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ci.userMediaPromiseMap=new Map;const H3e=1e3;class Jd extends ve{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=q8(()=>te(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>te(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ie.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new qs,this.pauseUpstreamLock=new qs,this.processorLock=new qs,this.restartLock=new qs,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==ve.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}setMediaStreamTrack(e,n){return te(this,void 0,void 0,function*(){if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(i=>{Im(this._mediaStreamTrack,i)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){const i=yield this.processorLock.lock();try{if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(tm(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}finally{i()}}this.sender&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(i=>{tm(r??e,i)}))})}waitForDimensions(){return te(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:H3e;return function*(){var r;if(e.kind===ve.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=Ru())===null||r===void 0?void 0:r.os)==="iOS"&&(yield sl(10));const i=Date.now();for(;Date.now()-i<n;){const s=e.dimensions;if(s)return s;yield sl(50)}throw new Vc("unable to get track dimensions after timeout")}()})}getDeviceId(){return te(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===ve.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===ve.Kind.Audio?"audioinput":"videoinput";return n?Ci.getInstance().normalizeDeviceId(s,r,i):r}()})}mute(){return te(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return te(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return te(this,void 0,void 0,function*(){if(!this.sender)throw new Vc("unable to replace an unpublished track");let r,i;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,i=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),i&&this.processor&&(yield this.stopProcessor()),this})}restart(e){return te(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.restartLock.lock();try{e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===ve.Kind.Video?r.video=e:r.audio=e,this.attachedElements.forEach(o=>{Im(this.mediaStreamTrack,o)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const s=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return s.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(s),this._constraints=e,this.emit(Ie.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ie.Muted:Ie.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return te(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),pte()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return te(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Ie.UpstreamPaused,this);const n=Ru();if((n==null?void 0:n.name)==="Safari"&&T_(n.version,"12.0")<0)throw new V8("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}})}resumeUpstream(){return te(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Ie.UpstreamResumed,this),yield this.sender.replaceTrack(this.mediaStreamTrack)}finally{e()}})}getRTCStatsReport(){return te(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield r.processorLock.lock();try{r.log.debug("setting up processor",r.logContext);const a=document.createElement(r.kind),c={kind:r.kind,track:r._mediaStreamTrack,element:a,audioContext:r.audioContext};if(yield n.init(c),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.stopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(tm(r._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:l}))),r.processor=n,r.processorElement=a,r.processor.processedTrack){for(const l of r.attachedElements)l!==r.processorElement&&i&&(Im(r._mediaStreamTrack,l),tm(r.processor.processedTrack,l));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(Ie.TrackProcessorUpdate,r.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return te(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Ie.TrackProcessorUpdate))}()})}}class K3e extends ml.EventEmitter{constructor(e){super(),this.onWorkerMessage=n=>{var r,i;const{kind:s,data:o}=n.data;switch(s){case"error":Ot.error(o.error.message),this.emit(Md.EncryptionError,o.error);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(a=>{this.postKey(a)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Md.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const a=(i=this.room)===null||i===void 0?void 0:i.getParticipantByIdentity(o.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Md.ParticipantEncryptionStatusChanged,o.enabled,a)}break;case"ratchetKey":this.keyProvider.emit(Yd.KeyRatcheted,o.material,o.keyIndex);break}},this.onWorkerError=n=>{Ot.error("e2ee worker encountered an error:",{error:n.error}),this.emit(Md.EncryptionError,n.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!cte())throw new V8("tried to setup end-to-end encryption on an unsupported browser");if(Ot.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:Gxe.getLevel()}};this.worker&&(Ot.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ot.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ot.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on($e.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(fe.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==ra.NONE,i.identity)),e.on(fe.ConnectionStateChanged,r=>{r===Dt.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==ra.NONE,i.identity)})})}).on(fe.TrackUnsubscribed,(r,i,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(fe.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(fe.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(le.LocalTrackPublished,r=>te(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),n.on(Yd.SetKey,r=>this.postKey(r)).on(Yd.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?ET(r.mimeType):void 0)}}setupE2EESender(e,n){if(!(e instanceof Jd)||!n){n||Ot.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return te(this,void 0,void 0,function*(){if(this.worker){if(kA()){const s={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Aw in e&&i){const c={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(a,[o,s])}e[Aw]=!0}})}handleSender(e,n,r){var i;if(!(Aw in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(kA()){Ot.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Ot.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(o,[s.readable,s.writable])}e[Aw]=!0}}}var g0;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(g0||(g0={}));class V3e{constructor(){this.pendingTasks=new Map,this.taskMutex=new qs,this.nextTaskIndex=0}run(e){return te(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:g0.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=g0.RUNNING,yield e()}finally{n.status=g0.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return te(this,void 0,void 0,function*(){return this.run(()=>te(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const q3e=["syncState","trickle","offer","answer","simulate","leave"];function G3e(t){const e=q3e.indexOf(t.case)>=0;return Ot.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Vn;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Vn||(Vn={}));class G8{get currentState(){return this.state}get isDisconnected(){return this.state===Vn.DISCONNECTING||this.state===Vn.DISCONNECTED}get isEstablishingConnection(){return this.state===Vn.CONNECTING||this.state===Vn.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=Vn.DISCONNECTED,this.log=Ot,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=ku((r=n.loggerName)!==null&&r!==void 0?r:fc.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new V3e,this.queuedRequests=[],this.closingLock=new qs,this.connectionLock=new qs,this.state=Vn.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,i){return te(this,void 0,void 0,function*(){return this.state=Vn.CONNECTING,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return te(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Vn.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){this.connectOptions=r,e=F3e(e),e=e.replace(/\/$/,""),e+="/rtc";const s=U3e(),o=z3e(n,s,r);return new Promise((a,c)=>te(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();try{const u=()=>te(this,void 0,void 0,function*(){this.close(),clearTimeout(d),c(new xn("room connection has been cancelled (signal)"))}),d=setTimeout(()=>{this.close(),c(new xn("room connection has timed out (signal)"))},r.websocketTimeout);i!=null&&i.aborted&&u(),i==null||i.addEventListener("abort",u),this.log.debug("connecting to ".concat(e+o),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+o),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(d)},this.ws.onerror=f=>te(this,void 0,void 0,function*(){if(this.state!==Vn.CONNECTED){this.state=Vn.DISCONNECTED,clearTimeout(d);try{const p=yield fetch("http".concat(e.substring(2),"/validate").concat(o));if(p.status.toFixed(0).startsWith("4")){const m=yield p.text();c(new xn(m,0,p.status))}else c(new xn("Internal error",2,p.status))}catch{c(new xn("server was not reachable",1))}return}this.handleWSError(f)}),this.ws.onmessage=f=>te(this,void 0,void 0,function*(){var p,m,v;let S;if(typeof f.data=="string"){const _=JSON.parse(f.data);S=Fj.fromJson(_,{ignoreUnknownFields:!0})}else if(f.data instanceof ArrayBuffer)S=Fj.fromBinary(new Uint8Array(f.data));else{this.log.error("could not decode websocket message: ".concat(typeof f.data),this.logContext);return}if(this.state!==Vn.CONNECTED){let _=!1;if(((p=S.message)===null||p===void 0?void 0:p.case)==="join"?(this.state=Vn.CONNECTED,i==null||i.removeEventListener("abort",u),this.pingTimeoutDuration=S.message.value.pingTimeout,this.pingIntervalDuration=S.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),a(S.message.value)):this.state===Vn.RECONNECTING&&S.message.case!=="leave"?(this.state=Vn.CONNECTED,i==null||i.removeEventListener("abort",u),this.startPingInterval(),((m=S.message)===null||m===void 0?void 0:m.case)==="reconnect"?a(S.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),a(void 0),_=!0)):this.isEstablishingConnection&&S.message.case==="leave"?c(new xn("Received leave request while trying to (re)connect",4)):r.reconnect||c(new xn("did not receive join response, got ".concat((v=S.message)===null||v===void 0?void 0:v.case," instead"))),!_)return}this.signalLatency&&(yield sl(this.signalLatency)),this.handleSignalResponse(S)}),this.ws.onclose=f=>{this.isEstablishingConnection&&c(new xn("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:f.reason,code:f.code,wasClean:f.wasClean,state:this.state})),this.handleOnClose(f.reason)}}finally{l()}}))}close(){return te(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Vn.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const i=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([i,sl(250)])),e.ws=void 0}}finally{n&&(e.state=Vn.DISCONNECTED),r()}}()})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:nk(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:nk(e)})}sendIceCandidate(e,n){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new $8({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new F8({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return te(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new uee({requestId:a,metadata:r,name:i,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new lee({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new hee({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Yn.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new mee({timestamp:Yn.parse(Date.now()),rtt:Yn.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new cee({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new hR({reason:Tm.CLIENT_INITIATED,action:Cm.DISCONNECT})})}sendRequest(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!i&&!G3e(n)&&r.state===Vn.RECONNECTING){r.queuedRequests.push(()=>te(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield sl(r.signalLatency)),!r.ws||r.ws.readyState!==r.ws.OPEN){r.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),r.logContext);return}const o=new Sxe({message:n});try{r.useJSON?r.ws.send(o.toJsonString()):r.ws.send(o.toBinary())}catch(a){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const o=oH(i.value);this.onAnswer&&this.onAnswer(o)}else if(i.case==="offer"){const o=oH(i.value);this.onOffer&&this.onOffer(o)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return te(this,void 0,void 0,function*(){if(this.state===Vn.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Pi.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Pi.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Pi.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Pi.clearInterval(this.pingInterval)}}function oH(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function nk(t){return new sp({sdp:t.sdp,type:t.type})}function z3e(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",Iu()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),"?".concat(i.toString())}var yte={},_te={exports:{}},aH=_te.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return t.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return t.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+(t["encrypt-uri"]?" %s":"%v")+" %s"+(t.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return t.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var e="candidate:%s %d %s %d %s %d typ %s";return e+=t.raddr!=null?" raddr %s rport %d":"%v%v",e+=t.tcptype!=null?" tcptype %s":"%v",t.generation!=null&&(e+=" generation %d"),e+=t["network-id"]!=null?" network-id %d":"%v",e+=t["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var e="ssrc:%d";return t.attribute!=null&&(e+=" %s",t.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return t.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(t){return"ts-refclk:%s"+(t.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(t){var e="mediaclk:";return e+=t.id!=null?"id=%s %s":"%v%s",e+=t.mediaClockValue!=null?"=%s":"",e+=t.rateNumerator!=null?" rate=%s":"",e+=t.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(aH).forEach(function(t){var e=aH[t];e.forEach(function(n){n.reg||(n.reg=/(.*)/),n.format||(n.format="%s")})});var bte=_te.exports;(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,u){if(u&&!l)c[u]=e(a[1]);else for(var d=0;d<l.length;d+=1)a[d+1]!=null&&(c[l[d]]=e(a[d+1]))},r=function(a,c,l){var u=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:u&&!c[a.name]&&(c[a.name]={});var d=a.push?{}:u?c[a.name]:c;n(l.match(a.reg),d,a.names,a.name),a.push&&c[a.push].push(d)},i=bte,s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],u=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var f=d[0],p=d.slice(2);f==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var m=0;m<(i[f]||[]).length;m+=1){var v=i[f][m];if(v.reg.test(p))return r(v,u,p)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var u,d=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),d=!0),{scid:u,paused:d}})})}})(yte);var fP=bte,W3e=/%[sdv%]/g,Y3e=function(t){var e=1,n=arguments,r=n.length;return t.replace(W3e,function(i){if(e>=r)return i;var s=n[e];switch(e+=1,i){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},t1=function(t,e,n){var r=e.format instanceof Function?e.format(e.push?n:n[e.name]):e.format,i=[t+"="+r];if(e.names)for(var s=0;s<e.names.length;s+=1){var o=e.names[s];e.name?i.push(n[e.name][o]):i.push(n[e.names[s]])}else i.push(n[e.name]);return Y3e.apply(null,i)},J3e=["v","o","s","i","u","e","p","c","b","t","r","z","a"],X3e=["i","c","b","a"],Z3e=function(t,e){e=e||{},t.version==null&&(t.version=0),t.name==null&&(t.name=" "),t.media.forEach(function(s){s.payloads==null&&(s.payloads="")});var n=e.outerOrder||J3e,r=e.innerOrder||X3e,i=[];return n.forEach(function(s){fP[s].forEach(function(o){o.name in t&&t[o.name]!=null?i.push(t1(s,o,t)):o.push in t&&t[o.push]!=null&&t[o.push].forEach(function(a){i.push(t1(s,o,a))})})}),t.media.forEach(function(s){i.push(t1("m",fP.m[0],s)),r.forEach(function(o){fP[o].forEach(function(a){a.name in s&&s[a.name]!=null?i.push(t1(o,a,s)):a.push in s&&s[a.push]!=null&&s[a.push].forEach(function(c){i.push(t1(o,a,c))})})})}),i.join(`\r
`)+`\r
`},Q3e=yte,ePe=Z3e,hP=ePe,U1=Q3e.parse;const tPe=.7,nPe=20,xm={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class cH extends ml.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=Ot,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=q8(i=>te(this,void 0,void 0,function*(){this.emit(xm.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),nPe),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ku((r=n.loggerName)!==null&&r!==void 0?r:fc.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC()}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return te(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){return te(this,void 0,void 0,function*(){var n;let r;if(e.type==="offer"){let{stereoMids:i,nackMids:s}=iPe(e);this.remoteStereoMids=i,this.remoteNackMids=s}else if(e.type==="answer"){const i=U1((n=e.sdp)!==null&&n!==void 0?n:"");i.media.forEach(s=>{s.type==="audio"&&this.trackBitrates.some(o=>{if(!o.transceiver||s.mid!=o.transceiver.mid)return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0)return!0;let c=!1;for(const l of s.fmtp)if(l.payload===a){l.config=l.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),o.maxbr>0&&(l.config+=";maxaveragebitrate=".concat(o.maxbr*1e3)),c=!0;break}return c||o.maxbr>0&&s.fmtp.push({payload:a,config:"maxaveragebitrate=".concat(o.maxbr*1e3)}),!0})}),r=hP(i)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(i=>{this.pc.addIceCandidate(i)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(xm.NegotiationComplete),e.sdp&&U1(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(xm.RTPVideoPayloadTypes,s.rtp)}))})}createAndSendOffer(e){return te(this,void 0,void 0,function*(){var n;if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const s=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&s)yield this._pc.setRemoteDescription(s);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const i=U1((n=r.sdp)!==null&&n!==void 0?n:"");i.media.forEach(s=>{s.type==="audio"?lH(s,[],[]):s.type==="video"&&this.trackBitrates.some(o=>{if(!s.msid||!o.cid||!s.msid.includes(o.cid))return!1;let a=0;if(s.rtp.some(l=>l.codec.toUpperCase()===o.codec.toUpperCase()?(a=l.payload,!0):!1),a===0||(p0(o.codec)&&rPe(s),o.codec!=="av1"))return!0;const c=Math.round(o.maxbr*tPe);for(const l of s.fmtp)if(l.payload===a){l.config.includes("x-google-start-bitrate")||(l.config+=";x-google-start-bitrate=".concat(c));break}return!0})}),yield this.setMungedSDP(r,hP(i)),this.onOffer(r)})}createAndSetAnswer(){return te(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=U1((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{i.type==="audio"&&lH(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,hP(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ur("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ur("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return te(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return i.get(o)})}setMungedSDP(e,n,r){return te(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const o={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new RA(s)}})}}function lH(t,e,n){let r=0;t.rtp.some(i=>i.codec==="opus"?(r=i.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(t.mid)&&!t.rtcpFb.some(i=>i.payload===r&&i.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),e.includes(t.mid)&&t.fmtp.some(i=>i.payload===r?(i.config.includes("stereo=1")||(i.config+=";stereo=1"),!0):!1))}function rPe(t){var e,n;let r=0;((e=t.ext)===null||e===void 0?void 0:e.some(s=>s.uri===eH?!0:(s.value>r&&(r=s.value),!1)))||(n=t.ext)===null||n===void 0||n.push({value:r+1,uri:eH})}function iPe(t){var e;const n=[],r=[],i=U1((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(o=>{var a;o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&r.push(o.mid),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(o.mid),!0):!1))}),{stereoMids:n,nackMids:r}}const LA="vp8",sPe={audioPreset:tk.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:mR.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:LA,backupCodec:!0},Ste={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},wte={resolution:Qc.h720.resolution},oPe={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new bee,disconnectOnPageLeave:!0,webAudioMix:!1},z8={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var ur;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(ur||(ur={}));class aPe{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var i;this.peerConnectionTimeout=z8.peerConnectionTimeout,this.log=Ot,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(c=>c.getConnectionState());a.every(c=>c==="connected")?this.state=ur.CONNECTED:a.some(c=>c==="failed")?this.state=ur.FAILED:a.some(c=>c==="connecting")?this.state=ur.CONNECTING:a.every(c=>c==="closed")?this.state=ur.CLOSED:a.some(c=>c==="closed")?this.state=ur.CLOSING:a.every(c=>c==="new")&&(this.state=ur.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(ur[o]," to ").concat(ur[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=ku((i=r.loggerName)!==null&&i!==void 0?i:fc.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new cH(e,r),this.subscriber=new cH(e,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,nc.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,nc.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=s=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,s)},this.state=ur.NEW,this.connectionLock=new qs,this.remoteOfferLock=new qs}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return te(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return te(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return te(this,void 0,void 0,function*(){n===nc.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return te(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const n=yield this.remoteOfferLock.lock();try{return yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()}finally{n()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return te(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,n)))}finally{i()}})}negotiate(e){return te(this,void 0,void 0,function*(){return new Promise((n,r)=>te(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(xm.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(xm.NegotiationComplete,()=>{clearTimeout(i),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===nc.PUBLISHER?this.publisher.getConnectedAddress():e===nc.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return te(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(r.getConnectionState()!=="connected")return new Promise((c,l)=>te(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Pi.clearTimeout(d),l(new xn("room connection has been cancelled",3))};i!=null&&i.signal.aborted&&u(),i==null||i.signal.addEventListener("abort",u);const d=Pi.setTimeout(()=>{i==null||i.signal.removeEventListener("abort",u),l(new xn("could not establish pc connection"))},o);for(;this.state!==ur.CONNECTED;)if(yield sl(50),i!=null&&i.signal.aborted){l(new xn("room connection has been cancelled",3));return}Pi.clearTimeout(d),i==null||i.signal.removeEventListener("abort",u),c()}))}()})}}const W8=2e3;function yR(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}class bi extends Jd{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,ve.Kind.Audio,n,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>te(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=yR(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Ie.AudioTrackFeatureUpdate,this,Kc.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Ie.AudioTrackFeatureUpdate,this,Kc.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}setDeviceId(e){return te(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===gu(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||gu(e)===this._mediaStreamTrack.getSettings().deviceId)})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return te(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ve.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return te(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==gu(this._constraints.deviceId);return this.source===ve.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return te(this,void 0,void 0,function*(){let n;if(e){const r=vR({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return te(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){Ro()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},W8)))}setProcessor(e){return te(this,void 0,void 0,function*(){var n;const r=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.stopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Ie.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return te(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return te(this,void 0,void 0,function*(){const e=yield E3e(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(Ie.AudioSilenceDetected)),e})}}function Ete(t,e,n){switch(t.kind){case"audio":return new bi(t,e,!1,void 0,n);case"video":return new Hi(t,e,!1,n);default:throw new Vc("unsupported track type: ".concat(t.kind))}}const cPe=Object.values(Qc),lPe=Object.values(IA),uPe=Object.values(mR),dPe=[Qc.h180,Qc.h360],fPe=[IA.h180,IA.h360],hPe=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var r,i;return new pn(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=t.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=n.fps)!==null&&i!==void 0?i:30))))),n.fps,t.encoding.priority)}),DA=["q","h","f"];function NA(t,e,n,r){var i,s;let o=r==null?void 0:r.videoEncoding;t&&(o=r==null?void 0:r.screenShareEncoding);const a=r==null?void 0:r.simulcast,c=r==null?void 0:r.scalabilityMode,l=r==null?void 0:r.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=gPe(t,e,n,l),Ot.debug("using video encoding",o));const u=new pn(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&p0(l)){const p=new Tte(c),m=[];if(p.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const v=Ru();if(op()||Iu()||(v==null?void 0:v.name)==="Chrome"&&T_(v==null?void 0:v.version,"113")<0){const S=p.suffix=="h"?2:3;for(let _=0;_<p.spatial;_+=1)m.push({rid:DA[2-_],maxBitrate:o.maxBitrate/Math.pow(S,_),maxFramerate:u.encoding.maxFramerate});m[0].scalabilityMode=c}else m.push({maxBitrate:o.maxBitrate,maxFramerate:u.encoding.maxFramerate,scalabilityMode:c});return u.encoding.priority&&(m[0].priority=u.encoding.priority,m[0].networkPriority=u.encoding.priority),Ot.debug("using svc encoding",{encodings:m}),m}if(!a)return[o];let d=[];t?d=(i=dH(r==null?void 0:r.screenShareSimulcastLayers))!==null&&i!==void 0?i:uH(t,u):d=(s=dH(r==null?void 0:r.videoSimulcastLayers))!==null&&s!==void 0?s:uH(t,u);let f;if(d.length>0){const p=d[0];d.length>1&&([,f]=d);const m=Math.max(e,n);if(m>=960&&f)return pP(e,n,[p,f,u]);if(m>=480)return pP(e,n,[p,u])}return pP(e,n,[u])}function pPe(t,e,n){var r,i,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ot.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(r=a.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return NA(t.source===ve.Source.ScreenShare,c,l,n)}function gPe(t,e,n,r){const i=mPe(t,e,n);let{encoding:s}=i[0];const o=Math.max(e,n);for(let a=0;a<i.length;a+=1){const c=i[a];if(s=c.encoding,c.width>=o)break}if(r)switch(r){case"av1":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function mPe(t,e,n){if(t)return uPe;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?cPe:lPe}function uH(t,e){if(t)return hPe(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?dPe:fPe}function pP(t,e,n){const r=[];if(n.forEach((i,s)=>{if(s>=DA.length)return;const o=Math.min(t,e),c={rid:DA[s],scaleResolutionDownBy:Math.max(1,o/Math.min(i.width,i.height)),maxBitrate:i.encoding.maxBitrate};i.encoding.maxFramerate&&(c.maxFramerate=i.encoding.maxFramerate);const l=dv()||s===0;i.encoding.priority&&l&&(c.priority=i.encoding.priority,c.networkPriority=i.encoding.priority),r.push(c)}),Iu()&&mte()==="ios"){let i;r.forEach(o=>{i?o.maxFramerate&&o.maxFramerate>i&&(i=o.maxFramerate):i=o.maxFramerate});let s=!0;r.forEach(o=>{var a;o.maxFramerate!=i&&(s&&(s=!1,Ot.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ot.info('Setting framerate of encoding "'.concat((a=o.rid)!==null&&a!==void 0?a:"",'" to ').concat(i)),o.maxFramerate=i)})}return r}function dH(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class Tte{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function vPe(t){return t.source===ve.Source.ScreenShare||t.constraints.height&&gu(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const yPe=5e3;class Hi extends Jd{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,ve.Kind.Video,n,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.monitorSender=()=>te(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}const o=new Map(s.map(a=>[a.rid,a]));if(this.prevStats){let a=0;o.forEach((c,l)=>{var u;const d=(u=this.prevStats)===null||u===void 0?void 0:u.get(l);a+=yR(c,d)}),this._currentBitrate=a}this.prevStats=o}),this.senderLock=new qs}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Ro())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},W8))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return te(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Lg(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){r={error:u}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return te(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Lg(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){r={error:u}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return te(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===ve.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return te(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===ve.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return te(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},a=r.get(i.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((i,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=i.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let r=pa.LOW;r<=pa.HIGH;r+=1)n.push(new j8({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(n)}setDeviceId(e){return te(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===gu(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||gu(e)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(e){return te(this,void 0,void 0,function*(){var n,r,i,s;let o;if(e){const u=vR({video:e});typeof u.video!="boolean"&&(o=u.video)}yield this.restart(o);try{for(var a=!0,c=Lg(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const u=s;u.sender&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){r={error:u}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return te(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,c,l,u,d;if(yield n.setProcessor.call(i,r,s),!((u=i.processor)===null||u===void 0)&&u.processedTrack)try{for(var f=!0,p=Lg(i.simulcastCodecs.values()),m;m=yield p.next(),o=m.done,!o;f=!0)l=m.value,f=!1,yield(d=l.sender)===null||d===void 0?void 0:d.replaceTrack(i.processor.processedTrack)}catch(v){a={error:v}}finally{try{!f&&!o&&(c=p.return)&&(yield c.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return te(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},yPe))}setPublishingCodecs(e){return te(this,void 0,void 0,function*(){var n,r,i,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,r=Lg(e);i=yield r.next(),s=i.done,!s;n=!0){c=i.value,n=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const f of u.qualities)if(f.enabled){l.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield fH(d.sender,d.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e){return te(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield fH(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return te(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),pte()&&this.isInBackground&&this.source===ve.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function fH(t,e,n,r,i,s){return te(this,void 0,void 0,function*(){const o=yield r.lock();i.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const a=t.getParameters(),{encodings:c}=a;if(!c)return;if(c.length!==e.length){i.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:c,senderEncodings:e}));return}let l=!1;!1&&c[0].scalabilityMode||c.forEach((d,f)=>{var p;let m=(p=d.rid)!==null&&p!==void 0?p:"";m===""&&(m="q");const v=Cte(m),S=n.find(_=>_.quality===v);S&&d.active!==S.enabled&&(l=!0,d.active=S.enabled,i.debug("setting layer ".concat(S.quality," to ").concat(d.active?"enabled":"disabled"),s),dv()&&(S.enabled?(d.scaleResolutionDownBy=e[f].scaleResolutionDownBy,d.maxBitrate=e[f].maxBitrate,d.maxFrameRate=e[f].maxFrameRate):(d.scaleResolutionDownBy=4,d.maxBitrate=10,d.maxFrameRate=2)))}),l&&(a.encodings=c,i.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:a.encodings})),yield t.setParameters(a))}finally{o()}})}function Cte(t){switch(t){case"f":return pa.HIGH;case"h":return pa.MEDIUM;case"q":return pa.LOW;default:return pa.HIGH}}function hH(t,e,n,r){if(!n)return[new Nh({quality:pa.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,s=new Tte(i),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Nh({quality:Math.min(pa.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(i=>{var s,o,a;const c=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Cte((o=i.rid)!==null&&o!==void 0?o:"");return new Nh({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const pH="_lossy",gH="_reliable",_Pe=2*1e3,gP="leave-reconnect";var Ba;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ba||(Ba={}));class bPe extends ml.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=z8.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=Ba.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ot,this.handleDataChannel=r=>te(this,[r],void 0,function(i){var s=this;let{channel:o}=i;return function*(){if(o){if(o.label===gH)s.reliableDCSub=o;else if(o.label===pH)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=r=>te(this,void 0,void 0,function*(){var i,s;const o=yield this.dataProcessLock.lock();try{let a;if(r.data instanceof ArrayBuffer)a=r.data;else if(r.data instanceof Blob)a=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const c=pT.fromBinary(new Uint8Array(a));((i=c.value)===null||i===void 0?void 0:i.case)==="speaker"?this.emit($e.ActiveSpeakersUpdate,c.value.value.speakers):(((s=c.value)===null||s===void 0?void 0:s.case)==="user"&&wPe(c,c.value.value),this.emit($e.DataPacketReceived,c))}finally{o()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:o}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?vi.LOSSY:vi.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit($e.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}r===gP&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Pi.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Ba.Connected&&r();const s=()=>{this.off($e.Disconnected,o),r()},o=()=>{this.off($e.Restarted,s),i()};this.once($e.Restarted,s),this.once($e.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit($e.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Vn.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(hg.RR_SIGNAL_DISCONNECTED))},this.log=ku((n=e.loggerName)!==null&&n!==void 0?n:fc.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new G8(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new qs,this.dataProcessLock=new qs,this.dcBufferStatus=new Map([[vi.LOSSY,!0],[vi.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit($e.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit($e.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit($e.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit($e.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit($e.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit($e.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit($e.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit($e.SignalRequestResponse,r)}get logContext(){var e,n,r,i,s,o,a,c;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:(c=(a=this.latestJoinResponse)===null||a===void 0?void 0:a.participant)===null||c===void 0?void 0:c.sid}}join(e,n,r,i){return te(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate(),this.clientConfiguration=s.clientConfiguration,s}catch(s){if(s instanceof xn&&s.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw s}})}close(){return te(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.emit($e.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return te(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return te(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Vc("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new xn("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),n(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return te(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return te(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==ur.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new aPe(i,e.subscriberPrimary,this.loggerOptions),this.emit($e.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=s=>{this.client.sendOffer(s)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>te(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===ur.CONNECTED){const u=this.pcState===Ba.New;this.pcState=Ba.Connected,u&&this.emit($e.Connected,e)}else s===ur.FAILED&&this.pcState===Ba.Connected&&(this.pcState=Ba.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?hg.RR_SUBSCRIBER_FAILED:hg.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===Vn.RECONNECTING,l=[ur.FAILED,ur.CLOSING,ur.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit($e.Offline)}),this.pcManager.onTrack=s=>{this.emit($e.MediaTrackAdded,s.track,s.streams[0],s.receiver)},SPe((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>te(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=e=>te(this,void 0,void 0,function*(){if(!this.pcManager)return;const n=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit($e.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit($e.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit($e.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit($e.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",hg.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case Cm.DISCONNECT:this.emit($e.Disconnected,e==null?void 0:e.reason),this.close();break;case Cm.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(gP);break;case Cm.RESUME:this.handleDisconnect(gP)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===S_.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(pH,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(gH,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return te(this,void 0,void 0,function*(){if(PA())return yield this.createTransceiverRTCRtpSender(e,n,r);if(OA())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ur("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return te(this,void 0,void 0,function*(){if(PA())return this.createSimulcastTransceiverSender(e,n,r,i);if(OA())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ur("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return te(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ur("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),e instanceof Hi&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,r,i){return te(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ur("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return te(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ur("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return te(this,void 0,void 0,function*(){var n,r,i;if(!this._isClosed){if(this.attemptingReconnect){Ot.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===S_.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:ur.NEW)===ur.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof Ur?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof pg||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",hg.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit($e.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return te(this,void 0,void 0,function*(){var n,r,i;try{if(!this.url||!this.token)throw new Ur("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit($e.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new pg;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof xn&&o.reason===0?new Ur("could not reconnect, token might be expired"):new pg}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit($e.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Vn.CONNECTED)throw new pg("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit($e.Restarted)}catch(s){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return te(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ur("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ur("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit($e.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof xn&&i.reason===0?new Ur("could not reconnect, token might be expired"):i instanceof xn&&i.reason===4?i:new pg(s)}if(this.emit($e.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Vn.CONNECTED)throw new pg("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit($e.Resumed)})}waitForPCInitialConnection(e,n){return te(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ur("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return te(this,void 0,void 0,function*(){this.pcState=Ba.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield sl(_Pe),!this.pcManager)throw new Ur("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ba.Connected}catch(e){throw this.pcState=Ba.Disconnected,new xn("could not establish PC connection, ".concat(e.message))}})}sendDataPacket(e,n){return te(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(n);const i=this.dataChannelForKind(n);i&&i.send(r),this.updateAndEmitDCBufferStatus(n)})}ensureDataTransportConnected(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!r.pcManager)throw new Ur("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new xn("".concat(a," connection not set"));let c=!1;!i&&!r.dataChannelForKind(n,i)&&(r.createDataChannels(),c=!0),!c&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&r.negotiate();const l=r.dataChannelForKind(n,i);if((l==null?void 0:l.readyState)==="open")return;const u=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=r.dataChannelForKind(n,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield sl(50)}throw new xn("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return te(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==ur.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return te(this,void 0,void 0,function*(){return new Promise((e,n)=>te(this,void 0,void 0,function*(){if(!this.pcManager){n(new RA("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on($e.Closing,i),this.pcManager.publisher.once(xm.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();$3e(c)&&o.set(a.payload,c)}),this.emit($e.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof RA&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",hg.RR_UNKNOWN),n(s)}finally{this.off($e.Closing,i)}}))})}dataChannelForKind(e,n){if(n){if(e===vi.LOSSY)return this.lossyDCSub;if(e===vi.RELIABLE)return this.reliableDCSub}else{if(e===vi.LOSSY)return this.lossyDC;if(e===vi.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,i;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(i=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&i!==void 0?i:!0,c=new Array,l=new Array;e.forEach(u=>{u.isDesired!==a&&c.push(u.trackSid),u.isEnabled||l.push(u.trackSid)}),this.client.sendSyncState(new pee({answer:s?nk({sdp:s.sdp,type:s.type}):void 0,offer:o?nk({sdp:o.sdp,type:o.type}):void 0,subscription:new fR({trackSids:c,subscribe:!a,participantTracks:[]}),publishTracks:C3e(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:l}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,i)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new gee({label:r.label,id:r.id,target:i}))};return n(this.dataChannelForKind(vi.LOSSY),nc.PUBLISHER),n(this.dataChannelForKind(vi.RELIABLE),nc.PUBLISHER),n(this.dataChannelForKind(vi.LOSSY,!0),nc.SUBSCRIBER),n(this.dataChannelForKind(vi.RELIABLE,!0),nc.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Pi.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ro()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Ro()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class pg extends Error{}function SPe(t){return t!==void 0&&t>13}function wPe(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const r=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=r,e.destinationIdentities=r}class mH{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return AA(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return te(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(i=>i.url===r.url));if(n.length>0){const r=n[0];return this.attemptedRegions.push(r),Ot.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return te(this,void 0,void 0,function*(){const n=yield fetch("".concat(EPe(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const r=yield n.json();return this.lastUpdateAt=Date.now(),r}else throw new xn("Could not fetch region settings: ".concat(n.statusText),n.status===401?0:void 0,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function EPe(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class kte extends ve{constructor(e,n,r,i,s){super(e,r,s),this.sid=n,this.receiver=i}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ie.Muted:Ie.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Ie.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return te(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),W8)),k3e()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(Ie.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class Pm extends kte{constructor(e,n,r,i,s,o){super(e,n,ve.Kind.Audio,r,o),this.monitorReceiver=()=>te(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=yR(a,this.prevStats)),this.prevStats=a}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;Iu()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Iu())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return te(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(MA(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&MA(e)&&e.setSinkId(this.sinkId),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ie.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Ie.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return te(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const mP=100;class m0 extends kte{constructor(e,n,r,i,s){super(e,n,ve.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>te(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=yR(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=q8(()=>{this.updateDimensions()},mP),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Im(this._mediaStreamTrack,n):tm(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new TPe(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return te(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,n={type:"video",framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),n&&r!==""&&i.get(r)&&(n.mimeType=i.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return te(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,n;const r=this.elementInfos.reduce((a,c)=>Math.max(a,c.visibilityChangedAt||0),0),i=!((n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&n!==void 0)||n?this.isInBackground:!1,s=this.elementInfos.some(a=>a.pictureInPicture),o=this.elementInfos.some(a=>a.visible)&&!i||s;if(this.lastVisible!==o){if(!o&&Date.now()-r<mP){Pi.setTimeout(()=>{this.updateVisibility()},mP);return}this.lastVisible=o,this.emit(Ie.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let r=0,i=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>r+i&&(r=a,i=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Ie.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?tH():n||(tH()>2?2:1)}}class TPe{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:o}=r;s===this.element&&(this.isIntersecting=o,this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r;this.isPiP=!0,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=!1,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??vH(e),this.isPiP=Ro()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=vH(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;(e=this.handleResize)===null||e===void 0||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,rH().observe(this.element),nH().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,n;(e=rH())===null||e===void 0||e.unobserve(this.element),(n=nH())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function vH(t){let e=t.offsetTop,n=t.offsetLeft;const r=t.offsetWidth,i=t.offsetHeight,{hidden:s}=t,{opacity:o,display:a}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop,n+=t.offsetLeft;return e<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&e+i>window.pageYOffset&&n+r>window.pageXOffset&&!s&&(o!==""?parseFloat(o)>0:!0)&&a!=="none"}class Yl extends ml.EventEmitter{constructor(e,n,r,i){var s;super(),this.metadataMuted=!1,this.encryption=ra.NONE,this.log=Ot,this.handleMuted=()=>{this.emit(Ie.Muted)},this.handleUnmuted=()=>{this.emit(Ie.Unmuted)},this.log=ku((s=i==null?void 0:i.loggerName)!==null&&s!==void 0?s:fc.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=ve.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ie.Muted,this.handleMuted),this.track.off(Ie.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ie.Muted,this.handleMuted),e.on(Ie.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Sn(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==ra.NONE}get audioTrack(){if(this.track instanceof bi||this.track instanceof Pm)return this.track}get videoTrack(){if(this.track instanceof Hi||this.track instanceof m0)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=ve.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===ve.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Yl||(Yl={}));class rk extends Yl{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ie.Ended)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&this.track.off(Ie.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(Ie.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){return te(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return te(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return te(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return te(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(this.track instanceof bi){const n=this.track.mediaStreamTrack.getSettings(),r=new Set;return n.autoGainControl&&r.add(Kc.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(Kc.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(Kc.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(Kc.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(Kc.TF_STEREO),this.track.enhancedNoiseCancellation&&r.add(Kc.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function Rte(t){let e,n;return typeof t.audio=="object"&&t.audio.processor&&(e=t.audio.processor),typeof t.video=="object"&&t.video.processor&&(n=t.video.processor),{audioProcessor:e,videoProcessor:n}}function Y8(t){return te(this,void 0,void 0,function*(){var e,n;t??(t={}),(e=t.audio)!==null&&e!==void 0||(t.audio=!0),(n=t.video)!==null&&n!==void 0||(t.video=!0);const{audioProcessor:r,videoProcessor:i}=Rte(t),s=fte(t,Ste,wte),o=vR(s),a=navigator.mediaDevices.getUserMedia(o);t.audio&&(Ci.userMediaPromiseMap.set("audioinput",a),a.catch(()=>Ci.userMediaPromiseMap.delete("audioinput"))),t.video&&(Ci.userMediaPromiseMap.set("videoinput",a),a.catch(()=>Ci.userMediaPromiseMap.delete("videoinput")));const c=yield a;return Promise.all(c.getTracks().map(l=>te(this,void 0,void 0,function*(){const u=l.kind==="audio";u?s.audio:s.video;let d;const f=u?o.audio:o.video;typeof f!="boolean"&&(d=f),d?d.deviceId=l.getSettings().deviceId:d={deviceId:l.getSettings().deviceId};const p=Ete(l,d);return p.kind===ve.Kind.Video?p.source=ve.Source.Camera:p.kind===ve.Kind.Audio&&(p.source=ve.Source.Microphone),p.mediaStream=c,p instanceof bi&&r?yield p.setProcessor(r):p instanceof Hi&&i&&(yield p.setProcessor(i)),p})))})}function CPe(t){return te(this,void 0,void 0,function*(){return(yield Y8({audio:!1,video:t}))[0]})}function kPe(t){return te(this,void 0,void 0,function*(){return(yield Y8({audio:t,video:!1}))[0]})}var Cd;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Cd||(Cd={}));function RPe(t){switch(t){case N1.EXCELLENT:return Cd.Excellent;case N1.GOOD:return Cd.Good;case N1.POOR:return Cd.Poor;case N1.LOST:return Cd.Lost;default:return Cd.Unknown}}class Ite extends ml.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===QC.AGENT}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:QC.STANDARD;var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Cd.Unknown,this.log=Ot,this.log=ku((a=s==null?void 0:s.loggerName)!==null&&a!==void 0?a:fc.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes={}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(ve.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(ve.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(ve.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(le.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(le.ParticipantNameChanged,e)}_setAttributes(e){const n=R3e(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(le.AttributesChanged,n)}setPermissions(e){var n,r,i,s,o;const a=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((l,u)=>{var d;return l!==((d=this.permissions)===null||d===void 0?void 0:d.canPublishSources[u])});return this.permissions=e,c&&this.emit(le.ParticipantPermissionsChanged,a),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(le.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=RPe(e),n!==this._connectionQuality&&this.emit(le.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>(n.track instanceof Pm||n.track instanceof bi)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Ie.Muted,()=>{this.emit(le.TrackMuted,e)}),e.on(Ie.Unmuted,()=>{this.emit(le.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case ve.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case ve.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function IPe(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new fee({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}class UA extends Ite{constructor(e,n,r,i){super(e,n,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=ra.NONE,this.enabledPublishVideoCodecs=[],this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new vte)},this.handleReconnected=()=>{var s,o;(o=(s=this.reconnectFuture)===null||s===void 0?void 0:s.resolve)===null||o===void 0||o.call(s),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var s,o;this.reconnectFuture&&(this.reconnectFuture.promise.catch(a=>this.log.warn(a.message,this.logContext)),(o=(s=this.reconnectFuture)===null||s===void 0?void 0:s.reject)===null||o===void 0||o.call(s,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.handleSignalRequestResponse=s=>{const{requestId:o,reason:a,message:c}=s,l=this.pendingSignalRequests.get(o);l&&(a!==vee.OK&&l.reject(new Xj(c,a)),this.pendingSignalRequests.delete(o))},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(s=>IPe(s)))},this.onTrackUnmuted=s=>{this.onTrackMuted(s,s.isUpstreamPaused)},this.onTrackMuted=(s,o)=>{if(o===void 0&&(o=!0),!s.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Sn(s)));return}this.engine.updateMuteStatus(s.sid,o)},this.onTrackUpstreamPaused=s=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Sn(s))),this.onTrackMuted(s,!0)},this.onTrackUpstreamResumed=s=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Sn(s))),this.onTrackMuted(s,s.isMuted)},this.onTrackFeatureUpdate=s=>{const o=this.audioTrackPublications.get(s.sid);if(!o){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(s.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(o.trackSid,o.getTrackFeatures())},this.handleSubscribedQualityUpdate=s=>te(this,void 0,void 0,function*(){var o,a,c,l,u,d;if(!(!((u=this.roomOptions)===null||u===void 0)&&u.dynacast))return;const f=this.videoTrackPublications.get(s.trackSid);if(!f){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}if(s.subscribedCodecs.length>0){if(!f.videoTrack)return;const S=yield f.videoTrack.setPublishingCodecs(s.subscribedCodecs);try{for(var p=!0,m=Lg(S),v;v=yield m.next(),o=v.done,!o;p=!0){l=v.value,p=!1;const _=l;b3e(_)&&(this.log.debug("publish ".concat(_," for ").concat(f.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Sn(f))),yield this.publishAdditionalCodecForTrack(f.videoTrack,_,f.options))}}catch(_){a={error:_}}finally{try{!p&&!o&&(c=m.return)&&(yield c.call(m))}finally{if(a)throw a.error}}}else s.subscribedQualities.length>0&&(yield(d=f.videoTrack)===null||d===void 0?void 0:d.setPublishingLayers(s.subscribedQualities))}),this.handleLocalTrackUnpublished=s=>{const o=this.trackPublications.get(s.trackSid);if(!o){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:s.trackSid}));return}this.unpublishTrack(o.track)},this.handleTrackEnded=s=>te(this,void 0,void 0,function*(){if(s.source===ve.Source.ScreenShare||s.source===ve.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Sn(s))),this.unpublishTrack(s);else if(s.isUserProvided)yield s.mute();else if(s instanceof bi||s instanceof Hi)try{if(Ro())try{const o=yield navigator==null?void 0:navigator.permissions.query({name:s.source===ve.Source.Camera?"camera":"microphone"});if(o&&o.state==="denied")throw this.log.warn("user has revoked access to ".concat(s.source),Object.assign(Object.assign({},this.logContext),Sn(s))),o.onchange=()=>{o.state!=="denied"&&(s.isMuted||s.restartTrack(),o.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}s.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Sn(s))),s instanceof bi?yield s.restartTrack({deviceId:"default"}):yield s.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Sn(s))),yield s.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map,this.pendingSignalRequests=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==ra.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){this.engine=e,this.engine.on($e.RemoteMute,(n,r)=>{const i=this.trackPublications.get(n);!i||!i.track||(r?i.mute():i.unmute())}),this.engine.on($e.Connected,this.handleReconnected).on($e.SignalRestarted,this.handleReconnected).on($e.SignalResumed,this.handleReconnected).on($e.Restarting,this.handleReconnecting).on($e.Resuming,this.handleReconnecting).on($e.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on($e.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on($e.Disconnected,this.handleDisconnected).on($e.SignalRequestResponse,this.handleSignalRequestResponse)}setMetadata(e){return te(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return te(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return te(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return te(this,arguments,void 0,function(n){var r=this;let{metadata:i,name:s,attributes:o}=n;return function*(){return new Promise((a,c)=>te(r,void 0,void 0,function*(){var l,u;try{let d=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((l=i??this.metadata)!==null&&l!==void 0?l:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(f,{resolve:a,reject:m=>{c(m),d=!0},values:{name:s,metadata:i,attributes:o}});performance.now()-p<5e3&&!d;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(m=>{let[v,S]=m;return this.attributes[v]===S}))){this.pendingSignalRequests.delete(f),a();return}yield sl(50)}c(new Xj("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&c(d)}}))}()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(ve.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(ve.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(ve.Source.ScreenShare,e,n,r)}setPermissions(e){const n=this.permissions,r=super.setPermissions(e);return r&&n&&this.emit(le.ParticipantPermissionsChanged,n),r}setE2EEEnabled(e){return te(this,void 0,void 0,function*(){this.encryptionType=e?ra.GCM:ra.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){return te(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:e})),yield l==null?void 0:l.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case ve.Source.Camera:c=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case ve.Source.Microphone:c=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case ve.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Vc(e)}const l=[];for(const d of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Sn(d))),l.push(this.publishTrack(d,i));[a]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&!(l instanceof Vc)&&this.emit(le.MediaDevicesError,l),l}finally{this.pendingPublishing.delete(e)}}else if(a!=null&&a.track||(a=yield this.waitForPendingPublicationOfSource(e)),a&&a.track)if(e===ve.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(ve.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return te(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(ve.Source.Camera)||this.pendingPublishing.has(ve.Source.Microphone))){this.pendingPublishing.add(ve.Source.Camera),this.pendingPublishing.add(ve.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(ve.Source.Camera),this.pendingPublishing.delete(ve.Source.Microphone)}}})}createTracks(e){return te(this,void 0,void 0,function*(){var n,r;e??(e={});const{audioProcessor:i,videoProcessor:s}=Rte(e),o=fte(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults),a=vR(o);let c;try{c=yield navigator.mediaDevices.getUserMedia(a)}catch(l){throw l instanceof Error&&(a.audio&&(this.microphoneError=l),a.video&&(this.cameraError=l)),l}return a.audio&&(this.microphoneError=void 0,this.emit(le.AudioStreamAcquired)),a.video&&(this.cameraError=void 0),Promise.all(c.getTracks().map(l=>te(this,void 0,void 0,function*(){const u=l.kind==="audio";u?o.audio:o.video;let d;const f=u?a.audio:a.video;typeof f!="boolean"&&(d=f);const p=Ete(l,d,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return p.kind===ve.Kind.Video?p.source=ve.Source.Camera:p.kind===ve.Kind.Audio&&(p.source=ve.Source.Microphone,p.setAudioContext(this.audioContext)),p.mediaStream=c,p instanceof bi&&i?yield p.setProcessor(i):p instanceof Hi&&s&&(yield p.setProcessor(s)),p})))})}createScreenTracks(e){return te(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new V8("getDisplayMedia not supported");e.resolution===void 0&&!A3e()&&(e.resolution=mR.h1080fps30.resolution);const n=T3e(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new Vc("no video track found");const s=new Hi(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=ve.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(r.getAudioTracks().length>0){this.emit(le.AudioStreamAcquired);const a=new bi(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=ve.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return te(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return te(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u;r instanceof bi&&r.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),r instanceof Jd&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let d;if(r instanceof MediaStreamTrack)d=r.getConstraints();else{d=r.constraints;let _;switch(r.source){case ve.Source.Microphone:_="audioinput";break;case ve.Source.Camera:_="videoinput"}_&&s.activeDeviceMap.has(_)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(_)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new bi(r,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new Hi(r,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Vc("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let f;if(s.trackPublications.forEach(_=>{_.track&&_.track===r&&(f=_)}),f)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Sn(f))),f;const p="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,m=(c=i==null?void 0:i.forceStereo)!==null&&c!==void 0?c:p;m&&(i||(i={}),i.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Sn(r))),i.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=i.dtx)!==null&&l!==void 0||(i.dtx=!1),(u=i.red)!==null&&u!==void 0||(i.red=!1));const v=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i);!L3e()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),v.simulcast=!1),v.source&&(r.source=v.source);const S=s.publish(r,v,m);s.pendingPublishPromises.set(r,S);try{return yield S}catch(_){throw _}finally{s.pendingPublishPromises.delete(r)}}()})}publish(e,n,r){return te(this,void 0,void 0,function*(){var i,s,o,a,c,l,u,d,f,p;Array.from(this.trackPublications.values()).find(I=>e instanceof Jd&&I.source===e.source)&&e.source!==ve.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Sn(e))),n.stopMicTrackOnMute&&e instanceof bi&&(e.stopOnMute=!0),e.source===ve.Source.ScreenShare&&dv()&&(n.simulcast=!1),n.videoCodec==="av1"&&!P3e()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!O3e()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=LA),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(I=>n.videoCodec===ET(I.mime))||(n.videoCodec=ET(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(Ie.Muted,this.onTrackMuted),e.on(Ie.Unmuted,this.onTrackUnmuted),e.on(Ie.Ended,this.handleTrackEnded),e.on(Ie.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ie.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Ie.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const S=new _A({cid:e.mediaStreamTrack.id,name:n.name,type:ve.kindToProto(e.kind),muted:e.isMuted,source:ve.sourceToProto(e.source),disableDtx:!(!((i=n.dtx)!==null&&i!==void 0)||i),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream});let _;if(e.kind===ve.Kind.Video){let I={width:0,height:0};try{I=yield e.waitForDimensions()}catch{const O=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Qc.h720.resolution;I={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Sn(e)),{dims:I}))}S.width=I.width,S.height=I.height,e instanceof Hi&&(p0(v)&&(e.source===ve.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Sn(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),S.simulcastCodecs=[new yA({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:LA}),n.backupCodec&&v!==n.backupCodec.codec&&S.encryption===ra.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new yA({codec:n.backupCodec.codec,cid:""})))),_=NA(e.source===ve.Source.ScreenShare,S.width,S.height,n),S.layers=hH(S.width,S.height,_,p0(n.videoCodec))}else e.kind===ve.Kind.Audio&&(_=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ur("cannot publish track when not connected");const w=()=>te(this,void 0,void 0,function*(){var I,R,O;if(!this.engine.pcManager)throw new Ur("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,_),e instanceof Hi&&((I=n.degradationPreference)!==null&&I!==void 0||(n.degradationPreference=vPe(e)),e.setDegradationPreference(n.degradationPreference)),_)if(dv()&&e.kind===ve.Kind.Audio){let A;for(const U of this.engine.pcManager.publisher.getTransceivers())if(U.sender===e.sender){A=U;break}A&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:A,codec:"opus",maxbr:!((R=_[0])===null||R===void 0)&&R.maxBitrate?_[0].maxBitrate/1e3:0})}else e.codec&&p0(e.codec)&&(!((O=_[0])===null||O===void 0)&&O.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:_[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([this.engine.addTrack(S),w()]))[0];else{T=yield this.engine.addTrack(S);let I;if(T.codecs.forEach(R=>{I===void 0&&(I=R.mimeType)}),I&&e.kind===ve.Kind.Video){const R=ET(I);R!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Sn(e)),{codec:R})),n.videoCodec=R,_=NA(e.source===ve.Source.ScreenShare,S.width,S.height,n))}yield w()}const C=new rk(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return C.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:_,trackInfo:T})),e instanceof Hi?e.startMonitor(this.engine.client):e instanceof bi&&e.startMonitor(),this.addTrackPublication(C),this.emit(le.LocalTrackPublished,C),C})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return te(this,void 0,void 0,function*(){var i;if(this.encryptionType!==ra.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new Vc("track is not published");if(!(e instanceof Hi))throw new Vc("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=pPe(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Sn(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new _A({cid:c.mediaStreamTrack.id,type:ve.kindToProto(e.kind),muted:e.isMuted,source:ve.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=hH(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new Ur("cannot publish track when not connected");const u=()=>te(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(l),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:f}))})}unpublishTrack(e,n){return te(this,void 0,void 0,function*(){var r,i;if(e instanceof Jd){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Sn(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Sn(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(Ie.Muted,this.onTrackMuted),e.off(Ie.Unmuted,this.onTrackUnmuted),e.off(Ie.Ended,this.handleTrackEnded),e.off(Ie.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ie.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Ie.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n&&e.stop();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<ur.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),e instanceof Hi){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case ve.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case ve.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(le.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return te(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>r instanceof rk)})}republishAllTracks(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,o)=>te(r,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>te(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),i&&!l.isMuted&&l.source!==ve.Source.ScreenShare&&l.source!==ve.Source.ScreenShareAudio&&(l instanceof bi||l instanceof Hi)&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield r.republishPromise}()})}publishData(e){return te(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=i.reliable?vi.RELIABLE:vi.LOSSY,o=i.destinationIdentities,a=i.topic,c=new pT({kind:s,value:{case:"user",value:new tee({participantIdentity:r.identity,payload:n,destinationIdentities:o,topic:a})}});yield r.engine.sendDataPacket(c,s)}()})}sendChatMessage(e){return te(this,void 0,void 0,function*(){const n={id:crypto.randomUUID(),message:e,timestamp:Date.now()},r=new pT({value:{case:"chatMessage",value:new mA(Object.assign(Object.assign({},n),{timestamp:Yn.parse(n.timestamp)}))}});return yield this.engine.sendDataPacket(r,vi.RELIABLE),this.emit(le.ChatMessage,n),n})}editChatMessage(e,n){return te(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),i=new pT({value:{case:"chatMessage",value:new mA(Object.assign(Object.assign({},r),{timestamp:Yn.parse(r.timestamp),editTimestamp:Yn.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,vi.RELIABLE),this.emit(le.ChatMessage,r),r})}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(n=>{var r,i;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Sn(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(i instanceof bi||i instanceof Hi)&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}waitForPendingPublicationOfSource(e){return te(this,void 0,void 0,function*(){const n=Array.from(this.pendingPublishPromises.entries()).find(r=>{let[i]=r;return i.source===e});if(n)return n[1]})}}class C_ extends Yl{constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=pa.HIGH,this.handleEnded=s=>{this.setTrack(void 0),this.emit(Ie.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.disabled=!s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensions=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new fR({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new nee({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ie.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Yl.SubscriptionStatus.Unsubscribed:super.isSubscribed?Yl.SubscriptionStatus.Subscribed:Yl.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Yl.PermissionStatus.Allowed:Yl.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.videoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(this.track instanceof m0&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof m0&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Ie.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Ie.VisibilityChanged,this.handleVisibilityChange),i.off(Ie.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Ie.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ie.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ie.VisibilityChanged,this.handleVisibilityChange),e.on(Ie.Ended,this.handleEnded),this.emit(Ie.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Ie.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Ie.Muted:Ie.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Ie.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ie.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===ve.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof m0&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new aee({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=pa.HIGH,this.emit(Ie.UpdateSettings,e)}}class ik extends Ite{static fromParticipantInfo(e,n,r){return new ik(e,n.sid,n.identity,n.name,n.metadata,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,i,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:QC.STANDARD;super(n,r||"",i,s,o,a),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ie.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),Sn(e))),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Ie.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Ie.SubscriptionPermissionChanged,n=>{this.emit(le.TrackSubscriptionPermissionChanged,e,n)}),e.on(Ie.SubscriptionStatusChanged,n=>{this.emit(le.TrackSubscriptionStatusChanged,e,n)}),e.on(Ie.Subscribed,n=>{this.emit(le.TrackSubscribed,n,e)}),e.on(Ie.Unsubscribed,n=>{this.emit(le.TrackUnsubscribed,n,e)}),e.on(Ie.SubscriptionFailed,n=>{this.emit(le.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ve.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ve.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(le.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Sn(a))),this.emit(le.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new m0(e,n,i,s):l=new Pm(e,n,i,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(r),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&l instanceof Pm&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var s,o;let a=this.getTrackPublicationBySid(i.sid);if(a)a.updateInfo(i);else{const c=ve.kindFromProto(i.type);if(!c)return;a=new C_(c,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(i),r.set(i.sid,a);const l=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));l&&a.source!==ve.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Sn(l),newTrack:Sn(a)})),this.addTrackPublication(a)}n.set(i.sid,a)}),this.trackPublications.forEach(i=>{n.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Sn(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(le.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case ve.Kind.Audio:this.audioTrackPublications.delete(e);break;case ve.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(le.TrackUnpublished,r)}setAudioOutput(e){return te(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var i;r.track instanceof Pm&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Dt;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Dt||(Dt={}));const xPe=4*1e3;class k_ extends ml.EventEmitter{constructor(e){var n,r,i;super(),n=this,this.state=Dt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ot,this.bufferedEvents=[],this.isResuming=!1,this.connect=(s,o,a)=>te(this,void 0,void 0,function*(){var c;if(!M3e())throw Iu()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const l=yield this.disconnectLock.lock();if(this.state===Dt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),l(),Promise.resolve();if(this.connectFuture)return l(),this.connectFuture.promise;this.setAndEmitConnectionState(Dt.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==s&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),AA(new URL(s))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new mH(s,o):this.regionUrlProvider.updateToken(o),this.regionUrlProvider.fetchRegionSettings().then(f=>{var p;(p=this.regionUrlProvider)===null||p===void 0||p.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const u=(f,p,m)=>te(this,void 0,void 0,function*(){var v,S;this.abortController&&this.abortController.abort();const _=new AbortController;this.abortController=_,l==null||l();try{yield this.attemptConnection(m??s,o,a,_),this.abortController=void 0,f()}catch(w){if(this.regionUrlProvider&&w instanceof xn&&w.reason!==3&&w.reason!==0){let T=null;try{T=yield this.regionUrlProvider.getNextBestRegionUrl((v=this.abortController)===null||v===void 0?void 0:v.signal)}catch(C){if(C instanceof xn&&(C.status===401||C.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(C);return}}T&&!(!((S=this.abortController)===null||S===void 0)&&S.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(w.message,". Retrying with another region: ").concat(T),this.logContext),this.recreateEngine(),yield u(f,p,T)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(w))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),p(w)}}),d=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new vte((f,p)=>{u(f,p,d)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(s,o,a,c,l,u)=>te(this,void 0,void 0,function*(){var d,f,p;const m=yield a.join(s,o,{autoSubscribe:c.autoSubscribe,adaptiveStream:typeof l.adaptiveStream=="object"?!0:l.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout},u.signal);let v=m.serverInfo;if(v||(v={version:m.serverVersion,region:m.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(v).map(S=>{let[_,w]=S;return"".concat(_,": ").concat(w)}).join(", ")),{room:(d=m.room)===null||d===void 0?void 0:d.name,roomSid:(f=m.room)===null||f===void 0?void 0:f.sid,identity:(p=m.participant)===null||p===void 0?void 0:p.identity}),!m.serverVersion)throw new h3e("unknown server version");return m.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),l.dynacast=!1),m}),this.applyJoinResponse=s=>{const o=s.participant;if(this.localParticipant.sid=o.sid,this.localParticipant.identity=o.identity,this.localParticipant.setEnabledPublishCodecs(s.enabledPublishCodecs),this.options.e2ee&&this.e2eeManager)try{this.e2eeManager.setSifTrailer(s.sifTrailer)}catch(a){this.log.error(a instanceof Error?a.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:a}))}this.handleParticipantUpdates([o,...s.otherParticipants]),s.room&&this.handleRoomUpdate(s.room)},this.attemptConnection=(s,o,a,c)=>te(this,void 0,void 0,function*(){var l,u,d;this.state===Dt.Reconnecting||this.isResuming||!((l=this.engine)===null||l===void 0)&&l.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((u=this.regionUrlProvider)===null||u===void 0)&&u.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},z8),a),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const f=yield this.connectSignal(s,o,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(f),this.setupLocalParticipantEvents(),this.emit(fe.SignalConnected)}catch(f){yield this.engine.close(),this.recreateEngine();const p=new xn("could not establish signal connection");throw f instanceof Error&&(p.message="".concat(p.message,": ").concat(f.message)),f instanceof xn&&(p.reason=f.reason,p.status=f.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:f})),p}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new xn("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(f){throw yield this.engine.close(),this.recreateEngine(),f}Ro()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ro()&&(document.addEventListener("freeze",this.onPageLeave),(d=navigator.mediaDevices)===null||d===void 0||d.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(Dt.Connected),this.emit(fe.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return te(n,[...o],void 0,function(){var c=this;let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var u,d,f,p;const m=yield c.disconnectLock.lock();try{if(c.state===Dt.Disconnected){c.log.debug("already disconnected",c.logContext);return}c.log.info("disconnect from room",Object.assign({},c.logContext)),(c.state===Dt.Connecting||c.state===Dt.Reconnecting||c.isResuming)&&(c.log.warn("abort connection attempt",c.logContext),(u=c.abortController)===null||u===void 0||u.abort(),(f=(d=c.connectFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new xn("Client initiated disconnect")),c.connectFuture=void 0),!((p=c.engine)===null||p===void 0)&&p.client.isDisconnected||(yield c.engine.client.sendLeave()),c.engine&&(yield c.engine.close()),c.handleDisconnect(l,Tm.CLIENT_INITIATED),c.engine=void 0}finally{m()}}()})},this.onPageLeave=()=>te(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>te(this,void 0,void 0,function*(){const s=[],o=Ru();if(o&&o.os==="iOS"){const a="livekit-dummy-audio-el";let c=document.getElementById(a);if(!c){c=document.createElement("audio"),c.id=a,c.autoplay=!0,c.hidden=!0;const l=uP();l.enabled=!0;const u=new MediaStream([l]);c.srcObject=u,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:u,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once(fe.Disconnected,()=>{c==null||c.remove(),c=null})}s.push(c)}this.remoteParticipants.forEach(a=>{a.audioTrackPublications.forEach(c=>{c.track&&c.track.attachedElements.forEach(l=>{s.push(l)})})});try{yield Promise.all([this.acquireAudioContext(),...s.map(a=>(a.muted=!1,a.play()))]),this.handleAudioPlaybackStarted()}catch(a){throw this.handleAudioPlaybackFailed(a),a}}),this.startVideo=()=>te(this,void 0,void 0,function*(){const s=[];for(const o of this.remoteParticipants.values())o.videoTrackPublications.forEach(a=>{var c;(c=a.track)===null||c===void 0||c.attachedElements.forEach(l=>{s.includes(l)||s.push(l)})});yield Promise.all(s.map(o=>o.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(o=>{o.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const s of this.remoteParticipants.values())this.handleParticipantDisconnected(s.identity,s);this.setAndEmitConnectionState(Dt.Reconnecting)&&this.emit(fe.Reconnecting)},this.handleSignalRestarted=s=>te(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(s.serverRegion),Object.assign(Object.assign({},this.logContext),{region:s.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(s);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(o){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:o}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:s.serverRegion}))}catch{return}this.setAndEmitConnectionState(Dt.Connected),this.emit(fe.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=s=>{s.forEach(o=>{var a;if(o.identity===this.localParticipant.identity){this.localParticipant.updateInfo(o);return}o.identity===""&&(o.identity=(a=this.sidToIdentity.get(o.sid))!==null&&a!==void 0?a:"");let c=this.remoteParticipants.get(o.identity);o.state===gA.DISCONNECTED?this.handleParticipantDisconnected(o.identity,c):c=this.getOrCreateParticipant(o.identity,o)})},this.handleActiveSpeakersUpdate=s=>{const o=[],a={};s.forEach(c=>{if(a[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),o.push(this.localParticipant);else{const l=this.getRemoteParticipantBySid(c.sid);l&&(l.audioLevel=c.level,l.setIsSpeaking(!0),o.push(l))}}),a[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(c=>{a[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=o,this.emitWhenConnected(fe.ActiveSpeakersChanged,o)},this.handleSpeakersChanged=s=>{const o=new Map;this.activeSpeakers.forEach(c=>{const l=this.remoteParticipants.get(c.identity);l&&l.sid!==c.sid||o.set(c.sid,c)}),s.forEach(c=>{let l=this.getRemoteParticipantBySid(c.sid);c.sid===this.localParticipant.sid&&(l=this.localParticipant),l&&(l.audioLevel=c.level,l.setIsSpeaking(c.active),c.active?o.set(c.sid,l):o.delete(c.sid))});const a=Array.from(o.values());a.sort((c,l)=>l.audioLevel-c.audioLevel),this.activeSpeakers=a,this.emitWhenConnected(fe.ActiveSpeakersChanged,a)},this.handleStreamStateUpdate=s=>{s.streamStates.forEach(o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);!c||!c.track||(c.track.streamState=ve.streamStateFromProto(o.state),a.emit(le.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(fe.TrackStreamStateChanged,c,c.track.streamState,a))})},this.handleSubscriptionPermissionUpdate=s=>{const o=this.getRemoteParticipantBySid(s.participantSid);if(!o)return;const a=o.getTrackPublicationBySid(s.trackSid);a&&a.setAllowed(s.allowed)},this.handleSubscriptionError=s=>{const o=Array.from(this.remoteParticipants.values()).find(c=>c.trackPublications.has(s.trackSid));if(!o)return;const a=o.getTrackPublicationBySid(s.trackSid);a&&a.setSubscriptionError(s.err)},this.handleDataPacket=s=>{const o=this.remoteParticipants.get(s.participantIdentity);s.value.case==="user"?this.handleUserPacket(o,s.value.value,s.kind):s.value.case==="transcription"?this.handleTranscription(o,s.value.value):s.value.case==="sipDtmf"?this.handleSipDtmf(o,s.value.value):s.value.case==="chatMessage"&&this.handleChatMessage(o,s.value.value)},this.handleUserPacket=(s,o,a)=>{this.emit(fe.DataReceived,o.payload,s,a,o.topic),s==null||s.emit(le.DataReceived,o.payload,a)},this.handleSipDtmf=(s,o)=>{this.emit(fe.SipDTMFReceived,o,s),s==null||s.emit(le.SipDTMFReceived,o)},this.bufferedSegments=new Map,this.handleTranscription=(s,o)=>{const a=o.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(o.transcribedParticipantIdentity),c=a==null?void 0:a.trackPublications.get(o.trackId),l=B3e(o,this.transcriptionReceivedTimes);c==null||c.emit(Ie.TranscriptionReceived,l),a==null||a.emit(le.TranscriptionReceived,l,c),this.emit(fe.TranscriptionReceived,l,a,c)},this.handleChatMessage=(s,o)=>{const a=j3e(o);this.emit(fe.ChatMessage,a,s)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(fe.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=s=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:s})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(fe.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(fe.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(fe.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>te(this,void 0,void 0,function*(){const s=yield Ci.getInstance().getDevices(void 0,!1),o=["audiooutput"];for(let a of o){const c=s.filter(l=>l.kind===a);c.length>0&&!c.find(l=>l.deviceId===this.getActiveDevice(a))&&(yield this.switchActiveDevice(a,c[0].deviceId))}this.emit(fe.MediaDevicesChanged)}),this.handleRoomUpdate=s=>{const o=this.roomInfo;this.roomInfo=s,o&&o.metadata!==s.metadata&&this.emitWhenConnected(fe.RoomMetadataChanged,s.metadata),(o==null?void 0:o.activeRecording)!==s.activeRecording&&this.emitWhenConnected(fe.RecordingStatusChanged,s.activeRecording)},this.handleConnectionQualityUpdate=s=>{s.updates.forEach(o=>{if(o.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(o.quality);return}const a=this.getRemoteParticipantBySid(o.participantSid);a&&a.setConnectionQuality(o.quality)})},this.onLocalParticipantMetadataChanged=s=>{this.emit(fe.ParticipantMetadataChanged,s,this.localParticipant)},this.onLocalParticipantNameChanged=s=>{this.emit(fe.ParticipantNameChanged,s,this.localParticipant)},this.onLocalAttributesChanged=s=>{this.emit(fe.ParticipantAttributesChanged,s,this.localParticipant)},this.onLocalTrackMuted=s=>{this.emit(fe.TrackMuted,s,this.localParticipant)},this.onLocalTrackUnmuted=s=>{this.emit(fe.TrackUnmuted,s,this.localParticipant)},this.onTrackProcessorUpdate=s=>{var o;(o=s==null?void 0:s.onPublish)===null||o===void 0||o.call(s,this)},this.onLocalTrackPublished=s=>te(this,void 0,void 0,function*(){var o,a,c,l,u,d;(o=s.track)===null||o===void 0||o.on(Ie.TrackProcessorUpdate,this.onTrackProcessorUpdate),(a=s.track)===null||a===void 0||a.on(Ie.Restarted,this.onLocalTrackRestarted),(u=(l=(c=s.track)===null||c===void 0?void 0:c.getProcessor())===null||l===void 0?void 0:l.onPublish)===null||u===void 0||u.call(l,this),this.emit(fe.LocalTrackPublished,s,this.localParticipant),s.track instanceof bi&&(yield s.track.checkForSilence())&&this.emit(fe.LocalAudioSilenceDetected,s);const f=yield(d=s.track)===null||d===void 0?void 0:d.getDeviceId(),p=Qj(s.source);p&&f&&f!==this.localParticipant.activeDeviceMap.get(p)&&(this.localParticipant.activeDeviceMap.set(p,f),this.emit(fe.ActiveDeviceChanged,p,f))}),this.onLocalTrackUnpublished=s=>{var o,a;(o=s.track)===null||o===void 0||o.off(Ie.TrackProcessorUpdate,this.onTrackProcessorUpdate),(a=s.track)===null||a===void 0||a.off(Ie.Restarted,this.onLocalTrackRestarted),this.emit(fe.LocalTrackUnpublished,s,this.localParticipant)},this.onLocalTrackRestarted=s=>te(this,void 0,void 0,function*(){const o=yield s.getDeviceId(!1),a=Qj(s.source);a&&o&&o!==this.localParticipant.activeDeviceMap.get(a)&&(this.log.debug("local track restarted, setting ".concat(a," ").concat(o," active"),this.logContext),this.localParticipant.activeDeviceMap.set(a,o),this.emit(fe.ActiveDeviceChanged,a,o))}),this.onLocalConnectionQualityChanged=s=>{this.emit(fe.ConnectionQualityChanged,s,this.localParticipant)},this.onMediaDevicesError=s=>{this.emit(fe.MediaDevicesError,s)},this.onLocalParticipantPermissionsChanged=s=>{this.emit(fe.ParticipantPermissionsChanged,s,this.localParticipant)},this.onLocalChatMessageSent=s=>{this.emit(fe.ChatMessage,s,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},oPe),e),this.log=ku((r=this.options.loggerName)!==null&&r!==void 0?r:fc.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Ste),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},wte),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},sPe),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new qs,this.localParticipant=new UA("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",gu(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",gu(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",gu(this.options.audioOutput.deviceId)).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return te(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new K3e(this.options.e2ee),this.e2eeManager.on(Md.ParticipantEncryptionStatusChanged,(n,r)=>{r instanceof UA&&(this.isE2EEEnabled=n),this.emit(fe.ParticipantEncryptionStatusChanged,n,r)}),this.e2eeManager.on(Md.EncryptionError,n=>this.emit(fe.EncryptionError,n)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return te(this,void 0,void 0,function*(){return this.state===Dt.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=i=>{i.sid!==""&&(this.engine.off($e.RoomUpdate,r),e(i.sid))};this.engine.on($e.RoomUpdate,r),this.once(fe.Disconnected,()=>{this.engine.off($e.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new bPe(this.options),this.engine.on($e.ParticipantUpdate,this.handleParticipantUpdates).on($e.RoomUpdate,this.handleRoomUpdate).on($e.SpeakersChanged,this.handleSpeakersChanged).on($e.StreamStateChanged,this.handleStreamStateUpdate).on($e.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on($e.SubscriptionError,this.handleSubscriptionError).on($e.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on($e.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on($e.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on($e.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on($e.DataPacketReceived,this.handleDataPacket).on($e.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Dt.SignalReconnecting)&&this.emit(fe.SignalReconnecting)}).on($e.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Dt.Connected)&&this.emit(fe.Reconnected)}).on($e.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Dt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on($e.Restarting,this.handleRestarting).on($e.SignalRestarted,this.handleSignalRestarted).on($e.Offline,()=>{this.setAndEmitConnectionState(Dt.Reconnecting)&&this.emit(fe.Reconnecting)}).on($e.DCBufferStatusChanged,(e,n)=>{this.emit(fe.DCBufferStatusChanged,e,n)}).on($e.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(le.LocalTrackSubscribed,n),this.emitWhenConnected(fe.LocalTrackSubscribed,n,this.localParticipant)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ci.getInstance().getDevices(e,n)}prepareConnection(e,n){return te(this,void 0,void 0,function*(){if(this.state===Dt.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(AA(new URL(e))&&n){this.regionUrlProvider=new mH(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Dt.Disconnected&&(this.regionUrl=r,yield fetch(sH(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(sH(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return te(this,void 0,void 0,function*(){let r=()=>{},i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new Pc({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new Pc({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new Pc({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new Pc({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>te(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Pc({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>te(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new Pc({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new Pc({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>te(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new hR({reason:Tm.CLIENT_INITIATED,action:Cm.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new Pc({scenario:{case:"subscriberBandwidth",value:BigInt(n)}});break;case"leave-full-reconnect":i=new Pc({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return te(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,c,l,u,d,f,p;let m=!1,v=!0;const S=o?{exact:i}:i;if(r==="audioinput"){const _=(a=s.getActiveDevice(r))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=S,m=_!==S;const w=Array.from(s.localParticipant.audioTrackPublications.values()).filter(T=>T.source===ve.Source.Microphone);try{v=(yield Promise.all(w.map(T=>{var C;return(C=T.audioTrack)===null||C===void 0?void 0:C.setDeviceId(S)}))).every(T=>T===!0)}catch(T){throw s.options.audioCaptureDefaults.deviceId=_,T}}else if(r==="videoinput"){const _=(c=s.getActiveDevice(r))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=S,m=_!==S;const w=Array.from(s.localParticipant.videoTrackPublications.values()).filter(T=>T.source===ve.Source.Camera);try{v=(yield Promise.all(w.map(T=>{var C;return(C=T.videoTrack)===null||C===void 0?void 0:C.setDeviceId(S)}))).every(T=>T===!0)}catch(T){throw s.options.videoCaptureDefaults.deviceId=_,T}}else if(r==="audiooutput"){if(!MA()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");s.options.webAudioMix&&(i=(l=yield Ci.getInstance().normalizeDeviceId("audiooutput",i))!==null&&l!==void 0?l:""),(u=(p=s.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const _=(d=s.getActiveDevice(r))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i,m=_!==S;try{s.options.webAudioMix&&((f=s.audioContext)===null||f===void 0||f.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(w=>w.setAudioOutput({deviceId:i})))}catch(w){throw s.options.audioOutput.deviceId=_,w}}return m&&v&&(s.localParticipant.activeDeviceMap.set(r,i),s.emit(fe.ActiveDeviceChanged,r,i)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(le.AttributesChanged,this.onLocalAttributesChanged).on(le.TrackMuted,this.onLocalTrackMuted).on(le.TrackUnmuted,this.onLocalTrackUnmuted).on(le.LocalTrackPublished,this.onLocalTrackPublished).on(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(le.MediaDevicesError,this.onMediaDevicesError).on(le.AudioStreamAcquired,this.startAudio).on(le.ChatMessage,this.onLocalChatMessageSent).on(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===Dt.Connecting||this.state===Dt.Reconnecting){const u=()=>{this.onTrackAdded(e,n,r),d()},d=()=>{this.off(fe.Reconnected,u),this.off(fe.Connected,u),this.off(fe.Disconnected,d)};this.once(fe.Reconnected,u),this.once(fe.Connected,u),this.once(fe.Disconnected,d);return}if(this.state===Dt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const i=x3e(n.id),s=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(u=>u.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,a,n,r,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.state!==Dt.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,o;i.track&&this.localParticipant.unpublishTrack(i.track,e),e&&((s=i.track)===null||s===void 0||s.detach(),(o=i.track)===null||o===void 0||o.stop())}),this.localParticipant.off(le.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(le.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(le.AttributesChanged,this.onLocalAttributesChanged).off(le.TrackMuted,this.onLocalTrackMuted).off(le.TrackUnmuted,this.onLocalTrackUnmuted).off(le.LocalTrackPublished,this.onLocalTrackPublished).off(le.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(le.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(le.MediaDevicesError,this.onMediaDevicesError).off(le.AudioStreamAcquired,this.startAudio).off(le.ChatMessage,this.onLocalChatMessageSent).off(le.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ro()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Dt.Disconnected),this.emit(fe.Disconnected,n)}}}handleParticipantDisconnected(e,n){this.remoteParticipants.delete(e),n&&(n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(fe.ParticipantDisconnected,n))}acquireAudioContext(){return te(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=hte())!==null&&e!==void 0?e:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(fe.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let i;return n?i=ik.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new ik(this.engine.client,"",e,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return n&&i.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),i}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(fe.ParticipantConnected,r),r.on(le.TrackPublished,i=>{this.emitWhenConnected(fe.TrackPublished,i,r)}).on(le.TrackSubscribed,(i,s)=>{i.kind===ve.Kind.Audio?(i.on(Ie.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Ie.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===ve.Kind.Video&&(i.on(Ie.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(Ie.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(fe.TrackSubscribed,i,s,r)}).on(le.TrackUnpublished,i=>{this.emit(fe.TrackUnpublished,i,r)}).on(le.TrackUnsubscribed,(i,s)=>{this.emit(fe.TrackUnsubscribed,i,s,r)}).on(le.TrackSubscriptionFailed,i=>{this.emit(fe.TrackSubscriptionFailed,i,r)}).on(le.TrackMuted,i=>{this.emitWhenConnected(fe.TrackMuted,i,r)}).on(le.TrackUnmuted,i=>{this.emitWhenConnected(fe.TrackUnmuted,i,r)}).on(le.ParticipantMetadataChanged,i=>{this.emitWhenConnected(fe.ParticipantMetadataChanged,i,r)}).on(le.ParticipantNameChanged,i=>{this.emitWhenConnected(fe.ParticipantNameChanged,i,r)}).on(le.AttributesChanged,i=>{this.emitWhenConnected(fe.ParticipantAttributesChanged,i,r)}).on(le.ConnectionQualityChanged,i=>{this.emitWhenConnected(fe.ConnectionQualityChanged,i,r)}).on(le.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(fe.ParticipantPermissionsChanged,i,r)}).on(le.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(fe.TrackSubscriptionStatusChanged,i,s,r)}).on(le.TrackSubscriptionFailed,(i,s)=>{this.emit(fe.TrackSubscriptionFailed,i,r,s)}).on(le.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(fe.TrackSubscriptionPermissionChanged,i,s,r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&n instanceof C_&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Pi.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Tm.STATE_MISMATCH))):e=0},xPe)}clearConnectionReconcile(){this.connectionReconcileInterval&&Pi.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(fe.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.state===Dt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Dt.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return te(this,void 0,void 0,function*(){var n,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new U8({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Yn.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new w_({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(fe.SignalConnected),this.emit(fe.Connected),this.setAndEmitConnectionState(Dt.Connected),i.video){const o=new rk(ve.Kind.Video,new em({source:zi.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tc.AUDIO,name:"video-dummy"}),new Hi(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:iH(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(le.LocalTrackPublished,o)}if(i.audio){const o=new rk(ve.Kind.Audio,new em({source:zi.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tc.AUDIO}),new bi(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:uP(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(le.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new w_({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:gA.ACTIVE,tracks:[],joinedAt:Yn.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=iH(160*((r=s.aspectRatios[o%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),u=new em({source:zi.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:tc.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const l=uP(),u=new em({source:zi.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:tc.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(e!==fe.ActiveSpeakersChanged){const s=xte(r).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}function xte(t){return t.map(e=>{if(e)return Array.isArray(e)?xte(e):typeof e=="object"?"logContext"in e&&e.logContext:e})}var Wa;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Wa||(Wa={}));class Gv extends ml.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Wa.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=n,this.name=this.constructor.name,this.room=new k_(r.roomOptions),this.connectOptions=r.connectOptions,r.errorsAsWarnings&&(this.errorsAsWarnings=r.errorsAsWarnings)}run(e){return te(this,void 0,void 0,function*(){if(this.status!==Wa.IDLE)throw Error("check is running already");this.setStatus(Wa.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Wa.SKIPPED&&this.setStatus(this.isSuccess()?Wa.SUCCESS:Wa.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(){return te(this,void 0,void 0,function*(){return this.room.state===Dt.Connected?this.room:(yield this.room.connect(this.url,this.token,this.connectOptions),this.room)})}disconnect(){return te(this,void 0,void 0,function*(){this.room&&this.room.state!==Dt.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Wa.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class PPe extends Gv{get description(){return"Can publish audio"}perform(){return te(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield kPe();n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,3e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(s=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class OPe extends Gv{get description(){return"Can publish video"}perform(){return te(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield CPe();n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}}class MPe extends Gv{get description(){return"Resuming connection after interruption"}perform(){return te(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,i=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{r=!0};n.on(fe.SignalReconnecting,a).on(fe.Reconnecting,a).on(fe.Reconnected,()=>{i=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,r){if(!i||n.state!==Dt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class APe extends Gv{get description(){return"Can connect via TURN"}perform(){return te(this,void 0,void 0,function*(){var e,n;const r=new G8,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let c of i.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class LPe extends Gv{get description(){return"Establishing WebRTC connection"}perform(){return te(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(fe.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(i,s)=>{if(i.candidate){const o=new RTCIceCandidate(i);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(DPe(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}r&&r(i,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=i=>{i instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(i.errorCode," ").concat(i.errorText," ").concat(i.url))})});try{yield this.connect(),Ot.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function DPe(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class NPe extends Gv{get description(){return"Connecting to signal connection via WebSocket"}perform(){return te(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new G8;const s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===ree.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class sht extends ml.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Wa.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Wa.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return te(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(n,o)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(NPe)})}checkWebRTC(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(LPe)})}checkTURN(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(APe)})}checkReconnect(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(MPe)})}checkPublishAudio(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(PPe)})}checkPublishVideo(){return te(this,void 0,void 0,function*(){return this.createAndRunCheck(OPe)})}}function UPe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;const r=t instanceof Jd?t.mediaStreamTrack:t,i=r.getSettings();let s={facingMode:(n=e.defaultFacingMode)!==null&&n!==void 0?n:"user",confidence:"low"};if("facingMode"in i){const o=i.facingMode;Ot.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&BPe(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){Ot.trace("Try to get facing mode from device label: (".concat(r.label,")"));const o=FPe(r.label);o!==void 0&&(s=o)}return s}const yH=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),$Pe=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function FPe(t){var e;const n=t.trim().toLowerCase();if(n!=="")return yH.has(n)?yH.get(n):(e=Array.from($Pe.entries()).find(r=>{let[i]=r;return n.includes(i)}))===null||e===void 0?void 0:e[1]}function BPe(t){return t===void 0||["user","environment","left","right"].includes(t)}function $A(t,e){return $A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},$A(t,e)}function ff(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,$A(t,e)}var Pte={exports:{}},jPe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",HPe=jPe,KPe=HPe;function Ote(){}function Mte(){}Mte.resetWarningCache=Ote;var VPe=function(){function t(r,i,s,o,a,c){if(c!==KPe){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Mte,resetWarningCache:Ote};return n.PropTypes=n,n};Pte.exports=VPe();var qPe=Pte.exports;const _H=es(qPe);function ap(){return ap=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ap.apply(this,arguments)}var zv={exports:{}},GPe=Array.isArray||function(t){return Object.prototype.toString.call(t)=="[object Array]"},sk=GPe;zv.exports=Dte;zv.exports.parse=J8;zv.exports.compile=WPe;zv.exports.tokensToFunction=Ate;zv.exports.tokensToRegExp=Lte;var zPe=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function J8(t,e){for(var n=[],r=0,i=0,s="",o=e&&e.delimiter||"/",a;(a=zPe.exec(t))!=null;){var c=a[0],l=a[1],u=a.index;if(s+=t.slice(i,u),i=u+c.length,l){s+=l[1];continue}var d=t[i],f=a[2],p=a[3],m=a[4],v=a[5],S=a[6],_=a[7];s&&(n.push(s),s="");var w=f!=null&&d!=null&&d!==f,T=S==="+"||S==="*",C=S==="?"||S==="*",I=a[2]||o,R=m||v;n.push({name:p||r++,prefix:f||"",delimiter:I,optional:C,repeat:T,partial:w,asterisk:!!_,pattern:R?XPe(R):_?".*":"[^"+TT(I)+"]+?"})}return i<t.length&&(s+=t.substr(i)),s&&n.push(s),n}function WPe(t,e){return Ate(J8(t,e),e)}function YPe(t){return encodeURI(t).replace(/[\/?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function JPe(t){return encodeURI(t).replace(/[?#]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function Ate(t,e){for(var n=new Array(t.length),r=0;r<t.length;r++)typeof t[r]=="object"&&(n[r]=new RegExp("^(?:"+t[r].pattern+")$",Z8(e)));return function(i,s){for(var o="",a=i||{},c=s||{},l=c.pretty?YPe:encodeURIComponent,u=0;u<t.length;u++){var d=t[u];if(typeof d=="string"){o+=d;continue}var f=a[d.name],p;if(f==null)if(d.optional){d.partial&&(o+=d.prefix);continue}else throw new TypeError('Expected "'+d.name+'" to be defined');if(sk(f)){if(!d.repeat)throw new TypeError('Expected "'+d.name+'" to not repeat, but received `'+JSON.stringify(f)+"`");if(f.length===0){if(d.optional)continue;throw new TypeError('Expected "'+d.name+'" to not be empty')}for(var m=0;m<f.length;m++){if(p=l(f[m]),!n[u].test(p))throw new TypeError('Expected all "'+d.name+'" to match "'+d.pattern+'", but received `'+JSON.stringify(p)+"`");o+=(m===0?d.prefix:d.delimiter)+p}continue}if(p=d.asterisk?JPe(f):l(f),!n[u].test(p))throw new TypeError('Expected "'+d.name+'" to match "'+d.pattern+'", but received "'+p+'"');o+=d.prefix+p}return o}}function TT(t){return t.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function XPe(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function X8(t,e){return t.keys=e,t}function Z8(t){return t&&t.sensitive?"":"i"}function ZPe(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return X8(t,e)}function QPe(t,e,n){for(var r=[],i=0;i<t.length;i++)r.push(Dte(t[i],e,n).source);var s=new RegExp("(?:"+r.join("|")+")",Z8(n));return X8(s,e)}function eOe(t,e,n){return Lte(J8(t,n),e,n)}function Lte(t,e,n){sk(e)||(n=e||n,e=[]),n=n||{};for(var r=n.strict,i=n.end!==!1,s="",o=0;o<t.length;o++){var a=t[o];if(typeof a=="string")s+=TT(a);else{var c=TT(a.prefix),l="(?:"+a.pattern+")";e.push(a),a.repeat&&(l+="(?:"+c+l+")*"),a.optional?a.partial?l=c+"("+l+")?":l="(?:"+c+"("+l+"))?":l=c+"("+l+")",s+=l}}var u=TT(n.delimiter||"/"),d=s.slice(-u.length)===u;return r||(s=(d?s.slice(0,-u.length):s)+"(?:"+u+"(?=$))?"),i?s+="$":s+=r&&d?"":"(?="+u+"|$)",X8(new RegExp("^"+s,Z8(n)),e)}function Dte(t,e,n){return sk(e)||(n=e||n,e=[]),n=n||{},t instanceof RegExp?ZPe(t,e):sk(t)?QPe(t,e,n):eOe(t,e,n)}var tOe=zv.exports;const nOe=es(tOe);var Nte={exports:{}},ln={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var li=typeof Symbol=="function"&&Symbol.for,Q8=li?Symbol.for("react.element"):60103,eD=li?Symbol.for("react.portal"):60106,_R=li?Symbol.for("react.fragment"):60107,bR=li?Symbol.for("react.strict_mode"):60108,SR=li?Symbol.for("react.profiler"):60114,wR=li?Symbol.for("react.provider"):60109,ER=li?Symbol.for("react.context"):60110,tD=li?Symbol.for("react.async_mode"):60111,TR=li?Symbol.for("react.concurrent_mode"):60111,CR=li?Symbol.for("react.forward_ref"):60112,kR=li?Symbol.for("react.suspense"):60113,rOe=li?Symbol.for("react.suspense_list"):60120,RR=li?Symbol.for("react.memo"):60115,IR=li?Symbol.for("react.lazy"):60116,iOe=li?Symbol.for("react.block"):60121,sOe=li?Symbol.for("react.fundamental"):60117,oOe=li?Symbol.for("react.responder"):60118,aOe=li?Symbol.for("react.scope"):60119;function $o(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Q8:switch(t=t.type,t){case tD:case TR:case _R:case SR:case bR:case kR:return t;default:switch(t=t&&t.$$typeof,t){case ER:case CR:case IR:case RR:case wR:return t;default:return e}}case eD:return e}}}function Ute(t){return $o(t)===TR}ln.AsyncMode=tD;ln.ConcurrentMode=TR;ln.ContextConsumer=ER;ln.ContextProvider=wR;ln.Element=Q8;ln.ForwardRef=CR;ln.Fragment=_R;ln.Lazy=IR;ln.Memo=RR;ln.Portal=eD;ln.Profiler=SR;ln.StrictMode=bR;ln.Suspense=kR;ln.isAsyncMode=function(t){return Ute(t)||$o(t)===tD};ln.isConcurrentMode=Ute;ln.isContextConsumer=function(t){return $o(t)===ER};ln.isContextProvider=function(t){return $o(t)===wR};ln.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Q8};ln.isForwardRef=function(t){return $o(t)===CR};ln.isFragment=function(t){return $o(t)===_R};ln.isLazy=function(t){return $o(t)===IR};ln.isMemo=function(t){return $o(t)===RR};ln.isPortal=function(t){return $o(t)===eD};ln.isProfiler=function(t){return $o(t)===SR};ln.isStrictMode=function(t){return $o(t)===bR};ln.isSuspense=function(t){return $o(t)===kR};ln.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===_R||t===TR||t===SR||t===bR||t===kR||t===rOe||typeof t=="object"&&t!==null&&(t.$$typeof===IR||t.$$typeof===RR||t.$$typeof===wR||t.$$typeof===ER||t.$$typeof===CR||t.$$typeof===sOe||t.$$typeof===oOe||t.$$typeof===aOe||t.$$typeof===iOe)};ln.typeOf=$o;Nte.exports=ln;var cOe=Nte.exports;function lOe(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var nD=cOe,uOe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},dOe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},fOe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},$te={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},rD={};rD[nD.ForwardRef]=fOe;rD[nD.Memo]=$te;function bH(t){return nD.isMemo(t)?$te:rD[t.$$typeof]||uOe}var hOe=Object.defineProperty,pOe=Object.getOwnPropertyNames,SH=Object.getOwnPropertySymbols,gOe=Object.getOwnPropertyDescriptor,mOe=Object.getPrototypeOf,wH=Object.prototype;function Fte(t,e,n){if(typeof e!="string"){if(wH){var r=mOe(e);r&&r!==wH&&Fte(t,r,n)}var i=pOe(e);SH&&(i=i.concat(SH(e)));for(var s=bH(t),o=bH(e),a=0;a<i.length;++a){var c=i[a];if(!dOe[c]&&!(n&&n[c])&&!(o&&o[c])&&!(s&&s[c])){var l=gOe(e,c);try{hOe(t,c,l)}catch{}}}}return t}var vOe=Fte;const yOe=es(vOe);var vP=1073741823,EH=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{};function _Oe(){var t="__global_unique_id__";return EH[t]=(EH[t]||0)+1}function bOe(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function SOe(t){var e=[];return{on:function(r){e.push(r)},off:function(r){e=e.filter(function(i){return i!==r})},get:function(){return t},set:function(r,i){t=r,e.forEach(function(s){return s(t,i)})}}}function wOe(t){return Array.isArray(t)?t[0]:t}function EOe(t,e){var n,r,i="__create-react-context-"+_Oe()+"__",s=function(a){ff(c,a);function c(){for(var u,d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return u=a.call.apply(a,[this].concat(f))||this,u.emitter=SOe(u.props.value),u}var l=c.prototype;return l.getChildContext=function(){var d;return d={},d[i]=this.emitter,d},l.componentWillReceiveProps=function(d){if(this.props.value!==d.value){var f=this.props.value,p=d.value,m;bOe(f,p)?m=0:(m=typeof e=="function"?e(f,p):vP,m|=0,m!==0&&this.emitter.set(d.value,m))}},l.render=function(){return this.props.children},c}(re.Component);s.childContextTypes=(n={},n[i]=_H.object.isRequired,n);var o=function(a){ff(c,a);function c(){for(var u,d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return u=a.call.apply(a,[this].concat(f))||this,u.observedBits=void 0,u.state={value:u.getValue()},u.onUpdate=function(m,v){var S=u.observedBits|0;S&v&&u.setState({value:u.getValue()})},u}var l=c.prototype;return l.componentWillReceiveProps=function(d){var f=d.observedBits;this.observedBits=f??vP},l.componentDidMount=function(){this.context[i]&&this.context[i].on(this.onUpdate);var d=this.props.observedBits;this.observedBits=d??vP},l.componentWillUnmount=function(){this.context[i]&&this.context[i].off(this.onUpdate)},l.getValue=function(){return this.context[i]?this.context[i].get():t},l.render=function(){return wOe(this.props.children)(this.state.value)},c}(re.Component);return o.contextTypes=(r={},r[i]=_H.object,r),{Provider:s,Consumer:o}}var TOe=re.createContext||EOe,Bte=function(e){var n=TOe();return n.displayName=e,n},jte=Bte("Router-History"),cp=Bte("Router"),xR=function(t){ff(e,t),e.computeRootMatch=function(i){return{path:"/",url:"/",params:{},isExact:i==="/"}};function e(r){var i;return i=t.call(this,r)||this,i.state={location:r.history.location},i._isMounted=!1,i._pendingLocation=null,r.staticContext||(i.unlisten=r.history.listen(function(s){i._pendingLocation=s})),i}var n=e.prototype;return n.componentDidMount=function(){var i=this;this._isMounted=!0,this.unlisten&&this.unlisten(),this.props.staticContext||(this.unlisten=this.props.history.listen(function(s){i._isMounted&&i.setState({location:s})})),this._pendingLocation&&this.setState({location:this._pendingLocation})},n.componentWillUnmount=function(){this.unlisten&&(this.unlisten(),this._isMounted=!1,this._pendingLocation=null)},n.render=function(){return re.createElement(cp.Provider,{value:{history:this.props.history,location:this.state.location,match:e.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},re.createElement(jte.Provider,{children:this.props.children||null,value:this.props.history}))},e}(re.Component);re.Component;re.Component;var TH={},COe=1e4,CH=0;function kOe(t,e){var n=""+e.end+e.strict+e.sensitive,r=TH[n]||(TH[n]={});if(r[t])return r[t];var i=[],s=nOe(t,i,e),o={regexp:s,keys:i};return CH<COe&&(r[t]=o,CH++),o}function iD(t,e){e===void 0&&(e={}),(typeof e=="string"||Array.isArray(e))&&(e={path:e});var n=e,r=n.path,i=n.exact,s=i===void 0?!1:i,o=n.strict,a=o===void 0?!1:o,c=n.sensitive,l=c===void 0?!1:c,u=[].concat(r);return u.reduce(function(d,f){if(!f&&f!=="")return null;if(d)return d;var p=kOe(f,{end:s,strict:a,sensitive:l}),m=p.regexp,v=p.keys,S=m.exec(t);if(!S)return null;var _=S[0],w=S.slice(1),T=t===_;return s&&!T?null:{path:f,url:f==="/"&&_===""?"/":_,isExact:T,params:v.reduce(function(C,I,R){return C[I.name]=w[R],C},{})}},null)}function ROe(t){return re.Children.count(t)===0}var IOe=function(t){ff(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.render=function(){var i=this;return re.createElement(cp.Consumer,null,function(s){s||xp();var o=i.props.location||s.location,a=i.props.computedMatch?i.props.computedMatch:i.props.path?iD(o.pathname,i.props):s.match,c=ap({},s,{location:o,match:a}),l=i.props,u=l.children,d=l.component,f=l.render;return Array.isArray(u)&&ROe(u)&&(u=null),re.createElement(cp.Provider,{value:c},c.match?u?typeof u=="function"?u(c):u:d?re.createElement(d,c):f?f(c):null:typeof u=="function"?u(c):null)})},e}(re.Component);function sD(t){return t.charAt(0)==="/"?t:"/"+t}function xOe(t,e){return t?ap({},e,{pathname:sD(t)+e.pathname}):e}function POe(t,e){if(!t)return e;var n=sD(t);return e.pathname.indexOf(n)!==0?e:ap({},e,{pathname:e.pathname.substr(n.length)})}function kH(t){return typeof t=="string"?t:cs(t)}function yP(t){return function(){xp()}}function RH(){}re.Component;var OOe=function(t){ff(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.render=function(){var i=this;return re.createElement(cp.Consumer,null,function(s){s||xp();var o=i.props.location||s.location,a,c;return re.Children.forEach(i.props.children,function(l){if(c==null&&re.isValidElement(l)){a=l;var u=l.props.path||l.props.from;c=u?iD(o.pathname,ap({},l.props,{path:u})):s.match}}),c?re.cloneElement(a,{location:o,computedMatch:c}):null})},e}(re.Component),Hte=re.useContext;function gc(){return Hte(jte)}function Ku(){return Hte(cp).location}function FA(t,e){return FA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},FA(t,e)}function Kte(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,FA(t,e)}function fv(){return fv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},fv.apply(this,arguments)}function oD(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var MOe=function(t){Kte(e,t);function e(){for(var r,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return r=t.call.apply(t,[this].concat(s))||this,r.history=LQ(r.props),r}var n=e.prototype;return n.render=function(){return re.createElement(xR,{history:this.history,children:this.props.children})},e}(re.Component);re.Component;var BA=function(e,n){return typeof e=="function"?e(n):e},jA=function(e,n){return typeof e=="string"?Eo(e,null,null,n):e},aD=function(e){return e},hv=re.forwardRef;typeof hv>"u"&&(hv=aD);function AOe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}var LOe=hv(function(t,e){var n=t.innerRef,r=t.navigate,i=t.onClick,s=oD(t,["innerRef","navigate","onClick"]),o=s.target,a=fv({},s,{onClick:function(l){try{i&&i(l)}catch(u){throw l.preventDefault(),u}!l.defaultPrevented&&l.button===0&&(!o||o==="_self")&&!AOe(l)&&(l.preventDefault(),r())}});return aD!==hv?a.ref=e||n:a.ref=n,re.createElement("a",a)}),cD=hv(function(t,e){var n=t.component,r=n===void 0?LOe:n,i=t.replace,s=t.to,o=t.innerRef,a=oD(t,["component","replace","to","innerRef"]);return re.createElement(cp.Consumer,null,function(c){c||xp();var l=c.history,u=jA(BA(s,c.location),c.location),d=u?l.createHref(u):"",f=fv({},a,{href:d,navigate:function(){var m=BA(s,c.location),v=cs(c.location)===cs(jA(m)),S=i||v?l.replace:l.push;S(m)}});return aD!==hv?f.ref=e||o:f.innerRef=o,re.createElement(r,f)})}),Vte=function(e){return e},ok=re.forwardRef;typeof ok>"u"&&(ok=Vte);function DOe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.filter(function(r){return r}).join(" ")}ok(function(t,e){var n=t["aria-current"],r=n===void 0?"page":n,i=t.activeClassName,s=i===void 0?"active":i,o=t.activeStyle,a=t.className,c=t.exact,l=t.isActive,u=t.location,d=t.sensitive,f=t.strict,p=t.style,m=t.to,v=t.innerRef,S=oD(t,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return re.createElement(cp.Consumer,null,function(_){_||xp();var w=u||_.location,T=jA(BA(m,w),w),C=T.pathname,I=C&&C.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),R=I?iD(w.pathname,{path:I,exact:c,sensitive:d,strict:f}):null,O=!!(l?l(R,w):R),A=typeof a=="function"?a(O):a,U=typeof p=="function"?p(O):p;O&&(A=DOe(A,s),U=fv({},U,o));var N=fv({"aria-current":O&&r||null,className:A,style:U,to:T},S);return Vte!==ok?N.ref=e||v:N.innerRef=v,re.createElement(cD,N)})});const qte=Object.prototype.toString;function PR(t){switch(qte.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return xu(t,Error)}}function Wv(t,e){return qte.call(t)===`[object ${e}]`}function Gte(t){return Wv(t,"ErrorEvent")}function IH(t){return Wv(t,"DOMError")}function NOe(t){return Wv(t,"DOMException")}function mu(t){return Wv(t,"String")}function lD(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function uD(t){return t===null||lD(t)||typeof t!="object"&&typeof t!="function"}function pv(t){return Wv(t,"Object")}function OR(t){return typeof Event<"u"&&xu(t,Event)}function UOe(t){return typeof Element<"u"&&xu(t,Element)}function $Oe(t){return Wv(t,"RegExp")}function MR(t){return!!(t&&t.then&&typeof t.then=="function")}function FOe(t){return pv(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function xu(t,e){try{return t instanceof e}catch{return!1}}function zte(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}function Om(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function xH(t,e){if(!Array.isArray(t))return"";const n=[];for(let r=0;r<t.length;r++){const i=t[r];try{zte(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function BOe(t,e,n=!1){return mu(t)?$Oe(e)?e.test(t):mu(e)?n?t===e:t.includes(e):!1:!1}function Uh(t,e=[],n=!1){return e.some(r=>BOe(t,r,n))}function jOe(t,e,n=250,r,i,s,o){if(!s.exception||!s.exception.values||!o||!xu(o.originalException,Error))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;a&&(s.exception.values=HOe(HA(t,e,i,o.originalException,r,s.exception.values,a,0),n))}function HA(t,e,n,r,i,s,o,a){if(s.length>=n+1)return s;let c=[...s];if(xu(r[i],Error)){PH(o,a);const l=t(e,r[i]),u=c.length;OH(l,i,u,a),c=HA(t,e,n,r[i],i,[l,...c],l,u)}return Array.isArray(r.errors)&&r.errors.forEach((l,u)=>{if(xu(l,Error)){PH(o,a);const d=t(e,l),f=c.length;OH(d,`errors[${u}]`,f,a),c=HA(t,e,n,l,i,[d,...c],d,f)}}),c}function PH(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function OH(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function HOe(t,e){return t.map(n=>(n.value&&(n.value=Om(n.value,e)),n))}function Wte(t){if(t!==void 0)return t>=400&&t<500?"warning":t>=500?"error":void 0}const $h="8.32.0",Gt=globalThis;function AR(t,e,n){const r=n||Gt,i=r.__SENTRY__=r.__SENTRY__||{},s=i[$h]=i[$h]||{};return s[t]||(s[t]=e())}const Mm=Gt,KOe=80;function lp(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let s=0,o=0;const a=" > ",c=a.length;let l;const u=Array.isArray(e)?e:e.keyAttrs,d=!Array.isArray(e)&&e.maxStringLength||KOe;for(;n&&s++<r&&(l=VOe(n,u),!(l==="html"||s>1&&o+i.length*c+l.length>=d));)i.push(l),o+=l.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function VOe(t,e){const n=t,r=[];if(!n||!n.tagName)return"";if(Mm.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&mu(o)){const a=o.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const a=n.getAttribute(o);a&&r.push(`[${o}="${a}"]`)}return r.join("")}function qOe(){try{return Mm.document.location.href}catch{return""}}function GOe(t){return Mm.document&&Mm.document.querySelector?Mm.document.querySelector(t):null}function Yte(t){if(!Mm.HTMLElement)return null;let e=t;const n=5;for(let r=0;r<n;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}const Yv=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,zOe="Sentry Logger ",KA=["debug","info","warn","error","log","assert","trace"],ak={};function xb(t){if(!("console"in Gt))return t();const e=Gt.console,n={},r=Object.keys(ak);r.forEach(i=>{const s=ak[i];n[i]=e[i],e[i]=s});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}function WOe(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return Yv?KA.forEach(n=>{e[n]=(...r)=>{t&&xb(()=>{Gt.console[n](`${zOe}[${n}]:`,...r)})}}):KA.forEach(n=>{e[n]=()=>{}}),e}const xe=AR("logger",WOe),YOe=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function JOe(t){return t==="http"||t==="https"}function Jv(t,e=!1){const{host:n,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&i?`:${i}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${o}`}function XOe(t){const e=YOe.exec(t);if(!e){xb(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});return}const[n,r,i="",s="",o="",a=""]=e.slice(1);let c="",l=a;const u=l.split("/");if(u.length>1&&(c=u.slice(0,-1).join("/"),l=u.pop()),l){const d=l.match(/^\d+/);d&&(l=d[0])}return Jte({host:s,pass:i,path:c,projectId:l,port:o,protocol:n,publicKey:r})}function Jte(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function ZOe(t){if(!Yv)return!0;const{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(o=>t[o]?!1:(xe.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?JOe(r)?e&&isNaN(parseInt(e,10))?(xe.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(xe.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(xe.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Xte(t){const e=typeof t=="string"?XOe(t):Jte(t);if(!(!e||!ZOe(e)))return e}class Wc extends Error{constructor(e,n="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=n}}function To(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);typeof i=="function"&&Zte(i,r),t[e]=i}function Ra(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{Yv&&xe.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function Zte(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,Ra(t,"__sentry_original__",e)}catch{}}function dD(t){return t.__sentry_original__}function QOe(t){return Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")}function Qte(t){if(PR(t))return{message:t.message,name:t.name,stack:t.stack,...AH(t)};if(OR(t)){const e={type:t.type,target:MH(t.target),currentTarget:MH(t.currentTarget),...AH(t)};return typeof CustomEvent<"u"&&xu(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function MH(t){try{return UOe(t)?lp(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function AH(t){if(typeof t=="object"&&t!==null){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function e6e(t,e=40){const n=Object.keys(Qte(t));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=e)return Om(r,e);for(let i=n.length;i>0;i--){const s=n.slice(0,i).join(", ");if(!(s.length>e))return i===n.length?s:Om(s,e)}return""}function Oi(t){return VA(t,new Map)}function VA(t,e){if(t6e(t)){const n=e.get(t);if(n!==void 0)return n;const r={};e.set(t,r);for(const i of Object.keys(t))typeof t[i]<"u"&&(r[i]=VA(t[i],e));return r}if(Array.isArray(t)){const n=e.get(t);if(n!==void 0)return n;const r=[];return e.set(t,r),t.forEach(i=>{r.push(VA(i,e))}),r}return t}function t6e(t){if(!pv(t))return!1;try{const e=Object.getPrototypeOf(t).constructor.name;return!e||e==="Object"}catch{return!0}}const ene=50,up="?",LH=/\(error: (.*)\)/,DH=/captureMessage|captureException/;function tne(...t){const e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,i=0)=>{const s=[],o=n.split(`
`);for(let a=r;a<o.length;a++){const c=o[a];if(c.length>1024)continue;const l=LH.test(c)?c.replace(LH,"$1"):c;if(!l.match(/\S*Error: /)){for(const u of e){const d=u(l);if(d){s.push(d);break}}if(s.length>=ene+i)break}}return r6e(s.slice(i))}}function n6e(t){return Array.isArray(t)?tne(...t):t}function r6e(t){if(!t.length)return[];const e=Array.from(t);return/sentryWrapped/.test(Lw(e).function||"")&&e.pop(),e.reverse(),DH.test(Lw(e).function||"")&&(e.pop(),DH.test(Lw(e).function||"")&&e.pop()),e.slice(0,ene).map(n=>({...n,filename:n.filename||Lw(e).filename,function:n.function||up}))}function Lw(t){return t[t.length-1]||{}}const _P="<anonymous>";function Pu(t){try{return!t||typeof t!="function"?_P:t.name||_P}catch{return _P}}function NH(t){const e=t.exception;if(e){const n=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const CT={},UH={};function xf(t,e){CT[t]=CT[t]||[],CT[t].push(e)}function Pf(t,e){UH[t]||(e(),UH[t]=!0)}function ya(t,e){const n=t&&CT[t];if(n)for(const r of n)try{r(e)}catch(i){Yv&&xe.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Pu(r)}
Error:`,i)}}function i6e(t){const e="console";xf(e,t),Pf(e,s6e)}function s6e(){"console"in Gt&&KA.forEach(function(t){t in Gt.console&&To(Gt.console,t,function(e){return ak[t]=e,function(...n){ya("console",{args:n,level:t});const i=ak[t];i&&i.apply(Gt.console,n)}})})}const qA=Gt;function nne(){if(!("fetch"in qA))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function GA(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function o6e(){if(typeof EdgeRuntime=="string")return!0;if(!nne())return!1;if(GA(qA.fetch))return!0;let t=!1;const e=qA.document;if(e&&typeof e.createElement=="function")try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=GA(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){Yv&&xe.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}const rne=1e3;function Pb(){return Date.now()/rne}function a6e(){const{performance:t}=Gt;if(!t||!t.now)return Pb;const e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/rne}const _s=a6e(),ro=(()=>{const{performance:t}=Gt;if(!t||!t.now)return;const e=3600*1e3,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,o=t.timing&&t.timing.navigationStart,c=typeof o=="number"?Math.abs(o+n-r):e,l=c<e;return s||l?i<=c?t.timeOrigin:o:r})();function ine(t,e){const n="fetch";xf(n,t),Pf(n,()=>sne(void 0,e))}function c6e(t){const e="fetch-body-resolved";xf(e,t),Pf(e,()=>sne(u6e))}function sne(t,e=!1){e&&!o6e()||To(Gt,"fetch",function(n){return function(...r){const{method:i,url:s}=d6e(r),o={args:r,fetchData:{method:i,url:s},startTimestamp:_s()*1e3};t||ya("fetch",{...o});const a=new Error().stack;return n.apply(Gt,r).then(async c=>(t?t(c):ya("fetch",{...o,endTimestamp:_s()*1e3,response:c}),c),c=>{throw ya("fetch",{...o,endTimestamp:_s()*1e3,error:c}),PR(c)&&c.stack===void 0&&(c.stack=a,Ra(c,"framesToPop",1)),c})}})}async function l6e(t,e){if(t&&t.body&&t.body.getReader){const n=t.body.getReader();async function r({done:i}){if(i)return Promise.resolve();try{const s=await Promise.race([n.read(),new Promise(o=>{setTimeout(()=>{o({done:!0})},5e3)})]);await r(s)}catch{}}return n.read().then(r).then(e).catch(()=>{})}}async function u6e(t){let e;try{e=t.clone()}catch{return}await l6e(e,()=>{ya("fetch-body-resolved",{endTimestamp:_s()*1e3,response:t})})}function zA(t,e){return!!t&&typeof t=="object"&&!!t[e]}function $H(t){return typeof t=="string"?t:t?zA(t,"url")?t.url:t.toString?t.toString():"":""}function d6e(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){const[n,r]=t;return{url:$H(n),method:zA(r,"method")?String(r.method).toUpperCase():"GET"}}const e=t[0];return{url:$H(e),method:zA(e,"method")?String(e.method).toUpperCase():"GET"}}let Dw=null;function one(t){const e="error";xf(e,t),Pf(e,f6e)}function f6e(){Dw=Gt.onerror,Gt.onerror=function(t,e,n,r,i){return ya("error",{column:r,error:i,line:n,msg:t,url:e}),Dw&&!Dw.__SENTRY_LOADER__?Dw.apply(this,arguments):!1},Gt.onerror.__SENTRY_INSTRUMENTED__=!0}let Nw=null;function ane(t){const e="unhandledrejection";xf(e,t),Pf(e,h6e)}function h6e(){Nw=Gt.onunhandledrejection,Gt.onunhandledrejection=function(t){return ya("unhandledrejection",t),Nw&&!Nw.__SENTRY_LOADER__?Nw.apply(this,arguments):!0},Gt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function p6e(){return"npm"}function g6e(){const t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(t)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[n,r]}function nr(){const t=Gt,e=t.crypto||t.msCrypto;let n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function cne(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function vd(t){const{message:e,event_id:n}=t;if(e)return e;const r=cne(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function WA(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function R_(t,e){const n=cne(t);if(!n)return;const r={type:"generic",handled:!0},i=n.mechanism;if(n.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};n.mechanism.data=s}}function FH(t){if(t&&t.__sentry_captured__)return!0;try{Ra(t,"__sentry_captured__",!0)}catch{}return!1}function lne(t){return Array.isArray(t)?t:[t]}function yd(t,e=100,n=1/0){try{return YA("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function une(t,e=3,n=100*1024){const r=yd(t,e);return _6e(r)>n?une(t,e-1,n):r}function YA(t,e,n=1/0,r=1/0,i=g6e()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const a=m6e(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(s(e))return"[Circular ~]";const l=e;if(l&&typeof l.toJSON=="function")try{const p=l.toJSON();return YA("",p,c-1,r,i)}catch{}const u=Array.isArray(e)?[]:{};let d=0;const f=Qte(e);for(const p in f){if(!Object.prototype.hasOwnProperty.call(f,p))continue;if(d>=r){u[p]="[MaxProperties ~]";break}const m=f[p];u[p]=YA(p,m,c-1,r,i),d++}return o(e),u}function m6e(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(zte(e))return"[VueViewModel]";if(FOe(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${Pu(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const n=v6e(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function v6e(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function y6e(t){return~-encodeURI(t).split(/%..|./).length}function _6e(t){return y6e(JSON.stringify(t))}var Vl;(function(t){t[t.PENDING=0]="PENDING";const n=1;t[t.RESOLVED=n]="RESOLVED";const r=2;t[t.REJECTED=r]="REJECTED"})(Vl||(Vl={}));function dp(t){return new ia(e=>{e(t)})}function ck(t){return new ia((e,n)=>{n(t)})}class ia{constructor(e){ia.prototype.__init.call(this),ia.prototype.__init2.call(this),ia.prototype.__init3.call(this),ia.prototype.__init4.call(this),this._state=Vl.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new ia((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(o){i(o)}},s=>{if(!n)i(s);else try{r(n(s))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new ia((n,r)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{if(s){r(i);return}n(i)})})}__init(){this._resolve=e=>{this._setResult(Vl.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Vl.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===Vl.PENDING){if(MR(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Vl.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===Vl.RESOLVED&&n[1](this._value),this._state===Vl.REJECTED&&n[2](this._value),n[0]=!0)})}}}function b6e(t){const e=[];function n(){return t===void 0||e.length<t}function r(o){return e.splice(e.indexOf(o),1)[0]||Promise.resolve(void 0)}function i(o){if(!n())return ck(new Wc("Not adding Promise because buffer limit was reached."));const a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function s(o){return new ia((a,c)=>{let l=e.length;if(!l)return a(!0);const u=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(d=>{dp(d).then(()=>{--l||(clearTimeout(u),a(!0))},c)})})}return{$:e,add:i,drain:s}}function Fh(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}const S6e=["fatal","error","warning","log","info","debug"];function w6e(t){return t==="warn"?"warning":S6e.includes(t)?t:"log"}const JA="baggage",dne="sentry-",E6e=/^sentry-/,T6e=8192;function fne(t){const e=C6e(t);if(!e)return;const n=Object.entries(e).reduce((r,[i,s])=>{if(i.match(E6e)){const o=i.slice(dne.length);r[o]=s}return r},{});if(Object.keys(n).length>0)return n}function hne(t){if(!t)return;const e=Object.entries(t).reduce((n,[r,i])=>(i&&(n[`${dne}${r}`]=i),n),{});return k6e(e)}function C6e(t){if(!(!t||!mu(t)&&!Array.isArray(t)))return Array.isArray(t)?t.reduce((e,n)=>{const r=BH(n);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):BH(t)}function BH(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(n&&r&&(e[n]=r),e),{})}function k6e(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],i)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=i===0?s:`${e},${s}`;return o.length>T6e?(Yv&&xe.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}const R6e=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function I6e(t){if(!t)return;const e=t.match(R6e);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function x6e(t,e){const n=I6e(t),r=fne(e),{traceId:i,parentSpanId:s,parentSampled:o}=n||{};return n?{traceId:i||nr(),parentSpanId:s||nr().substring(16),spanId:nr().substring(16),sampled:o,dsc:r||{}}:{traceId:i||nr(),spanId:nr().substring(16)}}function fD(t=nr(),e=nr().substring(16),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}function Xv(t,e=[]){return[t,e]}function P6e(t,e){const[n,r]=t;return[n,[...r,e]]}function jH(t,e){const n=t[1];for(const r of n){const i=r[0].type;if(e(r,i))return!0}return!1}function XA(t){return Gt.__SENTRY__&&Gt.__SENTRY__.encodePolyfill?Gt.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function O6e(t){const[e,n]=t;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[XA(r),s]:r.push(typeof s=="string"?XA(s):s)}for(const s of n){const[o,a]=s;if(i(`
${JSON.stringify(o)}
`),typeof a=="string"||a instanceof Uint8Array)i(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(yd(a))}i(c)}}return typeof r=="string"?r:M6e(r)}function M6e(t){const e=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}function A6e(t){return[{type:"span"},t]}function L6e(t){const e=typeof t.data=="string"?XA(t.data):t.data;return[Oi({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const D6e={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function HH(t){return D6e[t]}function pne(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}function N6e(t,e,n,r){const i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:Jv(r)},...i&&{trace:Oi({...i})}}}function U6e(t,e,n){const r=[{type:"client_report"},{timestamp:Pb(),discarded_events:t}];return Xv(e?{dsn:e}:{},[r])}const $6e=60*1e3;function F6e(t,e=Date.now()){const n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${t}`);return isNaN(r)?$6e:r-e}function B6e(t,e){return t[e]||t.all||0}function j6e(t,e,n=Date.now()){return B6e(t,e)>n}function H6e(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},s=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,l,,,u]=a.split(":",5),d=parseInt(c,10),f=(isNaN(d)?60:d)*1e3;if(!l)i.all=r+f;else for(const p of l.split(";"))p==="metric_bucket"?(!u||u.split(";").includes("custom"))&&(i[p]=r+f):i[p]=r+f}else o?i.all=r+F6e(o,r):e===429&&(i.all=r+60*1e3);return i}function ru(t){let e,n=t[0],r=1;for(;r<t.length;){const i=t[r],s=t[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&n==null)return;i==="access"||i==="optionalAccess"?(e=n,n=s(n)):(i==="call"||i==="optionalCall")&&(n=s((...o)=>n.call(e,...o)),e=void 0)}return n}function lk(){return{traceId:nr(),spanId:nr().substring(16)}}const Uw=Gt;function K6e(){const t=Uw.chrome,e=t&&t.app&&t.app.runtime,n="history"in Uw&&!!Uw.history.pushState&&!!Uw.history.replaceState;return!e&&n}const _t=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Zv(){return hD(Gt),Gt}function hD(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||$h,e[$h]=e[$h]||{}}function V6e(t){const e=_s(),n={sid:nr(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>G6e(n)};return t&&gv(n,t),n}function gv(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||_s(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:nr()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function q6e(t,e){let n={};t.status==="ok"&&(n={status:"exited"}),gv(t,n)}function G6e(t){return Oi({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}const ZA="_sentrySpan";function I_(t,e){e?Ra(t,ZA,e):delete t[ZA]}function uk(t){return t[ZA]}const z6e=100;class pD{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=lk()}clone(){const e=new pD;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,I_(e,uk(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&gv(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const n=typeof e=="function"?e(this):e,[r,i]=n instanceof hf?[n.getScopeData(),n.getRequestSession()]:pv(n)?[e,e.requestSession]:[],{tags:s,extra:o,user:a,contexts:c,level:l,fingerprint:u=[],propagationContext:d}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),u.length&&(this._fingerprint=u),d&&(this._propagationContext=d),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,I_(this,void 0),this._attachments=[],this._propagationContext=lk(),this._notifyScopeListeners(),this}addBreadcrumb(e,n){const r=typeof n=="number"?n:z6e;if(r<=0)return this;const i={timestamp:Pb(),...e},s=this._breadcrumbs;return s.push(i),this._breadcrumbs=s.length>r?s.slice(-r):s,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:uk(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,n){const r=n&&n.event_id?n.event_id:nr();if(!this._client)return xe.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){const i=r&&r.event_id?r.event_id:nr();if(!this._client)return xe.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,n){const r=n&&n.event_id?n.event_id:nr();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(xe.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const hf=pD;function W6e(){return AR("defaultCurrentScope",()=>new hf)}function Y6e(){return AR("defaultIsolationScope",()=>new hf)}class J6e{constructor(e,n){let r;e?r=e:r=new hf;let i;n?i=n:i=new hf,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const n=this._pushScope();let r;try{r=e(n)}catch(i){throw this._popScope(),i}return MR(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function mv(){const t=Zv(),e=hD(t);return e.stack=e.stack||new J6e(W6e(),Y6e())}function X6e(t){return mv().withScope(t)}function Z6e(t,e){const n=mv();return n.withScope(()=>(n.getStackTop().scope=t,e(t)))}function KH(t){return mv().withScope(()=>t(mv().getIsolationScope()))}function Q6e(){return{withIsolationScope:KH,withScope:X6e,withSetScope:Z6e,withSetIsolationScope:(t,e)=>KH(e),getCurrentScope:()=>mv().getScope(),getIsolationScope:()=>mv().getIsolationScope()}}function Ob(t){const e=hD(t);return e.acs?e.acs:Q6e()}function Cn(){const t=Zv();return Ob(t).getCurrentScope()}function mc(){const t=Zv();return Ob(t).getIsolationScope()}function eMe(){return AR("globalScope",()=>new hf)}function LR(...t){const e=Zv(),n=Ob(e);if(t.length===2){const[r,i]=t;return r?n.withSetScope(r,i):n.withScope(i)}return n.withScope(t[0])}function en(){return Cn().getClient()}const tMe="_sentryMetrics";function QA(t){const e=t[tMe];if(!e)return;const n={};for(const[,[r,i]]of e)(n[r]||(n[r]=[])).push(Oi(i));return n}const ic="sentry.source",gne="sentry.sample_rate",Ou="sentry.op",Or="sentry.origin",e5="sentry.idle_span_finish_reason",DR="sentry.measurement_unit",NR="sentry.measurement_value",nMe="sentry.profile_id",gD="sentry.exclusive_time",rMe=0,mne=1,Xr=2;function iMe(t){if(t<400&&t>=100)return{code:mne};if(t>=400&&t<500)switch(t){case 401:return{code:Xr,message:"unauthenticated"};case 403:return{code:Xr,message:"permission_denied"};case 404:return{code:Xr,message:"not_found"};case 409:return{code:Xr,message:"already_exists"};case 413:return{code:Xr,message:"failed_precondition"};case 429:return{code:Xr,message:"resource_exhausted"};case 499:return{code:Xr,message:"cancelled"};default:return{code:Xr,message:"invalid_argument"}}if(t>=500&&t<600)switch(t){case 501:return{code:Xr,message:"unimplemented"};case 503:return{code:Xr,message:"unavailable"};case 504:return{code:Xr,message:"deadline_exceeded"};default:return{code:Xr,message:"internal_error"}}return{code:Xr,message:"unknown_error"}}function vne(t,e){t.setAttribute("http.response.status_code",e);const n=iMe(e);n.message!=="unknown_error"&&t.setStatus(n)}const yne=0,_ne=1;function sMe(t){const{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:s,status:o,origin:a}=Vt(t);return Oi({parent_span_id:s,span_id:e,trace_id:n,data:r,op:i,status:o,origin:a})}function oMe(t){const{spanId:e,traceId:n}=t.spanContext(),{parent_span_id:r}=Vt(t);return Oi({parent_span_id:r,span_id:e,trace_id:n})}function bne(t){const{traceId:e,spanId:n}=t.spanContext(),r=Mp(t);return fD(e,n,r)}function Bh(t){return typeof t=="number"?VH(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?VH(t.getTime()):_s()}function VH(t){return t>9999999999?t/1e3:t}function Vt(t){if(cMe(t))return t.getSpanJSON();try{const{spanId:e,traceId:n}=t.spanContext();if(aMe(t)){const{attributes:r,startTime:i,name:s,endTime:o,parentSpanId:a,status:c}=t;return Oi({span_id:e,trace_id:n,data:r,description:s,parent_span_id:a,start_timestamp:Bh(i),timestamp:Bh(o)||void 0,status:Sne(c),op:r[Ou],origin:r[Or],_metrics_summary:QA(t)})}return{span_id:e,trace_id:n}}catch{return{}}}function aMe(t){const e=t;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function cMe(t){return typeof t.getSpanJSON=="function"}function Mp(t){const{traceFlags:e}=t.spanContext();return e===_ne}function Sne(t){if(!(!t||t.code===rMe))return t.code===mne?"ok":t.message||"unknown_error"}const jh="_sentryChildSpans",t5="_sentryRootSpan";function wne(t,e){const n=t[t5]||t;Ra(e,t5,n),t[jh]?t[jh].add(e):Ra(t,jh,new Set([e]))}function lMe(t,e){t[jh]&&t[jh].delete(e)}function kT(t){const e=new Set;function n(r){if(!e.has(r)&&Mp(r)){e.add(r);const i=r[jh]?Array.from(r[jh]):[];for(const s of i)n(s)}}return n(t),Array.from(e)}function Ai(t){return t[t5]||t}function ts(){const t=Zv(),e=Ob(t);return e.getActiveSpan?e.getActiveSpan():uk(Cn())}let qH=!1;function uMe(){qH||(qH=!0,one(n5),ane(n5))}function n5(){const t=ts(),e=t&&Ai(t);if(e){const n="internal_error";_t&&xe.log(`[Tracing] Root span: ${n} -> Global error occured`),e.setStatus({code:Xr,message:n})}}n5.tag="sentry_tracingErrorCallback";const Ene="_sentryScope",Tne="_sentryIsolationScope";function dMe(t,e,n){t&&(Ra(t,Tne,n),Ra(t,Ene,e))}function GH(t){return{scope:t[Ene],isolationScope:t[Tne]}}function Mu(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=en(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class Qv{constructor(e={}){this._traceId=e.traceId||nr(),this._spanId=e.spanId||nr().substring(16)}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:yne}}end(e){}setAttribute(e,n){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,n,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,n){}}const mD="production",Cne="_frozenDsc";function zH(t,e){Ra(t,Cne,e)}function UR(t,e){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=Oi({environment:n.environment||mD,release:n.release,public_key:r,trace_id:t});return e.emit("createDsc",i),i}function Ap(t){const e=en();if(!e)return{};const n=UR(Vt(t).trace_id||"",e),r=Ai(t),i=r[Cne];if(i)return i;const s=r.spanContext().traceState,o=s&&s.get("sentry.dsc"),a=o&&fne(o);if(a)return a;const c=Vt(r),l=c.data||{},u=l[gne];u!=null&&(n.sample_rate=`${u}`);const d=l[ic],f=c.description;return d!=="url"&&f&&(n.transaction=f),Mu()&&(n.sampled=String(Mp(r))),e.emit("createDsc",n,r),n}function fMe(t){if(!_t)return;const{description:e="< unknown name >",op:n="< unknown op >",parent_span_id:r}=Vt(t),{spanId:i}=t.spanContext(),s=Mp(t),o=Ai(t),a=o===t,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,l=[`op: ${n}`,`name: ${e}`,`ID: ${i}`];if(r&&l.push(`parent ID: ${r}`),!a){const{op:u,description:d}=Vt(o);l.push(`root ID: ${o.spanContext().spanId}`),u&&l.push(`root op: ${u}`),d&&l.push(`root description: ${d}`)}xe.log(`${c}
  ${l.join(`
  `)}`)}function hMe(t){if(!_t)return;const{description:e="< unknown name >",op:n="< unknown op >"}=Vt(t),{spanId:r}=t.spanContext(),s=Ai(t)===t,o=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${e}" with ID ${r}`;xe.log(o)}function kne(t){if(typeof t=="boolean")return Number(t);const e=typeof t=="string"?parseFloat(t):t;if(typeof e!="number"||isNaN(e)||e<0||e>1){_t&&xe.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`);return}return e}function pMe(t,e){if(!Mu(t))return[!1];let n;typeof t.tracesSampler=="function"?n=t.tracesSampler(e):e.parentSampled!==void 0?n=e.parentSampled:typeof t.tracesSampleRate<"u"?n=t.tracesSampleRate:n=1;const r=kne(n);return r===void 0?(_t&&xe.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):r?Math.random()<r?[!0,r]:(_t&&xe.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(n)})`),[!1,r]):(_t&&xe.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,r])}function gMe(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function mMe(t,e,n,r){const i=pne(n),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:Jv(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return Xv(s,[o])}function vMe(t,e,n,r){const i=pne(n),s=t.type&&t.type!=="replay_event"?t.type:"event";gMe(t,n&&n.sdk);const o=N6e(t,i,r,e);return delete t.sdkProcessingMetadata,Xv(o,[[{type:s},t]])}function yMe(t,e){function n(u){return!!u.trace_id&&!!u.public_key}const r=Ap(t[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,o={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&i&&{dsn:Jv(i)}},a=e&&e.getOptions().beforeSendSpan,c=a?u=>a(Vt(u)):u=>Vt(u),l=[];for(const u of t){const d=c(u);d&&l.push(A6e(d))}return Xv(o,l)}function _Me(t,e,n,r=ts()){const i=r&&Ai(r);i&&i.addEvent(t,{[NR]:e,[DR]:n})}function WH(t){if(!t||t.length===0)return;const e={};return t.forEach(n=>{const r=n.attributes||{},i=r[DR],s=r[NR];typeof i=="string"&&typeof s=="number"&&(e[n.name]={value:s,unit:i})}),e}const YH=1e3;class vD{constructor(e={}){this._traceId=e.traceId||nr(),this._spanId=e.spanId||nr().substring(16),this._startTime=e.startTimestamp||_s(),this._attributes={},this.setAttributes({[Or]:"manual",[Ou]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,n){}spanContext(){const{_spanId:e,_traceId:n,_sampled:r}=this;return{spanId:e,traceId:n,traceFlags:r?_ne:yne}}setAttribute(e,n){return n===void 0?delete this._attributes[e]:this._attributes[e]=n,this}setAttributes(e){return Object.keys(e).forEach(n=>this.setAttribute(n,e[n])),this}updateStartTime(e){this._startTime=Bh(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this}end(e){this._endTime||(this._endTime=Bh(e),hMe(this),this._onSpanEnded())}getSpanJSON(){return Oi({data:this._attributes,description:this._name,op:this._attributes[Ou],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:Sne(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Or],_metrics_summary:QA(this),profile_id:this._attributes[nMe],exclusive_time:this._attributes[gD],measurements:WH(this._events),is_segment:this._isStandaloneSpan&&Ai(this)===this||void 0,segment_id:this._isStandaloneSpan?Ai(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,n,r){_t&&xe.log("[Tracing] Adding an event to span:",e);const i=JH(n)?n:r||_s(),s=JH(n)?{}:n||{},o={name:e,time:Bh(i),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=en();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===Ai(this)))return;if(this._isStandaloneSpan){this._sampled?SMe(yMe([this],e)):(_t&&xe.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(GH(this).scope||Cn()).captureEvent(r)}_convertSpanToTransaction(){if(!XH(Vt(this)))return;this._name||(_t&&xe.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:n}=GH(this),i=(e||Cn()).getClient()||en();if(this._sampled!==!0){_t&&xe.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const o=kT(this).filter(d=>d!==this&&!bMe(d)).map(d=>Vt(d)).filter(XH),a=this._attributes[ic],c={contexts:{trace:sMe(this)},spans:o.length>YH?o.sort((d,f)=>d.start_timestamp-f.start_timestamp).slice(0,YH):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:n,...Oi({dynamicSamplingContext:Ap(this)})},_metrics_summary:QA(this),...a&&{transaction_info:{source:a}}},l=WH(this._events);return l&&Object.keys(l).length&&(_t&&xe.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),c.measurements=l),c}}function JH(t){return t&&typeof t=="number"||t instanceof Date||Array.isArray(t)}function XH(t){return!!t.start_timestamp&&!!t.timestamp&&!!t.span_id&&!!t.trace_id}function bMe(t){return t instanceof vD&&t.isStandaloneSpan()}function SMe(t){const e=en();if(!e)return;const n=t[1];if(!n||n.length===0){e.recordDroppedEvent("before_send","span");return}const r=e.getTransport();r&&r.send(t).then(null,i=>{_t&&xe.error("Error while sending span:",i)})}const Rne="__SENTRY_SUPPRESS_TRACING__";function Of(t){const e=xne();if(e.startInactiveSpan)return e.startInactiveSpan(t);const n=EMe(t),{forceTransaction:r,parentSpan:i}=t;return(t.scope?o=>LR(t.scope,o):i!==void 0?o=>Ine(i,o):o=>o())(()=>{const o=Cn(),a=CMe(o);return t.onlyIfParent&&!a?new Qv:wMe({parentSpan:a,spanArguments:n,forceTransaction:r,scope:o})})}function Ine(t,e){const n=xne();return n.withActiveSpan?n.withActiveSpan(t,e):LR(r=>(I_(r,t||void 0),e(r)))}function wMe({parentSpan:t,spanArguments:e,forceTransaction:n,scope:r}){if(!Mu())return new Qv;const i=mc();let s;if(t&&!n)s=TMe(t,r,e),wne(t,s);else if(t){const o=Ap(t),{traceId:a,spanId:c}=t.spanContext(),l=Mp(t);s=ZH({traceId:a,parentSpanId:c,...e},r,l),zH(s,o)}else{const{traceId:o,dsc:a,parentSpanId:c,sampled:l}={...i.getPropagationContext(),...r.getPropagationContext()};s=ZH({traceId:o,parentSpanId:c,...e},r,l),a&&zH(s,a)}return fMe(s),dMe(s,r,i),s}function EMe(t){const n={isStandalone:(t.experimental||{}).standalone,...t};if(t.startTime){const r={...n};return r.startTimestamp=Bh(t.startTime),delete r.startTime,r}return n}function xne(){const t=Zv();return Ob(t)}function ZH(t,e,n){const r=en(),i=r&&r.getOptions()||{},{name:s="",attributes:o}=t,[a,c]=e.getScopeData().sdkProcessingMetadata[Rne]?[!1]:pMe(i,{name:s,parentSampled:n,attributes:o,transactionContext:{name:s,parentSampled:n}}),l=new vD({...t,attributes:{[ic]:"custom",...t.attributes},sampled:a});return c!==void 0&&l.setAttribute(gne,c),r&&r.emit("spanStart",l),l}function TMe(t,e,n){const{spanId:r,traceId:i}=t.spanContext(),s=e.getScopeData().sdkProcessingMetadata[Rne]?!1:Mp(t),o=s?new vD({...n,parentSpanId:r,traceId:i,sampled:s}):new Qv({traceId:i});wne(t,o);const a=en();return a&&(a.emit("spanStart",o),n.endTimestamp&&a.emit("spanEnd",o)),o}function CMe(t){const e=uk(t);if(!e)return;const n=en();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?Ai(e):e}const RT={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},kMe="heartbeatFailed",RMe="idleTimeout",IMe="finalTimeout",xMe="externalFinish";function Pne(t,e={}){const n=new Map;let r=!1,i,s=xMe,o=!e.disableAutoFinish;const a=[],{idleTimeout:c=RT.idleTimeout,finalTimeout:l=RT.finalTimeout,childSpanTimeout:u=RT.childSpanTimeout,beforeSpanEnd:d}=e,f=en();if(!f||!Mu())return new Qv;const p=Cn(),m=ts(),v=PMe(t);v.end=new Proxy(v.end,{apply(R,O,A){d&&d(v);const[U,...N]=A,L=U||_s(),j=Bh(L),X=kT(v).filter(K=>K!==v);if(!X.length)return I(j),Reflect.apply(R,O,[j,...N]);const G=X.map(K=>Vt(K).timestamp).filter(K=>!!K),F=G.length?Math.max(...G):void 0,V=Vt(v).start_timestamp,J=Math.min(V?V+l/1e3:1/0,Math.max(V||-1/0,Math.min(j,F||1/0)));return I(J),Reflect.apply(R,O,[J,...N])}});function S(){i&&(clearTimeout(i),i=void 0)}function _(R){S(),i=setTimeout(()=>{!r&&n.size===0&&o&&(s=RMe,v.end(R))},c)}function w(R){i=setTimeout(()=>{!r&&o&&(s=kMe,v.end(R))},u)}function T(R){S(),n.set(R,!0);const O=_s();w(O+u/1e3)}function C(R){if(n.has(R)&&n.delete(R),n.size===0){const O=_s();_(O+c/1e3)}}function I(R){r=!0,n.clear(),a.forEach(j=>j()),I_(p,m);const O=Vt(v),{start_timestamp:A}=O;if(!A)return;(O.data||{})[e5]||v.setAttribute(e5,s),xe.log(`[Tracing] Idle span "${O.op}" finished`);const N=kT(v).filter(j=>j!==v);let L=0;N.forEach(j=>{j.isRecording()&&(j.setStatus({code:Xr,message:"cancelled"}),j.end(R),_t&&xe.log("[Tracing] Cancelling span since span ended early",JSON.stringify(j,void 0,2)));const X=Vt(j),{timestamp:G=0,start_timestamp:F=0}=X,V=F<=R,J=(l+c)/1e3,K=G-F<=J;if(_t){const W=JSON.stringify(j,void 0,2);V?K||xe.log("[Tracing] Discarding span since it finished after idle span final timeout",W):xe.log("[Tracing] Discarding span since it happened after idle span was finished",W)}(!K||!V)&&(lMe(v,j),L++)}),L>0&&v.setAttribute("sentry.idle_span_discarded_spans",L)}return a.push(f.on("spanStart",R=>{if(r||R===v||Vt(R).timestamp)return;kT(v).includes(R)&&T(R.spanContext().spanId)})),a.push(f.on("spanEnd",R=>{r||C(R.spanContext().spanId)})),a.push(f.on("idleSpanEnableAutoFinish",R=>{R===v&&(o=!0,_(),n.size&&w())})),e.disableAutoFinish||_(),setTimeout(()=>{r||(v.setStatus({code:Xr,message:"deadline_exceeded"}),s=IMe,v.end())},l),v}function PMe(t){const e=Of(t);return I_(Cn(),e),_t&&xe.log("[Tracing] Started span is an idle span"),e}function r5(t,e,n,r=0){return new ia((i,s)=>{const o=t[r];if(e===null||typeof o!="function")i(e);else{const a=o({...e},n);_t&&o.id&&a===null&&xe.log(`Event processor "${o.id}" dropped event`),MR(a)?a.then(c=>r5(t,c,n,r+1).then(i)).then(null,s):r5(t,a,n,r+1).then(i).then(null,s)}})}function OMe(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;MMe(t,e),r&&DMe(t,r),NMe(t,n),AMe(t,i),LMe(t,s)}function QH(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:u,attachments:d,propagationContext:f,transactionName:p,span:m}=e;n1(t,"extra",n),n1(t,"tags",r),n1(t,"user",i),n1(t,"contexts",s),n1(t,"sdkProcessingMetadata",a),o&&(t.level=o),p&&(t.transactionName=p),m&&(t.span=m),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),l.length&&(t.fingerprint=[...t.fingerprint,...l]),u.length&&(t.eventProcessors=[...t.eventProcessors,...u]),d.length&&(t.attachments=[...t.attachments,...d]),t.propagationContext={...t.propagationContext,...f}}function n1(t,e,n){if(n&&Object.keys(n).length){t[e]={...t[e]};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[e][r]=n[r])}}function MMe(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,transactionName:a}=e,c=Oi(n);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});const l=Oi(r);l&&Object.keys(l).length&&(t.tags={...l,...t.tags});const u=Oi(i);u&&Object.keys(u).length&&(t.user={...u,...t.user});const d=Oi(s);d&&Object.keys(d).length&&(t.contexts={...d,...t.contexts}),o&&(t.level=o),a&&t.type!=="transaction"&&(t.transaction=a)}function AMe(t,e){const n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}function LMe(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function DMe(t,e){t.contexts={trace:oMe(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:Ap(e),...t.sdkProcessingMetadata};const n=Ai(e),r=Vt(n).description;r&&!t.transaction&&t.type==="transaction"&&(t.transaction=r)}function NMe(t,e){t.fingerprint=t.fingerprint?lne(t.fingerprint):[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function UMe(t,e,n,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=t,c={...e,event_id:e.event_id||n.event_id||nr(),timestamp:e.timestamp||Pb()},l=n.integrations||t.integrations.map(S=>S.name);$Me(c,t),jMe(c,l),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&FMe(c,t.stackParser);const u=KMe(r,n.captureContext);n.mechanism&&R_(c,n.mechanism);const d=i?i.getEventProcessors():[],f=eMe().getScopeData();if(s){const S=s.getScopeData();QH(f,S)}if(u){const S=u.getScopeData();QH(f,S)}const p=[...n.attachments||[],...f.attachments];p.length&&(n.attachments=p),OMe(c,f);const m=[...d,...f.eventProcessors];return r5(m,c,n).then(S=>(S&&BMe(S),typeof o=="number"&&o>0?HMe(S,o,a):S))}function $Me(t,e){const{environment:n,release:r,dist:i,maxValueLength:s=250}=e;"environment"in t||(t.environment="environment"in e?n:mD),t.release===void 0&&r!==void 0&&(t.release=r),t.dist===void 0&&i!==void 0&&(t.dist=i),t.message&&(t.message=Om(t.message,s));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=Om(o.value,s));const a=t.request;a&&a.url&&(a.url=Om(a.url,s))}const eK=new WeakMap;function FMe(t,e){const n=Gt._sentryDebugIds;if(!n)return;let r;const i=eK.get(e);i?r=i:(r=new Map,eK.set(e,r));const s=Object.entries(n).reduce((o,[a,c])=>{let l;const u=r.get(a);u?l=u:(l=e(a),r.set(a,l));for(let d=l.length-1;d>=0;d--){const f=l[d];if(f.filename){o[f.filename]=c;break}}return o},{});try{t.exception.values.forEach(o=>{o.stacktrace.frames.forEach(a=>{a.filename&&(a.debug_id=s[a.filename])})})}catch{}}function BMe(t){const e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const n=t.debug_meta.images;Object.entries(e).forEach(([r,i])=>{n.push({type:"sourcemap",code_file:r,debug_id:i})})}function jMe(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function HMe(t,e,n){if(!t)return null;const r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(i=>({...i,...i.data&&{data:yd(i.data,e,n)}}))},...t.user&&{user:yd(t.user,e,n)},...t.contexts&&{contexts:yd(t.contexts,e,n)},...t.extra&&{extra:yd(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=yd(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(i=>({...i,...i.data&&{data:yd(i.data,e,n)}}))),r}function KMe(t,e){if(!e)return t;const n=t?t.clone():new hf;return n.update(e),n}function VMe(t){if(t)return qMe(t)?{captureContext:t}:zMe(t)?{captureContext:t}:t}function qMe(t){return t instanceof hf||typeof t=="function"}const GMe=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function zMe(t){return Object.keys(t).some(e=>GMe.includes(e))}function $R(t,e){return Cn().captureException(t,VMe(e))}function WMe(t,e){const r={captureContext:e};return Cn().captureMessage(t,void 0,r)}function One(t,e){return Cn().captureEvent(t,e)}function YMe(t,e){mc().setContext(t,e)}function JMe(){return mc().lastEventId()}function tK(t){const e=en(),n=mc(),r=Cn(),{release:i,environment:s=mD}=e&&e.getOptions()||{},{userAgent:o}=Gt.navigator||{},a=V6e({release:i,environment:s,user:r.getUser()||n.getUser(),...o&&{userAgent:o},...t}),c=n.getSession();return c&&c.status==="ok"&&gv(c,{status:"exited"}),Mne(),n.setSession(a),r.setSession(a),a}function Mne(){const t=mc(),e=Cn(),n=e.getSession()||t.getSession();n&&q6e(n),Ane(),t.setSession(),e.setSession()}function Ane(){const t=mc(),e=Cn(),n=en(),r=e.getSession()||t.getSession();r&&n&&n.captureSession(r)}function nK(t=!1){if(t){Mne();return}Ane()}const XMe="7";function Lne(t){const e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function ZMe(t){return`${Lne(t)}${t.projectId}/envelope/`}function QMe(t,e){return QOe({sentry_key:t.publicKey,sentry_version:XMe,...e&&{sentry_client:`${e.name}/${e.version}`}})}function eAe(t,e,n){return e||`${ZMe(t)}?${QMe(t,n)}`}function tAe(t,e){const n=Xte(t);if(!n)return"";const r=`${Lne(n)}embed/error-page/`;let i=`dsn=${Jv(n)}`;for(const s in e)if(s!=="dsn"&&s!=="onClose")if(s==="user"){const o=e.user;if(!o)continue;o.name&&(i+=`&name=${encodeURIComponent(o.name)}`),o.email&&(i+=`&email=${encodeURIComponent(o.email)}`)}else i+=`&${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`;return`${r}?${i}`}const rK=[];function nAe(t){const e={};return t.forEach(n=>{const{name:r}=n,i=e[r];i&&!i.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.values(e)}function rAe(t){const e=t.defaultIntegrations||[],n=t.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;Array.isArray(n)?r=[...e,...n]:typeof n=="function"?r=lne(n(e)):r=e;const i=nAe(r),s=i.findIndex(o=>o.name==="Debug");if(s>-1){const[o]=i.splice(s,1);i.push(o)}return i}function iAe(t,e){const n={};return e.forEach(r=>{r&&Dne(t,r,n)}),n}function iK(t,e){for(const n of e)n&&n.afterAllSetup&&n.afterAllSetup(t)}function Dne(t,e,n){if(n[e.name]){_t&&xe.log(`Integration skipped because it was already installed: ${e.name}`);return}if(n[e.name]=e,rK.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),rK.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,s)=>r(i,s,t))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,o)=>r(s,o,t),{id:e.name});t.addEventProcessor(i)}_t&&xe.log(`Integration installed: ${e.name}`)}const sK="Not capturing exception because it's already been captured.";class sAe{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Xte(e.dsn):_t&&xe.warn("No DSN provided, client will not send events."),this._dsn){const n=eAe(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:n})}}captureException(e,n,r){const i=nr();if(FH(e))return _t&&xe.log(sK),i;const s={event_id:i,...n};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,r))),s.event_id}captureMessage(e,n,r,i){const s={event_id:nr(),...r},o=lD(e)?e:String(e),a=uD(e)?this.eventFromMessage(o,n,s):this.eventFromException(e,s);return this._process(a.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,n,r){const i=nr();if(n&&n.originalException&&FH(n.originalException))return _t&&xe.log(sK),i;const s={event_id:i,...n},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?_t&&xe.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),gv(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):dp(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const n=this._integrations[e.name];Dne(this,e,this._integrations),n||iK(this,[e])}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=vMe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=P6e(r,L6e(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const n=mMe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${n}`;_t&&xe.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,n){const r=this._hooks[e]=this._hooks[e]||[];return r.push(n),()=>{const i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){const r=this._hooks[e];r&&r.forEach(i=>i(...n))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,n=>(_t&&xe.error("Error while sending event:",n),n)):(_t&&xe.error("Transport disabled"),dp({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=iAe(this,e),iK(this,e)}_updateSessionFromEvent(e,n){let r=!1,i=!1;const s=n.exception&&n.exception.values;if(s){i=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(gv(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new ia(n=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),n(!0)):(r+=i,e&&r>=e&&(clearInterval(s),n(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r,i=mc()){const s=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o.length>0&&(n.integrations=o),this.emit("preprocessEvent",e,n),e.type||i.setLastEventId(e.event_id||n.event_id),UMe(s,e,n,r,this,i).then(a=>{if(a===null)return a;const c={...i.getPropagationContext(),...r?r.getPropagationContext():void 0};if(!(a.contexts&&a.contexts.trace)&&c){const{traceId:u,spanId:d,parentSpanId:f,dsc:p}=c;a.contexts={trace:Oi({trace_id:u,span_id:d,parent_span_id:f}),...a.contexts};const m=p||UR(u,this);a.sdkProcessingMetadata={dynamicSamplingContext:m,...a.sdkProcessingMetadata}}return a})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{if(_t){const s=i;s.logLevel==="log"?xe.log(s.message):xe.warn(s)}})}_processEvent(e,n,r){const i=this.getOptions(),{sampleRate:s}=i,o=Une(e),a=Nne(e),c=e.type||"error",l=`before send for type \`${c}\``,u=typeof s>"u"?void 0:kne(s);if(a&&typeof u=="number"&&Math.random()>u)return this.recordDroppedEvent("sample_rate","error",e),ck(new Wc(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const d=c==="replay_event"?"replay":c,p=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,n,r,p).then(m=>{if(m===null)throw this.recordDroppedEvent("event_processor",d,e),new Wc("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return m;const S=aAe(this,i,m,n);return oAe(S,l)}).then(m=>{if(m===null){if(this.recordDroppedEvent("before_send",d,e),o){const w=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",w)}throw new Wc(`${l} returned \`null\`, will not send event.`,"log")}const v=r&&r.getSession();if(!o&&v&&this._updateSessionFromEvent(v,m),o){const _=m.sdkProcessingMetadata&&m.sdkProcessingMetadata.spanCountBeforeProcessing||0,w=m.spans?m.spans.length:0,T=_-w;T>0&&this.recordDroppedEvent("before_send","span",T)}const S=m.transaction_info;if(o&&S&&m.transaction!==e.transaction){const _="custom";m.transaction_info={...S,source:_}}return this.sendEvent(m,n),m}).then(null,m=>{throw m instanceof Wc?m:(this.captureException(m,{data:{__sentry__:!0},originalException:m}),new Wc(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${m}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([n,r])=>{const[i,s]=n.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){_t&&xe.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){_t&&xe.log("No outcomes to send");return}if(!this._dsn){_t&&xe.log("No dsn provided, will not send outcomes");return}_t&&xe.log("Sending outcomes:",e);const n=U6e(e,this._options.tunnel&&Jv(this._dsn));this.sendEnvelope(n)}}function oAe(t,e){const n=`${e} must return \`null\` or a valid event.`;if(MR(t))return t.then(r=>{if(!pv(r)&&r!==null)throw new Wc(n);return r},r=>{throw new Wc(`${e} rejected with ${r}`)});if(!pv(t)&&t!==null)throw new Wc(n);return t}function aAe(t,e,n,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:o}=e;if(Nne(n)&&i)return i(n,r);if(Une(n)){if(n.spans&&o){const a=[];for(const c of n.spans){const l=o(c);l?a.push(l):t.recordDroppedEvent("before_send","span")}n.spans=a}if(s){if(n.spans){const a=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:a}}return s(n,r)}}return n}function Nne(t){return t.type===void 0}function Une(t){return t.type==="transaction"}function cAe(t,e){e.debug===!0&&(_t?xe.enable():xb(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Cn().update(e.initialScope);const r=new t(e);return lAe(r),r.init(),r}function lAe(t){Cn().setClient(t)}const uAe=64;function dAe(t,e,n=b6e(t.bufferSize||uAe)){let r={};const i=o=>n.drain(o);function s(o){const a=[];if(jH(o,(d,f)=>{const p=HH(f);if(j6e(r,p)){const m=oK(d,f);t.recordDroppedEvent("ratelimit_backoff",p,m)}else a.push(d)}),a.length===0)return dp({});const c=Xv(o[0],a),l=d=>{jH(c,(f,p)=>{const m=oK(f,p);t.recordDroppedEvent(d,HH(p),m)})},u=()=>e({body:O6e(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&_t&&xe.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=H6e(r,d),d),d=>{throw l("network_error"),d});return n.add(u).then(d=>d,d=>{if(d instanceof Wc)return _t&&xe.error("Skipped sending event because buffer is full."),l("queue_overflow"),dp({});throw d})}return{send:s,flush:i}}function oK(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}function $ne(t,e,n=[e],r="npm"){const i=t._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:$h})),version:$h}),t._metadata=i}const fAe=100;function fp(t,e){const n=en(),r=mc();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=fAe}=n.getOptions();if(s<=0)return;const a={timestamp:Pb(),...t},c=i?xb(()=>i(a,e)):a;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let aK;const hAe="FunctionToString",cK=new WeakMap,pAe=()=>({name:hAe,setupOnce(){aK=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=dD(this),n=cK.has(en())&&e!==void 0?e:this;return aK.apply(n,t)}}catch{}},setup(t){cK.set(t,!0)}}),gAe=pAe,mAe=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],vAe="InboundFilters",yAe=(t={})=>({name:vAe,processEvent(e,n,r){const i=r.getOptions(),s=bAe(t,i);return SAe(e,s)?null:e}}),_Ae=yAe;function bAe(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:mAe],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function SAe(t,e){return e.ignoreInternal&&RAe(t)?(_t&&xe.warn(`Event dropped due to being internal Sentry Error.
Event: ${vd(t)}`),!0):wAe(t,e.ignoreErrors)?(_t&&xe.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${vd(t)}`),!0):xAe(t)?(_t&&xe.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${vd(t)}`),!0):EAe(t,e.ignoreTransactions)?(_t&&xe.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${vd(t)}`),!0):TAe(t,e.denyUrls)?(_t&&xe.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${vd(t)}.
Url: ${dk(t)}`),!0):CAe(t,e.allowUrls)?!1:(_t&&xe.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${vd(t)}.
Url: ${dk(t)}`),!0)}function wAe(t,e){return t.type||!e||!e.length?!1:kAe(t).some(n=>Uh(n,e))}function EAe(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;const n=t.transaction;return n?Uh(n,e):!1}function TAe(t,e){if(!e||!e.length)return!1;const n=dk(t);return n?Uh(n,e):!1}function CAe(t,e){if(!e||!e.length)return!0;const n=dk(t);return n?Uh(n,e):!0}function kAe(t){const e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),e}function RAe(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function IAe(t=[]){for(let e=t.length-1;e>=0;e--){const n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function dk(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?IAe(e):null}catch{return _t&&xe.error(`Cannot extract url for event ${vd(t)}`),null}}function xAe(t){return t.type||!t.exception||!t.exception.values||t.exception.values.length===0?!1:!t.message&&!t.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}const PAe="Dedupe",OAe=()=>{let t;return{name:PAe,processEvent(e){if(e.type)return e;try{if(AAe(e,t))return _t&&xe.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}},MAe=OAe;function AAe(t,e){return e?!!(LAe(t,e)||DAe(t,e)):!1}function LAe(t,e){const n=t.message,r=e.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!Bne(t,e)||!Fne(t,e))}function DAe(t,e){const n=lK(e),r=lK(t);return!(!n||!r||n.type!==r.type||n.value!==r.value||!Bne(t,e)||!Fne(t,e))}function Fne(t,e){let n=NH(t),r=NH(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let i=0;i<r.length;i++){const s=r[i],o=n[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function Bne(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function lK(t){return t.exception&&t.exception.values&&t.exception.values[0]}function NAe(t,e,n,r,i="auto.http.browser"){if(!t.fetchData)return;const s=Mu()&&e(t.fetchData.url);if(t.endTimestamp&&s){const m=t.fetchData.__span;if(!m)return;const v=r[m];v&&(FAe(v,t),delete r[m]);return}const o=Cn(),a=en(),{method:c,url:l}=t.fetchData,u=$Ae(l),d=u?Fh(u).host:void 0,f=!!ts(),p=s&&f?Of({name:`${c} ${l}`,attributes:{url:l,type:"fetch","http.method":c,"http.url":u,"server.address":d,[Or]:i,[Ou]:"http.client"}}):new Qv;if(t.fetchData.__span=p.spanContext().spanId,r[p.spanContext().spanId]=p,n(t.fetchData.url)&&a){const m=t.args[0];t.args[1]=t.args[1]||{};const v=t.args[1];v.headers=UAe(m,a,o,v,Mu()&&f?p:void 0)}return p}function UAe(t,e,n,r,i){const s=mc(),{traceId:o,spanId:a,sampled:c,dsc:l}={...s.getPropagationContext(),...n.getPropagationContext()},u=i?bne(i):fD(o,a,c),d=hne(l||(i?Ap(i):UR(o,e))),f=r.headers||(typeof Request<"u"&&xu(t,Request)?t.headers:void 0);if(f)if(typeof Headers<"u"&&xu(f,Headers)){const p=new Headers(f);return p.append("sentry-trace",u),d&&p.append(JA,d),p}else if(Array.isArray(f)){const p=[...f,["sentry-trace",u]];return d&&p.push([JA,d]),p}else{const p="baggage"in f?f.baggage:void 0,m=[];return Array.isArray(p)?m.push(...p):p&&m.push(p),d&&m.push(d),{...f,"sentry-trace":u,baggage:m.length>0?m.join(","):void 0}}else return{"sentry-trace":u,baggage:d}}function $Ae(t){try{return new URL(t).href}catch{return}}function FAe(t,e){if(e.response){vne(t,e.response.status);const n=e.response&&e.response.headers&&e.response.headers.get("content-length");if(n){const r=parseInt(n);r>0&&t.setAttribute("http.response_content_length",r)}}else e.error&&t.setStatus({code:Xr,message:"internal_error"});t.end()}const it=Gt;let i5=0;function jne(){return i5>0}function BAe(){i5++,setTimeout(()=>{i5--})}function vv(t,e={},n){if(typeof t!="function")return t;try{const i=t.__sentry_wrapped__;if(i)return i;if(dD(t))return t}catch{return t}const r=function(){const i=Array.prototype.slice.call(arguments);try{const s=i.map(o=>vv(o,e));return t.apply(this,s)}catch(s){throw BAe(),LR(o=>{o.addEventProcessor(a=>(e.mechanism&&(WA(a,void 0),R_(a,e.mechanism)),a.extra={...a.extra,arguments:i},a)),$R(s)}),s}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}catch{}Zte(r,t),Ra(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return t.name}})}catch{}return r}const eo=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function yD(t,e){const n=_D(t,e),r={type:e&&e.name,value:qAe(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function jAe(t,e,n,r){const i=en(),s=i&&i.getOptions().normalizeDepth,o=JAe(e),a={__serialized__:une(e,s)};if(o)return{exception:{values:[yD(t,o)]},extra:a};const c={exception:{values:[{type:OR(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:WAe(e,{isUnhandledRejection:r})}]},extra:a};if(n){const l=_D(t,n);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function bP(t,e){return{exception:{values:[yD(t,e)]}}}function _D(t,e){const n=e.stacktrace||e.stack||"",r=KAe(e),i=VAe(e);try{return t(n,r,i)}catch{}return[]}const HAe=/Minified React error #\d+;/i;function KAe(t){return t&&HAe.test(t.message)?1:0}function VAe(t){return typeof t.framesToPop=="number"?t.framesToPop:0}function qAe(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}function GAe(t,e,n,r){const i=n&&n.syntheticException||void 0,s=bD(t,e,i,r);return R_(s),s.level="error",n&&n.event_id&&(s.event_id=n.event_id),dp(s)}function zAe(t,e,n="info",r,i){const s=r&&r.syntheticException||void 0,o=s5(t,e,s,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),dp(o)}function bD(t,e,n,r,i){let s;if(Gte(e)&&e.error)return bP(t,e.error);if(IH(e)||NOe(e)){const o=e;if("stack"in e)s=bP(t,e);else{const a=o.name||(IH(o)?"DOMError":"DOMException"),c=o.message?`${a}: ${o.message}`:a;s=s5(t,c,n,r),WA(s,c)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return PR(e)?bP(t,e):pv(e)||OR(e)?(s=jAe(t,e,n,i),R_(s,{synthetic:!0}),s):(s=s5(t,e,n,r),WA(s,`${e}`),R_(s,{synthetic:!0}),s)}function s5(t,e,n,r){const i={};if(r&&n){const s=_D(t,n);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]})}if(lD(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function WAe(t,{isUnhandledRejection:e}){const n=e6e(t),r=e?"promise rejection":"exception";return Gte(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:OR(t)?`Event \`${YAe(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function YAe(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch{}}function JAe(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];if(n instanceof Error)return n}}function XAe(t,{metadata:e,tunnel:n,dsn:r}){const i={event_id:t.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:Jv(r)}},s=ZAe(t);return Xv(i,[s])}function ZAe(t){return[{type:"user_report"},t]}class QAe extends sAe{constructor(e){const n={parentSpanIsAlwaysRootSpan:!0,...e},r=it.SENTRY_SDK_SOURCE||p6e();$ne(n,"browser",["browser"],r),super(n),n.sendClientReports&&it.document&&it.document.addEventListener("visibilitychange",()=>{it.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return GAe(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return zAe(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){eo&&xe.warn("SDK not enabled, will not capture user feedback.");return}const n=XAe(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}}const Io=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,e5e=(t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good",ey=(t,e,n,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(i||0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=e5e(e.value,n),t(e)))}},ft=Gt,t5e=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,Mb=()=>ft.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],Ab=()=>{const t=Mb();return t&&t.activationStart||0},ty=(t,e)=>{const n=Mb();let r="navigate";return n&&(ft.document&&ft.document.prerendering||Ab()>0?r="prerender":ft.document&&ft.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:t5e(),navigationType:r}},Lp=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}},Lb=t=>{const e=n=>{(n.type==="pagehide"||ft.document&&ft.document.visibilityState==="hidden")&&t(n)};ft.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},SD=t=>{let e=!1;return n=>{e||(t(n),e=!0)}};let x_=-1;const n5e=()=>{x_=ft.document.visibilityState==="hidden"&&!ft.document.prerendering?0:1/0},fk=t=>{ft.document.visibilityState==="hidden"&&x_>-1&&(x_=t.type==="visibilitychange"?t.timeStamp:0,removeEventListener("visibilitychange",fk,!0),removeEventListener("prerenderingchange",fk,!0))},r5e=()=>{addEventListener("visibilitychange",fk,!0),addEventListener("prerenderingchange",fk,!0)},FR=()=>(ft.document&&x_<0&&(n5e(),r5e()),{get firstHiddenTime(){return x_}}),Db=t=>{ft.document&&ft.document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},i5e=[1800,3e3],s5e=(t,e={})=>{Db(()=>{const n=FR(),r=ty("FCP");let i;const o=Lp("paint",a=>{a.forEach(c=>{c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-Ab(),0),r.entries.push(c),i(!0)))})});o&&(i=ey(t,r,i5e,e.reportAllChanges))})},o5e=[.1,.25],a5e=(t,e={})=>{s5e(SD(()=>{const n=ty("CLS",0);let r,i=0,s=[];const o=c=>{c.forEach(l=>{if(!l.hadRecentInput){const u=s[0],d=s[s.length-1];i&&u&&d&&l.startTime-d.startTime<1e3&&l.startTime-u.startTime<5e3?(i+=l.value,s.push(l)):(i=l.value,s=[l])}}),i>n.value&&(n.value=i,n.entries=s,r())},a=Lp("layout-shift",o);a&&(r=ey(t,n,o5e,e.reportAllChanges),Lb(()=>{o(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},c5e=[100,300],l5e=(t,e={})=>{Db(()=>{const n=FR(),r=ty("FID");let i;const s=c=>{c.startTime<n.firstHiddenTime&&(r.value=c.processingStart-c.startTime,r.entries.push(c),i(!0))},o=c=>{c.forEach(s)},a=Lp("first-input",o);i=ey(t,r,c5e,e.reportAllChanges),a&&Lb(SD(()=>{o(a.takeRecords()),a.disconnect()}))})};let Hne=0,SP=1/0,$w=0;const u5e=t=>{t.forEach(e=>{e.interactionId&&(SP=Math.min(SP,e.interactionId),$w=Math.max($w,e.interactionId),Hne=$w?($w-SP)/7+1:0)})};let o5;const d5e=()=>o5?Hne:performance.interactionCount||0,f5e=()=>{"interactionCount"in performance||o5||(o5=Lp("event",u5e,{type:"event",buffered:!0,durationThreshold:0}))},h5e=[200,500],p5e=0,Kne=()=>d5e()-p5e,uK=10,Jl=[],wP={},dK=t=>{const e=Jl[Jl.length-1],n=wP[t.interactionId];if(n||Jl.length<uK||e&&t.duration>e.latency){if(n)n.entries.push(t),n.latency=Math.max(n.latency,t.duration);else{const r={id:t.interactionId,latency:t.duration,entries:[t]};wP[r.id]=r,Jl.push(r)}Jl.sort((r,i)=>i.latency-r.latency),Jl.splice(uK).forEach(r=>{delete wP[r.id]})}},g5e=()=>{const t=Math.min(Jl.length-1,Math.floor(Kne()/50));return Jl[t]},m5e=(t,e={})=>{Db(()=>{f5e();const n=ty("INP");let r;const i=o=>{o.forEach(c=>{c.interactionId&&dK(c),c.entryType==="first-input"&&!Jl.some(u=>u.entries.some(d=>c.duration===d.duration&&c.startTime===d.startTime))&&dK(c)});const a=g5e();a&&a.latency!==n.value&&(n.value=a.latency,n.entries=a.entries,r())},s=Lp("event",i,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:40});r=ey(t,n,h5e,e.reportAllChanges),s&&("PerformanceEventTiming"in ft&&"interactionId"in PerformanceEventTiming.prototype&&s.observe({type:"first-input",buffered:!0}),Lb(()=>{i(s.takeRecords()),n.value<0&&Kne()>0&&(n.value=0,n.entries=[]),r(!0)}))})},v5e=[2500,4e3],fK={},y5e=(t,e={})=>{Db(()=>{const n=FR(),r=ty("LCP");let i;const s=a=>{const c=a[a.length-1];c&&c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-Ab(),0),r.entries=[c],i())},o=Lp("largest-contentful-paint",s);if(o){i=ey(t,r,v5e,e.reportAllChanges);const a=SD(()=>{fK[r.id]||(s(o.takeRecords()),o.disconnect(),fK[r.id]=!0,i(!0))});["keydown","click"].forEach(c=>{ft.document&&addEventListener(c,()=>setTimeout(a,0),!0)}),Lb(a)}})},_5e=[800,1800],a5=t=>{ft.document&&ft.document.prerendering?Db(()=>a5(t)):ft.document&&ft.document.readyState!=="complete"?addEventListener("load",()=>a5(t),!0):setTimeout(t,0)},b5e=(t,e={})=>{const n=ty("TTFB"),r=ey(t,n,_5e,e.reportAllChanges);a5(()=>{const i=Mb();if(i){const s=i.responseStart;if(s<=0||s>performance.now())return;n.value=Math.max(s-Ab(),0),n.entries=[i],r(!0)}})},v0={},hk={};let Vne,qne,Gne,zne,Wne;function Yne(t,e=!1){return Nb("cls",t,C5e,Vne,e)}function S5e(t,e=!1){return Nb("lcp",t,R5e,Gne,e)}function w5e(t){return Nb("fid",t,k5e,qne)}function E5e(t){return Nb("ttfb",t,I5e,zne)}function T5e(t){return Nb("inp",t,x5e,Wne)}function P_(t,e){return Jne(t,e),hk[t]||(P5e(t),hk[t]=!0),Xne(t,e)}function ny(t,e){const n=v0[t];if(!(!n||!n.length))for(const r of n)try{r(e)}catch(i){Io&&xe.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${Pu(r)}
Error:`,i)}}function C5e(){return a5e(t=>{ny("cls",{metric:t}),Vne=t},{reportAllChanges:!0})}function k5e(){return l5e(t=>{ny("fid",{metric:t}),qne=t})}function R5e(){return y5e(t=>{ny("lcp",{metric:t}),Gne=t},{reportAllChanges:!0})}function I5e(){return b5e(t=>{ny("ttfb",{metric:t}),zne=t})}function x5e(){return m5e(t=>{ny("inp",{metric:t}),Wne=t})}function Nb(t,e,n,r,i=!1){Jne(t,e);let s;return hk[t]||(s=n(),hk[t]=!0),r&&e({metric:r}),Xne(t,e,i?s:void 0)}function P5e(t){const e={};t==="event"&&(e.durationThreshold=0),Lp(t,n=>{ny(t,{entries:n})},e)}function Jne(t,e){v0[t]=v0[t]||[],v0[t].push(e)}function Xne(t,e,n){return()=>{n&&n();const r=v0[t];if(!r)return;const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}function O5e(t){return"duration"in t}function EP(t){return typeof t=="number"&&isFinite(t)}function yv(t,e,n,{...r}){const i=Vt(t).start_timestamp;return i&&i>e&&typeof t.updateStartTime=="function"&&t.updateStartTime(e),Ine(t,()=>{const s=Of({startTime:e,...r});return s&&s.end(n),s})}function Zne(t){const e=en();if(!e)return;const{name:n,transaction:r,attributes:i,startTime:s}=t,{release:o,environment:a}=e.getOptions(),c=e.getIntegrationByName("Replay"),l=c&&c.getReplayId(),u=Cn(),d=u.getUser(),f=d!==void 0?d.email||d.id||d.ip_address:void 0;let p;try{p=u.getScopeData().contexts.profile.profile_id}catch{}const m={release:o,environment:a,user:f||void 0,profile_id:p||void 0,replay_id:l||void 0,transaction:r,"user_agent.original":ft.navigator&&ft.navigator.userAgent,...i};return Of({name:n,attributes:m,startTime:s,experimental:{standalone:!0}})}function wD(){return ft&&ft.addEventListener&&ft.performance}function Er(t){return t/1e3}function M5e(){let t=0,e,n;if(!L5e())return;let r=!1;function i(){r||(r=!0,n&&A5e(t,e,n),s())}const s=Yne(({metric:o})=>{const a=o.entries[o.entries.length-1];a&&(t=o.value,e=a)},!0);Lb(()=>{i()}),setTimeout(()=>{const o=en(),a=ru([o,"optionalAccess",d=>d.on,"call",d=>d("startNavigationSpan",()=>{i(),a&&a()})]),c=ts(),l=c&&Ai(c),u=l&&Vt(l);u&&u.op==="pageload"&&(n=l.spanContext().spanId)},0)}function A5e(t,e,n){Io&&xe.log(`Sending CLS span (${t})`);const r=Er((ro||0)+(ru([e,"optionalAccess",c=>c.startTime])||0)),i=Cn().getScopeData().transactionName,s=e?lp(ru([e,"access",c=>c.sources,"access",c=>c[0],"optionalAccess",c=>c.node])):"Layout shift",o=Oi({[Or]:"auto.http.browser.cls",[Ou]:"ui.webvital.cls",[gD]:ru([e,"optionalAccess",c=>c.duration])||0,"sentry.pageload.span_id":n}),a=Zne({name:s,transaction:i,attributes:o,startTime:r});ru([a,"optionalAccess",c=>c.addEvent,"call",c=>c("cls",{[DR]:"",[NR]:t})]),ru([a,"optionalAccess",c=>c.end,"call",c=>c(r)])}function L5e(){try{return ru([PerformanceObserver,"access",t=>t.supportedEntryTypes,"optionalAccess",t=>t.includes,"call",t=>t("layout-shift")])}catch{return!1}}const D5e=2147483647;let hK=0,_i={},Uc,y0;function N5e({recordClsStandaloneSpans:t}){const e=wD();if(e&&ro){e.mark&&ft.performance.mark("sentry-tracing-init");const n=H5e(),r=j5e(),i=K5e(),s=t?M5e():B5e();return()=>{n(),r(),i(),s&&s()}}return()=>{}}function U5e(){P_("longtask",({entries:t})=>{if(ts())for(const e of t){const n=Er(ro+e.startTime),r=Er(e.duration),i=Of({name:"Main UI thread blocked",op:"ui.long-task",startTime:n,attributes:{[Or]:"auto.ui.browser.metrics"}});i&&i.end(n+r)}})}function $5e(){new PerformanceObserver(e=>{if(ts())for(const n of e.getEntries()){if(!n.scripts[0])continue;const r=Er(ro+n.startTime),i=Er(n.duration),s={[Or]:"auto.ui.browser.metrics"},o=n.scripts[0],{invoker:a,invokerType:c,sourceURL:l,sourceFunctionName:u,sourceCharPosition:d}=o;s["browser.script.invoker"]=a,s["browser.script.invoker_type"]=c,l&&(s["code.filepath"]=l),u&&(s["code.function"]=u),d!==-1&&(s["browser.script.source_char_position"]=d);const f=Of({name:"Main UI thread blocked",op:"ui.long-animation-frame",startTime:r,attributes:s});f&&f.end(r+i)}}).observe({type:"long-animation-frame",buffered:!0})}function F5e(){P_("event",({entries:t})=>{if(ts()){for(const e of t)if(e.name==="click"){const n=Er(ro+e.startTime),r=Er(e.duration),i={name:lp(e.target),op:`ui.interaction.${e.name}`,startTime:n,attributes:{[Or]:"auto.ui.browser.metrics"}},s=Yte(e.target);s&&(i.attributes["ui.component_name"]=s);const o=Of(i);o&&o.end(n+r)}}})}function B5e(){return Yne(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Io&&xe.log(`[Measurements] Adding CLS ${t.value}`),_i.cls={value:t.value,unit:""},y0=e)},!0)}function j5e(){return S5e(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Io&&xe.log("[Measurements] Adding LCP"),_i.lcp={value:t.value,unit:"millisecond"},Uc=e)},!0)}function H5e(){return w5e(({metric:t})=>{const e=t.entries[t.entries.length-1];if(!e)return;const n=Er(ro),r=Er(e.startTime);Io&&xe.log("[Measurements] Adding FID"),_i.fid={value:t.value,unit:"millisecond"},_i["mark.fid"]={value:n+r,unit:"second"}})}function K5e(){return E5e(({metric:t})=>{t.entries[t.entries.length-1]&&(Io&&xe.log("[Measurements] Adding TTFB"),_i.ttfb={value:t.value,unit:"millisecond"})})}function V5e(t,e){const n=wD();if(!n||!ft.performance.getEntries||!ro)return;Io&&xe.log("[Tracing] Adding & adjusting spans using Performance API");const r=Er(ro),i=n.getEntries(),{op:s,start_timestamp:o}=Vt(t);if(i.slice(hK).forEach(a=>{const c=Er(a.startTime),l=Er(Math.max(0,a.duration));if(!(s==="navigation"&&o&&r+c<o))switch(a.entryType){case"navigation":{G5e(t,a,r);break}case"mark":case"paint":case"measure":{q5e(t,a,c,l,r);const u=FR(),d=a.startTime<u.firstHiddenTime;a.name==="first-paint"&&d&&(Io&&xe.log("[Measurements] Adding FP"),_i.fp={value:a.startTime,unit:"millisecond"}),a.name==="first-contentful-paint"&&d&&(Io&&xe.log("[Measurements] Adding FCP"),_i.fcp={value:a.startTime,unit:"millisecond"});break}case"resource":{W5e(t,a,a.name,c,l,r);break}}}),hK=Math.max(i.length-1,0),Y5e(t),s==="pageload"){X5e(_i);const a=_i["mark.fid"];a&&_i.fid&&(yv(t,a.value,a.value+Er(_i.fid.value),{name:"first input delay",op:"ui.action",attributes:{[Or]:"auto.ui.browser.metrics"}}),delete _i["mark.fid"]),(!("fcp"in _i)||!e.recordClsOnPageloadSpan)&&delete _i.cls,Object.entries(_i).forEach(([c,l])=>{_Me(c,l.value,l.unit)}),t.setAttribute("performance.timeOrigin",r),t.setAttribute("performance.activationStart",Ab()),J5e(t)}Uc=void 0,y0=void 0,_i={}}function q5e(t,e,n,r,i){const s=Mb(),o=Er(s?s.requestStart:0),a=i+Math.max(n,o),c=i+n,l=c+r,u={[Or]:"auto.resource.browser.metrics"};return a!==c&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=a),yv(t,a,l,{name:e.name,op:e.entryType,attributes:u}),a}function G5e(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{Fw(t,e,r,n)}),Fw(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),Fw(t,e,"fetch",n,"cache","domainLookupStart"),Fw(t,e,"domainLookup",n,"DNS"),z5e(t,e,n)}function Fw(t,e,n,r,i,s){const o=s?e[s]:e[`${n}End`],a=e[`${n}Start`];!a||!o||yv(t,r+Er(a),r+Er(o),{op:`browser.${i||n}`,name:e.name,attributes:{[Or]:"auto.ui.browser.metrics"}})}function z5e(t,e,n){const r=n+Er(e.requestStart),i=n+Er(e.responseEnd),s=n+Er(e.responseStart);e.responseEnd&&(yv(t,r,i,{op:"browser.request",name:e.name,attributes:{[Or]:"auto.ui.browser.metrics"}}),yv(t,s,i,{op:"browser.response",name:e.name,attributes:{[Or]:"auto.ui.browser.metrics"}}))}function W5e(t,e,n,r,i,s){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const o=Fh(n),a={[Or]:"auto.resource.browser.metrics"};TP(a,e,"transferSize","http.response_transfer_size"),TP(a,e,"encodedBodySize","http.response_content_length"),TP(a,e,"decodedBodySize","http.decoded_response_content_length"),"renderBlockingStatus"in e&&(a["resource.render_blocking_status"]=e.renderBlockingStatus),o.protocol&&(a["url.scheme"]=o.protocol.split(":").pop()),o.host&&(a["server.address"]=o.host),a["url.same_origin"]=n.includes(ft.location.origin);const c=s+r,l=c+i;yv(t,c,l,{name:n.replace(ft.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:a})}function Y5e(t){const e=ft.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&t.setAttribute("connectionType",n.type),EP(n.rtt)&&(_i["connection.rtt"]={value:n.rtt,unit:"millisecond"})),EP(e.deviceMemory)&&t.setAttribute("deviceMemory",`${e.deviceMemory} GB`),EP(e.hardwareConcurrency)&&t.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function J5e(t){Uc&&(Io&&xe.log("[Measurements] Adding LCP Data"),Uc.element&&t.setAttribute("lcp.element",lp(Uc.element)),Uc.id&&t.setAttribute("lcp.id",Uc.id),Uc.url&&t.setAttribute("lcp.url",Uc.url.trim().slice(0,200)),t.setAttribute("lcp.size",Uc.size)),y0&&y0.sources&&(Io&&xe.log("[Measurements] Adding CLS Data"),y0.sources.forEach((e,n)=>t.setAttribute(`cls.source.${n+1}`,lp(e.node))))}function TP(t,e,n,r){const i=e[n];i!=null&&i<D5e&&(t[r]=i)}function X5e(t){const e=Mb();if(!e)return;const{responseStart:n,requestStart:r}=e;r<=n&&(Io&&xe.log("[Measurements] Adding TTFB Request Time"),t["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const Z5e=1e3;let pK,c5,l5;function Q5e(t){const e="dom";xf(e,t),Pf(e,eLe)}function eLe(){if(!ft.document)return;const t=ya.bind(null,"dom"),e=gK(t,!0);ft.document.addEventListener("click",e,!1),ft.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const r=ft[n]&&ft[n].prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(To(r,"addEventListener",function(i){return function(s,o,a){if(s==="click"||s=="keypress")try{const c=this,l=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},u=l[s]=l[s]||{refCount:0};if(!u.handler){const d=gK(t);u.handler=d,i.call(this,s,d,a)}u.refCount++}catch{}return i.call(this,s,o,a)}}),To(r,"removeEventListener",function(i){return function(s,o,a){if(s==="click"||s=="keypress")try{const c=this,l=c.__sentry_instrumentation_handlers__||{},u=l[s];u&&(u.refCount--,u.refCount<=0&&(i.call(this,s,u.handler,a),u.handler=void 0,delete l[s]),Object.keys(l).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return i.call(this,s,o,a)}}))})}function tLe(t){if(t.type!==c5)return!1;try{if(!t.target||t.target._sentryId!==l5)return!1}catch{}return!0}function nLe(t,e){return t!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function gK(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=rLe(n);if(nLe(n.type,r))return;Ra(n,"_sentryCaptured",!0),r&&!r._sentryId&&Ra(r,"_sentryId",nr());const i=n.type==="keypress"?"input":n.type;tLe(n)||(t({event:n,name:i,global:e}),c5=n.type,l5=r?r._sentryId:void 0),clearTimeout(pK),pK=ft.setTimeout(()=>{l5=void 0,c5=void 0},Z5e)}}function rLe(t){try{return t.target}catch{return null}}let Bw;function ED(t){const e="history";xf(e,t),Pf(e,iLe)}function iLe(){if(!K6e())return;const t=ft.onpopstate;ft.onpopstate=function(...n){const r=ft.location.href,i=Bw;if(Bw=r,ya("history",{from:i,to:r}),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=Bw,o=String(i);Bw=o,ya("history",{from:s,to:o})}return n.apply(this,r)}}To(ft.history,"pushState",e),To(ft.history,"replaceState",e)}const IT={};function sLe(t){const e=IT[t];if(e)return e;let n=ft[t];if(GA(n))return IT[t]=n.bind(ft);const r=ft.document;if(r&&typeof r.createElement=="function")try{const i=r.createElement("iframe");i.hidden=!0,r.head.appendChild(i);const s=i.contentWindow;s&&s[t]&&(n=s[t]),r.head.removeChild(i)}catch(i){Io&&xe.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,i)}return n&&(IT[t]=n.bind(ft))}function mK(t){IT[t]=void 0}const nm="__sentry_xhr_v3__";function Qne(t){const e="xhr";xf(e,t),Pf(e,oLe)}function oLe(){if(!ft.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,n,r){const i=_s()*1e3,s=mu(r[0])?r[0].toUpperCase():void 0,o=aLe(r[1]);if(!s||!o)return e.apply(n,r);n[nm]={method:s,url:o,request_headers:{}},s==="POST"&&o.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const a=()=>{const c=n[nm];if(c&&n.readyState===4){try{c.status_code=n.status}catch{}const l={endTimestamp:_s()*1e3,startTimestamp:i,xhr:n};ya("xhr",l)}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply(c,l,u){return a(),c.apply(l,u)}}):n.addEventListener("readystatechange",a),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(c,l,u){const[d,f]=u,p=l[nm];return p&&mu(d)&&mu(f)&&(p.request_headers[d.toLowerCase()]=f),c.apply(l,u)}}),e.apply(n,r)}}),t.send=new Proxy(t.send,{apply(e,n,r){const i=n[nm];if(!i)return e.apply(n,r);r[0]!==void 0&&(i.body=r[0]);const s={startTimestamp:_s()*1e3,xhr:n};return ya("xhr",s),e.apply(n,r)}})}function aLe(t){if(mu(t))return t;try{return t.toString()}catch{}}const CP=[],xT=new Map;function cLe(){if(wD()&&ro){const e=lLe();return()=>{e()}}return()=>{}}const vK={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function lLe(){return T5e(({metric:t})=>{if(t.value==null)return;const e=t.entries.find(m=>m.duration===t.value&&vK[m.name]);if(!e)return;const{interactionId:n}=e,r=vK[e.name],i=Er(ro+e.startTime),s=Er(t.value),o=ts(),a=o?Ai(o):void 0,l=(n!=null?xT.get(n):void 0)||a,u=l?Vt(l).description:Cn().getScopeData().transactionName,d=lp(e.target),f=Oi({[Or]:"auto.http.browser.inp",[Ou]:`ui.interaction.${r}`,[gD]:e.duration}),p=Zne({name:d,transaction:u,attributes:f,startTime:i});ru([p,"optionalAccess",m=>m.addEvent,"call",m=>m("inp",{[DR]:"millisecond",[NR]:t.value})]),ru([p,"optionalAccess",m=>m.end,"call",m=>m(i+s)])})}function uLe(t){const e=({entries:n})=>{const r=ts(),i=r&&Ai(r);n.forEach(s=>{if(!O5e(s)||!i)return;const o=s.interactionId;if(o!=null&&!xT.has(o)){if(CP.length>10){const a=CP.shift();xT.delete(a)}CP.push(o),xT.set(o,i)}})};P_("event",e),P_("first-input",e)}function dLe(t,e=sLe("fetch")){let n=0,r=0;function i(s){const o=s.body.length;n+=o,r++;const a={body:s.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};if(!e)return mK("fetch"),ck("No fetch implementation available");try{return e(t.url,a).then(c=>(n-=o,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return mK("fetch"),n-=o,r--,ck(c)}}return dAe(t,i)}const fLe=30,hLe=50;function u5(t,e,n,r){const i={filename:t,function:e==="<anonymous>"?up:e,in_app:!0};return n!==void 0&&(i.lineno=n),r!==void 0&&(i.colno=r),i}const pLe=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,gLe=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,mLe=/\((\S*)(?::(\d+))(?::(\d+))\)/,vLe=t=>{const e=pLe.exec(t);if(e){const[,r,i,s]=e;return u5(r,up,+i,+s)}const n=gLe.exec(t);if(n){if(n[2]&&n[2].indexOf("eval")===0){const o=mLe.exec(n[2]);o&&(n[2]=o[1],n[3]=o[2],n[4]=o[3])}const[i,s]=ere(n[1]||up,n[2]);return u5(s,i,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},yLe=[fLe,vLe],_Le=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,bLe=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,SLe=t=>{const e=_Le.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const s=bLe.exec(e[3]);s&&(e[1]=e[1]||"eval",e[3]=s[1],e[4]=s[2],e[5]="")}let r=e[3],i=e[1]||up;return[i,r]=ere(i,r),u5(r,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},wLe=[hLe,SLe],ELe=[yLe,wLe],TLe=tne(...ELe),ere=(t,e)=>{const n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:up,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},jw=1024,CLe="Breadcrumbs",kLe=(t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:CLe,setup(n){e.console&&i6e(PLe(n)),e.dom&&Q5e(xLe(n,e.dom)),e.xhr&&Qne(OLe(n)),e.fetch&&ine(MLe(n)),e.history&&ED(ALe(n)),e.sentry&&n.on("beforeSendEvent",ILe(n))}}},RLe=kLe;function ILe(t){return function(n){en()===t&&fp({category:`sentry.${n.type==="transaction"?"transaction":"event"}`,event_id:n.event_id,level:n.level,message:vd(n)},{event:n})}}function xLe(t,e){return function(r){if(en()!==t)return;let i,s,o=typeof e=="object"?e.serializeAttribute:void 0,a=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;a&&a>jw&&(eo&&xe.warn(`\`dom.maxStringLength\` cannot exceed ${jw}, but a value of ${a} was configured. Sentry will use ${jw} instead.`),a=jw),typeof o=="string"&&(o=[o]);try{const l=r.event,u=LLe(l)?l.target:l;i=lp(u,{keyAttrs:o,maxStringLength:a}),s=Yte(u)}catch{i="<unknown>"}if(i.length===0)return;const c={category:`ui.${r.name}`,message:i};s&&(c.data={"ui.component_name":s}),fp(c,{event:r.event,name:r.name,global:r.global})}}function PLe(t){return function(n){if(en()!==t)return;const r={category:"console",data:{arguments:n.args,logger:"console"},level:w6e(n.level),message:xH(n.args," ")};if(n.level==="assert")if(n.args[0]===!1)r.message=`Assertion failed: ${xH(n.args.slice(1)," ")||"console.assert"}`,r.data.arguments=n.args.slice(1);else return;fp(r,{input:n.args,level:n.level})}}function OLe(t){return function(n){if(en()!==t)return;const{startTimestamp:r,endTimestamp:i}=n,s=n.xhr[nm];if(!r||!i||!s)return;const{method:o,url:a,status_code:c,body:l}=s,u={method:o,url:a,status_code:c},d={xhr:n.xhr,input:l,startTimestamp:r,endTimestamp:i},f=Wte(c);fp({category:"xhr",data:u,type:"http",level:f},d)}}function MLe(t){return function(n){if(en()!==t)return;const{startTimestamp:r,endTimestamp:i}=n;if(i&&!(n.fetchData.url.match(/sentry_key/)&&n.fetchData.method==="POST"))if(n.error){const s=n.fetchData,o={data:n.error,input:n.args,startTimestamp:r,endTimestamp:i};fp({category:"fetch",data:s,level:"error",type:"http"},o)}else{const s=n.response,o={...n.fetchData,status_code:s&&s.status},a={input:n.args,response:s,startTimestamp:r,endTimestamp:i},c=Wte(o.status_code);fp({category:"fetch",data:o,type:"http",level:c},a)}}}function ALe(t){return function(n){if(en()!==t)return;let r=n.from,i=n.to;const s=Fh(it.location.href);let o=r?Fh(r):void 0;const a=Fh(i);(!o||!o.path)&&(o=s),s.protocol===a.protocol&&s.host===a.host&&(i=a.relative),s.protocol===o.protocol&&s.host===o.host&&(r=o.relative),fp({category:"navigation",data:{from:r,to:i}})}}function LLe(t){return!!t&&!!t.target}const DLe=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],NLe="BrowserApiErrors",ULe=(t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:NLe,setupOnce(){e.setTimeout&&To(it,"setTimeout",yK),e.setInterval&&To(it,"setInterval",yK),e.requestAnimationFrame&&To(it,"requestAnimationFrame",FLe),e.XMLHttpRequest&&"XMLHttpRequest"in it&&To(XMLHttpRequest.prototype,"send",BLe);const n=e.eventTarget;n&&(Array.isArray(n)?n:DLe).forEach(jLe)}}},$Le=ULe;function yK(t){return function(...e){const n=e[0];return e[0]=vv(n,{mechanism:{data:{function:Pu(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function FLe(t){return function(e){return t.apply(this,[vv(e,{mechanism:{data:{function:"requestAnimationFrame",handler:Pu(t)},handled:!1,type:"instrument"}})])}}function BLe(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in n&&typeof n[i]=="function"&&To(n,i,function(s){const o={mechanism:{data:{function:i,handler:Pu(s)},handled:!1,type:"instrument"}},a=dD(s);return a&&(o.mechanism.data.handler=Pu(a)),vv(s,o)})}),t.apply(this,e)}}function jLe(t){const e=it,n=e[t]&&e[t].prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||(To(n,"addEventListener",function(r){return function(i,s,o){try{typeof s.handleEvent=="function"&&(s.handleEvent=vv(s.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Pu(s),target:t},handled:!1,type:"instrument"}}))}catch{}return r.apply(this,[i,vv(s,{mechanism:{data:{function:"addEventListener",handler:Pu(s),target:t},handled:!1,type:"instrument"}}),o])}}),To(n,"removeEventListener",function(r){return function(i,s,o){const a=s;try{const c=a&&a.__sentry_wrapped__;c&&r.call(this,i,c,o)}catch{}return r.call(this,i,a,o)}}))}const HLe="GlobalHandlers",KLe=(t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:HLe,setupOnce(){Error.stackTraceLimit=50},setup(n){e.onerror&&(qLe(n),_K("onerror")),e.onunhandledrejection&&(GLe(n),_K("onunhandledrejection"))}}},VLe=KLe;function qLe(t){one(e=>{const{stackParser:n,attachStacktrace:r}=tre();if(en()!==t||jne())return;const{msg:i,url:s,line:o,column:a,error:c}=e,l=YLe(bD(n,c||i,void 0,r,!1),s,o,a);l.level="error",One(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function GLe(t){ane(e=>{const{stackParser:n,attachStacktrace:r}=tre();if(en()!==t||jne())return;const i=zLe(e),s=uD(i)?WLe(i):bD(n,i,void 0,r,!0);s.level="error",One(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function zLe(t){if(uD(t))return t;try{if("reason"in t)return t.reason;if("detail"in t&&"reason"in t.detail)return t.detail.reason}catch{}return t}function WLe(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}function YLe(t,e,n,r){const i=t.exception=t.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],l=isNaN(parseInt(r,10))?void 0:r,u=isNaN(parseInt(n,10))?void 0:n,d=mu(e)&&e.length>0?e:qOe();return c.length===0&&c.push({colno:l,filename:d,function:up,in_app:!0,lineno:u}),t}function _K(t){eo&&xe.log(`Global Handler attached: ${t}`)}function tre(){const t=en();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const JLe=()=>({name:"HttpContext",preprocessEvent(t){if(!it.navigator&&!it.location&&!it.document)return;const e=t.request&&t.request.url||it.location&&it.location.href,{referrer:n}=it.document||{},{userAgent:r}=it.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}),XLe="cause",ZLe=5,QLe="LinkedErrors",e4e=(t={})=>{const e=t.limit||ZLe,n=t.key||XLe;return{name:QLe,preprocessEvent(r,i,s){const o=s.getOptions();jOe(yD,o.stackParser,o.maxValueLength,n,e,r,i)}}},t4e=e4e;function n4e(t){return[_Ae(),gAe(),$Le(),RLe(),VLe(),t4e(),MAe(),JLe()]}function r4e(t={}){const e={defaultIntegrations:n4e(),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:it.SENTRY_RELEASE&&it.SENTRY_RELEASE.id?it.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return t.defaultIntegrations==null&&delete t.defaultIntegrations,{...e,...t}}function i4e(){const t=typeof it.window<"u"&&it;if(!t)return!1;const e=t.chrome?"chrome":"browser",n=t[e],r=n&&n.runtime&&n.runtime.id,i=it.location&&it.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],o=!!r&&it===it.top&&s.some(c=>i.startsWith(`${c}//`)),a=typeof t.nw<"u";return!!r&&!o&&!a}function s4e(t={}){const e=r4e(t);if(i4e()){xb(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}eo&&(nne()||xe.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...e,stackParser:n6e(e.stackParser||TLe),integrations:rAe(e),transport:e.transport||dLe},r=cAe(QAe,n);return e.autoSessionTracking&&o4e(),r}function bK(t={}){if(!it.document){eo&&xe.error("Global document not defined in showReportDialog call");return}const e=Cn(),n=e.getClient(),r=n&&n.getDsn();if(!r){eo&&xe.error("DSN not configured for showReportDialog call");return}if(e&&(t.user={...e.getUser(),...t.user}),!t.eventId){const a=JMe();a&&(t.eventId=a)}const i=it.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=tAe(r,t),t.onLoad&&(i.onload=t.onLoad);const{onClose:s}=t;if(s){const a=c=>{if(c.data==="__sentry_reportdialog_closed__")try{s()}finally{it.removeEventListener("message",a)}};it.addEventListener("message",a)}const o=it.document.head||it.document.body;o?o.appendChild(i):eo&&xe.error("Not injecting report dialog. No injection point found in HTML")}function o4e(){if(typeof it.document>"u"){eo&&xe.warn("Session tracking in non-browser environment with @sentry/browser is not supported.");return}tK({ignoreDuration:!0}),nK(),ED(({from:t,to:e})=>{t!==void 0&&t!==e&&(tK({ignoreDuration:!0}),nK())})}const SK=new WeakMap,kP=new Map,d5={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0};function a4e(t,e){const{traceFetch:n,traceXHR:r,shouldCreateSpanForRequest:i,enableHTTPTimings:s,tracePropagationTargets:o}={traceFetch:d5.traceFetch,traceXHR:d5.traceXHR,...e},a=typeof i=="function"?i:u=>!0,c=u=>d4e(u,o),l={};n&&(t.addEventProcessor(u=>(u.type==="transaction"&&u.spans&&u.spans.forEach(d=>{if(d.op==="http.client"){const f=kP.get(d.span_id);f&&(d.timestamp=f/1e3,kP.delete(d.span_id))}}),u)),c6e(u=>{if(u.response){const d=SK.get(u.response);d&&u.endTimestamp&&kP.set(d,u.endTimestamp)}}),ine(u=>{const d=NAe(u,a,c,l);if(u.response&&u.fetchData.__span&&SK.set(u.response,u.fetchData.__span),d){const f=nre(u.fetchData.url),p=f?Fh(f).host:void 0;d.setAttributes({"http.url":f,"server.address":p})}s&&d&&wK(d)})),r&&Qne(u=>{const d=f4e(u,a,c,l);s&&d&&wK(d)})}function c4e(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function wK(t){const{url:e}=Vt(t).data||{};if(!e||typeof e!="string")return;const n=P_("resource",({entries:r})=>{r.forEach(i=>{c4e(i)&&i.name.endsWith(e)&&(u4e(i).forEach(o=>t.setAttribute(...o)),setTimeout(n))})})}function l4e(t){let e="unknown",n="unknown",r="";for(const i of t){if(i==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=i}return r===t&&(e=r),{name:e,version:n}}function kc(t=0){return((ro||performance.timeOrigin)+t)/1e3}function u4e(t){const{name:e,version:n}=l4e(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),ro?[...r,["http.request.redirect_start",kc(t.redirectStart)],["http.request.fetch_start",kc(t.fetchStart)],["http.request.domain_lookup_start",kc(t.domainLookupStart)],["http.request.domain_lookup_end",kc(t.domainLookupEnd)],["http.request.connect_start",kc(t.connectStart)],["http.request.secure_connection_start",kc(t.secureConnectionStart)],["http.request.connection_end",kc(t.connectEnd)],["http.request.request_start",kc(t.requestStart)],["http.request.response_start",kc(t.responseStart)],["http.request.response_end",kc(t.responseEnd)]]:r}function d4e(t,e){const n=it.location&&it.location.href;if(n){let r,i;try{r=new URL(t,n),i=new URL(n).origin}catch{return!1}const s=r.origin===i;return e?Uh(r.toString(),e)||s&&Uh(r.pathname,e):s}else{const r=!!t.match(/^\/(?!\/)/);return e?Uh(t,e):r}}function f4e(t,e,n,r){const i=t.xhr,s=i&&i[nm];if(!i||i.__sentry_own_request__||!s)return;const o=Mu()&&e(s.url);if(t.endTimestamp&&o){const f=i.__sentry_xhr_span_id__;if(!f)return;const p=r[f];p&&s.status_code!==void 0&&(vne(p,s.status_code),p.end(),delete r[f]);return}const a=nre(s.url),c=a?Fh(a).host:void 0,l=!!ts(),u=o&&l?Of({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":a,url:s.url,"server.address":c,[Or]:"auto.http.browser",[Ou]:"http.client"}}):new Qv;i.__sentry_xhr_span_id__=u.spanContext().spanId,r[i.__sentry_xhr_span_id__]=u;const d=en();return i.setRequestHeader&&n(s.url)&&d&&h4e(i,d,Mu()&&l?u:void 0),u}function h4e(t,e,n){const r=Cn(),i=mc(),{traceId:s,spanId:o,sampled:a,dsc:c}={...i.getPropagationContext(),...r.getPropagationContext()},l=n&&Mu()?bne(n):fD(s,o,a),u=hne(c||(n?Ap(n):UR(s,e)));p4e(t,l,u)}function p4e(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader(JA,n)}catch{}}function nre(t){try{return new URL(t,it.location.origin).href}catch{return}}function g4e(){it&&it.document?it.document.addEventListener("visibilitychange",()=>{const t=ts();if(!t)return;const e=Ai(t);if(it.document.hidden&&e){const n="cancelled",{op:r,status:i}=Vt(e);eo&&xe.log(`[Tracing] Transaction: ${n} -> since tab moved to the background, op: ${r}`),i||e.setStatus({code:Xr,message:n}),e.setAttribute("sentry.cancellation_reason","document.hidden"),e.end()}}):eo&&xe.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const m4e="BrowserTracing",v4e={...RT,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...d5},y4e=(t={})=>{uMe();const{enableInp:e,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:s},beforeStartSpan:o,idleTimeout:a,finalTimeout:c,childSpanTimeout:l,markBackgroundSpan:u,traceFetch:d,traceXHR:f,shouldCreateSpanForRequest:p,enableHTTPTimings:m,instrumentPageLoad:v,instrumentNavigation:S}={...v4e,...t},_=N5e({recordClsStandaloneSpans:s||!1});e&&cLe(),r&&Gt.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?$5e():n&&U5e(),i&&F5e();const w={name:void 0,source:void 0};function T(C,I){const R=I.op==="pageload",O=o?o(I):I,A=O.attributes||{};I.name!==O.name&&(A[ic]="custom",O.attributes=A),w.name=O.name,w.source=A[ic];const U=Pne(O,{idleTimeout:a,finalTimeout:c,childSpanTimeout:l,disableAutoFinish:R,beforeSpanEnd:L=>{_(),V5e(L,{recordClsOnPageloadSpan:!s})}});function N(){["interactive","complete"].includes(it.document.readyState)&&C.emit("idleSpanEnableAutoFinish",U)}return R&&it.document&&(it.document.addEventListener("readystatechange",()=>{N()}),N()),U}return{name:m4e,afterAllSetup(C){let I,R=it.location&&it.location.href;C.on("startNavigationSpan",O=>{en()===C&&(I&&!Vt(I).timestamp&&(eo&&xe.log(`[Tracing] Finishing current root span with op: ${Vt(I).op}`),I.end()),I=T(C,{op:"navigation",...O}))}),C.on("startPageLoadSpan",(O,A={})=>{if(en()!==C)return;I&&!Vt(I).timestamp&&(eo&&xe.log(`[Tracing] Finishing current root span with op: ${Vt(I).op}`),I.end());const U=A.sentryTrace||EK("sentry-trace"),N=A.baggage||EK("baggage"),L=x6e(U,N);Cn().setPropagationContext(L),I=T(C,{op:"pageload",...O})}),C.on("spanEnd",O=>{const A=Vt(O).op;if(O!==Ai(O)||A!=="navigation"&&A!=="pageload")return;const U=Cn(),N=U.getPropagationContext();U.setPropagationContext({...N,sampled:N.sampled!==void 0?N.sampled:Mp(O),dsc:N.dsc||Ap(O)})}),it.location&&(v&&rre(C,{name:it.location.pathname,startTime:ro?ro/1e3:void 0,attributes:{[ic]:"url",[Or]:"auto.pageload.browser"}}),S&&ED(({to:O,from:A})=>{if(A===void 0&&R&&R.indexOf(O)!==-1){R=void 0;return}A!==O&&(R=void 0,ire(C,{name:it.location.pathname,attributes:{[ic]:"url",[Or]:"auto.navigation.browser"}}))})),u&&g4e(),i&&_4e(a,c,l,w),e&&uLe(),a4e(C,{traceFetch:d,traceXHR:f,tracePropagationTargets:C.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:p,enableHTTPTimings:m})}}};function rre(t,e,n){t.emit("startPageLoadSpan",e,n),Cn().setTransactionName(e.name);const r=ts();return(r&&Vt(r).op)==="pageload"?r:void 0}function ire(t,e){mc().setPropagationContext(lk()),Cn().setPropagationContext(lk()),t.emit("startNavigationSpan",e),Cn().setTransactionName(e.name);const n=ts();return(n&&Vt(n).op)==="navigation"?n:void 0}function EK(t){const e=GOe(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}function _4e(t,e,n,r){let i;const s=()=>{const o="ui.action.click",a=ts(),c=a&&Ai(a);if(c){const l=Vt(c).op;if(["navigation","pageload"].includes(l)){eo&&xe.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`);return}}if(i&&(i.setAttribute(e5,"interactionInterrupted"),i.end(),i=void 0),!r.name){eo&&xe.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}i=Pne({name:r.name,op:o,attributes:{[ic]:r.source||"url"}},{idleTimeout:t,finalTimeout:e,childSpanTimeout:n})};it.document&&addEventListener("click",s,{once:!1,capture:!0})}function b4e(t){const e={...t};return $ne(e,"react"),YMe("react",{version:y.version}),s4e(e)}function S4e(t){const e=t.match(/^([^.]+)/);return e!==null&&parseInt(e[0])>=17}function w4e(t,e){const n=new WeakSet;function r(i,s){if(!n.has(i)){if(i.cause)return n.add(i),r(i.cause,s);i.cause=s}}r(t,e)}function E4e(t,{componentStack:e},n){if(S4e(y.version)&&PR(t)&&e){const r=new Error(t.message);r.name=`React ErrorBoundary ${t.name}`,r.stack=e,w4e(t,r)}return $R(t,{...n,captureContext:{contexts:{react:{componentStack:e}}}})}const T4e=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,TK={componentStack:null,error:null,eventId:null};class TD extends y.Component{constructor(e){super(e),TD.prototype.__init.call(this),this.state=TK,this._openFallbackReportDialog=!0;const n=en();n&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=n.on("afterSendEvent",r=>{!r.type&&this._lastEventId&&r.event_id===this._lastEventId&&bK({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,n){const{componentStack:r}=n,i=r??void 0,{beforeCapture:s,onError:o,showDialog:a,dialogOptions:c}=this.props;LR(l=>{s&&s(l,e,i);const u=E4e(e,n,{mechanism:{handled:!!this.props.fallback}});o&&o(e,i,u),a&&(this._lastEventId=u,this._openFallbackReportDialog&&bK({...c,eventId:u})),this.setState({error:e,componentStack:r,eventId:u})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:n,eventId:r}=this.state,{onUnmount:i}=this.props;i&&i(e,n,r),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:n,componentStack:r,eventId:i}=this.state;e&&e(n,r,i),this.setState(TK)}}render(){const{fallback:e,children:n}=this.props,r=this.state;if(r.error){let i;return typeof e=="function"?i=y.createElement(e,{error:r.error,componentStack:r.componentStack,resetError:this.resetErrorBoundary,eventId:r.eventId}):i=e,y.isValidElement(i)?i:(e&&T4e&&xe.warn("fallback did not produce a valid ReactElement"),null)}return typeof n=="function"?n():n}}function C4e(t){const e=y4e({...t,instrumentPageLoad:!1,instrumentNavigation:!1}),{history:n,routes:r,matchPath:i,instrumentPageLoad:s=!0,instrumentNavigation:o=!0}=t;return{...e,afterAllSetup(a){e.afterAllSetup(a),k4e(a,s,o,n,"reactrouter_v5",r,i)}}}function k4e(t,e,n,r,i,s=[],o){function a(){if(r&&r.location)return r.location.pathname;if(it&&it.location)return it.location.pathname}function c(l){if(s.length===0||!o)return[l,"url"];const u=sre(s,l,o);for(const d of u)if(d.match.isExact)return[d.match.path,"route"];return[l,"url"]}if(e){const l=a();if(l){const[u,d]=c(l);rre(t,{name:u,attributes:{[Ou]:"pageload",[Or]:`auto.pageload.react.${i}`,[ic]:d}})}}n&&r.listen&&r.listen((l,u)=>{if(u&&(u==="PUSH"||u==="POP")){const[d,f]=c(l.pathname);ire(t,{name:d,attributes:{[Ou]:"navigation",[Or]:`auto.navigation.react.${i}`,[ic]:f}})}})}function sre(t,e,n,r=[]){return t.some(i=>{const s=i.path?n(e,i):r.length?r[r.length-1].match:R4e(e);return s&&(r.push({route:i,match:s}),i.routes&&sre(i.routes,e,n,r)),!!s}),r}function R4e(t){return{path:"/",url:"/",params:{},isExact:t==="/"}}function I4e(t){const e=t.displayName||t.name,n=r=>{if(r&&r.computedMatch&&r.computedMatch.isExact){const i=r.computedMatch.path,s=x4e();Cn().setTransactionName(i),s&&(s.updateName(i),s.setAttribute(ic,"route"))}return y.createElement(t,{...r})};return n.displayName=`sentryRoute(${e})`,yOe(n,t),n}function x4e(){const t=ts(),e=t&&Ai(t);if(!e)return;const n=Vt(e).op;return n==="navigation"||n==="pageload"?e:void 0}var ore={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(ore);var P4e=ore.exports;const Pe=es(P4e);function are(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 17a.97.97 0 0 0 .713-.288A.968.968 0 0 0 13 16a.968.968 0 0 0-.287-.713A.968.968 0 0 0 12 15a.968.968 0 0 0-.713.287A.968.968 0 0 0 11 16c0 .283.096.52.287.712.192.192.43.288.713.288Zm0-4c.283 0 .52-.096.713-.287A.968.968 0 0 0 13 12V8a.967.967 0 0 0-.287-.713A.968.968 0 0 0 12 7a.968.968 0 0 0-.713.287A.967.967 0 0 0 11 8v4c0 .283.096.52.287.713.192.191.43.287.713.287Zm0 9a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Z"})})}are.displayName="ErrorIcon";const CD=y.forwardRef(are);function cre(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414Z"})})}cre.displayName="CloseIcon";const kD=y.forwardRef(cre);function BR(){return typeof window<"u"}function ry(t){return lre(t)?(t.nodeName||"").toLowerCase():"#document"}function to(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function vl(t){var e;return(e=(lre(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function lre(t){return BR()?t instanceof Node||t instanceof to(t).Node:!1}function Pn(t){return BR()?t instanceof Element||t instanceof to(t).Element:!1}function Oo(t){return BR()?t instanceof HTMLElement||t instanceof to(t).HTMLElement:!1}function f5(t){return!BR()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof to(t).ShadowRoot}function Ub(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Mo(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function O4e(t){return["table","td","th"].includes(ry(t))}function jR(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function RD(t){const e=ID(),n=Pn(t)?Mo(t):t;return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function M4e(t){let e=Au(t);for(;Oo(e)&&!pf(e);){if(RD(e))return e;if(jR(e))return null;e=Au(e)}return null}function ID(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function pf(t){return["html","body","#document"].includes(ry(t))}function Mo(t){return to(t).getComputedStyle(t)}function HR(t){return Pn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Au(t){if(ry(t)==="html")return t;const e=t.assignedSlot||t.parentNode||f5(t)&&t.host||vl(t);return f5(e)?e.host:e}function ure(t){const e=Au(t);return pf(e)?t.ownerDocument?t.ownerDocument.body:t.body:Oo(e)&&Ub(e)?e:ure(e)}function Xd(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=ure(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=to(i);if(s){const a=h5(o);return e.concat(o,o.visualViewport||[],Ub(i)?i:[],a&&n?Xd(a):[])}return e.concat(i,Xd(i,[],n))}function h5(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function p5(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function _v(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&f5(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function dre(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function fre(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function A4e(t){return D4e()?!1:!CK()&&t.width===0&&t.height===0||CK()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function hre(){return/apple/i.test(navigator.vendor)}function CK(){const t=/android/i;return t.test(dre())||t.test(fre())}function L4e(){return dre().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function D4e(){return fre().includes("jsdom/")}function g5(t,e){const n=["mouse","pen"];return n.push("",void 0),n.includes(t)}function N4e(t){return"nativeEvent"in t}function U4e(t){return t.matches("html,body")}function Ad(t){return(t==null?void 0:t.ownerDocument)||document}function RP(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function Ng(t){return"composedPath"in t?t.composedPath()[0]:t.target}const $4e="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function F4e(t){return Oo(t)&&t.matches($4e)}const B4e=["top","right","bottom","left"],gf=Math.min,So=Math.max,pk=Math.round,Hw=Math.floor,mf=t=>({x:t,y:t}),j4e={left:"right",right:"left",bottom:"top",top:"bottom"},H4e={start:"end",end:"start"};function m5(t,e,n){return So(t,gf(e,n))}function Lu(t,e){return typeof t=="function"?t(e):t}function Du(t){return t.split("-")[0]}function iy(t){return t.split("-")[1]}function xD(t){return t==="x"?"y":"x"}function PD(t){return t==="y"?"height":"width"}function vf(t){return["top","bottom"].includes(Du(t))?"y":"x"}function OD(t){return xD(vf(t))}function K4e(t,e,n){n===void 0&&(n=!1);const r=iy(t),i=OD(t),s=PD(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=gk(o)),[o,gk(o)]}function V4e(t){const e=gk(t);return[v5(t),e,v5(e)]}function v5(t){return t.replace(/start|end/g,e=>H4e[e])}function q4e(t,e,n){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function G4e(t,e,n,r){const i=iy(t);let s=q4e(Du(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(v5)))),s}function gk(t){return t.replace(/left|right|bottom|top/g,e=>j4e[e])}function z4e(t){return{top:0,right:0,bottom:0,left:0,...t}}function pre(t){return typeof t!="number"?z4e(t):{top:t,right:t,bottom:t,left:t}}function mk(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var W4e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],y5=W4e.join(","),gre=typeof Element>"u",O_=gre?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,vk=!gre&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},yk=function t(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&t(e.parentNode);return o},Y4e=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},J4e=function(e,n,r){if(yk(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(y5));return n&&O_.call(e,y5)&&i.unshift(e),i=i.filter(r),i},X4e=function t(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!yk(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),c=a.length?a:o.children,l=t(c,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:o,candidates:l})}else{var u=O_.call(o,y5);u&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!yk(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var p=t(d===!0?o.children:d.children,!0,r);r.flatten?i.push.apply(i,p):i.push({scopeParent:o,candidates:p})}else s.unshift.apply(s,o.children)}}return i},mre=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},vre=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||Y4e(e))&&!mre(e)?0:e.tabIndex},Z4e=function(e,n){var r=vre(e);return r<0&&n&&!mre(e)?0:r},Q4e=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},yre=function(e){return e.tagName==="INPUT"},e8e=function(e){return yre(e)&&e.type==="hidden"},t8e=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},n8e=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},r8e=function(e){if(!e.name)return!0;var n=e.form||vk(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=n8e(i,e.form);return!s||s===e},i8e=function(e){return yre(e)&&e.type==="radio"},s8e=function(e){return i8e(e)&&!r8e(e)},o8e=function(e){var n,r=e&&vk(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,c;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(c=e.ownerDocument)!==null&&c!==void 0&&c.contains(e));!s&&i;){var l,u,d;r=vk(i),i=(l=r)===null||l===void 0?void 0:l.host,s=!!((u=i)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(i))}}return s},kK=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},a8e=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=O_.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(O_.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var c=e.parentElement,l=vk(e);if(c&&!c.shadowRoot&&i(c)===!0)return kK(e);e.assignedSlot?e=e.assignedSlot:!c&&l!==e.ownerDocument?e=l.host:e=c}e=a}if(o8e(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return kK(e);return!1},c8e=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return O_.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},l8e=function(e,n){return!(n.disabled||yk(n)||e8e(n)||a8e(n,e)||t8e(n)||c8e(n))},RK=function(e,n){return!(s8e(n)||vre(n)<0||!l8e(e,n))},u8e=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},d8e=function t(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,c=Z4e(a,o),l=o?t(i.candidates):a;c===0?o?n.push.apply(n,l):n.push(a):r.push({documentOrder:s,tabIndex:c,item:i,isScope:o,content:l})}),r.sort(Q4e).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},_re=function(e,n){n=n||{};var r;return n.getShadowRoot?r=X4e([e],n.includeContainer,{filter:RK.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:u8e}):r=J4e(e,n.includeContainer,RK.bind(null,n)),d8e(r)};function IK(t,e,n){let{reference:r,floating:i}=t;const s=vf(e),o=OD(e),a=PD(o),c=Du(e),l=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[a]/2-i[a]/2;let p;switch(c){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(iy(e)){case"start":p[o]-=f*(n&&l?-1:1);break;case"end":p[o]+=f*(n&&l?-1:1);break}return p}const f8e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:d}=IK(l,r,c),f=r,p={},m=0;for(let v=0;v<a.length;v++){const{name:S,fn:_}=a[v],{x:w,y:T,data:C,reset:I}=await _({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:p,rects:l,platform:o,elements:{reference:t,floating:e}});u=w??u,d=T??d,p={...p,[S]:{...p[S],...C}},I&&m<=50&&(m++,typeof I=="object"&&(I.placement&&(f=I.placement),I.rects&&(l=I.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):I.rects),{x:u,y:d}=IK(l,f,c)),v=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:p}};async function M_(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Lu(e,t),m=pre(p),S=a[f?d==="floating"?"reference":"floating":d],_=mk(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(S)))==null||n?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),w=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,T=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),C=await(s.isElement==null?void 0:s.isElement(T))?await(s.getScale==null?void 0:s.getScale(T))||{x:1,y:1}:{x:1,y:1},I=mk(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:T,strategy:c}):w);return{top:(_.top-I.top+m.top)/C.y,bottom:(I.bottom-_.bottom+m.bottom)/C.y,left:(_.left-I.left+m.left)/C.x,right:(I.right-_.right+m.right)/C.x}}const h8e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:l,padding:u=0}=Lu(t,e)||{};if(l==null)return{};const d=pre(u),f={x:n,y:r},p=OD(i),m=PD(p),v=await o.getDimensions(l),S=p==="y",_=S?"top":"left",w=S?"bottom":"right",T=S?"clientHeight":"clientWidth",C=s.reference[m]+s.reference[p]-f[p]-s.floating[m],I=f[p]-s.reference[p],R=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l));let O=R?R[T]:0;(!O||!await(o.isElement==null?void 0:o.isElement(R)))&&(O=a.floating[T]||s.floating[m]);const A=C/2-I/2,U=O/2-v[m]/2-1,N=gf(d[_],U),L=gf(d[w],U),j=N,X=O-v[m]-L,G=O/2-v[m]/2+A,F=m5(j,G,X),V=!c.arrow&&iy(i)!=null&&G!==F&&s.reference[m]/2-(G<j?N:L)-v[m]/2<0,J=V?G<j?G-j:G-X:0;return{[p]:f[p]+J,data:{[p]:F,centerOffset:G-F-J,...V&&{alignmentOffset:J}},reset:V}}}),p8e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:v=!0,...S}=Lu(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const _=Du(i),w=vf(a),T=Du(a)===a,C=await(c.isRTL==null?void 0:c.isRTL(l.floating)),I=f||(T||!v?[gk(a)]:V4e(a)),R=m!=="none";!f&&R&&I.push(...G4e(a,v,m,C));const O=[a,...I],A=await M_(e,S),U=[];let N=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&U.push(A[_]),d){const G=K4e(i,o,C);U.push(A[G[0]],A[G[1]])}if(N=[...N,{placement:i,overflows:U}],!U.every(G=>G<=0)){var L,j;const G=(((L=s.flip)==null?void 0:L.index)||0)+1,F=O[G];if(F)return{data:{index:G,overflows:N},reset:{placement:F}};let V=(j=N.filter(J=>J.overflows[0]<=0).sort((J,K)=>J.overflows[1]-K.overflows[1])[0])==null?void 0:j.placement;if(!V)switch(p){case"bestFit":{var X;const J=(X=N.filter(K=>{if(R){const W=vf(K.placement);return W===w||W==="y"}return!0}).map(K=>[K.placement,K.overflows.filter(W=>W>0).reduce((W,Y)=>W+Y,0)]).sort((K,W)=>K[1]-W[1])[0])==null?void 0:X[0];J&&(V=J);break}case"initialPlacement":V=a;break}if(i!==V)return{reset:{placement:V}}}return{}}}};function xK(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function PK(t){return B4e.some(e=>t[e]>=0)}const g8e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=Lu(t,e);switch(r){case"referenceHidden":{const s=await M_(e,{...i,elementContext:"reference"}),o=xK(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:PK(o)}}}case"escaped":{const s=await M_(e,{...i,altBoundary:!0}),o=xK(s,n.floating);return{data:{escapedOffsets:o,escaped:PK(o)}}}default:return{}}}}};async function m8e(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=Du(n),a=iy(n),c=vf(n)==="y",l=["left","top"].includes(o)?-1:1,u=s&&c?-1:1,d=Lu(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:m}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof m=="number"&&(p=a==="end"?m*-1:m),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}const v8e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,c=await m8e(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:s+c.y,data:{...c,placement:o}}}}},y8e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:_,y:w}=S;return{x:_,y:w}}},...c}=Lu(t,e),l={x:n,y:r},u=await M_(e,c),d=vf(Du(i)),f=xD(d);let p=l[f],m=l[d];if(s){const S=f==="y"?"top":"left",_=f==="y"?"bottom":"right",w=p+u[S],T=p-u[_];p=m5(w,p,T)}if(o){const S=d==="y"?"top":"left",_=d==="y"?"bottom":"right",w=m+u[S],T=m-u[_];m=m5(w,m,T)}const v=a.fn({...e,[f]:p,[d]:m});return{...v,data:{x:v.x-n,y:v.y-r,enabled:{[f]:s,[d]:o}}}}}},_8e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=Lu(t,e),u={x:n,y:r},d=vf(i),f=xD(d);let p=u[f],m=u[d];const v=Lu(a,e),S=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(c){const T=f==="y"?"height":"width",C=s.reference[f]-s.floating[T]+S.mainAxis,I=s.reference[f]+s.reference[T]-S.mainAxis;p<C?p=C:p>I&&(p=I)}if(l){var _,w;const T=f==="y"?"width":"height",C=["top","left"].includes(Du(i)),I=s.reference[d]-s.floating[T]+(C&&((_=o.offset)==null?void 0:_[d])||0)+(C?0:S.crossAxis),R=s.reference[d]+s.reference[T]+(C?0:((w=o.offset)==null?void 0:w[d])||0)-(C?S.crossAxis:0);m<I?m=I:m>R&&(m=R)}return{[f]:p,[d]:m}}}},b8e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...l}=Lu(t,e),u=await M_(e,l),d=Du(i),f=iy(i),p=vf(i)==="y",{width:m,height:v}=s.floating;let S,_;d==="top"||d==="bottom"?(S=d,_=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(_=d,S=f==="end"?"top":"bottom");const w=v-u.top-u.bottom,T=m-u.left-u.right,C=gf(v-u[S],w),I=gf(m-u[_],T),R=!e.middlewareData.shift;let O=C,A=I;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(A=T),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(O=w),R&&!f){const N=So(u.left,0),L=So(u.right,0),j=So(u.top,0),X=So(u.bottom,0);p?A=m-2*(N!==0||L!==0?N+L:So(u.left,u.right)):O=v-2*(j!==0||X!==0?j+X:So(u.top,u.bottom))}await c({...e,availableWidth:A,availableHeight:O});const U=await o.getDimensions(a.floating);return m!==U.width||v!==U.height?{reset:{rects:!0}}:{}}}};function bre(t){const e=Mo(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Oo(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=pk(n)!==s||pk(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function MD(t){return Pn(t)?t:t.contextElement}function Am(t){const e=MD(t);if(!Oo(e))return mf(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=bre(e);let o=(s?pk(n.width):n.width)/r,a=(s?pk(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const S8e=mf(0);function Sre(t){const e=to(t);return!ID()||!e.visualViewport?S8e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function w8e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==to(t)?!1:e}function hp(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=MD(t);let o=mf(1);e&&(r?Pn(r)&&(o=Am(r)):o=Am(t));const a=w8e(s,n,r)?Sre(s):mf(0);let c=(i.left+a.x)/o.x,l=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const f=to(s),p=r&&Pn(r)?to(r):r;let m=f,v=h5(m);for(;v&&r&&p!==m;){const S=Am(v),_=v.getBoundingClientRect(),w=Mo(v),T=_.left+(v.clientLeft+parseFloat(w.paddingLeft))*S.x,C=_.top+(v.clientTop+parseFloat(w.paddingTop))*S.y;c*=S.x,l*=S.y,u*=S.x,d*=S.y,c+=T,l+=C,m=to(v),v=h5(m)}}return mk({width:u,height:d,x:c,y:l})}function E8e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=vl(r),a=e?jR(e.floating):!1;if(r===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=mf(1);const u=mf(0),d=Oo(r);if((d||!d&&!s)&&((ry(r)!=="body"||Ub(o))&&(c=HR(r)),Oo(r))){const f=hp(r);l=Am(r),u.x=f.x+r.clientLeft,u.y=f.y+r.clientTop}return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x,y:n.y*l.y-c.scrollTop*l.y+u.y}}function T8e(t){return Array.from(t.getClientRects())}function _5(t,e){const n=HR(t).scrollLeft;return e?e.left+n:hp(vl(t)).left+n}function C8e(t){const e=vl(t),n=HR(t),r=t.ownerDocument.body,i=So(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=So(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+_5(t);const a=-n.scrollTop;return Mo(r).direction==="rtl"&&(o+=So(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function k8e(t,e){const n=to(t),r=vl(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;const l=ID();(!l||l&&e==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a,y:c}}function R8e(t,e){const n=hp(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Oo(t)?Am(t):mf(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=i*s.x,l=r*s.y;return{width:o,height:a,x:c,y:l}}function OK(t,e,n){let r;if(e==="viewport")r=k8e(t,n);else if(e==="document")r=C8e(vl(t));else if(Pn(e))r=R8e(e,n);else{const i=Sre(t);r={...e,x:e.x-i.x,y:e.y-i.y}}return mk(r)}function wre(t,e){const n=Au(t);return n===e||!Pn(n)||pf(n)?!1:Mo(n).position==="fixed"||wre(n,e)}function I8e(t,e){const n=e.get(t);if(n)return n;let r=Xd(t,[],!1).filter(a=>Pn(a)&&ry(a)!=="body"),i=null;const s=Mo(t).position==="fixed";let o=s?Au(t):t;for(;Pn(o)&&!pf(o);){const a=Mo(o),c=RD(o);!c&&a.position==="fixed"&&(i=null),(s?!c&&!i:!c&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Ub(o)&&!c&&wre(t,o))?r=r.filter(u=>u!==o):i=a,o=Au(o)}return e.set(t,r),r}function x8e(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?jR(e)?[]:I8e(e,this._c):[].concat(n),r],a=o[0],c=o.reduce((l,u)=>{const d=OK(e,u,i);return l.top=So(d.top,l.top),l.right=gf(d.right,l.right),l.bottom=gf(d.bottom,l.bottom),l.left=So(d.left,l.left),l},OK(e,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function P8e(t){const{width:e,height:n}=bre(t);return{width:e,height:n}}function O8e(t,e,n){const r=Oo(e),i=vl(e),s=n==="fixed",o=hp(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=mf(0);if(r||!r&&!s)if((ry(e)!=="body"||Ub(i))&&(a=HR(e)),r){const p=hp(e,!0,s,e);c.x=p.x+e.clientLeft,c.y=p.y+e.clientTop}else i&&(c.x=_5(i));let l=0,u=0;if(i&&!r&&!s){const p=i.getBoundingClientRect();u=p.top+a.scrollTop,l=p.left+a.scrollLeft-_5(i,p)}const d=o.left+a.scrollLeft-c.x-l,f=o.top+a.scrollTop-c.y-u;return{x:d,y:f,width:o.width,height:o.height}}function IP(t){return Mo(t).position==="static"}function MK(t,e){if(!Oo(t)||Mo(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return vl(t)===n&&(n=n.ownerDocument.body),n}function Ere(t,e){const n=to(t);if(jR(t))return n;if(!Oo(t)){let i=Au(t);for(;i&&!pf(i);){if(Pn(i)&&!IP(i))return i;i=Au(i)}return n}let r=MK(t,e);for(;r&&O4e(r)&&IP(r);)r=MK(r,e);return r&&pf(r)&&IP(r)&&!RD(r)?n:r||M4e(t)||n}const M8e=async function(t){const e=this.getOffsetParent||Ere,n=this.getDimensions,r=await n(t.floating);return{reference:O8e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function A8e(t){return Mo(t).direction==="rtl"}const L8e={convertOffsetParentRelativeRectToViewportRelativeRect:E8e,getDocumentElement:vl,getClippingRect:x8e,getOffsetParent:Ere,getElementRects:M8e,getClientRects:T8e,getDimensions:P8e,getScale:Am,isElement:Pn,isRTL:A8e};function D8e(t,e){let n=null,r;const i=vl(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const{left:l,top:u,width:d,height:f}=t.getBoundingClientRect();if(a||e(),!d||!f)return;const p=Hw(u),m=Hw(i.clientWidth-(l+d)),v=Hw(i.clientHeight-(u+f)),S=Hw(l),w={rootMargin:-p+"px "+-m+"px "+-v+"px "+-S+"px",threshold:So(0,gf(1,c))||1};let T=!0;function C(I){const R=I[0].intersectionRatio;if(R!==c){if(!T)return o();R?o(!1,R):r=setTimeout(()=>{o(!1,1e-7)},1e3)}T=!1}try{n=new IntersectionObserver(C,{...w,root:i.ownerDocument})}catch{n=new IntersectionObserver(C,w)}n.observe(t)}return o(!0),s}function Tre(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=MD(t),u=i||s?[...l?Xd(l):[],...Xd(e)]:[];u.forEach(_=>{i&&_.addEventListener("scroll",n,{passive:!0}),s&&_.addEventListener("resize",n)});const d=l&&a?D8e(l,n):null;let f=-1,p=null;o&&(p=new ResizeObserver(_=>{let[w]=_;w&&w.target===l&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var T;(T=p)==null||T.observe(e)})),n()}),l&&!c&&p.observe(l),p.observe(e));let m,v=c?hp(t):null;c&&S();function S(){const _=hp(t);v&&(_.x!==v.x||_.y!==v.y||_.width!==v.width||_.height!==v.height)&&n(),v=_,m=requestAnimationFrame(S)}return n(),()=>{var _;u.forEach(w=>{i&&w.removeEventListener("scroll",n),s&&w.removeEventListener("resize",n)}),d==null||d(),(_=p)==null||_.disconnect(),p=null,c&&cancelAnimationFrame(m)}}const N8e=v8e,U8e=y8e,$8e=p8e,F8e=b8e,B8e=g8e,AK=h8e,j8e=_8e,H8e=(t,e,n)=>{const r=new Map,i={platform:L8e,...n},s={...i.platform,_c:r};return f8e(t,e,{...i,platform:s})};var PT=typeof document<"u"?y.useLayoutEffect:y.useEffect;function _k(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!_k(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!(s==="_owner"&&t.$$typeof)&&!_k(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Cre(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function LK(t,e){const n=Cre(t);return Math.round(e*n)/n}function xP(t){const e=y.useRef(t);return PT(()=>{e.current=t}),e}function kre(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[u,d]=y.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[f,p]=y.useState(r);_k(f,r)||p(r);const[m,v]=y.useState(null),[S,_]=y.useState(null),w=y.useCallback(K=>{K!==R.current&&(R.current=K,v(K))},[]),T=y.useCallback(K=>{K!==O.current&&(O.current=K,_(K))},[]),C=s||m,I=o||S,R=y.useRef(null),O=y.useRef(null),A=y.useRef(u),U=c!=null,N=xP(c),L=xP(i),j=xP(l),X=y.useCallback(()=>{if(!R.current||!O.current)return;const K={placement:e,strategy:n,middleware:f};L.current&&(K.platform=L.current),H8e(R.current,O.current,K).then(W=>{const Y={...W,isPositioned:j.current!==!1};G.current&&!_k(A.current,Y)&&(A.current=Y,Ip.flushSync(()=>{d(Y)}))})},[f,e,n,L,j]);PT(()=>{l===!1&&A.current.isPositioned&&(A.current.isPositioned=!1,d(K=>({...K,isPositioned:!1})))},[l]);const G=y.useRef(!1);PT(()=>(G.current=!0,()=>{G.current=!1}),[]),PT(()=>{if(C&&(R.current=C),I&&(O.current=I),C&&I){if(N.current)return N.current(C,I,X);X()}},[C,I,X,N,U]);const F=y.useMemo(()=>({reference:R,floating:O,setReference:w,setFloating:T}),[w,T]),V=y.useMemo(()=>({reference:C,floating:I}),[C,I]),J=y.useMemo(()=>{const K={position:n,left:0,top:0};if(!V.floating)return K;const W=LK(V.floating,u.x),Y=LK(V.floating,u.y);return a?{...K,transform:"translate("+W+"px, "+Y+"px)",...Cre(V.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:W,top:Y}},[n,a,V.floating,u.x,u.y]);return y.useMemo(()=>({...u,update:X,refs:F,elements:V,floatingStyles:J}),[u,X,F,V,J])}const K8e=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?AK({element:r.current,padding:i}).fn(n):{}:r?AK({element:r,padding:i}).fn(n):{}}}},Rre=(t,e)=>({...N8e(t),options:[t,e]}),Ire=(t,e)=>({...U8e(t),options:[t,e]}),V8e=(t,e)=>({...j8e(t),options:[t,e]}),xre=(t,e)=>({...$8e(t),options:[t,e]}),q8e=(t,e)=>({...F8e(t),options:[t,e]}),G8e=(t,e)=>({...B8e(t),options:[t,e]}),Pre=(t,e)=>({...K8e(t),options:[t,e]});function Ore(t){return y.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})},t)}const Mre={...c4},z8e=Mre.useInsertionEffect,W8e=z8e||(t=>t());function kd(t){const e=y.useRef(()=>{});return W8e(()=>{e.current=t}),y.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var bs=typeof document<"u"?y.useLayoutEffect:y.useEffect;function bk(){return bk=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},bk.apply(this,arguments)}let DK=!1,Y8e=0;const NK=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+Y8e++;function J8e(){const[t,e]=y.useState(()=>DK?NK():void 0);return bs(()=>{t==null&&e(NK())},[]),y.useEffect(()=>{DK=!0},[]),t}const X8e=Mre.useId,yf=X8e||J8e,Z8e=y.forwardRef(function(e,n){const{context:{placement:r,elements:{floating:i},middlewareData:{arrow:s,shift:o}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:u=0,staticOffset:d,stroke:f,d:p,style:{transform:m,...v}={},...S}=e,_=yf(),[w,T]=y.useState(!1);if(bs(()=>{if(!i)return;Mo(i).direction==="rtl"&&T(!0)},[i]),!i)return null;const[C,I]=r.split("-"),R=C==="top"||C==="bottom";let O=d;(R&&o!=null&&o.x||!R&&o!=null&&o.y)&&(O=null);const A=u*2,U=A/2,N=a/2*(l/-8+1),L=c/2*l/4,j=!!p,X=O&&I==="end"?"bottom":"top";let G=O&&I==="end"?"right":"left";O&&w&&(G=I==="end"?"left":"right");const F=(s==null?void 0:s.x)!=null?O||s.x:"",V=(s==null?void 0:s.y)!=null?O||s.y:"",J=p||"M0,0"+(" H"+a)+(" L"+(a-N)+","+(c-L))+(" Q"+a/2+","+c+" "+N+","+(c-L))+" Z",K={top:j?"rotate(180deg)":"",left:j?"rotate(90deg)":"rotate(-90deg)",bottom:j?"":"rotate(180deg)",right:j?"rotate(-90deg)":"rotate(90deg)"}[C];return y.createElement("svg",bk({},S,{"aria-hidden":!0,ref:n,width:j?a:a+A,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[G]:F,[X]:V,[C]:R||j?"100%":"calc(100% - "+A/2+"px)",transform:[K,m].filter(W=>!!W).join(" "),...v}}),A>0&&y.createElement("path",{clipPath:"url(#"+_+")",fill:"none",stroke:f,strokeWidth:A+(p?0:1),d:J}),y.createElement("path",{stroke:A&&!p?S.fill:"none",d:J}),y.createElement("clipPath",{id:_},y.createElement("rect",{x:-U,y:U*(j?-1:1),width:a+A,height:a})))});function Q8e(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var r;t.set(e,((r=t.get(e))==null?void 0:r.filter(i=>i!==n))||[])}}}const eDe=y.createContext(null),tDe=y.createContext(null),AD=()=>{var t;return((t=y.useContext(eDe))==null?void 0:t.id)||null},LD=()=>y.useContext(tDe);function $b(t){return"data-floating-ui-"+t}function PP(t){const e=y.useRef(t);return bs(()=>{e.current=t}),e}const UK=$b("safe-polygon");function OT(t,e,n){return n&&!g5(n)?0:typeof t=="number"?t:t==null?void 0:t[e]}function nDe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,dataRef:i,events:s,elements:o}=t,{enabled:a=!0,delay:c=0,handleClose:l=null,mouseOnly:u=!1,restMs:d=0,move:f=!0}=e,p=LD(),m=AD(),v=PP(l),S=PP(c),_=PP(n),w=y.useRef(),T=y.useRef(-1),C=y.useRef(),I=y.useRef(-1),R=y.useRef(!0),O=y.useRef(!1),A=y.useRef(()=>{}),U=y.useCallback(()=>{var F;const V=(F=i.current.openEvent)==null?void 0:F.type;return(V==null?void 0:V.includes("mouse"))&&V!=="mousedown"},[i]);y.useEffect(()=>{if(!a)return;function F(V){let{open:J}=V;J||(clearTimeout(T.current),clearTimeout(I.current),R.current=!0)}return s.on("openchange",F),()=>{s.off("openchange",F)}},[a,s]),y.useEffect(()=>{if(!a||!v.current||!n)return;function F(J){U()&&r(!1,J,"hover")}const V=Ad(o.floating).documentElement;return V.addEventListener("mouseleave",F),()=>{V.removeEventListener("mouseleave",F)}},[o.floating,n,r,a,v,U]);const N=y.useCallback(function(F,V,J){V===void 0&&(V=!0),J===void 0&&(J="hover");const K=OT(S.current,"close",w.current);K&&!C.current?(clearTimeout(T.current),T.current=window.setTimeout(()=>r(!1,F,J),K)):V&&(clearTimeout(T.current),r(!1,F,J))},[S,r]),L=kd(()=>{A.current(),C.current=void 0}),j=kd(()=>{if(O.current){const F=Ad(o.floating).body;F.style.pointerEvents="",F.removeAttribute(UK),O.current=!1}});y.useEffect(()=>{if(!a)return;function F(){return i.current.openEvent?["click","mousedown"].includes(i.current.openEvent.type):!1}function V(Y){if(clearTimeout(T.current),R.current=!1,u&&!g5(w.current)||d>0&&!OT(S.current,"open"))return;const ce=OT(S.current,"open",w.current);ce?T.current=window.setTimeout(()=>{_.current||r(!0,Y,"hover")},ce):r(!0,Y,"hover")}function J(Y){if(F())return;A.current();const ce=Ad(o.floating);if(clearTimeout(I.current),v.current&&i.current.floatingContext){n||clearTimeout(T.current),C.current=v.current({...i.current.floatingContext,tree:p,x:Y.clientX,y:Y.clientY,onClose(){j(),L(),N(Y,!0,"safe-polygon")}});const Te=C.current;ce.addEventListener("mousemove",Te),A.current=()=>{ce.removeEventListener("mousemove",Te)};return}(w.current==="touch"?!_v(o.floating,Y.relatedTarget):!0)&&N(Y)}function K(Y){F()||i.current.floatingContext&&(v.current==null||v.current({...i.current.floatingContext,tree:p,x:Y.clientX,y:Y.clientY,onClose(){j(),L(),N(Y)}})(Y))}if(Pn(o.domReference)){var W;const Y=o.domReference;return n&&Y.addEventListener("mouseleave",K),(W=o.floating)==null||W.addEventListener("mouseleave",K),f&&Y.addEventListener("mousemove",V,{once:!0}),Y.addEventListener("mouseenter",V),Y.addEventListener("mouseleave",J),()=>{var ce;n&&Y.removeEventListener("mouseleave",K),(ce=o.floating)==null||ce.removeEventListener("mouseleave",K),f&&Y.removeEventListener("mousemove",V),Y.removeEventListener("mouseenter",V),Y.removeEventListener("mouseleave",J)}}},[o,a,t,u,d,f,N,L,j,r,n,_,p,S,v,i]),bs(()=>{var F;if(a&&n&&(F=v.current)!=null&&F.__options.blockPointerEvents&&U()){O.current=!0;const J=o.floating;if(Pn(o.domReference)&&J){var V;const K=Ad(o.floating).body;K.setAttribute(UK,"");const W=o.domReference,Y=p==null||(V=p.nodesRef.current.find(ce=>ce.id===m))==null||(V=V.context)==null?void 0:V.elements.floating;return Y&&(Y.style.pointerEvents=""),K.style.pointerEvents="none",W.style.pointerEvents="auto",J.style.pointerEvents="auto",()=>{K.style.pointerEvents="",W.style.pointerEvents="",J.style.pointerEvents=""}}}},[a,n,m,o,p,v,U]),bs(()=>{n||(w.current=void 0,L(),j())},[n,L,j]),y.useEffect(()=>()=>{L(),clearTimeout(T.current),clearTimeout(I.current),j()},[a,o.domReference,L,j]);const X=y.useMemo(()=>{function F(V){w.current=V.pointerType}return{onPointerDown:F,onPointerEnter:F,onMouseMove(V){const{nativeEvent:J}=V;function K(){!R.current&&!_.current&&r(!0,J,"hover")}u&&!g5(w.current)||n||d===0||(clearTimeout(I.current),w.current==="touch"?K():I.current=window.setTimeout(K,d))}}},[u,r,n,_,d]),G=y.useMemo(()=>({onMouseEnter(){clearTimeout(T.current)},onMouseLeave(F){N(F.nativeEvent,!1)}}),[N]);return y.useMemo(()=>a?{reference:X,floating:G}:{},[a,X,G])}const b5=()=>{},Are=y.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:b5,setState:b5,isInstantPhase:!1}),rDe=()=>y.useContext(Are);function iDe(t){const{children:e,delay:n,timeoutMs:r=0}=t,[i,s]=y.useReducer((c,l)=>({...c,...l}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),o=y.useRef(null),a=y.useCallback(c=>{s({currentId:c})},[]);return bs(()=>{i.currentId?o.current===null?o.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),o.current=null)},[i.currentId,i.isInstantPhase]),y.createElement(Are.Provider,{value:y.useMemo(()=>({...i,setState:s,setCurrentId:a}),[i,a])},e)}function sDe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,floatingId:i}=t,{id:s}=e,o=s??i,a=rDe(),{currentId:c,setCurrentId:l,initialDelay:u,setState:d,timeoutMs:f}=a;return bs(()=>{c&&(d({delay:{open:1,close:OT(u,"close")}}),c!==o&&r(!1))},[o,r,d,c,u]),bs(()=>{function p(){r(!1),d({delay:u,currentId:null})}if(c&&!n&&c===o){if(f){const m=window.setTimeout(p,f);return()=>{clearTimeout(m)}}p()}},[n,d,c,o,r,u,f]),bs(()=>{l===b5||!n||l(o)},[n,l,o]),a}function OP(t,e){let n=t.filter(i=>{var s;return i.parentId===e&&((s=i.context)==null?void 0:s.open)}),r=n;for(;r.length;)r=t.filter(i=>{var s;return(s=r)==null?void 0:s.some(o=>{var a;return i.parentId===o.id&&((a=i.context)==null?void 0:a.open)})}),n=n.concat(r);return n}const Lre=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function Dre(t,e){const n=_re(t,Lre());e==="prev"&&n.reverse();const r=n.indexOf(p5(Ad(t)));return n.slice(r+1)[0]}function oDe(){return Dre(document.body,"next")}function aDe(){return Dre(document.body,"prev")}function MP(t,e){const n=e||t.currentTarget,r=t.relatedTarget;return!r||!_v(n,r)}function cDe(t){_re(t,Lre()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function $K(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}const Nre={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let lDe;function FK(t){t.key==="Tab"&&(t.target,clearTimeout(lDe))}const BK=y.forwardRef(function(e,n){const[r,i]=y.useState();bs(()=>(hre()&&i("button"),document.addEventListener("keydown",FK),()=>{document.removeEventListener("keydown",FK)}),[]);const s={ref:n,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[$b("focus-guard")]:"",style:Nre};return y.createElement("span",bk({},e,s))}),Ure=y.createContext(null),jK=$b("portal");function uDe(t){t===void 0&&(t={});const{id:e,root:n}=t,r=yf(),i=fDe(),[s,o]=y.useState(null),a=y.useRef(null);return bs(()=>()=>{s==null||s.remove(),queueMicrotask(()=>{a.current=null})},[s]),bs(()=>{if(!r||a.current)return;const c=e?document.getElementById(e):null;if(!c)return;const l=document.createElement("div");l.id=r,l.setAttribute(jK,""),c.appendChild(l),a.current=l,o(l)},[e,r]),bs(()=>{if(!r||a.current)return;let c=n||(i==null?void 0:i.portalNode);c&&!Pn(c)&&(c=c.current),c=c||document.body;let l=null;e&&(l=document.createElement("div"),l.id=e,c.appendChild(l));const u=document.createElement("div");u.id=r,u.setAttribute(jK,""),c=l||c,c.appendChild(u),a.current=u,o(u)},[e,n,r,i]),s}function dDe(t){const{children:e,id:n,root:r=null,preserveTabOrder:i=!0}=t,s=uDe({id:n,root:r}),[o,a]=y.useState(null),c=y.useRef(null),l=y.useRef(null),u=y.useRef(null),d=y.useRef(null),f=o==null?void 0:o.modal,p=o==null?void 0:o.open,m=!!o&&!o.modal&&o.open&&i&&!!(r||s);return y.useEffect(()=>{if(!s||!i||f)return;function v(S){s&&MP(S)&&(S.type==="focusin"?$K:cDe)(s)}return s.addEventListener("focusin",v,!0),s.addEventListener("focusout",v,!0),()=>{s.removeEventListener("focusin",v,!0),s.removeEventListener("focusout",v,!0)}},[s,i,f]),y.useEffect(()=>{s&&(p||$K(s))},[p,s]),y.createElement(Ure.Provider,{value:y.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:u,afterInsideRef:d,portalNode:s,setFocusManagerState:a}),[i,s])},m&&s&&y.createElement(BK,{"data-type":"outside",ref:c,onFocus:v=>{if(MP(v,s)){var S;(S=u.current)==null||S.focus()}else{const _=aDe()||(o==null?void 0:o.refs.domReference.current);_==null||_.focus()}}}),m&&s&&y.createElement("span",{"aria-owns":s.id,style:Nre}),s&&Ip.createPortal(e,s),m&&s&&y.createElement(BK,{"data-type":"outside",ref:l,onFocus:v=>{if(MP(v,s)){var S;(S=d.current)==null||S.focus()}else{const _=oDe()||(o==null?void 0:o.refs.domReference.current);_==null||_.focus(),o!=null&&o.closeOnFocusOut&&(o==null||o.onOpenChange(!1,v.nativeEvent,"focus-out"))}}}))}const fDe=()=>y.useContext(Ure),hDe="data-floating-ui-focusable",pDe={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},gDe={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},HK=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t==null?void 0:t.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t==null?void 0:t.outsidePress)!=null?n:!0}};function mDe(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,elements:i,dataRef:s}=t,{enabled:o=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:u=!1,referencePressEvent:d="pointerdown",ancestorScroll:f=!1,bubbles:p,capture:m}=e,v=LD(),S=kd(typeof c=="function"?c:()=>!1),_=typeof c=="function"?S:c,w=y.useRef(!1),T=y.useRef(!1),{escapeKey:C,outsidePress:I}=HK(p),{escapeKey:R,outsidePress:O}=HK(m),A=kd(G=>{var F;if(!n||!o||!a||G.key!=="Escape")return;const V=(F=s.current.floatingContext)==null?void 0:F.nodeId,J=v?OP(v.nodesRef.current,V):[];if(!C&&(G.stopPropagation(),J.length>0)){let K=!0;if(J.forEach(W=>{var Y;if((Y=W.context)!=null&&Y.open&&!W.context.dataRef.current.__escapeKeyBubbles){K=!1;return}}),!K)return}r(!1,N4e(G)?G.nativeEvent:G,"escape-key")}),U=kd(G=>{var F;const V=()=>{var J;A(G),(J=Ng(G))==null||J.removeEventListener("keydown",V)};(F=Ng(G))==null||F.addEventListener("keydown",V)}),N=kd(G=>{var F;const V=w.current;w.current=!1;const J=T.current;if(T.current=!1,l==="click"&&J||V||typeof _=="function"&&!_(G))return;const K=Ng(G),W="["+$b("inert")+"]",Y=Ad(i.floating).querySelectorAll(W);let ce=Pn(K)?K:null;for(;ce&&!pf(ce);){const Oe=Au(ce);if(pf(Oe)||!Pn(Oe))break;ce=Oe}if(Y.length&&Pn(K)&&!U4e(K)&&!_v(K,i.floating)&&Array.from(Y).every(Oe=>!_v(ce,Oe)))return;if(Oo(K)&&X){const Oe=K.clientWidth>0&&K.scrollWidth>K.clientWidth,De=K.clientHeight>0&&K.scrollHeight>K.clientHeight;let ze=De&&G.offsetX>K.clientWidth;if(De&&Mo(K).direction==="rtl"&&(ze=G.offsetX<=K.offsetWidth-K.clientWidth),ze||Oe&&G.offsetY>K.clientHeight)return}const ue=(F=s.current.floatingContext)==null?void 0:F.nodeId,Te=v&&OP(v.nodesRef.current,ue).some(Oe=>{var De;return RP(G,(De=Oe.context)==null?void 0:De.elements.floating)});if(RP(G,i.floating)||RP(G,i.domReference)||Te)return;const Re=v?OP(v.nodesRef.current,ue):[];if(Re.length>0){let Oe=!0;if(Re.forEach(De=>{var ze;if((ze=De.context)!=null&&ze.open&&!De.context.dataRef.current.__outsidePressBubbles){Oe=!1;return}}),!Oe)return}r(!1,G,"outside-press")}),L=kd(G=>{var F;const V=()=>{var J;N(G),(J=Ng(G))==null||J.removeEventListener(l,V)};(F=Ng(G))==null||F.addEventListener(l,V)});y.useEffect(()=>{if(!n||!o)return;s.current.__escapeKeyBubbles=C,s.current.__outsidePressBubbles=I;function G(J){r(!1,J,"ancestor-scroll")}const F=Ad(i.floating);a&&F.addEventListener("keydown",R?U:A,R),_&&F.addEventListener(l,O?L:N,O);let V=[];return f&&(Pn(i.domReference)&&(V=Xd(i.domReference)),Pn(i.floating)&&(V=V.concat(Xd(i.floating))),!Pn(i.reference)&&i.reference&&i.reference.contextElement&&(V=V.concat(Xd(i.reference.contextElement)))),V=V.filter(J=>{var K;return J!==((K=F.defaultView)==null?void 0:K.visualViewport)}),V.forEach(J=>{J.addEventListener("scroll",G,{passive:!0})}),()=>{a&&F.removeEventListener("keydown",R?U:A,R),_&&F.removeEventListener(l,O?L:N,O),V.forEach(J=>{J.removeEventListener("scroll",G)})}},[s,i,a,_,l,n,r,f,o,C,I,A,R,U,N,O,L]),y.useEffect(()=>{w.current=!1},[_,l]);const j=y.useMemo(()=>({onKeyDown:A,[pDe[d]]:G=>{u&&r(!1,G.nativeEvent,"reference-press")}}),[A,r,u,d]),X=y.useMemo(()=>({onKeyDown:A,onMouseDown(){T.current=!0},onMouseUp(){T.current=!0},[gDe[l]]:()=>{w.current=!0}}),[A,l]);return y.useMemo(()=>o?{reference:j,floating:X}:{},[o,j,X])}function vDe(t){const{open:e=!1,onOpenChange:n,elements:r}=t,i=yf(),s=y.useRef({}),[o]=y.useState(()=>Q8e()),a=AD()!=null,[c,l]=y.useState(r.reference),u=kd((p,m,v)=>{s.current.openEvent=p?m:void 0,o.emit("openchange",{open:p,event:m,reason:v,nested:a}),n==null||n(p,m,v)}),d=y.useMemo(()=>({setPositionReference:l}),[]),f=y.useMemo(()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference}),[c,r.reference,r.floating]);return y.useMemo(()=>({dataRef:s,open:e,onOpenChange:u,elements:f,events:o,floatingId:i,refs:d}),[e,u,f,o,i,d])}function yDe(t){t===void 0&&(t={});const{nodeId:e}=t,n=vDe({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,i=r.elements,[s,o]=y.useState(null),[a,c]=y.useState(null),u=(i==null?void 0:i.reference)||s,d=y.useRef(null),f=LD();bs(()=>{u&&(d.current=u)},[u]);const p=kre({...t,elements:{...i,...a&&{reference:a}}}),m=y.useCallback(T=>{const C=Pn(T)?{getBoundingClientRect:()=>T.getBoundingClientRect(),contextElement:T}:T;c(C),p.refs.setReference(C)},[p.refs]),v=y.useCallback(T=>{(Pn(T)||T===null)&&(d.current=T,o(T)),(Pn(p.refs.reference.current)||p.refs.reference.current===null||T!==null&&!Pn(T))&&p.refs.setReference(T)},[p.refs]),S=y.useMemo(()=>({...p.refs,setReference:v,setPositionReference:m,domReference:d}),[p.refs,v,m]),_=y.useMemo(()=>({...p.elements,domReference:u}),[p.elements,u]),w=y.useMemo(()=>({...p,...r,refs:S,elements:_,nodeId:e}),[p,S,_,e,r]);return bs(()=>{r.dataRef.current.floatingContext=w;const T=f==null?void 0:f.nodesRef.current.find(C=>C.id===e);T&&(T.context=w)}),y.useMemo(()=>({...p,context:w,refs:S,elements:_}),[p,S,_,w])}function _De(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,events:i,dataRef:s,elements:o}=t,{enabled:a=!0,visibleOnly:c=!0}=e,l=y.useRef(!1),u=y.useRef(),d=y.useRef(!0);y.useEffect(()=>{if(!a)return;const p=to(o.domReference);function m(){!n&&Oo(o.domReference)&&o.domReference===p5(Ad(o.domReference))&&(l.current=!0)}function v(){d.current=!0}return p.addEventListener("blur",m),p.addEventListener("keydown",v,!0),()=>{p.removeEventListener("blur",m),p.removeEventListener("keydown",v,!0)}},[o.domReference,n,a]),y.useEffect(()=>{if(!a)return;function p(m){let{reason:v}=m;(v==="reference-press"||v==="escape-key")&&(l.current=!0)}return i.on("openchange",p),()=>{i.off("openchange",p)}},[i,a]),y.useEffect(()=>()=>{clearTimeout(u.current)},[]);const f=y.useMemo(()=>({onPointerDown(p){A4e(p.nativeEvent)||(d.current=!1)},onMouseLeave(){l.current=!1},onFocus(p){if(l.current)return;const m=Ng(p.nativeEvent);if(c&&Pn(m))try{if(hre()&&L4e())throw Error();if(!m.matches(":focus-visible"))return}catch{if(!d.current&&!F4e(m))return}r(!0,p.nativeEvent,"focus")},onBlur(p){l.current=!1;const m=p.relatedTarget,v=p.nativeEvent,S=Pn(m)&&m.hasAttribute($b("focus-guard"))&&m.getAttribute("data-type")==="outside";u.current=window.setTimeout(()=>{var _;const w=p5(o.domReference?o.domReference.ownerDocument:document);!m&&w===o.domReference||_v((_=s.current.floatingContext)==null?void 0:_.refs.floating.current,w)||_v(o.domReference,w)||S||r(!1,v,"focus")})}}),[s,o.domReference,r,c]);return y.useMemo(()=>a?{reference:f}:{},[a,f])}const KK="active",VK="selected";function AP(t,e,n){const r=new Map,i=n==="item";let s=t;if(i&&t){const{[KK]:o,[VK]:a,...c}=t;s=c}return{...n==="floating"&&{tabIndex:-1,[hDe]:""},...s,...e.map(o=>{const a=o?o[n]:null;return typeof a=="function"?t?a(t):null:a}).concat(t).reduce((o,a)=>(a&&Object.entries(a).forEach(c=>{let[l,u]=c;if(!(i&&[KK,VK].includes(l)))if(l.indexOf("on")===0){if(r.has(l)||r.set(l,[]),typeof u=="function"){var d;(d=r.get(l))==null||d.push(u),o[l]=function(){for(var f,p=arguments.length,m=new Array(p),v=0;v<p;v++)m[v]=arguments[v];return(f=r.get(l))==null?void 0:f.map(S=>S(...m)).find(S=>S!==void 0)}}}else o[l]=u}),o),{})}}function bDe(t){t===void 0&&(t=[]);const e=t.map(a=>a==null?void 0:a.reference),n=t.map(a=>a==null?void 0:a.floating),r=t.map(a=>a==null?void 0:a.item),i=y.useCallback(a=>AP(a,t,"reference"),e),s=y.useCallback(a=>AP(a,t,"floating"),n),o=y.useCallback(a=>AP(a,t,"item"),r);return y.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:o}),[i,s,o])}const SDe=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function wDe(t,e){var n;e===void 0&&(e={});const{open:r,floatingId:i}=t,{enabled:s=!0,role:o="dialog"}=e,a=(n=SDe.get(o))!=null?n:o,c=yf(),u=AD()!=null,d=y.useMemo(()=>a==="tooltip"||o==="label"?{["aria-"+(o==="label"?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":a==="alertdialog"?"dialog":a,"aria-controls":r?i:void 0,...a==="listbox"&&{role:"combobox"},...a==="menu"&&{id:c},...a==="menu"&&u&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[a,i,u,r,c,o]),f=y.useMemo(()=>{const m={id:i,...a&&{role:a}};return a==="tooltip"||o==="label"?m:{...m,...a==="menu"&&{"aria-labelledby":c}}},[a,i,c,o]),p=y.useCallback(m=>{let{active:v,selected:S}=m;const _={role:"option",...v&&{id:i+"-option"}};switch(o){case"select":return{..._,"aria-selected":v&&S};case"combobox":return{..._,...v&&{"aria-selected":!0}}}return{}},[i,o]);return y.useMemo(()=>s?{reference:d,floating:f,item:p}:{},[s,d,f,p])}function Je(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function EDe(t,e=[]){let n=[];function r(s,o){const a=y.createContext(o),c=n.length;n=[...n,o];const l=d=>{var _;const{scope:f,children:p,...m}=d,v=((_=f==null?void 0:f[t])==null?void 0:_[c])||a,S=y.useMemo(()=>m,Object.values(m));return b.jsx(v.Provider,{value:S,children:p})};l.displayName=s+"Provider";function u(d,f){var v;const p=((v=f==null?void 0:f[t])==null?void 0:v[c])||a,m=y.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const i=()=>{const s=n.map(o=>y.createContext(o));return function(a){const c=(a==null?void 0:a[t])||s;return y.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,TDe(i,...e)]}function TDe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function CDe(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function KR(...t){return e=>t.forEach(n=>CDe(n,e))}function cn(...t){return y.useCallback(KR(...t),t)}var _f=y.forwardRef((t,e)=>{const{children:n,...r}=t,i=y.Children.toArray(n),s=i.find(RDe);if(s){const o=s.props.children,a=i.map(c=>c===s?y.Children.count(o)>1?y.Children.only(null):y.isValidElement(o)?o.props.children:null:c);return b.jsx(S5,{...r,ref:e,children:y.isValidElement(o)?y.cloneElement(o,void 0,a):null})}return b.jsx(S5,{...r,ref:e,children:n})});_f.displayName="Slot";var S5=y.forwardRef((t,e)=>{const{children:n,...r}=t;if(y.isValidElement(n)){const i=xDe(n);return y.cloneElement(n,{...IDe(r,n.props),ref:e?KR(e,i):i})}return y.Children.count(n)>1?y.Children.only(null):null});S5.displayName="SlotClone";var kDe=({children:t})=>b.jsx(b.Fragment,{children:t});function RDe(t){return y.isValidElement(t)&&t.type===kDe}function IDe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function xDe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var PDe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],wt=PDe.reduce((t,e)=>{const n=y.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?_f:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function $re(t,e){t&&Ip.flushSync(()=>t.dispatchEvent(e))}function ODe(t,e){const n=y.createContext(e);function r(s){const{children:o,...a}=s,c=y.useMemo(()=>a,Object.values(a));return b.jsx(n.Provider,{value:c,children:o})}function i(s){const o=y.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return r.displayName=t+"Provider",[r,i]}function Dp(t,e=[]){let n=[];function r(s,o){const a=y.createContext(o),c=n.length;n=[...n,o];function l(d){const{scope:f,children:p,...m}=d,v=(f==null?void 0:f[t][c])||a,S=y.useMemo(()=>m,Object.values(m));return b.jsx(v.Provider,{value:S,children:p})}function u(d,f){const p=(f==null?void 0:f[t][c])||a,m=y.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const i=()=>{const s=n.map(o=>y.createContext(o));return function(a){const c=(a==null?void 0:a[t])||s;return y.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,MDe(i,...e)]}function MDe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function DD(t){const e=t+"CollectionProvider",[n,r]=Dp(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=p=>{const{scope:m,children:v}=p,S=re.useRef(null),_=re.useRef(new Map).current;return b.jsx(i,{scope:m,itemMap:_,collectionRef:S,children:v})};o.displayName=e;const a=t+"CollectionSlot",c=re.forwardRef((p,m)=>{const{scope:v,children:S}=p,_=s(a,v),w=cn(m,_.collectionRef);return b.jsx(_f,{ref:w,children:S})});c.displayName=a;const l=t+"CollectionItemSlot",u="data-radix-collection-item",d=re.forwardRef((p,m)=>{const{scope:v,children:S,..._}=p,w=re.useRef(null),T=cn(m,w),C=s(l,v);return re.useEffect(()=>(C.itemMap.set(w,{ref:w,..._}),()=>void C.itemMap.delete(w))),b.jsx(_f,{[u]:"",ref:T,children:S})});d.displayName=l;function f(p){const m=s(t+"CollectionConsumer",p);return re.useCallback(()=>{const S=m.collectionRef.current;if(!S)return[];const _=Array.from(S.querySelectorAll(`[${u}]`));return Array.from(m.itemMap.values()).sort((C,I)=>_.indexOf(C.ref.current)-_.indexOf(I.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:o,Slot:c,ItemSlot:d},f,r]}function ADe(t,e=[]){let n=[];function r(s,o){const a=y.createContext(o),c=n.length;n=[...n,o];const l=d=>{var _;const{scope:f,children:p,...m}=d,v=((_=f==null?void 0:f[t])==null?void 0:_[c])||a,S=y.useMemo(()=>m,Object.values(m));return b.jsx(v.Provider,{value:S,children:p})};l.displayName=s+"Provider";function u(d,f){var v;const p=((v=f==null?void 0:f[t])==null?void 0:v[c])||a,m=y.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const i=()=>{const s=n.map(o=>y.createContext(o));return function(a){const c=(a==null?void 0:a[t])||s;return y.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,LDe(i,...e)]}function LDe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var DDe=y.createContext(void 0);function ND(t){const e=y.useContext(DDe);return t||e||"ltr"}function Ia(t){const e=y.useRef(t);return y.useEffect(()=>{e.current=t}),y.useMemo(()=>(...n)=>{var r;return(r=e.current)==null?void 0:r.call(e,...n)},[])}function NDe(t,e=globalThis==null?void 0:globalThis.document){const n=Ia(t);y.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var UDe="DismissableLayer",w5="dismissableLayer.update",$De="dismissableLayer.pointerDownOutside",FDe="dismissableLayer.focusOutside",qK,Fre=y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),VR=y.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=t,l=y.useContext(Fre),[u,d]=y.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=y.useState({}),m=cn(e,O=>d(O)),v=Array.from(l.layers),[S]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),_=v.indexOf(S),w=u?v.indexOf(u):-1,T=l.layersWithOutsidePointerEventsDisabled.size>0,C=w>=_,I=HDe(O=>{const A=O.target,U=[...l.branches].some(N=>N.contains(A));!C||U||(i==null||i(O),o==null||o(O),O.defaultPrevented||a==null||a())},f),R=KDe(O=>{const A=O.target;[...l.branches].some(N=>N.contains(A))||(s==null||s(O),o==null||o(O),O.defaultPrevented||a==null||a())},f);return NDe(O=>{w===l.layers.size-1&&(r==null||r(O),!O.defaultPrevented&&a&&(O.preventDefault(),a()))},f),y.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(qK=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),GK(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=qK)}},[u,f,n,l]),y.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),GK())},[u,l]),y.useEffect(()=>{const O=()=>p({});return document.addEventListener(w5,O),()=>document.removeEventListener(w5,O)},[]),b.jsx(wt.div,{...c,ref:m,style:{pointerEvents:T?C?"auto":"none":void 0,...t.style},onFocusCapture:Je(t.onFocusCapture,R.onFocusCapture),onBlurCapture:Je(t.onBlurCapture,R.onBlurCapture),onPointerDownCapture:Je(t.onPointerDownCapture,I.onPointerDownCapture)})});VR.displayName=UDe;var BDe="DismissableLayerBranch",jDe=y.forwardRef((t,e)=>{const n=y.useContext(Fre),r=y.useRef(null),i=cn(e,r);return y.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),b.jsx(wt.div,{...t,ref:i})});jDe.displayName=BDe;function HDe(t,e=globalThis==null?void 0:globalThis.document){const n=Ia(t),r=y.useRef(!1),i=y.useRef(()=>{});return y.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){Bre($De,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function KDe(t,e=globalThis==null?void 0:globalThis.document){const n=Ia(t),r=y.useRef(!1);return y.useEffect(()=>{const i=s=>{s.target&&!r.current&&Bre(FDe,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function GK(){const t=new CustomEvent(w5);document.dispatchEvent(t)}function Bre(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?$re(i,s):i.dispatchEvent(s)}var LP=0;function UD(){y.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??zK()),document.body.insertAdjacentElement("beforeend",t[1]??zK()),LP++,()=>{LP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),LP--}},[])}function zK(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var DP="focusScope.autoFocusOnMount",NP="focusScope.autoFocusOnUnmount",WK={bubbles:!1,cancelable:!0},VDe="FocusScope",qR=y.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=y.useState(null),l=Ia(i),u=Ia(s),d=y.useRef(null),f=cn(e,v=>c(v)),p=y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;y.useEffect(()=>{if(r){let v=function(T){if(p.paused||!a)return;const C=T.target;a.contains(C)?d.current=C:fd(d.current,{select:!0})},S=function(T){if(p.paused||!a)return;const C=T.relatedTarget;C!==null&&(a.contains(C)||fd(d.current,{select:!0}))},_=function(T){if(document.activeElement===document.body)for(const I of T)I.removedNodes.length>0&&fd(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",S);const w=new MutationObserver(_);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",S),w.disconnect()}}},[r,a,p.paused]),y.useEffect(()=>{if(a){JK.add(p);const v=document.activeElement;if(!a.contains(v)){const _=new CustomEvent(DP,WK);a.addEventListener(DP,l),a.dispatchEvent(_),_.defaultPrevented||(qDe(JDe(jre(a)),{select:!0}),document.activeElement===v&&fd(a))}return()=>{a.removeEventListener(DP,l),setTimeout(()=>{const _=new CustomEvent(NP,WK);a.addEventListener(NP,u),a.dispatchEvent(_),_.defaultPrevented||fd(v??document.body,{select:!0}),a.removeEventListener(NP,u),JK.remove(p)},0)}}},[a,l,u,p]);const m=y.useCallback(v=>{if(!n&&!r||p.paused)return;const S=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,_=document.activeElement;if(S&&_){const w=v.currentTarget,[T,C]=GDe(w);T&&C?!v.shiftKey&&_===C?(v.preventDefault(),n&&fd(T,{select:!0})):v.shiftKey&&_===T&&(v.preventDefault(),n&&fd(C,{select:!0})):_===w&&v.preventDefault()}},[n,r,p.paused]);return b.jsx(wt.div,{tabIndex:-1,...o,ref:f,onKeyDown:m})});qR.displayName=VDe;function qDe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(fd(r,{select:e}),document.activeElement!==n)return}function GDe(t){const e=jre(t),n=YK(e,t),r=YK(e.reverse(),t);return[n,r]}function jre(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function YK(t,e){for(const n of t)if(!zDe(n,{upTo:e}))return n}function zDe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function WDe(t){return t instanceof HTMLInputElement&&"select"in t}function fd(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&WDe(t)&&e&&t.select()}}var JK=YDe();function YDe(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=XK(t,e),t.unshift(e)},remove(e){var n;t=XK(t,e),(n=t[0])==null||n.resume()}}}function XK(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function JDe(t){return t.filter(e=>e.tagName!=="A")}var cl=globalThis!=null&&globalThis.document?y.useLayoutEffect:()=>{},XDe=c4.useId||(()=>{}),ZDe=0;function _a(t){const[e,n]=y.useState(XDe());return cl(()=>{n(r=>r??String(ZDe++))},[t]),e?`radix-${e}`:""}var QDe="Arrow",Hre=y.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return b.jsx(wt.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:b.jsx("polygon",{points:"0,0 30,0 15,10"})})});Hre.displayName=QDe;var eNe=Hre;function Kre(t){const[e,n]=y.useState(void 0);return cl(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var $D="Popper",[Vre,qre]=Dp($D),[tNe,Gre]=Vre($D),zre=t=>{const{__scopePopper:e,children:n}=t,[r,i]=y.useState(null);return b.jsx(tNe,{scope:e,anchor:r,onAnchorChange:i,children:n})};zre.displayName=$D;var Wre="PopperAnchor",Yre=y.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=Gre(Wre,n),o=y.useRef(null),a=cn(e,o);return y.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:b.jsx(wt.div,{...i,ref:a})});Yre.displayName=Wre;var FD="PopperContent",[nNe,rNe]=Vre(FD),Jre=y.forwardRef((t,e)=>{var ze,et,lt,Ae,yn,un;const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:m,...v}=t,S=Gre(FD,n),[_,w]=y.useState(null),T=cn(e,je=>w(je)),[C,I]=y.useState(null),R=Kre(C),O=(R==null?void 0:R.width)??0,A=(R==null?void 0:R.height)??0,U=r+(s!=="center"?"-"+s:""),N=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},L=Array.isArray(l)?l:[l],j=L.length>0,X={padding:N,boundary:L.filter(sNe),altBoundary:j},{refs:G,floatingStyles:F,placement:V,isPositioned:J,middlewareData:K}=kre({strategy:"fixed",placement:U,whileElementsMounted:(...je)=>Tre(...je,{animationFrame:p==="always"}),elements:{reference:S.anchor},middleware:[Rre({mainAxis:i+A,alignmentAxis:o}),c&&Ire({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?V8e():void 0,...X}),c&&xre({...X}),q8e({...X,apply:({elements:je,rects:Bt,availableWidth:_n,availableHeight:Jn})=>{const{width:nn,height:Mr}=Bt.reference,kn=je.floating.style;kn.setProperty("--radix-popper-available-width",`${_n}px`),kn.setProperty("--radix-popper-available-height",`${Jn}px`),kn.setProperty("--radix-popper-anchor-width",`${nn}px`),kn.setProperty("--radix-popper-anchor-height",`${Mr}px`)}}),C&&Pre({element:C,padding:a}),oNe({arrowWidth:O,arrowHeight:A}),f&&G8e({strategy:"referenceHidden",...X})]}),[W,Y]=Qre(V),ce=Ia(m);cl(()=>{J&&(ce==null||ce())},[J,ce]);const ue=(ze=K.arrow)==null?void 0:ze.x,Te=(et=K.arrow)==null?void 0:et.y,Re=((lt=K.arrow)==null?void 0:lt.centerOffset)!==0,[Oe,De]=y.useState();return cl(()=>{_&&De(window.getComputedStyle(_).zIndex)},[_]),b.jsx("div",{ref:G.setFloating,"data-radix-popper-content-wrapper":"",style:{...F,transform:J?F.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Oe,"--radix-popper-transform-origin":[(Ae=K.transformOrigin)==null?void 0:Ae.x,(yn=K.transformOrigin)==null?void 0:yn.y].join(" "),...((un=K.hide)==null?void 0:un.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:b.jsx(nNe,{scope:n,placedSide:W,onArrowChange:I,arrowX:ue,arrowY:Te,shouldHideArrow:Re,children:b.jsx(wt.div,{"data-side":W,"data-align":Y,...v,ref:T,style:{...v.style,animation:J?void 0:"none"}})})})});Jre.displayName=FD;var Xre="PopperArrow",iNe={top:"bottom",right:"left",bottom:"top",left:"right"},Zre=y.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=rNe(Xre,r),o=iNe[s.placedSide];return b.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:b.jsx(eNe,{...i,ref:n,style:{...i.style,display:"block"}})})});Zre.displayName=Xre;function sNe(t){return t!==null}var oNe=t=>({name:"transformOrigin",options:t,fn(e){var S,_,w;const{placement:n,rects:r,middlewareData:i}=e,o=((S=i.arrow)==null?void 0:S.centerOffset)!==0,a=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[l,u]=Qre(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(((_=i.arrow)==null?void 0:_.x)??0)+a/2,p=(((w=i.arrow)==null?void 0:w.y)??0)+c/2;let m="",v="";return l==="bottom"?(m=o?d:`${f}px`,v=`${-c}px`):l==="top"?(m=o?d:`${f}px`,v=`${r.floating.height+c}px`):l==="right"?(m=`${-c}px`,v=o?d:`${p}px`):l==="left"&&(m=`${r.floating.width+c}px`,v=o?d:`${p}px`),{data:{x:m,y:v}}}});function Qre(t){const[e,n="center"]=t.split("-");return[e,n]}var aNe=zre,cNe=Yre,lNe=Jre,uNe=Zre,dNe="Portal",BD=y.forwardRef((t,e)=>{var a;const{container:n,...r}=t,[i,s]=y.useState(!1);cl(()=>s(!0),[]);const o=n||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?IQ.createPortal(b.jsx(wt.div,{...r,ref:e}),o):null});BD.displayName=dNe;function fNe(t,e){return y.useReducer((n,r)=>e[n][r]??n,t)}var Mf=t=>{const{present:e,children:n}=t,r=hNe(e),i=typeof n=="function"?n({present:r.isPresent}):y.Children.only(n),s=cn(r.ref,pNe(i));return typeof n=="function"||r.isPresent?y.cloneElement(i,{ref:s}):null};Mf.displayName="Presence";function hNe(t){const[e,n]=y.useState(),r=y.useRef({}),i=y.useRef(t),s=y.useRef("none"),o=t?"mounted":"unmounted",[a,c]=fNe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return y.useEffect(()=>{const l=Kw(r.current);s.current=a==="mounted"?l:"none"},[a]),cl(()=>{const l=r.current,u=i.current;if(u!==t){const f=s.current,p=Kw(l);t?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),cl(()=>{if(e){let l;const u=e.ownerDocument.defaultView??window,d=p=>{const v=Kw(r.current).includes(p.animationName);if(p.target===e&&v&&(c("ANIMATION_END"),!i.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",l=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},f=p=>{p.target===e&&(s.current=Kw(r.current))};return e.addEventListener("animationstart",f),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(l),e.removeEventListener("animationstart",f),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:y.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function Kw(t){return(t==null?void 0:t.animationName)||"none"}function pNe(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function Fb({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=gNe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Ia(n),c=y.useCallback(l=>{if(s){const d=typeof l=="function"?l(t):l;d!==t&&a(d)}else i(l)},[s,t,i,a]);return[o,c]}function gNe({defaultProp:t,onChange:e}){const n=y.useState(t),[r]=n,i=y.useRef(r),s=Ia(e);return y.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}var UP="rovingFocusGroup.onEntryFocus",mNe={bubbles:!1,cancelable:!0},GR="RovingFocusGroup",[E5,eie,vNe]=DD(GR),[yNe,tie]=Dp(GR,[vNe]),[_Ne,bNe]=yNe(GR),nie=y.forwardRef((t,e)=>b.jsx(E5.Provider,{scope:t.__scopeRovingFocusGroup,children:b.jsx(E5.Slot,{scope:t.__scopeRovingFocusGroup,children:b.jsx(SNe,{...t,ref:e})})}));nie.displayName=GR;var SNe=y.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:u=!1,...d}=t,f=y.useRef(null),p=cn(e,f),m=ND(s),[v=null,S]=Fb({prop:o,defaultProp:a,onChange:c}),[_,w]=y.useState(!1),T=Ia(l),C=eie(n),I=y.useRef(!1),[R,O]=y.useState(0);return y.useEffect(()=>{const A=f.current;if(A)return A.addEventListener(UP,T),()=>A.removeEventListener(UP,T)},[T]),b.jsx(_Ne,{scope:n,orientation:r,dir:m,loop:i,currentTabStopId:v,onItemFocus:y.useCallback(A=>S(A),[S]),onItemShiftTab:y.useCallback(()=>w(!0),[]),onFocusableItemAdd:y.useCallback(()=>O(A=>A+1),[]),onFocusableItemRemove:y.useCallback(()=>O(A=>A-1),[]),children:b.jsx(wt.div,{tabIndex:_||R===0?-1:0,"data-orientation":r,...d,ref:p,style:{outline:"none",...t.style},onMouseDown:Je(t.onMouseDown,()=>{I.current=!0}),onFocus:Je(t.onFocus,A=>{const U=!I.current;if(A.target===A.currentTarget&&U&&!_){const N=new CustomEvent(UP,mNe);if(A.currentTarget.dispatchEvent(N),!N.defaultPrevented){const L=C().filter(V=>V.focusable),j=L.find(V=>V.active),X=L.find(V=>V.id===v),F=[j,X,...L].filter(Boolean).map(V=>V.ref.current);sie(F,u)}}I.current=!1}),onBlur:Je(t.onBlur,()=>w(!1))})})}),rie="RovingFocusGroupItem",iie=y.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,...o}=t,a=_a(),c=s||a,l=bNe(rie,n),u=l.currentTabStopId===c,d=eie(n),{onFocusableItemAdd:f,onFocusableItemRemove:p}=l;return y.useEffect(()=>{if(r)return f(),()=>p()},[r,f,p]),b.jsx(E5.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:b.jsx(wt.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...o,ref:e,onMouseDown:Je(t.onMouseDown,m=>{r?l.onItemFocus(c):m.preventDefault()}),onFocus:Je(t.onFocus,()=>l.onItemFocus(c)),onKeyDown:Je(t.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){l.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const v=TNe(m,l.orientation,l.dir);if(v!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let _=d().filter(w=>w.focusable).map(w=>w.ref.current);if(v==="last")_.reverse();else if(v==="prev"||v==="next"){v==="prev"&&_.reverse();const w=_.indexOf(m.currentTarget);_=l.loop?CNe(_,w+1):_.slice(w+1)}setTimeout(()=>sie(_))}})})})});iie.displayName=rie;var wNe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ENe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function TNe(t,e,n){const r=ENe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return wNe[r]}function sie(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function CNe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var kNe=nie,RNe=iie,INe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},gg=new WeakMap,Vw=new WeakMap,qw={},$P=0,oie=function(t){return t&&(t.host||oie(t.parentNode))},xNe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=oie(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},PNe=function(t,e,n,r){var i=xNe(e,Array.isArray(t)?t:[t]);qw[n]||(qw[n]=new WeakMap);var s=qw[n],o=[],a=new Set,c=new Set(i),l=function(d){!d||a.has(d)||(a.add(d),l(d.parentNode))};i.forEach(l);var u=function(d){!d||c.has(d)||Array.prototype.forEach.call(d.children,function(f){if(a.has(f))u(f);else try{var p=f.getAttribute(r),m=p!==null&&p!=="false",v=(gg.get(f)||0)+1,S=(s.get(f)||0)+1;gg.set(f,v),s.set(f,S),o.push(f),v===1&&m&&Vw.set(f,!0),S===1&&f.setAttribute(n,"true"),m||f.setAttribute(r,"true")}catch(_){console.error("aria-hidden: cannot operate on ",f,_)}})};return u(e),a.clear(),$P++,function(){o.forEach(function(d){var f=gg.get(d)-1,p=s.get(d)-1;gg.set(d,f),s.set(d,p),f||(Vw.has(d)||d.removeAttribute(r),Vw.delete(d)),p||d.removeAttribute(n)}),$P--,$P||(gg=new WeakMap,gg=new WeakMap,Vw=new WeakMap,qw={})}},jD=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=INe(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),PNe(r,i,n,"aria-hidden")):function(){return null}},T5=function(t,e){return T5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},T5(t,e)};function yl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");T5(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Ji=function(){return Ji=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ji.apply(this,arguments)};function HD(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function ONe(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function aie(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function bv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nu(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function ll(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Lm(t){return this instanceof Lm?(this.v=t,this):new Lm(t)}function MNe(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(m){return Promise.resolve(m).then(p,d)}}function a(p,m){r[p]&&(i[p]=function(v){return new Promise(function(S,_){s.push([p,v,S,_])>1||c(p,v)})},m&&(i[p]=m(i[p])))}function c(p,m){try{l(r[p](m))}catch(v){f(s[0][3],v)}}function l(p){p.value instanceof Lm?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function f(p,m){p(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ANe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof bv=="function"?bv(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var _0="right-scroll-bar-position",b0="width-before-scroll-bar",LNe="with-scroll-bars-hidden",DNe="--removed-body-scroll-bar-size";function FP(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function NNe(t,e){var n=y.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var UNe=typeof window<"u"?y.useLayoutEffect:y.useEffect,ZK=new WeakMap;function cie(t,e){var n=NNe(null,function(r){return t.forEach(function(i){return FP(i,r)})});return UNe(function(){var r=ZK.get(n);if(r){var i=new Set(r),s=new Set(t),o=n.current;i.forEach(function(a){s.has(a)||FP(a,null)}),s.forEach(function(a){i.has(a)||FP(a,o)})}ZK.set(n,t)},[t]),n}function $Ne(t){return t}function FNe(t,e){e===void 0&&(e=$Ne);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,r);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var c=function(){var u=o;o=[],u.forEach(s)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(u){o.push(u),l()},filter:function(u){return o=o.filter(u),n}}}};return i}function lie(t){t===void 0&&(t={});var e=FNe(null);return e.options=Ji({async:!0,ssr:!1},t),e}var uie=function(t){var e=t.sideCar,n=HD(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return y.createElement(r,Ji({},n))};uie.isSideCarExport=!0;function die(t,e){return t.useMedium(e),uie}var fie=lie(),BP=function(){},zR=y.forwardRef(function(t,e){var n=y.useRef(null),r=y.useState({onScrollCapture:BP,onWheelCapture:BP,onTouchMoveCapture:BP}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,m=t.inert,v=t.allowPinchZoom,S=t.as,_=S===void 0?"div":S,w=t.gapMode,T=HD(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=f,I=cie([n,e]),R=Ji(Ji({},T),i);return y.createElement(y.Fragment,null,u&&y.createElement(C,{sideCar:fie,removeScrollBar:l,shards:d,noIsolation:p,inert:m,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:w}),o?y.cloneElement(y.Children.only(a),Ji(Ji({},R),{ref:I})):y.createElement(_,Ji({},R,{className:c,ref:I}),a))});zR.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};zR.classNames={fullWidth:b0,zeroRight:_0};var BNe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function jNe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=BNe();return e&&t.setAttribute("nonce",e),t}function HNe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function KNe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var VNe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=jNe())&&(HNe(e,n),KNe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},qNe=function(){var t=VNe();return function(e,n){y.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},KD=function(){var t=qNe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},GNe={left:0,top:0,right:0,gap:0},jP=function(t){return parseInt(t||"",10)||0},zNe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[jP(n),jP(r),jP(i)]},WNe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return GNe;var e=zNe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},YNe=KD(),Dm="data-scroll-locked",JNe=function(t,e,n,r){var i=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(LNe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Dm,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(_0,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(b0,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(_0," .").concat(_0,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(b0," .").concat(b0,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Dm,`] {
    `).concat(DNe,": ").concat(a,`px;
  }
`)},QK=function(){var t=parseInt(document.body.getAttribute(Dm)||"0",10);return isFinite(t)?t:0},XNe=function(){y.useEffect(function(){return document.body.setAttribute(Dm,(QK()+1).toString()),function(){var t=QK()-1;t<=0?document.body.removeAttribute(Dm):document.body.setAttribute(Dm,t.toString())}},[])},hie=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;XNe();var s=y.useMemo(function(){return WNe(i)},[i]);return y.createElement(YNe,{styles:JNe(s,!e,i,n?"":"!important")})},C5=!1;if(typeof window<"u")try{var Gw=Object.defineProperty({},"passive",{get:function(){return C5=!0,!0}});window.addEventListener("test",Gw,Gw),window.removeEventListener("test",Gw,Gw)}catch{C5=!1}var mg=C5?{passive:!1}:!1,ZNe=function(t){return t.tagName==="TEXTAREA"},pie=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!ZNe(t)&&n[e]==="visible")},QNe=function(t){return pie(t,"overflowY")},e9e=function(t){return pie(t,"overflowX")},eV=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=gie(t,r);if(i){var s=mie(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},t9e=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},n9e=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},gie=function(t,e){return t==="v"?QNe(e):e9e(e)},mie=function(t,e){return t==="v"?t9e(e):n9e(e)},r9e=function(t,e){return t==="h"&&e==="rtl"?-1:1},i9e=function(t,e,n,r,i){var s=r9e(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,u=o>0,d=0,f=0;do{var p=mie(t,a),m=p[0],v=p[1],S=p[2],_=v-S-s*m;(m||_)&&gie(t,a)&&(d+=_,f+=m),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!i)||!u&&(Math.abs(f)<1||!i))&&(l=!0),l},zw=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},tV=function(t){return[t.deltaX,t.deltaY]},nV=function(t){return t&&"current"in t?t.current:t},s9e=function(t,e){return t[0]===e[0]&&t[1]===e[1]},o9e=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},a9e=0,vg=[];function c9e(t){var e=y.useRef([]),n=y.useRef([0,0]),r=y.useRef(),i=y.useState(a9e++)[0],s=y.useState(KD)[0],o=y.useRef(t);y.useEffect(function(){o.current=t},[t]),y.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=ll([t.lockRef.current],(t.shards||[]).map(nV),!0).filter(Boolean);return v.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=y.useCallback(function(v,S){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!o.current.allowPinchZoom;var _=zw(v),w=n.current,T="deltaX"in v?v.deltaX:w[0]-_[0],C="deltaY"in v?v.deltaY:w[1]-_[1],I,R=v.target,O=Math.abs(T)>Math.abs(C)?"h":"v";if("touches"in v&&O==="h"&&R.type==="range")return!1;var A=eV(O,R);if(!A)return!0;if(A?I=O:(I=O==="v"?"h":"v",A=eV(O,R)),!A)return!1;if(!r.current&&"changedTouches"in v&&(T||C)&&(r.current=I),!I)return!0;var U=r.current||I;return i9e(U,S,v,U==="h"?T:C,!0)},[]),c=y.useCallback(function(v){var S=v;if(!(!vg.length||vg[vg.length-1]!==s)){var _="deltaY"in S?tV(S):zw(S),w=e.current.filter(function(I){return I.name===S.type&&(I.target===S.target||S.target===I.shadowParent)&&s9e(I.delta,_)})[0];if(w&&w.should){S.cancelable&&S.preventDefault();return}if(!w){var T=(o.current.shards||[]).map(nV).filter(Boolean).filter(function(I){return I.contains(S.target)}),C=T.length>0?a(S,T[0]):!o.current.noIsolation;C&&S.cancelable&&S.preventDefault()}}},[]),l=y.useCallback(function(v,S,_,w){var T={name:v,delta:S,target:_,should:w,shadowParent:l9e(_)};e.current.push(T),setTimeout(function(){e.current=e.current.filter(function(C){return C!==T})},1)},[]),u=y.useCallback(function(v){n.current=zw(v),r.current=void 0},[]),d=y.useCallback(function(v){l(v.type,tV(v),v.target,a(v,t.lockRef.current))},[]),f=y.useCallback(function(v){l(v.type,zw(v),v.target,a(v,t.lockRef.current))},[]);y.useEffect(function(){return vg.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,mg),document.addEventListener("touchmove",c,mg),document.addEventListener("touchstart",u,mg),function(){vg=vg.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,mg),document.removeEventListener("touchmove",c,mg),document.removeEventListener("touchstart",u,mg)}},[]);var p=t.removeScrollBar,m=t.inert;return y.createElement(y.Fragment,null,m?y.createElement(s,{styles:o9e(i)}):null,p?y.createElement(hie,{gapMode:t.gapMode}):null)}function l9e(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const u9e=die(fie,c9e);var VD=y.forwardRef(function(t,e){return y.createElement(zR,Ji({},t,{ref:e,sideCar:u9e}))});VD.classNames=zR.classNames;var k5=["Enter"," "],d9e=["ArrowDown","PageUp","Home"],vie=["ArrowUp","PageDown","End"],f9e=[...d9e,...vie],h9e={ltr:[...k5,"ArrowRight"],rtl:[...k5,"ArrowLeft"]},p9e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Bb="Menu",[A_,g9e,m9e]=DD(Bb),[Np,WR]=ADe(Bb,[m9e,qre,tie]),YR=qre(),yie=tie(),[v9e,Up]=Np(Bb),[y9e,jb]=Np(Bb),_ie=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=YR(e),[c,l]=y.useState(null),u=y.useRef(!1),d=Ia(s),f=ND(i);return y.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),b.jsx(aNe,{...a,children:b.jsx(v9e,{scope:e,open:n,onOpenChange:d,content:c,onContentChange:l,children:b.jsx(y9e,{scope:e,onClose:y.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:f,modal:o,children:r})})})};_ie.displayName=Bb;var _9e="MenuAnchor",qD=y.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=YR(n);return b.jsx(cNe,{...i,...r,ref:e})});qD.displayName=_9e;var GD="MenuPortal",[b9e,bie]=Np(GD,{forceMount:void 0}),Sie=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=Up(GD,e);return b.jsx(b9e,{scope:e,forceMount:n,children:b.jsx(Mf,{present:n||s.open,children:b.jsx(BD,{asChild:!0,container:i,children:r})})})};Sie.displayName=GD;var ba="MenuContent",[S9e,zD]=Np(ba),wie=y.forwardRef((t,e)=>{const n=bie(ba,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Up(ba,t.__scopeMenu),o=jb(ba,t.__scopeMenu);return b.jsx(A_.Provider,{scope:t.__scopeMenu,children:b.jsx(Mf,{present:r||s.open,children:b.jsx(A_.Slot,{scope:t.__scopeMenu,children:o.modal?b.jsx(w9e,{...i,ref:e}):b.jsx(E9e,{...i,ref:e})})})})}),w9e=y.forwardRef((t,e)=>{const n=Up(ba,t.__scopeMenu),r=y.useRef(null),i=cn(e,r);return y.useEffect(()=>{const s=r.current;if(s)return jD(s)},[]),b.jsx(WD,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Je(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),E9e=y.forwardRef((t,e)=>{const n=Up(ba,t.__scopeMenu);return b.jsx(WD,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),WD=y.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p,disableOutsideScroll:m,...v}=t,S=Up(ba,n),_=jb(ba,n),w=YR(n),T=yie(n),C=g9e(n),[I,R]=y.useState(null),O=y.useRef(null),A=cn(e,O,S.onContentChange),U=y.useRef(0),N=y.useRef(""),L=y.useRef(0),j=y.useRef(null),X=y.useRef("right"),G=y.useRef(0),F=m?VD:y.Fragment,V=m?{as:_f,allowPinchZoom:!0}:void 0,J=W=>{var ze,et;const Y=N.current+W,ce=C().filter(lt=>!lt.disabled),ue=document.activeElement,Te=(ze=ce.find(lt=>lt.ref.current===ue))==null?void 0:ze.textValue,Re=ce.map(lt=>lt.textValue),Oe=D9e(Re,Y,Te),De=(et=ce.find(lt=>lt.textValue===Oe))==null?void 0:et.ref.current;(function lt(Ae){N.current=Ae,window.clearTimeout(U.current),Ae!==""&&(U.current=window.setTimeout(()=>lt(""),1e3))})(Y),De&&setTimeout(()=>De.focus())};y.useEffect(()=>()=>window.clearTimeout(U.current),[]),UD();const K=y.useCallback(W=>{var ce,ue;return X.current===((ce=j.current)==null?void 0:ce.side)&&U9e(W,(ue=j.current)==null?void 0:ue.area)},[]);return b.jsx(S9e,{scope:n,searchRef:N,onItemEnter:y.useCallback(W=>{K(W)&&W.preventDefault()},[K]),onItemLeave:y.useCallback(W=>{var Y;K(W)||((Y=O.current)==null||Y.focus(),R(null))},[K]),onTriggerLeave:y.useCallback(W=>{K(W)&&W.preventDefault()},[K]),pointerGraceTimerRef:L,onPointerGraceIntentChange:y.useCallback(W=>{j.current=W},[]),children:b.jsx(F,{...V,children:b.jsx(qR,{asChild:!0,trapped:i,onMountAutoFocus:Je(s,W=>{var Y;W.preventDefault(),(Y=O.current)==null||Y.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:b.jsx(VR,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p,children:b.jsx(kNe,{asChild:!0,...T,dir:_.dir,orientation:"vertical",loop:r,currentTabStopId:I,onCurrentTabStopIdChange:R,onEntryFocus:Je(c,W=>{_.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:b.jsx(lNe,{role:"menu","aria-orientation":"vertical","data-state":$ie(S.open),"data-radix-menu-content":"",dir:_.dir,...w,...v,ref:A,style:{outline:"none",...v.style},onKeyDown:Je(v.onKeyDown,W=>{const ce=W.target.closest("[data-radix-menu-content]")===W.currentTarget,ue=W.ctrlKey||W.altKey||W.metaKey,Te=W.key.length===1;ce&&(W.key==="Tab"&&W.preventDefault(),!ue&&Te&&J(W.key));const Re=O.current;if(W.target!==Re||!f9e.includes(W.key))return;W.preventDefault();const De=C().filter(ze=>!ze.disabled).map(ze=>ze.ref.current);vie.includes(W.key)&&De.reverse(),A9e(De)}),onBlur:Je(t.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(U.current),N.current="")}),onPointerMove:Je(t.onPointerMove,L_(W=>{const Y=W.target,ce=G.current!==W.clientX;if(W.currentTarget.contains(Y)&&ce){const ue=W.clientX>G.current?"right":"left";X.current=ue,G.current=W.clientX}}))})})})})})})});wie.displayName=ba;var T9e="MenuGroup",YD=y.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return b.jsx(wt.div,{role:"group",...r,ref:e})});YD.displayName=T9e;var C9e="MenuLabel",Eie=y.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return b.jsx(wt.div,{...r,ref:e})});Eie.displayName=C9e;var Sk="MenuItem",rV="menu.itemSelect",JR=y.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=y.useRef(null),o=jb(Sk,t.__scopeMenu),a=zD(Sk,t.__scopeMenu),c=cn(e,s),l=y.useRef(!1),u=()=>{const d=s.current;if(!n&&d){const f=new CustomEvent(rV,{bubbles:!0,cancelable:!0});d.addEventListener(rV,p=>r==null?void 0:r(p),{once:!0}),$re(d,f),f.defaultPrevented?l.current=!1:o.onClose()}};return b.jsx(Tie,{...i,ref:c,disabled:n,onClick:Je(t.onClick,u),onPointerDown:d=>{var f;(f=t.onPointerDown)==null||f.call(t,d),l.current=!0},onPointerUp:Je(t.onPointerUp,d=>{var f;l.current||(f=d.currentTarget)==null||f.click()}),onKeyDown:Je(t.onKeyDown,d=>{const f=a.searchRef.current!=="";n||f&&d.key===" "||k5.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});JR.displayName=Sk;var Tie=y.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=zD(Sk,n),a=yie(n),c=y.useRef(null),l=cn(e,c),[u,d]=y.useState(!1),[f,p]=y.useState("");return y.useEffect(()=>{const m=c.current;m&&p((m.textContent??"").trim())},[s.children]),b.jsx(A_.ItemSlot,{scope:n,disabled:r,textValue:i??f,children:b.jsx(RNe,{asChild:!0,...a,focusable:!r,children:b.jsx(wt.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:Je(t.onPointerMove,L_(m=>{r?o.onItemLeave(m):(o.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Je(t.onPointerLeave,L_(m=>o.onItemLeave(m))),onFocus:Je(t.onFocus,()=>d(!0)),onBlur:Je(t.onBlur,()=>d(!1))})})})}),k9e="MenuCheckboxItem",Cie=y.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return b.jsx(Pie,{scope:t.__scopeMenu,checked:n,children:b.jsx(JR,{role:"menuitemcheckbox","aria-checked":wk(n)?"mixed":n,...i,ref:e,"data-state":XD(n),onSelect:Je(i.onSelect,()=>r==null?void 0:r(wk(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Cie.displayName=k9e;var kie="MenuRadioGroup",[R9e,I9e]=Np(kie,{value:void 0,onValueChange:()=>{}}),Rie=y.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=Ia(r);return b.jsx(R9e,{scope:t.__scopeMenu,value:n,onValueChange:s,children:b.jsx(YD,{...i,ref:e})})});Rie.displayName=kie;var Iie="MenuRadioItem",xie=y.forwardRef((t,e)=>{const{value:n,...r}=t,i=I9e(Iie,t.__scopeMenu),s=n===i.value;return b.jsx(Pie,{scope:t.__scopeMenu,checked:s,children:b.jsx(JR,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":XD(s),onSelect:Je(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,n)},{checkForDefaultPrevented:!1})})})});xie.displayName=Iie;var JD="MenuItemIndicator",[Pie,x9e]=Np(JD,{checked:!1}),Oie=y.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=x9e(JD,n);return b.jsx(Mf,{present:r||wk(s.checked)||s.checked===!0,children:b.jsx(wt.span,{...i,ref:e,"data-state":XD(s.checked)})})});Oie.displayName=JD;var P9e="MenuSeparator",Mie=y.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return b.jsx(wt.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});Mie.displayName=P9e;var O9e="MenuArrow",Aie=y.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=YR(n);return b.jsx(uNe,{...i,...r,ref:e})});Aie.displayName=O9e;var M9e="MenuSub",[oht,Lie]=Np(M9e),$1="MenuSubTrigger",Die=y.forwardRef((t,e)=>{const n=Up($1,t.__scopeMenu),r=jb($1,t.__scopeMenu),i=Lie($1,t.__scopeMenu),s=zD($1,t.__scopeMenu),o=y.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:t.__scopeMenu},u=y.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return y.useEffect(()=>u,[u]),y.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),c(null)}},[a,c]),b.jsx(qD,{asChild:!0,...l,children:b.jsx(Tie,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":$ie(n.open),...t,ref:KR(e,i.onTriggerChange),onClick:d=>{var f;(f=t.onClick)==null||f.call(t,d),!(t.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Je(t.onPointerMove,L_(d=>{s.onItemEnter(d),!d.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Je(t.onPointerLeave,L_(d=>{var p,m;u();const f=(p=n.content)==null?void 0:p.getBoundingClientRect();if(f){const v=(m=n.content)==null?void 0:m.dataset.side,S=v==="right",_=S?-5:5,w=f[S?"left":"right"],T=f[S?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+_,y:d.clientY},{x:w,y:f.top},{x:T,y:f.top},{x:T,y:f.bottom},{x:w,y:f.bottom}],side:v}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Je(t.onKeyDown,d=>{var p;const f=s.searchRef.current!=="";t.disabled||f&&d.key===" "||h9e[r.dir].includes(d.key)&&(n.onOpenChange(!0),(p=n.content)==null||p.focus(),d.preventDefault())})})})});Die.displayName=$1;var Nie="MenuSubContent",Uie=y.forwardRef((t,e)=>{const n=bie(ba,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=Up(ba,t.__scopeMenu),o=jb(ba,t.__scopeMenu),a=Lie(Nie,t.__scopeMenu),c=y.useRef(null),l=cn(e,c);return b.jsx(A_.Provider,{scope:t.__scopeMenu,children:b.jsx(Mf,{present:r||s.open,children:b.jsx(A_.Slot,{scope:t.__scopeMenu,children:b.jsx(WD,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;o.isUsingKeyboardRef.current&&((d=c.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Je(t.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Je(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:Je(t.onKeyDown,u=>{var p;const d=u.currentTarget.contains(u.target),f=p9e[o.dir].includes(u.key);d&&f&&(s.onOpenChange(!1),(p=a.trigger)==null||p.focus(),u.preventDefault())})})})})})});Uie.displayName=Nie;function $ie(t){return t?"open":"closed"}function wk(t){return t==="indeterminate"}function XD(t){return wk(t)?"indeterminate":t?"checked":"unchecked"}function A9e(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function L9e(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function D9e(t,e,n){const i=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=L9e(t,Math.max(s,0));i.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function N9e(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,c=e[s].y,l=e[o].x,u=e[o].y;c>r!=u>r&&n<(l-a)*(r-c)/(u-c)+a&&(i=!i)}return i}function U9e(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return N9e(n,e)}function L_(t){return e=>e.pointerType==="mouse"?t(e):void 0}var Fie=_ie,Bie=qD,jie=Sie,Hie=wie,Kie=YD,Vie=Eie,qie=JR,Gie=Cie,zie=Rie,Wie=xie,Yie=Oie,Jie=Mie,Xie=Aie,Zie=Die,Qie=Uie,ZD="ContextMenu",[$9e,aht]=EDe(ZD,[WR]),Ts=WR(),[F9e,ese]=$9e(ZD),tse=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:s=!0}=t,[o,a]=y.useState(!1),c=Ts(e),l=Ia(r),u=y.useCallback(d=>{a(d),l(d)},[l]);return b.jsx(F9e,{scope:e,open:o,onOpenChange:u,modal:s,children:b.jsx(Fie,{...c,dir:i,open:o,onOpenChange:u,modal:s,children:n})})};tse.displayName=ZD;var nse="ContextMenuTrigger",rse=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,s=ese(nse,n),o=Ts(n),a=y.useRef({x:0,y:0}),c=y.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=y.useRef(0),u=y.useCallback(()=>window.clearTimeout(l.current),[]),d=f=>{a.current={x:f.clientX,y:f.clientY},s.onOpenChange(!0)};return y.useEffect(()=>u,[u]),y.useEffect(()=>void(r&&u()),[r,u]),b.jsxs(b.Fragment,{children:[b.jsx(Bie,{...o,virtualRef:c}),b.jsx(wt.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:Je(t.onContextMenu,f=>{u(),d(f),f.preventDefault()}),onPointerDown:r?t.onPointerDown:Je(t.onPointerDown,Ww(f=>{u(),l.current=window.setTimeout(()=>d(f),700)})),onPointerMove:r?t.onPointerMove:Je(t.onPointerMove,Ww(u)),onPointerCancel:r?t.onPointerCancel:Je(t.onPointerCancel,Ww(u)),onPointerUp:r?t.onPointerUp:Je(t.onPointerUp,Ww(u))})]})});rse.displayName=nse;var B9e="ContextMenuPortal",ise=t=>{const{__scopeContextMenu:e,...n}=t,r=Ts(e);return b.jsx(jie,{...r,...n})};ise.displayName=B9e;var sse="ContextMenuContent",ose=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=ese(sse,n),s=Ts(n),o=y.useRef(!1);return b.jsx(Hie,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=t.onCloseAutoFocus)==null||c.call(t,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var c;(c=t.onInteractOutside)==null||c.call(t,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ose.displayName=sse;var j9e="ContextMenuGroup",H9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Kie,{...i,...r,ref:e})});H9e.displayName=j9e;var K9e="ContextMenuLabel",V9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Vie,{...i,...r,ref:e})});V9e.displayName=K9e;var q9e="ContextMenuItem",ase=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(qie,{...i,...r,ref:e})});ase.displayName=q9e;var G9e="ContextMenuCheckboxItem",z9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Gie,{...i,...r,ref:e})});z9e.displayName=G9e;var W9e="ContextMenuRadioGroup",Y9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(zie,{...i,...r,ref:e})});Y9e.displayName=W9e;var J9e="ContextMenuRadioItem",X9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Wie,{...i,...r,ref:e})});X9e.displayName=J9e;var Z9e="ContextMenuItemIndicator",Q9e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Yie,{...i,...r,ref:e})});Q9e.displayName=Z9e;var e7e="ContextMenuSeparator",t7e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Jie,{...i,...r,ref:e})});t7e.displayName=e7e;var n7e="ContextMenuArrow",r7e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Xie,{...i,...r,ref:e})});r7e.displayName=n7e;var i7e="ContextMenuSubTrigger",s7e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Zie,{...i,...r,ref:e})});s7e.displayName=i7e;var o7e="ContextMenuSubContent",a7e=y.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ts(n);return b.jsx(Qie,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});a7e.displayName=o7e;function Ww(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var iV=tse,c7e=rse,l7e=ise,u7e=ose;function d7e(t,e){const n=y.createContext(e),r=s=>{const{children:o,...a}=s,c=y.useMemo(()=>a,Object.values(a));return b.jsx(n.Provider,{value:c,children:o})};r.displayName=t+"Provider";function i(s){const o=y.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,i]}function f7e(t,e=[]){let n=[];function r(s,o){const a=y.createContext(o),c=n.length;n=[...n,o];const l=d=>{var _;const{scope:f,children:p,...m}=d,v=((_=f==null?void 0:f[t])==null?void 0:_[c])||a,S=y.useMemo(()=>m,Object.values(m));return b.jsx(v.Provider,{value:S,children:p})};l.displayName=s+"Provider";function u(d,f){var v;const p=((v=f==null?void 0:f[t])==null?void 0:v[c])||a,m=y.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const i=()=>{const s=n.map(o=>y.createContext(o));return function(a){const c=(a==null?void 0:a[t])||s;return y.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,h7e(i,...e)]}function h7e(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var QD="Dialog",[cse,cht]=f7e(QD),[p7e,vc]=cse(QD),lse=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=y.useRef(null),c=y.useRef(null),[l=!1,u]=Fb({prop:r,defaultProp:i,onChange:s});return b.jsx(p7e,{scope:e,triggerRef:a,contentRef:c,contentId:_a(),titleId:_a(),descriptionId:_a(),open:l,onOpenChange:u,onOpenToggle:y.useCallback(()=>u(d=>!d),[u]),modal:o,children:n})};lse.displayName=QD;var use="DialogTrigger",dse=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=vc(use,n),s=cn(e,i.triggerRef);return b.jsx(wt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":nN(i.open),...r,ref:s,onClick:Je(t.onClick,i.onOpenToggle)})});dse.displayName=use;var eN="DialogPortal",[g7e,fse]=cse(eN,{forceMount:void 0}),hse=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=vc(eN,e);return b.jsx(g7e,{scope:e,forceMount:n,children:y.Children.map(r,o=>b.jsx(Mf,{present:n||s.open,children:b.jsx(BD,{asChild:!0,container:i,children:o})}))})};hse.displayName=eN;var Ek="DialogOverlay",pse=y.forwardRef((t,e)=>{const n=fse(Ek,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=vc(Ek,t.__scopeDialog);return s.modal?b.jsx(Mf,{present:r||s.open,children:b.jsx(m7e,{...i,ref:e})}):null});pse.displayName=Ek;var m7e=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=vc(Ek,n);return b.jsx(VD,{as:_f,allowPinchZoom:!0,shards:[i.contentRef],children:b.jsx(wt.div,{"data-state":nN(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),pp="DialogContent",gse=y.forwardRef((t,e)=>{const n=fse(pp,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=vc(pp,t.__scopeDialog);return b.jsx(Mf,{present:r||s.open,children:s.modal?b.jsx(v7e,{...i,ref:e}):b.jsx(y7e,{...i,ref:e})})});gse.displayName=pp;var v7e=y.forwardRef((t,e)=>{const n=vc(pp,t.__scopeDialog),r=y.useRef(null),i=cn(e,n.contentRef,r);return y.useEffect(()=>{const s=r.current;if(s)return jD(s)},[]),b.jsx(mse,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Je(t.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Je(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Je(t.onFocusOutside,s=>s.preventDefault())})}),y7e=y.forwardRef((t,e)=>{const n=vc(pp,t.__scopeDialog),r=y.useRef(!1),i=y.useRef(!1);return b.jsx(mse,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var c,l;(c=t.onInteractOutside)==null||c.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((l=n.triggerRef.current)==null?void 0:l.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),mse=y.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=vc(pp,n),c=y.useRef(null),l=cn(e,c);return UD(),b.jsxs(b.Fragment,{children:[b.jsx(qR,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:b.jsx(VR,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":nN(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(_7e,{titleId:a.titleId}),b.jsx(S7e,{contentRef:c,descriptionId:a.descriptionId})]})]})}),tN="DialogTitle",vse=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=vc(tN,n);return b.jsx(wt.h2,{id:i.titleId,...r,ref:e})});vse.displayName=tN;var yse="DialogDescription",_se=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=vc(yse,n);return b.jsx(wt.p,{id:i.descriptionId,...r,ref:e})});_se.displayName=yse;var bse="DialogClose",Sse=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=vc(bse,n);return b.jsx(wt.button,{type:"button",...r,ref:e,onClick:Je(t.onClick,()=>i.onOpenChange(!1))})});Sse.displayName=bse;function nN(t){return t?"open":"closed"}var wse="DialogTitleWarning",[lht,Ese]=d7e(wse,{contentName:pp,titleName:tN,docsSlug:"dialog"}),_7e=({titleId:t})=>{const e=Ese(wse),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return y.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},b7e="DialogDescriptionWarning",S7e=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Ese(b7e).contentName}}.`;return y.useEffect(()=>{var s;const i=(s=t.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},w7e=lse,E7e=dse,T7e=hse,C7e=pse,k7e=gse,R7e=vse,I7e=_se,x7e=Sse;function P7e(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const Tse=re.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),sy=()=>{const t=re.useContext(Tse);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};P7e(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const O7e=24,M7e=typeof window<"u"?y.useLayoutEffect:y.useEffect;function sV(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}function A7e(){return rN(/^Mac/)}function L7e(){return rN(/^iPhone/)}function oV(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function D7e(){return rN(/^iPad/)||A7e()&&navigator.maxTouchPoints>1}function Cse(){return L7e()||D7e()}function rN(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const HP=typeof document<"u"&&window.visualViewport;function aV(t){let e=window.getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function kse(t){for(aV(t)&&(t=t.parentElement);t&&!aV(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const N7e=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Yw=0,KP;function U7e(t={}){let{isDisabled:e}=t;M7e(()=>{if(!e)return Yw++,Yw===1&&Cse()&&(KP=$7e()),()=>{Yw--,Yw===0&&(KP==null||KP())}},[e])}function $7e(){let t,e=0,n=d=>{t=kse(d.target),!(t===document.documentElement&&t===document.body)&&(e=d.changedTouches[0].pageY)},r=d=>{if(!t||t===document.documentElement||t===document.body){d.preventDefault();return}let f=d.changedTouches[0].pageY,p=t.scrollTop,m=t.scrollHeight-t.clientHeight;m!==0&&((p<=0&&f>e||p>=m&&f<e)&&d.preventDefault(),e=f)},i=d=>{let f=d.target;R5(f)&&f!==document.activeElement&&(d.preventDefault(),f.style.transform="translateY(-2000px)",f.focus(),requestAnimationFrame(()=>{f.style.transform=""}))},s=d=>{let f=d.target;R5(f)&&(f.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{f.style.transform="",HP&&(HP.height<window.innerHeight?requestAnimationFrame(()=>{cV(f)}):HP.addEventListener("resize",()=>cV(f),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,c=window.pageYOffset,l=sV(F7e(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=sV(r1(document,"touchstart",n,{passive:!1,capture:!0}),r1(document,"touchmove",r,{passive:!1,capture:!0}),r1(document,"touchend",i,{passive:!1,capture:!0}),r1(document,"focus",s,!0),r1(window,"scroll",o));return()=>{l(),u(),window.scrollTo(a,c)}}function F7e(t,e,n){let r=t.style[e];return t.style[e]=n,()=>{t.style[e]=r}}function r1(t,e,n,r){return t.addEventListener(e,n,r),()=>{t.removeEventListener(e,n,r)}}function cV(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=kse(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+O7e;s>o&&(n.scrollTop+=i-r)}t=n.parentElement}}function R5(t){return t instanceof HTMLInputElement&&!N7e.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function B7e(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function j7e(...t){return e=>t.forEach(n=>B7e(n,e))}function Rse(...t){return y.useCallback(j7e(...t),t)}const Ise=new WeakMap;function $r(t,e,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){t.style.setProperty(i,s);return}r[i]=t.style[i],t.style[i]=s}),!n&&Ise.set(t,r)}function H7e(t,e){if(!t||!(t instanceof HTMLElement))return;let n=Ise.get(t);n&&(t.style[e]=n[e])}const Fr=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function Jw(t,e){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[Fr(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[Fr(e)?5:4]):null)}function K7e(t){return 8*(Math.log(t+1)-2)}function VP(t,e){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,e),()=>{t.style.cssText=n}}function V7e(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}const er={DURATION:.5,EASE:[.32,.72,0,1]},xse=.4,q7e=.25,G7e=100,Pse=8,Zf=16,I5=26,qP="vaul-dragging";function Ose(t){const e=re.useRef(t);return re.useEffect(()=>{e.current=t}),re.useMemo(()=>(...n)=>e.current==null?void 0:e.current.call(e,...n),[])}function z7e({defaultProp:t,onChange:e}){const n=re.useState(t),[r]=n,i=re.useRef(r),s=Ose(e);return re.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function Mse({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=z7e({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Ose(n),c=re.useCallback(l=>{if(s){const d=typeof l=="function"?l(t):l;d!==t&&a(d)}else i(l)},[s,t,i,a]);return[o,c]}function W7e({activeSnapPointProp:t,setActiveSnapPointProp:e,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom",container:c,snapToSequentialPoint:l}){const[u,d]=Mse({prop:t,defaultProp:n==null?void 0:n[0],onChange:e}),[f,p]=re.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);re.useEffect(()=>{function O(){p({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",O),()=>window.removeEventListener("resize",O)},[]);const m=re.useMemo(()=>u===(n==null?void 0:n[n.length-1])||null,[n,u]),v=re.useMemo(()=>n==null?void 0:n.findIndex(O=>O===u),[n,u]),S=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===u||!n,_=re.useMemo(()=>{const O=c?{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var A;return(A=n==null?void 0:n.map(U=>{const N=typeof U=="string";let L=0;if(N&&(L=parseInt(U,10)),Fr(a)){const X=N?L:f?U*O.height:0;return f?a==="bottom"?O.height-X:-O.height+X:X}const j=N?L:f?U*O.width:0;return f?a==="right"?O.width-j:-O.width+j:j}))!=null?A:[]},[n,f,c]),w=re.useMemo(()=>v!==null?_==null?void 0:_[v]:null,[_,v]),T=re.useCallback(O=>{var A;const U=(A=_==null?void 0:_.findIndex(N=>N===O))!=null?A:null;o(U),$r(r.current,{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:Fr(a)?`translate3d(0, ${O}px, 0)`:`translate3d(${O}px, 0, 0)`}),_&&U!==_.length-1&&U!==s&&U<s?$r(i.current,{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"0"}):$r(i.current,{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"1"}),d(n==null?void 0:n[Math.max(U,0)])},[r.current,n,_,s,i,d]);re.useEffect(()=>{if(u||t){var O;const A=(O=n==null?void 0:n.findIndex(U=>U===t||U===u))!=null?O:-1;_&&A!==-1&&typeof _[A]=="number"&&T(_[A])}},[u,t,n,_,T]);function C({draggedDistance:O,closeDrawer:A,velocity:U,dismissible:N}){if(s===void 0)return;const L=a==="bottom"||a==="right"?(w??0)-O:(w??0)+O,j=v===s-1,X=v===0,G=O>0;if(j&&$r(i.current,{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`}),!l&&U>2&&!G){N?A():T(_[0]);return}if(!l&&U>2&&G&&_&&n){T(_[n.length-1]);return}const F=_==null?void 0:_.reduce((J,K)=>typeof J!="number"||typeof K!="number"?J:Math.abs(K-L)<Math.abs(J-L)?K:J),V=Fr(a)?window.innerHeight:window.innerWidth;if(U>xse&&Math.abs(O)<V*.4){const J=G?1:-1;if(J>0&&m){T(_[n.length-1]);return}if(X&&J<0&&N&&A(),v===null)return;T(_[v+J]);return}T(F)}function I({draggedDistance:O}){if(w===null)return;const A=a==="bottom"||a==="right"?w-O:w+O;(a==="bottom"||a==="right")&&A<_[_.length-1]||(a==="top"||a==="left")&&A>_[_.length-1]||$r(r.current,{transform:Fr(a)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})}function R(O,A){if(!n||typeof v!="number"||!_||s===void 0)return null;const U=v===s-1;if(v>=s&&A)return 0;if(U&&!A)return 1;if(!S&&!U)return null;const L=U?v+1:v-1,j=U?_[L]-_[L-1]:_[L+1]-_[L],X=O/Math.abs(j);return U?1-X:X}return{isLastSnapPoint:m,activeSnapPoint:u,shouldFade:S,getPercentageDragged:R,setActiveSnapPoint:d,activeSnapPointIndex:v,onRelease:C,onDrag:I,snapPointsOffset:_}}const Y7e=()=>()=>{};function J7e(){const{direction:t,isOpen:e,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=sy(),s=re.useRef(null),o=y.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-I5)/window.innerWidth}re.useEffect(()=>{if(e&&n){s.current&&clearTimeout(s.current);const c=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!c)return;V7e(r&&!i?VP(document.body,{background:"black"}):Y7e,VP(c,{transformOrigin:Fr(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${er.DURATION}s`,transitionTimingFunction:`cubic-bezier(${er.EASE.join(",")})`}));const l=VP(c,{borderRadius:`${Pse}px`,overflow:"hidden",...Fr(t)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{l(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},er.DURATION*1e3)}}},[e,n,o])}let i1=null;function X7e({isOpen:t,modal:e,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=re.useState(()=>typeof window<"u"?window.location.href:""),c=re.useRef(0),l=re.useCallback(()=>{if(oV()&&i1===null&&t&&!s){i1={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:d,innerHeight:f}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-d}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const p=f-window.innerHeight;p&&c.current>=f&&(document.body.style.top=`${-(c.current+p)}px`)}),300)}},[t]),u=re.useCallback(()=>{if(oV()&&i1!==null&&!s){const d=-parseInt(document.body.style.top,10),f=-parseInt(document.body.style.left,10);Object.assign(document.body.style,i1),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(f,d)}),i1=null}},[o]);return re.useEffect(()=>{function d(){c.current=window.scrollY}return d(),window.addEventListener("scroll",d),()=>{window.removeEventListener("scroll",d)}},[]),re.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&l(),e||window.setTimeout(()=>{u()},500)):u())},[t,r,o,e,n,l,u]),{restorePositionSetting:u}}function Ase({open:t,onOpenChange:e,children:n,onDrag:r,onRelease:i,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:a=!0,closeThreshold:c=q7e,scrollLockTimeout:l=G7e,dismissible:u=!0,handleOnly:d=!1,fadeFromIndex:f=s&&s.length-1,activeSnapPoint:p,setActiveSnapPoint:m,fixed:v,modal:S=!0,onClose:_,nested:w,noBodyStyles:T,direction:C="bottom",defaultOpen:I=!1,disablePreventScroll:R=!0,snapToSequentialPoint:O=!1,preventScrollRestoration:A=!1,repositionInputs:U=!0,onAnimationEnd:N,container:L,autoFocus:j=!1}){var X,G;const[F=!1,V]=Mse({defaultProp:I,prop:t,onChange:_e=>{e==null||e(_e),!_e&&!w&&_c(),setTimeout(()=>{N==null||N(_e)},er.DURATION*1e3),_e&&!S&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),_e||(document.body.style.pointerEvents="auto")}}),[J,K]=re.useState(!1),[W,Y]=re.useState(!1),[ce,ue]=re.useState(!1),Te=re.useRef(null),Re=re.useRef(null),Oe=re.useRef(null),De=re.useRef(null),ze=re.useRef(null),et=re.useRef(!1),lt=re.useRef(null),Ae=re.useRef(0),yn=re.useRef(!1),un=re.useRef(0),je=re.useRef(null),Bt=re.useRef(((X=je.current)==null?void 0:X.getBoundingClientRect().height)||0),_n=re.useRef(((G=je.current)==null?void 0:G.getBoundingClientRect().width)||0),Jn=re.useRef(0),nn=re.useCallback(_e=>{s&&_e===dn.length-1&&(Re.current=new Date)},[]),{activeSnapPoint:Mr,activeSnapPointIndex:kn,setActiveSnapPoint:Di,onRelease:ar,snapPointsOffset:dn,onDrag:Xe,shouldFade:Rn,getPercentageDragged:At}=W7e({snapPoints:s,activeSnapPointProp:p,setActiveSnapPointProp:m,drawerRef:je,fadeFromIndex:f,overlayRef:Te,onSnapPointChange:nn,direction:C,container:L,snapToSequentialPoint:O});U7e({isDisabled:!F||W||!S||ce||!J||!U||!R});const{restorePositionSetting:_c}=X7e({isOpen:F,modal:S,nested:w,hasBeenOpened:J,preventScrollRestoration:A,noBodyStyles:T});function $(){return(window.innerWidth-I5)/window.innerWidth}function x(_e){var nt,ut;!u&&!s||je.current&&!je.current.contains(_e.target)||(Bt.current=((nt=je.current)==null?void 0:nt.getBoundingClientRect().height)||0,_n.current=((ut=je.current)==null?void 0:ut.getBoundingClientRect().width)||0,Y(!0),Oe.current=new Date,Cse()&&window.addEventListener("touchend",()=>et.current=!1,{once:!0}),_e.target.setPointerCapture(_e.pointerId),Ae.current=Fr(C)?_e.pageY:_e.pageX)}function M(_e,nt){var ut,Et;let yt=_e;const Xn=(ut=window.getSelection())==null?void 0:ut.toString(),cr=je.current?Jw(je.current,C):null,Zn=new Date;if(yt.hasAttribute("data-vaul-no-drag")||yt.closest("[data-vaul-no-drag]"))return!1;if(C==="right"||C==="left")return!0;if(Re.current&&Zn.getTime()-Re.current.getTime()<500)return!1;if(cr!==null&&(C==="bottom"?cr>0:cr<0))return!0;if(Xn&&Xn.length>0)return!1;if(Zn.getTime()-((Et=ze.current)==null?void 0:Et.getTime())<l&&cr===0||nt)return ze.current=Zn,!1;for(;yt;){if(yt.scrollHeight>yt.clientHeight){if(yt.scrollTop!==0)return ze.current=new Date,!1;if(yt.getAttribute("role")==="dialog")return!0}yt=yt.parentNode}return!0}function q(_e){if(je.current&&W){const nt=C==="bottom"||C==="right"?1:-1,ut=(Ae.current-(Fr(C)?_e.pageY:_e.pageX))*nt,Et=ut>0,yt=s&&!u&&!Et;if(yt&&kn===0)return;const Xn=Math.abs(ut),cr=document.querySelector("[data-vaul-drawer-wrapper]"),Zn=C==="bottom"||C==="top"?Bt.current:_n.current;let Wr=Xn/Zn;const io=At(Xn,Et);if(io!==null&&(Wr=io),yt&&Wr>=1||!et.current&&!M(_e.target,Et))return;if(je.current.classList.add(qP),et.current=!0,$r(je.current,{transition:"none"}),$r(Te.current,{transition:"none"}),s&&Xe({draggedDistance:ut}),Et&&!s){const Bo=K7e(ut),Gp=Math.min(Bo*-1,0)*nt;$r(je.current,{transform:Fr(C)?`translate3d(0, ${Gp}px, 0)`:`translate3d(${Gp}px, 0, 0)`});return}const bc=1-Wr;if((Rn||f&&kn===f-1)&&(r==null||r(_e,Wr),$r(Te.current,{opacity:`${bc}`,transition:"none"},!0)),cr&&Te.current&&o){const Bo=Math.min($()+Wr*(1-$()),1),Gp=8-Wr*8,zp=Math.max(0,14-Wr*14);$r(cr,{borderRadius:`${Gp}px`,transform:Fr(C)?`scale(${Bo}) translate3d(0, ${zp}px, 0)`:`scale(${Bo}) translate3d(${zp}px, 0, 0)`,transition:"none"},!0)}if(!s){const Bo=Xn*nt;$r(je.current,{transform:Fr(C)?`translate3d(0, ${Bo}px, 0)`:`translate3d(${Bo}px, 0, 0)`})}}}re.useEffect(()=>{var _e;function nt(){if(!je.current||!U)return;const ut=document.activeElement;if(R5(ut)||yn.current){var Et;const yt=((Et=window.visualViewport)==null?void 0:Et.height)||0,Xn=window.innerHeight;let cr=Xn-yt;const Zn=je.current.getBoundingClientRect().height||0,Wr=Zn>Xn*.8;Jn.current||(Jn.current=Zn);const io=je.current.getBoundingClientRect().top;if(Math.abs(un.current-cr)>60&&(yn.current=!yn.current),s&&s.length>0&&dn&&kn){const bc=dn[kn]||0;cr+=bc}if(un.current=cr,Zn>yt||yn.current){const bc=je.current.getBoundingClientRect().height;let Bo=bc;bc>yt&&(Bo=yt-(Wr?io:I5)),v?je.current.style.height=`${bc-Math.max(cr,0)}px`:je.current.style.height=`${Math.max(Bo,yt-io)}px`}else je.current.style.height=`${Jn.current}px`;s&&s.length>0&&!yn.current?je.current.style.bottom="0px":je.current.style.bottom=`${Math.max(cr,0)}px`}}return(_e=window.visualViewport)==null||_e.addEventListener("resize",nt),()=>{var ut;return(ut=window.visualViewport)==null?void 0:ut.removeEventListener("resize",nt)}},[kn,s,dn]);function ee(_e){ge(),_==null||_(),_e||V(!1),setTimeout(()=>{s&&Di(s[0])},er.DURATION*1e3)}function ae(){if(!je.current)return;const _e=document.querySelector("[data-vaul-drawer-wrapper]"),nt=Jw(je.current,C);$r(je.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`}),$r(Te.current,{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"1"}),o&&nt&&nt>0&&F&&$r(_e,{borderRadius:`${Pse}px`,overflow:"hidden",...Fr(C)?{transform:`scale(${$()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${$()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${er.DURATION}s`,transitionTimingFunction:`cubic-bezier(${er.EASE.join(",")})`},!0)}function ge(){!W||!je.current||(je.current.classList.remove(qP),et.current=!1,Y(!1),De.current=new Date)}function dt(_e){if(!W||!je.current)return;je.current.classList.remove(qP),et.current=!1,Y(!1),De.current=new Date;const nt=Jw(je.current,C);if(!M(_e.target,!1)||!nt||Number.isNaN(nt)||Oe.current===null)return;const ut=De.current.getTime()-Oe.current.getTime(),Et=Ae.current-(Fr(C)?_e.pageY:_e.pageX),yt=Math.abs(Et)/ut;if(yt>.05&&(ue(!0),setTimeout(()=>{ue(!1)},200)),s){ar({draggedDistance:Et*(C==="bottom"||C==="right"?1:-1),closeDrawer:ee,velocity:yt,dismissible:u}),i==null||i(_e,!0);return}if(C==="bottom"||C==="right"?Et>0:Et<0){ae(),i==null||i(_e,!0);return}if(yt>xse){ee(),i==null||i(_e,!1);return}var Xn;const cr=Math.min((Xn=je.current.getBoundingClientRect().height)!=null?Xn:0,window.innerHeight);var Zn;const Wr=Math.min((Zn=je.current.getBoundingClientRect().width)!=null?Zn:0,window.innerWidth),io=C==="left"||C==="right";if(Math.abs(nt)>=(io?Wr:cr)*c){ee(),i==null||i(_e,!1);return}i==null||i(_e,!0),ae()}re.useEffect(()=>(F&&($r(document.documentElement,{scrollBehavior:"auto"}),Re.current=new Date),()=>{H7e(document.documentElement,"scrollBehavior")}),[F]);function Ne(_e){const nt=_e?(window.innerWidth-Zf)/window.innerWidth:1,ut=_e?-Zf:0;lt.current&&window.clearTimeout(lt.current),$r(je.current,{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:`scale(${nt}) translate3d(0, ${ut}px, 0)`}),!_e&&je.current&&(lt.current=setTimeout(()=>{const Et=Jw(je.current,C);$r(je.current,{transition:"none",transform:Fr(C)?`translate3d(0, ${Et}px, 0)`:`translate3d(${Et}px, 0, 0)`})},500))}function Fe(_e,nt){if(nt<0)return;const ut=(window.innerWidth-Zf)/window.innerWidth,Et=ut+nt*(1-ut),yt=-Zf+nt*Zf;$r(je.current,{transform:Fr(C)?`scale(${Et}) translate3d(0, ${yt}px, 0)`:`scale(${Et}) translate3d(${yt}px, 0, 0)`,transition:"none"})}function tt(_e,nt){const ut=Fr(C)?window.innerHeight:window.innerWidth,Et=nt?(ut-Zf)/ut:1,yt=nt?-Zf:0;nt&&$r(je.current,{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:Fr(C)?`scale(${Et}) translate3d(0, ${yt}px, 0)`:`scale(${Et}) translate3d(${yt}px, 0, 0)`})}return re.createElement(w7e,{defaultOpen:I,onOpenChange:_e=>{!u&&!_e||(_e?K(!0):ee(!0),V(_e))},open:F},re.createElement(Tse.Provider,{value:{activeSnapPoint:Mr,snapPoints:s,setActiveSnapPoint:Di,drawerRef:je,overlayRef:Te,onOpenChange:e,onPress:x,onRelease:dt,onDrag:q,dismissible:u,handleOnly:d,isOpen:F,isDragging:W,shouldFade:Rn,closeDrawer:ee,onNestedDrag:Fe,onNestedOpenChange:Ne,onNestedRelease:tt,keyboardIsOpen:yn,modal:S,snapPointsOffset:dn,direction:C,shouldScaleBackground:o,setBackgroundColorOnScale:a,noBodyStyles:T,container:L,autoFocus:j}},n))}const Lse=re.forwardRef(function({...t},e){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:s,isOpen:o,modal:a}=sy(),c=Rse(e,n),l=r&&r.length>0;return a?re.createElement(C7e,{onMouseUp:i,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":o&&l?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false",...t}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});Lse.displayName="Drawer.Overlay";const Dse=re.forwardRef(function({onPointerDownOutside:t,style:e,onOpenAutoFocus:n,...r},i){const{drawerRef:s,onPress:o,onRelease:a,onDrag:c,keyboardIsOpen:l,snapPointsOffset:u,modal:d,isOpen:f,direction:p,snapPoints:m,container:v,handleOnly:S,autoFocus:_}=sy(),[w,T]=re.useState(!1),C=Rse(i,s),I=re.useRef(null),R=re.useRef(null),O=re.useRef(!1),A=m&&m.length>0;J7e();const U=(L,j,X=0)=>{if(O.current)return!0;const G=Math.abs(L.y),F=Math.abs(L.x),V=F>G,J=["bottom","right"].includes(j)?1:-1;if(j==="left"||j==="right"){if(!(L.x*J<0)&&F>=0&&F<=X)return V}else if(!(L.y*J<0)&&G>=0&&G<=X)return!V;return O.current=!0,!0};re.useEffect(()=>{A&&window.requestAnimationFrame(()=>{T(!0)})},[]);function N(L){I.current=null,O.current=!1,a(L)}return re.createElement(k7e,{"data-vaul-drawer-direction":p,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":f&&A?"true":"false","data-vaul-custom-container":v?"true":"false",...r,ref:C,style:u&&u.length>0?{"--snap-point-height":`${u[0]}px`,...e}:e,onPointerDown:L=>{S||(r.onPointerDown==null||r.onPointerDown.call(r,L),I.current={x:L.pageX,y:L.pageY},o(L))},onOpenAutoFocus:L=>{n==null||n(L),_||L.preventDefault()},onPointerDownOutside:L=>{if(t==null||t(L),!d||L.defaultPrevented){L.preventDefault();return}l.current&&(l.current=!1)},onFocusOutside:L=>{if(!d){L.preventDefault();return}},onPointerMove:L=>{if(R.current=L,S||(r.onPointerMove==null||r.onPointerMove.call(r,L),!I.current))return;const j=L.pageY-I.current.y,X=L.pageX-I.current.x,G=L.pointerType==="touch"?10:2;U({x:X,y:j},p,G)?c(L):(Math.abs(X)>G||Math.abs(j)>G)&&(I.current=null)},onPointerUp:L=>{r.onPointerUp==null||r.onPointerUp.call(r,L),I.current=null,O.current=!1,a(L)},onPointerOut:L=>{r.onPointerOut==null||r.onPointerOut.call(r,L),N(R.current)},onContextMenu:L=>{r.onContextMenu==null||r.onContextMenu.call(r,L),N(R.current)}})});Dse.displayName="Drawer.Content";const Z7e=250,Q7e=120,Nse=re.forwardRef(function({preventCycle:t=!1,children:e,...n},r){const{closeDrawer:i,isDragging:s,snapPoints:o,activeSnapPoint:a,setActiveSnapPoint:c,dismissible:l,handleOnly:u,isOpen:d,onPress:f,onDrag:p}=sy(),m=re.useRef(null),v=re.useRef(!1);function S(){if(v.current){T();return}window.setTimeout(()=>{_()},Q7e)}function _(){if(s||t||v.current){T();return}if(T(),(!o||o.length===0)&&l){i();return}if(a===o[o.length-1]&&l){i();return}const I=o.findIndex(O=>O===a);if(I===-1)return;const R=o[I+1];c(R)}function w(){m.current=window.setTimeout(()=>{v.current=!0},Z7e)}function T(){window.clearTimeout(m.current),v.current=!1}return re.createElement("div",{onClick:S,onPointerCancel:T,onPointerDown:C=>{u&&f(C),w()},onPointerMove:C=>{u&&p(C)},ref:r,"data-vaul-drawer-visible":d?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},re.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},e))});Nse.displayName="Drawer.Handle";function eUe({onDrag:t,onOpenChange:e,...n}){const{onNestedDrag:r,onNestedOpenChange:i,onNestedRelease:s}=sy();if(!r)throw new Error("Drawer.NestedRoot must be placed in another drawer");return re.createElement(Ase,{nested:!0,onClose:()=>{i(!1)},onDrag:(o,a)=>{r(o,a),t==null||t(o,a)},onOpenChange:o=>{o&&i(o)},onRelease:s,...n})}function tUe(t){const e=sy(),{container:n=e.container,...r}=t;return re.createElement(T7e,{container:n,...r})}const iu={Root:Ase,NestedRoot:eUe,Content:Dse,Overlay:Lse,Trigger:E7e,Portal:tUe,Handle:Nse,Close:x7e,Title:R7e,Description:I7e};function nUe(t,e=[]){let n=[];function r(s,o){const a=y.createContext(o),c=n.length;n=[...n,o];const l=d=>{var _;const{scope:f,children:p,...m}=d,v=((_=f==null?void 0:f[t])==null?void 0:_[c])||a,S=y.useMemo(()=>m,Object.values(m));return b.jsx(v.Provider,{value:S,children:p})};l.displayName=s+"Provider";function u(d,f){var v;const p=((v=f==null?void 0:f[t])==null?void 0:v[c])||a,m=y.useContext(p);if(m)return m;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const i=()=>{const s=n.map(o=>y.createContext(o));return function(a){const c=(a==null?void 0:a[t])||s;return y.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,rUe(i,...e)]}function rUe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return y.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var iN="DropdownMenu",[iUe,uht]=nUe(iN,[WR]),Cs=WR(),[sUe,Use]=iUe(iN),$se=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=t,c=Cs(e),l=y.useRef(null),[u=!1,d]=Fb({prop:i,defaultProp:s,onChange:o});return b.jsx(sUe,{scope:e,triggerId:_a(),triggerRef:l,contentId:_a(),open:u,onOpenChange:d,onOpenToggle:y.useCallback(()=>d(f=>!f),[d]),modal:a,children:b.jsx(Fie,{...c,open:u,onOpenChange:d,dir:r,modal:a,children:n})})};$se.displayName=iN;var Fse="DropdownMenuTrigger",Bse=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,s=Use(Fse,n),o=Cs(n);return b.jsx(Bie,{asChild:!0,...o,children:b.jsx(wt.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:KR(e,s.triggerRef),onPointerDown:Je(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Je(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});Bse.displayName=Fse;var oUe="DropdownMenuPortal",jse=t=>{const{__scopeDropdownMenu:e,...n}=t,r=Cs(e);return b.jsx(jie,{...r,...n})};jse.displayName=oUe;var Hse="DropdownMenuContent",Kse=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Use(Hse,n),s=Cs(n),o=y.useRef(!1);return b.jsx(Hie,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Je(t.onCloseAutoFocus,a=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:Je(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;(!i.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Kse.displayName=Hse;var aUe="DropdownMenuGroup",cUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Kie,{...i,...r,ref:e})});cUe.displayName=aUe;var lUe="DropdownMenuLabel",uUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Vie,{...i,...r,ref:e})});uUe.displayName=lUe;var dUe="DropdownMenuItem",Vse=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(qie,{...i,...r,ref:e})});Vse.displayName=dUe;var fUe="DropdownMenuCheckboxItem",hUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Gie,{...i,...r,ref:e})});hUe.displayName=fUe;var pUe="DropdownMenuRadioGroup",gUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(zie,{...i,...r,ref:e})});gUe.displayName=pUe;var mUe="DropdownMenuRadioItem",vUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Wie,{...i,...r,ref:e})});vUe.displayName=mUe;var yUe="DropdownMenuItemIndicator",_Ue=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Yie,{...i,...r,ref:e})});_Ue.displayName=yUe;var bUe="DropdownMenuSeparator",SUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Jie,{...i,...r,ref:e})});SUe.displayName=bUe;var wUe="DropdownMenuArrow",EUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Xie,{...i,...r,ref:e})});EUe.displayName=wUe;var TUe="DropdownMenuSubTrigger",CUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Zie,{...i,...r,ref:e})});CUe.displayName=TUe;var kUe="DropdownMenuSubContent",RUe=y.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Cs(n);return b.jsx(Qie,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});RUe.displayName=kUe;var IUe=$se,xUe=Bse,PUe=jse,OUe=Kse;function qse(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M8.7 17.3a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7l3.9-3.9-3.9-3.9a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l4.6 4.6c.1.1.17.208.213.325.041.117.062.242.062.375s-.02.258-.063.375a.877.877 0 0 1-.212.325l-4.6 4.6a.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}qse.displayName="ChevronRightIcon";const Gse=y.forwardRef(qse);var sN="Progress",oN=100,[MUe,dht]=Dp(sN),[AUe,LUe]=MUe(sN),zse=y.forwardRef((t,e)=>{const{__scopeProgress:n,value:r=null,max:i,getValueLabel:s=DUe,...o}=t;(i||i===0)&&!lV(i)&&console.error(NUe(`${i}`,"Progress"));const a=lV(i)?i:oN;r!==null&&!uV(r,a)&&console.error(UUe(`${r}`,"Progress"));const c=uV(r,a)?r:null,l=Tk(c)?s(c,a):void 0;return b.jsx(AUe,{scope:n,value:c,max:a,children:b.jsx(wt.div,{"aria-valuemax":a,"aria-valuemin":0,"aria-valuenow":Tk(c)?c:void 0,"aria-valuetext":l,role:"progressbar","data-state":Jse(c,a),"data-value":c??void 0,"data-max":a,...o,ref:e})})});zse.displayName=sN;var Wse="ProgressIndicator",Yse=y.forwardRef((t,e)=>{const{__scopeProgress:n,...r}=t,i=LUe(Wse,n);return b.jsx(wt.div,{"data-state":Jse(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...r,ref:e})});Yse.displayName=Wse;function DUe(t,e){return`${Math.round(t/e*100)}%`}function Jse(t,e){return t==null?"indeterminate":t===e?"complete":"loading"}function Tk(t){return typeof t=="number"}function lV(t){return Tk(t)&&!isNaN(t)&&t>0}function uV(t,e){return Tk(t)&&!isNaN(t)&&t<=e&&t>=0}function NUe(t,e){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${e}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${oN}\`.`}function UUe(t,e){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${e}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${oN} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var $Ue=zse,FUe=Yse,BUe="Label",Xse=y.forwardRef((t,e)=>b.jsx(wt.label,{...t,ref:e,onMouseDown:n=>{var i;n.target.closest("button, input, select, textarea")||((i=t.onMouseDown)==null||i.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Xse.displayName=BUe;var[aN,fht]=Dp("Form"),cN="Form",[jUe,oy]=aN(cN),[HUe,Zse]=aN(cN),Qse=y.forwardRef((t,e)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=t,s=y.useRef(null),o=cn(e,s),[a,c]=y.useState({}),l=y.useCallback(N=>a[N],[a]),u=y.useCallback((N,L)=>c(j=>({...j,[N]:{...j[N]??{},...L}})),[]),d=y.useCallback(N=>{c(L=>({...L,[N]:void 0})),w(L=>({...L,[N]:{}}))},[]),[f,p]=y.useState({}),m=y.useCallback(N=>f[N]??[],[f]),v=y.useCallback((N,L)=>{p(j=>({...j,[N]:[...j[N]??[],L]}))},[]),S=y.useCallback((N,L)=>{p(j=>({...j,[N]:(j[N]??[]).filter(X=>X.id!==L)}))},[]),[_,w]=y.useState({}),T=y.useCallback(N=>_[N]??{},[_]),C=y.useCallback((N,L)=>{w(j=>({...j,[N]:{...j[N]??{},...L}}))},[]),[I,R]=y.useState({}),O=y.useCallback((N,L)=>{R(j=>{const X=new Set(j[N]).add(L);return{...j,[N]:X}})},[]),A=y.useCallback((N,L)=>{R(j=>{const X=new Set(j[N]);return X.delete(L),{...j,[N]:X}})},[]),U=y.useCallback(N=>Array.from(I[N]??[]).join(" ")||void 0,[I]);return b.jsx(jUe,{scope:n,getFieldValidity:l,onFieldValidityChange:u,getFieldCustomMatcherEntries:m,onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:S,getFieldCustomErrors:T,onFieldCustomErrorsChange:C,onFieldValiditionClear:d,children:b.jsx(HUe,{scope:n,onFieldMessageIdAdd:O,onFieldMessageIdRemove:A,getFieldDescription:U,children:b.jsx(wt.form,{...i,ref:o,onInvalid:Je(t.onInvalid,N=>{const L=ooe(N.currentTarget);L===N.target&&L.focus(),N.preventDefault()}),onSubmit:Je(t.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:Je(t.onReset,r)})})})});Qse.displayName=cN;var lN="FormField",[KUe,XR]=aN(lN),eoe=y.forwardRef((t,e)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...s}=t,a=oy(lN,n).getFieldValidity(r),c=_a();return b.jsx(KUe,{scope:n,id:c,name:r,serverInvalid:i,children:b.jsx(wt.div,{"data-valid":dN(a,i),"data-invalid":fN(a,i),...s,ref:e})})});eoe.displayName=lN;var x5="FormLabel",toe=y.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=oy(x5,n),s=XR(x5,n),o=r.htmlFor||s.id,a=i.getFieldValidity(s.name);return b.jsx(Xse,{"data-valid":dN(a,s.serverInvalid),"data-invalid":fN(a,s.serverInvalid),...r,ref:e,htmlFor:o})});toe.displayName=x5;var MT="FormControl",noe=y.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=oy(MT,n),s=XR(MT,n),o=Zse(MT,n),a=y.useRef(null),c=cn(e,a),l=r.name||s.name,u=r.id||s.id,d=i.getFieldCustomMatcherEntries(l),{onFieldValidityChange:f,onFieldCustomErrorsChange:p,onFieldValiditionClear:m}=i,v=y.useCallback(async w=>{if(aoe(w.validity)){const j=GP(w.validity);f(l,j);return}const T=w.form?new FormData(w.form):new FormData,C=[w.value,T],I=[],R=[];d.forEach(j=>{XUe(j,C)?R.push(j):ZUe(j)&&I.push(j)});const O=I.map(({id:j,match:X})=>[j,X(...C)]),A=Object.fromEntries(O),U=Object.values(A).some(Boolean),N=U;w.setCustomValidity(N?D_:"");const L=GP(w.validity);if(f(l,L),p(l,A),!U&&R.length>0){const j=R.map(({id:K,match:W})=>W(...C).then(Y=>[K,Y])),X=await Promise.all(j),G=Object.fromEntries(X),V=Object.values(G).some(Boolean);w.setCustomValidity(V?D_:"");const J=GP(w.validity);f(l,J),p(l,G)}},[d,l,p,f]);y.useEffect(()=>{const w=a.current;if(w){const T=()=>v(w);return w.addEventListener("change",T),()=>w.removeEventListener("change",T)}},[v]);const S=y.useCallback(()=>{const w=a.current;w&&(w.setCustomValidity(""),m(l))},[l,m]);y.useEffect(()=>{var T;const w=(T=a.current)==null?void 0:T.form;if(w)return w.addEventListener("reset",S),()=>w.removeEventListener("reset",S)},[S]),y.useEffect(()=>{const w=a.current,T=w==null?void 0:w.closest("form");if(T&&s.serverInvalid){const C=ooe(T);C===w&&C.focus()}},[s.serverInvalid]);const _=i.getFieldValidity(l);return b.jsx(wt.input,{"data-valid":dN(_,s.serverInvalid),"data-invalid":fN(_,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(l),title:"",...r,ref:c,id:u,name:l,onInvalid:Je(t.onInvalid,w=>{const T=w.currentTarget;v(T)}),onChange:Je(t.onChange,w=>{S()})})});noe.displayName=MT;var D_="This value is not valid",VUe={badInput:D_,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},Hb="FormMessage",roe=y.forwardRef((t,e)=>{const{match:n,name:r,...i}=t,s=XR(Hb,t.__scopeForm),o=r??s.name;return n===void 0?b.jsx(uN,{...i,ref:e,name:o,children:t.children||D_}):typeof n=="function"?b.jsx(GUe,{match:n,...i,ref:e,name:o}):b.jsx(qUe,{match:n,...i,ref:e,name:o})});roe.displayName=Hb;var qUe=y.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,children:s,...o}=t,c=oy(Hb,o.__scopeForm).getFieldValidity(i);return r||(c==null?void 0:c[n])?b.jsx(uN,{ref:e,...o,name:i,children:s??VUe[n]}):null}),GUe=y.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,id:s,children:o,...a}=t,c=oy(Hb,a.__scopeForm),l=y.useRef(null),u=cn(e,l),d=_a(),f=s??d,p=y.useMemo(()=>({id:f,match:n}),[f,n]),{onFieldCustomMatcherEntryAdd:m,onFieldCustomMatcherEntryRemove:v}=c;y.useEffect(()=>(m(i,p),()=>v(i,p.id)),[p,i,m,v]);const S=c.getFieldValidity(i),w=c.getFieldCustomErrors(i)[f];return r||S&&!aoe(S)&&w?b.jsx(uN,{id:f,ref:u,...a,name:i,children:o??D_}):null}),uN=y.forwardRef((t,e)=>{const{__scopeForm:n,id:r,name:i,...s}=t,o=Zse(Hb,n),a=_a(),c=r??a,{onFieldMessageIdAdd:l,onFieldMessageIdRemove:u}=o;return y.useEffect(()=>(l(i,c),()=>u(i,c)),[i,c,l,u]),b.jsx(wt.span,{id:c,...s,ref:e})}),P5="FormValidityState",ioe=t=>{const{__scopeForm:e,name:n,children:r}=t,i=oy(P5,e),s=XR(P5,e),o=n??s.name,a=i.getFieldValidity(o);return b.jsx(b.Fragment,{children:r(a)})};ioe.displayName=P5;var zUe="FormSubmit",soe=y.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t;return b.jsx(wt.button,{type:"submit",...r,ref:e})});soe.displayName=zUe;function GP(t){const e={};for(const n in t)e[n]=t[n];return e}function WUe(t){return t instanceof HTMLElement}function YUe(t){return"validity"in t}function JUe(t){return YUe(t)&&(t.validity.valid===!1||t.getAttribute("aria-invalid")==="true")}function ooe(t){const e=t.elements,[n]=Array.from(e).filter(WUe).filter(JUe);return n}function XUe(t,e){return t.match.constructor.name==="AsyncFunction"||QUe(t.match,e)}function ZUe(t){return t.match.constructor.name==="Function"}function QUe(t,e){return t(...e)instanceof Promise}function aoe(t){let e=!1;for(const n in t){const r=n;if(r!=="valid"&&r!=="customError"&&t[r]){e=!0;break}}return e}function dN(t,e){if((t==null?void 0:t.valid)===!0&&!e)return!0}function fN(t,e){if((t==null?void 0:t.valid)===!1||e)return!0}var e$e=Qse,coe=eoe,t$e=toe,$p=noe,ZR=roe,n$e=ioe,loe=soe;function uoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 16c1.25 0 2.313-.438 3.188-1.313.874-.874 1.312-1.937 1.312-3.187 0-1.25-.438-2.313-1.313-3.188C14.313 7.439 13.25 7 12 7c-1.25 0-2.312.438-3.187 1.313C7.938 9.187 7.5 10.25 7.5 11.5c0 1.25.438 2.313 1.313 3.188C9.688 15.562 10.75 16 12 16Zm0-1.8c-.75 0-1.387-.262-1.912-.787A2.604 2.604 0 0 1 9.3 11.5c0-.75.263-1.387.787-1.912A2.604 2.604 0 0 1 12 8.8c.75 0 1.387.262 1.912.787.525.526.788 1.163.788 1.913s-.262 1.387-.787 1.912A2.604 2.604 0 0 1 12 14.2Zm0 4.8c-2.317 0-4.433-.613-6.35-1.837-1.917-1.226-3.367-2.88-4.35-4.963a.812.812 0 0 1-.1-.313 2.93 2.93 0 0 1 0-.774.812.812 0 0 1 .1-.313c.983-2.083 2.433-3.738 4.35-4.963C7.567 4.614 9.683 4 12 4c2.317 0 4.433.612 6.35 1.838 1.917 1.224 3.367 2.879 4.35 4.962a.81.81 0 0 1 .1.313 2.925 2.925 0 0 1 0 .774.81.81 0 0 1-.1.313c-.983 2.083-2.433 3.738-4.35 4.963C16.433 18.387 14.317 19 12 19Zm0-2a9.544 9.544 0 0 0 5.188-1.488A9.773 9.773 0 0 0 20.8 11.5a9.773 9.773 0 0 0-3.613-4.013A9.544 9.544 0 0 0 12 6a9.545 9.545 0 0 0-5.187 1.487A9.773 9.773 0 0 0 3.2 11.5a9.773 9.773 0 0 0 3.613 4.012A9.544 9.544 0 0 0 12 17Z"})})}uoe.displayName="VisibilityOnIcon";const doe=y.forwardRef(uoe);function foe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"m16.1 13.3-1.45-1.45c.15-.783-.075-1.517-.675-2.2-.6-.683-1.375-.95-2.325-.8L10.2 7.4c.283-.133.57-.233.863-.3A4.2 4.2 0 0 1 12 7c1.25 0 2.313.437 3.188 1.312.874.875 1.312 1.938 1.312 3.188 0 .333-.033.646-.1.938a4.286 4.286 0 0 1-.3.862Zm3.2 3.15-1.45-1.4a10.947 10.947 0 0 0 1.688-1.588A8.898 8.898 0 0 0 20.8 11.5a9.843 9.843 0 0 0-3.588-4.013C15.654 6.496 13.917 6 12 6c-.483 0-.958.033-1.425.1a9.624 9.624 0 0 0-1.375.3L7.65 4.85A11.08 11.08 0 0 1 12 4c2.383 0 4.525.63 6.425 1.887 1.9 1.259 3.325 2.896 4.275 4.913a.81.81 0 0 1 .1.313c.017.125.025.254.025.387a1.972 1.972 0 0 1-.125.7 10.896 10.896 0 0 1-3.4 4.25Zm-.2 5.45-3.5-3.45c-.583.183-1.17.32-1.762.413-.592.091-1.205.137-1.838.137-2.383 0-4.525-.63-6.425-1.887-1.9-1.259-3.325-2.896-4.275-4.913a.813.813 0 0 1-.1-.313 2.93 2.93 0 0 1 0-.762.796.796 0 0 1 .1-.3c.35-.75.767-1.442 1.25-2.075A13.291 13.291 0 0 1 4.15 7L2.075 4.9a.933.933 0 0 1-.275-.688c0-.275.1-.512.3-.712a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l17 17c.183.183.28.413.288.688a.93.93 0 0 1-.288.712.948.948 0 0 1-.7.275.949.949 0 0 1-.7-.275ZM5.55 8.4a10.72 10.72 0 0 0-1.325 1.425A9.013 9.013 0 0 0 3.2 11.5a9.834 9.834 0 0 0 3.588 4.012C8.346 16.505 10.083 17 12 17c.333 0 .658-.02.975-.063.317-.041.642-.087.975-.137l-.9-.95c-.183.05-.358.088-.525.113A3.537 3.537 0 0 1 12 16c-1.25 0-2.312-.438-3.187-1.313C7.938 13.813 7.5 12.75 7.5 11.5c0-.183.013-.358.038-.525a4.55 4.55 0 0 1 .112-.525L5.55 8.4Z"})})}foe.displayName="VisibilityOffIcon";const r$e=y.forwardRef(foe);function hoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M9.55 17.575c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212L4.55 13c-.183-.183-.27-.42-.263-.713.009-.291.105-.529.288-.712a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275L9.55 15.15l8.475-8.475c.183-.183.42-.275.713-.275.291 0 .529.092.712.275.183.183.275.42.275.713 0 .291-.092.529-.275.712l-9.2 9.2c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}hoe.displayName="CheckIcon";const Kb=y.forwardRef(hoe);function poe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"m10.6 13.8-2.15-2.15a.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275.948.948 0 0 0-.275.7.95.95 0 0 0 .275.7L9.9 15.9c.2.2.433.3.7.3.267 0 .5-.1.7-.3l5.65-5.65a.948.948 0 0 0 .275-.7.948.948 0 0 0-.275-.7.948.948 0 0 0-.7-.275.948.948 0 0 0-.7.275L10.6 13.8ZM12 22a9.738 9.738 0 0 1-3.9-.788 10.099 10.099 0 0 1-3.175-2.137c-.9-.9-1.612-1.958-2.137-3.175A9.738 9.738 0 0 1 2 12a9.74 9.74 0 0 1 .788-3.9 10.099 10.099 0 0 1 2.137-3.175c.9-.9 1.958-1.612 3.175-2.137A9.738 9.738 0 0 1 12 2a9.74 9.74 0 0 1 3.9.788 10.098 10.098 0 0 1 3.175 2.137c.9.9 1.613 1.958 2.137 3.175A9.738 9.738 0 0 1 22 12a9.738 9.738 0 0 1-.788 3.9 10.098 10.098 0 0 1-2.137 3.175c-.9.9-1.958 1.613-3.175 2.137A9.738 9.738 0 0 1 12 22Z"})})}poe.displayName="CheckCircleSolidIcon";const i$e=y.forwardRef(poe);function goe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2Z",clipRule:"evenodd"})})}goe.displayName="SpinnerIcon";const s$e=y.forwardRef(goe);var o$e="Separator",dV="horizontal",a$e=["horizontal","vertical"],moe=y.forwardRef((t,e)=>{const{decorative:n,orientation:r=dV,...i}=t,s=c$e(r)?r:dV,a=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return b.jsx(wt.div,{"data-orientation":s,...a,...i,ref:e})});moe.displayName=o$e;function c$e(t){return a$e.includes(t)}var l$e=moe;function voe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 14.95c-.133 0-.258-.02-.375-.063a.876.876 0 0 1-.325-.212l-4.6-4.6a.948.948 0 0 1-.275-.7.95.95 0 0 1 .275-.7.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275l3.9 3.9 3.9-3.9a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7l-4.6 4.6c-.1.1-.208.17-.325.212a1.106 1.106 0 0 1-.375.063Z"})})}voe.displayName="ChevronDownIcon";const u$e=y.forwardRef(voe);function yoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M15.05 16.463a7.5 7.5 0 1 1 1.414-1.414l3.243 3.244a1 1 0 0 1-1.414 1.414l-3.244-3.244ZM16 10.5a5.5 5.5 0 1 0-11 0 5.5 5.5 0 0 0 11 0Z"})})}yoe.displayName="SearchIcon";const d$e=y.forwardRef(yoe),f$e="_typography_yh5dq_162",fV={"font-body-xs-regular":"_font-body-xs-regular_yh5dq_21","font-body-xs-semibold":"_font-body-xs-semibold_yh5dq_26","font-body-xs-medium":"_font-body-xs-medium_yh5dq_31","font-body-sm-regular":"_font-body-sm-regular_yh5dq_40","font-body-sm-semibold":"_font-body-sm-semibold_yh5dq_45","font-body-sm-medium":"_font-body-sm-medium_yh5dq_50","font-body-md-regular":"_font-body-md-regular_yh5dq_59","font-body-md-semibold":"_font-body-md-semibold_yh5dq_64","font-body-md-medium":"_font-body-md-medium_yh5dq_69","font-body-lg-regular":"_font-body-lg-regular_yh5dq_78","font-body-lg-semibold":"_font-body-lg-semibold_yh5dq_83","font-body-lg-medium":"_font-body-lg-medium_yh5dq_88","font-heading-sm-regular":"_font-heading-sm-regular_yh5dq_97","font-heading-sm-semibold":"_font-heading-sm-semibold_yh5dq_102","font-heading-sm-medium":"_font-heading-sm-medium_yh5dq_107","font-heading-md-regular":"_font-heading-md-regular_yh5dq_116","font-heading-md-semibold":"_font-heading-md-semibold_yh5dq_121","font-heading-lg-regular":"_font-heading-lg-regular_yh5dq_130","font-heading-lg-semibold":"_font-heading-lg-semibold_yh5dq_135","font-heading-xl-regular":"_font-heading-xl-regular_yh5dq_144","font-heading-xl-semibold":"_font-heading-xl-semibold_yh5dq_149",typography:f$e},_oe=({as:t,children:e,type:n="body",weight:r="regular",size:i="md",className:s,...o})=>{const a=t||"p";return b.jsx(a,{...o,className:Pe(fV.typography,fV[`font-${n}-${i}-${r}`],s),children:e})},Mn=({as:t="p",children:e,...n})=>b.jsx(_oe,{as:t,type:"body",...n,children:e}),h$e="_button_i91xf_17",p$e="_destructive_i91xf_116",s1={button:h$e,"icon-only":"_icon-only_i91xf_59","has-icon":"_has-icon_i91xf_66",destructive:p$e},boe=y.forwardRef(function({as:e,children:n,className:r,disabled:i,...s},o){const a=e||"button",{onClick:c,onSubmit:l,onPointerDown:u,onPointerUp:d,onKeyDown:f,onKeyUp:p,onKeyPress:m,...v}=s,S=i?{}:{onClick:c,onSubmit:l,onPointerDown:u,onPointerUp:d,onKeyDown:f,onKeyUp:p,onKeyPress:m};return b.jsx(a,{...v,ref:o,className:r,role:e==="a"?"link":"button",tabIndex:0,...S,"aria-disabled":i,children:n})}),tn=y.forwardRef(function({as:e,kind:n="primary",size:r="lg",children:i,className:s,iconOnly:o,Icon:a,destructive:c,disabled:l,...u},d){const[f,p]=n==="destructive"?["secondary",!0]:[n,c],m=Pe(s1.button,s,{[s1["has-icon"]]:a,[s1["icon-only"]]:o,[s1.destructive]:p}),v=o&&r==="lg"?24:20;return b.jsxs(boe,{...u,as:e||"button",ref:d,className:m,"data-size":r,"data-kind":f,tabIndex:0,disabled:l,children:[a&&b.jsx(a,{width:v,height:v,className:s1.icon,"aria-hidden":!0}),i]})}),g$e="_destructive_bh2qc_83",zP={"icon-button":"_icon-button_bh2qc_17","subtle-bg":"_subtle-bg_bh2qc_38",destructive:g$e},m$e={"indicator-icon":"_indicator-icon_133tf_26"},v$e=y.forwardRef(function({children:e,className:n,size:r="100%",colour:i,indicator:s},o){const a=Pe(m$e["indicator-icon"],n);return b.jsx("div",{ref:o,className:a,"data-indicator":s,style:{"--cpd-icon-button-size":r,"--cpd-color-icon-tertiary":i},children:re.Children.only(e)})}),Soe=y.createContext(null);function hN(){const t=y.useContext(Soe);if(t==null)throw new Error("Tooltip components must be wrapped in <Tooltip />");return t}const y$e="_tooltip_1pslb_17",_$e="_invisible_1pslb_30",b$e="_caption_1pslb_37",S$e="_arrow_1pslb_42",AT={tooltip:y$e,invisible:_$e,caption:b$e,arrow:S$e},woe={open:300,close:0},Eoe=({children:t})=>b.jsx(iDe,{delay:woe,timeoutMs:300,children:t});Eoe.displayName="TooltipProvider";function w$e({open:t,disabled:e=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:s,...o}){const a=yf(),c=yf(),l=y.useRef(null),[u,d]=y.useState(!1),f=e?!1:t??u,p=(U,N,L)=>{n==null||n(U,N,L),t===void 0&&d(U)},m=yDe({placement:r,open:f,onOpenChange:p,whileElementsMounted:Tre,middleware:[Rre(6),xre({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),Ire({padding:5}),Pre({element:l})]}),v=m.context,{delay:S,initialDelay:_}=sDe(v);if(_!==woe)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const w=nDe(v,{move:!1,enabled:t===void 0,delay:i?S:{}}),T=_De(v,{enabled:t===void 0,visibleOnly:!1}),C=mDe(v),I="label"in o?"label":"description",R=wDe(v,{enabled:I==="description",role:"tooltip"}),O=y.useMemo(()=>I==="label"?{reference:{"aria-labelledby":a,"aria-describedby":s?c:void 0}}:{},[I,a,c]),A=bDe([w,T,C,R,O]);return y.useMemo(()=>({labelId:a,captionId:s?c:void 0,caption:s,purpose:I,open:f,setOpen:p,...A,...m,arrowRef:l}),[a,c,s,R,f,p,A,m,l])}function Ao({children:t,isTriggerInteractive:e=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=w$e({isTriggerInteractive:e,...r});return b.jsxs(Soe.Provider,{value:i,children:[b.jsx(C$e,{isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n,children:t}),b.jsxs(T$e,{children:[b.jsx("span",{id:i.labelId,children:"label"in r?r.label:r.description}),b.jsx(E$e,{})]})]})}function E$e(){const{caption:t,captionId:e}=hN();if(!t)return null;const r=typeof t=="string"?"span":"div";return b.jsx(r,{id:e,className:Pe(AT.caption,"cpd-theme-dark"),children:t})}function T$e({children:t}){const{context:e,open:n,arrowRef:r,purpose:i,...s}=hN();return!n&&i!=="label"?null:b.jsx(dDe,{children:b.jsxs("div",{ref:s.refs.setFloating,style:s.floatingStyles,...s.getFloatingProps(),className:Pe(AT.tooltip,{[AT.invisible]:i==="label"&&!n}),children:[b.jsx(Z8e,{ref:r,context:e,width:10,height:6,className:AT.arrow}),t]})})}const C$e=({children:t,isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n})=>{const r=hN(),i=t==null?void 0:t.ref,s=Ore([r.refs.setReference,i]),o=y.useMemo(()=>{if(y.isValidElement(t))if(e){const a=r.getReferenceProps({ref:s,...t.props});return y.cloneElement(t,a)}else{const a=r.getReferenceProps({ref:s,tabIndex:n}),{"aria-labelledby":c,"aria-describedby":l,...u}=a;return b.jsx("span",{tabIndex:n,...u,children:y.cloneElement(t,{"aria-labelledby":c,"aria-describedby":l})})}},[r,s,t]);if(!o)throw new Error("Tooltip anchor must be a single valid React element");return o},k$e=y.forwardRef(function({children:e,className:n,indicator:r,size:i="32px",style:s,disabled:o,destructive:a,tooltip:c,subtleBackground:l,...u},d){const f=Pe(zP["icon-button"],n,{[zP.destructive]:a,[zP["subtle-bg"]]:l}),p=b.jsx(boe,{as:"button",ref:d,className:f,style:{"--cpd-icon-button-size":i,...s},disabled:o,...u,"data-indicator":r,children:b.jsx(v$e,{indicator:r,colour:o?"var(--cpd-color-icon-disabled)":void 0,children:re.Children.only(e)})});return c?b.jsx(Ao,{label:c,children:p}):p}),R$e="@",I$e="#",x$e="+",P$e=new Intl.Segmenter;function O$e(t){if(t.length<1)return"";const e=t[0];[R$e,I$e,x$e].includes(e)&&(t=t.substring(1));const n=P$e.segment(t)[Symbol.iterator]().next();return n.done?"":n.value.segment}const M$e="_avatar_mcap2_17",A$e="_image_mcap2_50",WP={avatar:M$e,image:A$e,"avatar-imageless":"_avatar-imageless_mcap2_61","stacked-avatars":"_stacked-avatars_mcap2_111","clip-path":"_clip-path_mcap2_130"};function L$e(t){return t.split("").reduce((i,s)=>i+s.charCodeAt(0),0)%6+1}function D$e(t){return!!(t.onClick||t.onKeyDown||t.onKeyUp)}const N$e=y.forwardRef(function({src:e,id:n,name:r="",type:i="round",className:s="",size:o,style:a={},onError:c,...l},u){return re.createElement(D$e(l)?"button":"span",{ref:u,role:"img","aria-label":n,...l,"data-type":i,"data-color":L$e(n),className:Pe(WP.avatar,s,{[WP["avatar-imageless"]]:!e}),style:{...a,"--cpd-avatar-size":o}},b.jsx(re.Fragment,{children:e?b.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Pe(WP.image),"data-type":i,style:a,width:o,height:o,onError:c}):O$e(r)}))}),U$e="_menu_1x5h1_17",$$e="_title_1x5h1_83",Toe={menu:U$e,"slide-in":"_slide-in_1x5h1_1","slide-out":"_slide-out_1x5h1_1","fade-in":"_fade-in_1x5h1_1","fade-out":"_fade-out_1x5h1_1",title:$$e},hV=c4.useId,F$e=(()=>{let t=1;return()=>`:r${t++}:`})(),B$e=()=>y.useMemo(F$e,[]),Vb=typeof hV=="function"?hV:B$e,j$e=({title:t,id:e})=>b.jsx(Mn,{as:"h3",id:e,className:Toe.title,size:"sm",weight:"semibold",children:t}),pN=y.forwardRef(({title:t,showTitle:e=!0,className:n,children:r,...i},s)=>{const o=Vb();return b.jsxs("div",{role:"menu",ref:s,"aria-label":e?void 0:t,"aria-labelledby":e?o:void 0,className:Pe(n,Toe.menu),...i,children:[e&&b.jsx(j$e,{title:t,id:o}),r]})});pN.displayName="FloatingMenu";const H$e="_bg_gd68h_17",K$e="_drawer_gd68h_26",V$e="_body_gd68h_60",Ck={bg:H$e,drawer:K$e,body:V$e},gN=y.createContext(null);function mN(){var e;const t=(e=globalThis.navigator)==null?void 0:e.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const vN=y.forwardRef(({title:t,children:e,className:n,...r},i)=>b.jsx("div",{ref:i,className:Pe(n,Ck.drawer),"aria-label":t,"data-platform":mN(),...r,role:"menu",children:b.jsx("div",{className:Ck.body,children:e})}));vN.displayName="DrawerMenu";const q$e=({onSelect:t,children:e})=>b.jsx(ase,{onSelect:t??void 0,asChild:!0,children:e}),G$e=({title:t,onOpenChange:e,trigger:n,hasAccessibleAlternative:r,children:i})=>{const[s,o]=y.useState(!1),a=y.useCallback(p=>{o(p),e==null||e(p)},[o,e]),c=mN(),l=c==="android"||c==="ios",u=y.useMemo(()=>({MenuItemWrapper:l?null:q$e,onOpenChange:a}),[a]),d=b.jsx(gN.Provider,{value:u,children:i}),f=b.jsx(c7e,{"aria-haspopup":"menu",tabIndex:r?void 0:0,asChild:!0,children:n});return l?b.jsxs(b.Fragment,{children:[b.jsx(iV,{onOpenChange:a,children:f}),b.jsx(iu.Root,{open:s,onOpenChange:a,children:b.jsxs(iu.Portal,{children:[b.jsx(iu.Overlay,{className:Pe(Ck.bg)}),b.jsx(iu.Content,{asChild:!0,children:b.jsx(vN,{title:t,children:d})})]})})]}):b.jsxs(iV,{onOpenChange:a,children:[f,b.jsx(l7e,{children:b.jsx(u7e,{asChild:!0,children:b.jsx(pN,{title:t,children:d})})})]})},z$e="_glass_1x9g9_17",W$e={glass:z$e},Coe=y.forwardRef(({children:t,className:e,...n},r)=>b.jsx("div",{ref:r,className:Pe(e,W$e.glass),...n,children:y.Children.only(t)}));Coe.displayName="Glass";const ul=({as:t="h1",children:e,...n})=>b.jsx(_oe,{as:t,type:"heading",...n,children:e}),Y$e="_link_1mzip_17",J$e={link:Y$e},X$e=y.forwardRef(function({children:e,className:n,kind:r="primary",...i},s){return b.jsx("a",{ref:s,...i,rel:"noreferrer noopener",className:Pe(J$e.link,n),"data-kind":r,children:e})}),N_={"nav-bar":"_nav-bar_135dy_16","nav-bar-items":"_nav-bar-items_135dy_22","nav-tab":"_nav-tab_135dy_33","nav-item":"_nav-item_135dy_55"},Z$e=({children:t,className:e,role:n,"aria-label":r,...i})=>{const s=Pe(e,N_["nav-bar"]),o=n!=="tablist"?{role:"navigation","aria-label":r}:{role:"presentation"},a=n==="tablist"?{role:"tablist","aria-label":r}:{};return b.jsx("nav",{...o,...i,className:s,children:b.jsx("ul",{...a,className:N_["nav-bar-items"],children:t})})},Q$e=y.forwardRef(function({children:e,href:n,onClick:r,...i},s){return b.jsx("a",{href:n,onClick:r,className:N_["nav-item"],...i,ref:s,children:e})}),eFe=y.forwardRef(function({children:e,disabled:n,onClick:r,...i},s){return b.jsx("button",{onClick:r,className:N_["nav-item"],disabled:n,ref:s,...i,children:e})}),tFe=t=>!!t.href,nFe=y.forwardRef(function(e,n){const r=e["aria-controls"],s=!!r?{"aria-controls":r,role:"tab","aria-selected":e.active}:{"aria-current":e.active?!0:void 0},o={...e};delete o.active;let a;if(tFe(o)){const c=n;a=b.jsx(Q$e,{...o,...s,ref:c})}else{const c=n;a=b.jsx(eFe,{...o,...s,ref:c})}return b.jsx("li",{className:N_["nav-tab"],"data-current":e.active?!0:void 0,role:"presentation",children:a})}),rFe=({onSelect:t,children:e})=>b.jsx(Vse,{onSelect:t??void 0,asChild:!0,children:e}),yN=({title:t,showTitle:e=!0,open:n,onOpenChange:r,trigger:i,children:s,side:o="bottom",align:a="center"})=>{const c=mN(),l=c==="android"||c==="ios",u=y.useMemo(()=>({MenuItemWrapper:l?null:rFe,onOpenChange:r}),[r]),d=b.jsx(gN.Provider,{value:u,children:s});return l?b.jsxs(iu.Root,{open:n,onOpenChange:r,children:[b.jsx(iu.Trigger,{asChild:!0,children:i}),b.jsxs(iu.Portal,{children:[b.jsx(iu.Overlay,{className:Pe(Ck.bg)}),b.jsx(iu.Content,{asChild:!0,children:b.jsx(vN,{title:t,children:d})})]})]}):b.jsxs(IUe,{open:n,onOpenChange:r,children:[b.jsx(xUe,{asChild:!0,children:i}),b.jsx(PUe,{children:b.jsx(OUe,{asChild:!0,side:o,align:a,sideOffset:8,onCloseAutoFocus:f=>{f.preventDefault()},children:b.jsx(pN,{title:t,showTitle:e,children:d})})})]})},iFe="_item_8j2l6_17",sFe="_interactive_8j2l6_35",oFe="_icon_8j2l6_43",aFe="_label_8j2l6_52",cFe="_disabled_8j2l6_118",sd={item:iFe,interactive:sFe,"no-label":"_no-label_8j2l6_39",icon:oFe,label:aFe,"nav-hint":"_nav-hint_8j2l6_59",disabled:cFe},Sv=({as:t,className:e,Icon:n,label:r,labelProps:i,onSelect:s,kind:o="primary",children:a,onClick:c,disabled:l,...u})=>{const d=t??"button",f=y.useContext(gN),p=y.useCallback(w=>{if(c==null||c(w),s!==null&&(f==null?void 0:f.MenuItemWrapper)==null){const T=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});s(T),T.defaultPrevented||f==null||f.onOpenChange(!1)}},[f,s]),m=y.isValidElement(n),v=n,S=n,_=b.jsxs(d,{role:"menuitem",...u,className:Pe(e,sd.item,{[sd.interactive]:s!==null,[sd["no-label"]]:r===null,[sd.disabled]:l}),"data-kind":o,onClick:p,disabled:d==="button"?l:void 0,"aria-disabled":d==="button"?void 0:l,children:[m?b.jsx(_f,{className:sd.icon,children:v}):b.jsx(S,{width:24,height:24,className:sd.icon,"aria-hidden":!0}),r!==null&&b.jsx(Mn,{className:sd.label,size:"md",weight:"medium",as:"span",...i,children:r}),(d==="button"||d==="a")&&b.jsx(Gse,{width:8,height:24,className:sd["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return(f==null?void 0:f.MenuItemWrapper)==null||s===null?_:b.jsx(f.MenuItemWrapper,{onSelect:s,children:_})},Xw={"progress-bar":"_progress-bar_1wrhp_17","progress-bar-container":"_progress-bar-container_1wrhp_33","progress-bar-label":"_progress-bar-label_1wrhp_62","progress-bar-indicator":"_progress-bar-indicator_1wrhp_68"};y.forwardRef(function({size:e,tint:n,className:r,value:i,max:s,getValueLabel:o,...a},c){const l=s??1,u=i??l,d=Vb(),f=o?o(u,l):null;return b.jsxs("div",{className:Pe(Xw["progress-bar-container"],r),"data-tint":n,...a,children:[f&&b.jsx("div",{id:d,className:Xw["progress-bar-label"],children:f}),b.jsx($Ue,{className:Xw["progress-bar"],"data-size":e,max:l,value:u,ref:c,"aria-labelledby":f?d:void 0,getValueLabel:o,children:b.jsx(FUe,{className:Xw["progress-bar-indicator"],style:{transform:`translateX(-${100-u/l*100}%)`}})})]})});const lFe="_search_qztja_17",uFe="_icon_qztja_46",dFe="_input_qztja_61",YP={search:lFe,icon:uFe,input:dFe},fFe="_container_1qov4_17",hFe="_control_1qov4_22",pFe="_action_1qov4_33",JP={container:fFe,control:hFe,action:pFe},gFe="_control_9gon8_18",pV={control:gFe,"enable-ligatures":"_enable-ligatures_9gon8_70"},koe=y.forwardRef(function({className:e,enableLigatures:n,...r},i){const s=Pe(pV.control,e,{[pV["enable-ligatures"]]:n});return b.jsx("input",{ref:i,...r,className:s})}),mFe=y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(koe,{ref:n,...e})})}),Roe=y.forwardRef(function({Icon:e,className:n,actionLabel:r,onActionClick:i,...s},o){const a=Vb(),c=Pe(JP.container,n);return b.jsxs("div",{className:c,id:a,children:[b.jsx(koe,{ref:o,...s,className:JP.control}),b.jsx(Ao,{label:r,children:b.jsx("button",{type:"button",className:JP.action,onClick:i,"aria-controls":a,children:b.jsx(e,{"aria-hidden":!0})})})]})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(Roe,{ref:n,...e})})});const gV={isHidden:!0,icon:r$e,label:"Show",type:"password"},vFe={isHidden:!1,icon:doe,label:"Hide",type:"text"},yFe=y.forwardRef(function(e,n){const[{icon:r,label:i,type:s},o]=y.useReducer(a=>a.isHidden?vFe:gV,gV);return b.jsx(Roe,{ref:n,...e,Icon:r,actionLabel:i,onActionClick:()=>o(),type:s})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(yFe,{ref:n,...e})})});const _Fe="_container_9zyti_18",bFe="_control_9zyti_33",SFe="_digit_9zyti_57",O5={container:_Fe,control:bFe,digit:SFe},wFe=({filled:t,selected:e})=>b.jsx("div",{className:O5.digit,"aria-hidden":"true","data-filled":t?"":void 0,"data-selected":e?"":void 0}),EFe=y.forwardRef(function({className:e,length:n=6,...r},i){const s=Pe(O5.container,e),[o,a]=re.useState(0),[c,l]=re.useState(null),u=d=>{var p;const f=d.currentTarget;a((p=f.value)==null?void 0:p.length),document.activeElement!==f||f.selectionStart===null||f.selectionEnd===null?l(null):l([f.selectionStart,f.selectionEnd])};return b.jsxs("div",{className:s,children:[b.jsx("input",{...r,inputMode:"numeric",type:"text",minLength:0,maxLength:n,className:O5.control,pattern:`\\d{${n}}`,autoComplete:"one-time-code",onSelect:u,onFocus:u,onBlur:u,onMouseDown:u,onMouseMove:u,onMouseUp:u,onChange:u,ref:i}),Array.from(Array(n).keys()).map(d=>b.jsx(wFe,{filled:d<o,selected:!!c&&d>=c[0]&&d<c[1]},d))]})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(EFe,{ref:n,...e})})});const TFe="_container_1wloq_18",CFe="_input_1wloq_26",kFe="_ui_1wloq_27",XP={container:TFe,input:CFe,ui:kFe},RFe=y.forwardRef(function({className:e,...n},r){const i=Pe(XP.container,e);return b.jsxs("div",{className:i,children:[b.jsx("input",{ref:r,className:XP.input,...n,type:"checkbox"}),b.jsx("div",{className:XP.ui,children:b.jsx(Kb,{"aria-hidden":!0})})]})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(RFe,{ref:n,...e})})});const IFe="_container_1vw5h_18",xFe="_input_1vw5h_26",PFe="_ui_1vw5h_27",ZP={container:IFe,input:xFe,ui:PFe},OFe=y.forwardRef(function({className:e,...n},r){const i=Pe(ZP.container,e);return b.jsxs("div",{className:i,children:[b.jsx("input",{ref:r,...n,className:ZP.input,type:"radio"}),b.jsx("div",{className:ZP.ui})]})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(OFe,{ref:n,...e})})});const MFe="_container_qnvru_18",AFe="_input_qnvru_32",LFe="_ui_qnvru_42",QP={container:MFe,input:AFe,ui:LFe},Ioe=y.forwardRef(function({className:e,...n},r){const i=Pe(QP.container,e);return b.jsxs("div",{className:i,children:[b.jsx("input",{ref:r,className:QP.input,...n,type:"checkbox"}),b.jsx("div",{className:QP.ui})]})});y.forwardRef(function(e,n){return b.jsx($p,{asChild:!0,children:b.jsx(Ioe,{ref:n,...e})})});const DFe="_controls_1h4nb_17",eO={controls:DFe,"button-group":"_button-group_1h4nb_27"};function NFe(t,e){switch(e){case 0:return t===0||t===3?1:t;case 1:return 2;case 4:return 0;case 2:return t===2?3:t;case 3:return t===2?0:t;case 5:return t===3?0:t}UFe(e)}function UFe(t){throw new Error(`Unreachable value: ${t}`)}y.forwardRef(function({className:e,label:n,onSave:r,onCancel:i,onInput:s,onClearServerErrors:o,serverInvalid:a,saveButtonLabel:c,cancelButtonLabel:l,savedLabel:u,savingLabel:d,helpLabel:f,disabled:p,children:m,...v},S){const[_,w]=y.useReducer(NFe,0),T=y.useRef(!1),[C,I]=y.useState(!1),R=_===1||_===2||C,O=y.useRef();y.useEffect(()=>(_===3&&(O.current=setTimeout(()=>{w(5),O.current=void 0},2e3)),()=>{O.current&&clearTimeout(O.current),O.current=void 0}),[_]);const A=y.useRef(null),U=y.useRef(null),N=y.useRef(null),L=y.useCallback(()=>{T.current||(T.current=!0,I(!0))},[C,I]),j=y.useCallback(V=>{T.current&&(V.currentTarget.contains(V.relatedTarget)||(T.current=!1,I(!1)))},[C,I]),X=y.useCallback(V=>{w(0),s==null||s(V)},[w,s]),G=y.useCallback(async V=>{var J;if(V.preventDefault(),_!==0)try{w(1),(J=U.current)==null||J.blur(),await(r==null?void 0:r(V)),w(2)}catch{w(3)}},[r,_,O]),F=y.useCallback(V=>{var J;(J=N.current)==null||J.blur(),i==null||i(V),w(4)},[N,i]);return b.jsx(HFe,{className:e,onSubmit:G,onReset:F,onFocus:L,onBlur:j,onClearServerErrors:o,ref:A,children:b.jsxs(xoe,{name:"input",serverInvalid:a,children:[b.jsx(Poe,{children:n}),b.jsxs("div",{className:eO.controls,children:[b.jsx(mFe,{ref:S,...v,onInput:X,disabled:p||_===2}),R&&b.jsxs("div",{className:eO["button-group"],children:[b.jsx(Ao,{label:c,children:b.jsx(loe,{asChild:!0,children:b.jsx(tn,{type:"submit",kind:"primary",size:"sm",ref:U,disabled:_!==1,iconOnly:!0,Icon:Kb})})}),b.jsx(Ao,{label:l,children:b.jsx(tn,{type:"reset",kind:"secondary",size:"sm",ref:N,className:eO.button,disabled:_===2,iconOnly:!0,Icon:kD})})]})]}),_===2?b.jsx(WFe,{children:d}):m,u&&_===3&&b.jsx(zFe,{children:u}),f&&(_===0||_===1)&&b.jsx(n$e,{children:V=>(V===void 0||V.valid)&&!a&&b.jsx(YFe,{children:f})})]})})});const $Fe="_root_dgy0u_24",FFe="_field_dgy0u_34",BFe="_label_dgy0u_67",jFe="_message_dgy0u_98",xo={root:$Fe,field:FFe,"inline-field":"_inline-field_dgy0u_40","inline-field-body":"_inline-field-body_dgy0u_46","inline-field-control":"_inline-field-control_dgy0u_52",label:BFe,message:jFe,"help-message":"_help-message_dgy0u_104","error-message":"_error-message_dgy0u_108","success-message":"_success-message_dgy0u_112"},HFe=y.forwardRef(function({children:e,...n},r){const i=Pe(xo.root,n.className);return b.jsx(e$e,{ref:r,...n,className:i,children:e})}),xoe=y.forwardRef(function({children:e,...n},r){const i=Pe(xo.field,n.className);return b.jsx(coe,{ref:r,...n,className:i,children:e})});y.forwardRef(function({className:e,control:n,children:r,...i},s){const o=Pe(xo["inline-field"],e);return b.jsxs(coe,{ref:s,...i,className:o,children:[b.jsx("div",{className:xo["inline-field-control"],children:n}),b.jsx("div",{className:xo["inline-field-body"],children:r})]})});const Poe=y.forwardRef(function({children:e,...n},r){const i=Pe(xo.label,n.className);return b.jsx(t$e,{ref:r,...n,className:i,children:e})}),KFe="_icon_1ye7b_27",VFe="_spin_1ye7b_1",qFe={icon:KFe,spin:VFe},GFe=y.forwardRef(function({size:e=20,...n},r){return b.jsx(s$e,{ref:r,className:qFe.icon,style:{width:e,height:e},...n})});y.forwardRef(function({children:e,className:n,...r},i){const s=Pe(xo.message,xo["error-message"],n);return b.jsxs(ZR,{ref:i,...r,className:s,children:[b.jsx(CD,{}),e]})});const zFe=y.forwardRef(function({children:e,className:n,...r},i){const s=Pe(xo.message,xo["success-message"],n);return b.jsxs(ZR,{ref:i,...r,className:s,children:[b.jsx(i$e,{}),e]})}),WFe=y.forwardRef(function({children:e,className:n,...r},i){const s=Pe(xo.message,n);return b.jsxs(ZR,{ref:i,...r,className:s,children:[b.jsx(GFe,{}),e]})}),YFe=y.forwardRef(function({children:e,className:n,...r},i){const s=Pe(xo.message,xo["help-message"],n);return b.jsx(ZR,{ref:i,...r,className:s,children:e})});y.forwardRef(function(e,n){return b.jsx(loe,{asChild:!0,children:b.jsx(tn,{type:"submit",ref:n,...e})})});y.forwardRef(function({className:e,onChange:n,placeholder:r="Search…",name:i,...s},o){const a=Pe(YP.search,e),c=Vb();return b.jsx(xoe,{name:i,asChild:!0,children:b.jsxs(Poe,{className:a,htmlFor:c,children:[b.jsx(d$e,{className:YP.icon,width:20,height:20}),b.jsx("input",{ref:o,...s,id:c,name:i,type:"search",placeholder:r,onChange:n,className:YP.input})]})})});const JFe="_separator_144s5_17",XFe={separator:JFe},mV="--cpd-separator-spacing",ZFe=y.forwardRef(({className:t,spacing:e,kind:n="primary",...r},i)=>{const s=Pe(XFe.separator,t),o=y.useRef(null),a=Ore([o,i]);return y.useEffect(()=>{var l;const c=(l=o.current)==null?void 0:l.style;e?c==null||c.setProperty(mV,e):c==null||c.removeProperty(mV)},[e]),b.jsx(l$e,{...r,className:s,ref:a,"data-kind":n})});ZFe.displayName="Separator";const _N=y.forwardRef(function({className:e,Icon:n,label:r,onSelect:i,checked:s,disabled:o},a){const c=Vb(),l=y.useCallback(()=>{},[]);return b.jsx(Sv,{as:"div",role:"menuitemcheckbox","aria-checked":s,className:e,Icon:n,label:r,onSelect:i,disabled:o,children:b.jsx(Ioe,{id:c,ref:a,"aria-hidden":!0,checked:s,disabled:o,onChange:l})})});y.createContext(null);const QFe={"toast-container":"_toast-container_pnye8_17"};y.forwardRef(function({children:e,className:n,...r},i){const s=Pe(QFe["toast-container"],n);return b.jsx("div",{...r,className:s,ref:i,children:e})});const eBe="_container_1b6mf_17",tBe="_placeholder_1b6mf_56",nBe="_border_1b6mf_60",rBe="_content_1b6mf_69",iBe="_open_1b6mf_117",sBe="_help_1b6mf_121",oBe="_error_1b6mf_126",Ml={container:eBe,placeholder:tBe,border:nBe,content:rBe,open:iBe,help:sBe,error:oBe},aBe=y.forwardRef(function({className:e,label:n,placeholder:r,helpLabel:i,onValueChange:s,error:o,defaultValue:a,values:c,...l},u){const[d,f]=uBe(c,r,a),[p,m,v]=lBe(),{listRef:S,onComboboxKeyDown:_,onOptionKeyDown:w}=dBe(p,m,f),T=y.useRef(null);y.useEffect(()=>{var N;d.value!==void 0&&((N=T.current)==null||N.focus())},[d]);const C=d.text===r,I=Pe({[Ml.placeholder]:C}),R=Pe(Ml.border,{[Ml.open]:p}),O=Pe(Ml.content,{[Ml.open]:p}),A=yf(),U=yf();return b.jsxs("div",{ref:v,className:Pe(e,Ml.container),"aria-invalid":!!o,children:[b.jsx("label",{id:A,children:n}),b.jsxs("button",{className:I,role:"combobox","aria-haspopup":"listbox","aria-labelledby":A,"aria-controls":U,"aria-expanded":p,ref:N=>{T.current=N,typeof u=="function"?u(N):u&&(u.current=N)},onClick:()=>m(N=>!N),onKeyDown:_,...l,children:[d.text,b.jsx(u$e,{width:"24",height:"24"})]}),b.jsx("div",{className:R}),b.jsx("div",{className:O,children:b.jsx("ul",{ref:S,id:U,role:"listbox",className:Ml.content,children:c.map(([N,L])=>b.jsx(cBe,{isDisplayed:p,isSelected:d.value===N,onClick:()=>{m(!1),f({value:N,text:L}),s==null||s(N)},onKeyDown:j=>w(j,N,L),children:L},N))})}),!o&&i&&b.jsx("span",{className:Ml.help,children:i}),o&&b.jsxs("span",{className:Ml.error,children:[b.jsx(CD,{width:"20",height:"20"}),o]})]})}),cBe=y.memo(function({children:e,isSelected:n,isDisplayed:r,...i}){const s=y.useRef(null);return y.useEffect(()=>{var o;n&&r&&((o=s.current)==null||o.focus())},[n,r]),b.jsxs("li",{tabIndex:0,role:"option",ref:s,"aria-selected":n,...i,children:[e," ",n&&b.jsx(Kb,{width:"20",height:"20"})]})});function lBe(){const[t,e]=y.useState(!1),n=y.useRef(null);return y.useEffect(()=>{const r=i=>{n.current&&!n.current.contains(i.target)&&e(!1)};return document.addEventListener("click",r),()=>document.removeEventListener("click",r)},[e]),[t,e,n]}function uBe(t,e,n){return y.useState(()=>{const r={value:void 0,text:e};if(!n)return r;const i=t.find(([s])=>s===n);return i?{value:i[0],text:i[1]}:r})}function dBe(t,e,n){const r=y.useRef(null),i=y.useCallback(({key:o})=>{var a,c;switch(o){case"Escape":e(!1);break;case"ArrowDown":e(!0),t&&((c=(a=r.current)==null?void 0:a.firstElementChild)==null||c.focus());break;case"ArrowUp":e(!0);break;case"Home":{e(!0),Promise.resolve().then(()=>{var l,u;(u=(l=r.current)==null?void 0:l.firstElementChild)==null||u.focus()});break}case"End":{e(!0),Promise.resolve().then(()=>{var l,u;(u=(l=r.current)==null?void 0:l.lastElementChild)==null||u.focus()});break}}},[r,t,e]),s=y.useCallback((o,a,c)=>{var d,f,p,m,v,S,_,w;const{key:l,altKey:u}=o;switch(o.stopPropagation(),o.preventDefault(),l){case"Enter":case" ":{n({text:c,value:a}),e(!1);break}case"Tab":case"Escape":e(!1);break;case"ArrowDown":{const T=document.activeElement;(d=r.current)!=null&&d.contains(T)&&T&&((f=T.nextElementSibling)==null||f.focus());break}case"ArrowUp":{if(u)n({text:c,value:a}),e(!1);else{const T=document.activeElement;(p=r.current)!=null&&p.contains(T)&&T&&((m=T.previousElementSibling)==null||m.focus())}break}case"Home":{(S=(v=r.current)==null?void 0:v.firstElementChild)==null||S.focus();break}case"End":{(w=(_=r.current)==null?void 0:_.lastElementChild)==null||w.focus();break}}},[r,n,e]);return{listRef:r,onComboboxKeyDown:i,onOptionKeyDown:s}}var fBe={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const hBe=es(fBe);var pBe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function vV(t){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(hBe[n[1]]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}for(var i=new RegExp(pBe),s=null;(s=i.exec(t))!==null;)if(s[0].trim())if(s[1]){var o=s[1].trim(),a=[o,""];o.indexOf("=")>-1&&(a=o.split("=")),e.attrs[a[0]]=a[1],i.lastIndex--}else s[2]&&(e.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return e}var gBe=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,mBe=/^\s*$/,vBe=Object.create(null);function Ooe(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?function(n){var r=[];for(var i in n)r.push(i+'="'+n[i]+'"');return r.length?" "+r.join(" "):""}(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(Ooe,"")+"</"+e.name+">";case"comment":return t+"<!--"+e.comment+"-->"}}var yBe={parse:function(t,e){e||(e={}),e.components||(e.components=vBe);var n,r=[],i=[],s=-1,o=!1;if(t.indexOf("<")!==0){var a=t.indexOf("<");r.push({type:"text",content:a===-1?t:t.substring(0,a)})}return t.replace(gBe,function(c,l){if(o){if(c!=="</"+n.name+">")return;o=!1}var u,d=c.charAt(1)!=="/",f=c.startsWith("<!--"),p=l+c.length,m=t.charAt(p);if(f){var v=vV(c);return s<0?(r.push(v),r):((u=i[s]).children.push(v),r)}if(d&&(s++,(n=vV(c)).type==="tag"&&e.components[n.name]&&(n.type="component",o=!0),n.voidElement||o||!m||m==="<"||n.children.push({type:"text",content:t.slice(p,t.indexOf("<",p))}),s===0&&r.push(n),(u=i[s-1])&&u.children.push(n),i[s]=n),(!d||n.voidElement)&&(s>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(s--,n=s===-1?r:i[s]),!o&&m!=="<"&&m)){u=s===-1?r:i[s].children;var S=t.indexOf("<",p),_=t.slice(p,S===-1?void 0:S);mBe.test(_)&&(_=" "),(S>-1&&s+u.length>=0||_!==" ")&&u.push({type:"text",content:_})}}),r},stringify:function(t){return t.reduce(function(e,n){return e+Ooe("",n)},"")}};const LT=(...t)=>{console!=null&&console.warn&&(Sa(t[0])&&(t[0]=`react-i18next:: ${t[0]}`),console.warn(...t))},yV={},kk=(...t)=>{Sa(t[0])&&yV[t[0]]||(Sa(t[0])&&(yV[t[0]]=new Date),LT(...t))},Moe=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},_V=(t,e,n)=>{t.loadNamespaces(e,Moe(t,n))},bV=(t,e,n,r)=>{Sa(n)&&(n=[n]),n.forEach(i=>{t.options.ns.indexOf(i)<0&&t.options.ns.push(i)}),t.loadLanguages(e,Moe(t,r))},_Be=(t,e,n={})=>!e.languages||!e.languages.length?(kk("i18n.languages were undefined or empty",e.languages),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{var s;if(((s=n.bindI18n)==null?void 0:s.indexOf("languageChanging"))>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}),Sa=t=>typeof t=="string",rm=t=>typeof t=="object"&&t!==null,bBe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,SBe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},wBe=t=>SBe[t],EBe=t=>t.replace(bBe,wBe);let M5={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:EBe};const TBe=(t={})=>{M5={...M5,...t}},Aoe=()=>M5;let Loe;const CBe=t=>{Loe=t},bN=()=>Loe,tO=(t,e)=>{var r;if(!t)return!1;const n=((r=t.props)==null?void 0:r.children)??t.children;return e?n.length>0:!!n},nO=t=>{var n,r;if(!t)return[];const e=((n=t.props)==null?void 0:n.children)??t.children;return(r=t.props)!=null&&r.i18nIsDynamicList?im(e):e},kBe=t=>Array.isArray(t)&&t.every(y.isValidElement),im=t=>Array.isArray(t)?t:[t],RBe=(t,e)=>{const n={...e};return n.props=Object.assign(t.props,e.props),n},Doe=(t,e)=>{if(!t)return"";let n="";const r=im(t),i=e!=null&&e.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return r.forEach((s,o)=>{if(Sa(s))n+=`${s}`;else if(y.isValidElement(s)){const{props:a,type:c}=s,l=Object.keys(a).length,u=i.indexOf(c)>-1,d=a.children;if(!d&&u&&!l)n+=`<${c}/>`;else if(!d&&(!u||l)||a.i18nIsDynamicList)n+=`<${o}></${o}>`;else if(u&&l===1&&Sa(d))n+=`<${c}>${d}</${c}>`;else{const f=Doe(d,e);n+=`<${o}>${f}</${o}>`}}else if(s===null)LT("Trans: the passed in value is invalid - seems you passed in a null child.");else if(rm(s)){const{format:a,...c}=s,l=Object.keys(c);if(l.length===1){const u=a?`${l[0]}, ${a}`:l[0];n+=`{{${u}}}`}else LT("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",s)}else LT("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",s)}),n},IBe=(t,e,n,r,i,s)=>{if(e==="")return[];const o=r.transKeepBasicHtmlNodesFor||[],a=e&&new RegExp(o.map(S=>`<${S}`).join("|")).test(e);if(!t&&!a&&!s)return[e];const c={},l=S=>{im(S).forEach(w=>{Sa(w)||(tO(w)?l(nO(w)):rm(w)&&!y.isValidElement(w)&&Object.assign(c,w))})};l(t);const u=yBe.parse(`<0>${e}</0>`),d={...c,...i},f=(S,_,w)=>{var I;const T=nO(S),C=m(T,_.children,w);return kBe(T)&&C.length===0||(I=S.props)!=null&&I.i18nIsDynamicList?T:C},p=(S,_,w,T,C)=>{S.dummy?(S.children=_,w.push(y.cloneElement(S,{key:T},C?void 0:_))):w.push(...y.Children.map([S],I=>{const R={...I.props};return delete R.i18nIsDynamicList,y.createElement(I.type,{...R,key:T,ref:I.ref},C?null:_)}))},m=(S,_,w)=>{const T=im(S);return im(_).reduce((I,R,O)=>{var U,N;const A=((N=(U=R.children)==null?void 0:U[0])==null?void 0:N.content)&&n.services.interpolator.interpolate(R.children[0].content,d,n.language);if(R.type==="tag"){let L=T[parseInt(R.name,10)];w.length===1&&!L&&(L=w[0][R.name]),L||(L={});const j=Object.keys(R.attrs).length!==0?RBe({props:R.attrs},L):L,X=y.isValidElement(j),G=X&&tO(R,!0)&&!R.voidElement,F=a&&rm(j)&&j.dummy&&!X,V=rm(t)&&Object.hasOwnProperty.call(t,R.name);if(Sa(j)){const J=n.services.interpolator.interpolate(j,d,n.language);I.push(J)}else if(tO(j)||G){const J=f(j,R,w);p(j,J,I,O)}else if(F){const J=m(T,R.children,w);p(j,J,I,O)}else if(Number.isNaN(parseFloat(R.name)))if(V){const J=f(j,R,w);p(j,J,I,O,R.voidElement)}else if(r.transSupportBasicHtmlNodes&&o.indexOf(R.name)>-1)if(R.voidElement)I.push(y.createElement(R.name,{key:`${R.name}-${O}`}));else{const J=m(T,R.children,w);I.push(y.createElement(R.name,{key:`${R.name}-${O}`},J))}else if(R.voidElement)I.push(`<${R.name} />`);else{const J=m(T,R.children,w);I.push(`<${R.name}>${J}</${R.name}>`)}else if(rm(j)&&!X){const J=R.children[0]?A:null;J&&I.push(J)}else p(j,A,I,O,R.children.length!==1||!A)}else if(R.type==="text"){const L=r.transWrapTextNodes,j=s?r.unescape(n.services.interpolator.interpolate(R.content,d,n.language)):n.services.interpolator.interpolate(R.content,d,n.language);L?I.push(y.createElement(L,{key:`${R.name}-${O}`},j)):I.push(j)}return I},[])},v=m([{dummy:!0,children:t||[]}],u,im(t||[]));return nO(v[0])};function xBe({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:u,t:d,shouldUnescape:f,...p}){var L,j,X,G,F,V;const m=u||bN();if(!m)return kk("You will need to pass in an i18next instance by using i18nextReactModule"),t;const v=d||m.t.bind(m)||(J=>J),S={...Aoe(),...(L=m.options)==null?void 0:L.react};let _=l||v.ns||((j=m.options)==null?void 0:j.defaultNS);_=Sa(_)?[_]:_||["translation"];const w=Doe(t,S),T=a||w||S.transEmptyNodeValue||r,{hashTransKey:C}=S,I=r||(C?C(w||T):w||T);(G=(X=m.options)==null?void 0:X.interpolation)!=null&&G.defaultVariables&&(o=o&&Object.keys(o).length>0?{...o,...m.options.interpolation.defaultVariables}:{...m.options.interpolation.defaultVariables});const R=o||e!==void 0&&!((V=(F=m.options)==null?void 0:F.interpolation)!=null&&V.alwaysFormat)||!t?s.interpolation:{interpolation:{...s.interpolation,prefix:"#$?",suffix:"?$#"}},O={...s,context:i||s.context,count:e,...o,...R,defaultValue:T,ns:_},A=I?v(I,O):T;c&&Object.keys(c).forEach(J=>{const K=c[J];if(typeof K.type=="function"||!K.props||!K.props.children||A.indexOf(`${J}/>`)<0&&A.indexOf(`${J} />`)<0)return;function W(){return y.createElement(y.Fragment,null,K)}c[J]=y.createElement(W)});const U=IBe(c||t,A,m,S,O,f),N=n??S.defaultTransParent;return N?y.createElement(N,p,U):U}const PBe={type:"3rdParty",init(t){TBe(t.options.react),CBe(t)}},Noe=y.createContext();class OBe{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{var r;(r=this.usedNamespaces)[n]??(r[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function ps({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:u,t:d,shouldUnescape:f,...p}){var w;const{i18n:m,defaultNS:v}=y.useContext(Noe)||{},S=u||m||bN(),_=d||(S==null?void 0:S.t.bind(S));return xBe({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s,values:o,defaults:a,components:c,ns:l||(_==null?void 0:_.ns)||v||((w=S==null?void 0:S.options)==null?void 0:w.defaultNS),i18n:S,t:d,shouldUnescape:f,...p})}const MBe=(t,e)=>{const n=y.useRef();return y.useEffect(()=>{n.current=t},[t,e]),n.current},Uoe=(t,e,n,r)=>t.getFixedT(e,n,r),ABe=(t,e,n,r)=>y.useCallback(Uoe(t,e,n,r),[t,e,n,r]),ht=(t,e={})=>{var C,I,R,O;const{i18n:n}=e,{i18n:r,defaultNS:i}=y.useContext(Noe)||{},s=n||r||bN();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new OBe),!s){kk("You will need to pass in an i18next instance by using initReactI18next");const A=(N,L)=>Sa(L)?L:rm(L)&&Sa(L.defaultValue)?L.defaultValue:Array.isArray(N)?N[N.length-1]:N,U=[A,{},!1];return U.t=A,U.i18n={},U.ready=!1,U}(C=s.options.react)!=null&&C.wait&&kk("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...Aoe(),...s.options.react,...e},{useSuspense:a,keyPrefix:c}=o;let l=i||((I=s.options)==null?void 0:I.defaultNS);l=Sa(l)?[l]:l||["translation"],(O=(R=s.reportNamespaces).addUsedNamespaces)==null||O.call(R,l);const u=(s.isInitialized||s.initializedStoreOnce)&&l.every(A=>_Be(A,s,o)),d=ABe(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),f=()=>d,p=()=>Uoe(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),[m,v]=y.useState(f);let S=l.join();e.lng&&(S=`${e.lng}${S}`);const _=MBe(S),w=y.useRef(!0);y.useEffect(()=>{const{bindI18n:A,bindI18nStore:U}=o;w.current=!0,!u&&!a&&(e.lng?bV(s,e.lng,l,()=>{w.current&&v(p)}):_V(s,l,()=>{w.current&&v(p)})),u&&_&&_!==S&&w.current&&v(p);const N=()=>{w.current&&v(p)};return A&&(s==null||s.on(A,N)),U&&(s==null||s.store.on(U,N)),()=>{w.current=!1,s&&(A==null||A.split(" ").forEach(L=>s.off(L,N))),U&&s&&U.split(" ").forEach(L=>s.store.off(L,N))}},[s,S]),y.useEffect(()=>{w.current&&u&&v(f)},[s,c,u]);const T=[m,s,u];if(T.t=m,T.i18n=s,T.ready=u,u||!u&&!a)return T;throw new Promise(A=>{e.lng?bV(s,e.lng,l,()=>A()):_V(s,l,()=>A())})};function $oe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"m13.3 17.3-4.6-4.6a.877.877 0 0 1-.213-.325A1.106 1.106 0 0 1 8.425 12c0-.133.02-.258.062-.375A.878.878 0 0 1 8.7 11.3l4.6-4.6a.948.948 0 0 1 .7-.275.95.95 0 0 1 .7.275.948.948 0 0 1 .275.7.948.948 0 0 1-.275.7L10.8 12l3.9 3.9a.949.949 0 0 1 .275.7.948.948 0 0 1-.275.7.948.948 0 0 1-.7.275.948.948 0 0 1-.7-.275Z"})})}$oe.displayName="ChevronLeftIcon";const LBe=y.forwardRef($oe);function Foe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 11.034a.996.996 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 1 0 0-2h-5.586L22 3.446a1 1 0 0 0-1.414-1.415L14 8.617V3.031a1 1 0 1 0-2 0v8.003Zm0 1.963a.997.997 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 11 12H3a1 1 0 0 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 1 0 2 0v-8.003Z"})})}Foe.displayName="CollapseIcon";const DBe=y.forwardRef(Foe);function Boe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M7 21c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 5 19V6a.968.968 0 0 1-.713-.287A.968.968 0 0 1 4 5c0-.283.096-.52.287-.713A.968.968 0 0 1 5 4h4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 10 3h4a.97.97 0 0 1 .713.288A.968.968 0 0 1 15 4h4a.97.97 0 0 1 .712.287c.192.192.288.43.288.713s-.096.52-.288.713A.968.968 0 0 1 19 6v13c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 17 21H7ZM7 6v13h10V6H7Zm2 10c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 11 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 10 8a.968.968 0 0 0-.713.287A.968.968 0 0 0 9 9v7Zm4 0c0 .283.096.52.287.712.192.192.43.288.713.288s.52-.096.713-.288A.968.968 0 0 0 15 16V9a.967.967 0 0 0-.287-.713A.968.968 0 0 0 14 8a.968.968 0 0 0-.713.287A.967.967 0 0 0 13 9v7Z"})})}Boe.displayName="DeleteIcon";const NBe=y.forwardRef(Boe);function joe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.212l1.414-5.657a1 1 0 0 1 .263-.465L15.706 2.637Zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.77 3.771-.942L16.93 9.9Z",clipRule:"evenodd"})})}joe.displayName="EditIcon";const SV=y.forwardRef(joe);function Hoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.018 1.018 0 0 1 0 12.852c0-.304.098-.555.295-.751a15.64 15.64 0 0 1 5.316-3.786A15.89 15.89 0 0 1 12 7c2.237 0 4.367.443 6.39 1.329a15.977 15.977 0 0 1 5.315 3.772c.197.196.295.447.295.751 0 .305-.098.555-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.067 1.067 0 0 1-.322-.376 1.066 1.066 0 0 1-.108-.483v-2.27a13.593 13.593 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.175.175c-.715.116-1.422.29-2.12.523v2.271c0 .179-.036.34-.108.483a1.066 1.066 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107Z"})})}Hoe.displayName="EndCallIcon";const UBe=y.forwardRef(Hoe);function Koe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M21 3.997a.996.996 0 0 0-.29-.702l-.005-.004A.997.997 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a.997.997 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0V3.997Z"})})}Koe.displayName="ExpandIcon";const Voe=y.forwardRef(Koe);function qoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M4 11a.967.967 0 0 1-.712-.287A.968.968 0 0 1 3 10V4c0-.283.096-.52.288-.712A.968.968 0 0 1 4 3h6a.97.97 0 0 1 .713.288A.968.968 0 0 1 11 4v6c0 .283-.096.52-.287.713A.968.968 0 0 1 10 11H4Zm5-2V5H5v4h4Zm5 12a.968.968 0 0 1-.713-.288A.968.968 0 0 1 13 20v-6c0-.283.096-.52.287-.713A.968.968 0 0 1 14 13h6a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v6c0 .283-.096.52-.288.712A.968.968 0 0 1 20 21h-6Zm5-2v-4h-4v4h4ZM4 21a.967.967 0 0 1-.712-.288A.968.968 0 0 1 3 20v-6a.97.97 0 0 1 .288-.713A.967.967 0 0 1 4 13h6c.283 0 .52.096.713.287.191.192.287.43.287.713v6a.97.97 0 0 1-.287.712A.968.968 0 0 1 10 21H4Zm5-2v-4H5v4h4Zm5-8a.968.968 0 0 1-.713-.287A.968.968 0 0 1 13 10V4a.97.97 0 0 1 .287-.712A.968.968 0 0 1 14 3h6c.283 0 .52.096.712.288A.965.965 0 0 1 21 4v6a.97.97 0 0 1-.288.713A.968.968 0 0 1 20 11h-6Zm5-2V5h-4v4h4Z"})})}qoe.displayName="GridIcon";const $Be=y.forwardRef(qoe);function Goe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 19.071c-.978.978-2.157 1.467-3.536 1.467-1.378 0-2.557-.489-3.535-1.467-.978-.978-1.467-2.157-1.467-3.536 0-1.378.489-2.557 1.467-3.535L7.05 9.879c.2-.2.436-.3.707-.3.271 0 .507.1.707.3.2.2.301.436.301.707 0 .27-.1.506-.3.707l-2.122 2.121a2.893 2.893 0 0 0-.884 2.122c0 .824.295 1.532.884 2.12.59.59 1.296.885 2.121.885s1.533-.295 2.122-.884l2.121-2.121c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707L12 19.07Zm-1.414-4.243c-.2.2-.436.3-.707.3a.967.967 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l4.243-4.242c.2-.2.436-.301.707-.301.271 0 .507.1.707.3.2.2.3.437.3.708 0 .27-.1.506-.3.707l-4.242 4.242Zm6.364-.707c-.2.2-.436.3-.707.3a.968.968 0 0 1-.707-.3.969.969 0 0 1-.301-.707c0-.27.1-.507.3-.707l2.122-2.121c.59-.59.884-1.297.884-2.122s-.295-1.532-.884-2.12a2.893 2.893 0 0 0-2.121-.885c-.825 0-1.532.295-2.122.884l-2.121 2.121c-.2.2-.436.301-.707.301a.968.968 0 0 1-.707-.3.97.97 0 0 1-.3-.708c0-.27.1-.506.3-.707L12 4.93c.978-.978 2.157-1.467 3.536-1.467 1.378 0 2.557.489 3.535 1.467.978.978 1.467 2.157 1.467 3.535 0 1.38-.489 2.558-1.467 3.536l-2.121 2.121Z"})})}Goe.displayName="LinkIcon";const FBe=y.forwardRef(Goe);function zoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.587-1.412.212-.212.446-.366.703-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 0 1-1.414 1.414l-.896-.896A1.935 1.935 0 0 1 18 22H6Zm14-4.834V10c0-.55-.196-1.02-.587-1.412A1.926 1.926 0 0 0 18 8h-1V6c0-1.383-.488-2.563-1.463-3.538C14.563 1.487 13.383 1 12 1s-2.563.488-3.538 1.462A4.876 4.876 0 0 0 7.243 4.41L9 6.166V6c0-.833.292-1.542.875-2.125A2.893 2.893 0 0 1 12 3c.833 0 1.542.292 2.125.875S15 5.167 15 6v2h-4.166L20 17.166Z"})})}zoe.displayName="LockOffIcon";const BBe=y.forwardRef(zoe);function Woe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M6 22c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 20V10c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 8h1V6c0-1.383.487-2.563 1.463-3.538C9.438 1.487 10.617 1 12 1s2.563.488 3.537 1.462C16.512 3.438 17 4.617 17 6v2h1c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412v10c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 22H6ZM9 8h6V6c0-.833-.292-1.542-.875-2.125A2.893 2.893 0 0 0 12 3c-.833 0-1.542.292-2.125.875A2.893 2.893 0 0 0 9 6v2Z"})})}Woe.displayName="LockSolidIcon";const jBe=y.forwardRef(Woe);function Yoe(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.949 7.949 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Zm9.417 6.583 1.478 1.477A7.963 7.963 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583ZM8.073 5.238l7.793 7.793c.087-.329.134-.674.134-1.031V6a4 4 0 0 0-7.927-.762Z"})})}Yoe.displayName="MicOffSolidIcon";const Joe=y.forwardRef(Yoe);function Xoe(t,e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[b.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.947 7.947 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5L8 8Z",clipRule:"evenodd"}),b.jsx("path",{d:"M14 6v5.166l1.866 1.866c.087-.33.134-.675.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0Zm3.417 8.583 1.477 1.477A7.963 7.963 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583Z"})]})}Xoe.displayName="MicOffIcon";const HBe=y.forwardRef(Xoe);function Zoe(t,e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[b.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0V6Z"}),b.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8.001 8.001 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8.001 8.001 0 0 1 4 12a1 1 0 0 1 1-1Z"})]})}Zoe.displayName="MicOnSolidIcon";const Qoe=y.forwardRef(Zoe);function eae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M6 14c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 4 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 6 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 6 14Zm6 0c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 12c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 10c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412A1.926 1.926 0 0 1 12 14Zm6 0c-.55 0-1.02-.196-1.413-.588A1.926 1.926 0 0 1 16 12c0-.55.196-1.02.587-1.412A1.926 1.926 0 0 1 18 10c.55 0 1.02.196 1.413.588.391.391.587.862.587 1.412 0 .55-.196 1.02-.587 1.412A1.926 1.926 0 0 1 18 14Z"})})}eae.displayName="OverflowHorizontalIcon";const KBe=y.forwardRef(eae);function tae(t,e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[b.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z"}),b.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2Z"})]})}tae.displayName="PopOutIcon";const VBe=y.forwardRef(tae);function nae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286.085.034.17.07.253.106.531.23 1.162.16 1.572-.25a1.269 1.269 0 0 1 1.794 0l1.034 1.035a1.269 1.269 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572.036.084.07.168.105.253.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935-.033.085-.068.17-.104.253-.232.531-.161 1.162.248 1.572a1.269 1.269 0 0 1 0 1.794l-1.034 1.034a1.269 1.269 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a7.935 7.935 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a7.975 7.975 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.269 1.269 0 0 1-1.794 0l-1.034-1.034a1.269 1.269 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a7.89 7.89 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935.034-.085.07-.17.106-.253.23-.531.16-1.162-.25-1.572a1.269 1.269 0 0 1 0-1.794l1.035-1.034a1.269 1.269 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a7.93 7.93 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2h1.462ZM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"})})}nae.displayName="SettingsSolidIcon";const qBe=y.forwardRef(nae);function rae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M1.288 20.712A.965.965 0 0 0 2 21h20c.283 0 .52-.096.712-.288A.968.968 0 0 0 23 20a.968.968 0 0 0-.288-.712A.968.968 0 0 0 22 19H2a.967.967 0 0 0-.712.288A.968.968 0 0 0 1 20c0 .283.096.52.288.712Zm1.299-3.299A1.926 1.926 0 0 1 2 16V5c0-.55.196-1.02.587-1.413A1.926 1.926 0 0 1 4 3h16c.55 0 1.02.196 1.413.587.39.393.587.863.587 1.413v11c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 20 18H4c-.55 0-1.02-.196-1.413-.587Zm10.12-10.12a1 1 0 0 0-1.414 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414l-2.5-2.5Z"})})}rae.displayName="ShareScreenSolidIcon";const GBe=y.forwardRef(rae);function iae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M12 16a.968.968 0 0 1-.713-.287A.967.967 0 0 1 11 15V7.85L9.125 9.725c-.2.2-.433.3-.7.3-.267 0-.508-.108-.725-.325a.93.93 0 0 1-.288-.712A.977.977 0 0 1 7.7 8.3l3.6-3.6c.1-.1.208-.17.325-.212.117-.042.242-.063.375-.063s.258.02.375.063a.877.877 0 0 1 .325.212l3.6 3.6c.2.2.296.438.287.713a.977.977 0 0 1-.287.687c-.2.2-.438.304-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15c0 .283-.096.52-.287.713A.968.968 0 0 1 12 16Zm-6 4c-.55 0-1.02-.196-1.412-.587A1.926 1.926 0 0 1 4 18v-2c0-.283.096-.52.287-.713A.968.968 0 0 1 5 15c.283 0 .52.096.713.287.191.192.287.43.287.713v2h12v-2a.97.97 0 0 1 .288-.713A.968.968 0 0 1 19 15a.97.97 0 0 1 .712.287c.192.192.288.43.288.713v2c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 18 20H6Z"})})}iae.displayName="ShareIcon";const zBe=y.forwardRef(iae);function sae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5V5Zm10 14v-4h4v4h-4ZM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2Z"})})}sae.displayName="SpotlightIcon";const WBe=y.forwardRef(sae);function oae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M10 12c-1.1 0-2.042-.392-2.825-1.175C6.392 10.042 6 9.1 6 8s.392-2.042 1.175-2.825C7.958 4.392 8.9 4 10 4s2.042.392 2.825 1.175C13.608 5.958 14 6.9 14 8s-.392 2.042-1.175 2.825C12.042 11.608 11.1 12 10 12Zm-8 6v-.8c0-.567.146-1.087.438-1.563A2.911 2.911 0 0 1 3.6 14.55a14.843 14.843 0 0 1 3.15-1.163A13.76 13.76 0 0 1 10 13c1.1 0 2.183.13 3.25.387 1.067.259 2.117.646 3.15 1.163.483.25.87.612 1.163 1.087.291.476.437.996.437 1.563v.8c0 .55-.196 1.02-.587 1.413A1.926 1.926 0 0 1 16 20H4c-.55 0-1.02-.196-1.413-.587A1.926 1.926 0 0 1 2 18Zm2 0h12v-.8a.973.973 0 0 0-.5-.85c-.9-.45-1.808-.787-2.725-1.012a11.6 11.6 0 0 0-5.55 0c-.917.225-1.825.562-2.725 1.012a.973.973 0 0 0-.5.85v.8Zm6-8c.55 0 1.02-.196 1.412-.588C11.804 9.021 12 8.55 12 8c0-.55-.196-1.02-.588-1.412A1.926 1.926 0 0 0 10 6c-.55 0-1.02.196-1.412.588A1.926 1.926 0 0 0 8 8c0 .55.196 1.02.588 1.412.391.392.862.588 1.412.588Zm7 1h2v2c0 .283.096.52.288.713.191.191.429.287.712.287s.52-.096.712-.287A.968.968 0 0 0 21 13v-2h2a.97.97 0 0 0 .712-.287A.968.968 0 0 0 24 10a.967.967 0 0 0-.288-.713A.968.968 0 0 0 23 9h-2V7a.967.967 0 0 0-.288-.713A.968.968 0 0 0 20 6a.968.968 0 0 0-.712.287A.967.967 0 0 0 19 7v2h-2a.968.968 0 0 0-.712.287A.967.967 0 0 0 16 10c0 .283.096.52.288.713A.968.968 0 0 0 17 11Z"})})}oae.displayName="UserAddIcon";const YBe=y.forwardRef(oae);function aae(t,e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[b.jsx("path",{d:"M9.175 13.825C9.958 14.608 10.9 15 12 15s2.042-.392 2.825-1.175C15.608 13.042 16 12.1 16 11s-.392-2.042-1.175-2.825C14.042 7.392 13.1 7 12 7s-2.042.392-2.825 1.175C8.392 8.958 8 9.9 8 11s.392 2.042 1.175 2.825Zm4.237-1.412A1.926 1.926 0 0 1 12 13c-.55 0-1.02-.196-1.412-.588A1.926 1.926 0 0 1 10 11c0-.55.196-1.02.588-1.412A1.926 1.926 0 0 1 12 9c.55 0 1.02.196 1.412.588.392.391.588.862.588 1.412 0 .55-.196 1.02-.588 1.412Z"}),b.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Zm-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0Z"}),b.jsx("path",{d:"M16.23 18.792a12.47 12.47 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0c-.487.12-.972.271-1.455.455a8.04 8.04 0 0 1-1.729-1.454c.89-.412 1.794-.729 2.709-.95A13.76 13.76 0 0 1 12 16c1.1 0 2.183.13 3.25.387a14.78 14.78 0 0 1 2.709.95 8.042 8.042 0 0 1-1.73 1.455Z"})]})}aae.displayName="UserProfileIcon";const cae=y.forwardRef(aae);function lae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A1.992 1.992 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414ZM18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715v1.45Z"})})}lae.displayName="VideoCallOffSolidIcon";const JBe=y.forwardRef(lae);function uae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4Z"})})}uae.displayName="VideoCallSolidIcon";const XBe=y.forwardRef(uae);function dae(t,e){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:b.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5ZM7.172 10H5v4h2.828L10 16.17v-3.343L7.172 10Zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 2.987 2.987 0 0 1 .874 2.284Zm3.164 3.164 1.462 1.462A8.961 8.961 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.966 6.966 0 0 1-.84 3.326ZM8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707L8.917 6.083Z"})})}dae.displayName="VolumeOffIcon";const ZBe=y.forwardRef(dae);function fae(t,e){return b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[b.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4Zm4.828 4L10 16.172V7.828L7.828 10H5v4h2.828Zm6.293-5.536a1 1 0 0 1 1.415 0A4.988 4.988 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 2.987 2.987 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414Z"}),b.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.975 6.975 0 0 1 19 12a6.975 6.975 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.975 8.975 0 0 0 21 12a8.975 8.975 0 0 0-2.636-6.364Z"})]})}fae.displayName="VolumeOnIcon";const QBe=y.forwardRef(fae),eje="_header_lacrf_8",tje="_nav_lacrf_18",nje="_headerLogo_lacrf_26",rje="_leftNav_lacrf_33",ije="_hideMobile_lacrf_33",sje="_rightNav_lacrf_45",oje="_roomHeaderInfo_lacrf_61",aje="_roomAvatar_lacrf_76",cje="_nameLine_lacrf_81",lje="_participantsLine_lacrf_100",ga={header:eje,nav:tje,headerLogo:nje,leftNav:rje,hideMobile:ije,rightNav:sje,roomHeaderInfo:oje,roomAvatar:aje,nameLine:cje,participantsLine:lje},uje=(t,e)=>y.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("desc",null,"Element Call (Beta)"),y.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),y.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),y.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),y.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),y.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),y.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),y.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),y.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),y.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),y.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),y.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),y.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),y.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),y.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),dje=y.forwardRef(uje);function fje(t){return new Worker("/assets/IndexedDBWorker-l0rT-Ruh.js",{name:t==null?void 0:t.name})}const A5={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},eula:"https://static.element.io/legal/online-EULA.pdf"};let on=class Fa{static get(){var e;if(!((e=this.internalInstance)!=null&&e.config))throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){var e;if(!((e=Fa.internalInstance)!=null&&e.initPromise)){const n=new Fa;Fa.internalInstance=n,Fa.internalInstance.initPromise=hje("../config.json").then(r=>{n.config={...A5,...r}})}return Fa.internalInstance.initPromise}static initDefault(){Fa.internalInstance=new Fa,Fa.internalInstance.config={...A5}}static defaultHomeserverUrl(){var e;return hc().homeserver??((e=Fa.get().default_server_config)==null?void 0:e["m.homeserver"].base_url)}static defaultServerName(){var n;const e=hc().homeserver;return e?new URL(e).hostname:(n=Fa.get().default_server_config)==null?void 0:n["m.homeserver"].server_name}};async function hje(t){const e=new URL(t,window.location.href);e.searchParams.set("cachebuster",Date.now().toString());const n=await fetch(e,{cache:"no-cache",method:"GET"});return!n.ok||n.status===404||n.status===0?A5:n.json()}var En=(t=>(t[t.NONE=0]="NONE",t[t.PER_PARTICIPANT=1]="PER_PARTICIPANT",t[t.SHARED_KEY=2]="SHARED_KEY",t))(En||{});function pje(t,e){const n=t.indexOf("?"),r=e(new URLSearchParams(n===-1?"":t.substring(n)));return`${t.substring(0,n)}?${r.toString()}`}class hae{constructor(e,n){this.queryParams=new URLSearchParams(e);const r=n.indexOf("?");this.fragmentParams=new URLSearchParams(r===-1?"":n.substring(r))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,n=!1){const r=this.getParam(e);return r===null?n:r!=="false"}}const hc=(t=window.location.search,e=window.location.hash)=>{const n=new hae(t,e),r=parseFloat(n.getParam("fontScale")??"");return{widgetId:n.getParam("widgetId"),parentUrl:n.getParam("parentUrl"),roomId:n.getParam("roomId"),password:n.getParam("password"),confineToRoom:n.getFlagParam("confineToRoom")||n.getFlagParam("embed"),appPrompt:n.getFlagParam("appPrompt",!0),preload:n.getFlagParam("preload"),hideHeader:n.getFlagParam("hideHeader"),showControls:n.getFlagParam("showControls",!0),hideScreensharing:n.getFlagParam("hideScreensharing"),e2eEnabled:n.getFlagParam("enableE2EE",!0),userId:n.getParam("userId"),displayName:n.getParam("displayName"),deviceId:n.getParam("deviceId"),baseUrl:n.getParam("baseUrl"),lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,analyticsID:n.getParam("analyticsID"),allowIceFallback:n.getFlagParam("allowIceFallback"),perParticipantE2EE:n.getFlagParam("perParticipantE2EE"),skipLobby:n.getFlagParam("skipLobby"),returnToLobby:n.getFlagParam("returnToLobby"),theme:n.getParam("theme"),viaServers:n.getParam("viaServers"),homeserver:n.getParam("homeserver")}},Fp=()=>{const{search:t,hash:e}=Ku();return y.useMemo(()=>hc(t,e),[t,e])};function gje(t,e,n){let r=null;t=t.substring(1);const i=t.split("/"),s=i[0]=="room",o=i.length>1;n===""||n.startsWith("#?")?(o&&s&&(r=i[1]),s||(r=i[0])):r=n,r=(r==null?void 0:r.split("?")[0])??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${on.defaultServerName()}`)));const a=new hae(e,n);let c=a.getParam("roomId");return c!=null&&c.startsWith("!")&&c.includes("")||(c=null),{roomAlias:r,roomId:c,viaServers:a.getAllParams("viaServers")}}const mje=()=>{const{pathname:t,search:e,hash:n}=Ku();return y.useMemo(()=>gje(t,e,n),[t,e,n])};function vje(t,e,n){const r=new URLSearchParams;switch(e==null?void 0:e.kind){case En.SHARED_KEY:{const i=encodeURIComponent(e.secret);i!==e.secret&&k.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",i);break}case En.PER_PARTICIPANT:r.set("perParticipantE2EE","true");break}return r.set("roomId",t),r}const DT=new d4,yje=t=>{const[e,n]=y.useState(()=>localStorage.getItem(t));return y.useEffect(()=>(DT.on(t,n),()=>{DT.off(t,n)}),[t,n]),[e,y.useCallback(r=>{n(r),localStorage.setItem(t,r),DT.emit(t,r)},[t,n])]},_je=(t,e)=>{localStorage.setItem(t,e),DT.emit(t,e)};function pae(t,e){_je(SN(t),e)}const SN=t=>`room-shared-key-${t}`,bje=t=>{const e=SN(t);return yje(e)[0]};function Sje(t){gae(hc());const e=SN(t);return localStorage.getItem(e)}function gae(t){!t.password||!t.roomId||pae(t.roomId,t.password)}const wje=()=>{const t=Fp();return y.useEffect(()=>gae(t),[t]),t.roomId&&t.password?[t.roomId,t.password]:[void 0,void 0]};function QR(t){const{client:e}=Df(),[n,r]=wje(),i=bje(t),s=e==null?void 0:e.getRoom(t);return y.useMemo(()=>s?i?{kind:En.SHARED_KEY,secret:i}:n===t?{kind:En.SHARED_KEY,secret:r}:s.hasEncryptionStateEvent()?{kind:En.PER_PARTICIPANT}:{kind:En.NONE}:{kind:En.NONE},[r,s,t,i,n])}const L5=!1,Eje="element-call-sync";async function Tje(t){let e=!!await t.store.getSavedSyncToken();return new Promise((n,r)=>{const i=(s,o,a)=>{s==="PREPARED"?e?e=!1:(t.removeListener(qe.Sync,i),n()):s==="ERROR"&&(t.removeListener(qe.Sync,i),r(a==null?void 0:a.error))};t.on(qe.Sync,i)})}async function wN(t,e){var a;let n;try{n=window.indexedDB}catch(c){k.warn("Could not get indexDB from window.",c)}const r={fallbackICEServerAllowed:L5,isVoipWithNoMediaAllowed:(a=on.get().features)==null?void 0:a.feature_group_calls_without_video_and_audio};n&&localStorage?r.store=new yX({indexedDB:window.indexedDB,localStorage,dbName:Eje,workerFactory:()=>new fje}):localStorage&&(r.store=new t_({localStorage}));const{e2eEnabled:i}=hc();i||k.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=Y2({...r,...t,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:i,fallbackICEServerAllowed:L5});e||await s.clearStores();try{await s.store.startup()}catch(c){k.error("Error starting matrix client indexDB store. Falling back to memory store.",c),s.store=new t_({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(c){k.warn(c,"Make sure to clear client stores before initializing the rust crypto.")}s.setGlobalErrorOnUnknownDevices(!1);const o=Tje(s);return await s.startClient({clientWellKnownPollPeriod:60*10}),await o,s}function qb(t){return t.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function Cje(t,e){return`#${qb(t)}:${e.getDomain()}`}function mae(t){const e=t.split(":",2);if(e.length===2&&e[0][0]==="#"){if(e[1]===on.defaultServerName())return e[0];throw new Error("Unsupported remote room alias")}return t}async function vae(t,e,n){k.log("Creating room for group call");const r=t.createRoom({visibility:A4.Private,preset:Tb.PublicChat,name:e,room_alias_name:n?void 0:qb(e),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[t.getUserId()]:100}}}),i=await new Promise((o,a)=>{r.catch(u=>{a(u),l()});const c=u=>{r.then(d=>{u.roomId===d.room_id&&(o(u.roomId),l())},d=>{k.error("Failed to wait for the room to arrive",d)})},l=()=>{t.off(qe.Room,c)};t.on(qe.Room,c)});let s;return n==En.SHARED_KEY&&(s=oJ(16),pae(i,s)),{roomId:i,alias:n?void 0:Cje(e,t),password:s}}function yae(t,e,n,r){return`${window.location.protocol}//${window.location.host}${eI(t,e,n)}`}function eI(t,e,n,r){return`/room/#${n?"/"+qb(n):""}?${vje(t,e).toString()}`}function kje(t,e,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),s=n<=96?"crop":"scale";return e&&t.mxcUrlToHttp(e,r,i,s)}var ay=(t=>(t.XS="xs",t.SM="sm",t.MD="md",t.LG="lg",t.XL="xl",t))(ay||{});const Rje=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]),cy=({className:t,id:e,name:n,src:r,size:i="md"})=>{const{client:s}=Df(),o=y.useMemo(()=>Object.values(ay).includes(i)?Rje.get(i):i,[i]),a=y.useMemo(()=>{if(!(!s||!r||!o))return r.startsWith("mxc://")?kje(s,r,o):r},[s,r,o]);return b.jsx(N$e,{className:t,id:e,name:n,size:`${o}px`,src:a})},Ije="_lock_1dcx8_8",xje={lock:Ije},Pje=({encrypted:t})=>{const{t:e}=ht(),n=t?jBe:BBe,r=e(t?"common.encrypted":"common.unencrypted");return b.jsx(Ao,{label:r,placement:"right",isTriggerInteractive:!1,children:b.jsx(n,{width:16,height:16,className:xje.lock,"data-encrypted":t})})};function S0(t,e,n,r){y.useEffect(()=>{if(t)return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)},[t,e,n,r])}function _ae(t,e,n){y.useEffect(()=>(t.on(e,n),()=>{t.off(e,n)}),[t,e,n])}function tI(t){const e=y.useMemo(()=>matchMedia(t),[t]),[n,r]=y.useState(0);return S0(e,"change",y.useCallback(()=>r(i=>i+1),[r])),y.useMemo(()=>e.matches,[e,n])}const Af=y.forwardRef(({children:t,className:e,...n},r)=>b.jsx("header",{ref:r,className:Pe(ga.header,e),...n,children:t}));Af.displayName="Header";const Bp=({children:t,className:e,hideMobile:n,...r})=>b.jsx("div",{className:Pe(ga.nav,ga.leftNav,{[ga.hideMobile]:n},e),...r,children:t}),jp=({children:t,className:e,hideMobile:n,...r})=>b.jsx("div",{className:Pe(ga.nav,ga.rightNav,{[ga.hideMobile]:n},e),...r,children:t}),gp=({className:t})=>{const{t:e}=ht();return b.jsx(cD,{className:Pe(ga.headerLogo,t),to:"/","aria-label":e("header_label"),children:b.jsx(dje,{})})},bae=({id:t,name:e,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:s}=ht(),o=tI("(max-width: 550px)")?"sm":"lg";return b.jsxs("div",{className:ga.roomHeaderInfo,"data-size":o,children:[b.jsx(cy,{className:ga.roomAvatar,id:t,name:e,size:o==="sm"?ay.SM:56,src:n??void 0}),b.jsxs("div",{className:ga.nameLine,children:[b.jsx(ul,{type:o==="sm"?"body":"heading",size:o==="sm"?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:e}),b.jsx(Pje,{encrypted:r})]}),(i??0)>0&&b.jsxs("div",{className:ga.participantsLine,children:[b.jsx(cae,{width:20,height:20,"aria-label":s("header_participants_label")}),b.jsx(Mn,{as:"span",size:"sm",weight:"medium",children:s("participant_count",{count:i??0})})]})]})},Oje="_endCall_56is2_8",Mje={endCall:Oje},Sae=({muted:t,...e})=>{const{t:n}=ht(),r=t?Joe:Qoe,i=n(t?"unmute_microphone_button_label":"mute_microphone_button_label");return b.jsx(Ao,{label:i,children:b.jsx(tn,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},wae=({muted:t,...e})=>{const{t:n}=ht(),r=t?JBe:XBe,i=n(t?"start_video_button_label":"stop_video_button_label");return b.jsx(Ao,{label:i,children:b.jsx(tn,{iconOnly:!0,Icon:r,kind:t?"primary":"secondary",...e})})},Aje=({enabled:t,...e})=>{const{t:n}=ht(),r=n(t?"stop_screenshare_button_label":"screenshare_button_label");return b.jsx(Ao,{label:r,children:b.jsx(tn,{iconOnly:!0,Icon:GBe,kind:t?"primary":"secondary",...e})})},Eae=({className:t,...e})=>{const{t:n}=ht();return b.jsx(Ao,{label:n("hangup_button_label"),children:b.jsx(tn,{className:Pe(t,Mje.endCall),iconOnly:!0,Icon:UBe,destructive:!0,...e})})},Tae=t=>{const{t:e}=ht();return b.jsx(Ao,{label:e("common.settings"),children:b.jsx(tn,{iconOnly:!0,Icon:qBe,kind:"secondary",...t})})};function Rk(t){const e=y.useRef(t);return e.current=t,e}const Lje="_external_h3elq_8",Dje={external:Lje};function Cae(t,e){const n=Rk(e),r=gc(),i=y.useMemo(()=>typeof t=="string"?t:cs(t),[t]),s=y.useCallback(o=>{o.preventDefault(),r.push(t,n.current)},[r,t,n]);return[i,s]}const Lo=y.forwardRef(function({to:e,state:n,...r},i){const[s,o]=Cae(e,n);return b.jsx(X$e,{ref:i,...r,href:s,onClick:o})}),Hh=y.forwardRef(function({className:e,children:n,...r},i){return b.jsx("a",{ref:i,className:Pe(e,Dje.external),target:"_blank",rel:"noreferrer noopener",...r,children:n})}),EN=y.forwardRef(function({to:e,...n},r){const[i,s]=Cae(e);return b.jsx(tn,{as:"a",ref:r,...n,href:i,onClick:s})}),Nje="_page_1poud_8",Uje="_header_1poud_16",$je="_container_1poud_20",Fje="_content_1poud_28",Bje="_wideButton_1poud_47",jje="_sendLogsSection_1poud_52",Nm={page:Nje,header:Uje,container:$je,content:Fje,wideButton:Bje,sendLogsSection:jje};class TN extends Error{constructor(e,n){super(n(e,{lng:"en-GB"})),this.translatedMessage=n(e)}}class Hje extends TN{}const D5=(t,e)=>new Hje(t,e),Kje="_rageshakeControl_1hlf3_8",wV={rageshakeControl:Kje};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const Vje=4,EV=0,TV=1,qje=2;function ly(t){let e=t.length;for(;--e>=0;)t[e]=0}const Gje=0,kae=1,zje=2,Wje=3,Yje=258,CN=29,Gb=256,U_=Gb+1+CN,Um=30,kN=19,Rae=2*U_+1,wh=15,rO=16,Jje=7,RN=256,Iae=16,xae=17,Pae=18,N5=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),NT=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Xje=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Oae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zje=512,Xl=new Array((U_+2)*2);ly(Xl);const w0=new Array(Um*2);ly(w0);const $_=new Array(Zje);ly($_);const F_=new Array(Yje-Wje+1);ly(F_);const IN=new Array(CN);ly(IN);const Ik=new Array(Um);ly(Ik);function iO(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Mae,Aae,Lae;function sO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const Dae=t=>t<256?$_[t]:$_[256+(t>>>7)],B_=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Gs=(t,e,n)=>{t.bi_valid>rO-n?(t.bi_buf|=e<<t.bi_valid&65535,B_(t,t.bi_buf),t.bi_buf=e>>rO-t.bi_valid,t.bi_valid+=n-rO):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Yc=(t,e,n)=>{Gs(t,n[e*2],n[e*2+1])},Nae=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Qje=t=>{t.bi_valid===16?(B_(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},eHe=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,d,f,p,m,v=0;for(f=0;f<=wh;f++)t.bl_count[f]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Rae;l++)u=t.heap[l],f=n[n[u*2+1]*2+1]+1,f>c&&(f=c,v++),n[u*2+1]=f,!(u>r)&&(t.bl_count[f]++,p=0,u>=a&&(p=o[u-a]),m=n[u*2],t.opt_len+=m*(f+p),s&&(t.static_len+=m*(i[u*2+1]+p)));if(v!==0){do{for(f=c-1;t.bl_count[f]===0;)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[c]--,v-=2}while(v>0);for(f=c;f!==0;f--)for(u=t.bl_count[f];u!==0;)d=t.heap[--l],!(d>r)&&(n[d*2+1]!==f&&(t.opt_len+=(f-n[d*2+1])*n[d*2],n[d*2+1]=f),u--)}},Uae=(t,e,n)=>{const r=new Array(wh+1);let i=0,s,o;for(s=1;s<=wh;s++)i=i+n[s-1]<<1,r[s]=i;for(o=0;o<=e;o++){let a=t[o*2+1];a!==0&&(t[o*2]=Nae(r[a]++,a))}},tHe=()=>{let t,e,n,r,i;const s=new Array(wh+1);for(n=0,r=0;r<CN-1;r++)for(IN[r]=n,t=0;t<1<<N5[r];t++)F_[n++]=r;for(F_[n-1]=r,i=0,r=0;r<16;r++)for(Ik[r]=i,t=0;t<1<<NT[r];t++)$_[i++]=r;for(i>>=7;r<Um;r++)for(Ik[r]=i<<7,t=0;t<1<<NT[r]-7;t++)$_[256+i++]=r;for(e=0;e<=wh;e++)s[e]=0;for(t=0;t<=143;)Xl[t*2+1]=8,t++,s[8]++;for(;t<=255;)Xl[t*2+1]=9,t++,s[9]++;for(;t<=279;)Xl[t*2+1]=7,t++,s[7]++;for(;t<=287;)Xl[t*2+1]=8,t++,s[8]++;for(Uae(Xl,U_+1,s),t=0;t<Um;t++)w0[t*2+1]=5,w0[t*2]=Nae(t,5);Mae=new iO(Xl,N5,Gb+1,U_,wh),Aae=new iO(w0,NT,0,Um,wh),Lae=new iO(new Array(0),Xje,0,kN,Jje)},$ae=t=>{let e;for(e=0;e<U_;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Um;e++)t.dyn_dtree[e*2]=0;for(e=0;e<kN;e++)t.bl_tree[e*2]=0;t.dyn_ltree[RN*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},Fae=t=>{t.bi_valid>8?B_(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},CV=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},oO=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&CV(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!CV(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},kV=(t,e,n)=>{let r,i,s=0,o,a;if(t.sym_next!==0)do r=t.pending_buf[t.sym_buf+s++]&255,r+=(t.pending_buf[t.sym_buf+s++]&255)<<8,i=t.pending_buf[t.sym_buf+s++],r===0?Yc(t,i,e):(o=F_[i],Yc(t,o+Gb+1,e),a=N5[o],a!==0&&(i-=IN[o],Gs(t,i,a)),r--,o=Dae(r),Yc(t,o,n),a=NT[o],a!==0&&(r-=Ik[o],Gs(t,r,a)));while(s<t.sym_next);Yc(t,RN,e)},U5=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c=-1,l;for(t.heap_len=0,t.heap_max=Rae,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=c=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,o=t.heap_len>>1;o>=1;o--)oO(t,n,o);l=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],oO(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[l*2]=n[o*2]+n[a*2],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=l,t.heap[1]=l++,oO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],eHe(t,e),Uae(n,c,t.bl_count)},RV=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)&&(a<l?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Iae*2]++):a<=10?t.bl_tree[xae*2]++:t.bl_tree[Pae*2]++,a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},IV=(t,e,n)=>{let r,i=-1,s,o=e[0*2+1],a=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<c&&s===o)){if(a<l)do Yc(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Yc(t,s,t.bl_tree),a--),Yc(t,Iae,t.bl_tree),Gs(t,a-3,2)):a<=10?(Yc(t,xae,t.bl_tree),Gs(t,a-3,3)):(Yc(t,Pae,t.bl_tree),Gs(t,a-11,7));a=0,i=s,o===0?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},nHe=t=>{let e;for(RV(t,t.dyn_ltree,t.l_desc.max_code),RV(t,t.dyn_dtree,t.d_desc.max_code),U5(t,t.bl_desc),e=kN-1;e>=3&&t.bl_tree[Oae[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},rHe=(t,e,n,r)=>{let i;for(Gs(t,e-257,5),Gs(t,n-1,5),Gs(t,r-4,4),i=0;i<r;i++)Gs(t,t.bl_tree[Oae[i]*2+1],3);IV(t,t.dyn_ltree,e-1),IV(t,t.dyn_dtree,n-1)},iHe=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return EV;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return TV;for(n=32;n<Gb;n++)if(t.dyn_ltree[n*2]!==0)return TV;return EV};let xV=!1;const sHe=t=>{xV||(tHe(),xV=!0),t.l_desc=new sO(t.dyn_ltree,Mae),t.d_desc=new sO(t.dyn_dtree,Aae),t.bl_desc=new sO(t.bl_tree,Lae),t.bi_buf=0,t.bi_valid=0,$ae(t)},Bae=(t,e,n,r)=>{Gs(t,(Gje<<1)+(r?1:0),3),Fae(t),B_(t,n),B_(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},oHe=t=>{Gs(t,kae<<1,3),Yc(t,RN,Xl),Qje(t)},aHe=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===qje&&(t.strm.data_type=iHe(t)),U5(t,t.l_desc),U5(t,t.d_desc),o=nHe(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?Bae(t,e,n,r):t.strategy===Vje||s===i?(Gs(t,(kae<<1)+(r?1:0),3),kV(t,Xl,w0)):(Gs(t,(zje<<1)+(r?1:0),3),rHe(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),kV(t,t.dyn_ltree,t.dyn_dtree)),$ae(t),r&&Fae(t)},cHe=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(F_[n]+Gb+1)*2]++,t.dyn_dtree[Dae(e)*2]++),t.sym_next===t.sym_end);var lHe=sHe,uHe=Bae,dHe=aHe,fHe=cHe,hHe=oHe,pHe={_tr_init:lHe,_tr_stored_block:uHe,_tr_flush_block:dHe,_tr_tally:fHe,_tr_align:hHe};const gHe=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};var j_=gHe;const mHe=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},vHe=new Uint32Array(mHe()),yHe=(t,e,n,r)=>{const i=vHe,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1};var ei=yHe,mp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hp={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:_He,_tr_stored_block:$5,_tr_flush_block:bHe,_tr_tally:Zd,_tr_align:SHe}=pHe,{Z_NO_FLUSH:Qd,Z_PARTIAL_FLUSH:wHe,Z_FULL_FLUSH:EHe,Z_FINISH:ua,Z_BLOCK:PV,Z_OK:yi,Z_STREAM_END:OV,Z_STREAM_ERROR:ol,Z_DATA_ERROR:THe,Z_BUF_ERROR:aO,Z_DEFAULT_COMPRESSION:CHe,Z_FILTERED:kHe,Z_HUFFMAN_ONLY:Zw,Z_RLE:RHe,Z_FIXED:IHe,Z_DEFAULT_STRATEGY:xHe,Z_UNKNOWN:PHe,Z_DEFLATED:nI}=Hp,OHe=9,MHe=15,AHe=8,LHe=29,DHe=256,F5=DHe+1+LHe,NHe=30,UHe=19,$He=2*F5+1,FHe=15,Ft=3,Ld=258,al=Ld+Ft+1,BHe=32,wv=42,xN=57,B5=69,j5=73,H5=91,K5=103,Eh=113,F1=666,gs=1,uy=2,vp=3,dy=4,jHe=3,Th=(t,e)=>(t.msg=mp[e],e),MV=t=>t*2-(t>4?9:0),Rd=t=>{let e=t.length;for(;--e>=0;)t[e]=0},HHe=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let KHe=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask,ef=KHe;const mo=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Co=(t,e)=>{bHe(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,mo(t.strm)},Xt=(t,e)=>{t.pending_buf[t.pending++]=e},o1=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},V5=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=j_(t.adler,e,i,n):t.state.wrap===2&&(t.adler=ei(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},jae=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-al?t.strstart-(t.w_size-al):0,l=t.window,u=t.w_mask,d=t.prev,f=t.strstart+Ld;let p=l[r+o-1],m=l[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(l[i+o]!==m||l[i+o-1]!==p||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(s=Ld-(f-r),r=f-Ld,s>o){if(t.match_start=e,o=s,s>=a)break;p=l[r+o-1],m=l[r+o]}}while((e=d[e&u])>c&&--n!==0);return o<=t.lookahead?o:t.lookahead},Ev=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-al)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),HHe(t),r+=e),t.strm.avail_in===0)break;if(n=V5(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=Ft)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=ef(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=ef(t,t.ins_h,t.window[i+Ft-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<Ft)););}while(t.lookahead<al&&t.strm.avail_in!==0)},Hae=(t,e)=>{let n=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r,i,s,o=0,a=t.strm.avail_in;do{if(r=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s||(s=t.strm.avail_out-s,i=t.strstart-t.block_start,r>i+t.strm.avail_in&&(r=i+t.strm.avail_in),r>s&&(r=s),r<n&&(r===0&&e!==ua||e===Qd||r!==i+t.strm.avail_in)))break;o=e===ua&&r===i+t.strm.avail_in?1:0,$5(t,0,0,o),t.pending_buf[t.pending-4]=r,t.pending_buf[t.pending-3]=r>>8,t.pending_buf[t.pending-2]=~r,t.pending_buf[t.pending-1]=~r>>8,mo(t.strm),i&&(i>r&&(i=r),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,r-=i),r&&(V5(t.strm,t.strm.output,t.strm.next_out,r),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?dy:e!==Qd&&e!==ua&&t.strm.avail_in===0&&t.strstart===t.block_start?uy:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(V5(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,n=s>t.w_size?t.w_size:s,i=t.strstart-t.block_start,(i>=n||(i||e===ua)&&e!==Qd&&t.strm.avail_in===0&&i<=s)&&(r=i>s?s:i,o=e===ua&&t.strm.avail_in===0&&r===i?1:0,$5(t,t.block_start,r,o),t.block_start+=r,mo(t.strm)),o?vp:gs)},cO=(t,e)=>{let n,r;for(;;){if(t.lookahead<al){if(Ev(t),t.lookahead<al&&e===Qd)return gs;if(t.lookahead===0)break}if(n=0,t.lookahead>=Ft&&(t.ins_h=ef(t,t.ins_h,t.window[t.strstart+Ft-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-al&&(t.match_length=jae(t,n)),t.match_length>=Ft)if(r=Zd(t,t.strstart-t.match_start,t.match_length-Ft),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=Ft){t.match_length--;do t.strstart++,t.ins_h=ef(t,t.ins_h,t.window[t.strstart+Ft-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ef(t,t.ins_h,t.window[t.strstart+1]);else r=Zd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Co(t,!1),t.strm.avail_out===0))return gs}return t.insert=t.strstart<Ft-1?t.strstart:Ft-1,e===ua?(Co(t,!0),t.strm.avail_out===0?vp:dy):t.sym_next&&(Co(t,!1),t.strm.avail_out===0)?gs:uy},yg=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<al){if(Ev(t),t.lookahead<al&&e===Qd)return gs;if(t.lookahead===0)break}if(n=0,t.lookahead>=Ft&&(t.ins_h=ef(t,t.ins_h,t.window[t.strstart+Ft-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=Ft-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-al&&(t.match_length=jae(t,n),t.match_length<=5&&(t.strategy===kHe||t.match_length===Ft&&t.strstart-t.match_start>4096)&&(t.match_length=Ft-1)),t.prev_length>=Ft&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-Ft,r=Zd(t,t.strstart-1-t.prev_match,t.prev_length-Ft),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=ef(t,t.ins_h,t.window[t.strstart+Ft-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=Ft-1,t.strstart++,r&&(Co(t,!1),t.strm.avail_out===0))return gs}else if(t.match_available){if(r=Zd(t,0,t.window[t.strstart-1]),r&&Co(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return gs}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Zd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<Ft-1?t.strstart:Ft-1,e===ua?(Co(t,!0),t.strm.avail_out===0?vp:dy):t.sym_next&&(Co(t,!1),t.strm.avail_out===0)?gs:uy},VHe=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=Ld){if(Ev(t),t.lookahead<=Ld&&e===Qd)return gs;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=Ft&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Ld;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Ld-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=Ft?(n=Zd(t,1,t.match_length-Ft),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Zd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Co(t,!1),t.strm.avail_out===0))return gs}return t.insert=0,e===ua?(Co(t,!0),t.strm.avail_out===0?vp:dy):t.sym_next&&(Co(t,!1),t.strm.avail_out===0)?gs:uy},qHe=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(Ev(t),t.lookahead===0)){if(e===Qd)return gs;break}if(t.match_length=0,n=Zd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Co(t,!1),t.strm.avail_out===0))return gs}return t.insert=0,e===ua?(Co(t,!0),t.strm.avail_out===0?vp:dy):t.sym_next&&(Co(t,!1),t.strm.avail_out===0)?gs:uy};function Rc(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const B1=[new Rc(0,0,0,0,Hae),new Rc(4,4,8,4,cO),new Rc(4,5,16,8,cO),new Rc(4,6,32,32,cO),new Rc(4,4,16,16,yg),new Rc(8,16,32,32,yg),new Rc(8,16,128,128,yg),new Rc(8,32,128,256,yg),new Rc(32,128,258,1024,yg),new Rc(32,258,258,4096,yg)],GHe=t=>{t.window_size=2*t.w_size,Rd(t.head),t.max_lazy_match=B1[t.level].max_lazy,t.good_match=B1[t.level].good_length,t.nice_match=B1[t.level].nice_length,t.max_chain_length=B1[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=Ft-1,t.match_available=0,t.ins_h=0};function zHe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=nI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array($He*2),this.dyn_dtree=new Uint16Array((2*NHe+1)*2),this.bl_tree=new Uint16Array((2*UHe+1)*2),Rd(this.dyn_ltree),Rd(this.dyn_dtree),Rd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(FHe+1),this.heap=new Uint16Array(2*F5+1),Rd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*F5+1),Rd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const zb=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==wv&&e.status!==xN&&e.status!==B5&&e.status!==j5&&e.status!==H5&&e.status!==K5&&e.status!==Eh&&e.status!==F1?1:0},Kae=t=>{if(zb(t))return Th(t,ol);t.total_in=t.total_out=0,t.data_type=PHe;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?xN:e.wrap?wv:Eh,t.adler=e.wrap===2?0:1,e.last_flush=-2,_He(e),yi},Vae=t=>{const e=Kae(t);return e===yi&&GHe(t.state),e},WHe=(t,e)=>zb(t)||t.state.wrap!==2?ol:(t.state.gzhead=e,yi),qae=(t,e,n,r,i,s)=>{if(!t)return ol;let o=1;if(e===CHe&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>OHe||n!==nI||r<8||r>15||e<0||e>9||s<0||s>IHe||r===8&&o!==1)return Th(t,ol);r===8&&(r=9);const a=new zHe;return t.state=a,a.strm=t,a.status=wv,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+Ft-1)/Ft),a.window=new Uint8Array(a.w_size*2),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=(a.lit_bufsize-1)*3,a.level=e,a.strategy=s,a.method=n,Vae(t)},YHe=(t,e)=>qae(t,e,nI,MHe,AHe,xHe),JHe=(t,e)=>{if(zb(t)||e>PV||e<0)return t?Th(t,ol):ol;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===F1&&e!==ua)return Th(t,t.avail_out===0?aO:ol);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(mo(t),t.avail_out===0)return n.last_flush=-1,yi}else if(t.avail_in===0&&MV(e)<=MV(r)&&e!==ua)return Th(t,aO);if(n.status===F1&&t.avail_in!==0)return Th(t,aO);if(n.status===wv&&n.wrap===0&&(n.status=Eh),n.status===wv){let i=nI+(n.w_bits-8<<4)<<8,s=-1;if(n.strategy>=Zw||n.level<2?s=0:n.level<6?s=1:n.level===6?s=2:s=3,i|=s<<6,n.strstart!==0&&(i|=BHe),i+=31-i%31,o1(n,i),n.strstart!==0&&(o1(n,t.adler>>>16),o1(n,t.adler&65535)),t.adler=1,n.status=Eh,mo(t),n.pending!==0)return n.last_flush=-1,yi}if(n.status===xN){if(t.adler=0,Xt(n,31),Xt(n,139),Xt(n,8),n.gzhead)Xt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Xt(n,n.gzhead.time&255),Xt(n,n.gzhead.time>>8&255),Xt(n,n.gzhead.time>>16&255),Xt(n,n.gzhead.time>>24&255),Xt(n,n.level===9?2:n.strategy>=Zw||n.level<2?4:0),Xt(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(Xt(n,n.gzhead.extra.length&255),Xt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=ei(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=B5;else if(Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,0),Xt(n,n.level===9?2:n.strategy>=Zw||n.level<2?4:0),Xt(n,jHe),n.status=Eh,mo(t),n.pending!==0)return n.last_flush=-1,yi}if(n.status===B5){if(n.gzhead.extra){let i=n.pending,s=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,mo(t),n.pending!==0)return n.last_flush=-1,yi;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=j5}if(n.status===j5){if(n.gzhead.name){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i)),mo(t),n.pending!==0)return n.last_flush=-1,yi;i=0}n.gzindex<n.gzhead.name.length?s=n.gzhead.name.charCodeAt(n.gzindex++)&255:s=0,Xt(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=H5}if(n.status===H5){if(n.gzhead.comment){let i=n.pending,s;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i)),mo(t),n.pending!==0)return n.last_flush=-1,yi;i=0}n.gzindex<n.gzhead.comment.length?s=n.gzhead.comment.charCodeAt(n.gzindex++)&255:s=0,Xt(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>i&&(t.adler=ei(t.adler,n.pending_buf,n.pending-i,i))}n.status=K5}if(n.status===K5){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(mo(t),n.pending!==0))return n.last_flush=-1,yi;Xt(n,t.adler&255),Xt(n,t.adler>>8&255),t.adler=0}if(n.status=Eh,mo(t),n.pending!==0)return n.last_flush=-1,yi}if(t.avail_in!==0||n.lookahead!==0||e!==Qd&&n.status!==F1){let i=n.level===0?Hae(n,e):n.strategy===Zw?qHe(n,e):n.strategy===RHe?VHe(n,e):B1[n.level].func(n,e);if((i===vp||i===dy)&&(n.status=F1),i===gs||i===vp)return t.avail_out===0&&(n.last_flush=-1),yi;if(i===uy&&(e===wHe?SHe(n):e!==PV&&($5(n,0,0,!1),e===EHe&&(Rd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),mo(t),t.avail_out===0))return n.last_flush=-1,yi}return e!==ua?yi:n.wrap<=0?OV:(n.wrap===2?(Xt(n,t.adler&255),Xt(n,t.adler>>8&255),Xt(n,t.adler>>16&255),Xt(n,t.adler>>24&255),Xt(n,t.total_in&255),Xt(n,t.total_in>>8&255),Xt(n,t.total_in>>16&255),Xt(n,t.total_in>>24&255)):(o1(n,t.adler>>>16),o1(n,t.adler&65535)),mo(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?yi:OV)},XHe=t=>{if(zb(t))return ol;const e=t.state.status;return t.state=null,e===Eh?Th(t,THe):yi},ZHe=(t,e)=>{let n=e.length;if(zb(t))return ol;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==wv||r.lookahead)return ol;if(i===1&&(t.adler=j_(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Rd(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Ev(r);r.lookahead>=Ft;){let c=r.strstart,l=r.lookahead-(Ft-1);do r.ins_h=ef(r,r.ins_h,r.window[c+Ft-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=Ft-1,Ev(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=Ft-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,yi};var QHe=YHe,eKe=qae,tKe=Vae,nKe=Kae,rKe=WHe,iKe=JHe,sKe=XHe,oKe=ZHe,aKe="pako deflate (from Nodeca project)",E0={deflateInit:QHe,deflateInit2:eKe,deflateReset:tKe,deflateResetKeep:nKe,deflateSetHeader:rKe,deflate:iKe,deflateEnd:sKe,deflateSetDictionary:oKe,deflateInfo:aKe};const cKe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var lKe=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)cKe(n,r)&&(t[r]=n[r])}}return t},uKe=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n},rI={assign:lKe,flattenChunks:uKe};let Gae=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Gae=!1}const H_=new Uint8Array(256);for(let t=0;t<256;t++)H_[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;H_[254]=H_[254]=1;var dKe=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const fKe=(t,e)=>{if(e<65534&&t.subarray&&Gae)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var hKe=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=H_[o];if(a>4){s[i++]=65533,r+=a-1;continue}for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|t[r++]&63,a--;if(a>1){s[i++]=65533;continue}o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|o&1023)}return fKe(s,i)},pKe=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+H_[t[n]]>e?n:e},K_={string2buf:dKe,buf2string:hKe,utf8border:pKe};function gKe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zae=gKe;const Wae=Object.prototype.toString,{Z_NO_FLUSH:mKe,Z_SYNC_FLUSH:vKe,Z_FULL_FLUSH:yKe,Z_FINISH:_Ke,Z_OK:xk,Z_STREAM_END:bKe,Z_DEFAULT_COMPRESSION:SKe,Z_DEFAULT_STRATEGY:wKe,Z_DEFLATED:EKe}=Hp;function Wb(t){this.options=rI.assign({level:SKe,method:EKe,chunkSize:16384,windowBits:15,memLevel:8,strategy:wKe},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zae,this.strm.avail_out=0;let n=E0.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==xk)throw new Error(mp[n]);if(e.header&&E0.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=K_.string2buf(e.dictionary):Wae.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=E0.deflateSetDictionary(this.strm,r),n!==xk)throw new Error(mp[n]);this._dict_set=!0}}Wb.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?_Ke:mKe,typeof t=="string"?n.input=K_.string2buf(t):Wae.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===vKe||s===yKe)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=E0.deflate(n,s),i===bKe)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=E0.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===xk;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};Wb.prototype.onData=function(t){this.chunks.push(t)};Wb.prototype.onEnd=function(t){t===xk&&(this.result=rI.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function PN(t,e){const n=new Wb(e);if(n.push(t,!0),n.err)throw n.msg||mp[n.err];return n.result}function TKe(t,e){return e=e||{},e.raw=!0,PN(t,e)}function CKe(t,e){return e=e||{},e.gzip=!0,PN(t,e)}var kKe=Wb,RKe=PN,IKe=TKe,xKe=CKe,PKe=Hp,OKe={Deflate:kKe,deflate:RKe,deflateRaw:IKe,gzip:xKe,constants:PKe};const Qw=16209,MKe=16191;var AKe=function(e,n){let r,i,s,o,a,c,l,u,d,f,p,m,v,S,_,w,T,C,I,R,O,A,U,N;const L=e.state;r=e.next_in,U=e.input,i=r+(e.avail_in-5),s=e.next_out,N=e.output,o=s-(n-e.avail_out),a=s+(e.avail_out-257),c=L.dmax,l=L.wsize,u=L.whave,d=L.wnext,f=L.window,p=L.hold,m=L.bits,v=L.lencode,S=L.distcode,_=(1<<L.lenbits)-1,w=(1<<L.distbits)-1;e:do{m<15&&(p+=U[r++]<<m,m+=8,p+=U[r++]<<m,m+=8),T=v[p&_];t:for(;;){if(C=T>>>24,p>>>=C,m-=C,C=T>>>16&255,C===0)N[s++]=T&65535;else if(C&16){I=T&65535,C&=15,C&&(m<C&&(p+=U[r++]<<m,m+=8),I+=p&(1<<C)-1,p>>>=C,m-=C),m<15&&(p+=U[r++]<<m,m+=8,p+=U[r++]<<m,m+=8),T=S[p&w];n:for(;;){if(C=T>>>24,p>>>=C,m-=C,C=T>>>16&255,C&16){if(R=T&65535,C&=15,m<C&&(p+=U[r++]<<m,m+=8,m<C&&(p+=U[r++]<<m,m+=8)),R+=p&(1<<C)-1,R>c){e.msg="invalid distance too far back",L.mode=Qw;break e}if(p>>>=C,m-=C,C=s-o,R>C){if(C=R-C,C>u&&L.sane){e.msg="invalid distance too far back",L.mode=Qw;break e}if(O=0,A=f,d===0){if(O+=l-C,C<I){I-=C;do N[s++]=f[O++];while(--C);O=s-R,A=N}}else if(d<C){if(O+=l+d-C,C-=d,C<I){I-=C;do N[s++]=f[O++];while(--C);if(O=0,d<I){C=d,I-=C;do N[s++]=f[O++];while(--C);O=s-R,A=N}}}else if(O+=d-C,C<I){I-=C;do N[s++]=f[O++];while(--C);O=s-R,A=N}for(;I>2;)N[s++]=A[O++],N[s++]=A[O++],N[s++]=A[O++],I-=3;I&&(N[s++]=A[O++],I>1&&(N[s++]=A[O++]))}else{O=s-R;do N[s++]=N[O++],N[s++]=N[O++],N[s++]=N[O++],I-=3;while(I>2);I&&(N[s++]=N[O++],I>1&&(N[s++]=N[O++]))}}else if(C&64){e.msg="invalid distance code",L.mode=Qw;break e}else{T=S[(T&65535)+(p&(1<<C)-1)];continue n}break}}else if(C&64)if(C&32){L.mode=MKe;break e}else{e.msg="invalid literal/length code",L.mode=Qw;break e}else{T=v[(T&65535)+(p&(1<<C)-1)];continue t}break}}while(r<i&&s<a);I=m>>3,r-=I,m-=I<<3,p&=(1<<m)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<a?257+(a-s):257-(s-a),L.hold=p,L.bits=m};const _g=15,AV=852,LV=592,DV=0,lO=1,NV=2,LKe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),DKe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),NKe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),UKe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),$Ke=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l=0,u=0,d=0,f=0,p=0,m=0,v=0,S=0,_=0,w=0,T,C,I,R,O,A=null,U;const N=new Uint16Array(_g+1),L=new Uint16Array(_g+1);let j=null,X,G,F;for(l=0;l<=_g;l++)N[l]=0;for(u=0;u<r;u++)N[e[n+u]]++;for(p=c,f=_g;f>=1&&N[f]===0;f--);if(p>f&&(p=f),f===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,a.bits=1,0;for(d=1;d<f&&N[d]===0;d++);for(p<d&&(p=d),S=1,l=1;l<=_g;l++)if(S<<=1,S-=N[l],S<0)return-1;if(S>0&&(t===DV||f!==1))return-1;for(L[1]=0,l=1;l<_g;l++)L[l+1]=L[l]+N[l];for(u=0;u<r;u++)e[n+u]!==0&&(o[L[e[n+u]]++]=u);if(t===DV?(A=j=o,U=20):t===lO?(A=LKe,j=DKe,U=257):(A=NKe,j=UKe,U=0),w=0,u=0,l=d,O=s,m=p,v=0,I=-1,_=1<<p,R=_-1,t===lO&&_>AV||t===NV&&_>LV)return 1;for(;;){X=l-v,o[u]+1<U?(G=0,F=o[u]):o[u]>=U?(G=j[o[u]-U],F=A[o[u]-U]):(G=96,F=0),T=1<<l-v,C=1<<m,d=C;do C-=T,i[O+(w>>v)+C]=X<<24|G<<16|F|0;while(C!==0);for(T=1<<l-1;w&T;)T>>=1;if(T!==0?(w&=T-1,w+=T):w=0,u++,--N[l]===0){if(l===f)break;l=e[n+o[u]]}if(l>p&&(w&R)!==I){for(v===0&&(v=p),O+=d,m=l-v,S=1<<m;m+v<f&&(S-=N[m+v],!(S<=0));)m++,S<<=1;if(_+=1<<m,t===lO&&_>AV||t===NV&&_>LV)return 1;I=w&R,i[I]=p<<24|m<<16|O-s|0}}return w!==0&&(i[O+w]=l-v<<24|64<<16|0),a.bits=p,0};var T0=$Ke;const FKe=0,Yae=1,Jae=2,{Z_FINISH:UV,Z_BLOCK:BKe,Z_TREES:eE,Z_OK:yp,Z_STREAM_END:jKe,Z_NEED_DICT:HKe,Z_STREAM_ERROR:xa,Z_DATA_ERROR:Xae,Z_MEM_ERROR:Zae,Z_BUF_ERROR:KKe,Z_DEFLATED:$V}=Hp,iI=16180,FV=16181,BV=16182,jV=16183,HV=16184,KV=16185,VV=16186,qV=16187,GV=16188,zV=16189,Pk=16190,Al=16191,uO=16192,WV=16193,dO=16194,YV=16195,JV=16196,XV=16197,ZV=16198,tE=16199,nE=16200,QV=16201,eq=16202,tq=16203,nq=16204,rq=16205,fO=16206,iq=16207,sq=16208,Hn=16209,Qae=16210,ece=16211,VKe=852,qKe=592,GKe=15,zKe=GKe,oq=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function WKe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Kp=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<iI||e.mode>ece?1:0},tce=t=>{if(Kp(t))return xa;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=iI,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(VKe),e.distcode=e.distdyn=new Int32Array(qKe),e.sane=1,e.back=-1,yp},nce=t=>{if(Kp(t))return xa;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,tce(t)},rce=(t,e)=>{let n;if(Kp(t))return xa;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?xa:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,nce(t))},ice=(t,e)=>{if(!t)return xa;const n=new WKe;t.state=n,n.strm=t,n.window=null,n.mode=iI;const r=rce(t,e);return r!==yp&&(t.state=null),r},YKe=t=>ice(t,zKe);let aq=!0,hO,pO;const JKe=t=>{if(aq){hO=new Int32Array(512),pO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(T0(Yae,t.lens,0,288,hO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;T0(Jae,t.lens,0,32,pO,0,t.work,{bits:5}),aq=!1}t.lencode=hO,t.lenbits=9,t.distcode=pO,t.distbits=5},sce=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},XKe=(t,e)=>{let n,r,i,s,o,a,c,l,u,d,f,p,m,v,S=0,_,w,T,C,I,R,O,A;const U=new Uint8Array(4);let N,L;const j=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Kp(t)||!t.output||!t.input&&t.avail_in!==0)return xa;n=t.state,n.mode===Al&&(n.mode=uO),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,d=a,f=c,A=yp;e:for(;;)switch(n.mode){case iI:if(n.wrap===0){n.mode=uO;break}for(;u<16;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,U[0]=l&255,U[1]=l>>>8&255,n.check=ei(n.check,U,2,0),l=0,u=0,n.mode=FV;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=Hn;break}if((l&15)!==$V){t.msg="unknown compression method",n.mode=Hn;break}if(l>>>=4,u-=4,O=(l&15)+8,n.wbits===0&&(n.wbits=O),O>15||O>n.wbits){t.msg="invalid window size",n.mode=Hn;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=l&512?zV:Al,l=0,u=0;break;case FV:for(;u<16;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==$V){t.msg="unknown compression method",n.mode=Hn;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=Hn;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(U[0]=l&255,U[1]=l>>>8&255,n.check=ei(n.check,U,2,0)),l=0,u=0,n.mode=BV;case BV:for(;u<32;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(U[0]=l&255,U[1]=l>>>8&255,U[2]=l>>>16&255,U[3]=l>>>24&255,n.check=ei(n.check,U,4,0)),l=0,u=0,n.mode=jV;case jV:for(;u<16;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(U[0]=l&255,U[1]=l>>>8&255,n.check=ei(n.check,U,2,0)),l=0,u=0,n.mode=HV;case HV:if(n.flags&1024){for(;u<16;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(U[0]=l&255,U[1]=l>>>8&255,n.check=ei(n.check,U,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=KV;case KV:if(n.flags&1024&&(p=n.length,p>a&&(p=a),p&&(n.head&&(O=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+p),O)),n.flags&512&&n.wrap&4&&(n.check=ei(n.check,r,p,s)),a-=p,s+=p,n.length-=p),n.length))break e;n.length=0,n.mode=VV;case VV:if(n.flags&2048){if(a===0)break e;p=0;do O=r[s+p++],n.head&&O&&n.length<65536&&(n.head.name+=String.fromCharCode(O));while(O&&p<a);if(n.flags&512&&n.wrap&4&&(n.check=ei(n.check,r,p,s)),a-=p,s+=p,O)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=qV;case qV:if(n.flags&4096){if(a===0)break e;p=0;do O=r[s+p++],n.head&&O&&n.length<65536&&(n.head.comment+=String.fromCharCode(O));while(O&&p<a);if(n.flags&512&&n.wrap&4&&(n.check=ei(n.check,r,p,s)),a-=p,s+=p,O)break e}else n.head&&(n.head.comment=null);n.mode=GV;case GV:if(n.flags&512){for(;u<16;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=Hn;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Al;break;case zV:for(;u<32;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=oq(l),l=0,u=0,n.mode=Pk;case Pk:if(n.havedict===0)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,HKe;t.adler=n.check=1,n.mode=Al;case Al:if(e===BKe||e===eE)break e;case uO:if(n.last){l>>>=u&7,u-=u&7,n.mode=fO;break}for(;u<3;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}switch(n.last=l&1,l>>>=1,u-=1,l&3){case 0:n.mode=WV;break;case 1:if(JKe(n),n.mode=tE,e===eE){l>>>=2,u-=2;break e}break;case 2:n.mode=JV;break;case 3:t.msg="invalid block type",n.mode=Hn}l>>>=2,u-=2;break;case WV:for(l>>>=u&7,u-=u&7;u<32;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if((l&65535)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Hn;break}if(n.length=l&65535,l=0,u=0,n.mode=dO,e===eE)break e;case dO:n.mode=YV;case YV:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),p===0)break e;i.set(r.subarray(s,s+p),o),a-=p,s+=p,c-=p,o+=p,n.length-=p;break}n.mode=Al;break;case JV:for(;u<14;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Hn;break}n.have=0,n.mode=XV;case XV:for(;n.have<n.ncode;){for(;u<3;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.lens[j[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[j[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,N={bits:n.lenbits},A=T0(FKe,n.lens,0,19,n.lencode,0,n.work,N),n.lenbits=N.bits,A){t.msg="invalid code lengths set",n.mode=Hn;break}n.have=0,n.mode=ZV;case ZV:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[l&(1<<n.lenbits)-1],_=S>>>24,w=S>>>16&255,T=S&65535,!(_<=u);){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(T<16)l>>>=_,u-=_,n.lens[n.have++]=T;else{if(T===16){for(L=_+2;u<L;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(l>>>=_,u-=_,n.have===0){t.msg="invalid bit length repeat",n.mode=Hn;break}O=n.lens[n.have-1],p=3+(l&3),l>>>=2,u-=2}else if(T===17){for(L=_+3;u<L;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,O=0,p=3+(l&7),l>>>=3,u-=3}else{for(L=_+7;u<L;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}l>>>=_,u-=_,O=0,p=11+(l&127),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Hn;break}for(;p--;)n.lens[n.have++]=O}}if(n.mode===Hn)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Hn;break}if(n.lenbits=9,N={bits:n.lenbits},A=T0(Yae,n.lens,0,n.nlen,n.lencode,0,n.work,N),n.lenbits=N.bits,A){t.msg="invalid literal/lengths set",n.mode=Hn;break}if(n.distbits=6,n.distcode=n.distdyn,N={bits:n.distbits},A=T0(Jae,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,N),n.distbits=N.bits,A){t.msg="invalid distances set",n.mode=Hn;break}if(n.mode=tE,e===eE)break e;case tE:n.mode=nE;case nE:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,AKe(t,f),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===Al&&(n.back=-1);break}for(n.back=0;S=n.lencode[l&(1<<n.lenbits)-1],_=S>>>24,w=S>>>16&255,T=S&65535,!(_<=u);){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(w&&!(w&240)){for(C=_,I=w,R=T;S=n.lencode[R+((l&(1<<C+I)-1)>>C)],_=S>>>24,w=S>>>16&255,T=S&65535,!(C+_<=u);){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}l>>>=C,u-=C,n.back+=C}if(l>>>=_,u-=_,n.back+=_,n.length=T,w===0){n.mode=rq;break}if(w&32){n.back=-1,n.mode=Al;break}if(w&64){t.msg="invalid literal/length code",n.mode=Hn;break}n.extra=w&15,n.mode=QV;case QV:if(n.extra){for(L=n.extra;u<L;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=eq;case eq:for(;S=n.distcode[l&(1<<n.distbits)-1],_=S>>>24,w=S>>>16&255,T=S&65535,!(_<=u);){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(!(w&240)){for(C=_,I=w,R=T;S=n.distcode[R+((l&(1<<C+I)-1)>>C)],_=S>>>24,w=S>>>16&255,T=S&65535,!(C+_<=u);){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}l>>>=C,u-=C,n.back+=C}if(l>>>=_,u-=_,n.back+=_,w&64){t.msg="invalid distance code",n.mode=Hn;break}n.offset=T,n.extra=w&15,n.mode=tq;case tq:if(n.extra){for(L=n.extra;u<L;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Hn;break}n.mode=nq;case nq:if(c===0)break e;if(p=f-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Hn;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),v=n.window}else v=i,m=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do i[o++]=v[m++];while(--p);n.length===0&&(n.mode=nE);break;case rq:if(c===0)break e;i[o++]=n.length,c--,n.mode=nE;break;case fO:if(n.wrap){for(;u<32;){if(a===0)break e;a--,l|=r[s++]<<u,u+=8}if(f-=c,t.total_out+=f,n.total+=f,n.wrap&4&&f&&(t.adler=n.check=n.flags?ei(n.check,i,f,o-f):j_(n.check,i,f,o-f)),f=c,n.wrap&4&&(n.flags?l:oq(l))!==n.check){t.msg="incorrect data check",n.mode=Hn;break}l=0,u=0}n.mode=iq;case iq:if(n.wrap&&n.flags){for(;u<32;){if(a===0)break e;a--,l+=r[s++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=Hn;break}l=0,u=0}n.mode=sq;case sq:A=jKe;break e;case Hn:A=Xae;break e;case Qae:return Zae;case ece:default:return xa}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||f!==t.avail_out&&n.mode<Hn&&(n.mode<fO||e!==UV))&&sce(t,t.output,t.next_out,f-t.avail_out),d-=t.avail_in,f-=t.avail_out,t.total_in+=d,t.total_out+=f,n.total+=f,n.wrap&4&&f&&(t.adler=n.check=n.flags?ei(n.check,i,f,t.next_out-f):j_(n.check,i,f,t.next_out-f)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Al?128:0)+(n.mode===tE||n.mode===dO?256:0),(d===0&&f===0||e===UV)&&A===yp&&(A=KKe),A},ZKe=t=>{if(Kp(t))return xa;let e=t.state;return e.window&&(e.window=null),t.state=null,yp},QKe=(t,e)=>{if(Kp(t))return xa;const n=t.state;return n.wrap&2?(n.head=e,e.done=!1,yp):xa},eVe=(t,e)=>{const n=e.length;let r,i,s;return Kp(t)||(r=t.state,r.wrap!==0&&r.mode!==Pk)?xa:r.mode===Pk&&(i=1,i=j_(i,e,n,0),i!==r.check)?Xae:(s=sce(t,e,n,n),s?(r.mode=Qae,Zae):(r.havedict=1,yp))};var tVe=nce,nVe=rce,rVe=tce,iVe=YKe,sVe=ice,oVe=XKe,aVe=ZKe,cVe=QKe,lVe=eVe,uVe="pako inflate (from Nodeca project)",Zl={inflateReset:tVe,inflateReset2:nVe,inflateResetKeep:rVe,inflateInit:iVe,inflateInit2:sVe,inflate:oVe,inflateEnd:aVe,inflateGetHeader:cVe,inflateSetDictionary:lVe,inflateInfo:uVe};function dVe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var fVe=dVe;const oce=Object.prototype.toString,{Z_NO_FLUSH:hVe,Z_FINISH:pVe,Z_OK:V_,Z_STREAM_END:gO,Z_NEED_DICT:mO,Z_STREAM_ERROR:gVe,Z_DATA_ERROR:cq,Z_MEM_ERROR:mVe}=Hp;function Yb(t){this.options=rI.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zae,this.strm.avail_out=0;let n=Zl.inflateInit2(this.strm,e.windowBits);if(n!==V_)throw new Error(mp[n]);if(this.header=new fVe,Zl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=K_.string2buf(e.dictionary):oce.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Zl.inflateSetDictionary(this.strm,e.dictionary),n!==V_)))throw new Error(mp[n])}Yb.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(e===~~e?o=e:o=e===!0?pVe:hVe,oce.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Zl.inflate(n,o),s===mO&&i&&(s=Zl.inflateSetDictionary(n,i),s===V_?s=Zl.inflate(n,o):s===cq&&(s=mO));n.avail_in>0&&s===gO&&n.state.wrap>0&&t[n.next_in]!==0;)Zl.inflateReset(n),s=Zl.inflate(n,o);switch(s){case gVe:case cq:case mO:case mVe:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===gO))if(this.options.to==="string"){let c=K_.utf8border(n.output,n.next_out),l=n.next_out-c,u=K_.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(u)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===V_&&a===0)){if(s===gO)return s=Zl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Yb.prototype.onData=function(t){this.chunks.push(t)};Yb.prototype.onEnd=function(t){t===V_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=rI.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function ON(t,e){const n=new Yb(e);if(n.push(t),n.err)throw n.msg||mp[n.err];return n.result}function vVe(t,e){return e=e||{},e.raw=!0,ON(t,e)}var yVe=Yb,_Ve=ON,bVe=vVe,SVe=ON,wVe=Hp,EVe={Inflate:yVe,inflate:_Ve,inflateRaw:bVe,ungzip:SVe,constants:wVe};const{Deflate:TVe,deflate:CVe,deflateRaw:kVe,gzip:RVe}=OKe,{Inflate:IVe,inflate:xVe,inflateRaw:PVe,ungzip:OVe}=EVe;var MVe=TVe,AVe=CVe,LVe=kVe,DVe=RVe,NVe=IVe,UVe=xVe,$Ve=PVe,FVe=OVe,BVe=Hp,jVe={Deflate:MVe,deflate:AVe,deflateRaw:LVe,gzip:DVe,Inflate:NVe,inflate:UVe,inflateRaw:$Ve,ungzip:FVe,constants:BVe},Ok={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ok.exports;(function(t,e){(function(){var n,r="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",l=500,u="__lodash_placeholder__",d=1,f=2,p=4,m=1,v=2,S=1,_=2,w=4,T=8,C=16,I=32,R=64,O=128,A=256,U=512,N=30,L="...",j=800,X=16,G=1,F=2,V=3,J=1/0,K=9007199254740991,W=17976931348623157e292,Y=NaN,ce=4294967295,ue=ce-1,Te=ce>>>1,Re=[["ary",O],["bind",S],["bindKey",_],["curry",T],["curryRight",C],["flip",U],["partial",I],["partialRight",R],["rearg",A]],Oe="[object Arguments]",De="[object Array]",ze="[object AsyncFunction]",et="[object Boolean]",lt="[object Date]",Ae="[object DOMException]",yn="[object Error]",un="[object Function]",je="[object GeneratorFunction]",Bt="[object Map]",_n="[object Number]",Jn="[object Null]",nn="[object Object]",Mr="[object Promise]",kn="[object Proxy]",Di="[object RegExp]",ar="[object Set]",dn="[object String]",Xe="[object Symbol]",Rn="[object Undefined]",At="[object WeakMap]",_c="[object WeakSet]",$="[object ArrayBuffer]",x="[object DataView]",M="[object Float32Array]",q="[object Float64Array]",ee="[object Int8Array]",ae="[object Int16Array]",ge="[object Int32Array]",dt="[object Uint8Array]",Ne="[object Uint8ClampedArray]",Fe="[object Uint16Array]",tt="[object Uint32Array]",_e=/\b__p \+= '';/g,nt=/\b(__p \+=) '' \+/g,ut=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Et=/&(?:amp|lt|gt|quot|#39);/g,yt=/[&<>"']/g,Xn=RegExp(Et.source),cr=RegExp(yt.source),Zn=/<%-([\s\S]+?)%>/g,Wr=/<%([\s\S]+?)%>/g,io=/<%=([\s\S]+?)%>/g,bc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bo=/^\w*$/,Gp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zp=/[\\^$.*+?()[\]{}|]/g,Rhe=RegExp(zp.source),HI=/^\s+/,Ihe=/\s/,xhe=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Phe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ohe=/,? & /,Mhe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ahe=/[()=,{}\[\]\/\s]/,Lhe=/\\(\\)?/g,Dhe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,s7=/\w*$/,Nhe=/^[-+]0x[0-9a-f]+$/i,Uhe=/^0b[01]+$/i,$he=/^\[object .+?Constructor\]$/,Fhe=/^0o[0-7]+$/i,Bhe=/^(?:0|[1-9]\d*)$/,jhe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,hS=/($^)/,Hhe=/['\n\r\u2028\u2029\\]/g,pS="\\ud800-\\udfff",Khe="\\u0300-\\u036f",Vhe="\\ufe20-\\ufe2f",qhe="\\u20d0-\\u20ff",o7=Khe+Vhe+qhe,a7="\\u2700-\\u27bf",c7="a-z\\xdf-\\xf6\\xf8-\\xff",Ghe="\\xac\\xb1\\xd7\\xf7",zhe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Whe="\\u2000-\\u206f",Yhe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",l7="A-Z\\xc0-\\xd6\\xd8-\\xde",u7="\\ufe0e\\ufe0f",d7=Ghe+zhe+Whe+Yhe,KI="['’]",Jhe="["+pS+"]",f7="["+d7+"]",gS="["+o7+"]",h7="\\d+",Xhe="["+a7+"]",p7="["+c7+"]",g7="[^"+pS+d7+h7+a7+c7+l7+"]",VI="\\ud83c[\\udffb-\\udfff]",Zhe="(?:"+gS+"|"+VI+")",m7="[^"+pS+"]",qI="(?:\\ud83c[\\udde6-\\uddff]){2}",GI="[\\ud800-\\udbff][\\udc00-\\udfff]",Wp="["+l7+"]",v7="\\u200d",y7="(?:"+p7+"|"+g7+")",Qhe="(?:"+Wp+"|"+g7+")",_7="(?:"+KI+"(?:d|ll|m|re|s|t|ve))?",b7="(?:"+KI+"(?:D|LL|M|RE|S|T|VE))?",S7=Zhe+"?",w7="["+u7+"]?",epe="(?:"+v7+"(?:"+[m7,qI,GI].join("|")+")"+w7+S7+")*",tpe="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",npe="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",E7=w7+S7+epe,rpe="(?:"+[Xhe,qI,GI].join("|")+")"+E7,ipe="(?:"+[m7+gS+"?",gS,qI,GI,Jhe].join("|")+")",spe=RegExp(KI,"g"),ope=RegExp(gS,"g"),zI=RegExp(VI+"(?="+VI+")|"+ipe+E7,"g"),ape=RegExp([Wp+"?"+p7+"+"+_7+"(?="+[f7,Wp,"$"].join("|")+")",Qhe+"+"+b7+"(?="+[f7,Wp+y7,"$"].join("|")+")",Wp+"?"+y7+"+"+_7,Wp+"+"+b7,npe,tpe,h7,rpe].join("|"),"g"),cpe=RegExp("["+v7+pS+o7+u7+"]"),lpe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,upe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],dpe=-1,An={};An[M]=An[q]=An[ee]=An[ae]=An[ge]=An[dt]=An[Ne]=An[Fe]=An[tt]=!0,An[Oe]=An[De]=An[$]=An[et]=An[x]=An[lt]=An[yn]=An[un]=An[Bt]=An[_n]=An[nn]=An[Di]=An[ar]=An[dn]=An[At]=!1;var In={};In[Oe]=In[De]=In[$]=In[x]=In[et]=In[lt]=In[M]=In[q]=In[ee]=In[ae]=In[ge]=In[Bt]=In[_n]=In[nn]=In[Di]=In[ar]=In[dn]=In[Xe]=In[dt]=In[Ne]=In[Fe]=In[tt]=!0,In[yn]=In[un]=In[At]=!1;var fpe={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},hpe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ppe={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},gpe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},mpe=parseFloat,vpe=parseInt,T7=typeof la=="object"&&la&&la.Object===Object&&la,ype=typeof self=="object"&&self&&self.Object===Object&&self,fi=T7||ype||Function("return this")(),WI=e&&!e.nodeType&&e,$f=WI&&!0&&t&&!t.nodeType&&t,C7=$f&&$f.exports===WI,YI=C7&&T7.process,jo=function(){try{var ne=$f&&$f.require&&$f.require("util").types;return ne||YI&&YI.binding&&YI.binding("util")}catch{}}(),k7=jo&&jo.isArrayBuffer,R7=jo&&jo.isDate,I7=jo&&jo.isMap,x7=jo&&jo.isRegExp,P7=jo&&jo.isSet,O7=jo&&jo.isTypedArray;function so(ne,pe,de){switch(de.length){case 0:return ne.call(pe);case 1:return ne.call(pe,de[0]);case 2:return ne.call(pe,de[0],de[1]);case 3:return ne.call(pe,de[0],de[1],de[2])}return ne.apply(pe,de)}function _pe(ne,pe,de,Ke){for(var gt=-1,Jt=ne==null?0:ne.length;++gt<Jt;){var Ar=ne[gt];pe(Ke,Ar,de(Ar),ne)}return Ke}function Ho(ne,pe){for(var de=-1,Ke=ne==null?0:ne.length;++de<Ke&&pe(ne[de],de,ne)!==!1;);return ne}function bpe(ne,pe){for(var de=ne==null?0:ne.length;de--&&pe(ne[de],de,ne)!==!1;);return ne}function M7(ne,pe){for(var de=-1,Ke=ne==null?0:ne.length;++de<Ke;)if(!pe(ne[de],de,ne))return!1;return!0}function Gu(ne,pe){for(var de=-1,Ke=ne==null?0:ne.length,gt=0,Jt=[];++de<Ke;){var Ar=ne[de];pe(Ar,de,ne)&&(Jt[gt++]=Ar)}return Jt}function mS(ne,pe){var de=ne==null?0:ne.length;return!!de&&Yp(ne,pe,0)>-1}function JI(ne,pe,de){for(var Ke=-1,gt=ne==null?0:ne.length;++Ke<gt;)if(de(pe,ne[Ke]))return!0;return!1}function Bn(ne,pe){for(var de=-1,Ke=ne==null?0:ne.length,gt=Array(Ke);++de<Ke;)gt[de]=pe(ne[de],de,ne);return gt}function zu(ne,pe){for(var de=-1,Ke=pe.length,gt=ne.length;++de<Ke;)ne[gt+de]=pe[de];return ne}function XI(ne,pe,de,Ke){var gt=-1,Jt=ne==null?0:ne.length;for(Ke&&Jt&&(de=ne[++gt]);++gt<Jt;)de=pe(de,ne[gt],gt,ne);return de}function Spe(ne,pe,de,Ke){var gt=ne==null?0:ne.length;for(Ke&&gt&&(de=ne[--gt]);gt--;)de=pe(de,ne[gt],gt,ne);return de}function ZI(ne,pe){for(var de=-1,Ke=ne==null?0:ne.length;++de<Ke;)if(pe(ne[de],de,ne))return!0;return!1}var wpe=QI("length");function Epe(ne){return ne.split("")}function Tpe(ne){return ne.match(Mhe)||[]}function A7(ne,pe,de){var Ke;return de(ne,function(gt,Jt,Ar){if(pe(gt,Jt,Ar))return Ke=Jt,!1}),Ke}function vS(ne,pe,de,Ke){for(var gt=ne.length,Jt=de+(Ke?1:-1);Ke?Jt--:++Jt<gt;)if(pe(ne[Jt],Jt,ne))return Jt;return-1}function Yp(ne,pe,de){return pe===pe?Npe(ne,pe,de):vS(ne,L7,de)}function Cpe(ne,pe,de,Ke){for(var gt=de-1,Jt=ne.length;++gt<Jt;)if(Ke(ne[gt],pe))return gt;return-1}function L7(ne){return ne!==ne}function D7(ne,pe){var de=ne==null?0:ne.length;return de?tx(ne,pe)/de:Y}function QI(ne){return function(pe){return pe==null?n:pe[ne]}}function ex(ne){return function(pe){return ne==null?n:ne[pe]}}function N7(ne,pe,de,Ke,gt){return gt(ne,function(Jt,Ar,bn){de=Ke?(Ke=!1,Jt):pe(de,Jt,Ar,bn)}),de}function kpe(ne,pe){var de=ne.length;for(ne.sort(pe);de--;)ne[de]=ne[de].value;return ne}function tx(ne,pe){for(var de,Ke=-1,gt=ne.length;++Ke<gt;){var Jt=pe(ne[Ke]);Jt!==n&&(de=de===n?Jt:de+Jt)}return de}function nx(ne,pe){for(var de=-1,Ke=Array(ne);++de<ne;)Ke[de]=pe(de);return Ke}function Rpe(ne,pe){return Bn(pe,function(de){return[de,ne[de]]})}function U7(ne){return ne&&ne.slice(0,j7(ne)+1).replace(HI,"")}function oo(ne){return function(pe){return ne(pe)}}function rx(ne,pe){return Bn(pe,function(de){return ne[de]})}function gy(ne,pe){return ne.has(pe)}function $7(ne,pe){for(var de=-1,Ke=ne.length;++de<Ke&&Yp(pe,ne[de],0)>-1;);return de}function F7(ne,pe){for(var de=ne.length;de--&&Yp(pe,ne[de],0)>-1;);return de}function Ipe(ne,pe){for(var de=ne.length,Ke=0;de--;)ne[de]===pe&&++Ke;return Ke}var xpe=ex(fpe),Ppe=ex(hpe);function Ope(ne){return"\\"+gpe[ne]}function Mpe(ne,pe){return ne==null?n:ne[pe]}function Jp(ne){return cpe.test(ne)}function Ape(ne){return lpe.test(ne)}function Lpe(ne){for(var pe,de=[];!(pe=ne.next()).done;)de.push(pe.value);return de}function ix(ne){var pe=-1,de=Array(ne.size);return ne.forEach(function(Ke,gt){de[++pe]=[gt,Ke]}),de}function B7(ne,pe){return function(de){return ne(pe(de))}}function Wu(ne,pe){for(var de=-1,Ke=ne.length,gt=0,Jt=[];++de<Ke;){var Ar=ne[de];(Ar===pe||Ar===u)&&(ne[de]=u,Jt[gt++]=de)}return Jt}function yS(ne){var pe=-1,de=Array(ne.size);return ne.forEach(function(Ke){de[++pe]=Ke}),de}function Dpe(ne){var pe=-1,de=Array(ne.size);return ne.forEach(function(Ke){de[++pe]=[Ke,Ke]}),de}function Npe(ne,pe,de){for(var Ke=de-1,gt=ne.length;++Ke<gt;)if(ne[Ke]===pe)return Ke;return-1}function Upe(ne,pe,de){for(var Ke=de+1;Ke--;)if(ne[Ke]===pe)return Ke;return Ke}function Xp(ne){return Jp(ne)?Fpe(ne):wpe(ne)}function Ma(ne){return Jp(ne)?Bpe(ne):Epe(ne)}function j7(ne){for(var pe=ne.length;pe--&&Ihe.test(ne.charAt(pe)););return pe}var $pe=ex(ppe);function Fpe(ne){for(var pe=zI.lastIndex=0;zI.test(ne);)++pe;return pe}function Bpe(ne){return ne.match(zI)||[]}function jpe(ne){return ne.match(ape)||[]}var Hpe=function ne(pe){pe=pe==null?fi:Zp.defaults(fi.Object(),pe,Zp.pick(fi,upe));var de=pe.Array,Ke=pe.Date,gt=pe.Error,Jt=pe.Function,Ar=pe.Math,bn=pe.Object,sx=pe.RegExp,Kpe=pe.String,Ko=pe.TypeError,_S=de.prototype,Vpe=Jt.prototype,Qp=bn.prototype,bS=pe["__core-js_shared__"],SS=Vpe.toString,rn=Qp.hasOwnProperty,qpe=0,H7=function(){var h=/[^.]+$/.exec(bS&&bS.keys&&bS.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),wS=Qp.toString,Gpe=SS.call(bn),zpe=fi._,Wpe=sx("^"+SS.call(rn).replace(zp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ES=C7?pe.Buffer:n,Yu=pe.Symbol,TS=pe.Uint8Array,K7=ES?ES.allocUnsafe:n,CS=B7(bn.getPrototypeOf,bn),V7=bn.create,q7=Qp.propertyIsEnumerable,kS=_S.splice,G7=Yu?Yu.isConcatSpreadable:n,my=Yu?Yu.iterator:n,Ff=Yu?Yu.toStringTag:n,RS=function(){try{var h=Vf(bn,"defineProperty");return h({},"",{}),h}catch{}}(),Ype=pe.clearTimeout!==fi.clearTimeout&&pe.clearTimeout,Jpe=Ke&&Ke.now!==fi.Date.now&&Ke.now,Xpe=pe.setTimeout!==fi.setTimeout&&pe.setTimeout,IS=Ar.ceil,xS=Ar.floor,ox=bn.getOwnPropertySymbols,Zpe=ES?ES.isBuffer:n,z7=pe.isFinite,Qpe=_S.join,ege=B7(bn.keys,bn),Lr=Ar.max,Ni=Ar.min,tge=Ke.now,nge=pe.parseInt,W7=Ar.random,rge=_S.reverse,ax=Vf(pe,"DataView"),vy=Vf(pe,"Map"),cx=Vf(pe,"Promise"),eg=Vf(pe,"Set"),yy=Vf(pe,"WeakMap"),_y=Vf(bn,"create"),PS=yy&&new yy,tg={},ige=qf(ax),sge=qf(vy),oge=qf(cx),age=qf(eg),cge=qf(yy),OS=Yu?Yu.prototype:n,by=OS?OS.valueOf:n,Y7=OS?OS.toString:n;function B(h){if(lr(h)&&!mt(h)&&!(h instanceof Lt)){if(h instanceof Vo)return h;if(rn.call(h,"__wrapped__"))return JU(h)}return new Vo(h)}var ng=function(){function h(){}return function(g){if(!Qn(g))return{};if(V7)return V7(g);h.prototype=g;var E=new h;return h.prototype=n,E}}();function MS(){}function Vo(h,g){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!g,this.__index__=0,this.__values__=n}B.templateSettings={escape:Zn,evaluate:Wr,interpolate:io,variable:"",imports:{_:B}},B.prototype=MS.prototype,B.prototype.constructor=B,Vo.prototype=ng(MS.prototype),Vo.prototype.constructor=Vo;function Lt(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ce,this.__views__=[]}function lge(){var h=new Lt(this.__wrapped__);return h.__actions__=ks(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=ks(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=ks(this.__views__),h}function uge(){if(this.__filtered__){var h=new Lt(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function dge(){var h=this.__wrapped__.value(),g=this.__dir__,E=mt(h),P=g<0,D=E?h.length:0,H=Eme(0,D,this.__views__),z=H.start,Q=H.end,ie=Q-z,ye=P?Q:z-1,be=this.__iteratees__,Ee=be.length,Le=0,Ye=Ni(ie,this.__takeCount__);if(!E||!P&&D==ie&&Ye==ie)return _U(h,this.__actions__);var ot=[];e:for(;ie--&&Le<Ye;){ye+=g;for(var Tt=-1,at=h[ye];++Tt<Ee;){var Rt=be[Tt],Nt=Rt.iteratee,lo=Rt.type,ss=Nt(at);if(lo==F)at=ss;else if(!ss){if(lo==G)continue e;break e}}ot[Le++]=at}return ot}Lt.prototype=ng(MS.prototype),Lt.prototype.constructor=Lt;function Bf(h){var g=-1,E=h==null?0:h.length;for(this.clear();++g<E;){var P=h[g];this.set(P[0],P[1])}}function fge(){this.__data__=_y?_y(null):{},this.size=0}function hge(h){var g=this.has(h)&&delete this.__data__[h];return this.size-=g?1:0,g}function pge(h){var g=this.__data__;if(_y){var E=g[h];return E===c?n:E}return rn.call(g,h)?g[h]:n}function gge(h){var g=this.__data__;return _y?g[h]!==n:rn.call(g,h)}function mge(h,g){var E=this.__data__;return this.size+=this.has(h)?0:1,E[h]=_y&&g===n?c:g,this}Bf.prototype.clear=fge,Bf.prototype.delete=hge,Bf.prototype.get=pge,Bf.prototype.has=gge,Bf.prototype.set=mge;function bl(h){var g=-1,E=h==null?0:h.length;for(this.clear();++g<E;){var P=h[g];this.set(P[0],P[1])}}function vge(){this.__data__=[],this.size=0}function yge(h){var g=this.__data__,E=AS(g,h);if(E<0)return!1;var P=g.length-1;return E==P?g.pop():kS.call(g,E,1),--this.size,!0}function _ge(h){var g=this.__data__,E=AS(g,h);return E<0?n:g[E][1]}function bge(h){return AS(this.__data__,h)>-1}function Sge(h,g){var E=this.__data__,P=AS(E,h);return P<0?(++this.size,E.push([h,g])):E[P][1]=g,this}bl.prototype.clear=vge,bl.prototype.delete=yge,bl.prototype.get=_ge,bl.prototype.has=bge,bl.prototype.set=Sge;function Sl(h){var g=-1,E=h==null?0:h.length;for(this.clear();++g<E;){var P=h[g];this.set(P[0],P[1])}}function wge(){this.size=0,this.__data__={hash:new Bf,map:new(vy||bl),string:new Bf}}function Ege(h){var g=qS(this,h).delete(h);return this.size-=g?1:0,g}function Tge(h){return qS(this,h).get(h)}function Cge(h){return qS(this,h).has(h)}function kge(h,g){var E=qS(this,h),P=E.size;return E.set(h,g),this.size+=E.size==P?0:1,this}Sl.prototype.clear=wge,Sl.prototype.delete=Ege,Sl.prototype.get=Tge,Sl.prototype.has=Cge,Sl.prototype.set=kge;function jf(h){var g=-1,E=h==null?0:h.length;for(this.__data__=new Sl;++g<E;)this.add(h[g])}function Rge(h){return this.__data__.set(h,c),this}function Ige(h){return this.__data__.has(h)}jf.prototype.add=jf.prototype.push=Rge,jf.prototype.has=Ige;function Aa(h){var g=this.__data__=new bl(h);this.size=g.size}function xge(){this.__data__=new bl,this.size=0}function Pge(h){var g=this.__data__,E=g.delete(h);return this.size=g.size,E}function Oge(h){return this.__data__.get(h)}function Mge(h){return this.__data__.has(h)}function Age(h,g){var E=this.__data__;if(E instanceof bl){var P=E.__data__;if(!vy||P.length<i-1)return P.push([h,g]),this.size=++E.size,this;E=this.__data__=new Sl(P)}return E.set(h,g),this.size=E.size,this}Aa.prototype.clear=xge,Aa.prototype.delete=Pge,Aa.prototype.get=Oge,Aa.prototype.has=Mge,Aa.prototype.set=Age;function J7(h,g){var E=mt(h),P=!E&&Gf(h),D=!E&&!P&&ed(h),H=!E&&!P&&!D&&og(h),z=E||P||D||H,Q=z?nx(h.length,Kpe):[],ie=Q.length;for(var ye in h)(g||rn.call(h,ye))&&!(z&&(ye=="length"||D&&(ye=="offset"||ye=="parent")||H&&(ye=="buffer"||ye=="byteLength"||ye=="byteOffset")||Cl(ye,ie)))&&Q.push(ye);return Q}function X7(h){var g=h.length;return g?h[_x(0,g-1)]:n}function Lge(h,g){return GS(ks(h),Hf(g,0,h.length))}function Dge(h){return GS(ks(h))}function lx(h,g,E){(E!==n&&!La(h[g],E)||E===n&&!(g in h))&&wl(h,g,E)}function Sy(h,g,E){var P=h[g];(!(rn.call(h,g)&&La(P,E))||E===n&&!(g in h))&&wl(h,g,E)}function AS(h,g){for(var E=h.length;E--;)if(La(h[E][0],g))return E;return-1}function Nge(h,g,E,P){return Ju(h,function(D,H,z){g(P,D,E(D),z)}),P}function Z7(h,g){return h&&wc(g,Yr(g),h)}function Uge(h,g){return h&&wc(g,Is(g),h)}function wl(h,g,E){g=="__proto__"&&RS?RS(h,g,{configurable:!0,enumerable:!0,value:E,writable:!0}):h[g]=E}function ux(h,g){for(var E=-1,P=g.length,D=de(P),H=h==null;++E<P;)D[E]=H?n:Vx(h,g[E]);return D}function Hf(h,g,E){return h===h&&(E!==n&&(h=h<=E?h:E),g!==n&&(h=h>=g?h:g)),h}function qo(h,g,E,P,D,H){var z,Q=g&d,ie=g&f,ye=g&p;if(E&&(z=D?E(h,P,D,H):E(h)),z!==n)return z;if(!Qn(h))return h;var be=mt(h);if(be){if(z=Cme(h),!Q)return ks(h,z)}else{var Ee=Ui(h),Le=Ee==un||Ee==je;if(ed(h))return wU(h,Q);if(Ee==nn||Ee==Oe||Le&&!D){if(z=ie||Le?{}:jU(h),!Q)return ie?pme(h,Uge(z,h)):hme(h,Z7(z,h))}else{if(!In[Ee])return D?h:{};z=kme(h,Ee,Q)}}H||(H=new Aa);var Ye=H.get(h);if(Ye)return Ye;H.set(h,z),m$(h)?h.forEach(function(at){z.add(qo(at,g,E,at,h,H))}):p$(h)&&h.forEach(function(at,Rt){z.set(Rt,qo(at,g,E,Rt,h,H))});var ot=ye?ie?Px:xx:ie?Is:Yr,Tt=be?n:ot(h);return Ho(Tt||h,function(at,Rt){Tt&&(Rt=at,at=h[Rt]),Sy(z,Rt,qo(at,g,E,Rt,h,H))}),z}function $ge(h){var g=Yr(h);return function(E){return Q7(E,h,g)}}function Q7(h,g,E){var P=E.length;if(h==null)return!P;for(h=bn(h);P--;){var D=E[P],H=g[D],z=h[D];if(z===n&&!(D in h)||!H(z))return!1}return!0}function eU(h,g,E){if(typeof h!="function")throw new Ko(o);return Iy(function(){h.apply(n,E)},g)}function wy(h,g,E,P){var D=-1,H=mS,z=!0,Q=h.length,ie=[],ye=g.length;if(!Q)return ie;E&&(g=Bn(g,oo(E))),P?(H=JI,z=!1):g.length>=i&&(H=gy,z=!1,g=new jf(g));e:for(;++D<Q;){var be=h[D],Ee=E==null?be:E(be);if(be=P||be!==0?be:0,z&&Ee===Ee){for(var Le=ye;Le--;)if(g[Le]===Ee)continue e;ie.push(be)}else H(g,Ee,P)||ie.push(be)}return ie}var Ju=RU(Sc),tU=RU(fx,!0);function Fge(h,g){var E=!0;return Ju(h,function(P,D,H){return E=!!g(P,D,H),E}),E}function LS(h,g,E){for(var P=-1,D=h.length;++P<D;){var H=h[P],z=g(H);if(z!=null&&(Q===n?z===z&&!co(z):E(z,Q)))var Q=z,ie=H}return ie}function Bge(h,g,E,P){var D=h.length;for(E=bt(E),E<0&&(E=-E>D?0:D+E),P=P===n||P>D?D:bt(P),P<0&&(P+=D),P=E>P?0:y$(P);E<P;)h[E++]=g;return h}function nU(h,g){var E=[];return Ju(h,function(P,D,H){g(P,D,H)&&E.push(P)}),E}function hi(h,g,E,P,D){var H=-1,z=h.length;for(E||(E=Ime),D||(D=[]);++H<z;){var Q=h[H];g>0&&E(Q)?g>1?hi(Q,g-1,E,P,D):zu(D,Q):P||(D[D.length]=Q)}return D}var dx=IU(),rU=IU(!0);function Sc(h,g){return h&&dx(h,g,Yr)}function fx(h,g){return h&&rU(h,g,Yr)}function DS(h,g){return Gu(g,function(E){return kl(h[E])})}function Kf(h,g){g=Zu(g,h);for(var E=0,P=g.length;h!=null&&E<P;)h=h[Ec(g[E++])];return E&&E==P?h:n}function iU(h,g,E){var P=g(h);return mt(h)?P:zu(P,E(h))}function rs(h){return h==null?h===n?Rn:Jn:Ff&&Ff in bn(h)?wme(h):Dme(h)}function hx(h,g){return h>g}function jge(h,g){return h!=null&&rn.call(h,g)}function Hge(h,g){return h!=null&&g in bn(h)}function Kge(h,g,E){return h>=Ni(g,E)&&h<Lr(g,E)}function px(h,g,E){for(var P=E?JI:mS,D=h[0].length,H=h.length,z=H,Q=de(H),ie=1/0,ye=[];z--;){var be=h[z];z&&g&&(be=Bn(be,oo(g))),ie=Ni(be.length,ie),Q[z]=!E&&(g||D>=120&&be.length>=120)?new jf(z&&be):n}be=h[0];var Ee=-1,Le=Q[0];e:for(;++Ee<D&&ye.length<ie;){var Ye=be[Ee],ot=g?g(Ye):Ye;if(Ye=E||Ye!==0?Ye:0,!(Le?gy(Le,ot):P(ye,ot,E))){for(z=H;--z;){var Tt=Q[z];if(!(Tt?gy(Tt,ot):P(h[z],ot,E)))continue e}Le&&Le.push(ot),ye.push(Ye)}}return ye}function Vge(h,g,E,P){return Sc(h,function(D,H,z){g(P,E(D),H,z)}),P}function Ey(h,g,E){g=Zu(g,h),h=qU(h,g);var P=h==null?h:h[Ec(zo(g))];return P==null?n:so(P,h,E)}function sU(h){return lr(h)&&rs(h)==Oe}function qge(h){return lr(h)&&rs(h)==$}function Gge(h){return lr(h)&&rs(h)==lt}function Ty(h,g,E,P,D){return h===g?!0:h==null||g==null||!lr(h)&&!lr(g)?h!==h&&g!==g:zge(h,g,E,P,Ty,D)}function zge(h,g,E,P,D,H){var z=mt(h),Q=mt(g),ie=z?De:Ui(h),ye=Q?De:Ui(g);ie=ie==Oe?nn:ie,ye=ye==Oe?nn:ye;var be=ie==nn,Ee=ye==nn,Le=ie==ye;if(Le&&ed(h)){if(!ed(g))return!1;z=!0,be=!1}if(Le&&!be)return H||(H=new Aa),z||og(h)?$U(h,g,E,P,D,H):bme(h,g,ie,E,P,D,H);if(!(E&m)){var Ye=be&&rn.call(h,"__wrapped__"),ot=Ee&&rn.call(g,"__wrapped__");if(Ye||ot){var Tt=Ye?h.value():h,at=ot?g.value():g;return H||(H=new Aa),D(Tt,at,E,P,H)}}return Le?(H||(H=new Aa),Sme(h,g,E,P,D,H)):!1}function Wge(h){return lr(h)&&Ui(h)==Bt}function gx(h,g,E,P){var D=E.length,H=D,z=!P;if(h==null)return!H;for(h=bn(h);D--;){var Q=E[D];if(z&&Q[2]?Q[1]!==h[Q[0]]:!(Q[0]in h))return!1}for(;++D<H;){Q=E[D];var ie=Q[0],ye=h[ie],be=Q[1];if(z&&Q[2]){if(ye===n&&!(ie in h))return!1}else{var Ee=new Aa;if(P)var Le=P(ye,be,ie,h,g,Ee);if(!(Le===n?Ty(be,ye,m|v,P,Ee):Le))return!1}}return!0}function oU(h){if(!Qn(h)||Pme(h))return!1;var g=kl(h)?Wpe:$he;return g.test(qf(h))}function Yge(h){return lr(h)&&rs(h)==Di}function Jge(h){return lr(h)&&Ui(h)==ar}function Xge(h){return lr(h)&&ZS(h.length)&&!!An[rs(h)]}function aU(h){return typeof h=="function"?h:h==null?xs:typeof h=="object"?mt(h)?uU(h[0],h[1]):lU(h):x$(h)}function mx(h){if(!Ry(h))return ege(h);var g=[];for(var E in bn(h))rn.call(h,E)&&E!="constructor"&&g.push(E);return g}function Zge(h){if(!Qn(h))return Lme(h);var g=Ry(h),E=[];for(var P in h)P=="constructor"&&(g||!rn.call(h,P))||E.push(P);return E}function vx(h,g){return h<g}function cU(h,g){var E=-1,P=Rs(h)?de(h.length):[];return Ju(h,function(D,H,z){P[++E]=g(D,H,z)}),P}function lU(h){var g=Mx(h);return g.length==1&&g[0][2]?KU(g[0][0],g[0][1]):function(E){return E===h||gx(E,h,g)}}function uU(h,g){return Lx(h)&&HU(g)?KU(Ec(h),g):function(E){var P=Vx(E,h);return P===n&&P===g?qx(E,h):Ty(g,P,m|v)}}function NS(h,g,E,P,D){h!==g&&dx(g,function(H,z){if(D||(D=new Aa),Qn(H))Qge(h,g,z,E,NS,P,D);else{var Q=P?P(Nx(h,z),H,z+"",h,g,D):n;Q===n&&(Q=H),lx(h,z,Q)}},Is)}function Qge(h,g,E,P,D,H,z){var Q=Nx(h,E),ie=Nx(g,E),ye=z.get(ie);if(ye){lx(h,E,ye);return}var be=H?H(Q,ie,E+"",h,g,z):n,Ee=be===n;if(Ee){var Le=mt(ie),Ye=!Le&&ed(ie),ot=!Le&&!Ye&&og(ie);be=ie,Le||Ye||ot?mt(Q)?be=Q:pr(Q)?be=ks(Q):Ye?(Ee=!1,be=wU(ie,!0)):ot?(Ee=!1,be=EU(ie,!0)):be=[]:xy(ie)||Gf(ie)?(be=Q,Gf(Q)?be=_$(Q):(!Qn(Q)||kl(Q))&&(be=jU(ie))):Ee=!1}Ee&&(z.set(ie,be),D(be,ie,P,H,z),z.delete(ie)),lx(h,E,be)}function dU(h,g){var E=h.length;if(E)return g+=g<0?E:0,Cl(g,E)?h[g]:n}function fU(h,g,E){g.length?g=Bn(g,function(H){return mt(H)?function(z){return Kf(z,H.length===1?H[0]:H)}:H}):g=[xs];var P=-1;g=Bn(g,oo(st()));var D=cU(h,function(H,z,Q){var ie=Bn(g,function(ye){return ye(H)});return{criteria:ie,index:++P,value:H}});return kpe(D,function(H,z){return fme(H,z,E)})}function eme(h,g){return hU(h,g,function(E,P){return qx(h,P)})}function hU(h,g,E){for(var P=-1,D=g.length,H={};++P<D;){var z=g[P],Q=Kf(h,z);E(Q,z)&&Cy(H,Zu(z,h),Q)}return H}function tme(h){return function(g){return Kf(g,h)}}function yx(h,g,E,P){var D=P?Cpe:Yp,H=-1,z=g.length,Q=h;for(h===g&&(g=ks(g)),E&&(Q=Bn(h,oo(E)));++H<z;)for(var ie=0,ye=g[H],be=E?E(ye):ye;(ie=D(Q,be,ie,P))>-1;)Q!==h&&kS.call(Q,ie,1),kS.call(h,ie,1);return h}function pU(h,g){for(var E=h?g.length:0,P=E-1;E--;){var D=g[E];if(E==P||D!==H){var H=D;Cl(D)?kS.call(h,D,1):wx(h,D)}}return h}function _x(h,g){return h+xS(W7()*(g-h+1))}function nme(h,g,E,P){for(var D=-1,H=Lr(IS((g-h)/(E||1)),0),z=de(H);H--;)z[P?H:++D]=h,h+=E;return z}function bx(h,g){var E="";if(!h||g<1||g>K)return E;do g%2&&(E+=h),g=xS(g/2),g&&(h+=h);while(g);return E}function Ct(h,g){return Ux(VU(h,g,xs),h+"")}function rme(h){return X7(ag(h))}function ime(h,g){var E=ag(h);return GS(E,Hf(g,0,E.length))}function Cy(h,g,E,P){if(!Qn(h))return h;g=Zu(g,h);for(var D=-1,H=g.length,z=H-1,Q=h;Q!=null&&++D<H;){var ie=Ec(g[D]),ye=E;if(ie==="__proto__"||ie==="constructor"||ie==="prototype")return h;if(D!=z){var be=Q[ie];ye=P?P(be,ie,Q):n,ye===n&&(ye=Qn(be)?be:Cl(g[D+1])?[]:{})}Sy(Q,ie,ye),Q=Q[ie]}return h}var gU=PS?function(h,g){return PS.set(h,g),h}:xs,sme=RS?function(h,g){return RS(h,"toString",{configurable:!0,enumerable:!1,value:zx(g),writable:!0})}:xs;function ome(h){return GS(ag(h))}function Go(h,g,E){var P=-1,D=h.length;g<0&&(g=-g>D?0:D+g),E=E>D?D:E,E<0&&(E+=D),D=g>E?0:E-g>>>0,g>>>=0;for(var H=de(D);++P<D;)H[P]=h[P+g];return H}function ame(h,g){var E;return Ju(h,function(P,D,H){return E=g(P,D,H),!E}),!!E}function US(h,g,E){var P=0,D=h==null?P:h.length;if(typeof g=="number"&&g===g&&D<=Te){for(;P<D;){var H=P+D>>>1,z=h[H];z!==null&&!co(z)&&(E?z<=g:z<g)?P=H+1:D=H}return D}return Sx(h,g,xs,E)}function Sx(h,g,E,P){var D=0,H=h==null?0:h.length;if(H===0)return 0;g=E(g);for(var z=g!==g,Q=g===null,ie=co(g),ye=g===n;D<H;){var be=xS((D+H)/2),Ee=E(h[be]),Le=Ee!==n,Ye=Ee===null,ot=Ee===Ee,Tt=co(Ee);if(z)var at=P||ot;else ye?at=ot&&(P||Le):Q?at=ot&&Le&&(P||!Ye):ie?at=ot&&Le&&!Ye&&(P||!Tt):Ye||Tt?at=!1:at=P?Ee<=g:Ee<g;at?D=be+1:H=be}return Ni(H,ue)}function mU(h,g){for(var E=-1,P=h.length,D=0,H=[];++E<P;){var z=h[E],Q=g?g(z):z;if(!E||!La(Q,ie)){var ie=Q;H[D++]=z===0?0:z}}return H}function vU(h){return typeof h=="number"?h:co(h)?Y:+h}function ao(h){if(typeof h=="string")return h;if(mt(h))return Bn(h,ao)+"";if(co(h))return Y7?Y7.call(h):"";var g=h+"";return g=="0"&&1/h==-J?"-0":g}function Xu(h,g,E){var P=-1,D=mS,H=h.length,z=!0,Q=[],ie=Q;if(E)z=!1,D=JI;else if(H>=i){var ye=g?null:yme(h);if(ye)return yS(ye);z=!1,D=gy,ie=new jf}else ie=g?[]:Q;e:for(;++P<H;){var be=h[P],Ee=g?g(be):be;if(be=E||be!==0?be:0,z&&Ee===Ee){for(var Le=ie.length;Le--;)if(ie[Le]===Ee)continue e;g&&ie.push(Ee),Q.push(be)}else D(ie,Ee,E)||(ie!==Q&&ie.push(Ee),Q.push(be))}return Q}function wx(h,g){return g=Zu(g,h),h=qU(h,g),h==null||delete h[Ec(zo(g))]}function yU(h,g,E,P){return Cy(h,g,E(Kf(h,g)),P)}function $S(h,g,E,P){for(var D=h.length,H=P?D:-1;(P?H--:++H<D)&&g(h[H],H,h););return E?Go(h,P?0:H,P?H+1:D):Go(h,P?H+1:0,P?D:H)}function _U(h,g){var E=h;return E instanceof Lt&&(E=E.value()),XI(g,function(P,D){return D.func.apply(D.thisArg,zu([P],D.args))},E)}function Ex(h,g,E){var P=h.length;if(P<2)return P?Xu(h[0]):[];for(var D=-1,H=de(P);++D<P;)for(var z=h[D],Q=-1;++Q<P;)Q!=D&&(H[D]=wy(H[D]||z,h[Q],g,E));return Xu(hi(H,1),g,E)}function bU(h,g,E){for(var P=-1,D=h.length,H=g.length,z={};++P<D;){var Q=P<H?g[P]:n;E(z,h[P],Q)}return z}function Tx(h){return pr(h)?h:[]}function Cx(h){return typeof h=="function"?h:xs}function Zu(h,g){return mt(h)?h:Lx(h,g)?[h]:YU(Qt(h))}var cme=Ct;function Qu(h,g,E){var P=h.length;return E=E===n?P:E,!g&&E>=P?h:Go(h,g,E)}var SU=Ype||function(h){return fi.clearTimeout(h)};function wU(h,g){if(g)return h.slice();var E=h.length,P=K7?K7(E):new h.constructor(E);return h.copy(P),P}function kx(h){var g=new h.constructor(h.byteLength);return new TS(g).set(new TS(h)),g}function lme(h,g){var E=g?kx(h.buffer):h.buffer;return new h.constructor(E,h.byteOffset,h.byteLength)}function ume(h){var g=new h.constructor(h.source,s7.exec(h));return g.lastIndex=h.lastIndex,g}function dme(h){return by?bn(by.call(h)):{}}function EU(h,g){var E=g?kx(h.buffer):h.buffer;return new h.constructor(E,h.byteOffset,h.length)}function TU(h,g){if(h!==g){var E=h!==n,P=h===null,D=h===h,H=co(h),z=g!==n,Q=g===null,ie=g===g,ye=co(g);if(!Q&&!ye&&!H&&h>g||H&&z&&ie&&!Q&&!ye||P&&z&&ie||!E&&ie||!D)return 1;if(!P&&!H&&!ye&&h<g||ye&&E&&D&&!P&&!H||Q&&E&&D||!z&&D||!ie)return-1}return 0}function fme(h,g,E){for(var P=-1,D=h.criteria,H=g.criteria,z=D.length,Q=E.length;++P<z;){var ie=TU(D[P],H[P]);if(ie){if(P>=Q)return ie;var ye=E[P];return ie*(ye=="desc"?-1:1)}}return h.index-g.index}function CU(h,g,E,P){for(var D=-1,H=h.length,z=E.length,Q=-1,ie=g.length,ye=Lr(H-z,0),be=de(ie+ye),Ee=!P;++Q<ie;)be[Q]=g[Q];for(;++D<z;)(Ee||D<H)&&(be[E[D]]=h[D]);for(;ye--;)be[Q++]=h[D++];return be}function kU(h,g,E,P){for(var D=-1,H=h.length,z=-1,Q=E.length,ie=-1,ye=g.length,be=Lr(H-Q,0),Ee=de(be+ye),Le=!P;++D<be;)Ee[D]=h[D];for(var Ye=D;++ie<ye;)Ee[Ye+ie]=g[ie];for(;++z<Q;)(Le||D<H)&&(Ee[Ye+E[z]]=h[D++]);return Ee}function ks(h,g){var E=-1,P=h.length;for(g||(g=de(P));++E<P;)g[E]=h[E];return g}function wc(h,g,E,P){var D=!E;E||(E={});for(var H=-1,z=g.length;++H<z;){var Q=g[H],ie=P?P(E[Q],h[Q],Q,E,h):n;ie===n&&(ie=h[Q]),D?wl(E,Q,ie):Sy(E,Q,ie)}return E}function hme(h,g){return wc(h,Ax(h),g)}function pme(h,g){return wc(h,FU(h),g)}function FS(h,g){return function(E,P){var D=mt(E)?_pe:Nge,H=g?g():{};return D(E,h,st(P,2),H)}}function rg(h){return Ct(function(g,E){var P=-1,D=E.length,H=D>1?E[D-1]:n,z=D>2?E[2]:n;for(H=h.length>3&&typeof H=="function"?(D--,H):n,z&&is(E[0],E[1],z)&&(H=D<3?n:H,D=1),g=bn(g);++P<D;){var Q=E[P];Q&&h(g,Q,P,H)}return g})}function RU(h,g){return function(E,P){if(E==null)return E;if(!Rs(E))return h(E,P);for(var D=E.length,H=g?D:-1,z=bn(E);(g?H--:++H<D)&&P(z[H],H,z)!==!1;);return E}}function IU(h){return function(g,E,P){for(var D=-1,H=bn(g),z=P(g),Q=z.length;Q--;){var ie=z[h?Q:++D];if(E(H[ie],ie,H)===!1)break}return g}}function gme(h,g,E){var P=g&S,D=ky(h);function H(){var z=this&&this!==fi&&this instanceof H?D:h;return z.apply(P?E:this,arguments)}return H}function xU(h){return function(g){g=Qt(g);var E=Jp(g)?Ma(g):n,P=E?E[0]:g.charAt(0),D=E?Qu(E,1).join(""):g.slice(1);return P[h]()+D}}function ig(h){return function(g){return XI(R$(k$(g).replace(spe,"")),h,"")}}function ky(h){return function(){var g=arguments;switch(g.length){case 0:return new h;case 1:return new h(g[0]);case 2:return new h(g[0],g[1]);case 3:return new h(g[0],g[1],g[2]);case 4:return new h(g[0],g[1],g[2],g[3]);case 5:return new h(g[0],g[1],g[2],g[3],g[4]);case 6:return new h(g[0],g[1],g[2],g[3],g[4],g[5]);case 7:return new h(g[0],g[1],g[2],g[3],g[4],g[5],g[6])}var E=ng(h.prototype),P=h.apply(E,g);return Qn(P)?P:E}}function mme(h,g,E){var P=ky(h);function D(){for(var H=arguments.length,z=de(H),Q=H,ie=sg(D);Q--;)z[Q]=arguments[Q];var ye=H<3&&z[0]!==ie&&z[H-1]!==ie?[]:Wu(z,ie);if(H-=ye.length,H<E)return LU(h,g,BS,D.placeholder,n,z,ye,n,n,E-H);var be=this&&this!==fi&&this instanceof D?P:h;return so(be,this,z)}return D}function PU(h){return function(g,E,P){var D=bn(g);if(!Rs(g)){var H=st(E,3);g=Yr(g),E=function(Q){return H(D[Q],Q,D)}}var z=h(g,E,P);return z>-1?D[H?g[z]:z]:n}}function OU(h){return Tl(function(g){var E=g.length,P=E,D=Vo.prototype.thru;for(h&&g.reverse();P--;){var H=g[P];if(typeof H!="function")throw new Ko(o);if(D&&!z&&VS(H)=="wrapper")var z=new Vo([],!0)}for(P=z?P:E;++P<E;){H=g[P];var Q=VS(H),ie=Q=="wrapper"?Ox(H):n;ie&&Dx(ie[0])&&ie[1]==(O|T|I|A)&&!ie[4].length&&ie[9]==1?z=z[VS(ie[0])].apply(z,ie[3]):z=H.length==1&&Dx(H)?z[Q]():z.thru(H)}return function(){var ye=arguments,be=ye[0];if(z&&ye.length==1&&mt(be))return z.plant(be).value();for(var Ee=0,Le=E?g[Ee].apply(this,ye):be;++Ee<E;)Le=g[Ee].call(this,Le);return Le}})}function BS(h,g,E,P,D,H,z,Q,ie,ye){var be=g&O,Ee=g&S,Le=g&_,Ye=g&(T|C),ot=g&U,Tt=Le?n:ky(h);function at(){for(var Rt=arguments.length,Nt=de(Rt),lo=Rt;lo--;)Nt[lo]=arguments[lo];if(Ye)var ss=sg(at),uo=Ipe(Nt,ss);if(P&&(Nt=CU(Nt,P,D,Ye)),H&&(Nt=kU(Nt,H,z,Ye)),Rt-=uo,Ye&&Rt<ye){var gr=Wu(Nt,ss);return LU(h,g,BS,at.placeholder,E,Nt,gr,Q,ie,ye-Rt)}var Da=Ee?E:this,Il=Le?Da[h]:h;return Rt=Nt.length,Q?Nt=Nme(Nt,Q):ot&&Rt>1&&Nt.reverse(),be&&ie<Rt&&(Nt.length=ie),this&&this!==fi&&this instanceof at&&(Il=Tt||ky(Il)),Il.apply(Da,Nt)}return at}function MU(h,g){return function(E,P){return Vge(E,h,g(P),{})}}function jS(h,g){return function(E,P){var D;if(E===n&&P===n)return g;if(E!==n&&(D=E),P!==n){if(D===n)return P;typeof E=="string"||typeof P=="string"?(E=ao(E),P=ao(P)):(E=vU(E),P=vU(P)),D=h(E,P)}return D}}function Rx(h){return Tl(function(g){return g=Bn(g,oo(st())),Ct(function(E){var P=this;return h(g,function(D){return so(D,P,E)})})})}function HS(h,g){g=g===n?" ":ao(g);var E=g.length;if(E<2)return E?bx(g,h):g;var P=bx(g,IS(h/Xp(g)));return Jp(g)?Qu(Ma(P),0,h).join(""):P.slice(0,h)}function vme(h,g,E,P){var D=g&S,H=ky(h);function z(){for(var Q=-1,ie=arguments.length,ye=-1,be=P.length,Ee=de(be+ie),Le=this&&this!==fi&&this instanceof z?H:h;++ye<be;)Ee[ye]=P[ye];for(;ie--;)Ee[ye++]=arguments[++Q];return so(Le,D?E:this,Ee)}return z}function AU(h){return function(g,E,P){return P&&typeof P!="number"&&is(g,E,P)&&(E=P=n),g=Rl(g),E===n?(E=g,g=0):E=Rl(E),P=P===n?g<E?1:-1:Rl(P),nme(g,E,P,h)}}function KS(h){return function(g,E){return typeof g=="string"&&typeof E=="string"||(g=Wo(g),E=Wo(E)),h(g,E)}}function LU(h,g,E,P,D,H,z,Q,ie,ye){var be=g&T,Ee=be?z:n,Le=be?n:z,Ye=be?H:n,ot=be?n:H;g|=be?I:R,g&=~(be?R:I),g&w||(g&=~(S|_));var Tt=[h,g,D,Ye,Ee,ot,Le,Q,ie,ye],at=E.apply(n,Tt);return Dx(h)&&GU(at,Tt),at.placeholder=P,zU(at,h,g)}function Ix(h){var g=Ar[h];return function(E,P){if(E=Wo(E),P=P==null?0:Ni(bt(P),292),P&&z7(E)){var D=(Qt(E)+"e").split("e"),H=g(D[0]+"e"+(+D[1]+P));return D=(Qt(H)+"e").split("e"),+(D[0]+"e"+(+D[1]-P))}return g(E)}}var yme=eg&&1/yS(new eg([,-0]))[1]==J?function(h){return new eg(h)}:Jx;function DU(h){return function(g){var E=Ui(g);return E==Bt?ix(g):E==ar?Dpe(g):Rpe(g,h(g))}}function El(h,g,E,P,D,H,z,Q){var ie=g&_;if(!ie&&typeof h!="function")throw new Ko(o);var ye=P?P.length:0;if(ye||(g&=~(I|R),P=D=n),z=z===n?z:Lr(bt(z),0),Q=Q===n?Q:bt(Q),ye-=D?D.length:0,g&R){var be=P,Ee=D;P=D=n}var Le=ie?n:Ox(h),Ye=[h,g,E,P,D,be,Ee,H,z,Q];if(Le&&Ame(Ye,Le),h=Ye[0],g=Ye[1],E=Ye[2],P=Ye[3],D=Ye[4],Q=Ye[9]=Ye[9]===n?ie?0:h.length:Lr(Ye[9]-ye,0),!Q&&g&(T|C)&&(g&=~(T|C)),!g||g==S)var ot=gme(h,g,E);else g==T||g==C?ot=mme(h,g,Q):(g==I||g==(S|I))&&!D.length?ot=vme(h,g,E,P):ot=BS.apply(n,Ye);var Tt=Le?gU:GU;return zU(Tt(ot,Ye),h,g)}function NU(h,g,E,P){return h===n||La(h,Qp[E])&&!rn.call(P,E)?g:h}function UU(h,g,E,P,D,H){return Qn(h)&&Qn(g)&&(H.set(g,h),NS(h,g,n,UU,H),H.delete(g)),h}function _me(h){return xy(h)?n:h}function $U(h,g,E,P,D,H){var z=E&m,Q=h.length,ie=g.length;if(Q!=ie&&!(z&&ie>Q))return!1;var ye=H.get(h),be=H.get(g);if(ye&&be)return ye==g&&be==h;var Ee=-1,Le=!0,Ye=E&v?new jf:n;for(H.set(h,g),H.set(g,h);++Ee<Q;){var ot=h[Ee],Tt=g[Ee];if(P)var at=z?P(Tt,ot,Ee,g,h,H):P(ot,Tt,Ee,h,g,H);if(at!==n){if(at)continue;Le=!1;break}if(Ye){if(!ZI(g,function(Rt,Nt){if(!gy(Ye,Nt)&&(ot===Rt||D(ot,Rt,E,P,H)))return Ye.push(Nt)})){Le=!1;break}}else if(!(ot===Tt||D(ot,Tt,E,P,H))){Le=!1;break}}return H.delete(h),H.delete(g),Le}function bme(h,g,E,P,D,H,z){switch(E){case x:if(h.byteLength!=g.byteLength||h.byteOffset!=g.byteOffset)return!1;h=h.buffer,g=g.buffer;case $:return!(h.byteLength!=g.byteLength||!H(new TS(h),new TS(g)));case et:case lt:case _n:return La(+h,+g);case yn:return h.name==g.name&&h.message==g.message;case Di:case dn:return h==g+"";case Bt:var Q=ix;case ar:var ie=P&m;if(Q||(Q=yS),h.size!=g.size&&!ie)return!1;var ye=z.get(h);if(ye)return ye==g;P|=v,z.set(h,g);var be=$U(Q(h),Q(g),P,D,H,z);return z.delete(h),be;case Xe:if(by)return by.call(h)==by.call(g)}return!1}function Sme(h,g,E,P,D,H){var z=E&m,Q=xx(h),ie=Q.length,ye=xx(g),be=ye.length;if(ie!=be&&!z)return!1;for(var Ee=ie;Ee--;){var Le=Q[Ee];if(!(z?Le in g:rn.call(g,Le)))return!1}var Ye=H.get(h),ot=H.get(g);if(Ye&&ot)return Ye==g&&ot==h;var Tt=!0;H.set(h,g),H.set(g,h);for(var at=z;++Ee<ie;){Le=Q[Ee];var Rt=h[Le],Nt=g[Le];if(P)var lo=z?P(Nt,Rt,Le,g,h,H):P(Rt,Nt,Le,h,g,H);if(!(lo===n?Rt===Nt||D(Rt,Nt,E,P,H):lo)){Tt=!1;break}at||(at=Le=="constructor")}if(Tt&&!at){var ss=h.constructor,uo=g.constructor;ss!=uo&&"constructor"in h&&"constructor"in g&&!(typeof ss=="function"&&ss instanceof ss&&typeof uo=="function"&&uo instanceof uo)&&(Tt=!1)}return H.delete(h),H.delete(g),Tt}function Tl(h){return Ux(VU(h,n,QU),h+"")}function xx(h){return iU(h,Yr,Ax)}function Px(h){return iU(h,Is,FU)}var Ox=PS?function(h){return PS.get(h)}:Jx;function VS(h){for(var g=h.name+"",E=tg[g],P=rn.call(tg,g)?E.length:0;P--;){var D=E[P],H=D.func;if(H==null||H==h)return D.name}return g}function sg(h){var g=rn.call(B,"placeholder")?B:h;return g.placeholder}function st(){var h=B.iteratee||Wx;return h=h===Wx?aU:h,arguments.length?h(arguments[0],arguments[1]):h}function qS(h,g){var E=h.__data__;return xme(g)?E[typeof g=="string"?"string":"hash"]:E.map}function Mx(h){for(var g=Yr(h),E=g.length;E--;){var P=g[E],D=h[P];g[E]=[P,D,HU(D)]}return g}function Vf(h,g){var E=Mpe(h,g);return oU(E)?E:n}function wme(h){var g=rn.call(h,Ff),E=h[Ff];try{h[Ff]=n;var P=!0}catch{}var D=wS.call(h);return P&&(g?h[Ff]=E:delete h[Ff]),D}var Ax=ox?function(h){return h==null?[]:(h=bn(h),Gu(ox(h),function(g){return q7.call(h,g)}))}:Xx,FU=ox?function(h){for(var g=[];h;)zu(g,Ax(h)),h=CS(h);return g}:Xx,Ui=rs;(ax&&Ui(new ax(new ArrayBuffer(1)))!=x||vy&&Ui(new vy)!=Bt||cx&&Ui(cx.resolve())!=Mr||eg&&Ui(new eg)!=ar||yy&&Ui(new yy)!=At)&&(Ui=function(h){var g=rs(h),E=g==nn?h.constructor:n,P=E?qf(E):"";if(P)switch(P){case ige:return x;case sge:return Bt;case oge:return Mr;case age:return ar;case cge:return At}return g});function Eme(h,g,E){for(var P=-1,D=E.length;++P<D;){var H=E[P],z=H.size;switch(H.type){case"drop":h+=z;break;case"dropRight":g-=z;break;case"take":g=Ni(g,h+z);break;case"takeRight":h=Lr(h,g-z);break}}return{start:h,end:g}}function Tme(h){var g=h.match(Phe);return g?g[1].split(Ohe):[]}function BU(h,g,E){g=Zu(g,h);for(var P=-1,D=g.length,H=!1;++P<D;){var z=Ec(g[P]);if(!(H=h!=null&&E(h,z)))break;h=h[z]}return H||++P!=D?H:(D=h==null?0:h.length,!!D&&ZS(D)&&Cl(z,D)&&(mt(h)||Gf(h)))}function Cme(h){var g=h.length,E=new h.constructor(g);return g&&typeof h[0]=="string"&&rn.call(h,"index")&&(E.index=h.index,E.input=h.input),E}function jU(h){return typeof h.constructor=="function"&&!Ry(h)?ng(CS(h)):{}}function kme(h,g,E){var P=h.constructor;switch(g){case $:return kx(h);case et:case lt:return new P(+h);case x:return lme(h,E);case M:case q:case ee:case ae:case ge:case dt:case Ne:case Fe:case tt:return EU(h,E);case Bt:return new P;case _n:case dn:return new P(h);case Di:return ume(h);case ar:return new P;case Xe:return dme(h)}}function Rme(h,g){var E=g.length;if(!E)return h;var P=E-1;return g[P]=(E>1?"& ":"")+g[P],g=g.join(E>2?", ":" "),h.replace(xhe,`{
/* [wrapped with `+g+`] */
`)}function Ime(h){return mt(h)||Gf(h)||!!(G7&&h&&h[G7])}function Cl(h,g){var E=typeof h;return g=g??K,!!g&&(E=="number"||E!="symbol"&&Bhe.test(h))&&h>-1&&h%1==0&&h<g}function is(h,g,E){if(!Qn(E))return!1;var P=typeof g;return(P=="number"?Rs(E)&&Cl(g,E.length):P=="string"&&g in E)?La(E[g],h):!1}function Lx(h,g){if(mt(h))return!1;var E=typeof h;return E=="number"||E=="symbol"||E=="boolean"||h==null||co(h)?!0:Bo.test(h)||!bc.test(h)||g!=null&&h in bn(g)}function xme(h){var g=typeof h;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?h!=="__proto__":h===null}function Dx(h){var g=VS(h),E=B[g];if(typeof E!="function"||!(g in Lt.prototype))return!1;if(h===E)return!0;var P=Ox(E);return!!P&&h===P[0]}function Pme(h){return!!H7&&H7 in h}var Ome=bS?kl:Zx;function Ry(h){var g=h&&h.constructor,E=typeof g=="function"&&g.prototype||Qp;return h===E}function HU(h){return h===h&&!Qn(h)}function KU(h,g){return function(E){return E==null?!1:E[h]===g&&(g!==n||h in bn(E))}}function Mme(h){var g=JS(h,function(P){return E.size===l&&E.clear(),P}),E=g.cache;return g}function Ame(h,g){var E=h[1],P=g[1],D=E|P,H=D<(S|_|O),z=P==O&&E==T||P==O&&E==A&&h[7].length<=g[8]||P==(O|A)&&g[7].length<=g[8]&&E==T;if(!(H||z))return h;P&S&&(h[2]=g[2],D|=E&S?0:w);var Q=g[3];if(Q){var ie=h[3];h[3]=ie?CU(ie,Q,g[4]):Q,h[4]=ie?Wu(h[3],u):g[4]}return Q=g[5],Q&&(ie=h[5],h[5]=ie?kU(ie,Q,g[6]):Q,h[6]=ie?Wu(h[5],u):g[6]),Q=g[7],Q&&(h[7]=Q),P&O&&(h[8]=h[8]==null?g[8]:Ni(h[8],g[8])),h[9]==null&&(h[9]=g[9]),h[0]=g[0],h[1]=D,h}function Lme(h){var g=[];if(h!=null)for(var E in bn(h))g.push(E);return g}function Dme(h){return wS.call(h)}function VU(h,g,E){return g=Lr(g===n?h.length-1:g,0),function(){for(var P=arguments,D=-1,H=Lr(P.length-g,0),z=de(H);++D<H;)z[D]=P[g+D];D=-1;for(var Q=de(g+1);++D<g;)Q[D]=P[D];return Q[g]=E(z),so(h,this,Q)}}function qU(h,g){return g.length<2?h:Kf(h,Go(g,0,-1))}function Nme(h,g){for(var E=h.length,P=Ni(g.length,E),D=ks(h);P--;){var H=g[P];h[P]=Cl(H,E)?D[H]:n}return h}function Nx(h,g){if(!(g==="constructor"&&typeof h[g]=="function")&&g!="__proto__")return h[g]}var GU=WU(gU),Iy=Xpe||function(h,g){return fi.setTimeout(h,g)},Ux=WU(sme);function zU(h,g,E){var P=g+"";return Ux(h,Rme(P,Ume(Tme(P),E)))}function WU(h){var g=0,E=0;return function(){var P=tge(),D=X-(P-E);if(E=P,D>0){if(++g>=j)return arguments[0]}else g=0;return h.apply(n,arguments)}}function GS(h,g){var E=-1,P=h.length,D=P-1;for(g=g===n?P:g;++E<g;){var H=_x(E,D),z=h[H];h[H]=h[E],h[E]=z}return h.length=g,h}var YU=Mme(function(h){var g=[];return h.charCodeAt(0)===46&&g.push(""),h.replace(Gp,function(E,P,D,H){g.push(D?H.replace(Lhe,"$1"):P||E)}),g});function Ec(h){if(typeof h=="string"||co(h))return h;var g=h+"";return g=="0"&&1/h==-J?"-0":g}function qf(h){if(h!=null){try{return SS.call(h)}catch{}try{return h+""}catch{}}return""}function Ume(h,g){return Ho(Re,function(E){var P="_."+E[0];g&E[1]&&!mS(h,P)&&h.push(P)}),h.sort()}function JU(h){if(h instanceof Lt)return h.clone();var g=new Vo(h.__wrapped__,h.__chain__);return g.__actions__=ks(h.__actions__),g.__index__=h.__index__,g.__values__=h.__values__,g}function $me(h,g,E){(E?is(h,g,E):g===n)?g=1:g=Lr(bt(g),0);var P=h==null?0:h.length;if(!P||g<1)return[];for(var D=0,H=0,z=de(IS(P/g));D<P;)z[H++]=Go(h,D,D+=g);return z}function Fme(h){for(var g=-1,E=h==null?0:h.length,P=0,D=[];++g<E;){var H=h[g];H&&(D[P++]=H)}return D}function Bme(){var h=arguments.length;if(!h)return[];for(var g=de(h-1),E=arguments[0],P=h;P--;)g[P-1]=arguments[P];return zu(mt(E)?ks(E):[E],hi(g,1))}var jme=Ct(function(h,g){return pr(h)?wy(h,hi(g,1,pr,!0)):[]}),Hme=Ct(function(h,g){var E=zo(g);return pr(E)&&(E=n),pr(h)?wy(h,hi(g,1,pr,!0),st(E,2)):[]}),Kme=Ct(function(h,g){var E=zo(g);return pr(E)&&(E=n),pr(h)?wy(h,hi(g,1,pr,!0),n,E):[]});function Vme(h,g,E){var P=h==null?0:h.length;return P?(g=E||g===n?1:bt(g),Go(h,g<0?0:g,P)):[]}function qme(h,g,E){var P=h==null?0:h.length;return P?(g=E||g===n?1:bt(g),g=P-g,Go(h,0,g<0?0:g)):[]}function Gme(h,g){return h&&h.length?$S(h,st(g,3),!0,!0):[]}function zme(h,g){return h&&h.length?$S(h,st(g,3),!0):[]}function Wme(h,g,E,P){var D=h==null?0:h.length;return D?(E&&typeof E!="number"&&is(h,g,E)&&(E=0,P=D),Bge(h,g,E,P)):[]}function XU(h,g,E){var P=h==null?0:h.length;if(!P)return-1;var D=E==null?0:bt(E);return D<0&&(D=Lr(P+D,0)),vS(h,st(g,3),D)}function ZU(h,g,E){var P=h==null?0:h.length;if(!P)return-1;var D=P-1;return E!==n&&(D=bt(E),D=E<0?Lr(P+D,0):Ni(D,P-1)),vS(h,st(g,3),D,!0)}function QU(h){var g=h==null?0:h.length;return g?hi(h,1):[]}function Yme(h){var g=h==null?0:h.length;return g?hi(h,J):[]}function Jme(h,g){var E=h==null?0:h.length;return E?(g=g===n?1:bt(g),hi(h,g)):[]}function Xme(h){for(var g=-1,E=h==null?0:h.length,P={};++g<E;){var D=h[g];P[D[0]]=D[1]}return P}function e$(h){return h&&h.length?h[0]:n}function Zme(h,g,E){var P=h==null?0:h.length;if(!P)return-1;var D=E==null?0:bt(E);return D<0&&(D=Lr(P+D,0)),Yp(h,g,D)}function Qme(h){var g=h==null?0:h.length;return g?Go(h,0,-1):[]}var eve=Ct(function(h){var g=Bn(h,Tx);return g.length&&g[0]===h[0]?px(g):[]}),tve=Ct(function(h){var g=zo(h),E=Bn(h,Tx);return g===zo(E)?g=n:E.pop(),E.length&&E[0]===h[0]?px(E,st(g,2)):[]}),nve=Ct(function(h){var g=zo(h),E=Bn(h,Tx);return g=typeof g=="function"?g:n,g&&E.pop(),E.length&&E[0]===h[0]?px(E,n,g):[]});function rve(h,g){return h==null?"":Qpe.call(h,g)}function zo(h){var g=h==null?0:h.length;return g?h[g-1]:n}function ive(h,g,E){var P=h==null?0:h.length;if(!P)return-1;var D=P;return E!==n&&(D=bt(E),D=D<0?Lr(P+D,0):Ni(D,P-1)),g===g?Upe(h,g,D):vS(h,L7,D,!0)}function sve(h,g){return h&&h.length?dU(h,bt(g)):n}var ove=Ct(t$);function t$(h,g){return h&&h.length&&g&&g.length?yx(h,g):h}function ave(h,g,E){return h&&h.length&&g&&g.length?yx(h,g,st(E,2)):h}function cve(h,g,E){return h&&h.length&&g&&g.length?yx(h,g,n,E):h}var lve=Tl(function(h,g){var E=h==null?0:h.length,P=ux(h,g);return pU(h,Bn(g,function(D){return Cl(D,E)?+D:D}).sort(TU)),P});function uve(h,g){var E=[];if(!(h&&h.length))return E;var P=-1,D=[],H=h.length;for(g=st(g,3);++P<H;){var z=h[P];g(z,P,h)&&(E.push(z),D.push(P))}return pU(h,D),E}function $x(h){return h==null?h:rge.call(h)}function dve(h,g,E){var P=h==null?0:h.length;return P?(E&&typeof E!="number"&&is(h,g,E)?(g=0,E=P):(g=g==null?0:bt(g),E=E===n?P:bt(E)),Go(h,g,E)):[]}function fve(h,g){return US(h,g)}function hve(h,g,E){return Sx(h,g,st(E,2))}function pve(h,g){var E=h==null?0:h.length;if(E){var P=US(h,g);if(P<E&&La(h[P],g))return P}return-1}function gve(h,g){return US(h,g,!0)}function mve(h,g,E){return Sx(h,g,st(E,2),!0)}function vve(h,g){var E=h==null?0:h.length;if(E){var P=US(h,g,!0)-1;if(La(h[P],g))return P}return-1}function yve(h){return h&&h.length?mU(h):[]}function _ve(h,g){return h&&h.length?mU(h,st(g,2)):[]}function bve(h){var g=h==null?0:h.length;return g?Go(h,1,g):[]}function Sve(h,g,E){return h&&h.length?(g=E||g===n?1:bt(g),Go(h,0,g<0?0:g)):[]}function wve(h,g,E){var P=h==null?0:h.length;return P?(g=E||g===n?1:bt(g),g=P-g,Go(h,g<0?0:g,P)):[]}function Eve(h,g){return h&&h.length?$S(h,st(g,3),!1,!0):[]}function Tve(h,g){return h&&h.length?$S(h,st(g,3)):[]}var Cve=Ct(function(h){return Xu(hi(h,1,pr,!0))}),kve=Ct(function(h){var g=zo(h);return pr(g)&&(g=n),Xu(hi(h,1,pr,!0),st(g,2))}),Rve=Ct(function(h){var g=zo(h);return g=typeof g=="function"?g:n,Xu(hi(h,1,pr,!0),n,g)});function Ive(h){return h&&h.length?Xu(h):[]}function xve(h,g){return h&&h.length?Xu(h,st(g,2)):[]}function Pve(h,g){return g=typeof g=="function"?g:n,h&&h.length?Xu(h,n,g):[]}function Fx(h){if(!(h&&h.length))return[];var g=0;return h=Gu(h,function(E){if(pr(E))return g=Lr(E.length,g),!0}),nx(g,function(E){return Bn(h,QI(E))})}function n$(h,g){if(!(h&&h.length))return[];var E=Fx(h);return g==null?E:Bn(E,function(P){return so(g,n,P)})}var Ove=Ct(function(h,g){return pr(h)?wy(h,g):[]}),Mve=Ct(function(h){return Ex(Gu(h,pr))}),Ave=Ct(function(h){var g=zo(h);return pr(g)&&(g=n),Ex(Gu(h,pr),st(g,2))}),Lve=Ct(function(h){var g=zo(h);return g=typeof g=="function"?g:n,Ex(Gu(h,pr),n,g)}),Dve=Ct(Fx);function Nve(h,g){return bU(h||[],g||[],Sy)}function Uve(h,g){return bU(h||[],g||[],Cy)}var $ve=Ct(function(h){var g=h.length,E=g>1?h[g-1]:n;return E=typeof E=="function"?(h.pop(),E):n,n$(h,E)});function r$(h){var g=B(h);return g.__chain__=!0,g}function Fve(h,g){return g(h),h}function zS(h,g){return g(h)}var Bve=Tl(function(h){var g=h.length,E=g?h[0]:0,P=this.__wrapped__,D=function(H){return ux(H,h)};return g>1||this.__actions__.length||!(P instanceof Lt)||!Cl(E)?this.thru(D):(P=P.slice(E,+E+(g?1:0)),P.__actions__.push({func:zS,args:[D],thisArg:n}),new Vo(P,this.__chain__).thru(function(H){return g&&!H.length&&H.push(n),H}))});function jve(){return r$(this)}function Hve(){return new Vo(this.value(),this.__chain__)}function Kve(){this.__values__===n&&(this.__values__=v$(this.value()));var h=this.__index__>=this.__values__.length,g=h?n:this.__values__[this.__index__++];return{done:h,value:g}}function Vve(){return this}function qve(h){for(var g,E=this;E instanceof MS;){var P=JU(E);P.__index__=0,P.__values__=n,g?D.__wrapped__=P:g=P;var D=P;E=E.__wrapped__}return D.__wrapped__=h,g}function Gve(){var h=this.__wrapped__;if(h instanceof Lt){var g=h;return this.__actions__.length&&(g=new Lt(this)),g=g.reverse(),g.__actions__.push({func:zS,args:[$x],thisArg:n}),new Vo(g,this.__chain__)}return this.thru($x)}function zve(){return _U(this.__wrapped__,this.__actions__)}var Wve=FS(function(h,g,E){rn.call(h,E)?++h[E]:wl(h,E,1)});function Yve(h,g,E){var P=mt(h)?M7:Fge;return E&&is(h,g,E)&&(g=n),P(h,st(g,3))}function Jve(h,g){var E=mt(h)?Gu:nU;return E(h,st(g,3))}var Xve=PU(XU),Zve=PU(ZU);function Qve(h,g){return hi(WS(h,g),1)}function eye(h,g){return hi(WS(h,g),J)}function tye(h,g,E){return E=E===n?1:bt(E),hi(WS(h,g),E)}function i$(h,g){var E=mt(h)?Ho:Ju;return E(h,st(g,3))}function s$(h,g){var E=mt(h)?bpe:tU;return E(h,st(g,3))}var nye=FS(function(h,g,E){rn.call(h,E)?h[E].push(g):wl(h,E,[g])});function rye(h,g,E,P){h=Rs(h)?h:ag(h),E=E&&!P?bt(E):0;var D=h.length;return E<0&&(E=Lr(D+E,0)),QS(h)?E<=D&&h.indexOf(g,E)>-1:!!D&&Yp(h,g,E)>-1}var iye=Ct(function(h,g,E){var P=-1,D=typeof g=="function",H=Rs(h)?de(h.length):[];return Ju(h,function(z){H[++P]=D?so(g,z,E):Ey(z,g,E)}),H}),sye=FS(function(h,g,E){wl(h,E,g)});function WS(h,g){var E=mt(h)?Bn:cU;return E(h,st(g,3))}function oye(h,g,E,P){return h==null?[]:(mt(g)||(g=g==null?[]:[g]),E=P?n:E,mt(E)||(E=E==null?[]:[E]),fU(h,g,E))}var aye=FS(function(h,g,E){h[E?0:1].push(g)},function(){return[[],[]]});function cye(h,g,E){var P=mt(h)?XI:N7,D=arguments.length<3;return P(h,st(g,4),E,D,Ju)}function lye(h,g,E){var P=mt(h)?Spe:N7,D=arguments.length<3;return P(h,st(g,4),E,D,tU)}function uye(h,g){var E=mt(h)?Gu:nU;return E(h,XS(st(g,3)))}function dye(h){var g=mt(h)?X7:rme;return g(h)}function fye(h,g,E){(E?is(h,g,E):g===n)?g=1:g=bt(g);var P=mt(h)?Lge:ime;return P(h,g)}function hye(h){var g=mt(h)?Dge:ome;return g(h)}function pye(h){if(h==null)return 0;if(Rs(h))return QS(h)?Xp(h):h.length;var g=Ui(h);return g==Bt||g==ar?h.size:mx(h).length}function gye(h,g,E){var P=mt(h)?ZI:ame;return E&&is(h,g,E)&&(g=n),P(h,st(g,3))}var mye=Ct(function(h,g){if(h==null)return[];var E=g.length;return E>1&&is(h,g[0],g[1])?g=[]:E>2&&is(g[0],g[1],g[2])&&(g=[g[0]]),fU(h,hi(g,1),[])}),YS=Jpe||function(){return fi.Date.now()};function vye(h,g){if(typeof g!="function")throw new Ko(o);return h=bt(h),function(){if(--h<1)return g.apply(this,arguments)}}function o$(h,g,E){return g=E?n:g,g=h&&g==null?h.length:g,El(h,O,n,n,n,n,g)}function a$(h,g){var E;if(typeof g!="function")throw new Ko(o);return h=bt(h),function(){return--h>0&&(E=g.apply(this,arguments)),h<=1&&(g=n),E}}var Bx=Ct(function(h,g,E){var P=S;if(E.length){var D=Wu(E,sg(Bx));P|=I}return El(h,P,g,E,D)}),c$=Ct(function(h,g,E){var P=S|_;if(E.length){var D=Wu(E,sg(c$));P|=I}return El(g,P,h,E,D)});function l$(h,g,E){g=E?n:g;var P=El(h,T,n,n,n,n,n,g);return P.placeholder=l$.placeholder,P}function u$(h,g,E){g=E?n:g;var P=El(h,C,n,n,n,n,n,g);return P.placeholder=u$.placeholder,P}function d$(h,g,E){var P,D,H,z,Q,ie,ye=0,be=!1,Ee=!1,Le=!0;if(typeof h!="function")throw new Ko(o);g=Wo(g)||0,Qn(E)&&(be=!!E.leading,Ee="maxWait"in E,H=Ee?Lr(Wo(E.maxWait)||0,g):H,Le="trailing"in E?!!E.trailing:Le);function Ye(gr){var Da=P,Il=D;return P=D=n,ye=gr,z=h.apply(Il,Da),z}function ot(gr){return ye=gr,Q=Iy(Rt,g),be?Ye(gr):z}function Tt(gr){var Da=gr-ie,Il=gr-ye,P$=g-Da;return Ee?Ni(P$,H-Il):P$}function at(gr){var Da=gr-ie,Il=gr-ye;return ie===n||Da>=g||Da<0||Ee&&Il>=H}function Rt(){var gr=YS();if(at(gr))return Nt(gr);Q=Iy(Rt,Tt(gr))}function Nt(gr){return Q=n,Le&&P?Ye(gr):(P=D=n,z)}function lo(){Q!==n&&SU(Q),ye=0,P=ie=D=Q=n}function ss(){return Q===n?z:Nt(YS())}function uo(){var gr=YS(),Da=at(gr);if(P=arguments,D=this,ie=gr,Da){if(Q===n)return ot(ie);if(Ee)return SU(Q),Q=Iy(Rt,g),Ye(ie)}return Q===n&&(Q=Iy(Rt,g)),z}return uo.cancel=lo,uo.flush=ss,uo}var yye=Ct(function(h,g){return eU(h,1,g)}),_ye=Ct(function(h,g,E){return eU(h,Wo(g)||0,E)});function bye(h){return El(h,U)}function JS(h,g){if(typeof h!="function"||g!=null&&typeof g!="function")throw new Ko(o);var E=function(){var P=arguments,D=g?g.apply(this,P):P[0],H=E.cache;if(H.has(D))return H.get(D);var z=h.apply(this,P);return E.cache=H.set(D,z)||H,z};return E.cache=new(JS.Cache||Sl),E}JS.Cache=Sl;function XS(h){if(typeof h!="function")throw new Ko(o);return function(){var g=arguments;switch(g.length){case 0:return!h.call(this);case 1:return!h.call(this,g[0]);case 2:return!h.call(this,g[0],g[1]);case 3:return!h.call(this,g[0],g[1],g[2])}return!h.apply(this,g)}}function Sye(h){return a$(2,h)}var wye=cme(function(h,g){g=g.length==1&&mt(g[0])?Bn(g[0],oo(st())):Bn(hi(g,1),oo(st()));var E=g.length;return Ct(function(P){for(var D=-1,H=Ni(P.length,E);++D<H;)P[D]=g[D].call(this,P[D]);return so(h,this,P)})}),jx=Ct(function(h,g){var E=Wu(g,sg(jx));return El(h,I,n,g,E)}),f$=Ct(function(h,g){var E=Wu(g,sg(f$));return El(h,R,n,g,E)}),Eye=Tl(function(h,g){return El(h,A,n,n,n,g)});function Tye(h,g){if(typeof h!="function")throw new Ko(o);return g=g===n?g:bt(g),Ct(h,g)}function Cye(h,g){if(typeof h!="function")throw new Ko(o);return g=g==null?0:Lr(bt(g),0),Ct(function(E){var P=E[g],D=Qu(E,0,g);return P&&zu(D,P),so(h,this,D)})}function kye(h,g,E){var P=!0,D=!0;if(typeof h!="function")throw new Ko(o);return Qn(E)&&(P="leading"in E?!!E.leading:P,D="trailing"in E?!!E.trailing:D),d$(h,g,{leading:P,maxWait:g,trailing:D})}function Rye(h){return o$(h,1)}function Iye(h,g){return jx(Cx(g),h)}function xye(){if(!arguments.length)return[];var h=arguments[0];return mt(h)?h:[h]}function Pye(h){return qo(h,p)}function Oye(h,g){return g=typeof g=="function"?g:n,qo(h,p,g)}function Mye(h){return qo(h,d|p)}function Aye(h,g){return g=typeof g=="function"?g:n,qo(h,d|p,g)}function Lye(h,g){return g==null||Q7(h,g,Yr(g))}function La(h,g){return h===g||h!==h&&g!==g}var Dye=KS(hx),Nye=KS(function(h,g){return h>=g}),Gf=sU(function(){return arguments}())?sU:function(h){return lr(h)&&rn.call(h,"callee")&&!q7.call(h,"callee")},mt=de.isArray,Uye=k7?oo(k7):qge;function Rs(h){return h!=null&&ZS(h.length)&&!kl(h)}function pr(h){return lr(h)&&Rs(h)}function $ye(h){return h===!0||h===!1||lr(h)&&rs(h)==et}var ed=Zpe||Zx,Fye=R7?oo(R7):Gge;function Bye(h){return lr(h)&&h.nodeType===1&&!xy(h)}function jye(h){if(h==null)return!0;if(Rs(h)&&(mt(h)||typeof h=="string"||typeof h.splice=="function"||ed(h)||og(h)||Gf(h)))return!h.length;var g=Ui(h);if(g==Bt||g==ar)return!h.size;if(Ry(h))return!mx(h).length;for(var E in h)if(rn.call(h,E))return!1;return!0}function Hye(h,g){return Ty(h,g)}function Kye(h,g,E){E=typeof E=="function"?E:n;var P=E?E(h,g):n;return P===n?Ty(h,g,n,E):!!P}function Hx(h){if(!lr(h))return!1;var g=rs(h);return g==yn||g==Ae||typeof h.message=="string"&&typeof h.name=="string"&&!xy(h)}function Vye(h){return typeof h=="number"&&z7(h)}function kl(h){if(!Qn(h))return!1;var g=rs(h);return g==un||g==je||g==ze||g==kn}function h$(h){return typeof h=="number"&&h==bt(h)}function ZS(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=K}function Qn(h){var g=typeof h;return h!=null&&(g=="object"||g=="function")}function lr(h){return h!=null&&typeof h=="object"}var p$=I7?oo(I7):Wge;function qye(h,g){return h===g||gx(h,g,Mx(g))}function Gye(h,g,E){return E=typeof E=="function"?E:n,gx(h,g,Mx(g),E)}function zye(h){return g$(h)&&h!=+h}function Wye(h){if(Ome(h))throw new gt(s);return oU(h)}function Yye(h){return h===null}function Jye(h){return h==null}function g$(h){return typeof h=="number"||lr(h)&&rs(h)==_n}function xy(h){if(!lr(h)||rs(h)!=nn)return!1;var g=CS(h);if(g===null)return!0;var E=rn.call(g,"constructor")&&g.constructor;return typeof E=="function"&&E instanceof E&&SS.call(E)==Gpe}var Kx=x7?oo(x7):Yge;function Xye(h){return h$(h)&&h>=-K&&h<=K}var m$=P7?oo(P7):Jge;function QS(h){return typeof h=="string"||!mt(h)&&lr(h)&&rs(h)==dn}function co(h){return typeof h=="symbol"||lr(h)&&rs(h)==Xe}var og=O7?oo(O7):Xge;function Zye(h){return h===n}function Qye(h){return lr(h)&&Ui(h)==At}function e1e(h){return lr(h)&&rs(h)==_c}var t1e=KS(vx),n1e=KS(function(h,g){return h<=g});function v$(h){if(!h)return[];if(Rs(h))return QS(h)?Ma(h):ks(h);if(my&&h[my])return Lpe(h[my]());var g=Ui(h),E=g==Bt?ix:g==ar?yS:ag;return E(h)}function Rl(h){if(!h)return h===0?h:0;if(h=Wo(h),h===J||h===-J){var g=h<0?-1:1;return g*W}return h===h?h:0}function bt(h){var g=Rl(h),E=g%1;return g===g?E?g-E:g:0}function y$(h){return h?Hf(bt(h),0,ce):0}function Wo(h){if(typeof h=="number")return h;if(co(h))return Y;if(Qn(h)){var g=typeof h.valueOf=="function"?h.valueOf():h;h=Qn(g)?g+"":g}if(typeof h!="string")return h===0?h:+h;h=U7(h);var E=Uhe.test(h);return E||Fhe.test(h)?vpe(h.slice(2),E?2:8):Nhe.test(h)?Y:+h}function _$(h){return wc(h,Is(h))}function r1e(h){return h?Hf(bt(h),-K,K):h===0?h:0}function Qt(h){return h==null?"":ao(h)}var i1e=rg(function(h,g){if(Ry(g)||Rs(g)){wc(g,Yr(g),h);return}for(var E in g)rn.call(g,E)&&Sy(h,E,g[E])}),b$=rg(function(h,g){wc(g,Is(g),h)}),ew=rg(function(h,g,E,P){wc(g,Is(g),h,P)}),s1e=rg(function(h,g,E,P){wc(g,Yr(g),h,P)}),o1e=Tl(ux);function a1e(h,g){var E=ng(h);return g==null?E:Z7(E,g)}var c1e=Ct(function(h,g){h=bn(h);var E=-1,P=g.length,D=P>2?g[2]:n;for(D&&is(g[0],g[1],D)&&(P=1);++E<P;)for(var H=g[E],z=Is(H),Q=-1,ie=z.length;++Q<ie;){var ye=z[Q],be=h[ye];(be===n||La(be,Qp[ye])&&!rn.call(h,ye))&&(h[ye]=H[ye])}return h}),l1e=Ct(function(h){return h.push(n,UU),so(S$,n,h)});function u1e(h,g){return A7(h,st(g,3),Sc)}function d1e(h,g){return A7(h,st(g,3),fx)}function f1e(h,g){return h==null?h:dx(h,st(g,3),Is)}function h1e(h,g){return h==null?h:rU(h,st(g,3),Is)}function p1e(h,g){return h&&Sc(h,st(g,3))}function g1e(h,g){return h&&fx(h,st(g,3))}function m1e(h){return h==null?[]:DS(h,Yr(h))}function v1e(h){return h==null?[]:DS(h,Is(h))}function Vx(h,g,E){var P=h==null?n:Kf(h,g);return P===n?E:P}function y1e(h,g){return h!=null&&BU(h,g,jge)}function qx(h,g){return h!=null&&BU(h,g,Hge)}var _1e=MU(function(h,g,E){g!=null&&typeof g.toString!="function"&&(g=wS.call(g)),h[g]=E},zx(xs)),b1e=MU(function(h,g,E){g!=null&&typeof g.toString!="function"&&(g=wS.call(g)),rn.call(h,g)?h[g].push(E):h[g]=[E]},st),S1e=Ct(Ey);function Yr(h){return Rs(h)?J7(h):mx(h)}function Is(h){return Rs(h)?J7(h,!0):Zge(h)}function w1e(h,g){var E={};return g=st(g,3),Sc(h,function(P,D,H){wl(E,g(P,D,H),P)}),E}function E1e(h,g){var E={};return g=st(g,3),Sc(h,function(P,D,H){wl(E,D,g(P,D,H))}),E}var T1e=rg(function(h,g,E){NS(h,g,E)}),S$=rg(function(h,g,E,P){NS(h,g,E,P)}),C1e=Tl(function(h,g){var E={};if(h==null)return E;var P=!1;g=Bn(g,function(H){return H=Zu(H,h),P||(P=H.length>1),H}),wc(h,Px(h),E),P&&(E=qo(E,d|f|p,_me));for(var D=g.length;D--;)wx(E,g[D]);return E});function k1e(h,g){return w$(h,XS(st(g)))}var R1e=Tl(function(h,g){return h==null?{}:eme(h,g)});function w$(h,g){if(h==null)return{};var E=Bn(Px(h),function(P){return[P]});return g=st(g),hU(h,E,function(P,D){return g(P,D[0])})}function I1e(h,g,E){g=Zu(g,h);var P=-1,D=g.length;for(D||(D=1,h=n);++P<D;){var H=h==null?n:h[Ec(g[P])];H===n&&(P=D,H=E),h=kl(H)?H.call(h):H}return h}function x1e(h,g,E){return h==null?h:Cy(h,g,E)}function P1e(h,g,E,P){return P=typeof P=="function"?P:n,h==null?h:Cy(h,g,E,P)}var E$=DU(Yr),T$=DU(Is);function O1e(h,g,E){var P=mt(h),D=P||ed(h)||og(h);if(g=st(g,4),E==null){var H=h&&h.constructor;D?E=P?new H:[]:Qn(h)?E=kl(H)?ng(CS(h)):{}:E={}}return(D?Ho:Sc)(h,function(z,Q,ie){return g(E,z,Q,ie)}),E}function M1e(h,g){return h==null?!0:wx(h,g)}function A1e(h,g,E){return h==null?h:yU(h,g,Cx(E))}function L1e(h,g,E,P){return P=typeof P=="function"?P:n,h==null?h:yU(h,g,Cx(E),P)}function ag(h){return h==null?[]:rx(h,Yr(h))}function D1e(h){return h==null?[]:rx(h,Is(h))}function N1e(h,g,E){return E===n&&(E=g,g=n),E!==n&&(E=Wo(E),E=E===E?E:0),g!==n&&(g=Wo(g),g=g===g?g:0),Hf(Wo(h),g,E)}function U1e(h,g,E){return g=Rl(g),E===n?(E=g,g=0):E=Rl(E),h=Wo(h),Kge(h,g,E)}function $1e(h,g,E){if(E&&typeof E!="boolean"&&is(h,g,E)&&(g=E=n),E===n&&(typeof g=="boolean"?(E=g,g=n):typeof h=="boolean"&&(E=h,h=n)),h===n&&g===n?(h=0,g=1):(h=Rl(h),g===n?(g=h,h=0):g=Rl(g)),h>g){var P=h;h=g,g=P}if(E||h%1||g%1){var D=W7();return Ni(h+D*(g-h+mpe("1e-"+((D+"").length-1))),g)}return _x(h,g)}var F1e=ig(function(h,g,E){return g=g.toLowerCase(),h+(E?C$(g):g)});function C$(h){return Gx(Qt(h).toLowerCase())}function k$(h){return h=Qt(h),h&&h.replace(jhe,xpe).replace(ope,"")}function B1e(h,g,E){h=Qt(h),g=ao(g);var P=h.length;E=E===n?P:Hf(bt(E),0,P);var D=E;return E-=g.length,E>=0&&h.slice(E,D)==g}function j1e(h){return h=Qt(h),h&&cr.test(h)?h.replace(yt,Ppe):h}function H1e(h){return h=Qt(h),h&&Rhe.test(h)?h.replace(zp,"\\$&"):h}var K1e=ig(function(h,g,E){return h+(E?"-":"")+g.toLowerCase()}),V1e=ig(function(h,g,E){return h+(E?" ":"")+g.toLowerCase()}),q1e=xU("toLowerCase");function G1e(h,g,E){h=Qt(h),g=bt(g);var P=g?Xp(h):0;if(!g||P>=g)return h;var D=(g-P)/2;return HS(xS(D),E)+h+HS(IS(D),E)}function z1e(h,g,E){h=Qt(h),g=bt(g);var P=g?Xp(h):0;return g&&P<g?h+HS(g-P,E):h}function W1e(h,g,E){h=Qt(h),g=bt(g);var P=g?Xp(h):0;return g&&P<g?HS(g-P,E)+h:h}function Y1e(h,g,E){return E||g==null?g=0:g&&(g=+g),nge(Qt(h).replace(HI,""),g||0)}function J1e(h,g,E){return(E?is(h,g,E):g===n)?g=1:g=bt(g),bx(Qt(h),g)}function X1e(){var h=arguments,g=Qt(h[0]);return h.length<3?g:g.replace(h[1],h[2])}var Z1e=ig(function(h,g,E){return h+(E?"_":"")+g.toLowerCase()});function Q1e(h,g,E){return E&&typeof E!="number"&&is(h,g,E)&&(g=E=n),E=E===n?ce:E>>>0,E?(h=Qt(h),h&&(typeof g=="string"||g!=null&&!Kx(g))&&(g=ao(g),!g&&Jp(h))?Qu(Ma(h),0,E):h.split(g,E)):[]}var e0e=ig(function(h,g,E){return h+(E?" ":"")+Gx(g)});function t0e(h,g,E){return h=Qt(h),E=E==null?0:Hf(bt(E),0,h.length),g=ao(g),h.slice(E,E+g.length)==g}function n0e(h,g,E){var P=B.templateSettings;E&&is(h,g,E)&&(g=n),h=Qt(h),g=ew({},g,P,NU);var D=ew({},g.imports,P.imports,NU),H=Yr(D),z=rx(D,H),Q,ie,ye=0,be=g.interpolate||hS,Ee="__p += '",Le=sx((g.escape||hS).source+"|"+be.source+"|"+(be===io?Dhe:hS).source+"|"+(g.evaluate||hS).source+"|$","g"),Ye="//# sourceURL="+(rn.call(g,"sourceURL")?(g.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++dpe+"]")+`
`;h.replace(Le,function(at,Rt,Nt,lo,ss,uo){return Nt||(Nt=lo),Ee+=h.slice(ye,uo).replace(Hhe,Ope),Rt&&(Q=!0,Ee+=`' +
__e(`+Rt+`) +
'`),ss&&(ie=!0,Ee+=`';
`+ss+`;
__p += '`),Nt&&(Ee+=`' +
((__t = (`+Nt+`)) == null ? '' : __t) +
'`),ye=uo+at.length,at}),Ee+=`';
`;var ot=rn.call(g,"variable")&&g.variable;if(!ot)Ee=`with (obj) {
`+Ee+`
}
`;else if(Ahe.test(ot))throw new gt(a);Ee=(ie?Ee.replace(_e,""):Ee).replace(nt,"$1").replace(ut,"$1;"),Ee="function("+(ot||"obj")+`) {
`+(ot?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Q?", __e = _.escape":"")+(ie?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ee+`return __p
}`;var Tt=I$(function(){return Jt(H,Ye+"return "+Ee).apply(n,z)});if(Tt.source=Ee,Hx(Tt))throw Tt;return Tt}function r0e(h){return Qt(h).toLowerCase()}function i0e(h){return Qt(h).toUpperCase()}function s0e(h,g,E){if(h=Qt(h),h&&(E||g===n))return U7(h);if(!h||!(g=ao(g)))return h;var P=Ma(h),D=Ma(g),H=$7(P,D),z=F7(P,D)+1;return Qu(P,H,z).join("")}function o0e(h,g,E){if(h=Qt(h),h&&(E||g===n))return h.slice(0,j7(h)+1);if(!h||!(g=ao(g)))return h;var P=Ma(h),D=F7(P,Ma(g))+1;return Qu(P,0,D).join("")}function a0e(h,g,E){if(h=Qt(h),h&&(E||g===n))return h.replace(HI,"");if(!h||!(g=ao(g)))return h;var P=Ma(h),D=$7(P,Ma(g));return Qu(P,D).join("")}function c0e(h,g){var E=N,P=L;if(Qn(g)){var D="separator"in g?g.separator:D;E="length"in g?bt(g.length):E,P="omission"in g?ao(g.omission):P}h=Qt(h);var H=h.length;if(Jp(h)){var z=Ma(h);H=z.length}if(E>=H)return h;var Q=E-Xp(P);if(Q<1)return P;var ie=z?Qu(z,0,Q).join(""):h.slice(0,Q);if(D===n)return ie+P;if(z&&(Q+=ie.length-Q),Kx(D)){if(h.slice(Q).search(D)){var ye,be=ie;for(D.global||(D=sx(D.source,Qt(s7.exec(D))+"g")),D.lastIndex=0;ye=D.exec(be);)var Ee=ye.index;ie=ie.slice(0,Ee===n?Q:Ee)}}else if(h.indexOf(ao(D),Q)!=Q){var Le=ie.lastIndexOf(D);Le>-1&&(ie=ie.slice(0,Le))}return ie+P}function l0e(h){return h=Qt(h),h&&Xn.test(h)?h.replace(Et,$pe):h}var u0e=ig(function(h,g,E){return h+(E?" ":"")+g.toUpperCase()}),Gx=xU("toUpperCase");function R$(h,g,E){return h=Qt(h),g=E?n:g,g===n?Ape(h)?jpe(h):Tpe(h):h.match(g)||[]}var I$=Ct(function(h,g){try{return so(h,n,g)}catch(E){return Hx(E)?E:new gt(E)}}),d0e=Tl(function(h,g){return Ho(g,function(E){E=Ec(E),wl(h,E,Bx(h[E],h))}),h});function f0e(h){var g=h==null?0:h.length,E=st();return h=g?Bn(h,function(P){if(typeof P[1]!="function")throw new Ko(o);return[E(P[0]),P[1]]}):[],Ct(function(P){for(var D=-1;++D<g;){var H=h[D];if(so(H[0],this,P))return so(H[1],this,P)}})}function h0e(h){return $ge(qo(h,d))}function zx(h){return function(){return h}}function p0e(h,g){return h==null||h!==h?g:h}var g0e=OU(),m0e=OU(!0);function xs(h){return h}function Wx(h){return aU(typeof h=="function"?h:qo(h,d))}function v0e(h){return lU(qo(h,d))}function y0e(h,g){return uU(h,qo(g,d))}var _0e=Ct(function(h,g){return function(E){return Ey(E,h,g)}}),b0e=Ct(function(h,g){return function(E){return Ey(h,E,g)}});function Yx(h,g,E){var P=Yr(g),D=DS(g,P);E==null&&!(Qn(g)&&(D.length||!P.length))&&(E=g,g=h,h=this,D=DS(g,Yr(g)));var H=!(Qn(E)&&"chain"in E)||!!E.chain,z=kl(h);return Ho(D,function(Q){var ie=g[Q];h[Q]=ie,z&&(h.prototype[Q]=function(){var ye=this.__chain__;if(H||ye){var be=h(this.__wrapped__),Ee=be.__actions__=ks(this.__actions__);return Ee.push({func:ie,args:arguments,thisArg:h}),be.__chain__=ye,be}return ie.apply(h,zu([this.value()],arguments))})}),h}function S0e(){return fi._===this&&(fi._=zpe),this}function Jx(){}function w0e(h){return h=bt(h),Ct(function(g){return dU(g,h)})}var E0e=Rx(Bn),T0e=Rx(M7),C0e=Rx(ZI);function x$(h){return Lx(h)?QI(Ec(h)):tme(h)}function k0e(h){return function(g){return h==null?n:Kf(h,g)}}var R0e=AU(),I0e=AU(!0);function Xx(){return[]}function Zx(){return!1}function x0e(){return{}}function P0e(){return""}function O0e(){return!0}function M0e(h,g){if(h=bt(h),h<1||h>K)return[];var E=ce,P=Ni(h,ce);g=st(g),h-=ce;for(var D=nx(P,g);++E<h;)g(E);return D}function A0e(h){return mt(h)?Bn(h,Ec):co(h)?[h]:ks(YU(Qt(h)))}function L0e(h){var g=++qpe;return Qt(h)+g}var D0e=jS(function(h,g){return h+g},0),N0e=Ix("ceil"),U0e=jS(function(h,g){return h/g},1),$0e=Ix("floor");function F0e(h){return h&&h.length?LS(h,xs,hx):n}function B0e(h,g){return h&&h.length?LS(h,st(g,2),hx):n}function j0e(h){return D7(h,xs)}function H0e(h,g){return D7(h,st(g,2))}function K0e(h){return h&&h.length?LS(h,xs,vx):n}function V0e(h,g){return h&&h.length?LS(h,st(g,2),vx):n}var q0e=jS(function(h,g){return h*g},1),G0e=Ix("round"),z0e=jS(function(h,g){return h-g},0);function W0e(h){return h&&h.length?tx(h,xs):0}function Y0e(h,g){return h&&h.length?tx(h,st(g,2)):0}return B.after=vye,B.ary=o$,B.assign=i1e,B.assignIn=b$,B.assignInWith=ew,B.assignWith=s1e,B.at=o1e,B.before=a$,B.bind=Bx,B.bindAll=d0e,B.bindKey=c$,B.castArray=xye,B.chain=r$,B.chunk=$me,B.compact=Fme,B.concat=Bme,B.cond=f0e,B.conforms=h0e,B.constant=zx,B.countBy=Wve,B.create=a1e,B.curry=l$,B.curryRight=u$,B.debounce=d$,B.defaults=c1e,B.defaultsDeep=l1e,B.defer=yye,B.delay=_ye,B.difference=jme,B.differenceBy=Hme,B.differenceWith=Kme,B.drop=Vme,B.dropRight=qme,B.dropRightWhile=Gme,B.dropWhile=zme,B.fill=Wme,B.filter=Jve,B.flatMap=Qve,B.flatMapDeep=eye,B.flatMapDepth=tye,B.flatten=QU,B.flattenDeep=Yme,B.flattenDepth=Jme,B.flip=bye,B.flow=g0e,B.flowRight=m0e,B.fromPairs=Xme,B.functions=m1e,B.functionsIn=v1e,B.groupBy=nye,B.initial=Qme,B.intersection=eve,B.intersectionBy=tve,B.intersectionWith=nve,B.invert=_1e,B.invertBy=b1e,B.invokeMap=iye,B.iteratee=Wx,B.keyBy=sye,B.keys=Yr,B.keysIn=Is,B.map=WS,B.mapKeys=w1e,B.mapValues=E1e,B.matches=v0e,B.matchesProperty=y0e,B.memoize=JS,B.merge=T1e,B.mergeWith=S$,B.method=_0e,B.methodOf=b0e,B.mixin=Yx,B.negate=XS,B.nthArg=w0e,B.omit=C1e,B.omitBy=k1e,B.once=Sye,B.orderBy=oye,B.over=E0e,B.overArgs=wye,B.overEvery=T0e,B.overSome=C0e,B.partial=jx,B.partialRight=f$,B.partition=aye,B.pick=R1e,B.pickBy=w$,B.property=x$,B.propertyOf=k0e,B.pull=ove,B.pullAll=t$,B.pullAllBy=ave,B.pullAllWith=cve,B.pullAt=lve,B.range=R0e,B.rangeRight=I0e,B.rearg=Eye,B.reject=uye,B.remove=uve,B.rest=Tye,B.reverse=$x,B.sampleSize=fye,B.set=x1e,B.setWith=P1e,B.shuffle=hye,B.slice=dve,B.sortBy=mye,B.sortedUniq=yve,B.sortedUniqBy=_ve,B.split=Q1e,B.spread=Cye,B.tail=bve,B.take=Sve,B.takeRight=wve,B.takeRightWhile=Eve,B.takeWhile=Tve,B.tap=Fve,B.throttle=kye,B.thru=zS,B.toArray=v$,B.toPairs=E$,B.toPairsIn=T$,B.toPath=A0e,B.toPlainObject=_$,B.transform=O1e,B.unary=Rye,B.union=Cve,B.unionBy=kve,B.unionWith=Rve,B.uniq=Ive,B.uniqBy=xve,B.uniqWith=Pve,B.unset=M1e,B.unzip=Fx,B.unzipWith=n$,B.update=A1e,B.updateWith=L1e,B.values=ag,B.valuesIn=D1e,B.without=Ove,B.words=R$,B.wrap=Iye,B.xor=Mve,B.xorBy=Ave,B.xorWith=Lve,B.zip=Dve,B.zipObject=Nve,B.zipObjectDeep=Uve,B.zipWith=$ve,B.entries=E$,B.entriesIn=T$,B.extend=b$,B.extendWith=ew,Yx(B,B),B.add=D0e,B.attempt=I$,B.camelCase=F1e,B.capitalize=C$,B.ceil=N0e,B.clamp=N1e,B.clone=Pye,B.cloneDeep=Mye,B.cloneDeepWith=Aye,B.cloneWith=Oye,B.conformsTo=Lye,B.deburr=k$,B.defaultTo=p0e,B.divide=U0e,B.endsWith=B1e,B.eq=La,B.escape=j1e,B.escapeRegExp=H1e,B.every=Yve,B.find=Xve,B.findIndex=XU,B.findKey=u1e,B.findLast=Zve,B.findLastIndex=ZU,B.findLastKey=d1e,B.floor=$0e,B.forEach=i$,B.forEachRight=s$,B.forIn=f1e,B.forInRight=h1e,B.forOwn=p1e,B.forOwnRight=g1e,B.get=Vx,B.gt=Dye,B.gte=Nye,B.has=y1e,B.hasIn=qx,B.head=e$,B.identity=xs,B.includes=rye,B.indexOf=Zme,B.inRange=U1e,B.invoke=S1e,B.isArguments=Gf,B.isArray=mt,B.isArrayBuffer=Uye,B.isArrayLike=Rs,B.isArrayLikeObject=pr,B.isBoolean=$ye,B.isBuffer=ed,B.isDate=Fye,B.isElement=Bye,B.isEmpty=jye,B.isEqual=Hye,B.isEqualWith=Kye,B.isError=Hx,B.isFinite=Vye,B.isFunction=kl,B.isInteger=h$,B.isLength=ZS,B.isMap=p$,B.isMatch=qye,B.isMatchWith=Gye,B.isNaN=zye,B.isNative=Wye,B.isNil=Jye,B.isNull=Yye,B.isNumber=g$,B.isObject=Qn,B.isObjectLike=lr,B.isPlainObject=xy,B.isRegExp=Kx,B.isSafeInteger=Xye,B.isSet=m$,B.isString=QS,B.isSymbol=co,B.isTypedArray=og,B.isUndefined=Zye,B.isWeakMap=Qye,B.isWeakSet=e1e,B.join=rve,B.kebabCase=K1e,B.last=zo,B.lastIndexOf=ive,B.lowerCase=V1e,B.lowerFirst=q1e,B.lt=t1e,B.lte=n1e,B.max=F0e,B.maxBy=B0e,B.mean=j0e,B.meanBy=H0e,B.min=K0e,B.minBy=V0e,B.stubArray=Xx,B.stubFalse=Zx,B.stubObject=x0e,B.stubString=P0e,B.stubTrue=O0e,B.multiply=q0e,B.nth=sve,B.noConflict=S0e,B.noop=Jx,B.now=YS,B.pad=G1e,B.padEnd=z1e,B.padStart=W1e,B.parseInt=Y1e,B.random=$1e,B.reduce=cye,B.reduceRight=lye,B.repeat=J1e,B.replace=X1e,B.result=I1e,B.round=G0e,B.runInContext=ne,B.sample=dye,B.size=pye,B.snakeCase=Z1e,B.some=gye,B.sortedIndex=fve,B.sortedIndexBy=hve,B.sortedIndexOf=pve,B.sortedLastIndex=gve,B.sortedLastIndexBy=mve,B.sortedLastIndexOf=vve,B.startCase=e0e,B.startsWith=t0e,B.subtract=z0e,B.sum=W0e,B.sumBy=Y0e,B.template=n0e,B.times=M0e,B.toFinite=Rl,B.toInteger=bt,B.toLength=y$,B.toLower=r0e,B.toNumber=Wo,B.toSafeInteger=r1e,B.toString=Qt,B.toUpper=i0e,B.trim=s0e,B.trimEnd=o0e,B.trimStart=a0e,B.truncate=c0e,B.unescape=l0e,B.uniqueId=L0e,B.upperCase=u0e,B.upperFirst=Gx,B.each=i$,B.eachRight=s$,B.first=e$,Yx(B,function(){var h={};return Sc(B,function(g,E){rn.call(B.prototype,E)||(h[E]=g)}),h}(),{chain:!1}),B.VERSION=r,Ho(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){B[h].placeholder=B}),Ho(["drop","take"],function(h,g){Lt.prototype[h]=function(E){E=E===n?1:Lr(bt(E),0);var P=this.__filtered__&&!g?new Lt(this):this.clone();return P.__filtered__?P.__takeCount__=Ni(E,P.__takeCount__):P.__views__.push({size:Ni(E,ce),type:h+(P.__dir__<0?"Right":"")}),P},Lt.prototype[h+"Right"]=function(E){return this.reverse()[h](E).reverse()}}),Ho(["filter","map","takeWhile"],function(h,g){var E=g+1,P=E==G||E==V;Lt.prototype[h]=function(D){var H=this.clone();return H.__iteratees__.push({iteratee:st(D,3),type:E}),H.__filtered__=H.__filtered__||P,H}}),Ho(["head","last"],function(h,g){var E="take"+(g?"Right":"");Lt.prototype[h]=function(){return this[E](1).value()[0]}}),Ho(["initial","tail"],function(h,g){var E="drop"+(g?"":"Right");Lt.prototype[h]=function(){return this.__filtered__?new Lt(this):this[E](1)}}),Lt.prototype.compact=function(){return this.filter(xs)},Lt.prototype.find=function(h){return this.filter(h).head()},Lt.prototype.findLast=function(h){return this.reverse().find(h)},Lt.prototype.invokeMap=Ct(function(h,g){return typeof h=="function"?new Lt(this):this.map(function(E){return Ey(E,h,g)})}),Lt.prototype.reject=function(h){return this.filter(XS(st(h)))},Lt.prototype.slice=function(h,g){h=bt(h);var E=this;return E.__filtered__&&(h>0||g<0)?new Lt(E):(h<0?E=E.takeRight(-h):h&&(E=E.drop(h)),g!==n&&(g=bt(g),E=g<0?E.dropRight(-g):E.take(g-h)),E)},Lt.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},Lt.prototype.toArray=function(){return this.take(ce)},Sc(Lt.prototype,function(h,g){var E=/^(?:filter|find|map|reject)|While$/.test(g),P=/^(?:head|last)$/.test(g),D=B[P?"take"+(g=="last"?"Right":""):g],H=P||/^find/.test(g);D&&(B.prototype[g]=function(){var z=this.__wrapped__,Q=P?[1]:arguments,ie=z instanceof Lt,ye=Q[0],be=ie||mt(z),Ee=function(Rt){var Nt=D.apply(B,zu([Rt],Q));return P&&Le?Nt[0]:Nt};be&&E&&typeof ye=="function"&&ye.length!=1&&(ie=be=!1);var Le=this.__chain__,Ye=!!this.__actions__.length,ot=H&&!Le,Tt=ie&&!Ye;if(!H&&be){z=Tt?z:new Lt(this);var at=h.apply(z,Q);return at.__actions__.push({func:zS,args:[Ee],thisArg:n}),new Vo(at,Le)}return ot&&Tt?h.apply(this,Q):(at=this.thru(Ee),ot?P?at.value()[0]:at.value():at)})}),Ho(["pop","push","shift","sort","splice","unshift"],function(h){var g=_S[h],E=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",P=/^(?:pop|shift)$/.test(h);B.prototype[h]=function(){var D=arguments;if(P&&!this.__chain__){var H=this.value();return g.apply(mt(H)?H:[],D)}return this[E](function(z){return g.apply(mt(z)?z:[],D)})}}),Sc(Lt.prototype,function(h,g){var E=B[g];if(E){var P=E.name+"";rn.call(tg,P)||(tg[P]=[]),tg[P].push({name:g,func:E})}}),tg[BS(n,_).name]=[{name:"wrapper",func:n}],Lt.prototype.clone=lge,Lt.prototype.reverse=uge,Lt.prototype.value=dge,B.prototype.at=Bve,B.prototype.chain=jve,B.prototype.commit=Hve,B.prototype.next=Kve,B.prototype.plant=qve,B.prototype.reverse=Gve,B.prototype.toJSON=B.prototype.valueOf=B.prototype.value=zve,B.prototype.first=B.prototype.head,my&&(B.prototype[my]=Vve),B},Zp=Hpe();$f?(($f.exports=Zp)._=Zp,WI._=Zp):fi._=Zp}).call(la)})(Ok,Ok.exports);var HVe=Ok.exports;const lq=1024*1024*5,KVe=2*1e3,VVe=3;class qVe extends d4{constructor(){super(...arguments),this.logs="",this.log=(e,...n)=>{const r=new Date().toISOString();n=n.map(s=>s instanceof DOMException?s.message+` (${s.name} | ${s.code})`:s instanceof Error?s.message+(s.stack?`
${s.stack}`:""):typeof s=="object"?JSON.stringify(s,XVe()):s);let i=`${r} ${e} ${n.join(" ")}
`;i=i.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=i,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class GVe{constructor(e,n){this.indexedDB=e,this.loggerInstance=n,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=HVe.throttle(()=>this.flush,KVe,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?this.flushAgainPromise?this.flushAgainPromise:(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0}),this.flushAgainPromise):(this.flushPromise=new Promise((r,i)=>{if(!this.db){i(new Error("No connected database"));return}const s=this.loggerInstance.popLogs();if(s.length===0){r();return}const o=this.db.transaction(["logs","logslastmod"],"readwrite"),a=o.objectStore("logs");o.oncomplete=()=>{r()},o.onerror=l=>{var u;k.error("Failed to flush logs : ",l),i(new Error("Failed to write logs: "+((u=o==null?void 0:o.error)==null?void 0:u.message)))},a.add(this.generateLogEntry(s)),o.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+Zi(16),n.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(r=>k.error("Failed to flush logs before unload",r))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((n,r)=>{e.onsuccess=()=>{this.db=e.result,n()},e.onerror=()=>{var s;const i="Failed to open log database: "+((s=e==null?void 0:e.error)==null?void 0:s.name);k.error(i),r(new Error(i))},e.onupgradeneeded=()=>{const i=e.result,s=i.createObjectStore("logs",{keyPath:["id","index"]});s.createIndex("id","id",{unique:!1}),s.add(this.generateLogEntry(new Date+" ::: Log database was created.")),i.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function n(l,u){const d=e.transaction("logs","readonly").objectStore("logs");return new Promise((f,p)=>{const m=d.index("id").openCursor(IDBKeyRange.only(l),"prev");let v="";m.onerror=()=>{var S;p(new Error("Query failed: "+((S=m==null?void 0:m.error)==null?void 0:S.message)))},m.onsuccess=()=>{const S=m.result;if(!S){f(v);return}v=S.value.lines+v,v.length>=u?f(v):S.continue()}})}async function r(){const l=e.transaction("logslastmod","readonly").objectStore("logslastmod");return zVe(l,void 0,u=>({id:u.value.id,ts:u.value.ts})).then(u=>u.sort((d,f)=>f.ts-d.ts).map(d=>d.id))}async function i(l){return new Promise((u,d)=>{const f=e.transaction(["logs","logslastmod"],"readwrite"),p=f.objectStore("logs"),m=p.index("id").openKeyCursor(IDBKeyRange.only(l));m.onsuccess=()=>{const S=m.result;S&&(p.delete(S.primaryKey),S.continue())},f.oncomplete=()=>{u()},f.onerror=()=>{var S;d(new Error(`Failed to delete logs for '${l}' : ${(S=f==null?void 0:f.error)==null?void 0:S.message}`))},f.objectStore("logslastmod").delete(l)})}const s=await r();let o=[];const a=[];let c=0;for(let l=0;l<s.length;l++){const u=await n(s[l],lq-c);if(a.push({lines:u,id:s[l]}),c+=u.length,c>=lq){o=s.slice(l+1).map(d=>parseInt(d,10));break}}return o.length>0&&(k.log("Removing logs: ",o),Promise.all(o.map(async l=>i(l))).then(()=>{k.log(`Removed ${o.length} old logs.`)},l=>{k.error(l)})),a}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function zVe(t,e,n){const r=t.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r==null?void 0:r.error)==null?void 0:a.message)))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}async function WVe(){return global.mx_rage_logger=new qVe,uq(k,global.mx_rage_logger.log),["MatrixRTCSession","MatrixRTCSessionManager"].forEach(t=>{uq(k.getChild(t),global.mx_rage_logger.log)}),["trace","debug","info","warn","error"].forEach(t=>{const e=window.console[t];if(!e)return;const n=`${t.toUpperCase()} matrix_sdk`;window.console[t]=(...r)=>{e(...r),typeof r[0]=="string"&&r[0].startsWith(n)&&global.mx_rage_logger.log(MN[t],"matrix_sdk",...r)}}),YVe()}async function YVe(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;k.log("Configuring rageshake persistence...");let t;try{t=window.indexedDB}catch(e){k.warn("Could not get indexDB from window.",e)}return t?(global.mx_rage_store=new GVe(t,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function JVe(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const XVe=()=>{const t=new WeakSet,e=new WeakMap;return function(n,r){if(typeof r=="object"&&r!==null){if(t.has(r))return"<$ cycle-trimmed $>";t.add(r);let i=0;if(this&&(i=e.get(this)??0),e.set(r,i+1),i>VVe)return"<$ object-pruned $>"}return r}};var MN=(t=>(t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent",t))(MN||{});function uq(t,e){const n=t,r=n.methodFactory;n.methodFactory=function(i,s,o){const a=r(i,s,o),c=MN[i],l=c>=s&&c<5;return(...u)=>{a.apply(this,u),l&&e(c,o==null?void 0:o.toString(),...u)}},n.setLevel(n.getLevel())}var ZVe=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Ch="1.9.0",dq=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function QVe(t){var e=new Set([t]),n=new Set,r=t.match(dq);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===t};function s(a){return n.add(a),!1}function o(a){return e.add(a),!0}return function(c){if(e.has(c))return!0;if(n.has(c))return!1;var l=c.match(dq);if(!l)return s(c);var u={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return u.prerelease!=null||i.major!==u.major?s(c):i.major===0?i.minor===u.minor&&i.patch<=u.patch?o(c):s(c):i.minor<=u.minor?o(c):s(c)}}var eqe=QVe(Ch),tqe=Ch.split(".")[0],q_=Symbol.for("opentelemetry.js.api."+tqe),G_=ZVe;function Jb(t,e,n,r){var i;r===void 0&&(r=!1);var s=G_[q_]=(i=G_[q_])!==null&&i!==void 0?i:{version:Ch};if(!r&&s[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return n.error(o.stack||o.message),!1}if(s.version!==Ch){var o=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+Ch);return n.error(o.stack||o.message),!1}return s[t]=e,n.debug("@opentelemetry/api: Registered a global for "+t+" v"+Ch+"."),!0}function _p(t){var e,n,r=(e=G_[q_])===null||e===void 0?void 0:e.version;if(!(!r||!eqe(r)))return(n=G_[q_])===null||n===void 0?void 0:n[t]}function Xb(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+Ch+".");var n=G_[q_];n&&delete n[t]}var nqe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},rqe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},iqe=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a1("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a1("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a1("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a1("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return a1("verbose",this._namespace,e)},t}();function a1(t,e,n){var r=_p("diag");if(r)return n.unshift(e),r[t].apply(r,rqe([],nqe(n),!1))}var yr;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(yr||(yr={}));function sqe(t,e){t<yr.NONE?t=yr.NONE:t>yr.ALL&&(t=yr.ALL),e=e||{};function n(r,i){var s=e[r];return typeof s=="function"&&t>=i?s.bind(e):function(){}}return{error:n("error",yr.ERROR),warn:n("warn",yr.WARN),info:n("info",yr.INFO),debug:n("debug",yr.DEBUG),verbose:n("verbose",yr.VERBOSE)}}var oqe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},aqe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},cqe="diag",dl=function(){function t(){function e(i){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var a=_p("diag");if(a)return a[i].apply(a,aqe([],oqe(s),!1))}}var n=this,r=function(i,s){var o,a,c;if(s===void 0&&(s={logLevel:yr.INFO}),i===n){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return n.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof s=="number"&&(s={logLevel:s});var u=_p("diag"),d=sqe((a=s.logLevel)!==null&&a!==void 0?a:yr.INFO,i);if(u&&!s.suppressOverrideMessage){var f=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";u.warn("Current logger will be overwritten from "+f),d.warn("Current logger will overwrite one already registered from "+f)}return Jb("diag",d,n,!0)};n.setLogger=r,n.disable=function(){Xb(cqe,n)},n.createComponentLogger=function(i){return new iqe(i)},n.verbose=e("verbose"),n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),lqe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},uqe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},dqe=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var n=this._entries.get(e);if(n)return Object.assign({},n)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var n=lqe(e,2),r=n[0],i=n[1];return[r,i]})},t.prototype.setEntry=function(e,n){var r=new t(this._entries);return r._entries.set(e,n),r},t.prototype.removeEntry=function(e){var n=new t(this._entries);return n._entries.delete(e),n},t.prototype.removeEntries=function(){for(var e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new t(this._entries);try{for(var o=uqe(r),a=o.next();!a.done;a=o.next()){var c=a.value;s._entries.delete(c)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}(),fqe=Symbol("BaggageEntryMetadata"),hqe=dl.instance();function pqe(t){return t===void 0&&(t={}),new dqe(new Map(Object.entries(t)))}function gqe(t){return typeof t!="string"&&(hqe.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:fqe,toString:function(){return t}}}function AN(t){return Symbol.for(t)}var mqe=function(){function t(e){var n=this;n._currentContext=e?new Map(e):new Map,n.getValue=function(r){return n._currentContext.get(r)},n.setValue=function(r,i){var s=new t(n._currentContext);return s._currentContext.set(r,i),s},n.deleteValue=function(r){var i=new t(n._currentContext);return i._currentContext.delete(r),i}}return t}(),Ug=new mqe,Vp=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),vqe=function(){function t(){}return t.prototype.createGauge=function(e,n){return Rqe},t.prototype.createHistogram=function(e,n){return Iqe},t.prototype.createCounter=function(e,n){return kqe},t.prototype.createUpDownCounter=function(e,n){return xqe},t.prototype.createObservableGauge=function(e,n){return Oqe},t.prototype.createObservableCounter=function(e,n){return Pqe},t.prototype.createObservableUpDownCounter=function(e,n){return Mqe},t.prototype.addBatchObservableCallback=function(e,n){},t.prototype.removeBatchObservableCallback=function(e){},t}(),sI=function(){function t(){}return t}(),yqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(sI),_qe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(n,r){},e}(sI),bqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r){},e}(sI),Sqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(n,r){},e}(sI),LN=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),wqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(LN),Eqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(LN),Tqe=function(t){Vp(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(LN),Cqe=new vqe,kqe=new yqe,Rqe=new bqe,Iqe=new Sqe,xqe=new _qe,Pqe=new wqe,Oqe=new Eqe,Mqe=new Tqe,Aqe={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},Lqe={set:function(t,e,n){t!=null&&(t[e]=n)}},Dqe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Nqe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},Uqe=function(){function t(){}return t.prototype.active=function(){return Ug},t.prototype.with=function(e,n,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return n.call.apply(n,Nqe([r],Dqe(i),!1))},t.prototype.bind=function(e,n){return n},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),$qe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Fqe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},vO="context",Bqe=new Uqe,oI=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return Jb(vO,e,dl.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,n,r){for(var i,s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];return(i=this._getContextManager()).with.apply(i,Fqe([e,n,r],$qe(s),!1))},t.prototype.bind=function(e,n){return this._getContextManager().bind(e,n)},t.prototype._getContextManager=function(){return _p(vO)||Bqe},t.prototype.disable=function(){this._getContextManager().disable(),Xb(vO,dl.instance())},t}(),fl;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(fl||(fl={}));var ace="0000000000000000",cce="00000000000000000000000000000000",lce={traceId:cce,spanId:ace,traceFlags:fl.NONE},C0=function(){function t(e){e===void 0&&(e=lce),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,n){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,n){},t}(),DN=AN("OpenTelemetry Context Key SPAN");function NN(t){return t.getValue(DN)||void 0}function jqe(){return NN(oI.getInstance().active())}function UN(t,e){return t.setValue(DN,e)}function Hqe(t){return t.deleteValue(DN)}function Kqe(t,e){return UN(t,new C0(e))}function uce(t){var e;return(e=NN(t))===null||e===void 0?void 0:e.spanContext()}var Vqe=/^([0-9a-f]{32})$/i,qqe=/^[0-9a-f]{16}$/i;function dce(t){return Vqe.test(t)&&t!==cce}function Gqe(t){return qqe.test(t)&&t!==ace}function aI(t){return dce(t.traceId)&&Gqe(t.spanId)}function zqe(t){return new C0(t)}var yO=oI.getInstance(),fce=function(){function t(){}return t.prototype.startSpan=function(e,n,r){r===void 0&&(r=yO.active());var i=!!(n!=null&&n.root);if(i)return new C0;var s=r&&uce(r);return Wqe(s)&&aI(s)?new C0(s):new C0},t.prototype.startActiveSpan=function(e,n,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);var c=o??yO.active(),l=this.startSpan(e,s,c),u=UN(c,l);return yO.with(u,a,void 0,l)}},t}();function Wqe(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var Yqe=new fce,Jqe=function(){function t(e,n,r,i){this._provider=e,this.name=n,this.version=r,this.options=i}return t.prototype.startSpan=function(e,n,r){return this._getTracer().startSpan(e,n,r)},t.prototype.startActiveSpan=function(e,n,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Yqe},t}(),Xqe=function(){function t(){}return t.prototype.getTracer=function(e,n,r){return new fce},t}(),Zqe=new Xqe,fq=function(){function t(){}return t.prototype.getTracer=function(e,n,r){var i;return(i=this.getDelegateTracer(e,n,r))!==null&&i!==void 0?i:new Jqe(this,e,n,r)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:Zqe},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,n,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,n,r)},t}(),Mk;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Mk||(Mk={}));var q5;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(q5||(q5={}));var G5;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(G5||(G5={}));var vu=oI.getInstance(),Pt=dl.instance(),Qqe=function(){function t(){}return t.prototype.getMeter=function(e,n,r){return Cqe},t}(),eGe=new Qqe,_O="metrics",tGe=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return Jb(_O,e,dl.instance())},t.prototype.getMeterProvider=function(){return _p(_O)||eGe},t.prototype.getMeter=function(e,n,r){return this.getMeterProvider().getMeter(e,n,r)},t.prototype.disable=function(){Xb(_O,dl.instance())},t}(),nGe=tGe.getInstance(),rGe=function(){function t(){}return t.prototype.inject=function(e,n){},t.prototype.extract=function(e,n){return e},t.prototype.fields=function(){return[]},t}(),$N=AN("OpenTelemetry Baggage Key");function hce(t){return t.getValue($N)||void 0}function iGe(){return hce(oI.getInstance().active())}function sGe(t,e){return t.setValue($N,e)}function oGe(t){return t.deleteValue($N)}var bO="propagation",aGe=new rGe,cGe=function(){function t(){this.createBaggage=pqe,this.getBaggage=hce,this.getActiveBaggage=iGe,this.setBaggage=sGe,this.deleteBaggage=oGe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return Jb(bO,e,dl.instance())},t.prototype.inject=function(e,n,r){return r===void 0&&(r=Lqe),this._getGlobalPropagator().inject(e,n,r)},t.prototype.extract=function(e,n,r){return r===void 0&&(r=Aqe),this._getGlobalPropagator().extract(e,n,r)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){Xb(bO,dl.instance())},t.prototype._getGlobalPropagator=function(){return _p(bO)||aGe},t}(),k0=cGe.getInstance(),SO="trace",lGe=function(){function t(){this._proxyTracerProvider=new fq,this.wrapSpanContext=zqe,this.isSpanContextValid=aI,this.deleteSpan=Hqe,this.getSpan=NN,this.getActiveSpan=jqe,this.getSpanContext=uce,this.setSpan=UN,this.setSpanContext=Kqe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var n=Jb(SO,this._proxyTracerProvider,dl.instance());return n&&this._proxyTracerProvider.setDelegate(e),n},t.prototype.getTracerProvider=function(){return _p(SO)||this._proxyTracerProvider},t.prototype.getTracer=function(e,n){return this.getTracerProvider().getTracer(e,n)},t.prototype.disable=function(){Xb(SO,dl.instance()),this._proxyTracerProvider=new fq},t}(),Qa=lGe.getInstance();const wO={context:vu,diag:Pt,metrics:nGe,propagation:k0,trace:Qa};var pce=AN("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function gce(t){return t.setValue(pce,!0)}function FN(t){return t.getValue(pce)===!0}var uGe="=",z5=";",Ak=",",EO="baggage",dGe=180,fGe=4096,hGe=8192,pGe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function mce(t){return t.reduce(function(e,n){var r=""+e+(e!==""?Ak:"")+n;return r.length>hGe?e:r},"")}function vce(t){return t.getAllEntries().map(function(e){var n=pGe(e,2),r=n[0],i=n[1],s=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(s+=z5+i.metadata.toString()),s})}function BN(t){var e=t.split(z5);if(!(e.length<=0)){var n=e.shift();if(n){var r=n.indexOf(uGe);if(!(r<=0)){var i=decodeURIComponent(n.substring(0,r).trim()),s=decodeURIComponent(n.substring(r+1).trim()),o;return e.length>0&&(o=gqe(e.join(z5))),{key:i,value:s,metadata:o}}}}}function gGe(t){return typeof t!="string"||t.length===0?{}:t.split(Ak).map(function(e){return BN(e)}).filter(function(e){return e!==void 0&&e.value.length>0}).reduce(function(e,n){return e[n.key]=n.value,e},{})}var mGe=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=k0.getBaggage(e);if(!(!i||FN(e))){var s=vce(i).filter(function(a){return a.length<=fGe}).slice(0,dGe),o=mce(s);o.length>0&&r.set(n,EO,o)}},t.prototype.extract=function(e,n,r){var i=r.get(n,EO),s=Array.isArray(i)?i.join(Ak):i;if(!s)return e;var o={};if(s.length===0)return e;var a=s.split(Ak);return a.forEach(function(c){var l=BN(c);if(l){var u={value:l.value};l.metadata&&(u.metadata=l.metadata),o[l.key]=u}}),Object.entries(o).length===0?e:k0.setBaggage(e,k0.createBaggage(o))},t.prototype.fields=function(){return[EO]},t}(),yce=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vGe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function UT(t){var e,n,r={};if(typeof t!="object"||t==null)return r;try{for(var i=yce(Object.entries(t)),s=i.next();!s.done;s=i.next()){var o=vGe(s.value,2),a=o[0],c=o[1];if(!yGe(a)){Pt.warn("Invalid attribute key: "+a);continue}if(!_ce(c)){Pt.warn("Invalid attribute value set for key: "+a);continue}Array.isArray(c)?r[a]=c.slice():r[a]=c}}catch(l){e={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function yGe(t){return typeof t=="string"&&t.length>0}function _ce(t){return t==null?!0:Array.isArray(t)?_Ge(t):bce(t)}function _Ge(t){var e,n,r;try{for(var i=yce(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(o!=null){if(!r){if(bce(o)){r=typeof o;continue}return!1}if(typeof o!==r)return!1}}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0}function bce(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}function bGe(){return function(t){Pt.error(SGe(t))}}function SGe(t){return typeof t=="string"?t:JSON.stringify(wGe(t))}function wGe(t){for(var e={},n=t;n!==null;)Object.getOwnPropertyNames(n).forEach(function(r){if(!e[r]){var i=n[r];i&&(e[r]=String(i))}}),n=Object.getPrototypeOf(n);return e}var EGe=bGe();function Kh(t){try{EGe(t)}catch{}}var qc;(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(qc||(qc={}));var TGe=",",CGe=["OTEL_SDK_DISABLED"];function kGe(t){return CGe.indexOf(t)>-1}var RGe=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function IGe(t){return RGe.indexOf(t)>-1}var xGe=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function PGe(t){return xGe.indexOf(t)>-1}var $T=1/0,FT=128,OGe=128,MGe=128,Sce={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:yr.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:$T,OTEL_ATTRIBUTE_COUNT_LIMIT:FT,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:$T,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:FT,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:$T,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:FT,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:OGe,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:MGe,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:qc.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function AGe(t,e,n){if(!(typeof n[t]>"u")){var r=String(n[t]);e[t]=r.toLowerCase()==="true"}}function LGe(t,e,n,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof n[t]<"u"){var s=Number(n[t]);isNaN(s)||(s<r?e[t]=r:s>i?e[t]=i:e[t]=s)}}function DGe(t,e,n,r){r===void 0&&(r=TGe);var i=n[t];typeof i=="string"&&(e[t]=i.split(r).map(function(s){return s.trim()}))}var NGe={ALL:yr.ALL,VERBOSE:yr.VERBOSE,DEBUG:yr.DEBUG,INFO:yr.INFO,WARN:yr.WARN,ERROR:yr.ERROR,NONE:yr.NONE};function UGe(t,e,n){var r=n[t];if(typeof r=="string"){var i=NGe[r.toUpperCase()];i!=null&&(e[t]=i)}}function wce(t){var e={};for(var n in Sce){var r=n;switch(r){case"OTEL_LOG_LEVEL":UGe(r,e,t);break;default:if(kGe(r))AGe(r,e,t);else if(IGe(r))LGe(r,e,t);else if(PGe(r))DGe(r,e,t);else{var i=t[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}var Ece=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{};function Uu(){var t=wce(Ece);return Object.assign({},Sce,t)}function $Ge(){return wce(Ece)}function hq(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function jN(t){for(var e=new Uint8Array(t.length/2),n=0,r=0;r<t.length;r+=2){var i=hq(t.charCodeAt(r)),s=hq(t.charCodeAt(r+1));e[n++]=i<<4|s}return e}var $m=performance,FGe="1.26.0";function BGe(t){for(var e={},n=t.length,r=0;r<n;r++){var i=t[r];i&&(e[String(i).toUpperCase().replace(/[-.]/g,"_")]=i)}return e}var jGe="exception.type",HGe="exception.message",KGe="exception.stacktrace",TO=jGe,CO=HGe,VGe=KGe,qGe="cloud.provider",GGe="cloud.account.id",zGe="cloud.region",WGe="cloud.availability_zone",YGe="cloud.platform",JGe="aws.ecs.container.arn",XGe="aws.ecs.cluster.arn",ZGe="aws.ecs.launchtype",QGe="aws.ecs.task.arn",eze="aws.ecs.task.family",tze="aws.ecs.task.revision",nze="aws.eks.cluster.arn",rze="aws.log.group.names",ize="aws.log.group.arns",sze="aws.log.stream.names",oze="aws.log.stream.arns",aze="container.name",cze="container.id",lze="container.runtime",uze="container.image.name",dze="container.image.tag",fze="deployment.environment",hze="device.id",pze="device.model.identifier",gze="device.model.name",mze="faas.name",vze="faas.id",yze="faas.version",_ze="faas.instance",bze="faas.max_memory",Sze="host.id",wze="host.name",Eze="host.type",Tze="host.arch",Cze="host.image.name",kze="host.image.id",Rze="host.image.version",Ize="k8s.cluster.name",xze="k8s.node.name",Pze="k8s.node.uid",Oze="k8s.namespace.name",Mze="k8s.pod.uid",Aze="k8s.pod.name",Lze="k8s.container.name",Dze="k8s.replicaset.uid",Nze="k8s.replicaset.name",Uze="k8s.deployment.uid",$ze="k8s.deployment.name",Fze="k8s.statefulset.uid",Bze="k8s.statefulset.name",jze="k8s.daemonset.uid",Hze="k8s.daemonset.name",Kze="k8s.job.uid",Vze="k8s.job.name",qze="k8s.cronjob.uid",Gze="k8s.cronjob.name",zze="os.type",Wze="os.description",Yze="os.name",Jze="os.version",Xze="process.pid",Zze="process.executable.name",Qze="process.executable.path",eWe="process.command",tWe="process.command_line",nWe="process.command_args",rWe="process.owner",Tce="process.runtime.name",iWe="process.runtime.version",sWe="process.runtime.description",Cce="service.name",oWe="service.namespace",aWe="service.instance.id",cWe="service.version",kce="telemetry.sdk.name",Rce="telemetry.sdk.language",Ice="telemetry.sdk.version",lWe="telemetry.auto.version",uWe="webengine.name",dWe="webengine.version",fWe="webengine.description",hWe=Tce,pWe=Cce,W5=kce,Y5=Rce,J5=Ice,gWe=BGe([qGe,GGe,zGe,WGe,YGe,JGe,XGe,ZGe,QGe,eze,tze,nze,rze,ize,sze,oze,aze,cze,lze,uze,dze,fze,hze,pze,gze,mze,vze,yze,_ze,bze,Sze,wze,Eze,Tze,Cze,kze,Rze,Ize,xze,Pze,Oze,Mze,Aze,Lze,Dze,Nze,Uze,$ze,Fze,Bze,jze,Hze,Kze,Vze,qze,Gze,zze,Wze,Yze,Jze,Xze,Zze,Qze,eWe,tWe,nWe,rWe,Tce,iWe,sWe,Cce,oWe,aWe,cWe,kce,Rce,Ice,lWe,uWe,dWe,fWe]),mWe="webjs",vWe=mWe,bg,kO=(bg={},bg[W5]="opentelemetry",bg[hWe]="browser",bg[Y5]=vWe,bg[J5]=FGe,bg);var yWe=9,_We=6,bWe=Math.pow(10,_We),Lk=Math.pow(10,yWe);function sm(t){var e=t/1e3,n=Math.trunc(e),r=Math.round(t%1e3*bWe);return[n,r]}function xce(){var t=$m.timeOrigin;if(typeof t!="number"){var e=$m;t=e.timing&&e.timing.fetchStart}return t}function SWe(t){var e=sm(xce()),n=sm(typeof t=="number"?t:$m.now());return Oce(e,n)}function wWe(t,e){var n=e[0]-t[0],r=e[1]-t[1];return r<0&&(n-=1,r+=Lk),[n,r]}function EWe(t){return t[0]*Lk+t[1]}function pq(t){return t[0]*1e3+t[1]/1e6}function RO(t){return t[0]*1e6+t[1]/1e3}function Pce(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function gq(t){return Pce(t)||typeof t=="number"||t instanceof Date}function Oce(t,e){var n=[t[0]+e[0],t[1]+e[1]];return n[1]>=Lk&&(n[1]-=Lk,n[0]+=1),n}var Dd;(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Dd||(Dd={}));var TWe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},CWe=function(){function t(e){e===void 0&&(e={});var n;this._propagators=(n=e.propagators)!==null&&n!==void 0?n:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return t.prototype.inject=function(e,n,r){var i,s;try{for(var o=TWe(this._propagators),a=o.next();!a.done;a=o.next()){var c=a.value;try{c.inject(e,n,r)}catch(l){Pt.warn("Failed to inject with "+c.constructor.name+". Err: "+l.message)}}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}},t.prototype.extract=function(e,n,r){return this._propagators.reduce(function(i,s){try{return s.extract(i,n,r)}catch(o){Pt.warn("Failed to inject with "+s.constructor.name+". Err: "+o.message)}return i},e)},t.prototype.fields=function(){return this._fields.slice()},t}(),X5="[_0-9a-z-*/]",kWe="[a-z]"+X5+"{0,255}",RWe="[a-z0-9]"+X5+"{0,240}@[a-z]"+X5+"{0,13}",IWe=new RegExp("^(?:"+kWe+"|"+RWe+")$"),xWe=/^[ -~]{0,255}[!-~]$/,PWe=/,|=/;function OWe(t){return IWe.test(t)}function MWe(t){return xWe.test(t)&&!PWe.test(t)}var mq=32,AWe=512,vq=",",yq="=",LWe=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,n){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,n),r},t.prototype.unset=function(e){var n=this._clone();return n._internalState.delete(e),n},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(n,r){return n.push(r+yq+e.get(r)),n},[]).join(vq)},t.prototype._parse=function(e){e.length>AWe||(this._internalState=e.split(vq).reverse().reduce(function(n,r){var i=r.trim(),s=i.indexOf(yq);if(s!==-1){var o=i.slice(0,s),a=i.slice(s+1,r.length);OWe(o)&&MWe(a)&&n.set(o,a)}return n},new Map),this._internalState.size>mq&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,mq))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}(),IO="traceparent",xO="tracestate",DWe="00",NWe="(?!ff)[\\da-f]{2}",UWe="(?![0]{32})[\\da-f]{32}",$We="(?![0]{16})[\\da-f]{16}",FWe="[\\da-f]{2}",BWe=new RegExp("^\\s?("+NWe+")-("+UWe+")-("+$We+")-("+FWe+")(-.*)?\\s?$");function jWe(t){var e=BWe.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var HWe=function(){function t(){}return t.prototype.inject=function(e,n,r){var i=Qa.getSpanContext(e);if(!(!i||FN(e)||!aI(i))){var s=DWe+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||fl.NONE).toString(16);r.set(n,IO,s),i.traceState&&r.set(n,xO,i.traceState.serialize())}},t.prototype.extract=function(e,n,r){var i=r.get(n,IO);if(!i)return e;var s=Array.isArray(i)?i[0]:i;if(typeof s!="string")return e;var o=jWe(s);if(!o)return e;o.isRemote=!0;var a=r.get(n,xO);if(a){var c=Array.isArray(a)?a.join(","):a;o.traceState=new LWe(typeof c=="string"?c:void 0)}return Qa.setSpanContext(e,o)},t.prototype.fields=function(){return[IO,xO]},t}(),KWe="[object Object]",VWe="[object Null]",qWe="[object Undefined]",GWe=Function.prototype,Mce=GWe.toString,zWe=Mce.call(Object),WWe=YWe(Object.getPrototypeOf,Object),Ace=Object.prototype,Lce=Ace.hasOwnProperty,gh=Symbol?Symbol.toStringTag:void 0,Dce=Ace.toString;function YWe(t,e){return function(n){return t(e(n))}}function _q(t){if(!JWe(t)||XWe(t)!==KWe)return!1;var e=WWe(t);if(e===null)return!0;var n=Lce.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Mce.call(n)===zWe}function JWe(t){return t!=null&&typeof t=="object"}function XWe(t){return t==null?t===void 0?qWe:VWe:gh&&gh in Object(t)?ZWe(t):QWe(t)}function ZWe(t){var e=Lce.call(t,gh),n=t[gh],r=!1;try{t[gh]=void 0,r=!0}catch{}var i=Dce.call(t);return r&&(e?t[gh]=n:delete t[gh]),i}function QWe(t){return Dce.call(t)}var eYe=20;function tYe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t.shift(),r=new WeakMap;t.length>0;)n=Nce(n,t.shift(),0,r);return n}function PO(t){return Dk(t)?t.slice():t}function Nce(t,e,n,r){n===void 0&&(n=0);var i;if(!(n>eYe)){if(n++,BT(t)||BT(e)||Uce(e))i=PO(e);else if(Dk(t)){if(i=t.slice(),Dk(e))for(var s=0,o=e.length;s<o;s++)i.push(PO(e[s]));else if(c1(e))for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var c=a[s];i[c]=PO(e[c])}}else if(c1(t))if(c1(e)){if(!nYe(t,e))return e;i=Object.assign({},t);for(var a=Object.keys(e),s=0,o=a.length;s<o;s++){var c=a[s],l=e[c];if(BT(l))typeof l>"u"?delete i[c]:i[c]=l;else{var u=i[c],d=l;if(bq(t,c,r)||bq(e,c,r))delete i[c];else{if(c1(u)&&c1(d)){var f=r.get(u)||[],p=r.get(d)||[];f.push({obj:t,key:c}),p.push({obj:e,key:c}),r.set(u,f),r.set(d,p)}i[c]=Nce(i[c],l,n,r)}}}}else i=e;return i}}function bq(t,e,n){for(var r=n.get(t[e])||[],i=0,s=r.length;i<s;i++){var o=r[i];if(o.key===e&&o.obj===t)return!0}return!1}function Dk(t){return Array.isArray(t)}function Uce(t){return typeof t=="function"}function c1(t){return!BT(t)&&!Dk(t)&&!Uce(t)&&typeof t=="object"}function BT(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function nYe(t,e){return!(!_q(t)||!_q(e))}var rYe=function(){function t(){var e=this;this._promise=new Promise(function(n,r){e._resolve=n,e._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}(),iYe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},sYe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},HN=function(){function t(e,n){this._callback=e,this._that=n,this._isCalled=!1,this._deferred=new rYe}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,n=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,sYe([this._that],iYe(r),!1))).then(function(s){return n._deferred.resolve(s)},function(s){return n._deferred.reject(s)})}catch(s){this._deferred.reject(s)}}return this._deferred.promise},t}();function oYe(t,e){return new Promise(function(n){vu.with(gce(vu.active()),function(){t.export(e,function(r){n(r)})})})}var aYe={getKeyPairs:vce,serializeKeyPairs:mce,parseKeyPairsIntoRecord:gGe,parsePairKeyValue:BN},cYe={_export:oYe},lYe="exception",uYe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Sq=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},dYe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},fYe=function(){function t(e,n,r,i,s,o,a,c,l,u){a===void 0&&(a=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:G5.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=o,this.kind=s,this.links=a;var d=Date.now();this._performanceStartTime=$m.now(),this._performanceOffset=d-(this._performanceStartTime+xce()),this._startTimeProvided=c!=null,this.startTime=this._getTime(c??d),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,u!=null&&this.setAttributes(u),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,n)}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,n){return n==null||this._isSpanEnded()?this:e.length===0?(Pt.warn("Invalid attribute key: "+e),this):_ce(n)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(n),this):(Pt.warn("Invalid attribute value set for key: "+e),this)},t.prototype.setAttributes=function(e){var n,r;try{for(var i=uYe(Object.entries(e)),s=i.next();!s.done;s=i.next()){var o=Sq(s.value,2),a=o[0],c=o[1];this.setAttribute(a,c)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return this},t.prototype.addEvent=function(e,n,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return Pt.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(this._droppedEventsCount===0&&Pt.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),gq(n)&&(gq(r)||(r=n),n=void 0);var i=UT(n);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},t.prototype.addLink=function(e){return this.links.push(e),this},t.prototype.addLinks=function(e){var n;return(n=this.links).push.apply(n,dYe([],Sq(e),!1)),this},t.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=e,this)},t.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},t.prototype.end=function(e){if(this._isSpanEnded()){Pt.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=wWe(this.startTime,this.endTime),this._duration[0]<0&&(Pt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&Pt.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this)},t.prototype._getTime=function(e){if(typeof e=="number"&&e<$m.now())return SWe(e+this._performanceOffset);if(typeof e=="number")return sm(e);if(e instanceof Date)return sm(e.getTime());if(Pce(e))return e;if(this._startTimeProvided)return sm(Date.now());var n=$m.now()-this._performanceStartTime;return Oce(this.startTime,sm(n))},t.prototype.isRecording=function(){return this._ended===!1},t.prototype.recordException=function(e,n){var r={};typeof e=="string"?r[CO]=e:e&&(e.code?r[TO]=e.code.toString():e.name&&(r[TO]=e.name),e.message&&(r[CO]=e.message),e.stack&&(r[VGe]=e.stack)),r[TO]||r[CO]?this.addEvent(lYe,r,n):Pt.warn("Failed to record an exception "+e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&Pt.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},t.prototype._truncateToLimitUtil=function(e,n){return e.length<=n?e:e.substr(0,n)},t.prototype._truncateToSize=function(e){var n=this,r=this._attributeValueLengthLimit;return r<=0?(Pt.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?n._truncateToLimitUtil(i,r):i}):e},t}(),Tv;(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Tv||(Tv={}));var Nk=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Tv.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}(),Fm=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Tv.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}(),OO=function(){function t(e){var n,r,i,s;this._root=e.root,this._root||(Kh(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Fm),this._remoteParentSampled=(n=e.remoteParentSampled)!==null&&n!==void 0?n:new Fm,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new Nk,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new Fm,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new Nk}return t.prototype.shouldSample=function(e,n,r,i,s,o){var a=Qa.getSpanContext(e);return!a||!aI(a)?this._root.shouldSample(e,n,r,i,s,o):a.isRemote?a.traceFlags&fl.SAMPLED?this._remoteParentSampled.shouldSample(e,n,r,i,s,o):this._remoteParentNotSampled.shouldSample(e,n,r,i,s,o):a.traceFlags&fl.SAMPLED?this._localParentSampled.shouldSample(e,n,r,i,s,o):this._localParentNotSampled.shouldSample(e,n,r,i,s,o)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}(),wq=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,n){return{decision:dce(n)&&this._accumulate(n)<this._upperBound?Tv.RECORD_AND_SAMPLED:Tv.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var n=0,r=0;r<e.length/8;r++){var i=r*8,s=parseInt(e.slice(i,i+8),16);n=(n^s)>>>0}return n},t}(),hYe=Uu(),pYe=qc.AlwaysOn,Sg=1;function $ce(){var t=Uu();return{sampler:Fce(hYe),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:t.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:t.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:t.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:t.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:t.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:t.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function Fce(t){switch(t===void 0&&(t=Uu()),t.OTEL_TRACES_SAMPLER){case qc.AlwaysOn:return new Fm;case qc.AlwaysOff:return new Nk;case qc.ParentBasedAlwaysOn:return new OO({root:new Fm});case qc.ParentBasedAlwaysOff:return new OO({root:new Nk});case qc.TraceIdRatio:return new wq(Eq(t));case qc.ParentBasedTraceIdRatio:return new OO({root:new wq(Eq(t))});default:return Pt.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+pYe+'".'),new Fm}}function Eq(t){if(t.OTEL_TRACES_SAMPLER_ARG===void 0||t.OTEL_TRACES_SAMPLER_ARG==="")return Pt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+Sg+"."),Sg;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Pt.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+Sg+"."),Sg):e<0||e>1?(Pt.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+Sg+"."),Sg):e}function gYe(t){var e={sampler:Fce()},n=$ce(),r=Object.assign({},n,e,t);return r.generalLimits=Object.assign({},n.generalLimits,t.generalLimits||{}),r.spanLimits=Object.assign({},n.spanLimits,t.spanLimits||{}),r}function mYe(t){var e,n,r,i,s,o,a,c,l,u,d,f,p=Object.assign({},t.spanLimits),m=$Ge();return p.attributeCountLimit=(o=(s=(i=(n=(e=t.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&n!==void 0?n:(r=t.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:m.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&s!==void 0?s:m.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&o!==void 0?o:FT,p.attributeValueLengthLimit=(f=(d=(u=(c=(a=t.spanLimits)===null||a===void 0?void 0:a.attributeValueLengthLimit)!==null&&c!==void 0?c:(l=t.generalLimits)===null||l===void 0?void 0:l.attributeValueLengthLimit)!==null&&u!==void 0?u:m.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&d!==void 0?d:m.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:$T,Object.assign({},t,{spanLimits:p})}var vYe=function(){function t(e,n){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=Uu();this._maxExportBatchSize=typeof(n==null?void 0:n.maxExportBatchSize)=="number"?n.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(n==null?void 0:n.maxQueueSize)=="number"?n.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(n==null?void 0:n.scheduledDelayMillis)=="number"?n.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(n==null?void 0:n.exportTimeoutMillis)=="number"?n.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new HN(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Pt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return t.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&fl.SAMPLED&&this._addToBuffer(e)},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},t.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&Pt.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(Pt.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},t.prototype._flushAll=function(){var e=this;return new Promise(function(n,r){for(var i=[],s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),o=0,a=s;o<a;o++)i.push(e._flushOneBatch());Promise.all(i).then(function(){n()}).catch(r)})},t.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(n,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);vu.with(gce(vu.active()),function(){var s;e._finishedSpans.length<=e._maxExportBatchSize?(s=e._finishedSpans,e._finishedSpans=[]):s=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var o=function(){return e._exporter.export(s,function(d){var f;clearTimeout(i),d.code===Dd.SUCCESS?n():r((f=d.error)!==null&&f!==void 0?f:new Error("BatchSpanProcessor: span export failed"))})},a=null,c=0,l=s.length;c<l;c++){var u=s[c];u.resource.asyncAttributesPending&&u.resource.waitForAsyncAttributes&&(a??(a=[]),a.push(u.resource.waitForAsyncAttributes()))}a===null?o():Promise.all(a).then(o,function(d){Kh(d),r(d)})})})},t.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var n=function(){e._isExporting=!0,e._flushOneBatch().finally(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,Kh(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return n();this._timer===void 0&&(this._timer=setTimeout(function(){return n()},this._scheduledDelayMillis),this._timer,void 0)}},t.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},t}(),yYe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),_Ye=function(t){yYe(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.onInit(r),i}return e.prototype.onInit=function(n){var r=this;(n==null?void 0:n.disableAutoFlushOnDocumentHide)!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&r.forceFlush()},this._pageHideListener=function(){r.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},e.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},e}(vYe),bYe=8,SYe=16,wYe=function(){function t(){this.generateTraceId=Tq(SYe),this.generateSpanId=Tq(bYe)}return t}(),rE=Array(32);function Tq(t){return function(){for(var n=0;n<t*2;n++)rE[n]=Math.floor(Math.random()*16)+48,rE[n]>=58&&(rE[n]+=39);return String.fromCharCode.apply(null,rE.slice(0,t*2))}}var EYe=function(){function t(e,n,r){this._tracerProvider=r;var i=gYe(n);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=n.idGenerator||new wYe,this.resource=r.resource,this.instrumentationLibrary=e}return t.prototype.startSpan=function(e,n,r){var i,s,o;n===void 0&&(n={}),r===void 0&&(r=vu.active()),n.root&&(r=Qa.deleteSpan(r));var a=Qa.getSpan(r);if(FN(r)){Pt.debug("Instrumentation suppressed, returning Noop Span");var c=Qa.wrapSpanContext(lce);return c}var l=a==null?void 0:a.spanContext(),u=this._idGenerator.generateSpanId(),d,f,p;!l||!Qa.isSpanContextValid(l)?d=this._idGenerator.generateTraceId():(d=l.traceId,f=l.traceState,p=l.spanId);var m=(i=n.kind)!==null&&i!==void 0?i:q5.INTERNAL,v=((s=n.links)!==null&&s!==void 0?s:[]).map(function(R){return{context:R.context,attributes:UT(R.attributes)}}),S=UT(n.attributes),_=this._sampler.shouldSample(r,d,e,m,S,v);f=(o=_.traceState)!==null&&o!==void 0?o:f;var w=_.decision===Mk.RECORD_AND_SAMPLED?fl.SAMPLED:fl.NONE,T={traceId:d,spanId:u,traceFlags:w,traceState:f};if(_.decision===Mk.NOT_RECORD){Pt.debug("Recording is off, propagating context in a non-recording span");var c=Qa.wrapSpanContext(T);return c}var C=UT(Object.assign(S,_.attributes)),I=new fYe(this,r,e,T,m,p,v,n.startTime,void 0,C);return I},t.prototype.startActiveSpan=function(e,n,r,i){var s,o,a;if(!(arguments.length<2)){arguments.length===2?a=n:arguments.length===3?(s=n,a=r):(s=n,o=r,a=i);var c=o??vu.active(),l=this.startSpan(e,s,c),u=Qa.setSpan(c,l);return vu.with(u,a,void 0,l)}},t.prototype.getGeneralLimits=function(){return this._generalLimits},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}();function TYe(){return"unknown_service"}var _d=function(){return _d=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},_d.apply(this,arguments)},CYe=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},kYe=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},RYe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Z5=function(){function t(e,n){var r=this,i;this._attributes=e,this.asyncAttributesPending=n!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=n==null?void 0:n.then(function(s){return r._attributes=Object.assign({},r._attributes,s),r.asyncAttributesPending=!1,s},function(s){return Pt.debug("a resource's async attributes promise rejected: %s",s),r.asyncAttributesPending=!1,{}})}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[pWe]=TYe(),e[Y5]=kO[Y5],e[W5]=kO[W5],e[J5]=kO[J5],e))},Object.defineProperty(t.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&Pt.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),t.prototype.waitForAsyncAttributes=function(){return CYe(this,void 0,void 0,function(){return kYe(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.merge=function(e){var n=this,r;if(!e)return this;var i=_d(_d({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new t(i);var s=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(o){var a,c=RYe(o,2),l=c[0],u=c[1];return _d(_d(_d(_d({},n._syncAttributes),l),(a=e._syncAttributes)!==null&&a!==void 0?a:e.attributes),u)});return new t(i,s)},t.EMPTY=new t({}),t}(),iE=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},IYe=function(){function t(e){this._spanProcessors=e}return t.prototype.forceFlush=function(){var e,n,r=[];try{for(var i=iE(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.forceFlush())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(a){Promise.all(r).then(function(){a()}).catch(function(c){Kh(c||new Error("MultiSpanProcessor: forceFlush failed")),a()})})},t.prototype.onStart=function(e,n){var r,i;try{for(var s=iE(this._spanProcessors),o=s.next();!o.done;o=s.next()){var a=o.value;a.onStart(e,n)}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},t.prototype.onEnd=function(e){var n,r;try{for(var i=iE(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;o.onEnd(e)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.shutdown=function(){var e,n,r=[];try{for(var i=iE(this._spanProcessors),s=i.next();!s.done;s=i.next()){var o=s.value;r.push(o.shutdown())}}catch(a){e={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return new Promise(function(a,c){Promise.all(r).then(function(){a()},c)})},t}(),xYe=function(){function t(){}return t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}(),mh;(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(mh||(mh={}));var PYe=function(){function t(e){e===void 0&&(e={});var n;this._registeredSpanProcessors=[],this._tracers=new Map;var r=tYe({},$ce(),mYe(e));this.resource=(n=r.resource)!==null&&n!==void 0?n:Z5.empty(),this.resource=Z5.default().merge(this.resource),this._config=Object.assign({},r,{resource:this.resource});var i=this._buildExporterFromEnv();if(i!==void 0){var s=new _Ye(i);this.activeSpanProcessor=s}else this.activeSpanProcessor=new xYe}return t.prototype.getTracer=function(e,n,r){var i=e+"@"+(n||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new EYe({name:e,version:n,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},t.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(n){return Pt.error("Error while trying to shutdown current span processor",n)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new IYe(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(e){e===void 0&&(e={}),Qa.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&vu.setGlobalContextManager(e.contextManager),e.propagator&&k0.setGlobalPropagator(e.propagator)},t.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,n=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var s,o=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),s=mh.timeout},e);r.forceFlush().then(function(){clearTimeout(o),s!==mh.timeout&&(s=mh.resolved,i(s))}).catch(function(a){clearTimeout(o),s=mh.error,i(a)})})});return new Promise(function(r,i){Promise.all(n).then(function(s){var o=s.filter(function(a){return a!==mh.resolved});o.length>0?i(o):r()}).catch(function(s){return i([s])})})},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var n;return(n=this.constructor._registeredPropagators.get(e))===null||n===void 0?void 0:n()},t.prototype._getSpanExporter=function(e){var n;return(n=this.constructor._registeredExporters.get(e))===null||n===void 0?void 0:n()},t.prototype._buildPropagatorFromEnv=function(){var e=this,n=Array.from(new Set(Uu().OTEL_PROPAGATORS)),r=n.map(function(s){var o=e._getPropagator(s);return o||Pt.warn('Propagator "'+s+'" requested through environment variable is unavailable.'),o}),i=r.reduce(function(s,o){return o&&s.push(o),s},[]);if(i.length!==0)return n.length===1?i[0]:new CWe({propagators:i})},t.prototype._buildExporterFromEnv=function(){var e=Uu().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var n=this._getSpanExporter(e);return n||Pt.error('Exporter "'+e+'" requested through environment variable is unavailable.'),n}},t._registeredPropagators=new Map([["tracecontext",function(){return new HWe}],["baggage",function(){return new mGe}]]),t._registeredExporters=new Map,t}(),OYe=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},MYe=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},AYe=function(){function t(e){this._exporter=e,this._shutdownOnce=new HN(this._shutdown,this),this._unresolvedExports=new Set}return t.prototype.forceFlush=function(){return OYe(this,void 0,void 0,function(){return MYe(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return e.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.onStart=function(e,n){},t.prototype.onEnd=function(e){var n=this,r,i;if(!this._shutdownOnce.isCalled&&e.spanContext().traceFlags&fl.SAMPLED){var s=function(){return cYe._export(n._exporter,[e]).then(function(a){var c;a.code!==Dd.SUCCESS&&Kh((c=a.error)!==null&&c!==void 0?c:new Error("SimpleSpanProcessor: span export failed (status "+a+")"))}).catch(function(a){Kh(a)})};if(e.resource.asyncAttributesPending){var o=(i=(r=e.resource).waitForAsyncAttributes)===null||i===void 0?void 0:i.call(r).then(function(){return o!=null&&n._unresolvedExports.delete(o),s()},function(a){return Kh(a)});o!=null&&this._unresolvedExports.add(o)}else s()}},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){return this._exporter.shutdown()},t}(),LYe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},Bce=1e4;function DYe(t){t===void 0&&(t={});var e={};return Object.entries(t).forEach(function(n){var r=LYe(n,2),i=r[0],s=r[1];typeof s<"u"?e[i]=String(s):Pt.warn('Header "'+i+'" has invalid value ('+s+") and will be ignored")}),e}function NYe(t){return typeof t=="number"?t<=0?jce(t,Bce):t:UYe()}function UYe(){var t,e=Number((t=Uu().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)!==null&&t!==void 0?t:Uu().OTEL_EXPORTER_OTLP_TIMEOUT);return e<=0?jce(e,Bce):e}function jce(t,e){return Pt.warn("Timeout must be greater than 0",t),e}function $Ye(t){var e=[429,502,503,504];return e.includes(t)}function FYe(t){if(t==null)return-1;var e=Number.parseInt(t,10);if(Number.isInteger(e))return e>0?e*1e3:-1;var n=new Date(t).getTime()-Date.now();return n>=0?n:0}var BYe=function(){function t(e){e===void 0&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),typeof e.hostname=="string"&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new HN(this._shutdown,this),this._concurrencyLimit=typeof e.concurrencyLimit=="number"?e.concurrencyLimit:30,this.timeoutMillis=NYe(e.timeoutMillis),this.onInit(e)}return t.prototype.export=function(e,n){if(this._shutdownOnce.isCalled){n({code:Dd.FAILED,error:new Error("Exporter has been shutdown")});return}if(this._sendingPromises.length>=this._concurrencyLimit){n({code:Dd.FAILED,error:new Error("Concurrent export limit reached")});return}this._export(e).then(function(){n({code:Dd.SUCCESS})}).catch(function(r){n({code:Dd.FAILED,error:r})})},t.prototype._export=function(e){var n=this;return new Promise(function(r,i){try{Pt.debug("items to be sent",e),n.send(e,r,i)}catch(s){i(s)}})},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype.forceFlush=function(){return Promise.all(this._sendingPromises).then(function(){})},t.prototype._shutdown=function(){return Pt.debug("shutdown started"),this.onShutdown(),this.forceFlush()},t}(),jYe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Cq=function(t){jYe(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.name="OTLPExporterError",s.data=i,s.code=r,s}return e}(Error),HYe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},KYe=function(){function t(e){this._parameters=e}return t.prototype.send=function(e,n){var r=this;return new Promise(function(i){var s=new XMLHttpRequest;s.timeout=n,s.open("POST",r._parameters.url),Object.entries(r._parameters.headers).forEach(function(o){var a=HYe(o,2),c=a[0],l=a[1];s.setRequestHeader(c,l)}),s.ontimeout=function(o){i({status:"failure",error:new Error("XHR request timed out")})},s.onreadystatechange=function(){s.status>=200&&s.status<=299?(Pt.debug("XHR success"),i({status:"success"})):s.status&&$Ye(s.status)?i({status:"retryable",retryInMillis:FYe(s.getResponseHeader("Retry-After"))}):s.status!==0&&i({status:"failure",error:new Error("XHR request failed with non-retryable status")})},s.onabort=function(){i({status:"failure",error:new Error("XHR request aborted")})},s.onerror=function(){i({status:"failure",error:new Error("XHR request errored")})},s.send(new Blob([e],{type:r._parameters.headers["Content-Type"]}))})},t.prototype.shutdown=function(){},t}();function VYe(t){return new KYe(t)}var qYe=function(){function t(e){this._params=e}return t.prototype.send=function(e){var n=this;return new Promise(function(r){navigator.sendBeacon(n._params.url,new Blob([e],{type:n._params.blobType}))?(Pt.debug("SendBeacon success"),r({status:"success"})):r({status:"failure",error:new Error("SendBeacon failed")})})},t.prototype.shutdown=function(){},t}();function GYe(t){return new qYe(t)}var zYe=function(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})},WYe=function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},YYe=5,JYe=1e3,XYe=5e3,ZYe=1.5,kq=.2;function QYe(){return Math.random()*(2*kq)-kq}var eJe=function(){function t(e){this._transport=e}return t.prototype.retry=function(e,n,r){var i=this;return new Promise(function(s,o){setTimeout(function(){i._transport.send(e,n).then(s,o)},r)})},t.prototype.send=function(e,n){var r;return zYe(this,void 0,void 0,function(){var i,s,o,a,c,l,u;return WYe(this,function(d){switch(d.label){case 0:return i=Date.now()+n,[4,this._transport.send(e,n)];case 1:s=d.sent(),o=YYe,a=JYe,d.label=2;case 2:return s.status==="retryable"&&o>0?(o--,c=Math.max(Math.min(a,XYe)+QYe(),0),a=a*ZYe,l=(r=s.retryInMillis)!==null&&r!==void 0?r:c,u=i-Date.now(),l>u?[2,s]:[4,this.retry(e,u,l)]):[3,4];case 3:return s=d.sent(),[3,2];case 4:return[2,s]}})})},t.prototype.shutdown=function(){return this._transport.shutdown()},t}();function tJe(t){return new eJe(t.transport)}var nJe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),rJe=function(t){nJe(e,t);function e(n,r,i){n===void 0&&(n={});var s=t.call(this,n)||this;s._serializer=r;var o=!!n.headers||typeof navigator.sendBeacon!="function";return o?s._transport=tJe({transport:VYe({headers:Object.assign({},DYe(n.headers),aYe.parseKeyPairsIntoRecord(Uu().OTEL_EXPORTER_OTLP_HEADERS),{"Content-Type":i}),url:s.url})}):s._transport=GYe({url:s.url,blobType:i}),s}return e.prototype.onInit=function(){},e.prototype.onShutdown=function(){},e.prototype.send=function(n,r,i){var s=this;if(this._shutdownOnce.isCalled){Pt.debug("Shutdown already started. Cannot send objects");return}var o=this._serializer.serializeRequest(n);if(o==null){i(new Error("Could not serialize message"));return}var a=this._transport.send(o,this.timeoutMillis).then(function(l){l.status==="success"?r():l.status==="failure"&&l.error?i(l.error):l.status==="retryable"?i(new Cq("Export failed with retryable status")):i(new Cq("Export failed with unknown error"))},i);this._sendingPromises.push(a);var c=function(){var l=s._sendingPromises.indexOf(a);s._sendingPromises.splice(l,1)};a.then(c,c)},e}(BYe);function Hce(t){var e=BigInt(1e9);return BigInt(t[0])*e+BigInt(t[1])}function iJe(t){var e=Number(BigInt.asUintN(32,t)),n=Number(BigInt.asUintN(32,t>>BigInt(32)));return{low:e,high:n}}function Kce(t){var e=Hce(t);return iJe(e)}function sJe(t){var e=Hce(t);return e.toString()}var oJe=typeof BigInt<"u"?sJe:EWe;function Rq(t){return t}function Vce(t){if(t!==void 0)return jN(t)}var aJe={encodeHrTime:Kce,encodeSpanContext:jN,encodeOptionalSpanContext:Vce};function cJe(t){var e,n;if(t===void 0)return aJe;var r=(e=t.useLongBits)!==null&&e!==void 0?e:!0,i=(n=t.useHex)!==null&&n!==void 0?n:!1;return{encodeHrTime:r?Kce:oJe,encodeSpanContext:i?Rq:jN,encodeOptionalSpanContext:i?Rq:Vce}}var lJe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function uJe(t){return{name:t.name,version:t.version}}function cI(t){return Object.keys(t).map(function(e){return qce(e,t[e])})}function qce(t,e){return{key:t,value:Gce(e)}}function Gce(t){var e=typeof t;return e==="string"?{stringValue:t}:e==="number"?Number.isInteger(t)?{intValue:t}:{doubleValue:t}:e==="boolean"?{boolValue:t}:t instanceof Uint8Array?{bytesValue:t}:Array.isArray(t)?{arrayValue:{values:t.map(Gce)}}:e==="object"&&t!=null?{kvlistValue:{values:Object.entries(t).map(function(n){var r=lJe(n,2),i=r[0],s=r[1];return qce(i,s)})}}:{}}function dJe(t,e){var n,r=t.spanContext(),i=t.status;return{traceId:e.encodeSpanContext(r.traceId),spanId:e.encodeSpanContext(r.spanId),parentSpanId:e.encodeOptionalSpanContext(t.parentSpanId),traceState:(n=r.traceState)===null||n===void 0?void 0:n.serialize(),name:t.name,kind:t.kind==null?0:t.kind+1,startTimeUnixNano:e.encodeHrTime(t.startTime),endTimeUnixNano:e.encodeHrTime(t.endTime),attributes:cI(t.attributes),droppedAttributesCount:t.droppedAttributesCount,events:t.events.map(function(s){return hJe(s,e)}),droppedEventsCount:t.droppedEventsCount,status:{code:i.code,message:i.message},links:t.links.map(function(s){return fJe(s,e)}),droppedLinksCount:t.droppedLinksCount}}function fJe(t,e){var n;return{attributes:t.attributes?cI(t.attributes):[],spanId:e.encodeSpanContext(t.context.spanId),traceId:e.encodeSpanContext(t.context.traceId),traceState:(n=t.context.traceState)===null||n===void 0?void 0:n.serialize(),droppedAttributesCount:t.droppedAttributesCount||0}}function hJe(t,e){return{attributes:t.attributes?cI(t.attributes):[],name:t.name,timeUnixNano:e.encodeHrTime(t.time),droppedAttributesCount:t.droppedAttributesCount||0}}function pJe(t){return{attributes:cI(t.attributes),droppedAttributesCount:0}}var gJe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},mJe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s};function vJe(t,e){var n=cJe(e);return{resourceSpans:_Je(t,n)}}function yJe(t){var e,n,r=new Map;try{for(var i=gJe(t),s=i.next();!s.done;s=i.next()){var o=s.value,a=r.get(o.resource);a||(a=new Map,r.set(o.resource,a));var c=o.instrumentationLibrary.name+"@"+(o.instrumentationLibrary.version||"")+":"+(o.instrumentationLibrary.schemaUrl||""),l=a.get(c);l||(l=[],a.set(c,l)),l.push(o)}}catch(u){e={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function _Je(t,e){for(var n=yJe(t),r=[],i=n.entries(),s=i.next();!s.done;){for(var o=mJe(s.value,2),a=o[0],c=o[1],l=[],u=c.values(),d=u.next();!d.done;){var f=d.value;if(f.length>0){var p=f.map(function(v){return dJe(v,e)});l.push({scope:uJe(f[0].instrumentationLibrary),spans:p,schemaUrl:f[0].instrumentationLibrary.schemaUrl})}d=u.next()}var m={resource:pJe(a),scopeSpans:l,schemaUrl:void 0};r.push(m),s=i.next()}return r}var bJe={serializeRequest:function(t){var e=vJe(t,{useHex:!0,useLongBits:!1}),n=new TextEncoder;return n.encode(JSON.stringify(e))},deserializeResponse:function(t){var e=new TextDecoder;return JSON.parse(e.decode(t))}},SJe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),wJe="v1/traces",EJe="http://localhost:4318/"+wJe,TJe=function(t){SJe(e,t);function e(n){return n===void 0&&(n={}),t.call(this,n,bJe,"application/json")||this}return e.prototype.getDefaultUrl=function(n){return typeof n.url=="string"?n.url:EJe},e}(rJe),CJe=function(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},kJe=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},RJe=function(){function t(){this._enabled=!1,this._currentContext=Ug}return t.prototype._bindFunction=function(e,n){e===void 0&&(e=Ug);var r=this,i=function(){for(var s=this,o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];return r.with(e,function(){return n.apply(s,o)})};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:n.length}),i},t.prototype.active=function(){return this._currentContext},t.prototype.bind=function(e,n){return e===void 0&&(e=this.active()),typeof n=="function"?this._bindFunction(e,n):n},t.prototype.disable=function(){return this._currentContext=Ug,this._enabled=!1,this},t.prototype.enable=function(){return this._enabled?this:(this._enabled=!0,this._currentContext=Ug,this)},t.prototype.with=function(e,n,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];var o=this._currentContext;this._currentContext=e||Ug;try{return n.call.apply(n,kJe([r],CJe(i),!1))}finally{this._currentContext=o}},t}(),IJe=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},t(e,n)};return function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),xJe=function(t){IJe(e,t);function e(n){n===void 0&&(n={});var r=t.call(this,n)||this;if(n.contextManager)throw"contextManager should be defined in register method not in constructor";if(n.propagator)throw"propagator should be defined in register method not in constructor";return r}return e.prototype.register=function(n){n===void 0&&(n={}),n.contextManager===void 0&&(n.contextManager=new RJe),n.contextManager&&n.contextManager.enable(),t.prototype.register.call(this,n)},e}(PYe);function Iq(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ue(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Iq(Object(n),!0).forEach(function(r){he(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Iq(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function z_(t){return z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z_(t)}function Wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xq(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yt(t,e,n){return e&&xq(t.prototype,e),n&&xq(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function he(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function PJe(t,e){if(t==null)return{};var n,r,i=function(o,a){if(o==null)return{};var c,l,u={},d=Object.keys(o);for(l=0;l<d.length;l++)c=d[l],a.indexOf(c)>=0||(u[c]=o[c]);return u}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function us(t,e){return function(n){if(Array.isArray(n))return n}(t)||function(n,r){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,o,a=[],c=!0,l=!1;try{for(i=i.call(n);!(c=(s=i.next()).done)&&(a.push(s.value),!r||a.length!==r);c=!0);}catch(u){l=!0,o=u}finally{try{c||i.return==null||i.return()}finally{if(l)throw o}}return a}}(t,e)||KN(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function yu(t){return function(e){if(Array.isArray(e))return Q5(e)}(t)||function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}(t)||KN(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function KN(t,e){if(t){if(typeof t=="string")return Q5(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q5(t,e):void 0}}function Q5(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Pa(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=KN(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var sa={DEBUG:!1,LIB_VERSION:"1.160.3"},OJe=Array.isArray,zce=Object.prototype,Wce=zce.hasOwnProperty,lI=zce.toString,qr=OJe||function(t){return lI.call(t)==="[object Array]"},ma=function(t){return typeof t=="function"},Ri=function(t){return t===Object(t)&&!qr(t)},jT=function(t){if(Ri(t)){for(var e in t)if(Wce.call(t,e))return!1;return!0}return!1},Qe=function(t){return t===void 0},Xi=function(t){return lI.call(t)=="[object String]"},Pq=function(t){return Xi(t)&&t.trim().length===0},Vu=function(t){return t===null},no=function(t){return Qe(t)||Vu(t)},oa=function(t){return lI.call(t)=="[object Number]"},kh=function(t){return lI.call(t)==="[object Boolean]"},MJe=function(t){return t instanceof FormData},se=typeof window<"u"?window:void 0,zs=typeof globalThis<"u"?globalThis:se,Yce=Array.prototype,Oq=Yce.forEach,Mq=Yce.indexOf,sc=zs==null?void 0:zs.navigator,We=zs==null?void 0:zs.document,Ns=zs==null?void 0:zs.location,eL=zs==null?void 0:zs.fetch,tL=zs!=null&&zs.XMLHttpRequest&&"withCredentials"in new zs.XMLHttpRequest?zs.XMLHttpRequest:void 0,Aq=zs==null?void 0:zs.AbortController,Zr=sc==null?void 0:sc.userAgent,Wn=se??{},Lq="[PostHog.js]",we={_log:function(t){if(se&&(sa.DEBUG||Wn.POSTHOG_DEBUG)&&!Qe(se.console)&&se.console){for(var e=("__rrweb_original__"in se.console[t])?se.console[t].__rrweb_original__:se.console[t],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.apply(void 0,[Lq].concat(r))}},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];we._log.apply(we,["log"].concat(e))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];we._log.apply(we,["warn"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];we._log.apply(we,["error"].concat(e))},critical:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).error.apply(t,[Lq].concat(n))},uninitializedWarning:function(t){we.error("You must initialize PostHog before calling ".concat(t))}},Uk={},uI=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function Bm(t,e,n){if(qr(t)){if(Oq&&t.forEach===Oq)t.forEach(e,n);else if("length"in t&&t.length===+t.length){for(var r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===Uk)return}}}function Tn(t,e,n){if(!no(t)){if(qr(t))return Bm(t,e,n);if(MJe(t)){var r,i=Pa(t.entries());try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.call(n,s[1],s[0])===Uk)return}}catch(a){i.e(a)}finally{i.f()}}else for(var o in t)if(Wce.call(t,o)&&e.call(n,t[o],o)===Uk)return}}var ds=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Bm(n,function(i){for(var s in i)i[s]!==void 0&&(t[s]=i[s])}),t};function $t(t,e){return t.indexOf(e)!==-1}function HT(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r}var Jce=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},Dq=function(t){try{return t()}catch{return}},AJe=function(t){return function(){try{for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(this,n)}catch(i){we.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),we.critical(i)}}},nL=function(t){var e={};return Tn(t,function(n,r){Xi(n)&&n.length>0&&(e[r]=n)}),e},rL=function(t){return t.replace(/^\$/,"")};function LJe(t,e){return n=t,r=function(s){return Xi(s)&&!Vu(e)?s.slice(0,e):s},i=new Set,function s(o,a){return o!==Object(o)?r?r(o,a):o:i.has(o)?void 0:(i.add(o),qr(o)?(c=[],Bm(o,function(l){c.push(s(l))})):(c={},Tn(o,function(l,u){i.has(l)||(c[u]=s(l,u))})),c);var c}(n);var n,r,i}var rc,DJe=function(t){var e,n,r,i,s="";for(e=n=0,r=(t=(t+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<r;i++){var o=t.charCodeAt(i),a=null;o<128?n++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),Vu(a)||(n>e&&(s+=t.substring(e,n)),s+=a,e=n=i+1)}return n>e&&(s+=t.substring(e,t.length)),s},su=function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},function(e,n,r,i,s){if(e)if(e.addEventListener&&!i)e.addEventListener(n,r,!!s);else{var o="on"+n,a=e[o];e[o]=function(c,l,u){return function(d){if(d=d||t(se==null?void 0:se.event)){var f,p=!0;ma(u)&&(f=u(d));var m=l.call(c,d);return f!==!1&&m!==!1||(p=!1),p}}}(e,r,a)}else we.error("No valid element provided to register_event")}}();function Xce(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]}(function(t){t.GZipJS="gzip-js",t.Base64="base64"})(rc||(rc={}));var Zce="$people_distinct_id",j1="__alias",H1="__timers",Nq="$autocapture_disabled_server_side",iL="$heatmaps_enabled_server_side",Uq="$exception_capture_enabled_server_side",$q="$exception_capture_endpoint_suffix",Fq="$web_vitals_enabled_server_side",sL="$session_recording_enabled_server_side",Bq="$console_log_recording_enabled_server_side",jq="$session_recording_network_payload_capture",Hq="$session_recording_canvas_recording",Kq="$replay_sample_rate",Vq="$replay_minimum_duration",$k="$sesid",R0="$session_is_sampled",om="$enabled_feature_flags",oL="$early_access_features",am="$stored_person_properties",bd="$stored_group_properties",aL="$surveys",sE="$surveys_activated",Fk="$flag_call_reported",ql="$user_state",cL="$client_session_props",lL="$capture_rate_limit",uL="$initial_campaign_params",dL="$initial_referrer_info",qq="$initial_person_info",Bk="$epp",fL="__POSTHOG_TOOLBAR__",NJe=[Zce,j1,"__cmpns",H1,sL,iL,$k,om,ql,oL,bd,am,aL,Fk,cL,lL,uL,dL,Bk],MO="$active_feature_flags",oE="$override_feature_flags",Gq="$feature_flag_payloads",zq=function(t){var e,n={},r=Pa(HT(t||{}));try{for(r.s();!(e=r.n()).done;){var i=us(e.value,2),s=i[0],o=i[1];o&&(n[s]=o)}}catch(a){r.e(a)}finally{r.f()}return n},UJe=function(){function t(e){Wt(this,t),this.instance=e,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return Yt(t,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(om),n=this.instance.get_property(oE);if(!n)return e||{};for(var r=ds({},e),i=Object.keys(n),s=0;s<i.length;s++)r[i[s]]=n[i[s]];return this._override_warning||(we.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:n,finalFlags:r}),this._override_warning=!0),r}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(Gq)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout(function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())},5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var n=this.instance.config.token,r=this.instance.get_property(am),i=this.instance.get_property(bd),s={token:n,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:r,group_properties:i,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:s,compression:this.instance.config.disable_compression?void 0:rc.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(o){var a;e.setReloadingPaused(!1);var c=!0;o.statusCode===200&&(e.$anon_distinct_id=void 0,c=!1),e.receivedFeatureFlags((a=o.json)!==null&&a!==void 0?a:{},c),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var r,i=this.getFlagVariants()[e],s="".concat(i),o=this.instance.get_property(Fk)||{};return(n.send_event||!("send_event"in n))&&(!(e in o)||!o[e].includes(s))&&(qr(o[e])?o[e].push(s):o[e]=[s],(r=this.instance.persistence)===null||r===void 0||r.register(he({},Fk,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:i})),i}we.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,n);we.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(function(n){return n!==e})}},{key:"receivedFeatureFlags",value:function(e,n){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var r=this.getFlagVariants(),i=this.getFlagPayloads();(function(s,o){var a,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},u=s.featureFlags,d=s.featureFlagPayloads;if(u)if(qr(u)){var f,p={};if(u)for(var m=0;m<u.length;m++)p[u[m]]=!0;o&&o.register((he(f={},MO,u),he(f,om,p),f))}else{var v=u,S=d;s.errorsWhileComputingFlags&&(v=Ue(Ue({},c),v),S=Ue(Ue({},l),S)),o&&o.register((he(a={},MO,Object.keys(zq(v))),he(a,om,v||{}),he(a,Gq,S||{}),a))}})(e,this.instance.persistence,r,i),this._fireFeatureFlagsCallbacks(n)}}},{key:"override",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return we.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=n,e===!1)this.instance.persistence.unregister(oE);else if(qr(e)){for(var r={},i=0;i<e.length;i++)r[e[i]]=!0;this.instance.persistence.register(he({},oE,r))}else this.instance.persistence.register(he({},oE,e))}},{key:"onFeatureFlags",value:function(e){var n=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var r=this._prepareFeatureFlagsForCallbacks(),i=r.flags,s=r.flagVariants;e(i,s)}return function(){return n.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){var r,i,s=he({},"$feature_enrollment/".concat(e),n);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:n,$set:s}),this.setPersonPropertiesForFlags(s,!1);var o=Ue(Ue({},this.getFlagVariants()),{},he({},e,n));(r=this.instance.persistence)===null||r===void 0||r.register((he(i={},MO,Object.keys(zq(o))),he(i,om,o),i)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.instance.get_property(oL);if(i&&!r)return e(i);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(s){var o;if(s.json){var a=s.json.earlyAccessFeatures;return(o=n.instance.persistence)===null||o===void 0||o.register(he({},oL,a)),e(a)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),n=this.getFlagVariants();return{flags:e.filter(function(r){return n[r]}),flagVariants:Object.keys(n).filter(function(r){return n[r]}).reduce(function(r,i){return r[i]=n[i],r},{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;this.featureFlagEventHandlers.forEach(function(s){return s(r,i,{errorsLoading:e})})}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(am)||{};this.instance.register(he({},am,Ue(Ue({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(am)}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(bd)||{};Object.keys(r).length!==0&&Object.keys(r).forEach(function(i){r[i]=Ue(Ue({},r[i]),e[i]),delete e[i]}),this.instance.register(he({},bd,Ue(Ue({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var n=this.instance.get_property(bd)||{};this.instance.register(he({},bd,Ue(Ue({},n),{},he({},e,{}))))}else this.instance.unregister(bd)}}]),t}();Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Number.isInteger||(Number.isInteger=function(t){return oa(t)&&isFinite(t)&&Math.floor(t)===t});var Wq="0123456789abcdef",$Je=function(){function t(e){if(Wt(this,t),this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}return Yt(t,[{key:"toString",value:function(){for(var e="",n=0;n<this.bytes.length;n++)e=e+Wq.charAt(this.bytes[n]>>>4)+Wq.charAt(15&this.bytes[n]),n!==3&&n!==5&&n!==7&&n!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new t(this.bytes.slice(0))}},{key:"equals",value:function(e){return this.compareTo(e)===0}},{key:"compareTo",value:function(e){for(var n=0;n<16;n++){var r=this.bytes[n]-e.bytes[n];if(r!==0)return Math.sign(r)}return 0}}],[{key:"fromFieldsV7",value:function(e,n,r,i){if(!Number.isInteger(e)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||n<0||r<0||i<0||e>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/Math.pow(2,40),s[1]=e/Math.pow(2,32),s[2]=e/Math.pow(2,24),s[3]=e/Math.pow(2,16),s[4]=e/Math.pow(2,8),s[5]=e,s[6]=112|n>>>8,s[7]=n,s[8]=128|r>>>24,s[9]=r>>>16,s[10]=r>>>8,s[11]=r,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new t(s)}}]),t}(),FJe=function(){function t(){Wt(this,t),he(this,"timestamp",0),he(this,"counter",0),he(this,"random",new BJe)}return Yt(t,[{key:"generate",value:function(){var e=this.generateOrAbort();if(Qe(e)){this.timestamp=0;var n=this.generateOrAbort();if(Qe(n))throw new Error("Could not generate UUID after timestamp reset");return n}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return $Je.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),t}(),Qce=function(t){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<t.length;e++)t[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return t};se&&!Qe(se.crypto)&&crypto.getRandomValues&&(Qce=function(t){return crypto.getRandomValues(t)});var Yq,BJe=function(){function t(){Wt(this,t),he(this,"buffer",new Uint32Array(8)),he(this,"cursor",1/0)}return Yt(t,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(Qce(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),t}(),Nd=function(){return jJe().toString()},jJe=function(){return(Yq||(Yq=new FJe)).generate()},HJe="Thu, 01 Jan 1970 00:00:00 GMT",l1="",KJe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function VJe(t,e){if(e){var n=function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:We;if(l1)return l1;if(!s||["localhost","127.0.0.1"].includes(i))return"";for(var o=i.split("."),a=Math.min(o.length,8),c="dmn_chk_"+Nd(),l=new RegExp("(^|;)\\s*"+c+"=1");!l1&&a--;){var u=o.slice(a).join("."),d=c+"=1;domain=."+u;s.cookie=d,l.test(s.cookie)&&(s.cookie=d+";expires="+HJe,l1=u)}return l1}(t);if(!n){var r=function(i){var s=i.match(KJe);return s?s[0]:""}(t);r!==n&&we.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}return""}var pi,_u={is_supported:function(){return!!We},error:function(t){we.error("cookieStore error: "+t)},get:function(t){if(We){try{for(var e=t+"=",n=We.cookie.split(";").filter(function(s){return s.length}),r=0;r<n.length;r++){for(var i=n[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},parse:function(t){var e;try{e=JSON.parse(_u.get(t))||{}}catch{}return e},set:function(t,e,n,r,i){if(We)try{var s="",o="",a=VJe(We.location.hostname,r);if(n){var c=new Date;c.setTime(c.getTime()+24*n*60*60*1e3),s="; expires="+c.toUTCString()}i&&(o="; secure");var l=t+"="+encodeURIComponent(JSON.stringify(e))+s+"; SameSite=Lax; path=/"+a+o;return l.length>3686.4&&we.warn("cookieStore warning: large cookie, len="+l.length),We.cookie=l,l}catch{return}},remove:function(t,e){try{_u.set(t,"",-1,e)}catch{return}}},AO=null,Vr={is_supported:function(){if(!Vu(AO))return AO;var t=!0;if(Qe(se))t=!1;else try{var e="__mplssupport__";Vr.set(e,"xyz"),Vr.get(e)!=='"xyz"'&&(t=!1),Vr.remove(e)}catch{t=!1}return t||we.error("localStorage unsupported; falling back to cookie store"),AO=t,t},error:function(t){we.error("localStorage error: "+t)},get:function(t){try{return se==null?void 0:se.localStorage.getItem(t)}catch(e){Vr.error(e)}return null},parse:function(t){try{return JSON.parse(Vr.get(t))||{}}catch{}return null},set:function(t,e){try{se==null||se.localStorage.setItem(t,JSON.stringify(e))}catch(n){Vr.error(n)}},remove:function(t){try{se==null||se.localStorage.removeItem(t)}catch(e){Vr.error(e)}}},qJe=["distinct_id",$k,R0,Bk],aE=Ue(Ue({},Vr),{},{parse:function(t){try{var e={};try{e=_u.parse(t)||{}}catch{}var n=ds(e,JSON.parse(Vr.get(t)||"{}"));return Vr.set(t,n),n}catch{}return null},set:function(t,e,n,r,i,s){try{Vr.set(t,e,void 0,void 0,s);var o={};qJe.forEach(function(a){e[a]&&(o[a]=e[a])}),Object.keys(o).length&&_u.set(t,o,n,r,i,s)}catch(a){Vr.error(a)}},remove:function(t,e){try{se==null||se.localStorage.removeItem(t),_u.remove(t,e)}catch(n){Vr.error(n)}}}),cE={},GJe={is_supported:function(){return!0},error:function(t){we.error("memoryStorage error: "+t)},get:function(t){return cE[t]||null},parse:function(t){return cE[t]||null},set:function(t,e){cE[t]=e},remove:function(t){delete cE[t]}},Qf=null,Ei={is_supported:function(){if(!Vu(Qf))return Qf;if(Qf=!0,Qe(se))Qf=!1;else try{var t="__support__";Ei.set(t,"xyz"),Ei.get(t)!=='"xyz"'&&(Qf=!1),Ei.remove(t)}catch{Qf=!1}return Qf},error:function(t){we.error("sessionStorage error: ",t)},get:function(t){try{return se==null?void 0:se.sessionStorage.getItem(t)}catch(e){Ei.error(e)}return null},parse:function(t){try{return JSON.parse(Ei.get(t))||null}catch{}return null},set:function(t,e){try{se==null||se.sessionStorage.setItem(t,JSON.stringify(e))}catch(n){Ei.error(n)}},remove:function(t){try{se==null||se.sessionStorage.removeItem(t)}catch(e){Ei.error(e)}}},zJe=["localhost","127.0.0.1"],I0=function(t){var e=We==null?void 0:We.createElement("a");return Qe(e)?null:(e.href=t,e)},jk=function(t,e){return!!function(n){try{new RegExp(n)}catch{return!1}return!0}(e)&&new RegExp(e).test(t)},WJe=function(t){var e,n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",i=[];return Tn(t,function(s,o){Qe(s)||Qe(o)||o==="undefined"||(e=encodeURIComponent(function(a){return a instanceof File}(s)?s.name:s.toString()),n=encodeURIComponent(o),i[i.length]=n+"="+e)}),i.join(r)},Jq=function(t,e){for(var n,r=((t.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]===e){n=s;break}}if(!qr(n)||n.length<2)return"";var o=n[1];try{o=decodeURIComponent(o)}catch{we.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},Hk=function(t,e){var n=t.match(new RegExp(e+"=([^&]*)"));return n?n[1]:null},wa="Mobile",Kk="iOS",el="Android",W_="Tablet",ele=el+" "+W_,tle="iPad",nle="Apple",rle=nle+" Watch",Y_="Safari",Cv="BlackBerry",ile="Samsung",sle=ile+"Browser",ole=ile+" Internet",tf="Chrome",YJe=tf+" OS",ale=tf+" "+Kk,VN="Internet Explorer",cle=VN+" "+wa,qN="Opera",JJe=qN+" Mini",GN="Edge",lle="Microsoft "+GN,jm="Firefox",ule=jm+" "+Kk,J_="Nintendo",X_="PlayStation",Hm="Xbox",dle=el+" "+wa,fle=wa+" "+Y_,K1="Windows",hL=K1+" Phone",Xq="Nokia",pL="Ouya",hle="Generic",XJe=hle+" "+wa.toLowerCase(),ple=hle+" "+W_.toLowerCase(),gL="Konqueror",os="(\\d+(\\.\\d+)?)",LO=new RegExp("Version/"+os),ZJe=new RegExp(Hm,"i"),QJe=new RegExp(X_+" \\w+","i"),eXe=new RegExp(J_+" \\w+","i"),zN=new RegExp(Cv+"|PlayBook|BB10","i"),tXe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},nXe=function(t,e){return e&&$t(e,nle)||function(n){return $t(n,Y_)&&!$t(n,tf)&&!$t(n,el)}(t)},Zq=function(t,e){return e=e||"",$t(t," OPR/")&&$t(t,"Mini")?JJe:$t(t," OPR/")?qN:zN.test(t)?Cv:$t(t,"IE"+wa)||$t(t,"WPDesktop")?cle:$t(t,sle)?ole:$t(t,GN)||$t(t,"Edg/")?lle:$t(t,"FBIOS")?"Facebook "+wa:$t(t,"UCWEB")||$t(t,"UCBrowser")?"UC Browser":$t(t,"CriOS")?ale:$t(t,"CrMo")?tf:$t(t,el)&&$t(t,Y_)?dle:$t(t,tf)?tf:$t(t,"FxiOS")?ule:$t(t.toLowerCase(),gL.toLowerCase())?gL:nXe(t,e)?$t(t,wa)?fle:Y_:$t(t,jm)?jm:$t(t,"MSIE")||$t(t,"Trident/")?VN:$t(t,"Gecko")?jm:""},rXe=(he(pi={},cle,[new RegExp("rv:"+os)]),he(pi,lle,[new RegExp(GN+"?\\/"+os)]),he(pi,tf,[new RegExp("("+tf+"|CrMo)\\/"+os)]),he(pi,ale,[new RegExp("CriOS\\/"+os)]),he(pi,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+os)]),he(pi,Y_,[LO]),he(pi,fle,[LO]),he(pi,qN,[new RegExp("(Opera|OPR)\\/"+os)]),he(pi,jm,[new RegExp(jm+"\\/"+os)]),he(pi,ule,[new RegExp("FxiOS\\/"+os)]),he(pi,gL,[new RegExp("Konqueror[:/]?"+os,"i")]),he(pi,Cv,[new RegExp(Cv+" "+os),LO]),he(pi,dle,[new RegExp("android\\s"+os,"i")]),he(pi,ole,[new RegExp(sle+"\\/"+os)]),he(pi,VN,[new RegExp("(rv:|MSIE )"+os)]),he(pi,"Mozilla",[new RegExp("rv:"+os)]),pi),Qq=[[new RegExp(Hm+"; "+Hm+" (.*?)[);]","i"),function(t){return[Hm,t&&t[1]||""]}],[new RegExp(J_,"i"),[J_,""]],[new RegExp(X_,"i"),[X_,""]],[zN,[Cv,""]],[new RegExp(K1,"i"),function(t,e){if(/Phone/.test(e)||/WPDesktop/.test(e))return[hL,""];if(new RegExp(wa).test(e)&&!/IEMobile\b/.test(e))return[K1+" "+wa,""];var n=/Windows NT ([0-9.]+)/i.exec(e);if(n&&n[1]){var r=n[1],i=tXe[r]||"";return/arm/i.test(e)&&(i="RT"),[K1,i]}return[K1,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(t){if(t&&t[3]){var e=[t[3],t[4],t[5]||"0"];return[Kk,e.join(".")]}return[Kk,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(t){var e="";return t&&t.length>=3&&(e=Qe(t[2])?t[3]:t[2]),["watchOS",e]}],[new RegExp("("+el+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+el+")","i"),function(t){if(t&&t[2]){var e=[t[2],t[3],t[4]||"0"];return[el,e.join(".")]}return[el,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(t){var e=["Mac OS X",""];if(t&&t[1]){var n=[t[1],t[2],t[3]||"0"];e[1]=n.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[YJe,""]],[/Linux|debian/i,["Linux",""]]],eG=function(t){return eXe.test(t)?J_:QJe.test(t)?X_:ZJe.test(t)?Hm:new RegExp(pL,"i").test(t)?pL:new RegExp("("+hL+"|WPDesktop)","i").test(t)?hL:/iPad/.test(t)?tle:/iPod/.test(t)?"iPod Touch":/iPhone/.test(t)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(t)?rle:zN.test(t)?Cv:/(kobo)\s(ereader|touch)/i.test(t)?"Kobo":new RegExp(Xq,"i").test(t)?Xq:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(t)||/(kf[a-z]+)( bui|\)).+silk\//i.test(t)?"Kindle Fire":/(Android|ZTE)/i.test(t)?!new RegExp(wa).test(t)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(t)?/pixel[\daxl ]{1,6}/i.test(t)&&!/pixel c/i.test(t)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(t)||/lmy47v/i.test(t)&&!/QTAQZ3/i.test(t)?el:ele:el:new RegExp("(pda|"+wa+")","i").test(t)?XJe:new RegExp(W_,"i").test(t)&&!new RegExp(W_+" pc","i").test(t)?ple:""},lE="https?://(.*)",iXe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],ti={campaignParams:function(t){return We?this._campaignParamsFromUrl(We.URL,t):{}},_campaignParamsFromUrl:function(t,e){var n=iXe.concat(e||[]),r={};return Tn(n,function(i){var s=Jq(t,i);s&&(r[i]=s)}),r},_searchEngine:function(t){return t?t.search(lE+"google.([^/?]*)")===0?"google":t.search(lE+"bing.com")===0?"bing":t.search(lE+"yahoo.com")===0?"yahoo":t.search(lE+"duckduckgo.com")===0?"duckduckgo":null:null},_searchInfoFromReferrer:function(t){var e=ti._searchEngine(t),n=e!="yahoo"?"q":"p",r={};if(!Vu(e)){r.$search_engine=e;var i=We?Jq(We.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var t=We==null?void 0:We.referrer;return t?this._searchInfoFromReferrer(t):{}},browser:Zq,browserVersion:function(t,e){var n=Zq(t,e),r=rXe[n];if(Qe(r))return null;for(var i=0;i<r.length;i++){var s=r[i],o=t.match(s);if(o)return parseFloat(o[o.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(t){for(var e=0;e<Qq.length;e++){var n=us(Qq[e],2),r=n[0],i=n[1],s=r.exec(t),o=s&&(ma(i)?i(s,t):i);if(o)return o}return["",""]},device:eG,deviceType:function(t){var e=eG(t);return e===tle||e===ele||e==="Kobo"||e==="Kindle Fire"||e===ple?W_:e===J_||e===Hm||e===X_||e===pL?"Console":e===rle?"Wearable":e?wa:"Desktop"},referrer:function(){return(We==null?void 0:We.referrer)||"$direct"},referringDomain:function(){var t;return We!=null&&We.referrer&&((t=I0(We.referrer))===null||t===void 0?void 0:t.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:Ns==null?void 0:Ns.href}},initialPersonPropsFromInfo:function(t){var e,n=t.r,r=t.u,i={$initial_referrer:n,$initial_referring_domain:n==null?void 0:n=="$direct"?"$direct":(e=I0(n))===null||e===void 0?void 0:e.host};if(r){i.$initial_current_url=r;var s=I0(r);i.$initial_host=s==null?void 0:s.host,i.$initial_pathname=s==null?void 0:s.pathname,Tn(this._campaignParamsFromUrl(r),function(o,a){i["$initial_"+rL(a)]=o})}return n&&Tn(this._searchInfoFromReferrer(n),function(o,a){i["$initial_"+rL(a)]=o}),i},properties:function(){if(!Zr)return{};var t=us(ti.os(Zr),2),e=t[0],n=t[1];return ds(nL({$os:e,$os_version:n,$browser:ti.browser(Zr,navigator.vendor),$device:ti.device(Zr),$device_type:ti.deviceType(Zr)}),{$current_url:Ns==null?void 0:Ns.href,$host:Ns==null?void 0:Ns.host,$pathname:Ns==null?void 0:Ns.pathname,$raw_user_agent:Zr.length>1e3?Zr.substring(0,997)+"...":Zr,$browser_version:ti.browserVersion(Zr,navigator.vendor),$browser_language:ti.browserLanguage(),$screen_height:se==null?void 0:se.screen.height,$screen_width:se==null?void 0:se.screen.width,$viewport_height:se==null?void 0:se.innerHeight,$viewport_width:se==null?void 0:se.innerWidth,$lib:"web",$lib_version:sa.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Jce()/1e3})},people_properties:function(){if(!Zr)return{};var t=us(ti.os(Zr),2),e=t[0],n=t[1];return ds(nL({$os:e,$os_version:n,$browser:ti.browser(Zr,navigator.vendor)}),{$browser_version:ti.browserVersion(Zr,navigator.vendor)})}},sXe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],DO=function(){function t(e){Wt(this,t),this.config=e,this.props={},this.campaign_params_saved=!1,this.name=function(n){var r="";return n.token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"}(e),this.storage=this.buildStorage(e),this.load(),e.debug&&we.info("Persistence loaded",e.persistence,Ue({},this.props)),this.update_config(e,e),this.save()}return Yt(t,[{key:"buildStorage",value:function(e){sXe.indexOf(e.persistence.toLowerCase())===-1&&(we.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var n=e.persistence.toLowerCase();return n==="localstorage"&&Vr.is_supported()?Vr:n==="localstorage+cookie"&&aE.is_supported()?aE:n==="sessionstorage"&&Ei.is_supported()?Ei:n==="memory"?GJe:n==="cookie"?_u:aE.is_supported()?aE:_u}},{key:"properties",value:function(){var e={};return Tn(this.props,function(n,r){if(r===om&&Ri(n))for(var i=Object.keys(n),s=0;s<i.length;s++)e["$feature/".concat(i[s])]=n[i[s]];else a=r,c=!1,(Vu(o=NJe)?c:Mq&&o.indexOf===Mq?o.indexOf(a)!=-1:(Tn(o,function(l){if(c||(c=l===a))return Uk}),c))||(e[r]=n);var o,a,c}),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=ds({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,n,r){var i=this;if(Ri(e)){Qe(n)&&(n="None"),this.expire_days=Qe(r)?this.default_expiry:r;var s=!1;if(Tn(e,function(o,a){i.props.hasOwnProperty(a)&&i.props[a]!==n||(i.props[a]=o,s=!0)}),s)return this.save(),!0}return!1}},{key:"register",value:function(e,n){var r=this;if(Ri(e)){this.expire_days=Qe(n)?this.default_expiry:n;var i=!1;if(Tn(e,function(s,o){e.hasOwnProperty(o)&&r.props[o]!==s&&(r.props[o]=s,i=!0)}),i)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(ti.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(ti.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(ti.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[uL]||this.props[dL]||this.register_once(he({},qq,ti.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return nL({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,n={};Tn([dL,uL],function(s){var o=e.props[s];o&&Tn(o,function(a,c){n["$initial_"+rL(c)]=a})});var r=this.props[qq];if(r){var i=ti.initialPersonPropsFromInfo(r);ds(n,i)}return n}},{key:"safe_merge",value:function(e){return Tn(this.props,function(n,r){r in e||(e[r]=n)}),e}},{key:"update_config",value:function(e,n){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==n.persistence){var r=this.buildStorage(e),i=this.props;this.clear(),this.storage=r,this.props=i,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,n){var r=this.props[H1]||{};r[e]=n,this.props[H1]=r,this.save()}},{key:"remove_event_timer",value:function(e){var n=(this.props[H1]||{})[e];return Qe(n)||(delete this.props[H1][e],this.save()),n}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,n){this.props[e]=n,this.save()}}]),t}();function mL(t){return JSON.stringify(t,(e=[],function(n,r){if(Ri(r)){for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(r)?"[Circular]":(e.push(r),r)}return r})).length;var e}var oXe=2,aXe=4;function vL(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:66060288e-1;if(t.size>=e&&t.data.length>1){var n=Math.floor(t.data.length/2),r=t.data.slice(0,n),i=t.data.slice(n);return[vL({size:mL(r),data:r,sessionId:t.sessionId,windowId:t.windowId}),vL({size:mL(i),data:i,sessionId:t.sessionId,windowId:t.windowId})].flatMap(function(s){return s})}return[t]}var KT=function(t){return t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t}(KT||{}),Ul=function(t){return t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t}(Ul||{});function WN(t){return t?uI(t).split(/\s+/):[]}function tG(t){var e=se==null?void 0:se.location.href;return!!(e&&t&&t.some(function(n){return e.match(n)}))}function Vk(t){var e="";switch(z_(t.className)){case"string":e=t.className;break;case"object":e=(t.className&&"baseVal"in t.className?t.className.baseVal:null)||t.getAttribute("class")||"";break;default:e=""}return WN(e)}function gle(t){return no(t)?null:uI(t).split(/(\s+)/).filter(function(e){return Km(e)}).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function qk(t){var e="";return _L(t)&&!_le(t)&&t.childNodes&&t.childNodes.length&&Tn(t.childNodes,function(n){var r;mle(n)&&n.textContent&&(e+=(r=gle(n.textContent))!==null&&r!==void 0?r:"")}),uI(e)}function YN(t){return!!t&&t.nodeType===1}function nf(t,e){return!!t&&!!t.tagName&&t.tagName.toLowerCase()===e.toLowerCase()}function mle(t){return!!t&&t.nodeType===3}function vle(t){return!!t&&t.nodeType===11}var yL=["a","button","form","input","select","textarea","label"];function yle(t){var e=t.parentNode;return!(!e||!YN(e))&&e}function cXe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!se||!t||nf(t,"html")||!YN(t)||n!=null&&n.url_allowlist&&!tG(n.url_allowlist)||n!=null&&n.url_ignorelist&&tG(n.url_ignorelist))return!1;if(n!=null&&n.dom_event_allowlist){var s=n.dom_event_allowlist;if(s&&!s.some(function(p){return e.type===p}))return!1}for(var o=!1,a=[t],c=!0,l=t;l.parentNode&&!nf(l,"body");)if(vle(l.parentNode))a.push(l.parentNode.host),l=l.parentNode.host;else{if(!(c=yle(l)))break;if(r||yL.indexOf(c.tagName.toLowerCase())>-1)o=!0;else{var u=se.getComputedStyle(c);u&&u.getPropertyValue("cursor")==="pointer"&&(o=!0)}a.push(c),l=c}if(!function(p,m){var v=m==null?void 0:m.element_allowlist;if(Qe(v))return!0;var S,_=Pa(p);try{var w=function(){var C=S.value;if(v.some(function(I){return C.tagName.toLowerCase()===I}))return{v:!0}};for(_.s();!(S=_.n()).done;){var T=w();if(z_(T)==="object")return T.v}}catch(C){_.e(C)}finally{_.f()}return!1}(a,n)||!function(p,m){var v=m==null?void 0:m.css_selector_allowlist;if(Qe(v))return!0;var S,_=Pa(p);try{var w=function(){var C=S.value;if(v.some(function(I){return C.matches(I)}))return{v:!0}};for(_.s();!(S=_.n()).done;){var T=w();if(z_(T)==="object")return T.v}}catch(C){_.e(C)}finally{_.f()}return!1}(a,n))return!1;var d=se.getComputedStyle(t);if(d&&d.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var f=t.tagName.toLowerCase();switch(f){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return o?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(yL.indexOf(f)>-1||t.getAttribute("contenteditable")==="true")}}function _L(t){for(var e=t;e.parentNode&&!nf(e,"body");e=e.parentNode){var n=Vk(e);if($t(n,"ph-sensitive")||$t(n,"ph-no-capture"))return!1}if($t(Vk(t),"ph-include"))return!0;var r=t.type||"";if(Xi(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=t.name||t.id||"";return!(Xi(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function _le(t){return!!(nf(t,"input")&&!["button","checkbox","submit","reset"].includes(t.type)||nf(t,"select")||nf(t,"textarea")||t.getAttribute("contenteditable")==="true")}var ble="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",lXe=new RegExp("^(?:".concat(ble,")$")),uXe=new RegExp(ble),Sle="\\d{3}-?\\d{2}-?\\d{4}",dXe=new RegExp("^(".concat(Sle,")$")),fXe=new RegExp("(".concat(Sle,")"));function Km(t){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!(no(t)||Xi(t)&&(t=uI(t),(e?lXe:uXe).test((t||"").replace(/[- ]/g,""))||(e?dXe:fXe).test(t)))}function nG(t){var e=qk(t);return Km(e="".concat(e," ").concat(wle(t)).trim())?e:""}function wle(t){var e="";return t&&t.childNodes&&t.childNodes.length&&Tn(t.childNodes,function(n){var r;if(n&&((r=n.tagName)===null||r===void 0?void 0:r.toLowerCase())==="span")try{var i=qk(n);e="".concat(e," ").concat(i).trim(),n.childNodes&&n.childNodes.length&&(e="".concat(e," ").concat(wle(n)).trim())}catch(s){we.error(s)}}),e}function hXe(t){return function(e){var n=e.map(function(r){var i,s,o="";if(r.tag_name&&(o+=r.tag_name),r.attr_class){r.attr_class.sort();var a,c=Pa(r.attr_class);try{for(c.s();!(a=c.n()).done;){var l=a.value;o+=".".concat(l.replace(/"/g,""))}}catch(f){c.e(f)}finally{c.f()}}var u=Ue(Ue(Ue(Ue({},r.text?{text:r.text}:{}),{},{"nth-child":(i=r.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(s=r.nth_of_type)!==null&&s!==void 0?s:0},r.href?{href:r.href}:{}),r.attr_id?{attr_id:r.attr_id}:{}),r.attributes),d={};return HT(u).sort(function(f,p){var m=us(f,1)[0],v=us(p,1)[0];return m.localeCompare(v)}).forEach(function(f){var p=us(f,2),m=p[0],v=p[1];return d[rG(m.toString())]=rG(v.toString())}),o+=":",o+=HT(u).map(function(f){var p=us(f,2),m=p[0],v=p[1];return"".concat(m,'="').concat(v,'"')}).join("")});return n.join(";")}(function(e){return e.map(function(n){var r,i,s={text:(r=n.$el_text)===null||r===void 0?void 0:r.slice(0,400),tag_name:n.tag_name,href:(i=n.attr__href)===null||i===void 0?void 0:i.slice(0,2048),attr_class:pXe(n),attr_id:n.attr__id,nth_child:n.nth_child,nth_of_type:n.nth_of_type,attributes:{}};return HT(n).filter(function(o){return us(o,1)[0].indexOf("attr__")===0}).forEach(function(o){var a=us(o,2),c=a[0],l=a[1];return s.attributes[c]=l}),s})}(t))}function rG(t){return t.replace(/"|\\"/g,'\\"')}function pXe(t){var e=t.attr__class;return e?qr(e)?e:WN(e):void 0}var bL="[SessionRecording]",SL="redacted",uE={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(t){return t},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},gXe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],mXe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],vXe=["/s/","/e/","/i/"];function iG(t,e,n,r){if(no(t))return t;var i=(e==null?void 0:e["content-length"])||function(s){return new Blob([s]).size}(t);return Xi(i)&&(i=parseInt(i)),i>n?bL+" ".concat(r," body too large to record (").concat(i," bytes)"):t}function sG(t,e){if(no(t))return t;var n=t;return Km(n,!1)||(n=bL+" "+e+" body "+SL),Tn(mXe,function(r){var i,s;(i=n)!==null&&i!==void 0&&i.length&&((s=n)===null||s===void 0?void 0:s.indexOf(r))!==-1&&(n=bL+" "+e+" body "+SL+" as might contain: "+r)}),n}var Gl,yXe=function(t,e){var n,r,i,s={payloadSizeLimitBytes:uE.payloadSizeLimitBytes,performanceEntryTypeToObserve:yu(uE.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(yu(e.payloadHostDenyList||[]),yu(uE.payloadHostDenyList))},o=t.session_recording.recordHeaders!==!1&&e.recordHeaders,a=t.session_recording.recordBody!==!1&&e.recordBody,c=t.capture_performance!==!1&&e.recordPerformance,l=(n=s,i=Math.min(1e6,(r=n.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),function(f){return f!=null&&f.requestBody&&(f.requestBody=iG(f.requestBody,f.requestHeaders,i,"Request")),f!=null&&f.responseBody&&(f.responseBody=iG(f.responseBody,f.responseHeaders,i,"Response")),f}),u=function(f){return l(function(v){var S=I0(v.name);if(!(S&&S.pathname&&vXe.some(function(_){return S.pathname.indexOf(_)===0})))return v}((m=(p=f).requestHeaders,no(m)||Tn(Object.keys(m??{}),function(v){gXe.includes(v.toLowerCase())&&(m[v]=SL)}),p)));var p,m},d=ma(t.session_recording.maskNetworkRequestFn);return d&&ma(t.session_recording.maskCapturedNetworkRequestFn)&&we.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),d&&(t.session_recording.maskCapturedNetworkRequestFn=function(f){var p=t.session_recording.maskNetworkRequestFn({url:f.name});return Ue(Ue({},f),{},{name:p==null?void 0:p.url})}),s.maskRequestFn=ma(t.session_recording.maskCapturedNetworkRequestFn)?function(f){var p,m,v,S=u(f);return S&&(p=(m=(v=t.session_recording).maskCapturedNetworkRequestFn)===null||m===void 0?void 0:m.call(v,S))!==null&&p!==void 0?p:void 0}:function(f){return function(p){if(!Qe(p))return p.requestBody=sG(p.requestBody,"Request"),p.responseBody=sG(p.responseBody,"Response"),p}(u(f))},Ue(Ue(Ue({},uE),s),{},{recordHeaders:o,recordBody:a,recordPerformance:c,recordInitialRequests:c})},_Xe=Yt(function t(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Wt(this,t),he(this,"bucketSize",100),he(this,"refillRate",10),he(this,"mutationBuckets",{}),he(this,"loggedTracker",{}),he(this,"refillBuckets",function(){Object.keys(i.mutationBuckets).forEach(function(o){i.mutationBuckets[o]=i.mutationBuckets[o]+i.refillRate,i.mutationBuckets[o]>=i.bucketSize&&delete i.mutationBuckets[o]})}),he(this,"getNodeOrRelevantParent",function(o){var a=i.rrweb.mirror.getNode(o);if((a==null?void 0:a.nodeName)!=="svg"&&a instanceof Element){var c=a.closest("svg");if(c)return[i.rrweb.mirror.getId(c),c]}return[o,a]}),he(this,"numberOfChanges",function(o){var a,c,l,u,d,f,p,m;return((a=(c=o.removes)===null||c===void 0?void 0:c.length)!==null&&a!==void 0?a:0)+((l=(u=o.attributes)===null||u===void 0?void 0:u.length)!==null&&l!==void 0?l:0)+((d=(f=o.texts)===null||f===void 0?void 0:f.length)!==null&&d!==void 0?d:0)+((p=(m=o.adds)===null||m===void 0?void 0:m.length)!==null&&p!==void 0?p:0)}),he(this,"throttleMutations",function(o){if(o.type!==3||o.data.source!==0)return o;var a=o.data,c=i.numberOfChanges(a);a.attributes&&(a.attributes=a.attributes.filter(function(u){var d,f,p,m=us(i.getNodeOrRelevantParent(u.id),2),v=m[0],S=m[1];return i.mutationBuckets[v]===0?!1:(i.mutationBuckets[v]=(d=i.mutationBuckets[v])!==null&&d!==void 0?d:i.bucketSize,i.mutationBuckets[v]=Math.max(i.mutationBuckets[v]-1,0),i.mutationBuckets[v]===0&&(i.loggedTracker[v]||(i.loggedTracker[v]=!0,(f=(p=i.options).onBlockedNode)===null||f===void 0||f.call(p,v,S))),u)}));var l=i.numberOfChanges(a);return l!==0||c===l?o:void 0}),this.rrweb=e,this.options=s,this.refillRate=(n=this.options.refillRate)!==null&&n!==void 0?n:this.refillRate,this.bucketSize=(r=this.options.bucketSize)!==null&&r!==void 0?r:this.bucketSize,setInterval(function(){i.refillBuckets()},1e3)}),bXe=3e5,SXe=[Ul.MouseMove,Ul.MouseInteraction,Ul.Scroll,Ul.ViewportResize,Ul.Input,Ul.TouchMove,Ul.MediaInteraction,Ul.Drag],oG=function(t){return{rrwebMethod:t,enqueuedAt:Date.now(),attempt:1}},Jo="[SessionRecording]",wXe=function(){function t(e){var n=this;if(Wt(this,t),he(this,"queuedRRWebEvents",[]),he(this,"isIdle",!1),he(this,"_linkedFlagSeen",!1),he(this,"_lastActivityTimestamp",Date.now()),he(this,"_linkedFlag",null),he(this,"_forceAllowLocalhostNetworkCapture",!1),he(this,"_onBeforeUnload",function(){n._flushBuffer()}),he(this,"_onOffline",function(){n._tryAddCustomEvent("browser offline",{})}),he(this,"_onOnline",function(){n._tryAddCustomEvent("browser online",{})}),he(this,"_onVisibilityChange",function(){if(We!=null&&We.visibilityState){var o="window "+We.visibilityState;n._tryAddCustomEvent(o,{})}}),he(this,"_samplingSessionListener",null),this.instance=e,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw we.error(Jo+" started without valid sessionManager"),new Error(Jo+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,s=r.windowId;this.sessionId=i,this.windowId=s,this.buffer=this.clearBuffer(),this._setupSampling()}return Yt(t,[{key:"rrwebRecord",get:function(){var e;return Wn==null||(e=Wn.rrweb)===null||e===void 0?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(Jo+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return((e=this.instance.config.session_recording)===null||e===void 0?void 0:e.full_snapshot_interval_millis)||bXe}},{key:"isSampled",get:function(){var e=this.instance.get_property(R0);return kh(e)?e:null}},{key:"sessionDuration",get:function(){var e,n,r=(e=this.buffer)===null||e===void 0?void 0:e.data[((n=this.buffer)===null||n===void 0?void 0:n.data.length)-1],i=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return r?r.timestamp-i:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(sL),n=!this.instance.config.disable_session_recording;return se&&e&&n}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(Bq),n=this.instance.config.enable_recording_console_log;return n??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(Hq);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,n,r=this.instance.get_property(jq),i={recordHeaders:(e=this.instance.config.session_recording)===null||e===void 0?void 0:e.recordHeaders,recordBody:(n=this.instance.config.session_recording)===null||n===void 0?void 0:n.recordBody},s=(i==null?void 0:i.recordHeaders)||(r==null?void 0:r.recordHeaders),o=(i==null?void 0:i.recordBody)||(r==null?void 0:r.recordBody),a=Ri(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,c=!!(kh(a)?a:r!=null&&r.capturePerformance);return s||o||c?{recordHeaders:s,recordBody:o,recordPerformance:c}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(Kq);return oa(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(Vq);return oa(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?no(this._linkedFlag)||this._linkedFlagSeen?kh(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),se==null||se.addEventListener("beforeunload",this._onBeforeUnload),se==null||se.addEventListener("offline",this._onOffline),se==null||se.addEventListener("online",this._onOnline),se==null||se.addEventListener("visibilitychange",this._onVisibilityChange),we.info(Jo+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,se==null||se.removeEventListener("beforeunload",this._onBeforeUnload),se==null||se.removeEventListener("offline",this._onOffline),se==null||se.removeEventListener("online",this._onOnline),se==null||se.removeEventListener("visibilitychange",this._onVisibilityChange),we.info(Jo+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var n,r=this.sessionId!==e,i=this.sampleRate;if(oa(i)){var s,o=this.isSampled,a=r||!kh(o);a?s=Math.random()<i:s=o,!s&&a&&we.warn(Jo+" Sample rate (".concat(i,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:i}),(n=this.instance.persistence)===null||n===void 0||n.register(he({},R0,s))}else{var c;(c=this.instance.persistence)===null||c===void 0||c.register(he({},R0,null))}}},{key:"afterDecideResponse",value:function(e){var n,r,i,s=this;if(this._persistDecideResponse(e),this._linkedFlag=((n=e.sessionRecording)===null||n===void 0?void 0:n.linkedFlag)||null,(r=e.sessionRecording)!==null&&r!==void 0&&r.endpoint&&(this._endpoint=(i=e.sessionRecording)===null||i===void 0?void 0:i.endpoint),this._setupSampling(),!no(this._linkedFlag)&&!this._linkedFlagSeen){var o=Xi(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,a=Xi(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags(function(c,l){var u=Ri(l)&&o in l,d=a?l[o]===a:u;if(d){var f={linkedFlag:o,linkedVariant:a},p="linked flag matched";we.info(Jo+" "+p,f),s._tryAddCustomEvent(p,f)}s._linkedFlagSeen=d})}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;oa(this.sampleRate)&&Vu(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId(function(n){e.makeSamplingDecision(n)}))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var n=this.instance.persistence,r=function(){var i,s,o,a,c,l,u,d,f=(i=e.sessionRecording)===null||i===void 0?void 0:i.sampleRate,p=no(f)?null:parseFloat(f),m=(s=e.sessionRecording)===null||s===void 0?void 0:s.minimumDurationMilliseconds;n.register((he(d={},sL,!!e.sessionRecording),he(d,Bq,(o=e.sessionRecording)===null||o===void 0?void 0:o.consoleLogRecordingEnabled),he(d,jq,Ue({capturePerformance:e.capturePerformance},(a=e.sessionRecording)===null||a===void 0?void 0:a.networkPayloadCapture)),he(d,Hq,{enabled:(c=e.sessionRecording)===null||c===void 0?void 0:c.recordCanvas,fps:(l=e.sessionRecording)===null||l===void 0?void 0:l.canvasFps,quality:(u=e.sessionRecording)===null||u===void 0?void 0:u.canvasQuality}),he(d,Kq,p),he(d,Vq,Qe(m)?null:m),d))};r(),this.sessionManager.onSessionId(r)}}},{key:"log",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log";(n=this.instance.sessionRecording)===null||n===void 0||n.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:r,trace:[],payload:[JSON.stringify(e)]}},timestamp:Jce()})}},{key:"_startCapture",value:function(){var e=this;Qe(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(sa.LIB_VERSION),function(n){if(n)return we.error(Jo+" could not load recorder.js",n);e._onScriptLoaded()}))}},{key:"isInteractiveEvent",value:function(e){var n;return e.type===3&&SXe.indexOf((n=e.data)===null||n===void 0?void 0:n.source)!==-1}},{key:"_updateWindowAndSessionIds",value:function(e){var n=this.isInteractiveEvent(e);n||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var r=!1;if(n&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)),!this.isIdle){var i=this.sessionManager.checkAndGetSessionAndWindowId(!n,e.timestamp),s=i.windowId,o=i.sessionId,a=this.sessionId!==o,c=this.windowId!==s;this.windowId=s,this.sessionId=o,(r||[oXe,aXe].indexOf(e.type)===-1&&(c||a||Qe(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(n){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):we.warn(Jo+" could not emit queued rrweb event.",n,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,n){var r=this;return this._tryRRWebMethod(oG(function(){return r.rrwebRecord.addCustomEvent(e,n)}))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(oG(function(){return e.rrwebRecord.takeFullSnapshot()}))}},{key:"_onScriptLoaded",value:function(){for(var e,n=this,r={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},i=this.instance.config.session_recording,s=0,o=Object.entries(i||{});s<o.length;s++){var a=us(o[s],2),c=a[0],l=a[1];c in r&&(c==="maskInputOptions"?r.maskInputOptions=Ue({password:!0},l):r[c]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(r.recordCanvas=!0,r.sampling={canvas:this.canvasRecording.fps},r.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=(e=this.mutationRateLimiter)!==null&&e!==void 0?e:new _Xe(this.rrwebRecord,{onBlockedNode:function(d,f){var p="Too many mutations on node '".concat(d,"'. Rate limiting. This could be due to SVG animations or something similar");we.info(p,{node:f}),n.log(Jo+" "+p,"warn")}});var u=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord(Ue({emit:function(d){n.onRRwebEmit(d)},plugins:u},r)),this.instance._addCaptureHook(function(d){try{if(d==="$pageview"){var f=se?n._maskUrl(se.location.href):"";if(!f)return;n._tryAddCustomEvent("$pageview",{href:f})}}catch(p){we.error("Could not add $pageview to rrweb session",p)}}),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:r,activePlugins:u.map(function(d){return d==null?void 0:d.name})}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else we.error(Jo+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var n=this.fullSnapshotIntervalMillis;n&&(this._fullSnapshotTimer=setInterval(function(){e._tryTakeFullSnapshot()},n))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return Wn.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(Wn.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&ma(Wn.getRecordNetworkPlugin)&&(!zJe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(Wn.getRecordNetworkPlugin(yXe(this.instance.config,this.networkPayloadCapture))):we.info(Jo+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&Ri(e)){if(e.type===KT.Meta){var n=this._maskUrl(e.data.href);if(this._lastHref=n,!n)return;e.data.href=n}else this._pageViewFallBack();e.type===KT.FullSnapshot&&this._scheduleFullSnapshot();var r=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(r){var i=function(a){var c=a;if(c&&Ri(c)&&c.type===6&&Ri(c.data)&&c.data.plugin==="rrweb/console@1"){c.data.payload.payload.length>10&&(c.data.payload.payload=c.data.payload.payload.slice(0,10),c.data.payload.payload.push("...[truncated]"));for(var l=[],u=0;u<c.data.payload.payload.length;u++)c.data.payload.payload[u]&&c.data.payload.payload[u].length>2e3?l.push(c.data.payload.payload[u].slice(0,2e3)+"...[truncated]"):l.push(c.data.payload.payload[u]);return c.data.payload.payload=l,a}return a}(r),s=mL(i);if(this._updateWindowAndSessionIds(i),!this.isIdle||i.type===KT.Custom){var o={$snapshot_bytes:s,$snapshot_data:i,$session_id:this.sessionId,$window_id:this.windowId};this.status!=="disabled"?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&se){var e=this._maskUrl(se.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var n=yu(this.queuedRRWebEvents);this.queuedRRWebEvents=[],n.forEach(function(r){Date.now()-r.enqueuedAt<=2e3&&e._tryRRWebMethod(r)})}}},{key:"_maskUrl",value:function(e){var n=this.instance.config.session_recording;if(n.maskNetworkRequestFn){var r,i={url:e};return(r=i=n.maskNetworkRequestFn(i))===null||r===void 0?void 0:r.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var n=this.minimumDuration,r=this.sessionDuration,i=oa(r)&&r>=0,s=oa(n)&&i&&r<n;return this.status==="buffering"||s?(this.flushBufferTimer=setTimeout(function(){e._flushBuffer()},2e3),this.buffer):(this.buffer.data.length>0&&vL(this.buffer).forEach(function(o){e._captureSnapshot({$snapshot_bytes:o.size,$snapshot_data:o.data,$session_id:o.sessionId,$window_id:o.windowId})}),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var n,r=this,i=2+(((n=this.buffer)===null||n===void 0?void 0:n.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+i>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout(function(){r._flushBuffer()},2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),t}(),EXe=function(){function t(e){Wt(this,t),this.instance=e,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return Yt(t,[{key:"call",value:function(){var e=this,n={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(am),group_properties:this.instance.get_property(bd),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:n,compression:this.instance.config.disable_compression?void 0:rc.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(r){return e.parseDecideResponse(r.json)}})}},{key:"parseDecideResponse",value:function(e){var n=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var r=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},r),r)we.error("Failed to fetch feature flags from PostHog.");else{if(!We||!We.body)return we.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(function(){n.parseDecideResponse(e)},500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var i,s=Pa(e.siteApps);try{var o=function(){var a=i.value,c=a.id,l=a.url,u=n.instance.requestRouter.endpointFor("api",l);Wn["__$$ph_site_app_".concat(c)]=n.instance,n.instance.requestRouter.loadScript(u,function(d){if(d)return we.error("Error while initializing PostHog app with config id ".concat(c),d)})};for(s.s();!(i=s.n()).done;)o()}catch(a){s.e(a)}finally{s.f()}}else e.siteApps.length>0&&we.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),t}(),TXe=se!=null&&se.location?Hk(se.location.hash,"__posthog")||Hk(location.hash,"state"):null,aG="_postHogToolbarParams";(function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"})(Gl||(Gl={}));var CXe=function(){function t(e){Wt(this,t),this.instance=e}return Yt(t,[{key:"setToolbarState",value:function(e){Wn.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return(e=Wn.ph_toolbar_state)!==null&&e!==void 0?e:Gl.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(!se||!We)return!1;r=(e=r)!==null&&e!==void 0?e:se.location,s=(n=s)!==null&&n!==void 0?n:se.history;try{if(!i){try{se.localStorage.setItem("test","test"),se.localStorage.removeItem("test")}catch{return!1}i=se==null?void 0:se.localStorage}var o,a=TXe||Hk(r.hash,"__posthog")||Hk(r.hash,"state"),c=a?Dq(function(){return JSON.parse(atob(decodeURIComponent(a)))})||Dq(function(){return JSON.parse(decodeURIComponent(a))}):null;return c&&c.action==="ph_authorize"?((o=c).source="url",o&&Object.keys(o).length>0&&(c.desiredHash?r.hash=c.desiredHash:s?s.replaceState(s.state,"",r.pathname+r.search):r.hash="")):((o=JSON.parse(i.getItem(aG)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token)&&(this.loadToolbar(o),!0)}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(Wn.ph_load_toolbar||Wn.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var n=this,r=!(We==null||!We.getElementById(fL));if(!se||r)return!1;var i=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=Ue(Ue({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(se.localStorage.setItem(aG,JSON.stringify(Ue(Ue({},s),{},{source:void 0}))),this.getToolbarState()===Gl.LOADED)this._callLoadToolbar(s);else if(this.getToolbarState()===Gl.UNINITIALIZED){this.setToolbarState(Gl.LOADING);var o=3e5,a=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(a),function(c){if(c)return we.error("Failed to load toolbar",c),void n.setToolbarState(Gl.UNINITIALIZED);n.setToolbarState(Gl.LOADED),n._callLoadToolbar(s)}),su(se,"turbolinks:load",function(){n.setToolbarState(Gl.UNINITIALIZED),n.loadToolbar(s)})}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return this.maybeLoadToolbar(e,n,r)}}]),t}(),kXe=function(){function t(e){Wt(this,t),he(this,"isPaused",!0),he(this,"queue",[]),he(this,"flushTimeoutMs",3e3),this.sendRequest=e}return Yt(t,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var n=this.queue.length>0?this.formatQueue():{},r=Object.values(n);[].concat(yu(r.filter(function(i){return i.url.indexOf("/e")===0})),yu(r.filter(function(i){return i.url.indexOf("/e")!==0}))).map(function(i){e.sendRequest(Ue(Ue({},i),{},{transport:"sendBeacon"}))})}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout(function(){if(e.clearFlushTimeout(),e.queue.length>0){var n=e.formatQueue(),r=function(s){var o=n[s],a=new Date().getTime();o.data&&qr(o.data)&&Tn(o.data,function(c){c.offset=Math.abs(c.timestamp-a),delete c.timestamp}),e.sendRequest(o)};for(var i in n)r(i)}},this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return Tn(this.queue,function(n){var r,i=n,s=(i?i.batchKey:null)||i.url;Qe(e[s])&&(e[s]=Ue(Ue({},i),{},{data:[]})),(r=e[s].data)===null||r===void 0||r.push(i.data)}),this.queue=[],e}}]),t}(),Ea=Uint8Array,Ws=Uint16Array,kv=Uint32Array,JN=new Ea([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),XN=new Ea([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cG=new Ea([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ele=function(t,e){for(var n=new Ws(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new kv(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},Tle=Ele(JN,2),RXe=Tle[0],wL=Tle[1];RXe[28]=258,wL[258]=28;for(var lG=Ele(XN,0)[1],Cle=new Ws(32768),Un=0;Un<32768;++Un){var eh=(43690&Un)>>>1|(21845&Un)<<1;eh=(61680&(eh=(52428&eh)>>>2|(13107&eh)<<2))>>>4|(3855&eh)<<4,Cle[Un]=((65280&eh)>>>8|(255&eh)<<8)>>>1}var x0=function(t,e,n){for(var r=t.length,i=0,s=new Ws(e);i<r;++i)++s[t[i]-1];var o,a=new Ws(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;for(o=new Ws(r),i=0;i<r;++i)o[i]=Cle[a[t[i]-1]++]>>>15-t[i];return o},bp=new Ea(288);for(Un=0;Un<144;++Un)bp[Un]=8;for(Un=144;Un<256;++Un)bp[Un]=9;for(Un=256;Un<280;++Un)bp[Un]=7;for(Un=280;Un<288;++Un)bp[Un]=8;var Gk=new Ea(32);for(Un=0;Un<32;++Un)Gk[Un]=5;var IXe=x0(bp,9),xXe=x0(Gk,5),kle=function(t){return(t/8>>0)+(7&t&&1)},Rle=function(t,e,n){(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof Ws?Ws:t instanceof kv?kv:Ea)(n-e);return r.set(t.subarray(e,n)),r},Ll=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8},u1=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},NO=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,s=n.slice();if(!i)return[new Ea(0),0];if(i==1){var o=new Ea(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort(function(I,R){return I.f-R.f}),n.push({s:-1,f:25001});var a=n[0],c=n[1],l=0,u=1,d=2;for(n[0]={s:-1,f:a.f+c.f,l:a,r:c};u!=i-1;)a=n[n[l].f<n[d].f?l++:d++],c=n[l!=u&&n[l].f<n[d].f?l++:d++],n[u++]={s:-1,f:a.f+c.f,l:a,r:c};var f=s[0].s;for(r=1;r<i;++r)s[r].s>f&&(f=s[r].s);var p=new Ws(f+1),m=PXe(n[u-1],p,0);if(m>e){r=0;var v=0,S=m-e,_=1<<S;for(s.sort(function(I,R){return p[R.s]-p[I.s]||I.f-R.f});r<i;++r){var w=s[r].s;if(!(p[w]>e))break;v+=_-(1<<m-p[w]),p[w]=e}for(v>>>=S;v>0;){var T=s[r].s;p[T]<e?v-=1<<e-p[T]++-1:++r}for(;r>=0&&v;--r){var C=s[r].s;p[C]==e&&(--p[C],++v)}m=e}return[new Ea(p),m]},PXe=function t(e,n,r){return e.s==-1?Math.max(t(e.l,n,r+1),t(e.r,n,r+1)):n[e.s]=r},uG=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new Ws(++e),r=0,i=t[0],s=1,o=function(c){n[r++]=c},a=1;a<=e;++a)if(t[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=t[a]}return[n.subarray(0,r),e]},d1=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},EL=function(t,e,n){var r=n.length,i=kle(e+2);t[i]=255&r,t[i+1]=r>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},dG=function(t,e,n,r,i,s,o,a,c,l,u){Ll(e,u++,n),++i[256];for(var d=NO(i,15),f=d[0],p=d[1],m=NO(s,15),v=m[0],S=m[1],_=uG(f),w=_[0],T=_[1],C=uG(v),I=C[0],R=C[1],O=new Ws(19),A=0;A<w.length;++A)O[31&w[A]]++;for(A=0;A<I.length;++A)O[31&I[A]]++;for(var U=NO(O,7),N=U[0],L=U[1],j=19;j>4&&!N[cG[j-1]];--j);var X,G,F,V,J=l+5<<3,K=d1(i,bp)+d1(s,Gk)+o,W=d1(i,f)+d1(s,v)+o+14+3*j+d1(O,N)+(2*O[16]+3*O[17]+7*O[18]);if(J<=K&&J<=W)return EL(e,u,t.subarray(c,c+l));if(Ll(e,u,1+(W<K)),u+=2,W<K){X=x0(f,p),G=f,F=x0(v,S),V=v;var Y=x0(N,L);for(Ll(e,u,T-257),Ll(e,u+5,R-1),Ll(e,u+10,j-4),u+=14,A=0;A<j;++A)Ll(e,u+3*A,N[cG[A]]);u+=3*j;for(var ce=[w,I],ue=0;ue<2;++ue){var Te=ce[ue];for(A=0;A<Te.length;++A){var Re=31&Te[A];Ll(e,u,Y[Re]),u+=N[Re],Re>15&&(Ll(e,u,Te[A]>>>5&127),u+=Te[A]>>>12)}}}else X=IXe,G=bp,F=xXe,V=Gk;for(A=0;A<a;++A)if(r[A]>255){Re=r[A]>>>18&31,u1(e,u,X[Re+257]),u+=G[Re+257],Re>7&&(Ll(e,u,r[A]>>>23&31),u+=JN[Re]);var Oe=31&r[A];u1(e,u,F[Oe]),u+=V[Oe],Oe>3&&(u1(e,u,r[A]>>>5&8191),u+=XN[Oe])}else u1(e,u,X[r[A]]),u+=G[r[A]];return u1(e,u,X[256]),u+G[256]},OXe=new kv([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),MXe=function(){for(var t=new kv(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t}(),AXe=function(t,e,n,r,i){return function(s,o,a,c,l,u){var d=s.length,f=new Ea(c+d+5*(1+Math.floor(d/7e3))+l),p=f.subarray(c,f.length-l),m=0;if(!o||d<8)for(var v=0;v<=d;v+=65535){var S=v+65535;S<d?m=EL(p,m,s.subarray(v,S)):(p[v]=u,m=EL(p,m,s.subarray(v,d)))}else{for(var _=OXe[o-1],w=_>>>13,T=8191&_,C=(1<<a)-1,I=new Ws(32768),R=new Ws(C+1),O=Math.ceil(a/3),A=2*O,U=function(nn){return(s[nn]^s[nn+1]<<O^s[nn+2]<<A)&C},N=new kv(25e3),L=new Ws(288),j=new Ws(32),X=0,G=0,F=(v=0,0),V=0,J=0;v<d;++v){var K=U(v),W=32767&v,Y=R[K];if(I[W]=Y,R[K]=W,V<=v){var ce=d-v;if((X>7e3||F>24576)&&ce>423){m=dG(s,p,0,N,L,j,G,F,J,v-J,m),F=X=G=0,J=v;for(var ue=0;ue<286;++ue)L[ue]=0;for(ue=0;ue<30;++ue)j[ue]=0}var Te=2,Re=0,Oe=T,De=W-Y&32767;if(ce>2&&K==U(v-De))for(var ze=Math.min(w,ce)-1,et=Math.min(32767,v),lt=Math.min(258,ce);De<=et&&--Oe&&W!=Y;){if(s[v+Te]==s[v+Te-De]){for(var Ae=0;Ae<lt&&s[v+Ae]==s[v+Ae-De];++Ae);if(Ae>Te){if(Te=Ae,Re=De,Ae>ze)break;var yn=Math.min(De,Ae-2),un=0;for(ue=0;ue<yn;++ue){var je=v-De+ue+32768&32767,Bt=je-I[je]+32768&32767;Bt>un&&(un=Bt,Y=je)}}}De+=(W=Y)-(Y=I[W])+32768&32767}if(Re){N[F++]=268435456|wL[Te]<<18|lG[Re];var _n=31&wL[Te],Jn=31&lG[Re];G+=JN[_n]+XN[Jn],++L[257+_n],++j[Jn],V=v+Te,++X}else N[F++]=s[v],++L[s[v]]}}m=dG(s,p,u,N,L,j,G,F,J,v-J,m)}return Rle(f,0,c+kle(m)+l)}(t,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!i)},UO=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function LXe(t,e){e===void 0&&(e={});var n=function(){var a=4294967295;return{p:function(c){for(var l=a,u=0;u<c.length;++u)l=MXe[255&l^c[u]]^l>>>8;a=l},d:function(){return 4294967295^a}}}(),r=t.length;n.p(t);var i,s=AXe(t,e,10+((i=e).filename&&i.filename.length+1||0),8),o=s.length;return function(a,c){var l=c.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=c.level<2?4:c.level==9?2:0,a[9]=3,c.mtime!=0&&UO(a,4,Math.floor(new Date(c.mtime||Date.now())/1e3)),l){a[3]=8;for(var u=0;u<=l.length;++u)a[u+10]=l.charCodeAt(u)}}(s,e),UO(s,o-8,n.d()),UO(s,o-4,r),s}var DXe=!!tL||!!eL,fG="text/plain",zk=function(t,e){var n=us(t.split("?"),2),r=n[0],i=n[1],s=Ue({},e);i==null||i.split("&").forEach(function(a){var c=us(a.split("="),1)[0];delete s[c]});var o=WJe(s);return o=o?(i?i+"&":"")+o:i,"".concat(r,"?").concat(o)},NXe=function(t){return"data="+encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},$O=function(t){var e=t.data,n=t.compression;if(e){if(n===rc.GZipJS){var r=LXe(function(s,o){var a=s.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(s);for(var c=new Ea(s.length+(s.length>>>1)),l=0,u=function(m){c[l++]=m},d=0;d<a;++d){if(l+5>c.length){var f=new Ea(l+8+(a-d<<1));f.set(c),c=f}var p=s.charCodeAt(d);p<128||o?u(p):p<2048?(u(192|p>>>6),u(128|63&p)):p>55295&&p<57344?(u(240|(p=65536+(1047552&p)|1023&s.charCodeAt(++d))>>>18),u(128|p>>>12&63),u(128|p>>>6&63),u(128|63&p)):(u(224|p>>>12),u(128|p>>>6&63),u(128|63&p))}return Rle(c,0,l)}(JSON.stringify(e)),{mtime:0});return{contentType:fG,body:new Blob([r],{type:fG})}}if(n===rc.Base64){var i=function(s){var o,a,c,l,u,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=0,p=0,m="",v=[];if(!s)return s;s=DJe(s);do o=(u=s.charCodeAt(f++)<<16|s.charCodeAt(f++)<<8|s.charCodeAt(f++))>>18&63,a=u>>12&63,c=u>>6&63,l=63&u,v[p++]=d.charAt(o)+d.charAt(a)+d.charAt(c)+d.charAt(l);while(f<s.length);switch(m=v.join(""),s.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}(JSON.stringify(e));return{contentType:"application/x-www-form-urlencoded",body:NXe(i)}}return{contentType:"application/json",body:JSON.stringify(e)}}},P0=[];tL&&P0.push({transport:"XHR",method:function(t){var e,n=new tL;n.open(t.method||"GET",t.url,!0);var r=(e=$O(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body;Tn(t.headers,function(o,a){n.setRequestHeader(a,o)}),i&&n.setRequestHeader("Content-Type",i),t.timeout&&(n.timeout=t.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(n.readyState===4){var o,a={statusCode:n.status,text:n.responseText};if(n.status===200)try{a.json=JSON.parse(n.responseText)}catch{}(o=t.callback)===null||o===void 0||o.call(t,a)}},n.send(s)}}),eL&&P0.push({transport:"fetch",method:function(t){var e,n,r=(e=$O(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body,o=new Headers;Tn(t.headers,function(u,d){o.append(d,u)}),i&&o.append("Content-Type",i);var a=t.url,c=null;if(Aq){var l=new Aq;c={signal:l.signal,timeout:setTimeout(function(){return l.abort()},t.timeout)}}eL(a,{method:(t==null?void 0:t.method)||"GET",headers:o,keepalive:t.method==="POST",body:s,signal:(n=c)===null||n===void 0?void 0:n.signal}).then(function(u){return u.text().then(function(d){var f,p={statusCode:u.status,text:d};if(u.status===200)try{p.json=JSON.parse(d)}catch(m){we.error(m)}(f=t.callback)===null||f===void 0||f.call(t,p)})}).catch(function(u){var d;we.error(u),(d=t.callback)===null||d===void 0||d.call(t,{statusCode:0,text:u})}).finally(function(){return c?clearTimeout(c.timeout):null})}}),sc!=null&&sc.sendBeacon&&P0.push({transport:"sendBeacon",method:function(t){var e=zk(t.url,{beacon:"1"});try{var n,r=(n=$O(t))!==null&&n!==void 0?n:{},i=r.contentType,s=r.body,o=typeof s=="string"?new Blob([s],{type:i}):s;sc.sendBeacon(e,o)}catch{}}});var UXe=["retriesPerformedSoFar"],Rh,$Xe=function(){function t(e){var n=this;Wt(this,t),he(this,"isPolling",!1),he(this,"pollIntervalMs",3e3),he(this,"queue",[]),this.instance=e,this.queue=[],this.areWeOnline=!0,!Qe(se)&&"onLine"in se.navigator&&(this.areWeOnline=se.navigator.onLine,se.addEventListener("online",function(){n.areWeOnline=!0,n.flush()}),se.addEventListener("offline",function(){n.areWeOnline=!1}))}return Yt(t,[{key:"retriableRequest",value:function(e){var n=this,r=e.retriesPerformedSoFar,i=PJe(e,UXe);oa(r)&&r>0&&(i.url=zk(i.url,{retry_count:r})),this.instance._send_request(Ue(Ue({},i),{},{callback:function(s){var o;s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(r??0)<10?n.enqueue(Ue({retriesPerformedSoFar:r},i)):(o=i.callback)===null||o===void 0||o.call(i,s)}}))}},{key:"enqueue",value:function(e){var n=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=n+1;var r=function(o){var a=3e3*Math.pow(2,o),c=a/2,l=Math.min(18e5,a),u=(Math.random()-.5)*(l-c);return Math.ceil(l+u)}(n),i=Date.now()+r;this.queue.push({retryAt:i,requestOptions:e});var s="Enqueued failed request for retry in ".concat(r);navigator.onLine||(s+=" (Browser is offline)"),we.warn(s),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout(function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()},this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),n=[],r=this.queue.filter(function(a){return a.retryAt<e||(n.push(a),!1)});if(this.queue=n,r.length>0){var i,s=Pa(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.requestOptions;this.retriableRequest(o)}}catch(a){s.e(a)}finally{s.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,n=Pa(this.queue);try{for(n.s();!(e=n.n()).done;){var r=e.value.requestOptions;try{this.instance._send_request(Ue(Ue({},r),{},{transport:"sendBeacon"}))}catch(i){we.error(i)}}}catch(i){n.e(i)}finally{n.f()}this.queue=[]}}]),t}(),dE=1800,FXe=function(){function t(e,n,r,i){var s;Wt(this,t),he(this,"_sessionIdChangedHandlers",[]),this.config=e,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||Nd,this._windowIdGenerator=i||Nd;var o=e.persistence_name||e.token,a=e.session_idle_timeout_seconds||dE;if(oa(a)?a>dE?we.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&we.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(we.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=dE),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),dE),this._window_id_storage_key="ph_"+o+"_window_id",this._primary_window_exists_storage_key="ph_"+o+"_primary_window_exists",this._canUseSessionStorage()){var c=Ei.parse(this._window_id_storage_key),l=Ei.parse(this._primary_window_exists_storage_key);c&&!l?this._windowId=c:Ei.remove(this._window_id_storage_key),Ei.set(this._primary_window_exists_storage_key,!0)}if((s=this.config.bootstrap)!==null&&s!==void 0&&s.sessionID)try{var u=function(d){var f=d.replace(/-/g,"");if(f.length!==32)throw new Error("Not a valid UUID");if(f[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(f.substring(0,12),16)}(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,new Date().getTime(),u)}catch(d){we.error("Invalid sessionID in bootstrap",d)}this._listenToReloadWindow()}return Yt(t,[{key:"onSessionId",value:function(e){var n=this;return Qe(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){n._sessionIdChangedHandlers=n._sessionIdChangedHandlers.filter(function(r){return r!==e})}}},{key:"_canUseSessionStorage",value:function(){return this.config.persistence!=="memory"&&!this.persistence.disabled&&Ei.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&Ei.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?Ei.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,n,r){e===this._sessionId&&n===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=n,this._sessionId=e,this.persistence.register(he({},$k,[n,e,r])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[$k];return qr(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;se==null||se.addEventListener("beforeunload",function(){e._canUseSessionStorage()&&Ei.remove(e._primary_window_exists_storage_key)})}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:null)||new Date().getTime(),r=us(this._getSessionId(),3),i=r[0],s=r[1],o=r[2],a=this._getWindowId(),c=o&&o>0&&Math.abs(n-o)>864e5,l=!1,u=!s,d=!e&&Math.abs(n-i)>this._sessionTimeoutMs;u||d||c?(s=this._sessionIdGenerator(),a=this._windowIdGenerator(),we.info("[SessionId] new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:u,activityTimeout:d,sessionPastMaximumLength:c}}),o=n,l=!0):a||(a=this._windowIdGenerator(),l=!0);var f=i===0||!e||c?n:i,p=o===0?new Date().getTime():o;return this._setWindowId(a),this._setSessionId(s,f,p),l&&this._sessionIdChangedHandlers.forEach(function(m){return m(s,a)}),{sessionId:s,windowId:a,sessionStartTimestamp:p}}}]),t}();(function(t){t.US="us",t.EU="eu",t.CUSTOM="custom"})(Rh||(Rh={}));var hG="i.posthog.com",BXe=function(){function t(e){Wt(this,t),he(this,"_regionCache",{}),this.instance=e}return Yt(t,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,n=(e=this.instance.config.ui_host)===null||e===void 0?void 0:e.replace(/\/$/,"");return n||(n=this.apiHost.replace(".".concat(hG),".posthog.com")),n==="https://app.posthog.com"?"https://us.posthog.com":n}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=Rh.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=Rh.EU:this._regionCache[this.apiHost]=Rh.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(n&&(n=n[0]==="/"?n:"/".concat(n)),e==="ui")return this.uiHost+n;if(this.region===Rh.CUSTOM)return this.apiHost+n;var r=hG+n;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(r);case"api":return"https://".concat(this.region,".").concat(r)}}},{key:"loadScript",value:function(e,n){if(this.instance.config.disable_external_dependency_loading)return we.warn("".concat(e," was requested but loading of external scripts is disabled.")),n("Loading of external scripts is disabled");var r=e[0]==="/"?this.endpointFor("assets",e):e,i=function(){if(!We)return n("document not found");var s=We.createElement("script");s.type="text/javascript",s.src=r,s.onload=function(c){return n(void 0,c)},s.onerror=function(c){return n(c)};var o,a=We.querySelectorAll("body > script");a.length>0?(o=a[0].parentNode)===null||o===void 0||o.insertBefore(s,a[0]):We.body.appendChild(s)};We!=null&&We.body?i():We==null||We.addEventListener("DOMContentLoaded",i)}}]),t}(),Ile="posthog-js";function xle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.organization,r=e.projectId,i=e.prefix,s=e.severityAllowList,o=s===void 0?["error"]:s;return function(a){var c,l,u,d,f;if(!(o==="*"||o.includes(a.level))||!t.__loaded)return a;a.tags||(a.tags={});var p=t.requestRouter.endpointFor("ui","/project/".concat(t.config.token,"/person/").concat(t.get_distinct_id()));a.tags["PostHog Person URL"]=p,t.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=t.get_session_replay_url({withTimestamp:!0}));var m=((c=a.exception)===null||c===void 0?void 0:c.values)||[],v={$exception_message:((l=m[0])===null||l===void 0?void 0:l.value)||a.message,$exception_type:(u=m[0])===null||u===void 0?void 0:u.type,$exception_personURL:p,$exception_level:a.level,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((d=m[0])===null||d===void 0?void 0:d.value)||a.message,$sentry_exception_type:(f=m[0])===null||f===void 0?void 0:f.type,$sentry_tags:a.tags,$level:a.level};return n&&r&&(v.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+a.event_id),t.exceptions.sendExceptionEvent(v),a}}var jXe=Yt(function t(e,n,r,i,s){Wt(this,t),this.name=Ile,this.setupOnce=function(o){o(xle(e,{organization:n,projectId:r,prefix:i,severityAllowList:s}))}});function HXe(t,e){var n=t.config.segment;if(!n)return e();(function(r,i){var s=r.config.segment;if(!s)return i();var o=function(c){var l=function(){return c.anonymousId()||Nd()};r.config.get_device_id=l,c.id()&&(r.register({distinct_id:c.id(),$device_id:l()}),r.persistence.set_property(ql,"identified")),i()},a=s.user();"then"in a&&ma(a.then)?a.then(function(c){return o(c)}):o(a)})(t,function(){n.register(function(r){Promise&&Promise.resolve||we.warn("This browser does not have Promise support, and can not use the segment integration");var i=function(s,o){var a;if(!o)return s;s.event.userId||s.event.anonymousId===r.get_distinct_id()||(we.info("Segment integration does not have a userId set, resetting PostHog"),r.reset()),s.event.userId&&s.event.userId!==r.get_distinct_id()&&(we.info("Segment integration has a userId set, identifying with PostHog"),r.identify(s.event.userId));var c=r._calculate_event_properties(o,(a=s.event.properties)!==null&&a!==void 0?a:{},new Date);return s.event.properties=Object.assign({},c,s.event.properties),s};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(s){return i(s,s.event.event)},page:function(s){return i(s,"$pageview")},identify:function(s){return i(s,"$identify")},screen:function(s){return i(s,"$screen")}}}(t)).then(function(){e()})})}var pG,Wk,ja,KXe=function(){function t(e){Wt(this,t),this._instance=e}return Yt(t,[{key:"doPageView",value:function(e){var n,r=this._previousPageViewProperties(e);return this._currentPath=(n=se==null?void 0:se.location.pathname)!==null&&n!==void 0?n:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,r}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var n=this._currentPath,r=this._prevPageviewTimestamp,i=this._instance.scrollManager.getContext();if(!r)return{};var s={};if(i){var o=i.maxScrollHeight,a=i.lastScrollY,c=i.maxScrollY,l=i.maxContentHeight,u=i.lastContentY,d=i.maxContentY;Qe(o)||Qe(a)||Qe(c)||Qe(l)||Qe(u)||Qe(d)||(o=Math.ceil(o),a=Math.ceil(a),c=Math.ceil(c),l=Math.ceil(l),u=Math.ceil(u),d=Math.ceil(d),s={$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:o<=1?1:fE(a/o,0,1),$prev_pageview_max_scroll:c,$prev_pageview_max_scroll_percentage:o<=1?1:fE(c/o,0,1),$prev_pageview_last_content:u,$prev_pageview_last_content_percentage:l<=1?1:fE(u/l,0,1),$prev_pageview_max_content:d,$prev_pageview_max_content_percentage:l<=1?1:fE(d/l,0,1)})}return n&&(s.$prev_pageview_pathname=n),r&&(s.$prev_pageview_duration=(e.getTime()-r.getTime())/1e3),s}}]),t}();function fE(t,e,n){return Math.max(e,Math.min(t,n))}(function(t){t.Popover="popover",t.API="api",t.Widget="widget"})(pG||(pG={})),function(t){t.Open="open",t.MultipleChoice="multiple_choice",t.SingleChoice="single_choice",t.Rating="rating",t.Link="link"}(Wk||(Wk={})),function(t){t.NextQuestion="next_question",t.End="end",t.ResponseBased="response_based",t.SpecificQuestion="specific_question"}(ja||(ja={}));var Ple=function(){function t(){Wt(this,t),he(this,"events",{}),this.events={}}return Yt(t,[{key:"on",value:function(e,n){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(n),function(){r.events[e]=r.events[e].filter(function(i){return i!==n})}}},{key:"emit",value:function(e,n){var r,i=Pa(this.events[e]||[]);try{for(i.s();!(r=i.n()).done;)(0,r.value)(n)}catch(a){i.e(a)}finally{i.f()}var s,o=Pa(this.events["*"]||[]);try{for(o.s();!(s=o.n()).done;)(0,s.value)(e,n)}catch(a){o.e(a)}finally{o.f()}}}]),t}(),VXe=function(){function t(e){var n=this;Wt(this,t),he(this,"_debugEventEmitter",new Ple),he(this,"checkStep",function(r,i){return n.checkStepEvent(r,i)&&n.checkStepUrl(r,i)&&n.checkStepElement(r,i)}),he(this,"checkStepEvent",function(r,i){return i==null||!i.event||(r==null?void 0:r.event)===(i==null?void 0:i.event)}),this.instance=e,this.actionEvents=new Set,this.actionRegistry=new Set}return Yt(t,[{key:"init",value:function(){var e,n=this;if(!Qe((e=this.instance)===null||e===void 0?void 0:e._addCaptureHook)){var r;(r=this.instance)===null||r===void 0||r._addCaptureHook(function(i,s){n.on(i,s)})}}},{key:"register",value:function(e){var n,r,i=this;if(!Qe((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)&&(e.forEach(function(a){var c,l;(c=i.actionRegistry)===null||c===void 0||c.add(a),(l=a.steps)===null||l===void 0||l.forEach(function(u){var d;(d=i.actionEvents)===null||d===void 0||d.add((u==null?void 0:u.event)||"")})}),(r=this.instance)!==null&&r!==void 0&&r.autocapture)){var s,o=new Set;e.forEach(function(a){var c;(c=a.steps)===null||c===void 0||c.forEach(function(l){l!=null&&l.selector&&o.add(l==null?void 0:l.selector)})}),(s=this.instance)===null||s===void 0||s.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,n){var r,i=this;n!=null&&e.length!=0&&(this.actionEvents.has(e)||this.actionEvents.has(n==null?void 0:n.event))&&this.actionRegistry&&((r=this.actionRegistry)===null||r===void 0?void 0:r.size)>0&&this.actionRegistry.forEach(function(s){i.checkAction(n,s)&&i._debugEventEmitter.emit("actionCaptured",s.name)})}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",function(n){return e(n)})}},{key:"checkAction",value:function(e,n){if((n==null?void 0:n.steps)==null)return!1;var r,i=Pa(n.steps);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.checkStep(e,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"onAction",value:function(e,n){return this._debugEventEmitter.on(e,n)}},{key:"checkStepUrl",value:function(e,n){if(n!=null&&n.url){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$current_url;if(!i||typeof i!="string"||!t.matchString(i,n==null?void 0:n.url,(n==null?void 0:n.url_matching)||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(e,n){if((n!=null&&n.href||n!=null&&n.tag_name||n!=null&&n.text)&&!this.getElementsList(e).some(function(s){return!(n!=null&&n.href&&!t.matchString(s.href||"",n==null?void 0:n.href,(n==null?void 0:n.href_matching)||"exact"))&&(n==null||!n.tag_name||s.tag_name===(n==null?void 0:n.tag_name))&&!(n!=null&&n.text&&!t.matchString(s.text||"",n==null?void 0:n.text,(n==null?void 0:n.text_matching)||"exact")&&!t.matchString(s.$el_text||"",n==null?void 0:n.text,(n==null?void 0:n.text_matching)||"exact"))}))return!1;if(n!=null&&n.selector){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$element_selectors;if(!i||!i.includes(n==null?void 0:n.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return(e==null?void 0:e.properties.$elements)==null?[]:e==null?void 0:e.properties.$elements}}],[{key:"matchString",value:function(e,n,r){switch(r){case"regex":return!!se&&jk(e,n);case"exact":return n===e;case"contains":var i=t.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return jk(e,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),t}(),TL=function(){function t(e){Wt(this,t),this.instance=e,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return Yt(t,[{key:"register",value:function(e){var n;Qe((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var n=this,r=e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.actions)&&((o=i.conditions)===null||o===void 0||(a=o.actions)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0});r.length!==0&&(this.actionMatcher==null&&(this.actionMatcher=new VXe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook(function(i){n.onAction(i)})),r.forEach(function(i){var s,o,a,c,l,u,d,f,p,m;i.conditions&&(s=i.conditions)!==null&&s!==void 0&&s.actions&&(o=i.conditions)!==null&&o!==void 0&&(a=o.actions)!==null&&a!==void 0&&a.values&&((c=i.conditions)===null||c===void 0||(l=c.actions)===null||l===void 0||(u=l.values)===null||u===void 0?void 0:u.length)>0&&((d=n.actionMatcher)===null||d===void 0||d.register(i.conditions.actions.values),(f=i.conditions)===null||f===void 0||(p=f.actions)===null||p===void 0||(m=p.values)===null||m===void 0||m.forEach(function(v){if(v&&v.name){var S=n.actionToSurveys.get(v.name);S&&S.push(i.id),n.actionToSurveys.set(v.name,S||[i.id])}}))}))}},{key:"setupEventBasedSurveys",value:function(e){var n,r=this;e.filter(function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.events)&&((o=i.conditions)===null||o===void 0||(a=o.events)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0}).length!==0&&((n=this.instance)===null||n===void 0||n._addCaptureHook(function(i,s){r.onEvent(i,s)}),e.forEach(function(i){var s,o,a;(s=i.conditions)===null||s===void 0||(o=s.events)===null||o===void 0||(a=o.values)===null||a===void 0||a.forEach(function(c){if(c&&c.name){var l=r.eventToSurveys.get(c.name);l&&l.push(i.id),r.eventToSurveys.set(c.name,l||[i.id])}})}))}},{key:"onEvent",value:function(e,n){var r,i,s=((r=this.instance)===null||r===void 0||(i=r.persistence)===null||i===void 0?void 0:i.props[sE])||[];if(t.SURVEY_SHOWN_EVENT_NAME==e&&n&&s.length>0){var o,a=n==null||(o=n.properties)===null||o===void 0?void 0:o.$survey_id;if(a){var c=s.indexOf(a);c>=0&&(s.splice(c,1),this._updateActivatedSurveys(s))}}else this.eventToSurveys.has(e)&&this._updateActivatedSurveys(s.concat(this.eventToSurveys.get(e)||[]))}},{key:"onAction",value:function(e){var n,r,i=((n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0?void 0:r.props[sE])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(i.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var n,r;(n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0||r.register(he({},sE,yu(new Set(e))))}},{key:"getSurveys",value:function(){var e,n,r=(e=this.instance)===null||e===void 0||(n=e.persistence)===null||n===void 0?void 0:n.props[sE];return r||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),t}();he(TL,"SURVEY_SHOWN_EVENT_NAME","survey shown");var f1="[Surveys]",qXe={icontains:function(t){return!!se&&se.location.href.toLowerCase().indexOf(t.toLowerCase())>-1},not_icontains:function(t){return!!se&&se.location.href.toLowerCase().indexOf(t.toLowerCase())===-1},regex:function(t){return!!se&&jk(se.location.href,t)},not_regex:function(t){return!!se&&!jk(se.location.href,t)},exact:function(t){return(se==null?void 0:se.location.href)===t},is_not:function(t){return(se==null?void 0:se.location.href)!==t}},GXe=function(){function t(e){Wt(this,t),this.instance=e,this._surveyEventReceiver=null}return Yt(t,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,n=Wn==null?void 0:Wn.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||n||(this._surveyEventReceiver==null&&(this._surveyEventReceiver=new TL(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",function(r){if(r)return we.error(f1,"Could not load surveys script",r);e._surveyManager=Wn.extendPostHogWithSurveys(e.instance)}))}},{key:"getSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.instance.config.disable_surveys)return e([]);this._surveyEventReceiver==null&&(this._surveyEventReceiver=new TL(this.instance));var i=this.instance.get_property(aL);if(i&&!r)return e(i);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(s){var o;if(s.statusCode!==200||!s.json)return e([]);var a,c=s.json.surveys||[],l=c.filter(function(u){var d,f,p,m,v,S,_,w,T,C,I,R;return((d=u.conditions)===null||d===void 0?void 0:d.events)&&((f=u.conditions)===null||f===void 0||(p=f.events)===null||p===void 0?void 0:p.values)&&((m=u.conditions)===null||m===void 0||(v=m.events)===null||v===void 0||(S=v.values)===null||S===void 0?void 0:S.length)>0||((_=u.conditions)===null||_===void 0?void 0:_.actions)&&((w=u.conditions)===null||w===void 0||(T=w.actions)===null||T===void 0?void 0:T.values)&&((C=u.conditions)===null||C===void 0||(I=C.actions)===null||I===void 0||(R=I.values)===null||R===void 0?void 0:R.length)>0});return l.length>0&&((a=n._surveyEventReceiver)===null||a===void 0||a.register(l)),(o=n.instance.persistence)===null||o===void 0||o.register(he({},aL,c)),e(c)}})}},{key:"getActiveMatchingSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.getSurveys(function(i){var s,o=i.filter(function(l){return!(!l.start_date||l.end_date)}).filter(function(l){var u,d,f,p;if(!l.conditions)return!0;var m=(u=l.conditions)===null||u===void 0||!u.url||qXe[(d=(f=l.conditions)===null||f===void 0?void 0:f.urlMatchType)!==null&&d!==void 0?d:"icontains"](l.conditions.url),v=(p=l.conditions)===null||p===void 0||!p.selector||(We==null?void 0:We.querySelector(l.conditions.selector));return m&&v}),a=(s=n._surveyEventReceiver)===null||s===void 0?void 0:s.getSurveys(),c=o.filter(function(l){var u,d,f,p,m,v,S,_,w,T;if(!l.linked_flag_key&&!l.targeting_flag_key&&!l.internal_targeting_flag_key)return!0;var C=!l.linked_flag_key||n.instance.featureFlags.isFeatureEnabled(l.linked_flag_key),I=!l.targeting_flag_key||n.instance.featureFlags.isFeatureEnabled(l.targeting_flag_key),R=((u=l.conditions)===null||u===void 0?void 0:u.events)&&((d=l.conditions)===null||d===void 0||(f=d.events)===null||f===void 0?void 0:f.values)&&((p=l.conditions)===null||p===void 0||(m=p.events)===null||m===void 0?void 0:m.values.length)>0,O=((v=l.conditions)===null||v===void 0?void 0:v.actions)&&((S=l.conditions)===null||S===void 0||(_=S.actions)===null||_===void 0?void 0:_.values)&&((w=l.conditions)===null||w===void 0||(T=w.actions)===null||T===void 0?void 0:T.values.length)>0,A=!R&&!O||(a==null?void 0:a.includes(l.id)),U=n._canActivateRepeatedly(l),N=!(l.internal_targeting_flag_key&&!U)||n.instance.featureFlags.isFeatureEnabled(l.internal_targeting_flag_key);return C&&I&&N&&A});return e(c)},r)}},{key:"getNextSurveyStep",value:function(e,n,r){var i,s=e.questions[n],o=n+1;if((i=s.branching)===null||i===void 0||!i.type)return n===e.questions.length-1?ja.End:o;if(s.branching.type===ja.End)return ja.End;if(s.branching.type===ja.SpecificQuestion){if(Number.isInteger(s.branching.index))return s.branching.index}else if(s.branching.type===ja.ResponseBased){if(s.type===Wk.SingleChoice){var a,c,l=s.choices.indexOf("".concat(r));if((a=s.branching)!==null&&a!==void 0&&(c=a.responseValues)!==null&&c!==void 0&&c.hasOwnProperty(l)){var u=s.branching.responseValues[l];return Number.isInteger(u)?u:u===ja.End?ja.End:o}}else if(s.type===Wk.Rating){var d,f;if(typeof r!="number"||!Number.isInteger(r))throw new Error("The response type must be an integer");var p=function(v,S){if(S===3){if(v<1||v>3)throw new Error("The response must be in range 1-3");return v===1?"negative":v===2?"neutral":"positive"}if(S===5){if(v<1||v>5)throw new Error("The response must be in range 1-5");return v<=2?"negative":v===3?"neutral":"positive"}if(S===10){if(v<0||v>10)throw new Error("The response must be in range 0-10");return v<=6?"detractors":v<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")}(r,s.scale);if((d=s.branching)!==null&&d!==void 0&&(f=d.responseValues)!==null&&f!==void 0&&f.hasOwnProperty(p)){var m=s.branching.responseValues[p];return Number.isInteger(m)?m:m===ja.End?ja.End:o}}return o}return we.warn(f1,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return no(Wn.__PosthogExtensions__.canActivateRepeatedly)&&we.warn(f1,"canActivateRepeatedly is not defined, must init before calling"),Wn.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var n=this;no(this._surveyManager)?we.warn(f1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(r){var i=r.filter(function(s){return s.id===e})[0];n._surveyManager.canRenderSurvey(i)})}},{key:"renderSurvey",value:function(e,n){var r=this;no(this._surveyManager)?we.warn(f1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys(function(i){var s=i.filter(function(o){return o.id===e})[0];r._surveyManager.renderSurvey(s,We==null?void 0:We.querySelector(n))})}}]),t}(),zXe=function(){function t(e){var n,r,i=this;Wt(this,t),he(this,"serverLimits",{}),he(this,"lastEventRateLimited",!1),he(this,"checkForLimiting",function(s){var o=s.text;if(o&&o.length)try{(JSON.parse(o).quota_limited||[]).forEach(function(a){we.info("[RateLimiter] ".concat(a||"events"," is quota limited.")),i.serverLimits[a]=new Date().getTime()+6e4})}catch(a){return void we.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(a==null?void 0:a.message,'"'),{text:o})}}),this.instance=e,this.captureEventsPerSecond=((n=e.config.rate_limiting)===null||n===void 0?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)===null||r===void 0?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return Yt(t,[{key:"clientRateLimitContext",value:function(){var e,n,r,i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=new Date().getTime(),o=(e=(n=this.instance.persistence)===null||n===void 0?void 0:n.get_property(lL))!==null&&e!==void 0?e:{tokens:this.captureEventsBurstLimit,last:s};o.tokens+=(s-o.last)/1e3*this.captureEventsPerSecond,o.last=s,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var a=o.tokens<1;return a||i||(o.tokens=Math.max(0,o.tokens-1)),!a||this.lastEventRateLimited||i||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,(r=this.instance.persistence)===null||r===void 0||r.set_property(lL,o),{isRateLimited:a,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var n=this.serverLimits[e||"events"]||!1;return n!==!1&&new Date().getTime()<n}}]),t}(),WXe=function(){return Ue({initialPathName:(Ns==null?void 0:Ns.pathname)||"",referringDomain:ti.referringDomain()},ti.campaignParams())},YXe=function(){function t(e,n,r){var i=this;Wt(this,t),he(this,"_onSessionIdCallback",function(s){var o=i._getStoredProps();if(!o||o.sessionId!==s){var a={sessionId:s,props:i._sessionSourceParamGenerator()};i._persistence.register(he({},cL,a))}}),this._sessionIdManager=e,this._persistence=n,this._sessionSourceParamGenerator=r||WXe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return Yt(t,[{key:"_getStoredProps",value:function(){return this._persistence.props[cL]}},{key:"getSessionProps",value:function(){var e,n=(e=this._getStoredProps())===null||e===void 0?void 0:e.props;return n?{$client_session_initial_referring_host:n.referringDomain,$client_session_initial_pathname:n.initialPathName,$client_session_initial_utm_source:n.utm_source,$client_session_initial_utm_campaign:n.utm_campaign,$client_session_initial_utm_medium:n.utm_medium,$client_session_initial_utm_content:n.utm_content,$client_session_initial_utm_term:n.utm_term}:{}}}]),t}(),JXe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],gG=function(t,e){if(!t)return!1;var n=t.toLowerCase();return JXe.concat(e||[]).some(function(r){var i=r.toLowerCase();return n.indexOf(i)!==-1})},Ole=function(){function t(){Wt(this,t),this.clicks=[]}return Yt(t,[{key:"isRageClick",value:function(e,n,r){var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(n-i.y)<30&&r-i.timestamp<1e3){if(this.clicks.push({x:e,y:n,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:n,timestamp:r}];return!1}}]),t}();function mG(t){var e;return t.id===fL||!((e=t.closest)===null||e===void 0||!e.call(t,"#"+fL))}var XXe=function(){function t(e){var n,r=this;Wt(this,t),he(this,"rageclicks",new Ole),he(this,"_enabledServerSide",!1),he(this,"_initialized",!1),he(this,"_flushInterval",null),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[iL]),se==null||se.addEventListener("beforeunload",function(){r.flush()})}return Yt(t,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return Ri(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return Qe(this.instance.config.capture_heatmaps)?Qe(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;we.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval((e=this._flushInterval)!==null&&e!==void 0?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var n=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(he({},iL,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;se&&We&&(su(We,"click",function(n){return e._onClick(n||(se==null?void 0:se.event))},!1,!0),su(We,"mousemove",function(n){return e._onMouseMove(n||(se==null?void 0:se.event))},!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,n){var r=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),o=function(a,c,l){for(var u=a;u&&!nf(u,"body");){if(u===l)return!1;if($t(c,se==null?void 0:se.getComputedStyle(u).position))return!0;u=yle(u)}return!1}(e.target,["fixed","sticky"],s);return{x:e.clientX+(o?0:i),y:e.clientY+(o?0:r),target_fixed:o,type:n}}},{key:"_onClick",value:function(e){var n;if(!mG(e.target)){var r=this._getProperties(e,"click");(n=this.rageclicks)!==null&&n!==void 0&&n.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._capture(Ue(Ue({},r),{},{type:"rageclick"})),this._capture(r)}}},{key:"_onMouseMove",value:function(e){var n=this;mG(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout(function(){n._capture(n._getProperties(e,"mousemove"))},500))}},{key:"_capture",value:function(e){if(se){var n=se.location.href;this.buffer=this.buffer||{},this.buffer[n]||(this.buffer[n]=[]),this.buffer[n].push(e)}}},{key:"flush",value:function(){this.buffer&&!jT(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),t}(),ZXe=function(){function t(e){var n=this;Wt(this,t),he(this,"_updateScrollData",function(){var r,i,s,o;n.context||(n.context={});var a=n.scrollElement(),c=n.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,u=c+((a==null?void 0:a.clientHeight)||0),d=(a==null?void 0:a.scrollHeight)||0;n.context.lastScrollY=Math.ceil(c),n.context.maxScrollY=Math.max(c,(r=n.context.maxScrollY)!==null&&r!==void 0?r:0),n.context.maxScrollHeight=Math.max(l,(i=n.context.maxScrollHeight)!==null&&i!==void 0?i:0),n.context.lastContentY=u,n.context.maxContentY=Math.max(u,(s=n.context.maxContentY)!==null&&s!==void 0?s:0),n.context.maxContentHeight=Math.max(d,(o=n.context.maxContentHeight)!==null&&o!==void 0?o:0)}),this.instance=e}return Yt(t,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){se==null||se.addEventListener("scroll",this._updateScrollData,!0),se==null||se.addEventListener("scrollend",this._updateScrollData,!0),se==null||se.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return se==null?void 0:se.document.documentElement;var e,n=Pa(qr(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=se==null?void 0:se.document.querySelector(r);if(i)return i}}catch(s){n.e(s)}finally{n.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return se&&(se.scrollY||se.pageYOffset||se.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return se&&(se.scrollX||se.pageXOffset||se.document.documentElement.scrollLeft)||0}}]),t}(),FO="$copy_autocapture";function BO(t,e){return e.length>t?e.slice(0,t)+"...":e}var Sd,QXe=function(){function t(e){Wt(this,t),he(this,"_initialized",!1),he(this,"_isDisabledServerSide",null),he(this,"rageclicks",new Ole),he(this,"_elementsChainAsString",!1),this.instance=e,this._elementSelectors=null}return Yt(t,[{key:"config",get:function(){var e,n,r=Ri(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)===null||e===void 0?void 0:e.map(function(i){return new RegExp(i)}),r.url_ignorelist=(n=r.url_ignorelist)===null||n===void 0?void 0:n.map(function(i){return new RegExp(i)}),r}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(se&&We){var n=function(i){i=i||(se==null?void 0:se.event);try{e._captureEvent(i)}catch(s){we.error("Failed to capture event",s)}},r=function(i){i=i||(se==null?void 0:se.event),e._captureEvent(i,FO)};su(We,"submit",n,!1,!0),su(We,"change",n,!1,!0),su(We,"click",n,!1,!0),this.config.capture_copied_text&&(su(We,"copy",r,!1,!0),su(We,"cut",r,!1,!0))}}else we.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(he({},Nq,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var n,r=[];return(n=this._elementSelectors)===null||n===void 0||n.forEach(function(i){var s=We==null?void 0:We.querySelectorAll(i);s==null||s.forEach(function(o){e===o&&r.push(i)})}),r}},{key:"isEnabled",get:function(){var e,n,r=(e=this.instance.persistence)===null||e===void 0?void 0:e.props[Nq],i=this._isDisabledServerSide;if(Vu(i)&&!kh(r)&&!this.instance.config.advanced_disable_decide)return!1;var s=(n=this._isDisabledServerSide)!==null&&n!==void 0?n:!!r;return!!this.instance.config.autocapture&&!s}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var n=e;do n=n.previousSibling;while(n&&!YN(n));return n}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!_L(e))return{};var n={};return Tn(e.attributes,function(r){if(r.name&&r.name.indexOf("data-ph-capture-attribute")===0){var i=r.name.replace("data-ph-capture-attribute-",""),s=r.value;i&&s&&Km(s)&&(n[i]=s)}}),n}},{key:"_getPropertiesFromElement",value:function(e,n,r){var i,s=e.tagName.toLowerCase(),o={tag_name:s};yL.indexOf(s)>-1&&!r&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?o.$el_text=BO(1024,nG(e)):o.$el_text=BO(1024,qk(e)));var a=Vk(e);a.length>0&&(o.classes=a.filter(function(f){return f!==""}));var c=(i=this.config)===null||i===void 0?void 0:i.element_attribute_ignorelist;Tn(e.attributes,function(f){var p;if((!_le(e)||["name","id","class","aria-label"].indexOf(f.name)!==-1)&&(c==null||!c.includes(f.name))&&!n&&Km(f.value)&&(p=f.name,!Xi(p)||p.substring(0,10)!=="_ngcontent"&&p.substring(0,7)!=="_nghost")){var m=f.value;f.name==="class"&&(m=WN(m).join(" ")),o["attr__"+f.name]=BO(1024,m)}});for(var l=1,u=1,d=e;d=this._previousElementSibling(d);)l++,d.tagName===e.tagName&&u++;return o.nth_child=l,o.nth_of_type=u,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return Qe(e.target)?e.srcElement||null:(n=e.target)!==null&&n!==void 0&&n.shadowRoot?e.composedPath()[0]||null:e.target||null;var n}},{key:"_captureEvent",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"$autocapture";if(this.isEnabled){var i,s=this._getEventTarget(e);mle(s)&&(s=s.parentNode||null),r==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(i=this.rageclicks)!==null&&i!==void 0&&i.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._captureEvent(e,"$rageclick");var o=r===FO;if(s&&cXe(s,e,this.config,o,o?["copy","cut"]:void 0)){for(var a,c,l=[s],u=s;u.parentNode&&!nf(u,"body");)vle(u.parentNode)?(l.push(u.parentNode.host),u=u.parentNode.host):(l.push(u.parentNode),u=u.parentNode);var d,f,p=[],m={},v=!1;if(Tn(l,function(U){var N=_L(U);U.tagName.toLowerCase()==="a"&&(d=U.getAttribute("href"),d=N&&Km(d)&&d),$t(Vk(U),"ph-no-capture")&&(v=!0),p.push(n._getPropertiesFromElement(U,n.instance.config.mask_all_element_attributes,n.instance.config.mask_all_text));var L=n._getAugmentPropertiesFromElement(U);ds(m,L)}),this.instance.config.mask_all_text||(s.tagName.toLowerCase()==="a"||s.tagName.toLowerCase()==="button"?p[0].$el_text=nG(s):p[0].$el_text=qk(s)),d){var S,_;p[0].attr__href=d;var w=(S=I0(d))===null||S===void 0?void 0:S.host,T=se==null||(_=se.location)===null||_===void 0?void 0:_.host;w&&T&&w!==T&&(f=d)}if(v)return!1;var C=ds(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:hXe(p)}:{$elements:p},(a=p[0])!==null&&a!==void 0&&a.$el_text?{$el_text:(c=p[0])===null||c===void 0?void 0:c.$el_text}:{},f&&e.type==="click"?{$external_click_url:f}:{},m),I=this.getElementSelectors(s);if(I&&I.length>0&&(C.$element_selectors=I),r===FO){var R,O=gle(se==null||(R=se.getSelection())===null||R===void 0?void 0:R.toString()),A=e.type||"clipboard";if(!O)return!1;C.$selected_content=O,C.$copy_type=A}return this.instance.capture(r,C),!0}}}},{key:"isBrowserSupported",value:function(){return ma(We==null?void 0:We.querySelectorAll)}}]),t}(),eZe=function(){function t(e){var n=this;Wt(this,t),he(this,"_restoreXHRPatch",void 0),he(this,"_restoreFetchPatch",void 0),he(this,"_startCapturing",function(){Qe(n._restoreXHRPatch)&&Wn.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),Qe(n._restoreFetchPatch)&&Wn.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)}),this.instance=e}return Yt(t,[{key:"_loadScript",value:function(e){Wn.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(sa.LIB_VERSION),function(n){if(n)return we.error("[TRACING-HEADERS] failed to load script",n);e()})}},{key:"startIfEnabledOrStop",value:function(){var e,n;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):((e=this._restoreXHRPatch)===null||e===void 0||e.call(this),(n=this._restoreFetchPatch)===null||n===void 0||n.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),t}();(function(t){t[t.PENDING=-1]="PENDING",t[t.DENIED=0]="DENIED",t[t.GRANTED=1]="GRANTED"})(Sd||(Sd={}));var tZe=function(){function t(e){Wt(this,t),this.instance=e}return Yt(t,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?Sd.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===Sd.DENIED||this.consent===Sd.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,n=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+n}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return e==="1"?Sd.GRANTED:e==="0"?Sd.DENIED:Sd.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage=e==="localStorage"?Vr:_u;var n=e==="localStorage"?_u:Vr;n.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut(n.get(this.storageKey)==="1"),n.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!Xce([sc==null?void 0:sc.doNotTrack,sc==null?void 0:sc.msDoNotTrack,Wn.doNotTrack],function(e){return $t([!0,1,"1","yes"],e)})}}]),t}(),hE="[Exception Autocapture]",nZe=function(){function t(e){var n,r=this;Wt(this,t),he(this,"originalOnUnhandledRejectionHandler",void 0),he(this,"startCapturing",function(){if(se&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var i=se.posthogErrorWrappingFunctions.wrapOnError,s=se.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(i&&s)try{r.unwrapOnError=i(r.captureException.bind(r)),r.unwrapUnhandledRejection=s(r.captureException.bind(r))}catch(o){we.error(hE+" failed to start",o),r.stopCapturing()}else we.error(hE+" failed to load error wrapping functions - cannot start")}}),this.instance=e,this.remoteEnabled=!((n=this.instance.persistence)===null||n===void 0||!n.props[Uq]),this.startIfEnabled()}return Yt(t,[{key:"isEnabled",get:function(){var e;return(e=this.remoteEnabled)!==null&&e!==void 0&&e}},{key:"isCapturing",get:function(){var e;return!(se==null||(e=se.onerror)===null||e===void 0||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(we.info(hE+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(sa.LIB_VERSION),function(n){if(n)return we.error(hE+" failed to load script",n);e()})}},{key:"stopCapturing",value:function(){var e,n;(e=this.unwrapOnError)===null||e===void 0||e.call(this),(n=this.unwrapUnhandledRejection)===null||n===void 0||n.call(this)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this.remoteEnabled=!!n||!1,this.instance.persistence&&this.instance.persistence.register(he({},Uq,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var n=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(n,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),t}(),vG=9e5,th="[Web Vitals]",rZe=function(){function t(e){var n,r=this;Wt(this,t),he(this,"_enabledServerSide",!1),he(this,"_initialized",!1),he(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),he(this,"_flushToCapture",function(){clearTimeout(r._delayedFlushTimer),r.buffer.metrics.length!==0&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce(function(i,s){var o;return Ue(Ue({},i),{},(he(o={},"$web_vitals_".concat(s.name,"_event"),Ue({},s)),he(o,"$web_vitals_".concat(s.name,"_value"),s.value),o))},{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})}),he(this,"_addToBuffer",function(i){var s,o=(s=r.instance.sessionManager)===null||s===void 0?void 0:s.checkAndGetSessionAndWindowId(!0);if(Qe(o))we.error(th+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=r._currentURL();Qe(a)||(no(i==null?void 0:i.name)||no(i==null?void 0:i.value)?we.error(th+"Invalid metric received",i):r._maxAllowedValue&&i.value>=r._maxAllowedValue?we.error(th+"Ignoring metric with value >= "+r._maxAllowedValue,i):(r.buffer.url!==a&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),Qe(r.buffer.url)&&(r.buffer.url=a),r.buffer.firstMetricTimestamp=Qe(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push(Ue(Ue({},i),{},{$current_url:a,$session_id:o.sessionId,$window_id:o.windowId,timestamp:Date.now()})),r.buffer.metrics.length===4&&r._flushToCapture()))}}),he(this,"_startCapturing",function(){var i=Wn.postHogWebVitalsCallbacks,s=i.onLCP,o=i.onCLS,a=i.onFCP,c=i.onINP;s&&o&&a&&c?(s(r._addToBuffer),o(r._addToBuffer),a(r._addToBuffer),c(r._addToBuffer),r._initialized=!0):we.error(th+"web vitals callbacks not loaded - not starting")}),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[Fq]),this.startIfEnabled()}return Yt(t,[{key:"_maxAllowedValue",get:function(){var e=Ri(this.instance.config.capture_performance)&&oa(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:vG;return 0<e&&e<=6e4?vG:e}},{key:"isEnabled",get:function(){var e=Ri(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return kh(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(we.info(th+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var n=Ri(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(he({},Fq,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"loadScript",value:function(e){se.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(sa.LIB_VERSION),function(n){n?we.error(th+" failed to load script",n):e()})}},{key:"_currentURL",value:function(){var e=se?se.location.href:void 0;return e||we.error(th+"Could not determine current URL"),e}}]),t}(),yG="/e/",iZe=function(){function t(e){var n;Wt(this,t),this.instance=e,this._endpointSuffix=((n=this.instance.persistence)===null||n===void 0?void 0:n.props[$q])||yG}return Yt(t,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this._endpointSuffix=Ri(n)&&n.endpoint||yG,this.instance.persistence&&this.instance.persistence.register(he({},$q,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),t}(),O0={},_G=function(){},$g="posthog",Mle=!DXe&&(Zr==null?void 0:Zr.indexOf("MSIE"))===-1&&(Zr==null?void 0:Zr.indexOf("Mozilla"))===-1,bG=function(){var t,e,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(e=We==null?void 0:We.location,n=e==null?void 0:e.hostname,!!Xi(n)&&n.split(".").slice(-2).join(".")!=="herokuapp.com"),persistence:"localStorage+cookie",persistence_name:"",loaded:_G,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:Ns&&Xi(Ns==null?void 0:Ns.search)&&Ns.search.indexOf("__posthog_debug=true")!==-1||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:(se==null||(t=se.location)===null||t===void 0?void 0:t.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(r){var i="Bad HTTP status: "+r.statusCode+" "+r.text;we.error(i)},get_device_id:function(r){return r},_onCapture:_G,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},SG=function(t){var e={};Qe(t.process_person)||(e.person_profiles=t.process_person),Qe(t.xhr_headers)||(e.request_headers=t.xhr_headers),Qe(t.cookie_name)||(e.persistence_name=t.cookie_name),Qe(t.disable_cookie)||(e.disable_persistence=t.disable_cookie);var n=ds({},e,t);return qr(t.property_blacklist)&&(Qe(t.property_denylist)?n.property_denylist=t.property_blacklist:qr(t.property_denylist)?n.property_denylist=[].concat(yu(t.property_blacklist),yu(t.property_denylist)):we.error("Invalid value for property_denylist config: "+t.property_denylist)),n},sZe=function(){function t(){Wt(this,t),he(this,"__forceAllowLocalhost",!1)}return Yt(t,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){we.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),t}(),Ale=function(){function t(){var e=this;Wt(this,t),he(this,"webPerformance",new sZe),he(this,"version",sa.LIB_VERSION),he(this,"_internalEventEmitter",new Ple),this.config=bG(),this.decideEndpointWasHit=!1,this.SentryIntegration=jXe,this.sentryIntegration=function(n){return function(r,i){var s=xle(r,i);return{name:Ile,processEvent:function(o){return s(o)}}}(e,n)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new UJe(this),this.toolbar=new CXe(this),this.scrollManager=new ZXe(this),this.pageViewManager=new KXe(this),this.surveys=new GXe(this),this.exceptions=new iZe(this),this.rateLimiter=new zXe(this),this.requestRouter=new BXe(this),this.consent=new tZe(this),this.people={set:function(n,r,i){var s=Xi(n)?he({},n,r):n;e.setPersonProperties(s),i==null||i({})},set_once:function(n,r,i){var s=Xi(n)?he({},n,r):n;e.setPersonProperties(void 0,s),i==null||i({})}},this.on("eventCaptured",function(n){return we.info("send",n)})}return Yt(t,[{key:"init",value:function(e,n,r){if(r&&r!==$g){var i,s=(i=O0[r])!==null&&i!==void 0?i:new t;return s._init(e,n,r),O0[r]=s,O0[$g][r]=s,s}return this._init(e,n,r)}},{key:"_init",value:function(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(Qe(e)||Pq(e))return we.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return we.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(ds({},bG(),SG(s),{name:o,token:e})),this.config.on_xhr_error&&we.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=s.disable_compression?void 0:rc.GZipJS,this.persistence=new DO(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new DO(Ue(Ue({},this.config),{},{persistence:"sessionStorage"}));var a=Ue({},this.persistence.props),c=Ue({},this.sessionPersistence.props);if(this._requestQueue=new kXe(function(w){return i._send_retriable_request(w)}),this._retryQueue=new $Xe(this),this.__request_queue=[],this.sessionManager=new FXe(this.config,this.persistence),this.sessionPropsManager=new YXe(this.sessionManager,this.persistence),new eZe(this).startIfEnabledOrStop(),this.sessionRecording=new wXe(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new QXe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new XXe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new rZe(this),this.exceptionObserver=new nZe(this),this.exceptionObserver.startIfEnabled(),sa.DEBUG=sa.DEBUG||this.config.debug,sa.DEBUG&&we.info("Starting in debug mode",{this:this,config:s,thisC:Ue({},this.config),p:a,s:c}),this._sync_opt_out_with_persistence(),((n=s.bootstrap)===null||n===void 0?void 0:n.distinctID)!==void 0){var l,u,d=this.config.get_device_id(Nd()),f=(l=s.bootstrap)!==null&&l!==void 0&&l.isIdentifiedID?d:s.bootstrap.distinctID;this.persistence.set_property(ql,(u=s.bootstrap)!==null&&u!==void 0&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:s.bootstrap.distinctID,$device_id:f})}if(this._hasBootstrappedFeatureFlags()){var p,m,v=Object.keys(((p=s.bootstrap)===null||p===void 0?void 0:p.featureFlags)||{}).filter(function(w){var T,C;return!((T=s.bootstrap)===null||T===void 0||(C=T.featureFlags)===null||C===void 0||!C[w])}).reduce(function(w,T){var C,I;return w[T]=((C=s.bootstrap)===null||C===void 0||(I=C.featureFlags)===null||I===void 0?void 0:I[T])||!1,w},{}),S=Object.keys(((m=s.bootstrap)===null||m===void 0?void 0:m.featureFlagPayloads)||{}).filter(function(w){return v[w]}).reduce(function(w,T){var C,I,R,O;return(C=s.bootstrap)!==null&&C!==void 0&&(I=C.featureFlagPayloads)!==null&&I!==void 0&&I[T]&&(w[T]=(R=s.bootstrap)===null||R===void 0||(O=R.featureFlagPayloads)===null||O===void 0?void 0:O[T]),w},{});this.featureFlags.receivedFeatureFlags({featureFlags:v,featureFlagPayloads:S})}if(!this.get_distinct_id()){var _=this.config.get_device_id(Nd());this.register_once({distinct_id:_,$device_id:_},""),this.persistence.set_property(ql,"anonymous")}return se==null||(r=se.addEventListener)===null||r===void 0||r.call(se,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),s.segment?HXe(this,function(){return i._loaded()}):this._loaded(),ma(this.config._onCapture)&&this.on("eventCaptured",function(w){return i.config._onCapture(w.event,w)}),this}},{key:"_afterDecideResponse",value:function(e){var n,r,i,s,o,a,c,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=$t(e.supportedCompression,rc.GZipJS)?rc.GZipJS:$t(e.supportedCompression,rc.Base64)?rc.Base64:void 0),(n=e.analytics)!==null&&n!==void 0&&n.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),(r=this.sessionRecording)===null||r===void 0||r.afterDecideResponse(e),(i=this.autocapture)===null||i===void 0||i.afterDecideResponse(e),(s=this.heatmaps)===null||s===void 0||s.afterDecideResponse(e),(o=this.surveys)===null||o===void 0||o.afterDecideResponse(e),(a=this.webVitalsAutocapture)===null||a===void 0||a.afterDecideResponse(e),(c=this.exceptions)===null||c===void 0||c.afterDecideResponse(e),(l=this.exceptionObserver)===null||l===void 0||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,n=this.config.advanced_disable_decide;n||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(r){we.critical("`loaded` function failed",r)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout(function(){e.consent.isOptedIn()&&e._captureInitialPageview()},1),n||(new EXe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this._requestQueue)===null||e===void 0||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||Bm(this.__request_queue,function(n){return e._send_retriable_request(n)}),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,n;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),(e=this._requestQueue)===null||e===void 0||e.unload(),(n=this._retryQueue)===null||n===void 0||n.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var n=this;this.__loaded&&(Mle?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=zk(e.url,{ip:this.config.ip?1:0}),e.headers=Ue({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,function(r){var i,s,o,a=Ue({},r);a.timeout=a.timeout||6e4,a.url=zk(a.url,{_:new Date().getTime().toString(),ver:sa.LIB_VERSION,compression:a.compression});var c=(i=a.transport)!==null&&i!==void 0?i:"XHR",l=(s=(o=Xce(P0,function(u){return u.transport===c}))===null||o===void 0?void 0:o.method)!==null&&s!==void 0?s:P0[0].method;if(!l)throw new Error("No available transport method");l(a)}(Ue(Ue({},e),{},{callback:function(r){var i,s,o;n.rateLimiter.checkForLimiting(r),r.statusCode>=400&&((s=(o=n.config).on_request_error)===null||s===void 0||s.call(o,r)),(i=e.callback)===null||i===void 0||i.call(e,r)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var n,r=this,i=[],s=[],o=[];Bm(e,function(c){c&&(n=c[0],qr(n)?o.push(c):ma(c)?c.call(r):qr(c)&&n==="alias"?i.push(c):qr(c)&&n.indexOf("capture")!==-1&&ma(r[n])?o.push(c):s.push(c))});var a=function(c,l){Bm(c,function(u){if(qr(u[0])){var d=l;Tn(u,function(f){d=d[f[0]].apply(d,f.slice(1))})}else this[u[0]].apply(this,u.slice(1))},l)};a(i,this),a(s,this),a(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,n;return((e=this.config.bootstrap)===null||e===void 0?void 0:e.featureFlags)&&Object.keys((n=this.config.bootstrap)===null||n===void 0?void 0:n.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,n,r){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!Qe(e)&&Xi(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var s=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(s==null||!s.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,a=(r==null?void 0:r.timestamp)||o,c={uuid:Nd(),event:e,properties:this._calculate_event_properties(e,n||{},a)};s&&(c.properties.$lib_rate_limit_remaining_tokens=s.remainingTokens),r!=null&&r.$set&&(c.$set=r==null?void 0:r.$set);var l=this._calculate_set_once_properties(r==null?void 0:r.$set_once);l&&(c.$set_once=l),(c=LJe(c,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=a,Qe(r==null?void 0:r.timestamp)||(c.properties.$event_time_override_provided=!0,c.properties.$event_time_override_system_time=o);var u=Ue(Ue({},c.properties.$set),c.$set);jT(u)||this.setPersonPropertiesForFlags(u),this._internalEventEmitter.emit("eventCaptured",c);var d={method:"POST",url:(i=r==null?void 0:r._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:c,compression:"best-available",batchKey:r==null?void 0:r._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this._send_retriable_request(d):this._requestQueue.enqueue(d),c}we.critical("This capture call is ignored due to client rate limiting.")}}else we.error("No event name provided to posthog.capture")}else we.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",function(n){return e(n.event,n)})}},{key:"_calculate_event_properties",value:function(e,n,r){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return n;var i=this.persistence.remove_event_timer(e),s=Ue({},n);if(s.token=this.config.token,e==="$snapshot"){var o=Ue(Ue({},this.persistence.properties()),this.sessionPersistence.properties());return s.distinct_id=o.distinct_id,(!Xi(s.distinct_id)&&!oa(s.distinct_id)||Pq(s.distinct_id))&&we.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),s}var a=ti.properties();if(this.sessionManager){var c=this.sessionManager.checkAndGetSessionAndWindowId(),l=c.sessionId,u=c.windowId;s.$session_id=l,s.$window_id=u}if(this.requestRouter.region===Rh.CUSTOM&&(s.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&(e==="$pageview"||e==="$pageleave"||e==="$autocapture")){var d=this.sessionPropsManager.getSessionProps();s=ds(s,d)}if(!this.config.disable_scroll_properties){var f={};e==="$pageview"?f=this.pageViewManager.doPageView(r):e==="$pageleave"&&(f=this.pageViewManager.doPageLeave(r)),s=ds(s,f)}if(e==="$pageview"&&We&&(s.title=We.title),!Qe(i)){var p=r.getTime()-i;s.$duration=parseFloat((p/1e3).toFixed(3))}Zr&&this.config.opt_out_useragent_filter&&(s.$browser_type=this._is_bot()?"bot":"browser"),(s=ds({},a,this.persistence.properties(),this.sessionPersistence.properties(),s)).$is_identified=this._isIdentified(),qr(this.config.property_denylist)?Tn(this.config.property_denylist,function(v){delete s[v]}):we.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var m=this.config.sanitize_properties;return m&&(s=m(s,e)),s.$process_person_profile=this._hasPersonProcessing(),s}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var n=ds({},this.persistence.get_initial_props(),e||{});return jT(n)?void 0:n}},{key:"register",value:function(e,n){var r;(r=this.persistence)===null||r===void 0||r.register(e,n)}},{key:"register_once",value:function(e,n,r){var i;(i=this.persistence)===null||i===void 0||i.register_once(e,n,r)}},{key:"register_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.register(e)}},{key:"unregister",value:function(e){var n;(n=this.persistence)===null||n===void 0||n.unregister(e)}},{key:"unregister_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.unregister(e)}},{key:"_register_single",value:function(e,n){this.register(he({},e,n))}},{key:"getFeatureFlag",value:function(e,n){return this.featureFlags.getFeatureFlag(e,n)}},{key:"getFeatureFlagPayload",value:function(e){var n=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(n)}catch{return n}}},{key:"isFeatureEnabled",value:function(e,n){return this.featureFlags.isFeatureEnabled(e,n)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,n)}},{key:"getEarlyAccessFeatures",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,n)}},{key:"on",value:function(e,n){return this._internalEventEmitter.on(e,n)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var n,r;return(n=(r=this.sessionManager)===null||r===void 0?void 0:r.onSessionId(e))!==null&&n!==void 0?n:function(){}}},{key:"getSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getSurveys(e,n)}},{key:"getActiveMatchingSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getActiveMatchingSurveys(e,n)}},{key:"renderSurvey",value:function(e,n){this.surveys.renderSurvey(e,n)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,n,r){return this.surveys.getNextSurveyStep(e,n,r)}},{key:"identify",value:function(e,n,r){if(!this.__loaded||!this.persistence)return we.uninitializedWarning("posthog.identify");if(oa(e)&&(e=e.toString(),we.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))we.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var s=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:s},"")}e!==i&&e!==this.get_property(j1)&&(this.unregister(j1),this.register({distinct_id:e}));var o=(this.persistence.get_property(ql)||"anonymous")==="anonymous";e!==i&&o?(this.persistence.set_property(ql,"identified"),this.setPersonPropertiesForFlags(n||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:n||{},$set_once:r||{}}),this.featureFlags.setAnonymousDistinctId(i)):(n||r)&&this.setPersonProperties(n,r),e!==i&&(this.reloadFeatureFlags(),this.unregister(Fk))}}else we.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,n){(e||n)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:n||{}}))}},{key:"group",value:function(e,n,r){if(e&&n){if(this._requirePersonProcessing("posthog.group")){var i=this.getGroups();i[e]!==n&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Ue(Ue({},i),{},he({},e,n))}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:n,$group_set:r}),this.setGroupPropertiesForFlags(he({},e,r))),i[e]===n||r||this.reloadFeatureFlags()}}else we.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,n)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,n)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var n,r,i,s;if(we.info("reset"),!this.__loaded)return we.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),(n=this.persistence)===null||n===void 0||n.clear(),(r=this.sessionPersistence)===null||r===void 0||r.clear(),(i=this.persistence)===null||i===void 0||i.set_property(ql,"anonymous"),(s=this.sessionManager)===null||s===void 0||s.resetSessionId();var a=this.config.get_device_id(Nd());this.register_once({distinct_id:a,$device_id:e?a:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,n;return(e=(n=this.sessionManager)===null||n===void 0?void 0:n.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var n=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=n.sessionId,i=n.sessionStartTimestamp,s=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(r));if(e!=null&&e.withTimestamp&&i){var o,a=(o=e.timestampLookBack)!==null&&o!==void 0?o:10;if(!i)return s;var c=Math.max(Math.floor((new Date().getTime()-i)/1e3)-a,0);s+="?t=".concat(c)}return s}},{key:"alias",value:function(e,n){return e===this.get_property(Zce)?(we.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(Qe(n)&&(n=this.get_distinct_id()),e!==n?(this._register_single(j1,e),this.capture("$create_alias",{alias:e,distinct_id:n})):(we.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var n,r,i,s,o=Ue({},this.config);Ri(e)&&(ds(this.config,SG(e)),(n=this.persistence)===null||n===void 0||n.update_config(this.config,o),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new DO(Ue(Ue({},this.config),{},{persistence:"sessionStorage"})),Vr.is_supported()&&Vr.get("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(sa.DEBUG=!0,we.info("set_config",{config:e,oldConfig:o,newConfig:Ue({},this.config)})),(r=this.sessionRecording)===null||r===void 0||r.startIfEnabledOrStop(),(i=this.autocapture)===null||i===void 0||i.startIfEnabled(),(s=this.heatmaps)===null||s===void 0||s.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var n,r=kh(e)&&e;if(r||e!=null&&e.sampling){var i,s,o=(i=this.sessionManager)===null||i===void 0?void 0:i.checkAndGetSessionAndWindowId();(s=this.persistence)===null||s===void 0||s.register(he({},R0,!0)),we.info("Session recording started with sampling override for session: ",o==null?void 0:o.sessionId)}(r||e!=null&&e.linked_flag)&&((n=this.sessionRecording)===null||n===void 0||n.overrideLinkedFlag(),we.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!((e=this.sessionRecording)===null||e===void 0||!e.started)}},{key:"captureException",value:function(e,n){var r=ma(Wn.parseErrorAsProperties)?Wn.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):Ue({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},n);this.exceptions.sendExceptionEvent(r)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var n;return(n=this.persistence)===null||n===void 0?void 0:n.props[e]}},{key:"getSessionProperty",value:function(e){var n;return(n=this.sessionPersistence)===null||n===void 0?void 0:n.props[e]}},{key:"toString",value:function(){var e,n=(e=this.config.name)!==null&&e!==void 0?e:$g;return n!==$g&&(n=$g+"."+n),n}},{key:"_isIdentified",value:function(){var e,n;return((e=this.persistence)===null||e===void 0?void 0:e.get_property(ql))==="identified"||((n=this.sessionPersistence)===null||n===void 0?void 0:n.get_property(ql))==="identified"}},{key:"_hasPersonProcessing",value:function(){var e,n,r,i;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&jT(this.getGroups())&&((e=this.persistence)===null||e===void 0||(n=e.props)===null||n===void 0||!n[j1])&&((r=this.persistence)===null||r===void 0||(i=r.props)===null||i===void 0||!i[Bk]))}},{key:"_shouldCapturePageleave",value:function(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return this.config.person_profiles==="never"?(we.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(Bk,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,n,r,i,s=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,a=this.config.disable_persistence||s&&!!o;((e=this.persistence)===null||e===void 0?void 0:e.disabled)!==a&&((r=this.persistence)===null||r===void 0||r.set_disabled(a)),((n=this.sessionPersistence)===null||n===void 0?void 0:n.disabled)!==a&&((i=this.sessionPersistence)===null||i===void 0||i.set_disabled(a))}},{key:"opt_in_capturing",value:function(e){var n;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(Qe(e==null?void 0:e.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e==null?void 0:e.captureEventName)!==null&&n!==void 0?n:"$opt_in",e==null?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return sc?function(e,n){if(!e)return!1;var r=e.userAgent;if(r&&gG(r,n))return!0;try{var i=e==null?void 0:e.userAgentData;if(i!=null&&i.brands&&i.brands.some(function(s){return gG(s==null?void 0:s.brand,n)}))return!0}catch{}return!!e.webdriver}(sc,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){We&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:We.title},{send_instantly:!0}))}},{key:"debug",value:function(e){e===!1?(se==null||se.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(se==null||se.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),t}();(function(t,e){for(var n=0;n<e.length;n++)t.prototype[e[n]]=AJe(t.prototype[e[n]])})(Ale,["identify"]);var wG,oZe=(wG=O0[$g]=new Ale,function(){function t(){t.done||(t.done=!0,Mle=!1,Tn(O0,function(e){e._dom_loaded()}))}We!=null&&We.addEventListener&&(We.readyState==="complete"?t():We.addEventListener("DOMContentLoaded",t,!1)),se&&su(se,"load",t,!0)}(),wG),Lle={},dI={};dI.byteLength=lZe;dI.toByteArray=dZe;dI.fromByteArray=pZe;var Jc=[],Zo=[],aZe=typeof Uint8Array<"u"?Uint8Array:Array,jO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var wg=0,cZe=jO.length;wg<cZe;++wg)Jc[wg]=jO[wg],Zo[jO.charCodeAt(wg)]=wg;Zo[45]=62;Zo[95]=63;function Dle(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function lZe(t){var e=Dle(t),n=e[0],r=e[1];return(n+r)*3/4-r}function uZe(t,e,n){return(e+n)*3/4-n}function dZe(t){var e,n=Dle(t),r=n[0],i=n[1],s=new aZe(uZe(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=Zo[t.charCodeAt(c)]<<18|Zo[t.charCodeAt(c+1)]<<12|Zo[t.charCodeAt(c+2)]<<6|Zo[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Zo[t.charCodeAt(c)]<<2|Zo[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Zo[t.charCodeAt(c)]<<10|Zo[t.charCodeAt(c+1)]<<4|Zo[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function fZe(t){return Jc[t>>18&63]+Jc[t>>12&63]+Jc[t>>6&63]+Jc[t&63]}function hZe(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(fZe(r));return i.join("")}function pZe(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(hZe(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(Jc[e>>2]+Jc[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Jc[e>>10]+Jc[e>>4&63]+Jc[e<<2&63]+"=")),i.join("")}var ZN={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ZN.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,p=t[e+d];for(d+=f,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+d],d+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(p?-1:1)*o*Math.pow(2,s-r)};ZN.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,d=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,m=r?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=f/c:e+=f*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+p]=a&255,p+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+p]=o&255,p+=m,o/=256,l-=8);t[n+p-m]|=v*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=dI,n=ZN,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=w,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const $=new Uint8Array(1),x={foo:function(){return 42}};return Object.setPrototypeOf(x,Uint8Array.prototype),Object.setPrototypeOf($,x),$.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o($){if($>i)throw new RangeError('The value "'+$+'" is invalid for option "size"');const x=new Uint8Array($);return Object.setPrototypeOf(x,a.prototype),x}function a($,x,M){if(typeof $=="number"){if(typeof x=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d($)}return c($,x,M)}a.poolSize=8192;function c($,x,M){if(typeof $=="string")return f($,x);if(ArrayBuffer.isView($))return m($);if($==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $);if(dn($,ArrayBuffer)||$&&dn($.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(dn($,SharedArrayBuffer)||$&&dn($.buffer,SharedArrayBuffer)))return v($,x,M);if(typeof $=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const q=$.valueOf&&$.valueOf();if(q!=null&&q!==$)return a.from(q,x,M);const ee=S($);if(ee)return ee;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof $[Symbol.toPrimitive]=="function")return a.from($[Symbol.toPrimitive]("string"),x,M);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $)}a.from=function($,x,M){return c($,x,M)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l($){if(typeof $!="number")throw new TypeError('"size" argument must be of type number');if($<0)throw new RangeError('The value "'+$+'" is invalid for option "size"')}function u($,x,M){return l($),$<=0?o($):x!==void 0?typeof M=="string"?o($).fill(x,M):o($).fill(x):o($)}a.alloc=function($,x,M){return u($,x,M)};function d($){return l($),o($<0?0:_($)|0)}a.allocUnsafe=function($){return d($)},a.allocUnsafeSlow=function($){return d($)};function f($,x){if((typeof x!="string"||x==="")&&(x="utf8"),!a.isEncoding(x))throw new TypeError("Unknown encoding: "+x);const M=T($,x)|0;let q=o(M);const ee=q.write($,x);return ee!==M&&(q=q.slice(0,ee)),q}function p($){const x=$.length<0?0:_($.length)|0,M=o(x);for(let q=0;q<x;q+=1)M[q]=$[q]&255;return M}function m($){if(dn($,Uint8Array)){const x=new Uint8Array($);return v(x.buffer,x.byteOffset,x.byteLength)}return p($)}function v($,x,M){if(x<0||$.byteLength<x)throw new RangeError('"offset" is outside of buffer bounds');if($.byteLength<x+(M||0))throw new RangeError('"length" is outside of buffer bounds');let q;return x===void 0&&M===void 0?q=new Uint8Array($):M===void 0?q=new Uint8Array($,x):q=new Uint8Array($,x,M),Object.setPrototypeOf(q,a.prototype),q}function S($){if(a.isBuffer($)){const x=_($.length)|0,M=o(x);return M.length===0||$.copy(M,0,0,x),M}if($.length!==void 0)return typeof $.length!="number"||Xe($.length)?o(0):p($);if($.type==="Buffer"&&Array.isArray($.data))return p($.data)}function _($){if($>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return $|0}function w($){return+$!=$&&($=0),a.alloc(+$)}a.isBuffer=function(x){return x!=null&&x._isBuffer===!0&&x!==a.prototype},a.compare=function(x,M){if(dn(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),dn(M,Uint8Array)&&(M=a.from(M,M.offset,M.byteLength)),!a.isBuffer(x)||!a.isBuffer(M))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(x===M)return 0;let q=x.length,ee=M.length;for(let ae=0,ge=Math.min(q,ee);ae<ge;++ae)if(x[ae]!==M[ae]){q=x[ae],ee=M[ae];break}return q<ee?-1:ee<q?1:0},a.isEncoding=function(x){switch(String(x).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(x,M){if(!Array.isArray(x))throw new TypeError('"list" argument must be an Array of Buffers');if(x.length===0)return a.alloc(0);let q;if(M===void 0)for(M=0,q=0;q<x.length;++q)M+=x[q].length;const ee=a.allocUnsafe(M);let ae=0;for(q=0;q<x.length;++q){let ge=x[q];if(dn(ge,Uint8Array))ae+ge.length>ee.length?(a.isBuffer(ge)||(ge=a.from(ge)),ge.copy(ee,ae)):Uint8Array.prototype.set.call(ee,ge,ae);else if(a.isBuffer(ge))ge.copy(ee,ae);else throw new TypeError('"list" argument must be an Array of Buffers');ae+=ge.length}return ee};function T($,x){if(a.isBuffer($))return $.length;if(ArrayBuffer.isView($)||dn($,ArrayBuffer))return $.byteLength;if(typeof $!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof $);const M=$.length,q=arguments.length>2&&arguments[2]===!0;if(!q&&M===0)return 0;let ee=!1;for(;;)switch(x){case"ascii":case"latin1":case"binary":return M;case"utf8":case"utf-8":return nn($).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M*2;case"hex":return M>>>1;case"base64":return Di($).length;default:if(ee)return q?-1:nn($).length;x=(""+x).toLowerCase(),ee=!0}}a.byteLength=T;function C($,x,M){let q=!1;if((x===void 0||x<0)&&(x=0),x>this.length||((M===void 0||M>this.length)&&(M=this.length),M<=0)||(M>>>=0,x>>>=0,M<=x))return"";for($||($="utf8");;)switch($){case"hex":return W(this,x,M);case"utf8":case"utf-8":return G(this,x,M);case"ascii":return J(this,x,M);case"latin1":case"binary":return K(this,x,M);case"base64":return X(this,x,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,x,M);default:if(q)throw new TypeError("Unknown encoding: "+$);$=($+"").toLowerCase(),q=!0}}a.prototype._isBuffer=!0;function I($,x,M){const q=$[x];$[x]=$[M],$[M]=q}a.prototype.swap16=function(){const x=this.length;if(x%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let M=0;M<x;M+=2)I(this,M,M+1);return this},a.prototype.swap32=function(){const x=this.length;if(x%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let M=0;M<x;M+=4)I(this,M,M+3),I(this,M+1,M+2);return this},a.prototype.swap64=function(){const x=this.length;if(x%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let M=0;M<x;M+=8)I(this,M,M+7),I(this,M+1,M+6),I(this,M+2,M+5),I(this,M+3,M+4);return this},a.prototype.toString=function(){const x=this.length;return x===0?"":arguments.length===0?G(this,0,x):C.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(x){if(!a.isBuffer(x))throw new TypeError("Argument must be a Buffer");return this===x?!0:a.compare(this,x)===0},a.prototype.inspect=function(){let x="";const M=t.INSPECT_MAX_BYTES;return x=this.toString("hex",0,M).replace(/(.{2})/g,"$1 ").trim(),this.length>M&&(x+=" ... "),"<Buffer "+x+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(x,M,q,ee,ae){if(dn(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),!a.isBuffer(x))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof x);if(M===void 0&&(M=0),q===void 0&&(q=x?x.length:0),ee===void 0&&(ee=0),ae===void 0&&(ae=this.length),M<0||q>x.length||ee<0||ae>this.length)throw new RangeError("out of range index");if(ee>=ae&&M>=q)return 0;if(ee>=ae)return-1;if(M>=q)return 1;if(M>>>=0,q>>>=0,ee>>>=0,ae>>>=0,this===x)return 0;let ge=ae-ee,dt=q-M;const Ne=Math.min(ge,dt),Fe=this.slice(ee,ae),tt=x.slice(M,q);for(let _e=0;_e<Ne;++_e)if(Fe[_e]!==tt[_e]){ge=Fe[_e],dt=tt[_e];break}return ge<dt?-1:dt<ge?1:0};function R($,x,M,q,ee){if($.length===0)return-1;if(typeof M=="string"?(q=M,M=0):M>2147483647?M=2147483647:M<-2147483648&&(M=-2147483648),M=+M,Xe(M)&&(M=ee?0:$.length-1),M<0&&(M=$.length+M),M>=$.length){if(ee)return-1;M=$.length-1}else if(M<0)if(ee)M=0;else return-1;if(typeof x=="string"&&(x=a.from(x,q)),a.isBuffer(x))return x.length===0?-1:O($,x,M,q,ee);if(typeof x=="number")return x=x&255,typeof Uint8Array.prototype.indexOf=="function"?ee?Uint8Array.prototype.indexOf.call($,x,M):Uint8Array.prototype.lastIndexOf.call($,x,M):O($,[x],M,q,ee);throw new TypeError("val must be string, number or Buffer")}function O($,x,M,q,ee){let ae=1,ge=$.length,dt=x.length;if(q!==void 0&&(q=String(q).toLowerCase(),q==="ucs2"||q==="ucs-2"||q==="utf16le"||q==="utf-16le")){if($.length<2||x.length<2)return-1;ae=2,ge/=2,dt/=2,M/=2}function Ne(tt,_e){return ae===1?tt[_e]:tt.readUInt16BE(_e*ae)}let Fe;if(ee){let tt=-1;for(Fe=M;Fe<ge;Fe++)if(Ne($,Fe)===Ne(x,tt===-1?0:Fe-tt)){if(tt===-1&&(tt=Fe),Fe-tt+1===dt)return tt*ae}else tt!==-1&&(Fe-=Fe-tt),tt=-1}else for(M+dt>ge&&(M=ge-dt),Fe=M;Fe>=0;Fe--){let tt=!0;for(let _e=0;_e<dt;_e++)if(Ne($,Fe+_e)!==Ne(x,_e)){tt=!1;break}if(tt)return Fe}return-1}a.prototype.includes=function(x,M,q){return this.indexOf(x,M,q)!==-1},a.prototype.indexOf=function(x,M,q){return R(this,x,M,q,!0)},a.prototype.lastIndexOf=function(x,M,q){return R(this,x,M,q,!1)};function A($,x,M,q){M=Number(M)||0;const ee=$.length-M;q?(q=Number(q),q>ee&&(q=ee)):q=ee;const ae=x.length;q>ae/2&&(q=ae/2);let ge;for(ge=0;ge<q;++ge){const dt=parseInt(x.substr(ge*2,2),16);if(Xe(dt))return ge;$[M+ge]=dt}return ge}function U($,x,M,q){return ar(nn(x,$.length-M),$,M,q)}function N($,x,M,q){return ar(Mr(x),$,M,q)}function L($,x,M,q){return ar(Di(x),$,M,q)}function j($,x,M,q){return ar(kn(x,$.length-M),$,M,q)}a.prototype.write=function(x,M,q,ee){if(M===void 0)ee="utf8",q=this.length,M=0;else if(q===void 0&&typeof M=="string")ee=M,q=this.length,M=0;else if(isFinite(M))M=M>>>0,isFinite(q)?(q=q>>>0,ee===void 0&&(ee="utf8")):(ee=q,q=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ae=this.length-M;if((q===void 0||q>ae)&&(q=ae),x.length>0&&(q<0||M<0)||M>this.length)throw new RangeError("Attempt to write outside buffer bounds");ee||(ee="utf8");let ge=!1;for(;;)switch(ee){case"hex":return A(this,x,M,q);case"utf8":case"utf-8":return U(this,x,M,q);case"ascii":case"latin1":case"binary":return N(this,x,M,q);case"base64":return L(this,x,M,q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,x,M,q);default:if(ge)throw new TypeError("Unknown encoding: "+ee);ee=(""+ee).toLowerCase(),ge=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X($,x,M){return x===0&&M===$.length?e.fromByteArray($):e.fromByteArray($.slice(x,M))}function G($,x,M){M=Math.min($.length,M);const q=[];let ee=x;for(;ee<M;){const ae=$[ee];let ge=null,dt=ae>239?4:ae>223?3:ae>191?2:1;if(ee+dt<=M){let Ne,Fe,tt,_e;switch(dt){case 1:ae<128&&(ge=ae);break;case 2:Ne=$[ee+1],(Ne&192)===128&&(_e=(ae&31)<<6|Ne&63,_e>127&&(ge=_e));break;case 3:Ne=$[ee+1],Fe=$[ee+2],(Ne&192)===128&&(Fe&192)===128&&(_e=(ae&15)<<12|(Ne&63)<<6|Fe&63,_e>2047&&(_e<55296||_e>57343)&&(ge=_e));break;case 4:Ne=$[ee+1],Fe=$[ee+2],tt=$[ee+3],(Ne&192)===128&&(Fe&192)===128&&(tt&192)===128&&(_e=(ae&15)<<18|(Ne&63)<<12|(Fe&63)<<6|tt&63,_e>65535&&_e<1114112&&(ge=_e))}}ge===null?(ge=65533,dt=1):ge>65535&&(ge-=65536,q.push(ge>>>10&1023|55296),ge=56320|ge&1023),q.push(ge),ee+=dt}return V(q)}const F=4096;function V($){const x=$.length;if(x<=F)return String.fromCharCode.apply(String,$);let M="",q=0;for(;q<x;)M+=String.fromCharCode.apply(String,$.slice(q,q+=F));return M}function J($,x,M){let q="";M=Math.min($.length,M);for(let ee=x;ee<M;++ee)q+=String.fromCharCode($[ee]&127);return q}function K($,x,M){let q="";M=Math.min($.length,M);for(let ee=x;ee<M;++ee)q+=String.fromCharCode($[ee]);return q}function W($,x,M){const q=$.length;(!x||x<0)&&(x=0),(!M||M<0||M>q)&&(M=q);let ee="";for(let ae=x;ae<M;++ae)ee+=Rn[$[ae]];return ee}function Y($,x,M){const q=$.slice(x,M);let ee="";for(let ae=0;ae<q.length-1;ae+=2)ee+=String.fromCharCode(q[ae]+q[ae+1]*256);return ee}a.prototype.slice=function(x,M){const q=this.length;x=~~x,M=M===void 0?q:~~M,x<0?(x+=q,x<0&&(x=0)):x>q&&(x=q),M<0?(M+=q,M<0&&(M=0)):M>q&&(M=q),M<x&&(M=x);const ee=this.subarray(x,M);return Object.setPrototypeOf(ee,a.prototype),ee};function ce($,x,M){if($%1!==0||$<0)throw new RangeError("offset is not uint");if($+x>M)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(x,M,q){x=x>>>0,M=M>>>0,q||ce(x,M,this.length);let ee=this[x],ae=1,ge=0;for(;++ge<M&&(ae*=256);)ee+=this[x+ge]*ae;return ee},a.prototype.readUintBE=a.prototype.readUIntBE=function(x,M,q){x=x>>>0,M=M>>>0,q||ce(x,M,this.length);let ee=this[x+--M],ae=1;for(;M>0&&(ae*=256);)ee+=this[x+--M]*ae;return ee},a.prototype.readUint8=a.prototype.readUInt8=function(x,M){return x=x>>>0,M||ce(x,1,this.length),this[x]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(x,M){return x=x>>>0,M||ce(x,2,this.length),this[x]|this[x+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(x,M){return x=x>>>0,M||ce(x,2,this.length),this[x]<<8|this[x+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),(this[x]|this[x+1]<<8|this[x+2]<<16)+this[x+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),this[x]*16777216+(this[x+1]<<16|this[x+2]<<8|this[x+3])},a.prototype.readBigUInt64LE=At(function(x){x=x>>>0,je(x,"offset");const M=this[x],q=this[x+7];(M===void 0||q===void 0)&&Bt(x,this.length-8);const ee=M+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24,ae=this[++x]+this[++x]*2**8+this[++x]*2**16+q*2**24;return BigInt(ee)+(BigInt(ae)<<BigInt(32))}),a.prototype.readBigUInt64BE=At(function(x){x=x>>>0,je(x,"offset");const M=this[x],q=this[x+7];(M===void 0||q===void 0)&&Bt(x,this.length-8);const ee=M*2**24+this[++x]*2**16+this[++x]*2**8+this[++x],ae=this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+q;return(BigInt(ee)<<BigInt(32))+BigInt(ae)}),a.prototype.readIntLE=function(x,M,q){x=x>>>0,M=M>>>0,q||ce(x,M,this.length);let ee=this[x],ae=1,ge=0;for(;++ge<M&&(ae*=256);)ee+=this[x+ge]*ae;return ae*=128,ee>=ae&&(ee-=Math.pow(2,8*M)),ee},a.prototype.readIntBE=function(x,M,q){x=x>>>0,M=M>>>0,q||ce(x,M,this.length);let ee=M,ae=1,ge=this[x+--ee];for(;ee>0&&(ae*=256);)ge+=this[x+--ee]*ae;return ae*=128,ge>=ae&&(ge-=Math.pow(2,8*M)),ge},a.prototype.readInt8=function(x,M){return x=x>>>0,M||ce(x,1,this.length),this[x]&128?(255-this[x]+1)*-1:this[x]},a.prototype.readInt16LE=function(x,M){x=x>>>0,M||ce(x,2,this.length);const q=this[x]|this[x+1]<<8;return q&32768?q|4294901760:q},a.prototype.readInt16BE=function(x,M){x=x>>>0,M||ce(x,2,this.length);const q=this[x+1]|this[x]<<8;return q&32768?q|4294901760:q},a.prototype.readInt32LE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),this[x]|this[x+1]<<8|this[x+2]<<16|this[x+3]<<24},a.prototype.readInt32BE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),this[x]<<24|this[x+1]<<16|this[x+2]<<8|this[x+3]},a.prototype.readBigInt64LE=At(function(x){x=x>>>0,je(x,"offset");const M=this[x],q=this[x+7];(M===void 0||q===void 0)&&Bt(x,this.length-8);const ee=this[x+4]+this[x+5]*2**8+this[x+6]*2**16+(q<<24);return(BigInt(ee)<<BigInt(32))+BigInt(M+this[++x]*2**8+this[++x]*2**16+this[++x]*2**24)}),a.prototype.readBigInt64BE=At(function(x){x=x>>>0,je(x,"offset");const M=this[x],q=this[x+7];(M===void 0||q===void 0)&&Bt(x,this.length-8);const ee=(M<<24)+this[++x]*2**16+this[++x]*2**8+this[++x];return(BigInt(ee)<<BigInt(32))+BigInt(this[++x]*2**24+this[++x]*2**16+this[++x]*2**8+q)}),a.prototype.readFloatLE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),n.read(this,x,!0,23,4)},a.prototype.readFloatBE=function(x,M){return x=x>>>0,M||ce(x,4,this.length),n.read(this,x,!1,23,4)},a.prototype.readDoubleLE=function(x,M){return x=x>>>0,M||ce(x,8,this.length),n.read(this,x,!0,52,8)},a.prototype.readDoubleBE=function(x,M){return x=x>>>0,M||ce(x,8,this.length),n.read(this,x,!1,52,8)};function ue($,x,M,q,ee,ae){if(!a.isBuffer($))throw new TypeError('"buffer" argument must be a Buffer instance');if(x>ee||x<ae)throw new RangeError('"value" argument is out of bounds');if(M+q>$.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(x,M,q,ee){if(x=+x,M=M>>>0,q=q>>>0,!ee){const dt=Math.pow(2,8*q)-1;ue(this,x,M,q,dt,0)}let ae=1,ge=0;for(this[M]=x&255;++ge<q&&(ae*=256);)this[M+ge]=x/ae&255;return M+q},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(x,M,q,ee){if(x=+x,M=M>>>0,q=q>>>0,!ee){const dt=Math.pow(2,8*q)-1;ue(this,x,M,q,dt,0)}let ae=q-1,ge=1;for(this[M+ae]=x&255;--ae>=0&&(ge*=256);)this[M+ae]=x/ge&255;return M+q},a.prototype.writeUint8=a.prototype.writeUInt8=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,1,255,0),this[M]=x&255,M+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,2,65535,0),this[M]=x&255,this[M+1]=x>>>8,M+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,2,65535,0),this[M]=x>>>8,this[M+1]=x&255,M+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,4,4294967295,0),this[M+3]=x>>>24,this[M+2]=x>>>16,this[M+1]=x>>>8,this[M]=x&255,M+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,4,4294967295,0),this[M]=x>>>24,this[M+1]=x>>>16,this[M+2]=x>>>8,this[M+3]=x&255,M+4};function Te($,x,M,q,ee){un(x,q,ee,$,M,7);let ae=Number(x&BigInt(4294967295));$[M++]=ae,ae=ae>>8,$[M++]=ae,ae=ae>>8,$[M++]=ae,ae=ae>>8,$[M++]=ae;let ge=Number(x>>BigInt(32)&BigInt(4294967295));return $[M++]=ge,ge=ge>>8,$[M++]=ge,ge=ge>>8,$[M++]=ge,ge=ge>>8,$[M++]=ge,M}function Re($,x,M,q,ee){un(x,q,ee,$,M,7);let ae=Number(x&BigInt(4294967295));$[M+7]=ae,ae=ae>>8,$[M+6]=ae,ae=ae>>8,$[M+5]=ae,ae=ae>>8,$[M+4]=ae;let ge=Number(x>>BigInt(32)&BigInt(4294967295));return $[M+3]=ge,ge=ge>>8,$[M+2]=ge,ge=ge>>8,$[M+1]=ge,ge=ge>>8,$[M]=ge,M+8}a.prototype.writeBigUInt64LE=At(function(x,M=0){return Te(this,x,M,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=At(function(x,M=0){return Re(this,x,M,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(x,M,q,ee){if(x=+x,M=M>>>0,!ee){const Ne=Math.pow(2,8*q-1);ue(this,x,M,q,Ne-1,-Ne)}let ae=0,ge=1,dt=0;for(this[M]=x&255;++ae<q&&(ge*=256);)x<0&&dt===0&&this[M+ae-1]!==0&&(dt=1),this[M+ae]=(x/ge>>0)-dt&255;return M+q},a.prototype.writeIntBE=function(x,M,q,ee){if(x=+x,M=M>>>0,!ee){const Ne=Math.pow(2,8*q-1);ue(this,x,M,q,Ne-1,-Ne)}let ae=q-1,ge=1,dt=0;for(this[M+ae]=x&255;--ae>=0&&(ge*=256);)x<0&&dt===0&&this[M+ae+1]!==0&&(dt=1),this[M+ae]=(x/ge>>0)-dt&255;return M+q},a.prototype.writeInt8=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,1,127,-128),x<0&&(x=255+x+1),this[M]=x&255,M+1},a.prototype.writeInt16LE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,2,32767,-32768),this[M]=x&255,this[M+1]=x>>>8,M+2},a.prototype.writeInt16BE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,2,32767,-32768),this[M]=x>>>8,this[M+1]=x&255,M+2},a.prototype.writeInt32LE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,4,2147483647,-2147483648),this[M]=x&255,this[M+1]=x>>>8,this[M+2]=x>>>16,this[M+3]=x>>>24,M+4},a.prototype.writeInt32BE=function(x,M,q){return x=+x,M=M>>>0,q||ue(this,x,M,4,2147483647,-2147483648),x<0&&(x=4294967295+x+1),this[M]=x>>>24,this[M+1]=x>>>16,this[M+2]=x>>>8,this[M+3]=x&255,M+4},a.prototype.writeBigInt64LE=At(function(x,M=0){return Te(this,x,M,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=At(function(x,M=0){return Re(this,x,M,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Oe($,x,M,q,ee,ae){if(M+q>$.length)throw new RangeError("Index out of range");if(M<0)throw new RangeError("Index out of range")}function De($,x,M,q,ee){return x=+x,M=M>>>0,ee||Oe($,x,M,4),n.write($,x,M,q,23,4),M+4}a.prototype.writeFloatLE=function(x,M,q){return De(this,x,M,!0,q)},a.prototype.writeFloatBE=function(x,M,q){return De(this,x,M,!1,q)};function ze($,x,M,q,ee){return x=+x,M=M>>>0,ee||Oe($,x,M,8),n.write($,x,M,q,52,8),M+8}a.prototype.writeDoubleLE=function(x,M,q){return ze(this,x,M,!0,q)},a.prototype.writeDoubleBE=function(x,M,q){return ze(this,x,M,!1,q)},a.prototype.copy=function(x,M,q,ee){if(!a.isBuffer(x))throw new TypeError("argument should be a Buffer");if(q||(q=0),!ee&&ee!==0&&(ee=this.length),M>=x.length&&(M=x.length),M||(M=0),ee>0&&ee<q&&(ee=q),ee===q||x.length===0||this.length===0)return 0;if(M<0)throw new RangeError("targetStart out of bounds");if(q<0||q>=this.length)throw new RangeError("Index out of range");if(ee<0)throw new RangeError("sourceEnd out of bounds");ee>this.length&&(ee=this.length),x.length-M<ee-q&&(ee=x.length-M+q);const ae=ee-q;return this===x&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(M,q,ee):Uint8Array.prototype.set.call(x,this.subarray(q,ee),M),ae},a.prototype.fill=function(x,M,q,ee){if(typeof x=="string"){if(typeof M=="string"?(ee=M,M=0,q=this.length):typeof q=="string"&&(ee=q,q=this.length),ee!==void 0&&typeof ee!="string")throw new TypeError("encoding must be a string");if(typeof ee=="string"&&!a.isEncoding(ee))throw new TypeError("Unknown encoding: "+ee);if(x.length===1){const ge=x.charCodeAt(0);(ee==="utf8"&&ge<128||ee==="latin1")&&(x=ge)}}else typeof x=="number"?x=x&255:typeof x=="boolean"&&(x=Number(x));if(M<0||this.length<M||this.length<q)throw new RangeError("Out of range index");if(q<=M)return this;M=M>>>0,q=q===void 0?this.length:q>>>0,x||(x=0);let ae;if(typeof x=="number")for(ae=M;ae<q;++ae)this[ae]=x;else{const ge=a.isBuffer(x)?x:a.from(x,ee),dt=ge.length;if(dt===0)throw new TypeError('The value "'+x+'" is invalid for argument "value"');for(ae=0;ae<q-M;++ae)this[ae+M]=ge[ae%dt]}return this};const et={};function lt($,x,M){et[$]=class extends M{constructor(){super(),Object.defineProperty(this,"message",{value:x.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${$}]`,this.stack,delete this.name}get code(){return $}set code(ee){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ee,writable:!0})}toString(){return`${this.name} [${$}]: ${this.message}`}}}lt("ERR_BUFFER_OUT_OF_BOUNDS",function($){return $?`${$} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),lt("ERR_INVALID_ARG_TYPE",function($,x){return`The "${$}" argument must be of type number. Received type ${typeof x}`},TypeError),lt("ERR_OUT_OF_RANGE",function($,x,M){let q=`The value of "${$}" is out of range.`,ee=M;return Number.isInteger(M)&&Math.abs(M)>2**32?ee=Ae(String(M)):typeof M=="bigint"&&(ee=String(M),(M>BigInt(2)**BigInt(32)||M<-(BigInt(2)**BigInt(32)))&&(ee=Ae(ee)),ee+="n"),q+=` It must be ${x}. Received ${ee}`,q},RangeError);function Ae($){let x="",M=$.length;const q=$[0]==="-"?1:0;for(;M>=q+4;M-=3)x=`_${$.slice(M-3,M)}${x}`;return`${$.slice(0,M)}${x}`}function yn($,x,M){je(x,"offset"),($[x]===void 0||$[x+M]===void 0)&&Bt(x,$.length-(M+1))}function un($,x,M,q,ee,ae){if($>M||$<x){const ge=typeof x=="bigint"?"n":"";let dt;throw x===0||x===BigInt(0)?dt=`>= 0${ge} and < 2${ge} ** ${(ae+1)*8}${ge}`:dt=`>= -(2${ge} ** ${(ae+1)*8-1}${ge}) and < 2 ** ${(ae+1)*8-1}${ge}`,new et.ERR_OUT_OF_RANGE("value",dt,$)}yn(q,ee,ae)}function je($,x){if(typeof $!="number")throw new et.ERR_INVALID_ARG_TYPE(x,"number",$)}function Bt($,x,M){throw Math.floor($)!==$?(je($,M),new et.ERR_OUT_OF_RANGE("offset","an integer",$)):x<0?new et.ERR_BUFFER_OUT_OF_BOUNDS:new et.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${x}`,$)}const _n=/[^+/0-9A-Za-z-_]/g;function Jn($){if($=$.split("=")[0],$=$.trim().replace(_n,""),$.length<2)return"";for(;$.length%4!==0;)$=$+"=";return $}function nn($,x){x=x||1/0;let M;const q=$.length;let ee=null;const ae=[];for(let ge=0;ge<q;++ge){if(M=$.charCodeAt(ge),M>55295&&M<57344){if(!ee){if(M>56319){(x-=3)>-1&&ae.push(239,191,189);continue}else if(ge+1===q){(x-=3)>-1&&ae.push(239,191,189);continue}ee=M;continue}if(M<56320){(x-=3)>-1&&ae.push(239,191,189),ee=M;continue}M=(ee-55296<<10|M-56320)+65536}else ee&&(x-=3)>-1&&ae.push(239,191,189);if(ee=null,M<128){if((x-=1)<0)break;ae.push(M)}else if(M<2048){if((x-=2)<0)break;ae.push(M>>6|192,M&63|128)}else if(M<65536){if((x-=3)<0)break;ae.push(M>>12|224,M>>6&63|128,M&63|128)}else if(M<1114112){if((x-=4)<0)break;ae.push(M>>18|240,M>>12&63|128,M>>6&63|128,M&63|128)}else throw new Error("Invalid code point")}return ae}function Mr($){const x=[];for(let M=0;M<$.length;++M)x.push($.charCodeAt(M)&255);return x}function kn($,x){let M,q,ee;const ae=[];for(let ge=0;ge<$.length&&!((x-=2)<0);++ge)M=$.charCodeAt(ge),q=M>>8,ee=M%256,ae.push(ee),ae.push(q);return ae}function Di($){return e.toByteArray(Jn($))}function ar($,x,M,q){let ee;for(ee=0;ee<q&&!(ee+M>=x.length||ee>=$.length);++ee)x[ee+M]=$[ee];return ee}function dn($,x){return $ instanceof x||$!=null&&$.constructor!=null&&$.constructor.name!=null&&$.constructor.name===x.name}function Xe($){return $!==$}const Rn=function(){const $="0123456789abcdef",x=new Array(256);for(let M=0;M<16;++M){const q=M*16;for(let ee=0;ee<16;++ee)x[q+ee]=$[M]+$[ee]}return x}();function At($){return typeof BigInt>"u"?_c:$}function _c(){throw new Error("BigInt not supported")}})(Lle);class gZe extends d4{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...n){const r=super.emit(e,...n);if(!r){const i=this.eventBacklogs.get(e);i?i.push(n):this.eventBacklogs.set(e,[n])}return r}on(e,n){super.on(e,n);const r=this.eventBacklogs.get(e);if(r){for(const i of r)super.emit(e,...i);this.eventBacklogs.delete(e)}return this}addListener(e,n){return this.on(e,n)}once(e,n){super.once(e,n);const r=this.eventBacklogs.get(e);return r&&(super.emit(e,...r[0]),r.length===1?this.eventBacklogs.delete(e):r.shift()),this}}var fs=(t=>(t.JoinCall="io.element.join",t.HangupCall="im.vector.hangup",t.TileLayout="io.element.tile_layout",t.SpotlightLayout="io.element.spotlight_layout",t.DeviceMute="io.element.device_mute",t))(fs||{});const rt=(()=>{try{const{widgetId:t,parentUrl:e}=hc();if(t&&e){const n=new URL(e).origin;k.info("Widget API is available");const r=new uke(t,n);r.requestCapability(e0.AlwaysOnScreen);const i=new gZe;["io.element.join","im.vector.hangup","io.element.tile_layout","io.element.spotlight_layout","io.element.device_mute"].forEach(_=>{r.on(`action:${_}`,w=>{w.preventDefault(),i.emit(_,w)})});const{roomId:s,userId:o,deviceId:a,baseUrl:c,e2eEnabled:l,allowIceFallback:u}=hc();if(!s)throw new Error("Room ID must be supplied");if(!o)throw new Error("User ID must be supplied");if(!a)throw new Error("Device ID must be supplied");if(!c)throw new Error("Base URL must be supplied");const d=["org.matrix.rageshake_request",Z.CallEncryptionKeysPrefix],f=[o,`_${o}_${a}`,`${o}_${a}`].map(_=>({eventType:Z.GroupCallMemberPrefix,stateKey:_})),p=[{eventType:Z.RoomCreate},{eventType:Z.RoomMember},{eventType:Z.RoomEncryption},{eventType:Z.GroupCallMemberPrefix}],m=[Z.CallInvite,Z.CallCandidates,Z.CallAnswer,Z.CallHangup,Z.CallReject,Z.CallSelectAnswer,Z.CallNegotiate,Z.CallSDPStreamMetadataChanged,Z.CallSDPStreamMetadataChangedPrefix,Z.CallReplaces],v=kX(r,{sendEvent:d,receiveEvent:d,sendState:f,receiveState:p,sendToDevice:m,receiveToDevice:m,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0},s,{baseUrl:c,userId:o,deviceId:a,timelineSupport:!0,useE2eForGroupCall:l,fallbackICEServerAllowed:u},!1);return{api:r,lazyActions:i,client:(async()=>(await on.init(),await v.startClient({clientWellKnownPollPeriod:60*10}),v))()}}else return k.info("No widget API available"),null}catch(t){return k.warn("Continuing without the widget API",t),null}})();class mZe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,n,r,i){zt.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:n,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:i.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:i.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:i.statistics.counters.roomEventEncryptionKeysReceived>0?i.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/i.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:r})}}class vZe{track(e){zt.instance.trackEvent({eventName:"CallStarted",callId:e})}}class yZe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){zt.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),zt.instance.setRegistrationType(pI.Registered)}}class _Ze{track(){zt.instance.trackEvent({eventName:"Login"}),zt.instance.setRegistrationType(pI.Registered)}}class bZe{track(e,n){zt.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:n})}}class SZe{track(e,n){zt.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:n})}}class wZe{track(e){zt.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class EZe{track(e,n,r){zt.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:n,stars:r})}}class TZe{track(e){zt.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class CZe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const n=Date.now(),r=n-this.connectStart,i=this.websocketConnected-this.connectStart,s=n-this.websocketConnected;zt.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:r,websocketDuration:i,peerConnectionDuration:s}),e.log&&k.log(`Time to connect:
total: ${r}ms
peerConnection: ${i}ms
websocket: ${s}ms`)}}function gn(t){return typeof t=="function"}function Nle(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var HO=Nle(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Yk(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Zb=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=bv(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(gn(u))try{u()}catch(v){s=v instanceof HO?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=bv(d),p=f.next();!p.done;p=f.next()){var m=p.value;try{EG(m)}catch(v){s=s??[],v instanceof HO?s=ll(ll([],Nu(s)),Nu(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new HO(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)EG(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Yk(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Yk(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Ule=Zb.EMPTY;function $le(t){return t instanceof Zb||t&&"closed"in t&&gn(t.remove)&&gn(t.add)&&gn(t.unsubscribe)}function EG(t){gn(t)?t():t.unsubscribe()}var Fle={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ble={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ll([t,e],Nu(n)))},clearTimeout:function(t){var e=Ble.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function jle(t){Ble.setTimeout(function(){throw t})}function Jk(){}function VT(t){t()}var QN=function(t){yl(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,$le(n)&&n.add(r)):r.destination=xZe,r}return e.create=function(n,r,i){return new Z_(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Zb),kZe=Function.prototype.bind;function KO(t,e){return kZe.call(t,e)}var RZe=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){pE(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){pE(r)}else pE(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){pE(n)}},t}(),Z_=function(t){yl(e,t);function e(n,r,i){var s=t.call(this)||this,o;if(gn(n)||!n)o={next:n??void 0,error:r??void 0,complete:i??void 0};else{var a;s&&Fle.useDeprecatedNextContext?(a=Object.create(n),a.unsubscribe=function(){return s.unsubscribe()},o={next:n.next&&KO(n.next,a),error:n.error&&KO(n.error,a),complete:n.complete&&KO(n.complete,a)}):o=n}return s.destination=new RZe(o),s}return e}(QN);function pE(t){jle(t)}function IZe(t){throw t}var xZe={closed:!0,next:Jk,error:IZe,complete:Jk},e9=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Lf(t){return t}function PZe(t){return t.length===0?Lf:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var Cr=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=MZe(e)?e:new Z_(e,n,r);return VT(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=TG(n),new n(function(i,s){var o=new Z_({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[e9]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return PZe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=TG(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function TG(t){var e;return(e=t??Fle.Promise)!==null&&e!==void 0?e:Promise}function OZe(t){return t&&gn(t.next)&&gn(t.error)&&gn(t.complete)}function MZe(t){return t&&t instanceof QN||OZe(t)&&$le(t)}function AZe(t){return gn(t==null?void 0:t.lift)}function ui(t){return function(e){if(AZe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function kr(t,e,n,r,i){return new LZe(t,e,n,r,i)}var LZe=function(t){yl(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(QN),DZe=Nle(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),da=function(t){yl(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new CG(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new DZe},e.prototype.next=function(n){var r=this;VT(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=bv(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;VT(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;VT(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Ule:(this.currentObservers=null,a.push(n),new Zb(function(){r.currentObservers=null,Yk(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Cr;return n.source=this,n},e.create=function(n,r){return new CG(n,r)},e}(Cr),CG=function(t){yl(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:Ule},e}(da),bf=function(t){yl(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(da),t9={now:function(){return(t9.delegate||Date).now()},delegate:void 0},NZe=function(t){yl(e,t);function e(n,r,i){n===void 0&&(n=1/0),r===void 0&&(r=1/0),i===void 0&&(i=t9);var s=t.call(this)||this;return s._bufferSize=n,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,n),s._windowTime=Math.max(1,r),s}return e.prototype.next=function(n){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(n),!o&&s.push(a.now()+c)),this._trimBuffer(),t.prototype.next.call(this,n)},e.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!n.closed;c+=s?1:2)n.next(a[c]);return this._checkFinalizedStatuses(n),r},e.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,i=n._timestampProvider,s=n._buffer,o=n._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},e}(da),UZe=function(t){yl(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(Zb),kG={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ll([t,e],Nu(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},$Ze=function(t){yl(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),kG.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&kG.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Yk(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(UZe),RG=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=t9.now,t}(),FZe=function(t){yl(e,t);function e(n,r){r===void 0&&(r=RG.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(RG),Hle=new FZe($Ze),BZe=Hle,Xk=new Cr(function(t){return t.complete()});function Kle(t){return t&&gn(t.schedule)}function n9(t){return t[t.length-1]}function r9(t){return gn(n9(t))?t.pop():void 0}function Qb(t){return Kle(n9(t))?t.pop():void 0}function jZe(t,e){return typeof n9(t)=="number"?t.pop():e}var i9=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Vle(t){return gn(t==null?void 0:t.then)}function qle(t){return gn(t[e9])}function Gle(t){return Symbol.asyncIterator&&gn(t==null?void 0:t[Symbol.asyncIterator])}function zle(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function HZe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Wle=HZe();function Yle(t){return gn(t==null?void 0:t[Wle])}function Jle(t){return MNe(this,arguments,function(){var n,r,i,s;return aie(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Lm(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Lm(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Lm(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Xle(t){return gn(t==null?void 0:t.getReader)}function di(t){if(t instanceof Cr)return t;if(t!=null){if(qle(t))return KZe(t);if(i9(t))return VZe(t);if(Vle(t))return qZe(t);if(Gle(t))return Zle(t);if(Yle(t))return GZe(t);if(Xle(t))return zZe(t)}throw zle(t)}function KZe(t){return new Cr(function(e){var n=t[e9]();if(gn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function VZe(t){return new Cr(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function qZe(t){return new Cr(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,jle)})}function GZe(t){return new Cr(function(e){var n,r;try{for(var i=bv(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Zle(t){return new Cr(function(e){WZe(t,e).catch(function(n){return e.error(n)})})}function zZe(t){return Zle(Jle(t))}function WZe(t,e){var n,r,i,s;return ONe(this,void 0,void 0,function(){var o,a;return aie(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=ANe(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function rf(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Qle(t,e){return e===void 0&&(e=0),ui(function(n,r){n.subscribe(kr(r,function(i){return rf(r,t,function(){return r.next(i)},e)},function(){return rf(r,t,function(){return r.complete()},e)},function(i){return rf(r,t,function(){return r.error(i)},e)}))})}function eue(t,e){return e===void 0&&(e=0),ui(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function YZe(t,e){return di(t).pipe(eue(e),Qle(e))}function JZe(t,e){return di(t).pipe(eue(e),Qle(e))}function XZe(t,e){return new Cr(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function ZZe(t,e){return new Cr(function(n){var r;return rf(n,e,function(){r=t[Wle](),rf(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return gn(r==null?void 0:r.return)&&r.return()}})}function tue(t,e){if(!t)throw new Error("Iterable cannot be null");return new Cr(function(n){rf(n,e,function(){var r=t[Symbol.asyncIterator]();rf(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function QZe(t,e){return tue(Jle(t),e)}function eQe(t,e){if(t!=null){if(qle(t))return YZe(t,e);if(i9(t))return XZe(t,e);if(Vle(t))return JZe(t,e);if(Gle(t))return tue(t,e);if(Yle(t))return ZZe(t,e);if(Xle(t))return QZe(t,e)}throw zle(t)}function eS(t,e){return e?eQe(t,e):di(t)}function Ms(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Qb(t);return eS(t,n)}function tQe(t){return t instanceof Date&&!isNaN(t)}function Ut(t,e){return ui(function(n,r){var i=0;n.subscribe(kr(r,function(s){r.next(t.call(e,s,i++))}))})}var nQe=Array.isArray;function rQe(t,e){return nQe(e)?t.apply(void 0,ll([],Nu(e))):t(e)}function s9(t){return Ut(function(e){return rQe(t,e)})}var iQe=Array.isArray,sQe=Object.getPrototypeOf,oQe=Object.prototype,aQe=Object.keys;function nue(t){if(t.length===1){var e=t[0];if(iQe(e))return{args:e,keys:null};if(cQe(e)){var n=aQe(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function cQe(t){return t&&typeof t=="object"&&sQe(t)===oQe}function rue(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function As(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Qb(t),r=r9(t),i=nue(t),s=i.args,o=i.keys;if(s.length===0)return eS([],n);var a=new Cr(lQe(s,n,o?function(c){return rue(o,c)}:Lf));return r?a.pipe(s9(r)):a}function lQe(t,e,n){return n===void 0&&(n=Lf),function(r){IG(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,c=function(u){IG(e,function(){var d=eS(t[u],e),f=!1;d.subscribe(kr(r,function(p){s[u]=p,f||(f=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function IG(t,e,n){t?rf(n,t,e):e()}function uQe(t,e,n,r,i,s,o,a){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&e.complete()},p=function(v){return l<r?m(v):c.push(v)},m=function(v){l++;var S=!1;di(n(v,u++)).subscribe(kr(e,function(_){e.next(_)},function(){S=!0},void 0,function(){if(S)try{l--;for(var _=function(){var w=c.shift();o||m(w)};c.length&&l<r;)_();f()}catch(w){e.error(w)}}))};return t.subscribe(kr(e,p,function(){d=!0,f()})),function(){}}function fI(t,e,n){return n===void 0&&(n=1/0),gn(e)?fI(function(r,i){return Ut(function(s,o){return e(r,s,i,o)})(di(t(r,i)))},n):(typeof e=="number"&&(n=e),ui(function(r,i){return uQe(r,i,t,n)}))}function iue(t){return t===void 0&&(t=1/0),fI(Lf,t)}function dQe(){return iue(1)}function Zk(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return dQe()(eS(t,Qb(t)))}function fQe(t){return new Cr(function(e){di(t()).subscribe(e)})}function hQe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r9(t),r=nue(t),i=r.args,s=r.keys,o=new Cr(function(a){var c=i.length;if(!c){a.complete();return}for(var l=new Array(c),u=c,d=c,f=function(m){var v=!1;di(i[m]).subscribe(kr(a,function(S){v||(v=!0,d--),l[m]=S},function(){return u--},void 0,function(){(!u||!v)&&(d||a.next(s?rue(s,l):l),a.complete())}))},p=0;p<c;p++)f(p)});return n?o.pipe(s9(n)):o}var pQe=["addListener","removeListener"],gQe=["addEventListener","removeEventListener"],mQe=["on","off"];function Q_(t,e,n,r){if(gn(n)&&(r=n,n=void 0),r)return Q_(t,e,n).pipe(s9(r));var i=Nu(_Qe(t)?gQe.map(function(a){return function(c){return t[a](e,c,n)}}):vQe(t)?pQe.map(xG(t,e)):yQe(t)?mQe.map(xG(t,e)):[],2),s=i[0],o=i[1];if(!s&&i9(t))return fI(function(a){return Q_(a,e,n)})(di(t));if(!s)throw new TypeError("Invalid event target");return new Cr(function(a){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function xG(t,e){return function(n){return function(r){return t[n](e,r)}}}function vQe(t){return gn(t.addListener)&&gn(t.removeListener)}function yQe(t){return gn(t.on)&&gn(t.off)}function _Qe(t){return gn(t.addEventListener)&&gn(t.removeEventListener)}function M0(t,e,n){t===void 0&&(t=0),n===void 0&&(n=BZe);var r=-1;return e!=null&&(Kle(e)?n=e:r=e),new Cr(function(i){var s=tQe(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function sue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Qb(t),r=jZe(t,1/0),i=t;return i.length?i.length===1?di(i[0]):iue(r)(eS(i,n)):Xk}var bQe=Array.isArray;function SQe(t){return t.length===1&&bQe(t[0])?t[0]:t}function o9(t,e){return ui(function(n,r){var i=0;n.subscribe(kr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function wQe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=SQe(t),t.length===1?di(t[0]):new Cr(EQe(t))}function EQe(t){return function(e){for(var n=[],r=function(s){n.push(di(t[s]).subscribe(kr(e,function(o){if(n){for(var a=0;a<n.length;a++)a!==s&&n[a].unsubscribe();n=null}e.next(o)})))},i=0;n&&!e.closed&&i<t.length;i++)r(i)}}function TQe(t){return ui(function(e,n){var r=!1,i=null,s=null,o=!1,a=function(){if(s==null||s.unsubscribe(),s=null,r){r=!1;var l=i;i=null,n.next(l)}o&&n.complete()},c=function(){s=null,o&&n.complete()};e.subscribe(kr(n,function(l){r=!0,i=l,s||di(t(l)).subscribe(s=kr(n,a,c))},function(){o=!0,(!r||!s||s.closed)&&n.complete()}))})}function CQe(t,e,n,r,i){return function(s,o){var a=n,c=e,l=0;s.subscribe(kr(o,function(u){var d=l++;c=a?t(c,u,d):(a=!0,u),o.next(c)},i))}}function PG(t){return t<=0?function(){return Xk}:ui(function(e,n){var r=0;e.subscribe(kr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function Vh(t,e){return e===void 0&&(e=Lf),t=t??kQe,ui(function(n,r){var i,s=!0;n.subscribe(kr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function kQe(t,e){return t===e}function RQe(t,e){return Vh(function(n,r){return n[t]===r[t]})}function oue(t){return ui(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function CL(t,e){return ui(CQe(t,e,arguments.length>=2,!0))}function IQe(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new da}:e,r=t.resetOnError,i=r===void 0?!0:r,s=t.resetOnComplete,o=s===void 0?!0:s,a=t.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,d,f,p=0,m=!1,v=!1,S=function(){d==null||d.unsubscribe(),d=void 0},_=function(){S(),u=f=void 0,m=v=!1},w=function(){var T=u;_(),T==null||T.unsubscribe()};return ui(function(T,C){p++,!v&&!m&&S();var I=f=f??n();C.add(function(){p--,p===0&&!v&&!m&&(d=VO(w,c))}),I.subscribe(C),!u&&p>0&&(u=new Z_({next:function(R){return I.next(R)},error:function(R){v=!0,S(),d=VO(_,i,R),I.error(R)},complete:function(){m=!0,S(),d=VO(_,o),I.complete()}}),di(T).subscribe(u))})(l)}}function VO(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new Z_({next:function(){i.unsubscribe(),t()}});return di(e.apply(void 0,ll([],Nu(n)))).subscribe(i)}}function xQe(t,e,n){var r,i=!1;return r=t,IQe({connector:function(){return new NZe(r,e,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function PQe(t){return o9(function(e,n){return t<=n})}function Us(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Qb(t);return ui(function(r,i){(n?Zk(t,r,n):Zk(t,r)).subscribe(i)})}function Dr(t,e){return ui(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(kr(r,function(c){i==null||i.unsubscribe();var l=0,u=s++;di(t(c,u)).subscribe(i=kr(r,function(d){return r.next(e?e(c,d,u,l++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function OQe(){return Dr(Lf)}function MQe(t,e){return ui(function(n,r){var i=e;return Dr(function(s,o){return t(i,s,o)},function(s,o){return i=o,o})(n).subscribe(r),function(){i=null}})}function AQe(t){return ui(function(e,n){di(t).subscribe(kr(n,function(){return n.complete()},Jk)),!n.closed&&e.subscribe(n)})}function LQe(t,e,n){var r=gn(t)||e||n?{next:t,error:e,complete:n}:t;return r?ui(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(kr(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Lf}function DQe(t,e){return ui(function(n,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,u=null,d=null,f=!1,p=function(){d==null||d.unsubscribe(),d=null,c&&(S(),f&&r.complete())},m=function(){d=null,f&&r.complete()},v=function(_){return d=di(t(_)).subscribe(kr(r,p,m))},S=function(){if(l){l=!1;var _=u;u=null,r.next(_),!f&&v(_)}};n.subscribe(kr(r,function(_){l=!0,u=_,!(d&&!d.closed)&&(o?S():v(_))},function(){f=!0,!(c&&l&&d&&!d.closed)&&r.complete()}))})}function NQe(t,e,n){e===void 0&&(e=Hle);var r=M0(t,e);return DQe(function(){return r},n)}function UQe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r9(t);return ui(function(r,i){for(var s=t.length,o=new Array(s),a=t.map(function(){return!1}),c=!1,l=function(d){di(t[d]).subscribe(kr(i,function(f){o[d]=f,!c&&!a[d]&&(a[d]=!0,(c=a.every(Lf))&&(a=null))},Jk))},u=0;u<s;u++)l(u);r.subscribe(kr(i,function(d){if(c){var f=ll([d],Nu(o));i.next(n?n.apply(void 0,ll([],Nu(f))):f)}}))})}var $Qe=t=>t+1|0,FQe=()=>{const t=y.useState(0)[1];return y.useRef(()=>t($Qe)).current},BQe=typeof window>"u"?y.useEffect:y.useLayoutEffect;function jt(t){const e=FQe(),n=y.useRef(t),r=y.useRef(),i=y.useRef(!1),s=y.useRef(!1),[o,a]=y.useState(()=>{let c;return t.subscribe({next:l=>{s.current=!0,c=l},error:l=>{r.current=l}}).unsubscribe(),c});if(BQe(()=>{n.current=t}),y.useEffect(()=>{r.current=null;const c=n.current;let l=o;const u=c.subscribe({next:d=>{c===n.current&&(i.current?a(()=>d):l=d)},error:d=>{c===n.current&&(r.current=d,e())}});return i.current||l!==o&&a(()=>l),i.current=!0,()=>{u.unsubscribe()}},[t]),r.current)throw r.current;if(s.current)return y.useDebugValue(o),o;throw new Error("Observable did not synchronously emit a value.")}class qp{constructor(e,n){this.setValue=s=>{this._value.next(s),localStorage.setItem(this.key,JSON.stringify(s))},this.key=`matrix-setting-${e}`;const r=localStorage.getItem(this.key);let i=n;if(r!==null)try{i=JSON.parse(r)}catch(s){k.warn(`Invalid value stored for setting ${e}: ${r}.`,s)}this._value=new bf(i),this.value=this._value}}function Vm(t){return[jt(t.value),t.setValue]}const kL=new qp("opt-in-analytics",null),hI=()=>{const t=Vm(kL);return zt.instance.isEnabled()?t:[!1,null]},jQe=new qp("developer-settings-tab",!1),aue=new qp("duplicate-tiles",0),HQe=new qp("audio-input",void 0),KQe=new qp("audio-output",void 0),VQe=new qp("video-input",void 0),OG=new qp("always-show-self",!0);var pI=(t=>(t[t.Guest=0]="Guest",t[t.Registered=1]="Registered",t))(pI||{});const Ha=class Ha{constructor(e){var r,i;this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.sanitizeProperties=(s,o)=>(this.anonymity==1&&(s.$referrer=null,s.$referring_domain=null,s.$initial_referrer=null,s.$initial_referring_domain=null,s.$device_id=null),s.$current_url=s.$current_url.split("/").slice(0,3).join(""),s),this.eventCallEnded=new mZe,this.eventSignup=new yZe,this.eventCallStarted=new vZe,this.eventLogin=new _Ze,this.eventMuteMicrophone=new bZe,this.eventMuteCamera=new SZe,this.eventUndecryptableToDevice=new wZe,this.eventQualitySurvey=new EZe,this.eventCallDisconnected=new TZe,this.eventCallConnectDuration=new CZe;const n={project_api_key:(r=on.get().posthog)==null?void 0:r.api_key,api_host:(i=on.get().posthog)==null?void 0:i.api_host};if(n.project_api_key&&n.api_host){if(Ha.getPlatformProperties().matrixBackend==="embedded"){const{analyticsID:s}=hc();kL.setValue(!!s)}this.posthog.init(n.project_api_key,{api_host:n.api_host,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0}else k.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1;this.startListeningToSettingsChanges()}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new Ha(oZe)),this.internalInstance}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){var n,r;return{appVersion:"1dc6584911fe333d951379e410225ec75a7f8d9f",matrixBackend:rt?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:rt||(r=(n=window.matrixclient)==null?void 0:n.getCrypto())==null?void 0:r.getVersion()}}capture(e,n,r){this.enabled&&this.posthog.capture(e,{...n},r)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(e==0||e==1)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(this.anonymity==2&&this.enabled){let n=await this.getAnalyticsId();try{if(!n&&!rt){const r=e();await this.setAccountAnalyticsId(r),n=await this.hashedEcAnalyticsId(r)}}catch(r){k.log("Unable to identify user for tracking"+(r==null?void 0:r.toString()))}n?this.posthog.identify(n):k.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const e=window.matrixclient;let n;if(rt)n=hc().analyticsID;else{const r=await e.getAccountDataFromServer(Ha.ANALYTICS_EVENT_TYPE);n=r==null?void 0:r.id}return n?await this.hashedEcAnalyticsId(n):null}async hashedEcAnalyticsId(e){const n=window.matrixclient,r="ec"+e+n.getUserId(),i=await crypto.subtle.digest("sha-256",Lle.Buffer.from(r,"utf-8")),s=new Int32Array(i);return Array.from(s).map(o=>Math.abs(o).toString(16).padStart(2,"0")).join("")}async setAccountAnalyticsId(e){if(!rt){const n=window.matrixclient,r=await n.getAccountDataFromServer(Ha.ANALYTICS_EVENT_TYPE);await n.setAccountData(Ha.ANALYTICS_EVENT_TYPE,Object.assign({id:e},r))}}getAnonymity(){return this.anonymity}logout(){this.enabled&&this.posthog.reset(),this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>k.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=Ha.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:this.registrationType==0?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(this.anonymity===2&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(Ha.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),this.anonymity!==0&&this.updateSuperProperties())}trackEvent({eventName:e,...n},r){const i=()=>{this.anonymity==0||this.anonymity==1||this.capture(e,n,r)};this.identificationPromise?this.identificationPromise.then(i,s=>{k.error("Failed to identify user for tracking",s)}):i()}startListeningToSettingsChanges(){kL.value.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>k.log("Could not identify user"))})}setRegistrationType(e){this.registrationType=e,!(this.anonymity==0||this.anonymity==1)&&this.updateSuperProperties()}};Ha.ANALYTICS_EVENT_TYPE="im.vector.analytics",Ha.internalInstance=null;let zt=Ha;const qQe=2*60*1e3;class GQe{async forceFlush(){}onStart(e){try{switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipStart(e);return;case"matrix.groupCallMembership.summaryReport":this.onSummaryReportStart(e);return}}catch(n){k.debug(n)}}onEnd(e){switch(e.name){case"matrix.groupCallMembership":this.onGroupCallMembershipEnd(e);return}}get prevCall(){const e=localStorage.getItem("matrix-prev-call");if(e===null)return null;try{return JSON.parse(e)}catch(n){return k.warn("Invalid prev call data",e,"error:",n),null}}set prevCall(e){localStorage.setItem("matrix-prev-call",JSON.stringify(e))}onGroupCallMembershipStart(e){const n=this.prevCall,r=e.attributes["matrix.confId"];if(n!==null&&r===n.callId){const i=pq(e.startTime)-n.hangupTs;i<=qQe&&zt.instance.trackEvent({eventName:"Rejoin",callId:n.callId,rejoinDuration:i})}}onGroupCallMembershipEnd(e){this.prevCall={callId:e.attributes["matrix.confId"],hangupTs:pq(e.endTime)}}onSummaryReportStart(e){const n=e.events.find(r=>r.name==="matrix.stats.summary");if(n!==void 0){const r=n.attributes;if(r){const i=`${r["matrix.stats.summary.percentageReceivedMedia"]}`,s=`${r["matrix.stats.summary.percentageReceivedVideoMedia"]}`,o=`${r["matrix.stats.summary.percentageReceivedAudioMedia"]}`,a=`${r["matrix.stats.summary.maxJitter"]}`,c=`${r["matrix.stats.summary.maxPacketLoss"]}`,l=`${r["matrix.stats.summary.peerConnections"]}`,u=`${r["matrix.stats.summary.percentageConcealedAudio"]}`,d=`${r["matrix.stats.summary.opponentUsersInCall"]}`,f=`${r["matrix.stats.summary.opponentDevicesInCall"]}`,p=`${r["matrix.stats.summary.diffDevicesToPeerConnections"]}`,m=`${r["matrix.stats.summary.ratioPeerConnectionToDevices"]}`;zt.instance.trackEvent({eventName:"MediaReceived",callId:e.attributes["matrix.confId"],mediaReceived:i,audioReceived:o,videoReceived:s,maxJitter:a,maxPacketLoss:c,peerConnections:l,percentageConcealedAudio:u,opponentUsersInCall:d,opponentDevicesInCall:f,diffDevicesToPeerConnections:p,ratioPeerConnectionToDevices:m},{send_instantly:!0})}}}async shutdown(){return Promise.resolve()}}const MG=t=>Object.entries(t).map(([e,n])=>({key:e,type:typeof n,value:n}));class zQe{constructor(){this.spans=[]}async forceFlush(){}onStart(e){this.spans.push(e)}onEnd(){}dump(){const e=Date.now()*1e3,n=new Map;for(const s of this.spans){const o=s.spanContext().traceId;let a=n.get(o);a===void 0&&(a=[],n.set(o,a)),a.push(s)}const r="p1",i={[r]:{serviceName:"element-call",tags:[]},warnings:null};return JSON.stringify({total:0,limit:0,offset:0,errors:null,data:[...n.entries()].map(([s,o])=>({traceID:s,warnings:null,processes:i,spans:o.map(a=>{const c=a.spanContext(),l=RO(a.startTime),u=a.duration[0]===-1?e-l:RO(a.duration);return{traceID:s,spanID:c.spanId,operationName:a.name,processID:r,warnings:null,startTime:l,duration:u,references:a.parentSpanId===void 0?[]:[{refType:"CHILD_OF",traceID:s,spanID:a.parentSpanId}],tags:MG(a.attributes),logs:a.events.map(d=>({timestamp:RO(d.time),fields:[...MG(d.attributes??{}),{key:"event",type:"string",value:d.name}]}))}})}))})}async shutdown(){}}const WQe="element-call";let nh;class gI{static globalInit(){var r,i,s;const e=on.get(),n=!!((r=e.opentelemetry)!=null&&r.collector_url);(!nh||nh.isOtlpEnabled!==n)&&(k.info("(Re)starting OpenTelemetry debug reporting"),nh==null||nh.dispose(),nh=new gI((i=e.opentelemetry)==null?void 0:i.collector_url,(s=e.rageshake)==null?void 0:s.submit_url))}static get instance(){return nh}constructor(e,n){const r={resource:new Z5({[gWe.SERVICE_NAME]:WQe})};this._provider=new xJe(r),e?(k.info("Enabling OTLP collector with URL "+e),this.otlpExporter=new TJe({url:e}),this._provider.addSpanProcessor(new AYe(this.otlpExporter))):k.info("OTLP collector disabled"),n&&(this.rageshakeProcessor=new zQe,this._provider.addSpanProcessor(this.rageshakeProcessor)),this._provider.addSpanProcessor(new GQe),wO.trace.setGlobalTracerProvider(this._provider),this._tracer=wO.trace.getTracer("my-element-call-otl-tracer")}dispose(){var e;wO.trace.disable(),(e=this._provider)==null||e.shutdown().catch(n=>{k.error("Failed to shutdown OpenTelemetry",n)})}get isOtlpEnabled(){return!!this.otlpExporter}get tracer(){return this._tracer}get provider(){return this._provider}}const AG=t=>{const e=new TextEncoder().encode(t);return new Blob([jVe.gzip(e)])};async function YQe(t,e){e.append("crypto_version",t.getVersion());const n=await t.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];e.append("device_keys",r.join(", "));const i=await t.getCrossSigningStatus();e.append("cross_signing_ready",String(await t.isCrossSigningReady())),e.append("cross_signing_key",await t.getCrossSigningKeyId()??"n/a"),e.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),e.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),e.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),e.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function JQe(t,e,n){const r=t.secretStorage;n.append("secret_storage_ready",String(await e.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await t.isKeyBackupKeyStored()));const i=await e.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function a9(){const{client:t}=Df(),[{sending:e,sent:n,error:r},i]=y.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:y.useCallback(async o=>{var a;if(!((a=on.get().rageshake)!=null&&a.submit_url))throw new Error("No rageshake URL is configured");if(!e)try{i({sending:!0,sent:!1,error:void 0});let c="UNKNOWN";window.navigator&&window.navigator.userAgent&&(c=window.navigator.userAgent);let l="UNKNOWN";try{l=String(window.matchMedia("(pointer: coarse)").matches)}catch(p){k.warn("Could not get coarse pointer for rageshake submit.",p)}let u=o.rageshakeRequestId?`Rageshake ${o.rageshakeRequestId}`:"";o.description&&(u+=`: ${o.description}`);const d=new FormData;if(d.append("text",u??"User did not supply any additional text."),d.append("app","matrix-video-chat"),d.append("version","1dc6584911fe333d951379e410225ec75a7f8d9f"),d.append("user_agent",c),d.append("installed_pwa","false"),d.append("touch_input",l),d.append("call_backend","livekit"),d.append("hostname",window.location.hostname),t){const p=t.getUserId(),m=t.getUser(p);d.append("display_name",(m==null?void 0:m.displayName)??""),d.append("user_id",t.credentials.userId??""),d.append("device_id",t.deviceId??""),o.roomId&&d.append("room_id",o.roomId);const v=t.getCrypto();v&&(await YQe(v,d),await JQe(t,v,d))}if(o.label&&d.append("label",o.label),navigator.storage&&navigator.storage.persisted)try{d.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(p){k.warn("coulr not get navigator peristed storage",p)}else if(document.hasStorageAccess)try{d.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(p){k.warn("could not get storage access",p)}if(navigator.storage&&navigator.storage.estimate)try{const p=await navigator.storage.estimate();d.append("storageManager_quota",String(p.quota)),d.append("storageManager_usage",String(p.usage)),p.usageDetails&&Object.keys(p.usageDetails).forEach(m=>{d.append(`storageManager_usage_${m}`,String(p.usageDetails[m]))})}catch(p){k.warn("could not obatain storage estimate",p)}if(o.sendLogs){const p=await JVe();for(const m of p)d.append("compressed-log",AG(m.lines),m.id);d.append("file",AG(gI.instance.rageshakeProcessor.dump()),"traces.json.gz")}o.rageshakeRequestId&&d.append("group_call_rageshake_request_id",o.rageshakeRequestId);const f=await fetch(on.get().rageshake.submit_url,{method:"POST",body:d});if(f.status!==200)throw new Error(`Failed to submit feedback: receive HTTP ${f.status} ${f.statusText}`);i({sending:!1,sent:!0,error:void 0})}catch(c){i({sending:!1,sent:!1,error:c}),k.error(c)}},[t,e]),sending:e,sent:n,error:r}}function XQe(){const{client:t}=Df();return y.useCallback((n,r)=>{t.sendEvent(n,"org.matrix.rageshake_request",{request_id:r}).catch(i=>{k.error("Failed to send org.matrix.rageshake_request event",i)})},[t])}function ZQe(t){const[e,n]=y.useState(!1),r=y.useCallback(()=>n(!1),[n]),{client:i}=Df(),[s,o]=y.useState();return y.useEffect(()=>{if(!i)return;const a=c=>{c.getType()==="org.matrix.rageshake_request"&&t===c.getRoomId()&&i.getUserId()!==c.getSender()&&(o(c.getContent().request_id),n(!0))};return i.on(qe.Event,a),()=>{i.removeListener(qe.Event,a)}},[n,t,i]),{rageshakeRequestId:s??"",roomId:t,open:e,onDismiss:r}}const c9=({description:t})=>{var c;const{submitRageshake:e,sending:n,sent:r,error:i}=a9(),{t:s}=ht(),o=y.useCallback(()=>{e({description:t,sendLogs:!0}).catch(l=>{k.error("Failed to send rageshake",l)})},[e,t]);if(!((c=on.get().rageshake)!=null&&c.submit_url))return null;let a=null;if(n)a=b.jsx("span",{children:s("rageshake_sending")});else if(r)a=b.jsx("div",{children:s("rageshake_sent")});else{let l=s("rageshake_send_logs");i&&(l=s("rageshake_button_error_caption")),a=b.jsx(tn,{onClick:o,className:wV.wideButton,disabled:n,children:l})}return b.jsx("div",{className:wV.rageshakeControl,children:a})},qh=({className:t,children:e})=>{const{hideHeader:n}=Fp();return b.jsxs("div",{className:Pe(Nm.page,t),children:[b.jsxs(Af,{children:[b.jsx(Bp,{children:!n&&b.jsx(gp,{})}),b.jsx(jp,{})]}),b.jsx("div",{className:Nm.container,children:b.jsx("div",{className:Nm.content,children:e})})]})},mI=({error:t})=>{const e=Ku(),{confineToRoom:n}=Fp(),{t:r}=ht();y.useEffect(()=>{k.error(t),$R(t)},[t]);const i=y.useCallback(()=>{window.location.href="/"},[]);return b.jsxs(qh,{children:[b.jsx("h1",{children:r("common.error")}),b.jsx("p",{children:t instanceof TN?t.translatedMessage:t.message}),b.jsx(c9,{description:`***Error View***: ${t.message}`}),!n&&(e.pathname==="/"?b.jsx(tn,{className:Nm.homeLink,onClick:i,children:r("return_home_button")}):b.jsx(EN,{className:Nm.homeLink,to:"/",children:r("return_home_button")}))]})},QQe=()=>{var n;const{t}=ht(),e=y.useCallback(()=>{window.location.href="/"},[]);return b.jsxs(qh,{children:[b.jsx(ps,{i18nKey:"full_screen_view_h1",children:b.jsx("h1",{children:"Oops, something's gone wrong."})}),((n=on.get().rageshake)==null?void 0:n.submit_url)&&b.jsx(ps,{i18nKey:"full_screen_view_description",children:b.jsx("p",{children:"Submitting debug logs will help us track down the problem."})}),b.jsx(c9,{description:"***Soft Crash***"}),b.jsx(tn,{className:Nm.wideButton,onClick:e,children:t("return_home_button")})]})},vI=()=>{const{t}=ht();return b.jsx(qh,{children:b.jsx("h1",{children:t("common.loading")})})},cue=y.createContext(void 0),yI=()=>y.useContext(cue);function Df(){var r;let t,e;const n=yI();return(n==null?void 0:n.state)==="valid"&&(t=(r=n.authenticated)==null?void 0:r.client,e=n.setClient),{client:t,setClient:e}}function l9(){var c,l,u;const t=yI();let e,n,r=!1,i=!0,s,o=!1,a;return(t==null?void 0:t.state)==="valid"?(e=(c=t.authenticated)==null?void 0:c.client,n=t.setClient,r=((l=t.authenticated)==null?void 0:l.isPasswordlessUser)??!1,i=!1,o=e!==void 0,a=(u=t.authenticated)==null?void 0:u.logout):(t==null?void 0:t.state)==="error"&&(s=t.error,i=!1),{client:e,setClient:n,passwordlessUser:r,loading:i,authenticated:o,logout:a,error:s}}const gE="BroadcastChannel"in window?new BroadcastChannel("load"):null,eet=({children:t})=>{const e=gc(),[n,r]=y.useState(void 0),i=y.useRef(!1);y.useEffect(()=>{i.current||(i.current=!0,tet().then(r).catch(v=>k.error(v)).finally(()=>i.current=!1))},[]);const s=y.useCallback(async v=>{const S=lue();!(n!=null&&n.client)||!S||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:S.user_id},user:S.user_id,password:S.tempPassword},v),LG({...S,passwordlessUser:!1}),r({client:n.client,passwordlessUser:!1}))},[n==null?void 0:n.client]),o=y.useCallback(v=>{const S=n==null?void 0:n.client,_=v==null?void 0:v.client;S&&S!==_&&S.stopClient(),v?(LG(v.session),r({client:v.client,passwordlessUser:v.session.passwordlessUser})):(Qk(),r(null))},[n==null?void 0:n.client]),a=y.useCallback(async()=>{const v=n==null?void 0:n.client;v&&(await v.logout(!0),await v.clearStores(),Qk(),r(null),e.push("/"),zt.instance.setRegistrationType(pI.Guest))},[e,n==null?void 0:n.client]),{t:c}=ht();y.useEffect(()=>{rt||gE==null||gE.postMessage({})},[]);const[l,u]=y.useState(void 0);S0(gE,"message",y.useCallback(()=>{n==null||n.client.stopClient(),u(D5("application_opened_another_tab",c))},[n==null?void 0:n.client,u,c]));const[d,f]=y.useState(!1),p=y.useMemo(()=>l?{state:"error",error:l}:n===void 0?void 0:{state:"valid",authenticated:n===null?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:s,logout:a},setClient:o,disconnected:d},[l,s,n,a,o,d]),m=y.useCallback((v,S,_)=>{f(net(v,_))},[]);return y.useEffect(()=>{if(n)return window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,zt.hasInstance()&&zt.instance.onLoginStatusChanged(),n.client&&n.client.on(qe.Sync,m),()=>{n.client&&n.client.removeListener(qe.Sync,m)}},[n,m]),l?b.jsx(mI,{error:l}):b.jsx(cue.Provider,{value:p,children:t})};async function tet(){var t;if(rt)return k.log("Using a matryoshka client"),{client:await rt.client,passwordlessUser:!1};try{const e=lue();if(!e)return k.log("No session stored; continuing without a client"),null;k.log("Using a standalone client");const{user_id:n,device_id:r,access_token:i,passwordlessUser:s}=e,o={baseUrl:on.defaultHomeserverUrl(),accessToken:i,userId:n,deviceId:r,fallbackICEServerAllowed:L5,livekitServiceURL:(t=on.get().livekit)==null?void 0:t.livekit_service_url};try{return{client:await wN(o,!0),passwordlessUser:s}}catch(a){if(a instanceof Ii&&a.errcode==="M_UNKNOWN_TOKEN")return k.log("The session from local store is invalid; continuing without a client"),Qk(),null;throw a}}catch(e){throw Qk(),e}}const Qk=()=>localStorage.removeItem("matrix-auth-store"),LG=t=>localStorage.setItem("matrix-auth-store",JSON.stringify(t)),lue=()=>{const t=localStorage.getItem("matrix-auth-store");if(t)return JSON.parse(t)},net=(t,e)=>{var n;return t==="ERROR"&&((n=e==null?void 0:e.error)==null?void 0:n.name)==="ConnectionError"};function tS(t){const[{success:e,loading:n,displayName:r,avatarUrl:i,error:s},o]=y.useState(()=>{let c;return t&&(c=t.getUser(t.getUserId())??void 0),{success:!1,loading:!1,displayName:c==null?void 0:c.rawDisplayName,avatarUrl:c==null?void 0:c.avatarUrl,error:void 0}});y.useEffect(()=>{const c=(u,{displayName:d,avatarUrl:f})=>{o({success:!1,loading:!1,displayName:d,avatarUrl:f,error:void 0})};let l;if(t){const u=t.getUserId();l=t.getUser(u),l==null||l.on(Id.DisplayName,c),l==null||l.on(Id.AvatarUrl,c)}return()=>{l&&(l.removeListener(Id.DisplayName,c),l.removeListener(Id.AvatarUrl,c))}},[t]);const a=y.useCallback(async({displayName:c,avatar:l,removeAvatar:u})=>{if(t){o(d=>({...d,loading:!0,error:void 0,success:!1}));try{await t.setDisplayName(c);let d;u?await t.setAvatarUrl(""):l&&({content_uri:d}=await t.uploadContent(l),await t.setAvatarUrl(d)),o(f=>({...f,displayName:c,avatarUrl:u?void 0:d??f.avatarUrl,loading:!1,success:!0}))}catch(d){o(f=>({...f,loading:!1,error:d instanceof Error?d:Error(d),success:!1}))}}else k.error("Client not initialized before calling saveProfile")},[t]);return{loading:n,error:s,displayName:r,avatarUrl:i,saveProfile:a,success:e}}var ret="Portal",uue=y.forwardRef((t,e)=>{var a;const{container:n,...r}=t,[i,s]=y.useState(!1);cl(()=>s(!0),[]);const o=n||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?IQ.createPortal(b.jsx(wt.div,{...r,ref:e}),o):null});uue.displayName=ret;function iet(t,e){return y.useReducer((n,r)=>e[n][r]??n,t)}var _I=t=>{const{present:e,children:n}=t,r=set(e),i=typeof n=="function"?n({present:r.isPresent}):y.Children.only(n),s=cn(r.ref,oet(i));return typeof n=="function"||r.isPresent?y.cloneElement(i,{ref:s}):null};_I.displayName="Presence";function set(t){const[e,n]=y.useState(),r=y.useRef({}),i=y.useRef(t),s=y.useRef("none"),o=t?"mounted":"unmounted",[a,c]=iet(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return y.useEffect(()=>{const l=mE(r.current);s.current=a==="mounted"?l:"none"},[a]),cl(()=>{const l=r.current,u=i.current;if(u!==t){const f=s.current,p=mE(l);t?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),cl(()=>{if(e){const l=d=>{const p=mE(r.current).includes(d.animationName);d.target===e&&p&&Ip.flushSync(()=>c("ANIMATION_END"))},u=d=>{d.target===e&&(s.current=mE(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",l),e.addEventListener("animationend",l),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",l),e.removeEventListener("animationend",l)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:y.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function mE(t){return(t==null?void 0:t.animationName)||"none"}function oet(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var due=lie(),qO=function(){},bI=y.forwardRef(function(t,e){var n=y.useRef(null),r=y.useState({onScrollCapture:qO,onWheelCapture:qO,onTouchMoveCapture:qO}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,u=t.enabled,d=t.shards,f=t.sideCar,p=t.noIsolation,m=t.inert,v=t.allowPinchZoom,S=t.as,_=S===void 0?"div":S,w=t.gapMode,T=HD(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=f,I=cie([n,e]),R=Ji(Ji({},T),i);return y.createElement(y.Fragment,null,u&&y.createElement(C,{sideCar:due,removeScrollBar:l,shards:d,noIsolation:p,inert:m,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:w}),o?y.cloneElement(y.Children.only(a),Ji(Ji({},R),{ref:I})):y.createElement(_,Ji({},R,{className:c,ref:I}),a))});bI.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};bI.classNames={fullWidth:b0,zeroRight:_0};var RL=!1;if(typeof window<"u")try{var vE=Object.defineProperty({},"passive",{get:function(){return RL=!0,!0}});window.addEventListener("test",vE,vE),window.removeEventListener("test",vE,vE)}catch{RL=!1}var Eg=RL?{passive:!1}:!1,aet=function(t){return t.tagName==="TEXTAREA"},fue=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!aet(t)&&n[e]==="visible")},cet=function(t){return fue(t,"overflowY")},uet=function(t){return fue(t,"overflowX")},DG=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=hue(t,r);if(i){var s=pue(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},det=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},fet=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},hue=function(t,e){return t==="v"?cet(e):uet(e)},pue=function(t,e){return t==="v"?det(e):fet(e)},het=function(t,e){return t==="h"&&e==="rtl"?-1:1},pet=function(t,e,n,r,i){var s=het(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,u=o>0,d=0,f=0;do{var p=pue(t,a),m=p[0],v=p[1],S=p[2],_=v-S-s*m;(m||_)&&hue(t,a)&&(d+=_,f+=m),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&(Math.abs(d)<1||!i)||!u&&(Math.abs(f)<1||!i))&&(l=!0),l},yE=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},NG=function(t){return[t.deltaX,t.deltaY]},UG=function(t){return t&&"current"in t?t.current:t},get=function(t,e){return t[0]===e[0]&&t[1]===e[1]},met=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},vet=0,Tg=[];function yet(t){var e=y.useRef([]),n=y.useRef([0,0]),r=y.useRef(),i=y.useState(vet++)[0],s=y.useState(KD)[0],o=y.useRef(t);y.useEffect(function(){o.current=t},[t]),y.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=ll([t.lockRef.current],(t.shards||[]).map(UG),!0).filter(Boolean);return v.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=y.useCallback(function(v,S){if("touches"in v&&v.touches.length===2)return!o.current.allowPinchZoom;var _=yE(v),w=n.current,T="deltaX"in v?v.deltaX:w[0]-_[0],C="deltaY"in v?v.deltaY:w[1]-_[1],I,R=v.target,O=Math.abs(T)>Math.abs(C)?"h":"v";if("touches"in v&&O==="h"&&R.type==="range")return!1;var A=DG(O,R);if(!A)return!0;if(A?I=O:(I=O==="v"?"h":"v",A=DG(O,R)),!A)return!1;if(!r.current&&"changedTouches"in v&&(T||C)&&(r.current=I),!I)return!0;var U=r.current||I;return pet(U,S,v,U==="h"?T:C,!0)},[]),c=y.useCallback(function(v){var S=v;if(!(!Tg.length||Tg[Tg.length-1]!==s)){var _="deltaY"in S?NG(S):yE(S),w=e.current.filter(function(I){return I.name===S.type&&(I.target===S.target||S.target===I.shadowParent)&&get(I.delta,_)})[0];if(w&&w.should){S.cancelable&&S.preventDefault();return}if(!w){var T=(o.current.shards||[]).map(UG).filter(Boolean).filter(function(I){return I.contains(S.target)}),C=T.length>0?a(S,T[0]):!o.current.noIsolation;C&&S.cancelable&&S.preventDefault()}}},[]),l=y.useCallback(function(v,S,_,w){var T={name:v,delta:S,target:_,should:w,shadowParent:_et(_)};e.current.push(T),setTimeout(function(){e.current=e.current.filter(function(C){return C!==T})},1)},[]),u=y.useCallback(function(v){n.current=yE(v),r.current=void 0},[]),d=y.useCallback(function(v){l(v.type,NG(v),v.target,a(v,t.lockRef.current))},[]),f=y.useCallback(function(v){l(v.type,yE(v),v.target,a(v,t.lockRef.current))},[]);y.useEffect(function(){return Tg.push(s),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,Eg),document.addEventListener("touchmove",c,Eg),document.addEventListener("touchstart",u,Eg),function(){Tg=Tg.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,Eg),document.removeEventListener("touchmove",c,Eg),document.removeEventListener("touchstart",u,Eg)}},[]);var p=t.removeScrollBar,m=t.inert;return y.createElement(y.Fragment,null,m?y.createElement(s,{styles:met(i)}):null,p?y.createElement(hie,{gapMode:t.gapMode}):null)}function _et(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const bet=die(due,yet);var gue=y.forwardRef(function(t,e){return y.createElement(bI,Ji({},t,{ref:e,sideCar:bet}))});gue.classNames=bI.classNames;var u9="Dialog",[mue,pht]=Dp(u9),[wet,yc]=mue(u9),vue=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=y.useRef(null),c=y.useRef(null),[l=!1,u]=Fb({prop:r,defaultProp:i,onChange:s});return b.jsx(wet,{scope:e,triggerRef:a,contentRef:c,contentId:_a(),titleId:_a(),descriptionId:_a(),open:l,onOpenChange:u,onOpenToggle:y.useCallback(()=>u(d=>!d),[u]),modal:o,children:n})};vue.displayName=u9;var yue="DialogTrigger",_ue=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=yc(yue,n),s=cn(e,i.triggerRef);return b.jsx(wt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":h9(i.open),...r,ref:s,onClick:Je(t.onClick,i.onOpenToggle)})});_ue.displayName=yue;var d9="DialogPortal",[Eet,bue]=mue(d9,{forceMount:void 0}),Sue=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=yc(d9,e);return b.jsx(Eet,{scope:e,forceMount:n,children:y.Children.map(r,o=>b.jsx(_I,{present:n||s.open,children:b.jsx(uue,{asChild:!0,container:i,children:o})}))})};Sue.displayName=d9;var e2="DialogOverlay",wue=y.forwardRef((t,e)=>{const n=bue(e2,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=yc(e2,t.__scopeDialog);return s.modal?b.jsx(_I,{present:r||s.open,children:b.jsx(Tet,{...i,ref:e})}):null});wue.displayName=e2;var Tet=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=yc(e2,n);return b.jsx(gue,{as:_f,allowPinchZoom:!0,shards:[i.contentRef],children:b.jsx(wt.div,{"data-state":h9(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Sp="DialogContent",Eue=y.forwardRef((t,e)=>{const n=bue(Sp,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=yc(Sp,t.__scopeDialog);return b.jsx(_I,{present:r||s.open,children:s.modal?b.jsx(Cet,{...i,ref:e}):b.jsx(ket,{...i,ref:e})})});Eue.displayName=Sp;var Cet=y.forwardRef((t,e)=>{const n=yc(Sp,t.__scopeDialog),r=y.useRef(null),i=cn(e,n.contentRef,r);return y.useEffect(()=>{const s=r.current;if(s)return jD(s)},[]),b.jsx(Tue,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Je(t.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Je(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Je(t.onFocusOutside,s=>s.preventDefault())})}),ket=y.forwardRef((t,e)=>{const n=yc(Sp,t.__scopeDialog),r=y.useRef(!1),i=y.useRef(!1);return b.jsx(Tue,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=t.onCloseAutoFocus)==null||o.call(t,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var c,l;(c=t.onInteractOutside)==null||c.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((l=n.triggerRef.current)==null?void 0:l.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Tue=y.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=yc(Sp,n),c=y.useRef(null),l=cn(e,c);return UD(),b.jsxs(b.Fragment,{children:[b.jsx(qR,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:b.jsx(VR,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":h9(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(Ret,{titleId:a.titleId}),b.jsx(xet,{contentRef:c,descriptionId:a.descriptionId})]})]})}),f9="DialogTitle",Cue=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=yc(f9,n);return b.jsx(wt.h2,{id:i.titleId,...r,ref:e})});Cue.displayName=f9;var kue="DialogDescription",Rue=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=yc(kue,n);return b.jsx(wt.p,{id:i.descriptionId,...r,ref:e})});Rue.displayName=kue;var Iue="DialogClose",xue=y.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=yc(Iue,n);return b.jsx(wt.button,{type:"button",...r,ref:e,onClick:Je(t.onClick,()=>i.onOpenChange(!1))})});xue.displayName=Iue;function h9(t){return t?"open":"closed"}var Pue="DialogTitleWarning",[ght,Oue]=ODe(Pue,{contentName:Sp,titleName:f9,docsSlug:"dialog"}),Ret=({titleId:t})=>{const e=Oue(Pue),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return y.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Iet="DialogDescriptionWarning",xet=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Oue(Iet).contentName}}.`;return y.useEffect(()=>{var s;const i=(s=t.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},p9=vue,Pet=_ue,g9=Sue,m9=wue,v9=Eue,y9=Cue,Oet=Rue,_9=xue;function Met(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const Mue=re.createContext({drawerRef:{current:null},overlayRef:{current:null},scaleBackground:()=>{},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,handleOnly:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},visible:!1,closeDrawer:()=>{},setVisible:()=>{},direction:"bottom"}),SI=()=>{const t=re.useContext(Mue);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};Met("[vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1)}[vaul-drawer][vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[vaul-drawer][vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[vaul-drawer][vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[vaul-drawer][vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}.vaul-dragging .vaul-scrollable [vault-drawer-direction=top]{overflow-y:hidden!important}.vaul-dragging .vaul-scrollable [vault-drawer-direction=bottom]{overflow-y:hidden!important}.vaul-dragging .vaul-scrollable [vault-drawer-direction=left]{overflow-x:hidden!important}.vaul-dragging .vaul-scrollable [vault-drawer-direction=right]{overflow-x:hidden!important}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[vaul-overlay]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[vaul-overlay][vaul-drawer-visible=true]{opacity:1}[vaul-drawer]::after{content:'';position:absolute;background:inherit;background-color:inherit}[vaul-drawer][vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[vaul-drawer][vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[vaul-drawer][vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[vaul-drawer][vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[vaul-handle]{display:block;position:relative;opacity:.8;margin-left:auto;margin-right:auto;height:5px;width:56px;border-radius:1rem;touch-action:pan-y;cursor:grab}[vaul-handle]:active,[vaul-handle]:hover{opacity:1}[vaul-handle]:active{cursor:grabbing}[vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}[vaul-overlay][vaul-snap-points=true]:not([vaul-snap-points-overlay=true]):not([data-state=closed]){opacity:0}[vaul-overlay][vaul-snap-points-overlay=true]:not([vaul-drawer-visible=false]){opacity:1}@media (hover:hover) and (pointer:fine){[vaul-drawer]{user-select:none}}@media (pointer:fine){[vaul-handle-hitarea]:{width:100%;height:100%}}");const Aet=typeof window<"u"?y.useLayoutEffect:y.useEffect;function IL(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}function Let(){return b9(/^Mac/)}function Det(){return b9(/^iPhone/)}function Net(){return b9(/^iPad/)||Let()&&navigator.maxTouchPoints>1}function Aue(){return Det()||Net()}function b9(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const GO=typeof document<"u"&&window.visualViewport;function $G(t){let e=window.getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function Lue(t){for($G(t)&&(t=t.parentElement);t&&!$G(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const Uet=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let _E=0,zO;function $et(t={}){let{isDisabled:e}=t;Aet(()=>{if(!e)return _E++,_E===1&&(Aue()?zO=Bet():zO=Fet()),()=>{_E--,_E===0&&zO()}},[e])}function Fet(){return IL(Due(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`))}function Bet(){let t,e=0,n=d=>{t=Lue(d.target),!(t===document.documentElement&&t===document.body)&&(e=d.changedTouches[0].pageY)},r=d=>{if(!t||t===document.documentElement||t===document.body){d.preventDefault();return}let f=d.changedTouches[0].pageY,p=t.scrollTop,m=t.scrollHeight-t.clientHeight;m!==0&&((p<=0&&f>e||p>=m&&f<e)&&d.preventDefault(),e=f)},i=d=>{let f=d.target;xL(f)&&f!==document.activeElement&&(d.preventDefault(),f.style.transform="translateY(-2000px)",f.focus(),requestAnimationFrame(()=>{f.style.transform=""}))},s=d=>{let f=d.target;xL(f)&&(f.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{f.style.transform="",GO&&(GO.height<window.innerHeight?requestAnimationFrame(()=>{FG(f)}):GO.addEventListener("resize",()=>FG(f),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,c=window.pageYOffset,l=IL(Due(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=IL(h1(document,"touchstart",n,{passive:!1,capture:!0}),h1(document,"touchmove",r,{passive:!1,capture:!0}),h1(document,"touchend",i,{passive:!1,capture:!0}),h1(document,"focus",s,!0),h1(window,"scroll",o));return()=>{l(),u(),window.scrollTo(a,c)}}function Due(t,e,n){let r=t.style[e];return t.style[e]=n,()=>{t.style[e]=r}}function h1(t,e,n,r){return t.addEventListener(e,n,r),()=>{t.removeEventListener(e,n,r)}}function FG(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=Lue(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom;s>o&&(n.scrollTop+=i-r)}t=n.parentElement}}function xL(t){return t instanceof HTMLInputElement&&!Uet.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function jet(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function Het(...t){return e=>t.forEach(n=>jet(n,e))}function Nue(...t){return y.useCallback(Het(...t),t)}let p1=null;function Ket({isOpen:t,modal:e,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=re.useState(()=>typeof window<"u"?window.location.href:""),c=re.useRef(0),l=re.useCallback(()=>{if(p1===null&&t&&!s){p1={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:d,innerHeight:f}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-d}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const p=f-window.innerHeight;p&&c.current>=f&&(document.body.style.top=`${-(c.current+p)}px`)}),300)}},[t]),u=re.useCallback(()=>{if(p1!==null&&!s){const d=-parseInt(document.body.style.top,10),f=-parseInt(document.body.style.left,10);Object.assign(document.body.style,p1),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(f,d)}),p1=null}},[o]);return re.useEffect(()=>{function d(){c.current=window.scrollY}return d(),window.addEventListener("scroll",d),()=>{window.removeEventListener("scroll",d)}},[]),re.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&l(),e||window.setTimeout(()=>{u()},500)):u())},[t,r,o,e,n,l,u]),{restorePositionSetting:u}}const Uue=new WeakMap;function Dn(t,e,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){t.style.setProperty(i,s);return}r[i]=t.style[i],t.style[i]=s}),!n&&Uue.set(t,r)}function bE(t,e){if(!t||!(t instanceof HTMLElement))return;let n=Uue.get(t);n&&(e?t.style[e]=n[e]:Object.entries(n).forEach(([r,i])=>{t.style[r]=i}))}const Rr=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function SE(t,e){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[Rr(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[Rr(e)?5:4]):null)}function Vet(t){return 8*(Math.log(t+1)-2)}const wn={DURATION:.5,EASE:[.32,.72,0,1]},$ue=.4;function Fue(t){const e=re.useRef(t);return re.useEffect(()=>{e.current=t}),re.useMemo(()=>(...n)=>e.current==null?void 0:e.current.call(e,...n),[])}function qet({defaultProp:t,onChange:e}){const n=re.useState(t),[r]=n,i=re.useRef(r),s=Fue(e);return re.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function Get({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=qet({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Fue(n),c=re.useCallback(l=>{if(s){const d=typeof l=="function"?l(t):l;d!==t&&a(d)}else i(l)},[s,t,i,a]);return[o,c]}function zet({activeSnapPointProp:t,setActiveSnapPointProp:e,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom"}){const[c,l]=Get({prop:t,defaultProp:n==null?void 0:n[0],onChange:e}),u=re.useMemo(()=>c===(n==null?void 0:n[n.length-1])||null,[n,c]),d=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===c||!n,f=re.useMemo(()=>n==null?void 0:n.findIndex(T=>T===c),[n,c]),p=re.useMemo(()=>{var T;return(T=n==null?void 0:n.map(C=>{const I=typeof window<"u",R=typeof C=="string";let O=0;if(R&&(O=parseInt(C,10)),Rr(a)){const U=R?O:I?C*window.innerHeight:0;return I?a==="bottom"?window.innerHeight-U:-window.innerHeight+U:U}const A=R?O:I?C*window.innerWidth:0;return I?a==="right"?window.innerWidth-A:-window.innerWidth+A:A}))!=null?T:[]},[n]),m=re.useMemo(()=>f!==null?p==null?void 0:p[f]:null,[p,f]),v=re.useCallback(T=>{var C;const I=(C=p==null?void 0:p.findIndex(R=>R===T))!=null?C:null;o(I),Dn(r.current,{transition:`transform ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,transform:Rr(a)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`}),p&&I!==p.length-1&&I!==s?Dn(i.current,{transition:`opacity ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,opacity:"0"}):Dn(i.current,{transition:`opacity ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,opacity:"1"}),l(I!==null?n==null?void 0:n[I]:null)},[r.current,n,p,s,i,l]);re.useEffect(()=>{if(c||t){var T;const C=(T=n==null?void 0:n.findIndex(I=>I===t||I===c))!=null?T:-1;p&&C!==-1&&typeof p[C]=="number"&&v(p[C])}},[c,t,n,p,v]);function S({draggedDistance:T,closeDrawer:C,velocity:I,dismissible:R}){if(s===void 0)return;const O=a==="bottom"||a==="right"?(m??0)-T:(m??0)+T,A=f===s-1,U=f===0,N=T>0;if(A&&Dn(i.current,{transition:`opacity ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`}),I>2&&!N){R?C():v(p[0]);return}if(I>2&&N&&p&&n){v(p[n.length-1]);return}const L=p==null?void 0:p.reduce((X,G)=>typeof X!="number"||typeof G!="number"?X:Math.abs(G-O)<Math.abs(X-O)?G:X),j=Rr(a)?window.innerHeight:window.innerWidth;if(I>$ue&&Math.abs(T)<j*.4){const X=N?1:-1;if(X>0&&u){v(p[n.length-1]);return}if(U&&X<0&&R&&C(),f===null)return;v(p[f+X]);return}v(L)}function _({draggedDistance:T}){if(m===null)return;const C=a==="bottom"||a==="right"?m-T:m+T;(a==="bottom"||a==="right")&&C<p[p.length-1]||(a==="top"||a==="left")&&C>p[p.length-1]||Dn(r.current,{transform:Rr(a)?`translate3d(0, ${C}px, 0)`:`translate3d(${C}px, 0, 0)`})}function w(T,C){if(!n||typeof f!="number"||!p||s===void 0)return null;const I=f===s-1;if(f>=s&&C)return 0;if(I&&!C)return 1;if(!d&&!I)return null;const O=I?f+1:f-1,A=I?p[O]-p[O-1]:p[O+1]-p[O],U=T/Math.abs(A);return I?1-U:U}return{isLastSnapPoint:u,activeSnapPoint:c,shouldFade:d,getPercentageDragged:w,setActiveSnapPoint:l,activeSnapPointIndex:f,onRelease:S,onDrag:_,snapPointsOffset:p}}const Wet=.25,Yet=100,BG=8,rh=16,jG=26,WO="vaul-dragging";function Bue({open:t,onOpenChange:e,children:n,shouldScaleBackground:r,onDrag:i,onRelease:s,snapPoints:o,nested:a=!1,setBackgroundColorOnScale:c=!0,closeThreshold:l=Wet,scrollLockTimeout:u=Yet,dismissible:d=!0,handleOnly:f=!1,fadeFromIndex:p=o&&o.length-1,activeSnapPoint:m,setActiveSnapPoint:v,fixed:S,modal:_=!0,onClose:w,noBodyStyles:T,direction:C="bottom",preventScrollRestoration:I=!0,disablePreventScroll:R=!1}){var O;const[A=!1,U]=re.useState(!1),[N,L]=re.useState(!1),[j,X]=re.useState(!1),[G,F]=re.useState(!1),[V,J]=re.useState(!1),[K,W]=re.useState(!1),Y=re.useRef(null),ce=re.useRef(null),ue=re.useRef(null),Te=re.useRef(null),Re=re.useRef(null),Oe=re.useRef(!1),De=re.useRef(null),ze=re.useRef(0),et=re.useRef(!1),lt=re.useRef(0),Ae=re.useRef(null),yn=re.useRef(((O=Ae.current)==null?void 0:O.getBoundingClientRect().height)||0),un=re.useRef(0),je=re.useCallback(Ne=>{o&&Ne===Mr.length-1&&(ce.current=new Date)},[]),{activeSnapPoint:Bt,activeSnapPointIndex:_n,setActiveSnapPoint:Jn,onRelease:nn,snapPointsOffset:Mr,onDrag:kn,shouldFade:Di,getPercentageDragged:ar}=zet({snapPoints:o,activeSnapPointProp:m,setActiveSnapPointProp:v,drawerRef:Ae,fadeFromIndex:p,overlayRef:Y,onSnapPointChange:je,direction:C});$et({isDisabled:!A||V||!_||K||!N||R});const{restorePositionSetting:dn}=Ket({isOpen:A,modal:_,nested:a,hasBeenOpened:N,preventScrollRestoration:I,noBodyStyles:T});function Xe(){return(window.innerWidth-jG)/window.innerWidth}function Rn(Ne){var Fe;!d&&!o||Ae.current&&!Ae.current.contains(Ne.target)||(yn.current=((Fe=Ae.current)==null?void 0:Fe.getBoundingClientRect().height)||0,J(!0),ue.current=new Date,Aue()&&window.addEventListener("touchend",()=>Oe.current=!1,{once:!0}),Ne.target.setPointerCapture(Ne.pointerId),ze.current=Rr(C)?Ne.clientY:Ne.clientX)}function At(Ne,Fe){var tt;let _e=Ne;const nt=(tt=window.getSelection())==null?void 0:tt.toString(),ut=Ae.current?SE(Ae.current,C):null,Et=new Date;if(_e.hasAttribute("data-vaul-no-drag")||_e.closest("[data-vaul-no-drag]"))return!1;if(C==="right"||C==="left")return!0;if(ce.current&&Et.getTime()-ce.current.getTime()<500)return!1;if(ut!==null&&(C==="bottom"?ut>0:ut<0))return!0;if(nt&&nt.length>0)return!1;if(Re.current&&Et.getTime()-Re.current.getTime()<u&&ut===0||Fe)return Re.current=Et,!1;for(;_e;){if(_e.scrollHeight>_e.clientHeight){if(_e.scrollTop!==0)return Re.current=new Date,!1;if(_e.getAttribute("role")==="dialog")return!0}_e=_e.parentNode}return!0}function _c(Ne){if(Ae.current&&V){const Fe=C==="bottom"||C==="right"?1:-1,tt=(ze.current-(Rr(C)?Ne.clientY:Ne.clientX))*Fe,_e=tt>0,nt=o&&!d&&!_e;if(nt&&_n===0)return;const ut=Math.abs(tt),Et=document.querySelector("[vaul-drawer-wrapper]");let yt=ut/yn.current;const Xn=ar(ut,_e);if(Xn!==null&&(yt=Xn),nt&&yt>=1||!Oe.current&&!At(Ne.target,_e))return;if(Ae.current.classList.add(WO),Oe.current=!0,Dn(Ae.current,{transition:"none"}),Dn(Y.current,{transition:"none"}),o&&kn({draggedDistance:tt}),_e&&!o){const Zn=Vet(tt),Wr=Math.min(Zn*-1,0)*Fe;Dn(Ae.current,{transform:Rr(C)?`translate3d(0, ${Wr}px, 0)`:`translate3d(${Wr}px, 0, 0)`});return}const cr=1-yt;if((Di||p&&_n===p-1)&&(i==null||i(Ne,yt),Dn(Y.current,{opacity:`${cr}`,transition:"none"},!0)),Et&&Y.current&&r){const Zn=Math.min(Xe()+yt*(1-Xe()),1),Wr=8-yt*8,io=Math.max(0,14-yt*14);Dn(Et,{borderRadius:`${Wr}px`,transform:Rr(C)?`scale(${Zn}) translate3d(0, ${io}px, 0)`:`scale(${Zn}) translate3d(${io}px, 0, 0)`,transition:"none"},!0)}if(!o){const Zn=ut*Fe;Dn(Ae.current,{transform:Rr(C)?`translate3d(0, ${Zn}px, 0)`:`translate3d(${Zn}px, 0, 0)`})}}}re.useEffect(()=>()=>{ee(!1),dn()},[]),re.useEffect(()=>{var Ne;function Fe(){if(!Ae.current)return;const tt=document.activeElement;if(xL(tt)||et.current){var _e;const nt=((_e=window.visualViewport)==null?void 0:_e.height)||0;let ut=window.innerHeight-nt;const Et=Ae.current.getBoundingClientRect().height||0;un.current||(un.current=Et);const yt=Ae.current.getBoundingClientRect().top;if(Math.abs(lt.current-ut)>60&&(et.current=!et.current),o&&o.length>0&&Mr&&_n){const Xn=Mr[_n]||0;ut+=Xn}if(lt.current=ut,Et>nt||et.current){const Xn=Ae.current.getBoundingClientRect().height;let cr=Xn;Xn>nt&&(cr=nt-jG),S?Ae.current.style.height=`${Xn-Math.max(ut,0)}px`:Ae.current.style.height=`${Math.max(cr,nt-yt)}px`}else Ae.current.style.height=`${un.current}px`;o&&o.length>0&&!et.current?Ae.current.style.bottom="0px":Ae.current.style.bottom=`${Math.max(ut,0)}px`}}return(Ne=window.visualViewport)==null||Ne.addEventListener("resize",Fe),()=>{var tt;return(tt=window.visualViewport)==null?void 0:tt.removeEventListener("resize",Fe)}},[_n,o,Mr]);function $(){Ae.current&&(M(),w==null||w(),Dn(Ae.current,{transform:Rr(C)?`translate3d(0, ${C==="bottom"?"100%":"-100%"}, 0)`:`translate3d(${C==="right"?"100%":"-100%"}, 0, 0)`,transition:`transform ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`}),Dn(Y.current,{opacity:"0",transition:`opacity ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`}),ee(!1),setTimeout(()=>{X(!1),U(!1)},300),setTimeout(()=>{o&&Jn(o[0])},wn.DURATION*1e3))}re.useEffect(()=>{if(!A&&r){const Ne=setTimeout(()=>{bE(document.body)},200);return()=>clearTimeout(Ne)}},[A,r]),re.useLayoutEffect(()=>{t?(U(!0),L(!0)):$()},[t]),re.useEffect(()=>{G&&(e==null||e(A))},[A]),re.useEffect(()=>{F(!0)},[]);function x(){if(!Ae.current)return;const Ne=document.querySelector("[vaul-drawer-wrapper]"),Fe=SE(Ae.current,C);Dn(Ae.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`}),Dn(Y.current,{transition:`opacity ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,opacity:"1"}),r&&Fe&&Fe>0&&A&&Dn(Ne,{borderRadius:`${BG}px`,overflow:"hidden",...Rr(C)?{transform:`scale(${Xe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Xe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${wn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${wn.EASE.join(",")})`},!0)}function M(){!V||!Ae.current||(Ae.current.classList.remove(WO),Oe.current=!1,J(!1),Te.current=new Date)}function q(Ne){if(!V||!Ae.current)return;Ae.current.classList.remove(WO),Oe.current=!1,J(!1),Te.current=new Date;const Fe=SE(Ae.current,C);if(!At(Ne.target,!1)||!Fe||Number.isNaN(Fe)||ue.current===null)return;const tt=Te.current.getTime()-ue.current.getTime(),_e=ze.current-(Rr(C)?Ne.clientY:Ne.clientX),nt=Math.abs(_e)/tt;if(nt>.05&&(W(!0),setTimeout(()=>{W(!1)},200)),o){nn({draggedDistance:_e*(C==="bottom"||C==="right"?1:-1),closeDrawer:$,velocity:nt,dismissible:d}),s==null||s(Ne,!0);return}if(C==="bottom"||C==="right"?_e>0:_e<0){x(),s==null||s(Ne,!0);return}if(nt>$ue){$(),s==null||s(Ne,!1);return}var ut;const Et=Math.min((ut=Ae.current.getBoundingClientRect().height)!=null?ut:0,window.innerHeight);if(Fe>=Et*l){$(),s==null||s(Ne,!1);return}s==null||s(Ne,!0),x()}re.useEffect(()=>{A&&(Dn(document.documentElement,{scrollBehavior:"auto"}),ce.current=new Date,ee(!0))},[A]),re.useEffect(()=>{if(Ae.current&&j){var Ne;const Fe=Ae==null||(Ne=Ae.current)==null?void 0:Ne.querySelectorAll("*");Fe==null||Fe.forEach(tt=>{const _e=tt;(_e.scrollHeight>_e.clientHeight||_e.scrollWidth>_e.clientWidth)&&_e.classList.add("vaul-scrollable")})}},[j]);function ee(Ne){const Fe=document.querySelector("[vaul-drawer-wrapper]");!Fe||!r||(Ne?(c&&(T||(Dn(document.body,{background:document.body.style.backgroundColor||document.body.style.background}),Dn(document.body,{background:"black"},!0))),Dn(Fe,{borderRadius:`${BG}px`,overflow:"hidden",...Rr(C)?{transform:`scale(${Xe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Xe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${wn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${wn.EASE.join(",")})`})):(bE(Fe,"overflow"),bE(Fe,"transform"),bE(Fe,"borderRadius"),Dn(Fe,{transitionProperty:"transform, border-radius",transitionDuration:`${wn.DURATION}s`,transitionTimingFunction:`cubic-bezier(${wn.EASE.join(",")})`})))}function ae(Ne){const Fe=Ne?(window.innerWidth-rh)/window.innerWidth:1,tt=Ne?-rh:0;De.current&&window.clearTimeout(De.current),Dn(Ae.current,{transition:`transform ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,transform:`scale(${Fe}) translate3d(0, ${tt}px, 0)`}),!Ne&&Ae.current&&(De.current=setTimeout(()=>{const _e=SE(Ae.current,C);Dn(Ae.current,{transition:"none",transform:Rr(C)?`translate3d(0, ${_e}px, 0)`:`translate3d(${_e}px, 0, 0)`})},500))}function ge(Ne,Fe){if(Fe<0)return;const tt=Rr(C)?window.innerHeight:window.innerWidth,_e=(tt-rh)/tt,nt=_e+Fe*(1-_e),ut=-rh+Fe*rh;Dn(Ae.current,{transform:Rr(C)?`scale(${nt}) translate3d(0, ${ut}px, 0)`:`scale(${nt}) translate3d(${ut}px, 0, 0)`,transition:"none"})}function dt(Ne,Fe){const tt=Rr(C)?window.innerHeight:window.innerWidth,_e=Fe?(tt-rh)/tt:1,nt=Fe?-rh:0;Fe&&Dn(Ae.current,{transition:`transform ${wn.DURATION}s cubic-bezier(${wn.EASE.join(",")})`,transform:Rr(C)?`scale(${_e}) translate3d(0, ${nt}px, 0)`:`scale(${_e}) translate3d(${nt}px, 0, 0)`})}return re.createElement(p9,{modal:_,onOpenChange:Ne=>{if(t!==void 0){e==null||e(Ne);return}Ne?(L(!0),U(Ne)):$()},open:A},re.createElement(Mue.Provider,{value:{visible:j,activeSnapPoint:Bt,snapPoints:o,setActiveSnapPoint:Jn,drawerRef:Ae,overlayRef:Y,scaleBackground:ee,onOpenChange:e,onPress:Rn,setVisible:X,onRelease:q,onDrag:_c,dismissible:d,handleOnly:f,isOpen:A,isDragging:V,shouldFade:Di,closeDrawer:$,onNestedDrag:ge,onNestedOpenChange:ae,onNestedRelease:dt,keyboardIsOpen:et,openProp:t,modal:_,snapPointsOffset:Mr,direction:C}},n))}const Jet=250,Xet=120,jue=re.forwardRef(function({preventCycle:t=!1,children:e,...n},r){const{visible:i,closeDrawer:s,isDragging:o,snapPoints:a,activeSnapPoint:c,setActiveSnapPoint:l,dismissible:u,handleOnly:d,onPress:f,onDrag:p}=SI(),m=re.useRef(null),v=re.useRef(!1);function S(){if(v.current){T();return}window.setTimeout(()=>{_()},Xet)}function _(){if(o||t||v.current){T();return}if(T(),(!a||a.length===0)&&u){s();return}if(c===a[a.length-1]&&u){s();return}const I=a.findIndex(O=>O===c);if(I===-1)return;const R=a[I+1];l(R)}function w(){m.current=window.setTimeout(()=>{v.current=!0},Jet)}function T(){window.clearTimeout(m.current),v.current=!1}return re.createElement("div",{onClick:S,onDoubleClick:()=>{v.current=!0,s()},onPointerCancel:T,onPointerDown:C=>{d&&f(C),w()},onPointerMove:C=>{d&&p(C)},ref:r,"vaul-drawer-visible":i?"true":"false","vaul-handle":"","aria-hidden":"true",...n},re.createElement("span",{"vaul-handle-hitarea":"","aria-hidden":"true"},e))});jue.displayName="Drawer.Handle";const Hue=re.forwardRef(function({children:t,...e},n){const{overlayRef:r,snapPoints:i,onRelease:s,shouldFade:o,isOpen:a,visible:c}=SI(),l=Nue(n,r),u=i&&i.length>0;return re.createElement(m9,{onMouseUp:s,ref:l,"vaul-drawer-visible":c?"true":"false","vaul-overlay":"","vaul-snap-points":a&&u?"true":"false","vaul-snap-points-overlay":a&&o?"true":"false",...e})});Hue.displayName="Drawer.Overlay";const Kue=re.forwardRef(function({onOpenAutoFocus:t,onPointerDownOutside:e,onAnimationEnd:n,style:r,...i},s){const{drawerRef:o,onPress:a,onRelease:c,onDrag:l,dismissible:u,keyboardIsOpen:d,snapPointsOffset:f,visible:p,closeDrawer:m,modal:v,openProp:S,onOpenChange:_,setVisible:w,handleOnly:T,direction:C}=SI(),I=Nue(s,o),R=re.useRef(null),O=re.useRef(!1),A=(U,N,L=0)=>{if(O.current)return!0;const j=Math.abs(U.y),X=Math.abs(U.x),G=X>j,F=["bottom","right"].includes(N)?1:-1;if(N==="left"||N==="right"){if(!(U.x*F<0)&&X>=0&&X<=L)return G}else if(!(U.y*F<0)&&j>=0&&j<=L)return!G;return O.current=!0,!0};return re.useEffect(()=>{w(!0)},[]),re.createElement(v9,{"vaul-drawer":"","vaul-drawer-direction":C,"vaul-drawer-visible":p?"true":"false",...i,ref:I,style:f&&f.length>0?{"--snap-point-height":`${f[0]}px`,...r}:r,onOpenAutoFocus:U=>{if(t)t(U);else{var N;U.preventDefault(),(N=o.current)==null||N.focus()}},onPointerDown:U=>{T||(i.onPointerDown==null||i.onPointerDown.call(i,U),R.current={x:U.clientX,y:U.clientY},a(U))},onPointerDownOutside:U=>{if(e==null||e(U),!v||U.defaultPrevented){U.preventDefault();return}d.current&&(d.current=!1),U.preventDefault(),_==null||_(!1),!(!u||S!==void 0)&&m()},onFocusOutside:U=>{if(!v){U.preventDefault();return}},onEscapeKeyDown:U=>{if(!v){U.preventDefault();return}},onPointerMove:U=>{if(T||(i.onPointerMove==null||i.onPointerMove.call(i,U),!R.current))return;const N=U.clientY-R.current.y,L=U.clientX-R.current.x,j=U.pointerType==="touch"?10:2;A({x:L,y:N},C,j)?l(U):(Math.abs(L)>j||Math.abs(N)>j)&&(R.current=null)},onPointerUp:U=>{i.onPointerUp==null||i.onPointerUp.call(i,U),R.current=null,O.current=!1,c(U)}})});Kue.displayName="Drawer.Content";function Zet({onDrag:t,onOpenChange:e,...n}){const{onNestedDrag:r,onNestedOpenChange:i,onNestedRelease:s}=SI();if(!r)throw new Error("Drawer.NestedRoot must be placed in another drawer");return re.createElement(Bue,{nested:!0,onClose:()=>{i(!1)},onDrag:(o,a)=>{r(o,a),t==null||t(o,a)},onOpenChange:o=>{o&&i(o),e==null||e(o)},onRelease:s,...n})}const g1={Root:Bue,NestedRoot:Zet,Content:Kue,Handle:jue,Overlay:Hue,Trigger:Pet,Portal:g9,Close:_9,Title:y9,Description:Oet};var Qet="VisuallyHidden",Vue=y.forwardRef((t,e)=>b.jsx(wt.span,{...t,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}));Vue.displayName=Qet;const ett="_modal_18q05_8",ttt="_dialog_18q05_13",ntt="_content_18q05_20",rtt="_drawer_18q05_31",itt="_close_18q05_58",stt="_header_18q05_83",ott="_body_18q05_113",att="_tabbed_18q05_128",ctt="_handle_18q05_132",Os={modal:ett,dialog:ttt,content:ntt,drawer:rtt,close:itt,header:stt,body:ott,tabbed:att,handle:ctt},ltt="_bg_1ss4g_8",utt="_animate_1ss4g_23",dtt="_overlay_1ss4g_40",Gc={bg:ltt,animate:utt,"fade-in":"_fade-in_1ss4g_1","fade-out":"_fade-out_1ss4g_1",overlay:dtt,"zoom-in":"_zoom-in_1ss4g_1","zoom-out":"_zoom-out_1ss4g_1"},nS=({title:t,children:e,className:n,open:r,onDismiss:i,tabbed:s,...o})=>{const{t:a}=ht(),c=tI("(hover: none) or (pointer: coarse)"),l=y.useCallback(u=>{u||i==null||i()},[i]);return c?b.jsx(g1.Root,{open:r,onOpenChange:l,dismissible:i!==void 0,children:b.jsxs(g1.Portal,{children:[b.jsx(g1.Overlay,{className:Pe(Gc.bg)}),b.jsx(g1.Content,{className:Pe(n,Gc.overlay,Os.modal,Os.drawer,{[Os.tabbed]:s}),"aria-describedby":void 0,...o,children:b.jsxs("div",{className:Os.content,children:[b.jsxs("div",{className:Os.header,children:[b.jsx("div",{className:Os.handle}),b.jsx(Vue,{asChild:!0,children:b.jsx(g1.Title,{children:t})})]}),b.jsx("div",{className:Os.body,children:e})]})})]})}):b.jsx(p9,{open:r,onOpenChange:l,children:b.jsxs(g9,{children:[b.jsx(m9,{className:Pe(Gc.bg,Gc.animate)}),b.jsx(v9,{asChild:!0,"aria-describedby":void 0,...o,children:b.jsx(Coe,{className:Pe(n,Gc.overlay,Gc.animate,Os.modal,Os.dialog,{[Os.tabbed]:s}),children:b.jsxs("div",{className:Os.content,children:[b.jsxs("div",{className:Os.header,children:[b.jsx(y9,{asChild:!0,children:b.jsx(ul,{as:"h2",weight:"semibold",size:"md",children:t})}),i!==void 0&&b.jsx(_9,{className:Os.close,"data-testid":"modal_close","aria-label":a("action.close"),children:b.jsx(kD,{width:20,height:20})})]}),b.jsx("div",{className:Os.body,children:e})]})})})]})})},ftt="_settingsModal_10lo7_8",htt="_fieldRowText_10lo7_16",ptt={settingsModal:ftt,fieldRowText:htt},gtt="_tabContainer_pkn52_8",mtt="_tabList_pkn52_14",HG={tabContainer:gtt,tabList:mtt};function vtt({label:t,tab:e,onTabChange:n,tabs:r}){const i=y.useId();return b.jsxs("div",{className:HG.tabContainer,children:[b.jsx(Z$e,{role:"tablist","aria-label":t,className:HG.tabList,children:r.map(({key:s,name:o})=>b.jsx(nFe,{"aria-controls":`${i}[${s}]`,onClick:()=>n(s),active:s===e,children:o}))}),r.map(({key:s,content:o})=>b.jsx("div",{id:`${i}[${s}]`,style:{display:s===e?void 0:"none"},children:o}))]})}const ytt="_fieldRow_1c7i2_8",_tt="_field_1c7i2_8",btt="_rightAlign_1c7i2_21",Stt="_inputField_1c7i2_33",wtt="_disabled_1c7i2_52",Ett="_prefix_1c7i2_110",Ttt="_checkboxField_1c7i2_131",Ctt="_checkbox_1c7i2_131",ktt="_description_1c7i2_168",Rtt="_errorMessage_1c7i2_197",Itt="_noLabel_1c7i2_210",ea={fieldRow:ytt,field:_tt,rightAlign:btt,inputField:Stt,disabled:wtt,prefix:Ett,checkboxField:Ttt,checkbox:Ctt,description:ktt,errorMessage:Rtt,noLabel:Itt},xtt=(t,e)=>y.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{d:"m20 6-11 11-5-5"})),Ptt=y.forwardRef(xtt);function qt({children:t,rightAlign:e,className:n}){return b.jsx("div",{className:Pe(ea.fieldRow,{[ea.rightAlign]:e},n),children:t})}function Ott({children:t,className:e}){return b.jsx("div",{className:Pe(ea.field,e),children:t})}const ci=y.forwardRef(({id:t,label:e,className:n,type:r,checked:i,prefix:s,suffix:o,description:a,disabled:c,...l},u)=>{const d=y.useId();return b.jsxs(Ott,{className:Pe(r==="checkbox"?ea.checkboxField:ea.inputField,{[ea.prefix]:!!s,[ea.disabled]:c},n),children:[s&&b.jsx("span",{children:s}),r==="textarea"?b.jsx("textarea",{id:t,ref:u,disabled:c,"aria-describedby":d,...l}):b.jsx("input",{id:t,ref:u,type:r,checked:i,disabled:c,"aria-describedby":d,...l}),b.jsxs("label",{htmlFor:t,children:[r==="checkbox"&&b.jsx("div",{className:ea.checkbox,children:b.jsx(Ptt,{})}),e]}),o&&b.jsx("span",{children:o}),a&&b.jsx("p",{id:d,className:e?ea.description:Pe(ea.description,ea.noLabel),children:a})]})});ci.displayName="InputField";const Nf=({error:t})=>b.jsx("p",{className:ea.errorMessage,children:t instanceof TN?t.translatedMessage:t.message}),S9=()=>b.jsxs(ps,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",b.jsx(Hh,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",b.jsx(Hh,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),Mtt="_avatarInputField_1ifvw_8",Att="_avatar_1ifvw_8",Ltt="_fileInput_1ifvw_17",Dtt="_edit_1ifvw_21",wE={avatarInputField:Mtt,avatar:Att,fileInput:Ltt,edit:Dtt},que=({id:t,label:e,className:n,avatarUrl:r,userId:i,displayName:s,onRemoveAvatar:o,...a})=>{const{t:c}=ht(),[l,u]=y.useState(!1),[d,f]=y.useState(void 0),[p,m]=y.useState(!1),v=y.useRef(null);y.useEffect(()=>{const w=v.current,T=C=>{const I=C;I.target.files&&I.target.files.length>0?(f(URL.createObjectURL(I.target.files[0])),u(!1)):f(void 0)};return w.addEventListener("change",T),()=>{w==null||w.removeEventListener("change",T)}});const S=y.useCallback(()=>{v.current.click()},[v]),_=y.useCallback(()=>{u(!0),o()},[o]);return b.jsxs("div",{className:Pe(wE.avatarInputField,n),children:[b.jsx(cy,{id:i,className:wE.avatar,name:s,size:ay.XL,src:l?void 0:d||r}),b.jsx("input",{id:t,accept:"image/*",ref:v,type:"file",className:wE.fileInput,role:"button","aria-label":e,...a}),b.jsx("div",{className:wE.edit,children:(r||d)&&!l?b.jsxs(yN,{title:c("action.edit"),showTitle:!1,open:p,onOpenChange:m,trigger:b.jsx(tn,{iconOnly:!0,Icon:SV,kind:"tertiary",size:"sm","aria-label":c("action.edit")}),children:[b.jsx(Sv,{Icon:zBe,label:c("action.upload_file"),onSelect:S}),b.jsx(Sv,{Icon:NBe,label:c("action.remove"),kind:"critical",onSelect:_})]}):b.jsx(tn,{type:"button",iconOnly:!0,Icon:SV,kind:"tertiary",size:"sm","aria-label":c("action.edit"),onClick:S})})]})};que.displayName="AvatarInputField";const Ntt="_content_1rrwp_8",Utt="_avatarFieldRow_1rrwp_14",KG={content:Ntt,avatarFieldRow:Utt},$tt=({client:t})=>{const{t:e}=ht(),{error:n,displayName:r,avatarUrl:i,saveProfile:s}=tS(t),o=y.useMemo(()=>t.getUserId(),[t]),a=y.useRef(null),c=y.useRef(!1),l=y.useCallback(()=>{c.current=!0},[]),u=y.useRef(!1),d=y.useCallback(()=>{u.current=!0,c.current=!0},[]);return y.useEffect(()=>{const f=a.current;return()=>{if(c.current){const p=new FormData(f),m=p.get("displayName"),v=p.get("avatar"),S=typeof v=="string"?v.length:(v==null?void 0:v.size)??0,_=typeof m=="string"?m:(m==null?void 0:m.name)??null;if(!_)return;s({displayName:_,avatar:v&&S>0?v:void 0,removeAvatar:u.current&&(!v||S===0)}).catch(w=>{k.error("Failed to save profile",w)})}}},[s]),b.jsxs("form",{onChange:l,ref:a,className:KG.content,children:[b.jsx(qt,{className:KG.avatarFieldRow,children:o&&r&&b.jsx(que,{id:"avatar",name:"avatar",label:e("common.avatar"),avatarUrl:i,userId:o,displayName:r,onRemoveAvatar:d})}),b.jsx(qt,{children:b.jsx(ci,{id:"userId",name:"userId",label:e("common.username"),type:"text",disabled:!0,value:t.getUserId()})}),b.jsx(qt,{children:b.jsx(ci,{id:"displayName",name:"displayName",label:e("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:e("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&b.jsx(qt,{children:b.jsx(Nf,{error:n})})]})},Ftt="_feedback_sfb90_8",Gue={feedback:Ftt},Btt=({roomId:t})=>{const{t:e}=ht(),{submitRageshake:n,sending:r,sent:i,error:s}=a9(),o=XQe(),a=y.useCallback(c=>{c.preventDefault();const l=new FormData(c.target),u=l.get("description"),d=typeof u=="string"?u:"",f=!!l.get("sendLogs"),p=Zi(16);n({description:d,sendLogs:f,rageshakeRequestId:p,roomId:t}).catch(m=>{k.error("Failed to send feedback rageshake",m)}),t&&f&&o(t,p)},[n,t,o]);return b.jsxs("div",{children:[b.jsx("h4",{children:e("settings.feedback_tab_h4")}),b.jsx(Mn,{children:e("settings.feedback_tab_body")}),b.jsxs("form",{onSubmit:a,children:[b.jsx(qt,{children:b.jsx(ci,{className:Gue.feedback,id:"description",name:"description",label:e("settings.feedback_tab_description_label"),placeholder:e("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&b.jsxs(qt,{children:[b.jsx(ci,{id:"sendLogs",name:"sendLogs",label:e("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),b.jsx(tn,{type:"submit",disabled:r,children:e(r?"submitting":"action.submit")})]}),b.jsxs(qt,{children:[s&&b.jsx(Nf,{error:s}),i&&b.jsx(Mn,{children:e("settings.feedback_tab_thank_you")})]})]})]})};var zue={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(la,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,S){var _=v[S];if(typeof _.bind=="function")return _.bind(v);try{return Function.prototype.bind.call(_,v)}catch{return function(){return Function.prototype.apply.apply(_,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),S=0;S<i.length;S++){var _=i[S];this[_]=S<v?e:this.methodFactory(_,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function f(v,S,_){return l(v)||d.apply(this,arguments)}function p(v,S){var _=this,w,T,C,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function R(L){var j=(i[L]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=j;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+j+";"}catch{}}}function O(){var L;if(!(typeof window===n||!I)){try{L=window.localStorage[I]}catch{}if(typeof L===n)try{var j=window.document.cookie,X=encodeURIComponent(I),G=j.indexOf(X+"=");G!==-1&&(L=/^([^;]+)/.exec(j.slice(G+X.length+1))[1])}catch{}return _.levels[L]===void 0&&(L=void 0),L}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function U(L){var j=L;if(typeof j=="string"&&_.levels[j.toUpperCase()]!==void 0&&(j=_.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=_.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+L)}_.name=v,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=S||f,_.getLevel=function(){return C??T??w},_.setLevel=function(L,j){return C=U(L),j!==!1&&R(C),u.call(_)},_.setDefaultLevel=function(L){T=U(L),O()||_.setLevel(L,!1)},_.resetLevel=function(){C=null,A(),u.call(_)},_.enableAll=function(L){_.setLevel(_.levels.TRACE,L)},_.disableAll=function(L){_.setLevel(_.levels.SILENT,L)},_.rebuild=function(){if(o!==_&&(w=U(o.getLevel())),u.call(_),o===_)for(var L in s)s[L].rebuild()},w=U(o?o.getLevel():"WARN");var N=O();N!=null&&(C=U(N)),u.call(_)}o=new p,o.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var _=s[S];return _||(_=s[S]=new p(S,o.methodFactory)),_};var m=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=m),o},o.getLoggers=function(){return s},o.default=o,o})})(zue);var jtt=zue.exports;const Htt=es(jtt);var Ktt=(t,e,n)=>new Promise((r,i)=>{var s=c=>{try{a(n.next(c))}catch(l){i(l)}},o=c=>{try{a(n.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())}),Vtt=[fe.ConnectionStateChanged,fe.RoomMetadataChanged,fe.ActiveSpeakersChanged,fe.ConnectionQualityChanged,fe.ParticipantConnected,fe.ParticipantDisconnected,fe.ParticipantPermissionsChanged,fe.ParticipantMetadataChanged,fe.ParticipantNameChanged,fe.ParticipantAttributesChanged,fe.TrackMuted,fe.TrackUnmuted,fe.TrackPublished,fe.TrackUnpublished,fe.TrackStreamStateChanged,fe.TrackSubscriptionFailed,fe.TrackSubscriptionPermissionChanged,fe.TrackSubscriptionStatusChanged],qtt=[...Vtt,fe.LocalTrackPublished,fe.LocalTrackUnpublished];le.TrackPublished,le.TrackUnpublished,le.TrackMuted,le.TrackUnmuted,le.TrackStreamStateChanged,le.TrackSubscribed,le.TrackUnsubscribed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionFailed,le.LocalTrackPublished,le.LocalTrackUnpublished;var Gtt=[le.ConnectionQualityChanged,le.IsSpeakingChanged,le.ParticipantMetadataChanged,le.ParticipantPermissionsChanged,le.TrackMuted,le.TrackUnmuted,le.TrackPublished,le.TrackUnpublished,le.TrackStreamStateChanged,le.TrackSubscriptionFailed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionStatusChanged];[...Gtt,le.LocalTrackPublished,le.LocalTrackUnpublished];var ztt=Htt.getLogger("lk-components-js");ztt.setDefaultLevel("WARN");function Wtt(t,...e){return new Cr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(Us(t))}function Ytt(t,e,n=!0){var r;const i=()=>Ktt(this,null,function*(){try{const a=yield k_.getLocalDevices(t,n);s.next(a)}catch(a){e==null||e(a)}}),s=new da,o=s.pipe(oue(()=>{var a;(a=navigator==null?void 0:navigator.mediaDevices)==null||a.removeEventListener("devicechange",i)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(r=navigator==null?void 0:navigator.mediaDevices)==null||r.addEventListener("devicechange",i)}return Zk(k_.getLocalDevices(t,n).catch(a=>(e==null||e(a),[])),o)}function w9(t,...e){return new Cr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(Us(t))}function E9(t){return w9(t,le.TrackMuted,le.TrackUnmuted,le.ParticipantPermissionsChanged,le.TrackPublished,le.TrackUnpublished,le.LocalTrackPublished,le.LocalTrackUnpublished,le.MediaDevicesError,le.TrackSubscriptionStatusChanged).pipe(Ut(n=>{const{isMicrophoneEnabled:r,isCameraEnabled:i,isScreenShareEnabled:s}=n,o=n.getTrackPublication(ve.Source.Microphone),a=n.getTrackPublication(ve.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:r,isScreenShareEnabled:s,cameraTrack:a,microphoneTrack:o,participant:n}}))}function Jtt(t,e={}){var n;let r;const i=new Cr(c=>(r=c,()=>a.unsubscribe())).pipe(Us(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:qtt,o=Array.from(new Set([fe.ParticipantConnected,fe.ParticipantDisconnected,fe.ConnectionStateChanged,...s])),a=Wtt(t,...o).subscribe(c=>r==null?void 0:r.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&(r==null||r.next(Array.from(t.remoteParticipants.values()))),i}new TextEncoder;new TextDecoder;let qm;/android/i.test(navigator.userAgent)?qm="android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?qm="ios":qm="desktop";const A0=()=>{const{userAgent:t}=navigator;return t.includes("Firefox")};function Xtt(t,e){const[n,r]=y.useState(e);return y.useEffect(()=>{if(typeof window>"u"||!t)return;const i=t.subscribe(r);return()=>i.unsubscribe()},[t]),n}function YO(t,e,n,r=!1){const i=y.useRef(!1),s=n||i.current;i.current||(i.current=n);const o=y.useMemo(()=>Ytt(t,()=>k.error("Error creating MediaDeviceObserver"),s),[t,s]),a=Xtt(o,[]),[c,l]=y.useState(e);return y.useMemo(()=>{var d;let u;return a&&(u=a.some(f=>f.deviceId===c)?c:a.some(f=>f.deviceId===e)?e:(d=a.at(0))==null?void 0:d.deviceId),{available:a??[],selectedId:r?void 0:u,select:l}},[a,c,e,l,r])}const JO={available:[],selectedId:void 0,select:()=>{}},Ztt={audioInput:JO,audioOutput:JO,videoInput:JO,startUsingDeviceNames:()=>{},stopUsingDeviceNames:()=>{}},Wue=y.createContext(Ztt),Qtt=({children:t})=>{const[e,n]=y.useState(0),r=e>0,i=A0(),s=r&&!A0(),[o,a]=Vm(HQe),[c,l]=Vm(KQe),[u,d]=Vm(VQe),f=YO("audioinput",o,r),p=YO("audiooutput",c,s,i),m=YO("videoinput",u,r);y.useEffect(()=>{f.selectedId!==void 0&&a(f.selectedId)},[a,f.selectedId]),y.useEffect(()=>{p.selectedId!==void 0&&!A0()&&l(p.selectedId)},[l,p.selectedId]),y.useEffect(()=>{m.selectedId!==void 0&&d(m.selectedId)},[d,m.selectedId]);const v=y.useCallback(()=>n(w=>w+1),[n]),S=y.useCallback(()=>n(w=>w-1),[n]),_=y.useMemo(()=>({audioInput:f,audioOutput:p,videoInput:m,startUsingDeviceNames:v,stopUsingDeviceNames:S}),[f,p,m,v,S]);return b.jsx(Wue.Provider,{value:_,children:t})},rS=()=>y.useContext(Wue),ent=(t,e=!0)=>y.useEffect(()=>{if(e)return t.startUsingDeviceNames(),t.stopUsingDeviceNames},[t,e]),T9="audio",C9=({open:t,onDismiss:e,tab:n,onTabChange:r,client:i,roomId:s})=>{var O;const{t:o}=ht(),[a,c]=hI(),[l,u]=Vm(jQe),[d,f]=Vm(aue),p=(A,U)=>{if(A.available.length==0)return null;const N=A.available.map(({deviceId:L,label:j},X)=>[L,j&&j.trim().length>0?j:`${U} ${X+1}`]);return b.jsx(aBe,{label:U,defaultValue:A.selectedId===""||!A.selectedId?"default":A.selectedId,onValueChange:L=>A.select(L),values:N,placeholder:""})},m=b.jsx(Mn,{size:"sm",children:b.jsxs(ps,{i18nKey:"settings.opt_in_description",children:[b.jsx(S9,{}),b.jsx("br",{}),"You may withdraw consent by unchecking this box. If you are currently in a call, this setting will take effect at the end of the call."]})}),v=rS();ent(v,t);const S={key:"audio",name:o("common.audio"),content:b.jsxs(b.Fragment,{children:[p(v.audioInput,o("common.microphone")),!A0()&&p(v.audioOutput,o("settings.speaker_device_selection_label"))]})},_={key:"video",name:o("common.video"),content:p(v.videoInput,o("common.camera"))},w={key:"profile",name:o("common.profile"),content:b.jsx($tt,{client:i})},T={key:"feedback",name:o("settings.feedback_tab_title"),content:b.jsx(Btt,{roomId:s})},C={key:"more",name:o("settings.more_tab_title"),content:b.jsxs(b.Fragment,{children:[b.jsx("h4",{children:o("settings.developer_tab_title")}),b.jsx("p",{children:o("version",{productName:"Element Call",version:"1dc6584911fe333d951379e410225ec75a7f8d9f"})}),b.jsx(qt,{children:b.jsx(ci,{id:"developerSettingsTab",type:"checkbox",checked:l,label:o("settings.developer_settings_label"),description:o("settings.developer_settings_label_description"),onChange:A=>u(A.target.checked)})}),b.jsx("h4",{children:o("common.analytics")}),b.jsx(qt,{children:b.jsx(ci,{id:"optInAnalytics",type:"checkbox",checked:a??void 0,description:m,onChange:A=>{c==null||c(A.target.checked)}})})]})},I={key:"developer",name:o("settings.developer_tab_title"),content:b.jsxs(b.Fragment,{children:[b.jsx("p",{children:o("version",{productName:"Element Call",version:"1dc6584911fe333d951379e410225ec75a7f8d9f"})}),b.jsx("p",{children:o("crypto_version",{version:((O=i.getCrypto())==null?void 0:O.getVersion())||"unknown"})}),b.jsx("p",{children:o("matrix_id",{id:i.getUserId()||"unknown"})}),b.jsx("p",{children:o("device_id",{id:i.getDeviceId()||"unknown"})}),b.jsx(qt,{children:b.jsx(ci,{id:"duplicateTiles",type:"number",label:o("settings.duplicate_tiles_label"),value:d.toString(),onChange:y.useCallback(A=>{const U=A.target.valueAsNumber;f(Number.isNaN(U)?0:U)},[f])})})]})},R=[S,_];return rt===null&&R.push(w),R.push(T,C),l&&R.push(I),b.jsx(nS,{title:o("common.settings"),className:ptt.settingsModal,open:t,onDismiss:e,tabbed:!0,children:b.jsx(vtt,{label:o("common.settings"),tab:n,onTabChange:r,tabs:R})})},tnt=(t,e)=>y.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),y.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),VG=y.forwardRef(tnt),nnt=(t,e)=>y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),rnt=y.forwardRef(nnt),int=(t,e)=>y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),snt=y.forwardRef(int),ont=(t,e)=>y.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),ant=y.forwardRef(ont),cnt="_menuIcon_asilm_8",lnt="_userButton_asilm_15",unt={menuIcon:cnt,userButton:lnt},dnt=({preventNavigation:t,isAuthenticated:e,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:s,onAction:o})=>{const{t:a}=ht(),c=Ku(),l=y.useMemo(()=>{const f=[];return e&&(f.push({key:"user",icon:VG,label:i,dataTestid:"usermenu_user"}),f.push({key:"settings",icon:rnt,label:a("common.settings")}),n&&!t&&f.push({key:"login",label:a("action.sign_in"),icon:snt,dataTestid:"usermenu_login"}),!n&&!t&&f.push({key:"logout",label:a("action.sign_out"),icon:ant,dataTestid:"usermenu_logout"})),f},[e,n,i,t,a]),[u,d]=y.useState(!1);return e?b.jsx(yN,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:u,onOpenChange:d,trigger:b.jsx("button",{"aria-label":a("common.profile"),className:unt.userButton,"data-testid":"usermenu_open",children:e&&(!n||s)?b.jsx(cy,{id:r,name:i,size:ay.SM,src:s}):b.jsx(VG,{})}),children:l.map(({key:f,icon:p,label:m,dataTestid:v})=>b.jsx(Sv,{Icon:p,label:m,"data-test-id":v,onSelect:()=>o(f)},f))}):b.jsx(EN,{to:{pathname:"/login",state:{from:c}},children:a("log_in")})},k9=({preventNavigation:t=!1})=>{const e=Ku(),n=gc(),{client:r,logout:i,authenticated:s,passwordlessUser:o}=l9(),{displayName:a,avatarUrl:c}=tS(r),[l,u]=y.useState(!1),d=y.useCallback(()=>u(!1),[u]),[f,p]=y.useState(T9),m=y.useCallback(S=>{switch(S){case"user":p("profile"),u(!0);break;case"settings":p("audio"),u(!0);break;case"logout":i==null||i();break;case"login":n.push("/login",{state:{from:e}});break}},[n,e,i,u]),v=(r==null?void 0:r.getUserIdLocalpart())??"";return b.jsxs(b.Fragment,{children:[b.jsx(dnt,{preventNavigation:t,isAuthenticated:s,isPasswordlessUser:o,avatarUrl:c,onAction:m,userId:(r==null?void 0:r.getUserId())??"",displayName:a||(v?v.replace("@",""):"")}),r&&b.jsx(C9,{client:r,open:l,onDismiss:d,tab:f,onTabChange:p})]})},R9=t=>{const[e,n]=y.useState(void 0),[r,i]=y.useState(void 0),s=y.useRef();s.current||(s.current=Y2({baseUrl:on.defaultHomeserverUrl()})),y.useEffect(()=>{rt||s.current.registerRequest({}).catch(a=>{var c,l,u,d,f,p,m;n((f=(d=(u=(l=(c=a.data)==null?void 0:c.params["m.login.terms"])==null?void 0:l.policies)==null?void 0:u.privacy_policy)==null?void 0:d.en)==null?void 0:f.url),i((m=(p=a.data)==null?void 0:p.params["m.login.recaptcha"])==null?void 0:m.public_key)})},[]);const o=y.useCallback(async(a,c,l,u,d)=>{const f=new H4({matrixClient:s.current,doRequest:async T=>s.current.registerRequest({username:a,password:c,auth:T||void 0}),stateUpdated:(T,C)=>{if(C.error)throw new Error(C.error);T==="m.login.terms"?f.submitAuthDict({type:"m.login.terms"}).catch(I=>{k.error(I)}):T==="m.login.recaptcha"&&f.submitAuthDict({type:"m.login.recaptcha",response:u}).catch(I=>{k.error(I)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:p,access_token:m,device_id:v}=await f.attemptAuth();await(t==null?void 0:t.logout(!0));const S=await wN({baseUrl:on.defaultHomeserverUrl(),accessToken:m,userId:p,deviceId:v},!1);await S.setDisplayName(l);const _={user_id:p,device_id:v,access_token:m,passwordlessUser:d};d&&(_.tempPassword=c);const w=S.getUser(S.getUserId());return w.setRawDisplayName(l),w.setDisplayName(l),[S,_]},[t]);return{privacyPolicyUrl:e,recaptchaKey:r,register:o}},fnt="_buttons_kg7n6_8",hnt={buttons:fnt},Yue=({onJoin:t,open:e,onDismiss:n})=>{const{t:r}=ht();return b.jsxs(nS,{title:r("join_existing_call_modal.title"),open:e,onDismiss:n,children:[b.jsx("p",{children:r("join_existing_call_modal.text")}),b.jsxs(qt,{rightAlign:!0,className:hnt.buttons,children:[b.jsx(tn,{onClick:n,children:r("action.no")}),b.jsx(tn,{onClick:t,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},qG="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function I9(t){const{t:e}=ht(),[n]=y.useState(()=>Zi(16)),r=y.useRef();y.useEffect(()=>{var a;if(!t)return;const o=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:t,size:"invisible",callback:c=>{var l;return(l=r.current)==null?void 0:l.resolve(c)},"error-callback":()=>{var c;return(c=r.current)==null?void 0:c.reject(new Error)}})};if(typeof((a=window.grecaptcha)==null?void 0:a.render)=="function")o();else if(window.mxOnRecaptchaLoaded=o,!document.querySelector(`script[src="${qG}"]`)){const c=document.createElement("script");c.src=qG,c.async=!0,document.body.appendChild(c)}},[n,t]);const i=y.useCallback(async()=>t?window.grecaptcha?new Promise((o,a)=>{var u,d;const c=new MutationObserver(f=>{var p,m;for(const v of f)if(((m=(p=v.target)==null?void 0:p.style)==null?void 0:m.visibility)!=="visible"){a(D5("recaptcha_dismissed",e)),c.disconnect();return}});r.current={resolve:f=>{o(f),c.disconnect()},reject:f=>{a(f),c.disconnect()}},window.grecaptcha.execute().then(()=>{},f=>{k.error("Recaptcha execution failed",f)});const l=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');(u=l==null?void 0:l.parentNode)!=null&&u.parentNode&&c.observe((d=l==null?void 0:l.parentNode)==null?void 0:d.parentNode,{attributes:!0})}):(k.log("Recaptcha not loaded"),Promise.reject(D5("recaptcha_not_loaded",e))):Promise.resolve(""),[t,e]),s=y.useCallback(()=>{var o;(o=window.grecaptcha)==null||o.reset()},[]);return{execute:i,reset:s,recaptchaId:n}}const pnt="_form_fq1fn_8",gnt={form:pnt},wI=y.forwardRef(({children:t,className:e,onSubmit:n},r)=>b.jsx("form",{onSubmit:n,className:Pe(gnt.form,e),ref:r,children:t}));wI.displayName="Form";const mnt="_footer_rse6n_8",vnt="_mobileLoginLink_rse6n_19",ynt="_form_rse6n_24",_nt="_notice_rse6n_40",m1={footer:mnt,mobileLoginLink:vnt,form:ynt,notice:_nt},bnt="_container_13qdn_8",Snt="_main_13qdn_15",wnt="_logo_13qdn_23",Ent="_headline_13qdn_28",Gm={container:bnt,main:Snt,logo:wnt,headline:Ent},GG=t=>{t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class Tnt{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:n,separator:r,dictionaries:i,style:s,seed:o}=e;this.dictionaries=i,this.separator=r,this.length=n,this.style=s,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((n,r)=>{let i;e?(i=(o=>{if(typeof o=="string"){const a=o.split("").map(l=>l.charCodeAt(0)).reduce((l,u)=>l+u,1),c=Math.floor(Number(a));return GG(c)}return GG(o)})(e),e=4294967296*i):i=Math.random();let s=r[Math.floor(i*r.length)]||"";if(this.style==="lowerCase")s=s.toLowerCase();else if(this.style==="capital"){const[o,...a]=s.split("");s=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(s=s.toUpperCase());return n?`${n}${this.separator}${s}`:`${s}`},"")}}const zG={separator:"_",dictionaries:[]},Cnt=t=>{const e=[...t&&t.dictionaries||zG.dictionaries],n={...zG,...t,length:t&&t.length||e.length,dictionaries:e};if(!t||!t.dictionaries||!t.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new Tnt(n).generate()};var knt=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],Rnt=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],Int=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const xnt=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function Jue(){return Cnt({dictionaries:[Int,knt,Rnt,xnt],style:"lowerCase",length:3,separator:"-"})}const Pnt=()=>{const{setClient:t}=Df(),[e,n]=y.useState(!1),[r,i]=y.useState(),[s]=hI(),{recaptchaKey:o,register:a}=R9(),{execute:c,reset:l,recaptchaId:u}=I9(o),[d,f]=y.useState(!1),p=y.useCallback(()=>f(!1),[f]),[m,v]=y.useState(),S=gc(),{t:_}=ht(),w=y.useCallback(T=>{T.preventDefault();const C=new FormData(T.target),I=mae(C.get("callName")),R=C.get("displayName");async function O(){i(void 0),n(!0);const A=await c(),U=Jue(),[N,L]=await a(U,Zi(16),R,A,!0);let j;try{j=await vae(N,I,En.SHARED_KEY)}catch(X){if(!t)throw X;if(X.errcode==="M_ROOM_IN_USE"){v(()=>{t({client:N,session:L});const G=qb(I);S.push(`/${G}`)}),n(!1),f(!0);return}else throw X}if(!t)throw new Error("setClient is undefined");if(!j.password)throw new Error("Failed to create room with shared secret");t({client:N,session:L}),S.push(eI(j.roomId,{kind:En.SHARED_KEY,secret:j.password},I))}O().catch(A=>{k.error(A),n(!1),i(A),l()})},[a,l,c,S,f,t]);return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:Gm.container,children:[b.jsxs(Af,{children:[b.jsx(Bp,{children:b.jsx(gp,{})}),b.jsx(jp,{hideMobile:!0,children:b.jsx(k9,{})})]}),b.jsxs("main",{className:Gm.main,children:[b.jsx(gp,{className:Gm.logo}),b.jsx(ul,{size:"lg",weight:"semibold",children:_("start_new_call")}),b.jsxs(wI,{className:m1.form,onSubmit:w,children:[b.jsx(qt,{children:b.jsx(ci,{id:"callName",name:"callName",label:_("call_name"),placeholder:_("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),b.jsx(qt,{children:b.jsx(ci,{id:"displayName",name:"displayName",label:_("common.display_name"),placeholder:_("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),s===null&&b.jsx(Mn,{size:"sm",className:m1.notice,children:b.jsx(S9,{})}),b.jsx(Mn,{size:"sm",className:m1.notice,children:b.jsxs(ps,{i18nKey:"unauthenticated_view_eula_caption",children:['By clicking "Go", you agree to our'," ",b.jsx(Hh,{href:on.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),r&&b.jsx(qt,{children:b.jsx(Nf,{error:r})}),b.jsx(tn,{type:"submit",size:"lg",disabled:e,"data-testid":"home_go",children:_(e?"common.loading":"action.go")}),b.jsx("div",{id:u})]})]}),b.jsxs("footer",{className:m1.footer,children:[b.jsx(Mn,{className:m1.mobileLoginLink,children:b.jsx(Lo,{to:"/login","data-testid":"home_login",children:_("unauthenticated_view_login_button")})}),b.jsx(Mn,{children:b.jsxs(ps,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",b.jsx(Lo,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),m&&b.jsx(Yue,{onJoin:m,open:d,onDismiss:p})]})},Cg={};function WG(t,e){if(Cg[e.roomId])return Cg[e.roomId];if(!e||!e.timeline){const i=Number.MAX_SAFE_INTEGER;return Cg[e.roomId]=i,i}const n=t.getUserId();if(e.getMyMembership()!==Ge.Join){const i=e.currentState.getStateEvents("m.room.member",n);if(i&&!Array.isArray(i)){const s=i.getTs();return Cg[e.roomId]=s,s}}for(let i=e.timeline.length-1;i>=0;--i){const o=e.timeline[i].getTs();if(o)return Cg[e.roomId]=o,o}const r=Number.MAX_SAFE_INTEGER;return Cg[e.roomId]=r,r}function Ont(t,e){return e.sort((n,r)=>WG(t,r)-WG(t,n))}const Mnt=t=>{var e,n;if(!t.hasEncryptionStateEvent()&&!Sje(t.roomId))return!1;switch(t.getJoinRule()){case hu.Public:return!0;case hu.Knock:switch(t.getMyMembership()){case Ge.Join:case Ge.Knock:return!0;case Ge.Invite:return((n=(e=t.getLiveTimeline().getState(He.FORWARDS))==null?void 0:e.getStateEvents(Z.RoomMember,t.myUserId))==null?void 0:n.getPrevContent().membership)===hu.Knock;default:return!1}default:return t.getMyMembership()===Ge.Join}},Ant=t=>{var e,n;switch(t.getMyMembership()){case Ge.Join:return!!((n=(e=t.getLiveTimeline().getState(He.FORWARDS))==null?void 0:e.events)!=null&&n.get(Z.GroupCallMemberPrefix));case Ge.Knock:return!0;default:return!1}};function Lnt(t){const[e,n]=y.useState([]);return y.useEffect(()=>{function r(){const i=t.getRooms().filter(Ant).filter(Mnt),o=Ont(t,i).map(a=>{const c=t.matrixRTC.getRoomSession(a);return{roomAlias:a.getCanonicalAlias()??void 0,roomName:a.name,avatarUrl:a.getMxcAvatarUrl(),room:a,session:c,participants:c.memberships.filter(l=>l.sender).map(l=>a.getMember(l.sender)).filter(l=>l)}});n(o)}return r(),t.matrixRTC.on(pM.SessionStarted,r),t.on(ct.MyMembership,r),()=>{t.matrixRTC.off(pM.SessionStarted,r),t.off(ct.MyMembership,r)}},[t]),e}const Dnt="_form_wfvva_8",Nnt="_fieldRow_wfvva_16",Unt="_button_wfvva_24",$nt="_recentCallsTitle_wfvva_28",Fnt="_notice_wfvva_32",v1={form:Dnt,fieldRow:Nnt,button:Unt,recentCallsTitle:$nt,notice:Fnt},Bnt="_callTileSpacer_z274f_8",jnt="_callTile_z274f_8",Hnt="_callTileLink_z274f_28",Knt="_avatar_z274f_36",Vnt="_callInfo_z274f_40",qnt="_callName_z274f_53",Gnt="_facePile_z274f_59",znt="_callList_z274f_63",Wnt="_disabled_z274f_74",Ql={callTileSpacer:Bnt,callTile:jnt,callTileLink:Hnt,avatar:Knt,callInfo:Vnt,callName:qnt,facePile:Gnt,callList:znt,disabled:Wnt},Ynt=({rooms:t,client:e})=>b.jsx(b.Fragment,{children:b.jsxs("div",{className:Ql.callList,children:[t.map(({room:n,roomName:r,avatarUrl:i,participants:s})=>b.jsx(Jnt,{client:e,name:r,avatarUrl:i,room:n,participants:s},n.roomId)),t.length>3&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:Ql.callTileSpacer}),b.jsx("div",{className:Ql.callTileSpacer})]})]})}),Jnt=({name:t,avatarUrl:e,room:n,client:r})=>{const{t:i}=ht(),s=QR(n.roomId),[o,a]=y.useState(!1),c=y.useCallback(u=>{u.stopPropagation(),u.preventDefault(),a(!0),r.leave(n.roomId).catch(()=>a(!1))},[n,r]),l=b.jsxs(b.Fragment,{children:[b.jsx(cy,{id:n.roomId,name:t,size:ay.LG,src:e}),b.jsx("div",{className:Ql.callInfo,children:b.jsx(Mn,{weight:"semibold",className:Ql.callName,children:t})}),b.jsx(k$e,{onClick:c,disabled:o,"aria-label":i("action.remove"),children:b.jsx(kD,{})})]});return b.jsx("div",{className:Ql.callTile,children:o?b.jsx("span",{className:Pe(Ql.callTileLink,Ql.disabled),children:l}):b.jsx(cD,{to:eI(n.roomId,s,n.name),className:Ql.callTileLink,children:l})})},Xnt=({client:t})=>{const[e,n]=y.useState(!1),[r,i]=y.useState(),[s]=hI(),o=gc(),{t:a}=ht(),[c,l]=y.useState(!1),u=y.useCallback(()=>l(!1),[l]),d=y.useCallback(S=>{S.preventDefault();const w=new FormData(S.target).get("callName"),T=typeof w=="string"?mae(w):"";async function C(){i(void 0),n(!0);const I=await vae(t,T,En.SHARED_KEY);if(!I.password)throw new Error("Failed to create room with shared secret");o.push(eI(I.roomId,{kind:En.SHARED_KEY,secret:I.password},T))}C().catch(I=>{I.errcode==="M_ROOM_IN_USE"?(m(qb(T)),n(!1),i(void 0),l(!0)):(k.error(I),n(!1),i(I))})},[t,o,l]),f=Lnt(t),[p,m]=y.useState(),v=y.useCallback(()=>{o.push(`/${p}`)},[o,p]);return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:Gm.container,children:[b.jsxs(Af,{children:[b.jsx(Bp,{children:b.jsx(gp,{})}),b.jsx(jp,{children:b.jsx(k9,{})})]}),b.jsxs("main",{className:Gm.main,children:[b.jsx(gp,{className:Gm.logo}),b.jsx(ul,{size:"lg",weight:"semibold",children:a("start_new_call")}),b.jsxs(wI,{className:v1.form,onSubmit:d,children:[b.jsxs(qt,{className:v1.fieldRow,children:[b.jsx(ci,{id:"callName",name:"callName",label:a("call_name"),placeholder:a("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),b.jsx(tn,{type:"submit",size:"lg",className:v1.button,disabled:e,"data-testid":"home_go",children:a(e?"common.loading":"action.go")})]}),s===null&&b.jsx(Mn,{size:"sm",className:v1.notice,children:b.jsx(S9,{})}),r&&b.jsx(qt,{className:v1.fieldRow,children:b.jsx(Nf,{error:r})})]}),f.length>0&&b.jsx(Ynt,{rooms:f,client:t})]})]}),b.jsx(Yue,{onJoin:v,open:c,onDismiss:u})]})};function x9(t){y.useEffect(()=>{const e="Element Call";document.title=t?`${e} | ${t}`:e},[t])}const Xue=()=>{const{t}=ht();x9(t("common.home"));const e=yI();return e?e.state==="error"?b.jsx(mI,{error:e.error}):e.authenticated?b.jsx(Xnt,{client:e.authenticated.client}):b.jsx(Pnt,{}):b.jsx(vI,{})},Znt=(t,e)=>y.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),y.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),y.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),y.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),y.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),y.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),y.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),y.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),y.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),Zue=y.forwardRef(Znt),Qnt="_logo_onbuh_8",ert="_container_onbuh_14",trt="_content_onbuh_22",nrt="_formContainer_onbuh_30",rrt="_authLinks_onbuh_62",Xc={logo:Qnt,container:ert,content:trt,formContainer:nrt,authLinks:rrt};function irt(t){return y.useCallback(async(e,n,r)=>{const i=Y2({baseUrl:e}),s=new H4({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:o,access_token:a,device_id:c}=await s.attemptAuth(),l={user_id:o,access_token:a,device_id:c,passwordlessUser:!1};return await(t==null?void 0:t.logout(!0)),[await wN({baseUrl:e,accessToken:a,userId:o,deviceId:c},!1),l]},[t])}const srt=()=>{var v,S;const{t}=ht();x9(t("login_title"));const{client:e,setClient:n}=Df(),r=irt(e),i=on.defaultHomeserverUrl(),s=y.useRef(null),o=y.useRef(null),a=gc(),c=Ku(),[l,u]=y.useState(!1),[d,f]=y.useState(),p=y.useCallback(_=>{if(_.preventDefault(),u(!0),!i||!s.current||!o.current){f(Error("Login parameters are undefined")),u(!1);return}r(i,s.current.value,o.current.value).then(([w,T])=>{if(!n)return;n({client:w,session:T});const C=c.state;C&&C.from?a.push(C.from):a.push("/"),zt.instance.eventLogin.track()}).catch(w=>{f(w),u(!1)})},[r,c,a,i,n]);let m=(v=on.defaultServerName())==null?void 0:v.slice(0,25);return m=(m==null?void 0:m.length)!==((S=on.defaultServerName())==null?void 0:S.length)?m+"...":m,b.jsx(b.Fragment,{children:b.jsx("div",{className:Xc.container,children:b.jsxs("div",{className:Xc.content,children:[b.jsxs("div",{className:Xc.formContainer,children:[b.jsx(Zue,{width:"auto",height:"auto",className:Xc.logo}),b.jsx("h2",{children:t("log_in")}),b.jsx("h4",{children:t("login_subheading")}),b.jsxs("form",{onSubmit:p,children:[b.jsx(qt,{children:b.jsx(ci,{type:"text",ref:s,placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${m}`,"data-testid":"login_username"})}),b.jsx(qt,{children:b.jsx(ci,{type:"password",ref:o,placeholder:t("common.password"),label:t("common.password"),"data-testid":"login_password"})}),d&&b.jsx(qt,{children:b.jsx(Nf,{error:d})}),b.jsx(qt,{children:b.jsx(tn,{type:"submit",disabled:l,"data-testid":"login_login",children:t(l?"logging_in":"login_title")})})]})]}),b.jsxs("div",{className:Xc.authLinks,children:[b.jsx("p",{children:t("login_auth_links_prompt")}),b.jsx("p",{children:b.jsxs(ps,{i18nKey:"login_auth_links",children:[b.jsx(Lo,{to:"/register",children:"Create an account"})," Or ",b.jsx(Lo,{to:"/",children:"Access as a guest"})]})})]})]})})})},ort=()=>{const{t}=ht();x9(t("action.register"));const{loading:e,authenticated:n,passwordlessUser:r,client:i,setClient:s}=l9(),o=y.useRef(null),a=gc(),c=Ku(),[l,u]=y.useState(!1),[d,f]=y.useState(),[p,m]=y.useState(""),[v,S]=y.useState(""),{recaptchaKey:_,register:w}=R9(i),{execute:T,reset:C,recaptchaId:I}=I9(_),R=y.useCallback(O=>{O.preventDefault();const A=new FormData(O.target),U=A.get("userName"),N=A.get("password"),L=A.get("passwordConfirmation");if(N!==L)return;(async()=>{u(!0);const X=await T(),[G,F]=await w(U,N,U,X,r);if(i&&(i!=null&&i.groupCallEventHandler)&&r)for(const V of i.groupCallEventHandler.groupCalls.values()){const J=V.room.roomId;try{await G.joinRoom(J)}catch(K){K.errcode==="M_LIMIT_EXCEEDED"?(await Jm(K.data.retry_after_ms),await G.joinRoom(J)):($R(K),k.error(`Couldn't join room ${J}`,K))}}s==null||s({client:G,session:F}),zt.instance.eventSignup.cacheSignupEnd(new Date)})().then(()=>{var X,G;(X=c.state)!=null&&X.from?a.push((G=c.state)==null?void 0:G.from):a.push("/")}).catch(X=>{f(X),u(!1),C()})},[w,c,a,r,C,T,i,s]);return y.useEffect(()=>{var O,A;p&&v&&p!==v?(O=o.current)==null||O.setCustomValidity(t("register.passwords_must_match")):(A=o.current)==null||A.setCustomValidity("")},[p,v,t]),y.useEffect(()=>{!e&&n&&!r&&!l&&a.push("/")},[e,a,n,r,l]),e?b.jsx(vI,{}):(zt.instance.eventSignup.cacheSignupStart(new Date),b.jsx(b.Fragment,{children:b.jsx("div",{className:Xc.container,children:b.jsxs("div",{className:Xc.content,children:[b.jsxs("div",{className:Xc.formContainer,children:[b.jsx(Zue,{width:"auto",height:"auto",className:Xc.logo}),b.jsx("h2",{children:t("register_heading")}),b.jsxs("form",{onSubmit:R,children:[b.jsx(qt,{children:b.jsx(ci,{type:"text",name:"userName",placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${on.defaultServerName()}`,"data-testid":"register_username"})}),b.jsx(qt,{children:b.jsx(ci,{required:!0,name:"password",type:"password",onChange:O=>m(O.target.value),value:p,placeholder:t("common.password"),label:t("common.password"),"data-testid":"register_password"})}),b.jsx(qt,{children:b.jsx(ci,{required:!0,type:"password",name:"passwordConfirmation",onChange:O=>S(O.target.value),value:v,placeholder:t("register_confirm_password_label"),label:t("register_confirm_password_label"),ref:o,"data-testid":"register_confirm_password"})}),b.jsx(Mn,{size:"sm",children:b.jsxs(ps,{i18nKey:"recaptcha_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",b.jsx(Hh,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",b.jsx(Hh,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",b.jsx("br",{}),'By clicking "Register", you agree to our'," ",b.jsx(Hh,{href:on.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),d&&b.jsx(qt,{children:b.jsx(Nf,{error:d})}),b.jsx(qt,{children:b.jsx(tn,{type:"submit",disabled:l,"data-testid":"register_register",children:t(l?"register.registering":"action.register")})}),b.jsx("div",{id:I})]})]}),b.jsx("div",{className:Xc.authLinks,children:b.jsxs(ps,{i18nKey:"register_auth_links",children:[b.jsx("p",{children:"Already have an account?"}),b.jsxs("p",{children:[b.jsx(Lo,{to:"/login",children:"Log in"})," Or ",b.jsx(Lo,{to:"/",children:"Access as a guest"})]})]})})]})})}))},art="_form_1axqw_8",crt="_headline_1axqw_18",lrt="_callEndedContent_1axqw_23",urt="_callEndedButton_1axqw_32",drt="_container_1axqw_37",frt="_main_1axqw_45",hrt="_logo_1axqw_53",prt="_footer_1axqw_62",y1={form:art,headline:crt,callEndedContent:lrt,callEndedButton:urt,container:drt,main:frt,logo:hrt,footer:prt};function Que(){const{setClient:t}=Df(),{privacyPolicyUrl:e,recaptchaKey:n,register:r}=R9(),{execute:i,reset:s,recaptchaId:o}=I9(n),a=y.useCallback(async c=>{if(!t)throw new Error("No client context");if(rt)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const l=await i(),u=Jue(),[d,f]=await r(u,Zi(16),c,l,!0);t({client:d,session:f})}catch(l){throw s(),l}},[i,s,r,t]);return{privacyPolicyUrl:e,registerPasswordlessUser:a,recaptchaId:o}}const grt=()=>{const[t,e]=y.useState(!1),[n,r]=y.useState(),{registerPasswordlessUser:i,recaptchaId:s}=Que(),o=y.useCallback(l=>{l.preventDefault(),e(!0);const d=new FormData(l.target).get("displayName");i(typeof d=="string"?d:"").catch(p=>{k.error("Failed to register passwordless user",l),e(!1),r(p)})},[i]),{t:a}=ht(),c=Ku();return b.jsxs(b.Fragment,{children:[b.jsxs(Af,{children:[b.jsx(Bp,{children:b.jsx(gp,{})}),b.jsx(jp,{children:b.jsx(k9,{preventNavigation:!0})})]}),b.jsxs("div",{className:y1.container,children:[b.jsxs("main",{className:y1.main,children:[b.jsx(ul,{size:"xl",weight:"semibold",className:y1.headline,children:a("lobby.join_button")}),b.jsxs(wI,{className:y1.form,onSubmit:o,children:[b.jsx(qt,{children:b.jsx(ci,{id:"displayName",name:"displayName",label:a("common.display_name"),placeholder:a("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),b.jsx(Mn,{size:"sm",children:b.jsxs(ps,{i18nKey:"room_auth_view_eula_caption",children:['By clicking "Join call now", you agree to our'," ",b.jsx(Hh,{href:on.get().eula,children:"End User Licensing Agreement (EULA)"})]})}),n&&b.jsx(qt,{children:b.jsx(Nf,{error:n})}),b.jsx(tn,{type:"submit",size:"lg",disabled:t,"data-testid":"joincall_joincall",children:a(t?"common.loading":"room_auth_view_join_button")}),b.jsx("div",{id:s})]})]}),b.jsx(Mn,{className:y1.footer,children:b.jsxs(ps,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",b.jsx(Lo,{to:"/register",state:{from:c},children:"Create an account"})]})})]})]})},mrt=3,vrt=3e3;async function ede(t,e=0,...n){try{return await t.joinRoom(...n)}catch(r){if(r instanceof Ii&&r.errcode==="M_FORBIDDEN"&&e<mrt)return await new Promise(i=>setTimeout(i,vrt)),ede(t,e+1,...n);throw r}}class qT extends Error{constructor(e,n,r){super(e),this.messageBody=n,this.reason=r}}const yrt=(t,e,n)=>{const[r,i]=y.useState({kind:"loading"}),s=y.useRef(),{t:o}=ht(),a=y.useCallback(()=>new qT(o("group_call_loader.banned_heading"),o("group_call_loader.banned_body"),u()),[o]),c=y.useCallback(()=>new qT(o("group_call_loader.knock_reject_heading"),o("group_call_loader.knock_reject_body"),u()),[o]),l=y.useCallback(()=>new qT(o("group_call_loader.call_ended_heading"),o("group_call_loader.call_ended_body"),u()),[o]),u=()=>{var d,f,p;return(p=(f=s.current)==null?void 0:f.currentState.getStateEvents(Z.RoomMember,(d=s.current)==null?void 0:d.myUserId))==null?void 0:p.getContent().reason};return y.useEffect(()=>{const d=async _=>{let w=null;const T=await t.getRoomIdForAlias(_.toLowerCase());return k.info(`${_} resolved to ${T.room_id}`),w=t.getRoom(T.room_id),w?k.info(`Already in room ${T.room_id}, not rejoining.`):(k.info(`Room ${T.room_id} not found, joining.`),w=await t.joinRoom(T.room_id,{viaServers:T.servers})),w},f=async(_,w,T)=>(await t.knockRoom(_,{viaServers:w}),T(),await new Promise((C,I)=>{t.on(ct.MyMembership,(R,O,A)=>{_===R.roomId&&(s.current=R,O===Ge.Invite&&A===Ge.Knock&&ede(t,0,R.roomId,{viaServers:w}).then(U=>{k.log("Auto-joined %s",U.roomId),C(U)},I),O===Ge.Ban&&I(a()),O===Ge.Leave&&I(c()))})})),p=async()=>{let _=null;if(e[0]==="#")_=await d(e),s.current=_;else{const w=e;_=t.getRoom(w),s.current=_??void 0;const T=_==null?void 0:_.getMyMembership();if(T===Ge.Join)return _;if(rt)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(T===Ge.Ban)throw a();if(T===Ge.Invite)_=await t.joinRoom(w,{viaServers:n});else{let C;try{C=await t.getRoomSummary(w,n)}catch(I){k.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",I)}if(C===void 0||C.join_rule===hu.Public)_=await t.joinRoom(w,{viaServers:n});else if(C.join_rule===hu.Knock){const I=C;let R=()=>{};const O=new Promise(A=>{I.membership!==Ge.Knock?R=A:A()});i({kind:"canKnock",roomSummary:I,knock:R}),await O,_=await f(C.room_id,n,()=>i({kind:"waitForInvite",roomSummary:I}))}else throw new Error(`Room ${C.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`)}}return k.info(`Joined ${e}, waiting room to be ready for group calls`),await t.waitUntilRoomReadyForGroupCalls(_.roomId),k.info(`${e}, is ready for group calls`),_},m=async()=>{const _=await p();return s.current=_,k.debug(`Fetched / joined room ${e}`),t.matrixRTC.getRoomSession(_)},v=async()=>{t.getSyncState()!==ii.Syncing&&(k.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(_=>{const w=()=>{if(t.getSyncState()===ii.Syncing)return t.off(qe.Sync,w),_()};t.on(qe.Sync,w)}),k.debug("useLoadGroupCall: client is now syncing."))},S=async()=>{await new Promise((_,w)=>{t.on(ct.MyMembership,(T,C)=>{C===Ge.Leave&&w(l()),C===Ge.Ban&&w(a())})})};r.kind==="loading"&&(k.log("Start loading group call"),v().then(m).then(_=>i({kind:"loaded",rtcSession:_})).then(S).catch(_=>i({kind:"failed",error:_})))},[a,t,c,l,e,r,o,n]),r};function _rt({client:t,roomIdOrAlias:e,viaServers:n,children:r}){const{t:i}=ht(),s=yrt(t,e,n);switch(s.kind){case"loaded":case"waitForInvite":case"canKnock":return r(s);case"loading":return b.jsx(qh,{children:b.jsx("h1",{children:i("common.loading")})});case"failed":return s.error.errcode==="M_NOT_FOUND"?b.jsxs(qh,{children:[b.jsx(ul,{children:i("group_call_loader.failed_heading")}),b.jsx(Mn,{children:i("group_call_loader.failed_text")}),b.jsx(Lo,{to:"/",children:i("common.home")})]}):s.error instanceof qT?b.jsxs(qh,{children:[b.jsx(ul,{children:s.error.message}),b.jsx(Mn,{children:s.error.messageBody}),s.error.reason&&b.jsxs(b.Fragment,{children:[i("group_call_loader.reason"),":",b.jsxs(Mn,{size:"sm",children:['"',s.error.reason,'"']})]}),b.jsx(Lo,{to:"/",children:i("common.home")})]}):b.jsx(mI,{error:s.error})}}const brt="_inRoom_14q56_8",Srt="_header_14q56_17",wrt="_filler_14q56_29",Ert="_footer_14q56_34",Trt="_hidden_14q56_52",Crt="_overlay_14q56_56",krt="_logo_14q56_75",Rrt="_buttons_14q56_84",Irt="_layout_14q56_90",xrt="_fixedGrid_14q56_113",Prt="_scrollingGrid_14q56_119",Ort="_tile_14q56_138",Mrt="_maximised_14q56_143",Nr={inRoom:brt,header:Srt,filler:wrt,footer:Ert,hidden:Trt,overlay:Crt,logo:krt,buttons:Rrt,layout:Irt,fixedGrid:xrt,scrollingGrid:Prt,tile:Ort,maximised:Mrt},Art="_content_164d7_8",Lrt="_wait_164d7_19",Drt="_join_164d7_32",_1={content:Art,wait:Lrt,join:Drt};function Nrt(t=!1){const e=gc();y.useEffect(()=>{let n;return t&&(n=e.block(r=>{const i=new URL(r.pathname,window.location.href);i.search=r.search,i.hash=r.hash,window.location.href=i.href})),()=>{n&&n()}},[e,t])}function PL(t,e,n){var r,i,s,o,a;e==null&&(e=100);function c(){var u=Date.now()-o;u<e&&u>=0?r=setTimeout(c,e-u):(r=null,n||(a=t.apply(s,i),s=i=null))}var l=function(){s=this,i=arguments,o=Date.now();var u=n&&!r;return r||(r=setTimeout(c,e)),u&&(a=t.apply(s,i),s=i=null),a};return l.clear=function(){r&&(clearTimeout(r),r=null)},l.flush=function(){r&&(a=t.apply(s,i),s=i=null,clearTimeout(r),r=null)},l}PL.debounce=PL;var Urt=PL;const YG=es(Urt);function L0(t){let{debounce:e,scroll:n,polyfill:r,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1};const s=r||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,a]=y.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),c=y.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o}),l=e?typeof e=="number"?e:e.scroll:null,u=e?typeof e=="number"?e:e.resize:null,d=y.useRef(!1);y.useEffect(()=>(d.current=!0,()=>void(d.current=!1)));const[f,p,m]=y.useMemo(()=>{const w=()=>{if(!c.current.element)return;const{left:T,top:C,width:I,height:R,bottom:O,right:A,x:U,y:N}=c.current.element.getBoundingClientRect(),L={left:T,top:C,width:I,height:R,bottom:O,right:A,x:U,y:N};c.current.element instanceof HTMLElement&&i&&(L.height=c.current.element.offsetHeight,L.width=c.current.element.offsetWidth),Object.freeze(L),d.current&&!jrt(c.current.lastBounds,L)&&a(c.current.lastBounds=L)};return[w,u?YG(w,u):w,l?YG(w,l):w]},[a,i,l,u]);function v(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(w=>w.removeEventListener("scroll",m,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null)}function S(){c.current.element&&(c.current.resizeObserver=new s(m),c.current.resizeObserver.observe(c.current.element),n&&c.current.scrollContainers&&c.current.scrollContainers.forEach(w=>w.addEventListener("scroll",m,{capture:!0,passive:!0})))}const _=w=>{!w||w===c.current.element||(v(),c.current.element=w,c.current.scrollContainers=tde(w),S())};return Frt(m,!!n),$rt(p),y.useEffect(()=>{v(),S()},[n,m,p]),y.useEffect(()=>v,[]),[_,o,f]}function $rt(t){y.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function Frt(t,e){y.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[t,e])}function tde(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...tde(t.parentElement)]}const Brt=["x","y","top","bottom","left","right","width","height"],jrt=(t,e)=>Brt.every(n=>t[n]===e[n]);var V1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nde(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rde={exports:{}};(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(V1,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,S){var _=v[S];if(typeof _.bind=="function")return _.bind(v);try{return Function.prototype.bind.call(_,v)}catch{return function(){return Function.prototype.apply.apply(_,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function u(){for(var v=this.getLevel(),S=0;S<i.length;S++){var _=i[S];this[_]=S<v?e:this.methodFactory(_,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function d(v){return function(){typeof console!==n&&(u.call(this),this[v].apply(this,arguments))}}function f(v,S,_){return l(v)||d.apply(this,arguments)}function p(v,S){var _=this,w,T,C,I="loglevel";typeof v=="string"?I+=":"+v:typeof v=="symbol"&&(I=void 0);function R(L){var j=(i[L]||"silent").toUpperCase();if(!(typeof window===n||!I)){try{window.localStorage[I]=j;return}catch{}try{window.document.cookie=encodeURIComponent(I)+"="+j+";"}catch{}}}function O(){var L;if(!(typeof window===n||!I)){try{L=window.localStorage[I]}catch{}if(typeof L===n)try{var j=window.document.cookie,X=encodeURIComponent(I),G=j.indexOf(X+"=");G!==-1&&(L=/^([^;]+)/.exec(j.slice(G+X.length+1))[1])}catch{}return _.levels[L]===void 0&&(L=void 0),L}}function A(){if(!(typeof window===n||!I)){try{window.localStorage.removeItem(I)}catch{}try{window.document.cookie=encodeURIComponent(I)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function U(L){var j=L;if(typeof j=="string"&&_.levels[j.toUpperCase()]!==void 0&&(j=_.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=_.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+L)}_.name=v,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=S||f,_.getLevel=function(){return C??T??w},_.setLevel=function(L,j){return C=U(L),j!==!1&&R(C),u.call(_)},_.setDefaultLevel=function(L){T=U(L),O()||_.setLevel(L,!1)},_.resetLevel=function(){C=null,A(),u.call(_)},_.enableAll=function(L){_.setLevel(_.levels.TRACE,L)},_.disableAll=function(L){_.setLevel(_.levels.SILENT,L)},_.rebuild=function(){if(o!==_&&(w=U(o.getLevel())),u.call(_),o===_)for(var L in s)s[L].rebuild()},w=U(o?o.getLevel():"WARN");var N=O();N!=null&&(C=U(N)),u.call(_)}o=new p,o.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var S=s[v];return S||(S=s[v]=new p(v,o.methodFactory)),S};var m=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=m),o},o.getLoggers=function(){return s},o.default=o,o})})(rde);var Hrt=rde.exports;const Krt=nde(Hrt);var OL=function(t,e){return OL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},OL(t,e)};function qu(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");OL(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Vrt(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,[])).next())})}function ide(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Rv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function t2(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function n2(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function zm(t){return this instanceof zm?(this.v=t,this):new zm(t)}function qrt(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(p){return function(m){return Promise.resolve(m).then(p,d)}}function a(p,m){r[p]&&(i[p]=function(v){return new Promise(function(S,_){s.push([p,v,S,_])>1||c(p,v)})},m&&(i[p]=m(i[p])))}function c(p,m){try{l(r[p](m))}catch(v){f(s[0][3],v)}}function l(p){p.value instanceof zm?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}function u(p){c("next",p)}function d(p){c("throw",p)}function f(p,m){p(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Grt(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Rv=="function"?Rv(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function zr(t){return typeof t=="function"}function P9(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var XO=P9(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function r2(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var iS=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Rv(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(zr(u))try{u()}catch(v){s=v instanceof XO?v.errors:[v]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Rv(d),p=f.next();!p.done;p=f.next()){var m=p.value;try{JG(m)}catch(v){s=s??[],v instanceof XO?s=n2(n2([],t2(s)),t2(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{p&&!p.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new XO(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)JG(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&r2(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&r2(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),sde=iS.EMPTY;function ode(t){return t instanceof iS||t&&"closed"in t&&zr(t.remove)&&zr(t.add)&&zr(t.unsubscribe)}function JG(t){zr(t)?t():t.unsubscribe()}var ade={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},zrt={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,n2([t,e],t2(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function cde(t){zrt.setTimeout(function(){throw t})}function XG(){}function GT(t){t()}var O9=function(t){qu(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,ode(n)&&n.add(r)):r.destination=Xrt,r}return e.create=function(n,r,i){return new ML(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(iS),Wrt=Function.prototype.bind;function ZO(t,e){return Wrt.call(t,e)}var Yrt=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){EE(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){EE(r)}else EE(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){EE(n)}},t}(),ML=function(t){qu(e,t);function e(n,r,i){var s=t.call(this)||this,o;if(zr(n)||!n)o={next:n??void 0,error:r??void 0,complete:i??void 0};else{var a;s&&ade.useDeprecatedNextContext?(a=Object.create(n),a.unsubscribe=function(){return s.unsubscribe()},o={next:n.next&&ZO(n.next,a),error:n.error&&ZO(n.error,a),complete:n.complete&&ZO(n.complete,a)}):o=n}return s.destination=new Yrt(o),s}return e}(O9);function EE(t){cde(t)}function Jrt(t){throw t}var Xrt={closed:!0,next:XG,error:Jrt,complete:XG},M9=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function lde(t){return t}function Zrt(t){return t.length===0?lde:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Do=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=eit(e)?e:new ML(e,n,r);return GT(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=ZG(n),new n(function(i,s){var o=new ML({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[M9]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Zrt(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=ZG(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function ZG(t){var e;return(e=t??ade.Promise)!==null&&e!==void 0?e:Promise}function Qrt(t){return t&&zr(t.next)&&zr(t.error)&&zr(t.complete)}function eit(t){return t&&t instanceof O9||Qrt(t)&&ode(t)}function tit(t){return zr(t==null?void 0:t.lift)}function sS(t){return function(e){if(tit(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function i2(t,e,n,r,i){return new nit(t,e,n,r,i)}var nit=function(t){qu(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(O9),rit=P9(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ude=function(t){qu(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new QG(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new rit},e.prototype.next=function(n){var r=this;GT(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Rv(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;GT(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;GT(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?sde:(this.currentObservers=null,a.push(n),new iS(function(){r.currentObservers=null,r2(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Do;return n.source=this,n},e.create=function(n,r){return new QG(n,r)},e}(Do),QG=function(t){qu(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:sde},e}(ude);(function(t){qu(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(ude);var iit={now:function(){return Date.now()},delegate:void 0},sit=function(t){qu(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(iS),ez={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,n2([t,e],t2(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},oit=function(t){qu(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),ez.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&ez.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,r2(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(sit),tz=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=iit.now,t}(),ait=function(t){qu(e,t);function e(n,r){r===void 0&&(r=tz.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(tz);new ait(oit);function cit(t){return t&&zr(t.schedule)}function lit(t){return t[t.length-1]}function dde(t){return cit(lit(t))?t.pop():void 0}var fde=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function hde(t){return zr(t==null?void 0:t.then)}function pde(t){return zr(t[M9])}function gde(t){return Symbol.asyncIterator&&zr(t==null?void 0:t[Symbol.asyncIterator])}function mde(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function uit(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var vde=uit();function yde(t){return zr(t==null?void 0:t[vde])}function _de(t){return qrt(this,arguments,function(){var e,n,r,i;return ide(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,zm(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,zm(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,zm(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function bde(t){return zr(t==null?void 0:t.getReader)}function oS(t){if(t instanceof Do)return t;if(t!=null){if(pde(t))return dit(t);if(fde(t))return fit(t);if(hde(t))return hit(t);if(gde(t))return Sde(t);if(yde(t))return pit(t);if(bde(t))return git(t)}throw mde(t)}function dit(t){return new Do(function(e){var n=t[M9]();if(zr(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function fit(t){return new Do(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function hit(t){return new Do(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,cde)})}function pit(t){return new Do(function(e){var n,r;try{for(var i=Rv(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Sde(t){return new Do(function(e){mit(t,e).catch(function(n){return e.error(n)})})}function git(t){return Sde(_de(t))}function mit(t,e){var n,r,i,s;return Vrt(this,void 0,void 0,function(){var o,a;return ide(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Grt(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Gh(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function wde(t,e){return e===void 0&&(e=0),sS(function(n,r){n.subscribe(i2(r,function(i){return Gh(r,t,function(){return r.next(i)},e)},function(){return Gh(r,t,function(){return r.complete()},e)},function(i){return Gh(r,t,function(){return r.error(i)},e)}))})}function Ede(t,e){return e===void 0&&(e=0),sS(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function vit(t,e){return oS(t).pipe(Ede(e),wde(e))}function yit(t,e){return oS(t).pipe(Ede(e),wde(e))}function _it(t,e){return new Do(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function bit(t,e){return new Do(function(n){var r;return Gh(n,e,function(){r=t[vde](),Gh(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return zr(r==null?void 0:r.return)&&r.return()}})}function Tde(t,e){if(!t)throw new Error("Iterable cannot be null");return new Do(function(n){Gh(n,e,function(){var r=t[Symbol.asyncIterator]();Gh(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Sit(t,e){return Tde(_de(t),e)}function wit(t,e){if(t!=null){if(pde(t))return vit(t,e);if(fde(t))return _it(t,e);if(hde(t))return yit(t,e);if(gde(t))return Tde(t,e);if(yde(t))return bit(t,e);if(bde(t))return Sit(t,e)}throw mde(t)}function Eit(t,e){return e?wit(t,e):oS(t)}P9(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function EI(t,e){return sS(function(n,r){var i=0;n.subscribe(i2(r,function(s){r.next(t.call(e,s,i++))}))})}function Tit(t,e,n,r,i,s,o,a){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&e.complete()},p=function(v){return l<r?m(v):c.push(v)},m=function(v){l++;var S=!1;oS(n(v,u++)).subscribe(i2(e,function(_){e.next(_)},function(){S=!0},void 0,function(){if(S)try{l--;for(var _=function(){var w=c.shift();o||m(w)};c.length&&l<r;)_();f()}catch(w){e.error(w)}}))};return t.subscribe(i2(e,p,function(){d=!0,f()})),function(){}}function Cde(t,e,n){return n===void 0&&(n=1/0),zr(e)?Cde(function(r,i){return EI(function(s,o){return e(r,s,i,o)})(oS(t(r,i)))},n):(typeof e=="number"&&(n=e),sS(function(r,i){return Tit(r,i,t,n)}))}function Cit(t){return Cde(lde,t)}function kit(){return Cit(1)}function nz(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return kit()(Eit(t,dde(t)))}function TI(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=dde(t);return sS(function(r,i){(n?nz(t,r,n):nz(t,r)).subscribe(i)})}var Rit="lk";function A9(t){return typeof t>"u"?!1:Iit(t)||xit(t)}function Iit(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function xit(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function Pit(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function Oit(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(Pit(t))return`${t.participant.identity}_${t.source}_placeholder`;if(A9(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function kde(t){return t instanceof UA}var Mit=[fe.ConnectionStateChanged,fe.RoomMetadataChanged,fe.ActiveSpeakersChanged,fe.ConnectionQualityChanged,fe.ParticipantConnected,fe.ParticipantDisconnected,fe.ParticipantPermissionsChanged,fe.ParticipantMetadataChanged,fe.ParticipantNameChanged,fe.ParticipantAttributesChanged,fe.TrackMuted,fe.TrackUnmuted,fe.TrackPublished,fe.TrackUnpublished,fe.TrackStreamStateChanged,fe.TrackSubscriptionFailed,fe.TrackSubscriptionPermissionChanged,fe.TrackSubscriptionStatusChanged],Ait=[...Mit,fe.LocalTrackPublished,fe.LocalTrackUnpublished];le.TrackPublished,le.TrackUnpublished,le.TrackMuted,le.TrackUnmuted,le.TrackStreamStateChanged,le.TrackSubscribed,le.TrackUnsubscribed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionFailed,le.LocalTrackPublished,le.LocalTrackUnpublished;var Lit=[le.ConnectionQualityChanged,le.IsSpeakingChanged,le.ParticipantMetadataChanged,le.ParticipantPermissionsChanged,le.TrackMuted,le.TrackUnmuted,le.TrackPublished,le.TrackUnpublished,le.TrackStreamStateChanged,le.TrackSubscriptionFailed,le.TrackSubscriptionPermissionChanged,le.TrackSubscriptionStatusChanged];[...Lit,le.LocalTrackPublished,le.LocalTrackUnpublished];var Sf=Krt.getLogger("lk-components-js");Sf.setDefaultLevel("WARN");function Rde(t){return typeof t=="object"}function Ide(t){return Array.isArray(t)&&t.filter(Rde).length>0}function Dit(t){return`${Rit}-${t}`}function Nit(t){const e=AL(t),n=xde(t.participant).pipe(EI(()=>AL(t)),TI(e));return{className:Dit(t.source===ve.Source.Camera||t.source===ve.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function AL(t){if(A9(t))return t.publication;{const{source:e,name:n,participant:r}=t;if(e&&n)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===n);if(n)return r.getTrackPublicationByName(n);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function Uit(t,...e){return new Do(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(TI(t))}function $it(t,...e){return new Do(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(TI(t))}function xde(t){return $it(t,le.TrackMuted,le.TrackUnmuted,le.ParticipantPermissionsChanged,le.TrackPublished,le.TrackUnpublished,le.LocalTrackPublished,le.LocalTrackUnpublished,le.MediaDevicesError,le.TrackSubscriptionStatusChanged).pipe(EI(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(ve.Source.Microphone),o=e.getTrackPublication(ve.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:n,isScreenShareEnabled:i,cameraTrack:o,microphoneTrack:s,participant:e}}))}new TextEncoder;new TextDecoder;function rz(t,e,n=!0){const r=[t.localParticipant,...Array.from(t.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));i.push(...a)})}),{trackReferences:i,participants:r}}function Fit(t,e,n){var r,i;const s=(r=n.additionalRoomEvents)!=null?r:Ait,o=(i=n.onlySubscribed)!=null?i:!0,a=Array.from(new Set([fe.ParticipantConnected,fe.ParticipantDisconnected,fe.ConnectionStateChanged,fe.LocalTrackPublished,fe.LocalTrackUnpublished,fe.TrackPublished,fe.TrackUnpublished,fe.TrackSubscriptionStatusChanged,...s]).values());return Uit(t,...a).pipe(EI(c=>{const l=rz(c,e,o);return Sf.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),TI(rz(t,e,o)))}y.createContext(void 0);const Bit=y.createContext(void 0);function jit(){return y.useContext(Bit)}function Pde(t){const e=jit(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}y.createContext(void 0);const Ode=y.createContext(void 0);function Hit(){return y.useContext(Ode)}function Mde(t){const e=Hit(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}y.createContext(void 0);function Ade(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=Ade(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Kit(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=Ade(t))&&(r&&(r+=" "),r+=e);return r}function Vit(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(r){console.error(r)}}}function qit(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];for(const i in r){const s=e[i],o=r[i];typeof s=="function"&&typeof o=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=Vit(s,o):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[i]=Kit(s,o):e[i]=o!==void 0?o:s}}return e}function Git(t={}){const e=Mde(t.room),[n,r]=y.useState(e.localParticipant),[i,s]=y.useState(n.isMicrophoneEnabled),[o,a]=y.useState(n.isMicrophoneEnabled),[c,l]=y.useState(n.lastMicrophoneError),[u,d]=y.useState(n.lastCameraError),[f,p]=y.useState(n.isMicrophoneEnabled),[m,v]=y.useState(void 0),[S,_]=y.useState(void 0),w=T=>{a(T.isCameraEnabled),s(T.isMicrophoneEnabled),p(T.isScreenShareEnabled),_(T.cameraTrack),v(T.microphoneTrack),l(T.participant.lastMicrophoneError),d(T.participant.lastCameraError),r(T.participant)};return y.useEffect(()=>{const T=xde(e.localParticipant).subscribe(w);return()=>T.unsubscribe()},[e]),{isMicrophoneEnabled:i,isScreenShareEnabled:f,isCameraEnabled:o,microphoneTrack:m,cameraTrack:S,lastMicrophoneError:c,lastCameraError:u,localParticipant:n}}function zit(t=[ve.Source.Camera,ve.Source.Microphone,ve.Source.ScreenShare,ve.Source.ScreenShareAudio,ve.Source.Unknown],e={}){const n=Mde(e.room),[r,i]=y.useState([]),[s,o]=y.useState([]),a=y.useMemo(()=>t.map(c=>Rde(c)?c.source:c),[JSON.stringify(t)]);return y.useEffect(()=>{const c=Fit(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:u})=>{Sf.debug("setting track bundles",l,u),i(l),o(u)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),y.useMemo(()=>{if(Ide(t)){const c=Yit(t,s),l=Array.from(r);return s.forEach(u=>{c.has(u.identity)&&(c.get(u.identity)??[]).forEach(d=>{if(r.find(({participant:p,publication:m})=>u.identity===p.identity&&m.source===d))return;Sf.debug(`Add ${d} placeholder for participant ${u.identity}.`);const f={participant:u,source:d};l.push(f)})}),l}else return r},[r,s,t])}function Wit(t,e){const n=new Set(t);for(const r of e)n.delete(r);return n}function Yit(t,e){const n=new Map;if(Ide(t)){const r=t.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(Wit(new Set(r),new Set(s)));o.length>0&&n.set(i.identity,o)})}return n}function Jit(t){return t!==void 0}function Xit(...t){return qit(...t.filter(Jit))}function Lde(t,e={}){const[n,r]=y.useState(AL(t)),[i,s]=y.useState(n==null?void 0:n.isMuted),[o,a]=y.useState(n==null?void 0:n.isSubscribed),[c,l]=y.useState(n==null?void 0:n.track),[u,d]=y.useState("landscape"),f=y.useRef(),{className:p,trackObserver:m}=y.useMemo(()=>Nit(t),[t.participant.sid??t.participant.identity,t.source,A9(t)&&t.publication.trackSid]);return y.useEffect(()=>{const v=m.subscribe(S=>{Sf.debug("update track",S),r(S),s(S==null?void 0:S.isMuted),a(S==null?void 0:S.isSubscribed),l(S==null?void 0:S.track)});return()=>v==null?void 0:v.unsubscribe()},[m]),y.useEffect(()=>{var v,S;return c&&(f.current&&c.detach(f.current),(v=e.element)!=null&&v.current&&!(kde(t.participant)&&(c==null?void 0:c.kind)==="audio")&&c.attach(e.element.current)),f.current=(S=e.element)==null?void 0:S.current,()=>{f.current&&(c==null||c.detach(f.current))}},[c,e.element]),y.useEffect(()=>{var v,S;if(typeof((v=n==null?void 0:n.dimensions)==null?void 0:v.width)=="number"&&typeof((S=n==null?void 0:n.dimensions)==null?void 0:S.height)=="number"){const _=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(_)}},[n]),{publication:n,isMuted:i,isSubscribed:o,track:c,elementProps:Xit(e.props,{className:p,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var Zit="Expected a function",iz=NaN,Qit="[object Symbol]",est=/^\s+|\s+$/g,tst=/^[-+]0x[0-9a-f]+$/i,nst=/^0b[01]+$/i,rst=/^0o[0-7]+$/i,ist=parseInt,sst=typeof V1=="object"&&V1&&V1.Object===Object&&V1,ost=typeof self=="object"&&self&&self.Object===Object&&self,ast=sst||ost||Function("return this")(),cst=Object.prototype,lst=cst.toString,ust=Math.max,dst=Math.min,QO=function(){return ast.Date.now()};function fst(t,e,n){var r,i,s,o,a,c,l=0,u=!1,d=!1,f=!0;if(typeof t!="function")throw new TypeError(Zit);e=sz(e)||0,LL(n)&&(u=!!n.leading,d="maxWait"in n,s=d?ust(sz(n.maxWait)||0,e):s,f="trailing"in n?!!n.trailing:f);function p(R){var O=r,A=i;return r=i=void 0,l=R,o=t.apply(A,O),o}function m(R){return l=R,a=setTimeout(_,e),u?p(R):o}function v(R){var O=R-c,A=R-l,U=e-O;return d?dst(U,s-A):U}function S(R){var O=R-c,A=R-l;return c===void 0||O>=e||O<0||d&&A>=s}function _(){var R=QO();if(S(R))return w(R);a=setTimeout(_,v(R))}function w(R){return a=void 0,f&&r?p(R):(r=i=void 0,o)}function T(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function C(){return a===void 0?o:w(QO())}function I(){var R=QO(),O=S(R);if(r=arguments,i=this,c=R,O){if(a===void 0)return m(c);if(d)return a=setTimeout(_,e),p(c)}return a===void 0&&(a=setTimeout(_,e)),o}return I.cancel=T,I.flush=C,I}function LL(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function hst(t){return!!t&&typeof t=="object"}function pst(t){return typeof t=="symbol"||hst(t)&&lst.call(t)==Qit}function sz(t){if(typeof t=="number")return t;if(pst(t))return iz;if(LL(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=LL(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(est,"");var n=nst.test(t);return n||rst.test(t)?ist(t.slice(2),n?2:8):tst.test(t)?iz:+t}var gst=fst;const oz=nde(gst);function mst(t){const e=y.useRef(t);e.current=t,y.useEffect(()=>()=>{e.current()},[])}function vst(t,e=500,n){const r=y.useRef();mst(()=>{r.current&&r.current.cancel()});const i=y.useMemo(()=>{const s=oz(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!r.current,o.flush=()=>s.flush(),o},[t,e,n]);return y.useEffect(()=>{r.current=oz(t,e,n)},[t,e,n]),i}function yst(t,e,n){const r=(l,u)=>l===u,i=t instanceof Function?t():t,[s,o]=y.useState(i),a=y.useRef(i),c=vst(o,e,n);return r(a.current,i)||(c(i),a.current=i),[s,c]}function _st({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var o;const[a,c]=y.useState(null),[l,u]=y.useState(()=>({isIntersecting:i,entry:void 0})),d=y.useRef();d.current=s;const f=((o=l.entry)==null?void 0:o.isIntersecting)&&r;y.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||f)return;let v;const S=new IntersectionObserver(_=>{const w=Array.isArray(S.thresholds)?S.thresholds:[S.thresholds];_.forEach(T=>{const C=T.isIntersecting&&w.some(I=>T.intersectionRatio>=I);u({isIntersecting:C,entry:T}),d.current&&d.current(C,T),C&&r&&v&&(v(),v=void 0)})},{threshold:t,root:e,rootMargin:n});return S.observe(a),()=>{S.disconnect()}},[a,JSON.stringify(t),e,n,f,r]);const p=y.useRef(null);y.useEffect(()=>{var v;!a&&(v=l.entry)!=null&&v.target&&!r&&!f&&p.current!==l.entry.target&&(p.current=l.entry.target,u({isIntersecting:i,entry:void 0}))},[a,l.entry,r,f,i]);const m=[c,!!l.isIntersecting,l.entry];return m.ref=m[0],m.isIntersecting=m[1],m.entry=m[2],m}const bst=y.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...s},o){const a=Pde(r),c=y.useRef(null);y.useImperativeHandle(o,()=>c.current);const l=_st({root:c.current}),[u]=yst(l,3e3);y.useEffect(()=>{i&&a.publication instanceof C_&&(u==null?void 0:u.isIntersecting)===!1&&(l==null?void 0:l.isIntersecting)===!1&&a.publication.setSubscribed(!1)},[u,a,i]),y.useEffect(()=>{i&&a.publication instanceof C_&&(l==null?void 0:l.isIntersecting)===!0&&a.publication.setSubscribed(!0)},[l,a,i]);const{elementProps:d,publication:f,isSubscribed:p}=Lde(a,{element:c,props:s});y.useEffect(()=>{n==null||n(!!p)},[p,n]);const m=v=>{e==null||e(v),t==null||t({participant:a==null?void 0:a.participant,track:f})};return y.createElement("video",{ref:c,...d,muted:!0,onClick:m})}),Sst=y.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,muted:r,...i},s){const o=Pde(t),a=y.useRef(null);y.useImperativeHandle(s,()=>a.current);const{elementProps:c,isSubscribed:l,track:u,publication:d}=Lde(o,{element:a,props:i});return y.useEffect(()=>{e==null||e(!!l)},[l,e]),y.useEffect(()=>{u===void 0||n===void 0||(u instanceof Pm?u.setVolume(n):Sf.warn("Volume can only be set on remote audio tracks."))},[n,u]),y.useEffect(()=>{d===void 0||r===void 0||(d instanceof C_?d.setEnabled(!r):Sf.warn("Can only call setEnabled on remote track publications."))},[r,d,u]),y.createElement("audio",{ref:a,...c})});function wst({volume:t,muted:e}){const n=zit([ve.Source.Microphone,ve.Source.ScreenShareAudio,ve.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(r=>!kde(r.participant)&&r.publication.kind===ve.Kind.Audio);return y.createElement("div",{style:{display:"none"}},n.map(r=>y.createElement(Sst,{key:Oit(r),trackRef:r,volume:t,muted:e})))}function Est(t,e){const[n,r]=y.useState(),i=y.useMemo(()=>new qs,[]);return y.useEffect(()=>{let s=!1,o=[];return i.lock().then(async a=>{try{(t.audio||t.video)&&(o=await Y8(t),s?o.forEach(c=>c.stop()):r(o))}catch(c){e&&c instanceof Error?e(c):Sf.error(c)}finally{a()}}),()=>{s=!0,o.forEach(a=>{a.stop()})}},[JSON.stringify(t),e,i]),n}const Tst="_preview_f1bks_8",Cst="_avatarContainer_f1bks_26",kst="_buttonBar_f1bks_38",e6={preview:Tst,avatarContainer:Cst,buttonBar:kst};function wp(t){const e=y.useRef();return e.current??(e.current={value:t()}),e.current.value}const Rst=({matrixInfo:t,muteStates:e,children:n})=>{const[r,i]=L0(),s=rS(),o=wp(()=>e.audio.enabled&&{deviceId:s.audioInput.selectedId}),a=y.useMemo(()=>({audio:Object.assign({},o),video:e.video.enabled&&{deviceId:s.videoInput.selectedId}}),[o,s.videoInput.selectedId,e.video.enabled]),c=y.useCallback(f=>{var p,m,v,S;k.error("Error while creating preview Tracks:",f),(m=(p=e.audio).setEnabled)==null||m.call(p,!1),(S=(v=e.video).setEnabled)==null||S.call(v,!1)},[e.audio,e.video]),l=Est(a,c),u=y.useMemo(()=>l==null?void 0:l.find(f=>f.kind===ve.Kind.Video),[l]),d=y.useRef(null);return y.useEffect(()=>(d.current&&(u==null||u.attach(d.current)),()=>{u==null||u.detach()}),[u]),b.jsxs("div",{className:Pe(e6.preview),ref:r,children:[b.jsx("video",{ref:d,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),!e.video.enabled&&b.jsx("div",{className:e6.avatarContainer,children:b.jsx(cy,{id:t.userId,name:t.displayName,size:Math.min(i.width,i.height)/2,src:t.avatarUrl})}),b.jsx("div",{className:e6.buttonBar,children:n})]})},Dde=t=>{const{t:e}=ht();return b.jsx(tn,{kind:"secondary",size:"sm",Icon:YBe,...t,children:e("action.invite")})},Nde=({client:t,matrixInfo:e,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:s,hideHeader:o,participantCount:a,onShareClick:c,waitingForInvite:l})=>{const{t:u}=ht();Nrt();const d=y.useCallback(()=>{var O,A;return(A=(O=n.audio).setEnabled)==null?void 0:A.call(O,U=>!U)},[n]),f=y.useCallback(()=>{var O,A;return(A=(O=n.video).setEnabled)==null?void 0:A.call(O,U=>!U)},[n]),[p,m]=y.useState(!1),[v,S]=y.useState(T9),_=y.useCallback(()=>m(!0),[m]),w=y.useCallback(()=>m(!1),[m]),T=gc(),C=y.useCallback(()=>T.push("/"),[T]),I=tI("(max-height: 500px)"),R=!s&&b.jsx(Lo,{className:_1.recents,to:"/",children:u("lobby.leave_button")});return b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:Pe(_1.room,Nr.inRoom),children:[!o&&b.jsxs(Af,{children:[b.jsx(Bp,{children:b.jsx(bae,{id:e.roomId,name:e.roomName,avatarUrl:e.roomAvatar,encrypted:e.e2eeSystem.kind!==En.NONE,participantCount:a})}),b.jsx(jp,{children:c!==null&&b.jsx(Dde,{onClick:c})})]}),b.jsxs("div",{className:_1.content,children:[b.jsx(Rst,{matrixInfo:e,muteStates:n,children:b.jsx(tn,{className:Pe(_1.join,{[_1.wait]:l}),size:l?"sm":"lg",onClick:()=>{l||r()},"data-testid":"lobby_joinCall",children:i??u("lobby.join_button")})}),!I&&R]}),b.jsxs("div",{className:Nr.footer,children:[I&&R,b.jsxs("div",{className:Nr.buttons,children:[b.jsx(Sae,{muted:!n.audio.enabled,onClick:d,disabled:n.audio.setEnabled===null}),b.jsx(wae,{muted:!n.video.enabled,onClick:f,disabled:n.video.setEnabled===null}),b.jsx(Tae,{onClick:_}),!s&&b.jsx(Eae,{onClick:C})]})]})]}),t&&b.jsx(C9,{client:t,open:p,onDismiss:w,tab:v,onTabChange:S})]})},Ist="_headline_rq0tx_8",xst="_callEndedContent_rq0tx_15",Pst="_disconnectedButtons_rq0tx_26",Ost="_rageshakeButton_rq0tx_31",Mst="_callEndedButton_rq0tx_35",Ast="_submitButton_rq0tx_40",Lst="_container_rq0tx_47",Dst="_main_rq0tx_55",Nst="_logo_rq0tx_63",Ust="_footer_rq0tx_72",ho={headline:Ist,callEndedContent:xst,disconnectedButtons:Pst,rageshakeButton:Ost,callEndedButton:Mst,submitButton:Ast,container:Lst,main:Dst,logo:Nst,footer:Ust},$st="_starIcon_1082m_8",Fst="_starRating_1082m_12",Bst="_inputContainer_1082m_18",jst="_hideElement_1082m_22",b1={starIcon:$st,starRating:Fst,inputContainer:Bst,hideElement:jst},Hst=(t,e)=>y.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),Kst=y.forwardRef(Hst),Vst=(t,e)=>y.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),qst=y.forwardRef(Vst);function Gst({starCount:t,onChange:e,required:n}){const[r,i]=y.useState(0),[s,o]=y.useState(0),{t:a}=ht();return b.jsx("div",{className:b1.starRating,children:[...Array(t)].map((c,l)=>(l+=1,b.jsxs("div",{className:b1.inputContainer,onMouseEnter:()=>o(l),onMouseLeave:()=>o(r),children:[b.jsx("input",{className:b1.hideElement,type:"radio",id:"starInput"+String(l),value:String(l)+"Star",name:"star rating",onChange:u=>{i(l),e(l)},required:!0}),b.jsx("label",{className:b1.hideElement,id:"starInvisibleLabel"+String(l),htmlFor:"starInput"+String(l),children:a("star_rating_input_label",{count:l})}),b.jsx("label",{className:b1.starIcon,id:"starIcon"+String(l),htmlFor:"starInput"+String(l),children:l<=(s||r)?b.jsx(Kst,{}):b.jsx(qst,{})})]},l)))})}const zst=({client:t,isPasswordlessUser:e,confineToRoom:n,endedCallId:r,leaveError:i,reconnect:s})=>{const{t:o}=ht(),a=gc(),{displayName:c}=tS(t),[l,u]=y.useState(!1),[d,f]=y.useState(0),[p,m]=y.useState(!1),[v,S]=y.useState(!1),_=y.useCallback(I=>{I.preventDefault();const O=new FormData(I.target).get("feedbackText");zt.instance.eventQualitySurvey.track(r,O,d),m(!0),setTimeout(()=>{S(!0),setTimeout(()=>{e?u(!0):n||a.push("/")},1e3)},1e3)},[r,a,e,n,d]),w=e&&b.jsxs("div",{className:ho.callEndedContent,children:[b.jsxs(ps,{i18nKey:"call_ended_view.create_account_prompt",children:[b.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),b.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),b.jsx(EN,{className:ho.callEndedButton,to:"/register",children:o("call_ended_view.create_account_button")})]}),T=b.jsxs("div",{className:ho.callEndedContent,children:[b.jsx(ps,{i18nKey:"call_ended_view.feedback_prompt",children:b.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),b.jsxs("form",{onSubmit:_,children:[b.jsx(qt,{children:b.jsx(Gst,{starCount:5,onChange:f,required:!0})}),b.jsx(qt,{children:b.jsx(ci,{className:Gue.feedback,id:"feedbackText",name:"feedbackText",label:o("settings.feedback_tab_description_label"),placeholder:o("settings.feedback_tab_description_label"),type:"textarea"})})," ",b.jsx(qt,{children:v?b.jsx(ps,{i18nKey:"call_ended_view.feedback_done",children:b.jsx("p",{children:"Thanks for your feedback!"})}):b.jsx(tn,{type:"submit",className:ho.submitButton,"data-testid":"home_go",children:o(p?"submitting":"action.submit")})})]})]}),C=()=>i?b.jsxs(b.Fragment,{children:[b.jsxs("main",{className:ho.main,children:[b.jsx(ul,{size:"xl",weight:"semibold",className:ho.headline,children:b.jsx(ps,{i18nKey:"call_ended_view.body",children:"You were disconnected from the call"})}),b.jsxs("div",{className:ho.disconnectedButtons,children:[b.jsx(tn,{onClick:s,children:o("call_ended_view.reconnect_button")}),b.jsx("div",{className:ho.rageshakeButton,children:b.jsx(c9,{description:"***Call disconnected***"})})]})]}),!n&&b.jsx(Mn,{className:ho.footer,children:b.jsxs(Lo,{to:"/",children:[" ",o("return_home_button")," "]})})]}):b.jsxs(b.Fragment,{children:[b.jsxs("main",{className:ho.main,children:[b.jsx(ul,{size:"xl",weight:"semibold",className:ho.headline,children:l?o("call_ended_view.headline",{displayName:c}):o("call_ended_view.headline",{displayName:c})+`
`+o("call_ended_view.survey_prompt")}),(!l||n)&&zt.instance.isEnabled()?T:w]}),!n&&b.jsx(Mn,{className:ho.footer,children:b.jsxs(Lo,{to:"/",children:[" ",o("call_ended_view.not_now_button")," "]})})]});return b.jsxs(b.Fragment,{children:[b.jsxs(Af,{children:[b.jsx(Bp,{children:!n&&b.jsx(gp,{})}),b.jsx(jp,{})]}),b.jsx("div",{className:ho.container,children:C()})]})};function az(t,e,n){const r=n.find(i=>i.kind===e&&i.label===t);return r==null?void 0:r.deviceId}const Wst=(t,e)=>y.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("g",{id:"Logo Mark"},y.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),y.createElement("g",{id:"Union"},y.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),y.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),y.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),y.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),Yst=y.forwardRef(Wst),Jst=(t,e)=>y.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},y.createElement("g",{id:"Logo Type"},y.createElement("g",{id:"Vector"},y.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),y.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),y.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),y.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),y.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),y.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),y.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),y.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),y.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),y.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),y.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),Xst=y.forwardRef(Jst),cz=t=>{const e=document.activeElement;return e!==null&&e.contains(t)};function Zst(t,e,n,r){const i=y.useRef(!1);S0(window,"keydown",y.useCallback(s=>{t.current!==null&&cz(t.current)&&(s.key==="m"?(s.preventDefault(),e()):s.key=="v"?(s.preventDefault(),n()):s.key===" "&&(s.preventDefault(),i.current||(i.current=!0,r(!1))))},[t,n,e,r]),y.useMemo(()=>({capture:!0}),[])),S0(window,"keyup",y.useCallback(s=>{t.current!==null&&cz(t.current)&&s.key===" "&&(i.current=!1,r(!0))},[t,r])),S0(window,"blur",y.useCallback(()=>{i.current&&(i.current=!1,r(!0))},[r,i]))}const Qst="_tile_1s7fk_8",eot="_speaking_1s7fk_37",tot="_muteIcon_1s7fk_53",not="_volumeSlider_1s7fk_61",zT={tile:Qst,speaking:eot,muteIcon:tot,volumeSlider:not};class Ude{constructor(){this.ended=new da,this.bindImpl=AQe(this.ended),this.stateImpl=e=>e.pipe(this.bind(),Vh(),xQe(1))}bind(){return this.bindImpl}state(){return this.stateImpl}end(){this.ended.next(),this.ended.complete()}}class $de{constructor(){this.scope=new Ude}destroy(){this.scope.end()}}const L9=(t,e)=>{const n=y.useRef();n.current===void 0&&(n.current=t());const r=y.useRef(),[,i]=y.useState(0);return(r.current===void 0||e.length!==r.current.length||e.some((s,o)=>!Object.is(s,r.current[o])))&&(n.current=t(n.current)),r.current=e,[n.current,y.useCallback(s=>{typeof s=="function"?n.current=s(n.current):n.current=s,i(o=>o+1)},[i])]};function Fde(t){const[e,n]=L9(()=>{var r;return((r=t.member)==null?void 0:r.rawDisplayName)??"[👻]"},[t.member]);return y.useEffect(()=>{if(t.member){const r=()=>{n(t.member.rawDisplayName)};return t.member.on(Hs.Name,r),()=>{t.member.removeListener(Hs.Name,r)}}},[t.member,n]),e}function lz(t,e){return E9(t).pipe(Ut(()=>({participant:t,publication:t.getTrackPublication(e),source:e})),RQe("publication"))}class Bde extends $de{constructor(e,n,r,i,s,o){super(),this.id=e,this.member=n,this.participant=r,this.local=this.participant.isLocal;const a=lz(r,s).pipe(this.scope.state());this.video=lz(r,o).pipe(this.scope.state()),this.unencryptedWarning=As([a,this.video],(c,l)=>{var u,d;return i&&(((u=c.publication)==null?void 0:u.isEncrypted)===!1||((d=l.publication)==null?void 0:d.isEncrypted)===!1)}).pipe(this.scope.state())}}class jde extends Bde{constructor(e,n,r,i){super(e,n,r,i,ve.Source.Microphone,ve.Source.Camera),this.speaking=w9(this.participant,le.IsSpeakingChanged).pipe(Ut(o=>o.isSpeaking),this.scope.state()),this._cropVideo=new bf(!0),this.cropVideo=this._cropVideo;const s=E9(r).pipe(this.scope.state());this.audioEnabled=s.pipe(Ut(o=>{var a;return((a=o.microphoneTrack)==null?void 0:a.isMuted)===!1})),this.videoEnabled=s.pipe(Ut(o=>{var a;return((a=o.cameraTrack)==null?void 0:a.isMuted)===!1}))}toggleFitContain(){this._cropVideo.next(!this._cropVideo.value)}}class CI extends jde{constructor(e,n,r,i){super(e,n,r,i),this.mirror=this.video.pipe(Dr(s=>{var a;const o=(a=s.publication)==null?void 0:a.track;return o instanceof Jd?Q_(o,Ie.Restarted).pipe(Us(null),Ut(()=>UPe(o).facingMode==="user")):Ms(!1)}),this.scope.state()),this.alwaysShow=OG.value,this.setAlwaysShow=OG.setValue}}class rot extends jde{constructor(e,n,r,i){super(e,n,r,i),this._locallyMuted=new bf(!1),this.locallyMuted=this._locallyMuted,this._localVolume=new bf(1),this.localVolume=this._localVolume,As([this._locallyMuted,this._localVolume],(s,o)=>s?0:o).pipe(this.scope.bind()).subscribe(s=>{this.participant.setVolume(s)})}toggleLocallyMuted(){this._locallyMuted.next(!this._locallyMuted.value)}setLocalVolume(e){this._localVolume.next(e)}}class s2 extends Bde{constructor(e,n,r,i){super(e,n,r,i,ve.Source.ScreenShareAudio,ve.Source.ScreenShare)}}function Hde(t,[e,n]){return Math.min(n,Math.max(e,t))}function iot(t){const e=y.useRef({value:t,previous:t});return y.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var Kde=["PageUp","PageDown"],Vde=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],qde={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},fy="Slider",[DL,sot,oot]=DD(fy),[Gde,vht]=Dp(fy,[oot]),[aot,kI]=Gde(fy),zde=y.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:u,onValueChange:d=()=>{},onValueCommit:f=()=>{},inverted:p=!1,...m}=t,v=y.useRef(new Set),S=y.useRef(0),w=o==="horizontal"?cot:lot,[T=[],C]=Fb({prop:u,defaultProp:l,onChange:N=>{var j;(j=[...v.current][S.current])==null||j.focus(),d(N)}}),I=y.useRef(T);function R(N){const L=pot(T,N);U(N,L)}function O(N){U(N,S.current)}function A(){const N=I.current[S.current];T[S.current]!==N&&f(T)}function U(N,L,{commit:j}={commit:!1}){const X=yot(s),G=_ot(Math.round((N-r)/s)*s+r,X),F=Hde(G,[r,i]);C((V=[])=>{const J=fot(V,F,L);if(vot(J,c*s)){S.current=J.indexOf(F);const K=String(J)!==String(V);return K&&j&&f(J),K?J:V}else return V})}return b.jsx(aot,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:S,thumbs:v.current,values:T,orientation:o,children:b.jsx(DL.Provider,{scope:t.__scopeSlider,children:b.jsx(DL.Slot,{scope:t.__scopeSlider,children:b.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:e,onPointerDown:Je(m.onPointerDown,()=>{a||(I.current=T)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:R,onSlideMove:a?void 0:O,onSlideEnd:a?void 0:A,onHomeKeyDown:()=>!a&&U(r,0,{commit:!0}),onEndKeyDown:()=>!a&&U(i,T.length-1,{commit:!0}),onStepKeyDown:({event:N,direction:L})=>{if(!a){const G=Kde.includes(N.key)||N.shiftKey&&Vde.includes(N.key)?10:1,F=S.current,V=T[F],J=s*G*L;U(V+J,F,{commit:!0})}}})})})})});zde.displayName=fy;var[Wde,Yde]=Gde(fy,{startEdge:"left",endEdge:"right",size:"width",direction:1}),cot=y.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...u}=t,[d,f]=y.useState(null),p=cn(e,T=>f(T)),m=y.useRef(),v=ND(i),S=v==="ltr",_=S&&!s||!S&&s;function w(T){const C=m.current||d.getBoundingClientRect(),I=[0,C.width],O=D9(I,_?[n,r]:[r,n]);return m.current=C,O(T-C.left)}return b.jsx(Wde,{scope:t.__scopeSlider,startEdge:_?"left":"right",endEdge:_?"right":"left",direction:_?1:-1,size:"width",children:b.jsx(Jde,{dir:v,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:T=>{const C=w(T.clientX);o==null||o(C)},onSlideMove:T=>{const C=w(T.clientX);a==null||a(C)},onSlideEnd:()=>{m.current=void 0,c==null||c()},onStepKeyDown:T=>{const I=qde[_?"from-left":"from-right"].includes(T.key);l==null||l({event:T,direction:I?-1:1})}})})}),lot=y.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=t,u=y.useRef(null),d=cn(e,u),f=y.useRef(),p=!i;function m(v){const S=f.current||u.current.getBoundingClientRect(),_=[0,S.height],T=D9(_,p?[r,n]:[n,r]);return f.current=S,T(v-S.top)}return b.jsx(Wde,{scope:t.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:b.jsx(Jde,{"data-orientation":"vertical",...l,ref:d,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const S=m(v.clientY);s==null||s(S)},onSlideMove:v=>{const S=m(v.clientY);o==null||o(S)},onSlideEnd:()=>{f.current=void 0,a==null||a()},onStepKeyDown:v=>{const _=qde[p?"from-bottom":"from-top"].includes(v.key);c==null||c({event:v,direction:_?-1:1})}})})}),Jde=y.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=t,u=kI(fy,n);return b.jsx(wt.span,{...l,ref:e,onKeyDown:Je(t.onKeyDown,d=>{d.key==="Home"?(o(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):Kde.concat(Vde).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:Je(t.onPointerDown,d=>{const f=d.target;f.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(f)?f.focus():r(d)}),onPointerMove:Je(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:Je(t.onPointerUp,d=>{const f=d.target;f.hasPointerCapture(d.pointerId)&&(f.releasePointerCapture(d.pointerId),s(d))})})}),Xde="SliderTrack",Zde=y.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=kI(Xde,n);return b.jsx(wt.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});Zde.displayName=Xde;var NL="SliderRange",Qde=y.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=kI(NL,n),s=Yde(NL,n),o=y.useRef(null),a=cn(e,o),c=i.values.length,l=i.values.map(f=>tfe(f,i.min,i.max)),u=c>1?Math.min(...l):0,d=100-Math.max(...l);return b.jsx(wt.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}})});Qde.displayName=NL;var UL="SliderThumb",efe=y.forwardRef((t,e)=>{const n=sot(t.__scopeSlider),[r,i]=y.useState(null),s=cn(e,a=>i(a)),o=y.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return b.jsx(uot,{...t,ref:s,index:o})}),uot=y.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...s}=t,o=kI(UL,n),a=Yde(UL,n),[c,l]=y.useState(null),u=cn(e,w=>l(w)),d=c?!!c.closest("form"):!0,f=Kre(c),p=o.values[r],m=p===void 0?0:tfe(p,o.min,o.max),v=hot(r,o.values.length),S=f==null?void 0:f[a.size],_=S?got(S,m,a.direction):0;return y.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),b.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${m}% + ${_}px)`},children:[b.jsx(DL.ItemSlot,{scope:t.__scopeSlider,children:b.jsx(wt.span,{role:"slider","aria-label":t["aria-label"]||v,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:u,style:p===void 0?{display:"none"}:t.style,onFocus:Je(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),d&&b.jsx(dot,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),value:p},r)]})});efe.displayName=UL;var dot=t=>{const{value:e,...n}=t,r=y.useRef(null),i=iot(e);return y.useEffect(()=>{const s=r.current,o=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(o,"value").set;if(i!==e&&c){const l=new Event("input",{bubbles:!0});c.call(s,e),s.dispatchEvent(l)}},[i,e]),b.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:e})};function fot(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,s)=>i-s)}function tfe(t,e,n){const s=100/(n-e)*(t-e);return Hde(s,[0,100])}function hot(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function pot(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function got(t,e,n){const r=t/2,s=D9([0,50],[0,r]);return(r-s(e)*n)*n}function mot(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function vot(t,e){if(e>0){const n=mot(t);return Math.min(...n)>=e}return!0}function D9(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function yot(t){return(String(t).split(".")[1]||"").length}function _ot(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var bot=zde,Sot=Zde,wot=Qde,Eot=efe;const Tot="_slider_vwpu0_8",Cot="_track_vwpu0_14",kot="_highlight_vwpu0_31",Rot="_handle_vwpu0_43",TE={slider:Tot,track:Cot,highlight:kot,handle:Rot},Iot=({className:t,label:e,value:n,onValueChange:r,min:i,max:s,step:o,disabled:a})=>{const c=y.useCallback(([l])=>r(l),[r]);return b.jsxs(bot,{className:Pe(t,TE.slider),value:[n],onValueChange:c,min:i,max:s,step:o,disabled:a,children:[b.jsx(Sot,{className:TE.track,children:b.jsx(wot,{className:TE.highlight})}),b.jsx(Eot,{className:TE.handle,"aria-label":e})]})};var N9=cS(),vt=t=>aS(t,N9),U9=cS();vt.write=t=>aS(t,U9);var RI=cS();vt.onStart=t=>aS(t,RI);var $9=cS();vt.onFrame=t=>aS(t,$9);var F9=cS();vt.onFinish=t=>aS(t,F9);var Wm=[];vt.setTimeout=(t,e)=>{const n=vt.now()+e,r=()=>{const s=Wm.findIndex(o=>o.cancel==r);~s&&Wm.splice(s,1),$d-=~s?1:0},i={time:n,handler:t,cancel:r};return Wm.splice(nfe(n),0,i),$d+=1,rfe(),i};var nfe=t=>~(~Wm.findIndex(e=>e.time>t)||~Wm.length);vt.cancel=t=>{RI.delete(t),$9.delete(t),F9.delete(t),N9.delete(t),U9.delete(t)};vt.sync=t=>{$L=!0,vt.batchedUpdates(t),$L=!1};vt.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function r(...i){e=i,vt.onStart(n)}return r.handler=t,r.cancel=()=>{RI.delete(n),e=null},r};var B9=typeof window<"u"?window.requestAnimationFrame:()=>{};vt.use=t=>B9=t;vt.now=typeof performance<"u"?()=>performance.now():Date.now;vt.batchedUpdates=t=>t();vt.catch=console.error;vt.frameLoop="always";vt.advance=()=>{vt.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):sfe()};var Ud=-1,$d=0,$L=!1;function aS(t,e){$L?(e.delete(t),t(0)):(e.add(t),rfe())}function rfe(){Ud<0&&(Ud=0,vt.frameLoop!=="demand"&&B9(ife))}function xot(){Ud=-1}function ife(){~Ud&&(B9(ife),vt.batchedUpdates(sfe))}function sfe(){const t=Ud;Ud=vt.now();const e=nfe(Ud);if(e&&(ofe(Wm.splice(0,e),n=>n.handler()),$d-=e),!$d){xot();return}RI.flush(),N9.flush(t?Math.min(64,Ud-t):16.667),$9.flush(),U9.flush(),F9.flush()}function cS(){let t=new Set,e=t;return{add(n){$d+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return $d-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,$d-=e.size,ofe(e,r=>r(n)&&t.add(r)),$d+=t.size,e=t)}}}function ofe(t,e){t.forEach(n=>{try{e(n)}catch(r){vt.catch(r)}})}var Pot=Object.defineProperty,Oot=(t,e)=>{for(var n in e)Pot(t,n,{get:e[n],enumerable:!0})},pc={};Oot(pc,{assign:()=>Aot,colors:()=>sf,createStringInterpolator:()=>H9,skipAnimation:()=>cfe,to:()=>afe,willAdvance:()=>K9});function FL(){}var Mot=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),ke={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function zl(t,e){if(ke.arr(t)){if(!ke.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var St=(t,e)=>t.forEach(e);function hl(t,e,n){if(ke.arr(t)){for(let r=0;r<t.length;r++)e.call(n,t[r],`${r}`);return}for(const r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r)}var ms=t=>ke.und(t)?[]:ke.arr(t)?t:[t];function D0(t,e){if(t.size){const n=Array.from(t);t.clear(),St(n,e)}}var q1=(t,...e)=>D0(t,n=>n(...e)),j9=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),H9,afe,sf=null,cfe=!1,K9=FL,Aot=t=>{t.to&&(afe=t.to),t.now&&(vt.now=t.now),t.colors!==void 0&&(sf=t.colors),t.skipAnimation!=null&&(cfe=t.skipAnimation),t.createStringInterpolator&&(H9=t.createStringInterpolator),t.requestAnimationFrame&&vt.use(t.requestAnimationFrame),t.batchedUpdates&&(vt.batchedUpdates=t.batchedUpdates),t.willAdvance&&(K9=t.willAdvance),t.frameLoop&&(vt.frameLoop=t.frameLoop)},N0=new Set,fa=[],t6=[],o2=0,II={get idle(){return!N0.size&&!fa.length},start(t){o2>t.priority?(N0.add(t),vt.onStart(Lot)):(lfe(t),vt(BL))},advance:BL,sort(t){if(o2)vt.onFrame(()=>II.sort(t));else{const e=fa.indexOf(t);~e&&(fa.splice(e,1),ufe(t))}},clear(){fa=[],N0.clear()}};function Lot(){N0.forEach(lfe),N0.clear(),vt(BL)}function lfe(t){fa.includes(t)||ufe(t)}function ufe(t){fa.splice(Dot(fa,e=>e.priority>t.priority),0,t)}function BL(t){const e=t6;for(let n=0;n<fa.length;n++){const r=fa[n];o2=r.priority,r.idle||(K9(r),r.advance(t),r.idle||e.push(r))}return o2=0,t6=fa,t6.length=0,fa=e,fa.length>0}function Dot(t,e){const n=t.findIndex(e);return n<0?t.length:n}var Not=(t,e,n)=>Math.min(Math.max(n,t),e),Uot={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},oc="[-+]?\\d*\\.?\\d+",a2=oc+"%";function xI(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var $ot=new RegExp("rgb"+xI(oc,oc,oc)),Fot=new RegExp("rgba"+xI(oc,oc,oc,oc)),Bot=new RegExp("hsl"+xI(oc,a2,a2)),jot=new RegExp("hsla"+xI(oc,a2,a2,oc)),Hot=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Kot=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Vot=/^#([0-9a-fA-F]{6})$/,qot=/^#([0-9a-fA-F]{8})$/;function Got(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=Vot.exec(t))?parseInt(e[1]+"ff",16)>>>0:sf&&sf[t]!==void 0?sf[t]:(e=$ot.exec(t))?(kg(e[1])<<24|kg(e[2])<<16|kg(e[3])<<8|255)>>>0:(e=Fot.exec(t))?(kg(e[1])<<24|kg(e[2])<<16|kg(e[3])<<8|fz(e[4]))>>>0:(e=Hot.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=qot.exec(t))?parseInt(e[1],16)>>>0:(e=Kot.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=Bot.exec(t))?(uz(dz(e[1]),CE(e[2]),CE(e[3]))|255)>>>0:(e=jot.exec(t))?(uz(dz(e[1]),CE(e[2]),CE(e[3]))|fz(e[4]))>>>0:null}function n6(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function uz(t,e,n){const r=n<.5?n*(1+e):n+e-n*e,i=2*n-r,s=n6(i,r,t+1/3),o=n6(i,r,t),a=n6(i,r,t-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function kg(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function dz(t){return(parseFloat(t)%360+360)%360/360}function fz(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function CE(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function hz(t){let e=Got(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${n}, ${r}, ${i}, ${s})`}var eb=(t,e,n)=>{if(ke.fun(t))return t;if(ke.arr(t))return eb({range:t,output:e,extrapolate:n});if(ke.str(t.output[0]))return H9(t);const r=t,i=r.output,s=r.range||[0,1],o=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",c=r.easing||(l=>l);return l=>{const u=Wot(l,s);return zot(l,s[u],s[u+1],i[u],i[u+1],c,o,a,r.map)}};function zot(t,e,n,r,i,s,o,a,c){let l=c?c(t):t;if(l<e){if(o==="identity")return l;o==="clamp"&&(l=e)}if(l>n){if(a==="identity")return l;a==="clamp"&&(l=n)}return r===i?r:e===n?t<=e?r:i:(e===-1/0?l=-l:n===1/0?l=l-e:l=(l-e)/(n-e),l=s(l),r===-1/0?l=-l:i===1/0?l=l+r:l=l*(i-r)+r,l)}function Wot(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var Yot=(t,e="end")=>n=>{n=e==="end"?Math.min(n,.999):Math.max(n,.001);const r=n*t,i=e==="end"?Math.floor(r):Math.ceil(r);return Not(0,1,i/t)},c2=1.70158,kE=c2*1.525,pz=c2+1,gz=2*Math.PI/3,mz=2*Math.PI/4.5,RE=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,Jot={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>pz*t*t*t-c2*t*t,easeOutBack:t=>1+pz*Math.pow(t-1,3)+c2*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((kE+1)*2*t-kE)/2:(Math.pow(2*t-2,2)*((kE+1)*(t*2-2)+kE)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*gz),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*gz)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*mz))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*mz)/2+1,easeInBounce:t=>1-RE(1-t),easeOutBounce:RE,easeInOutBounce:t=>t<.5?(1-RE(1-2*t))/2:(1+RE(2*t-1))/2,steps:Yot},tb=Symbol.for("FluidValue.get"),Iv=Symbol.for("FluidValue.observers"),aa=t=>!!(t&&t[tb]),$s=t=>t&&t[tb]?t[tb]():t,vz=t=>t[Iv]||null;function Xot(t,e){t.eventObserved?t.eventObserved(e):t(e)}function nb(t,e){const n=t[Iv];n&&n.forEach(r=>{Xot(r,e)})}var dfe=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");Zot(this,t)}},Zot=(t,e)=>ffe(t,tb,e);function hy(t,e){if(t[tb]){let n=t[Iv];n||ffe(t,Iv,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function rb(t,e){const n=t[Iv];if(n&&n.has(e)){const r=n.size-1;r?n.delete(e):t[Iv]=null,t.observerRemoved&&t.observerRemoved(r,e)}}var ffe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),WT=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Qot=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,yz=new RegExp(`(${WT.source})(%|[a-z]+)`,"i"),eat=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,PI=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,hfe=t=>{const[e,n]=tat(t);if(!e||j9())return t;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&PI.test(n))return hfe(n);if(n)return n}return t},tat=t=>{const e=PI.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]},r6,nat=(t,e,n,r,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,pfe=t=>{r6||(r6=sf?new RegExp(`(${Object.keys(sf).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(s=>$s(s).replace(PI,hfe).replace(Qot,hz).replace(r6,hz)),n=e.map(s=>s.match(WT).map(Number)),i=n[0].map((s,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>eb({...t,output:s}));return s=>{var c;const o=!yz.test(e[0])&&((c=e.find(l=>yz.test(l)))==null?void 0:c.replace(WT,""));let a=0;return e[0].replace(WT,()=>`${i[a++](s)}${o||""}`).replace(eat,nat)}},V9="react-spring: ",gfe=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${V9}once requires a function parameter`);return(...r)=>{n||(e(...r),n=!0)}},rat=gfe(console.warn);function iat(){rat(`${V9}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var sat=gfe(console.warn);function oat(){sat(`${V9}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function OI(t){return ke.str(t)&&(t[0]=="#"||/\d/.test(t)||!j9()&&PI.test(t)||t in(sf||{}))}var cm=j9()?y.useEffect:y.useLayoutEffect,aat=()=>{const t=y.useRef(!1);return cm(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function mfe(){const t=y.useState()[1],e=aat();return()=>{e.current&&t(Math.random())}}function cat(t,e){const[n]=y.useState(()=>({inputs:e,result:t()})),r=y.useRef(),i=r.current;let s=i;return s?e&&s.inputs&&lat(e,s.inputs)||(s={inputs:e,result:t()}):s=n,y.useEffect(()=>{r.current=s,i==n&&(n.inputs=n.result=void 0)},[s]),s.result}function lat(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}var vfe=t=>y.useEffect(t,uat),uat=[];function dat(t){const e=y.useRef();return y.useEffect(()=>{e.current=t}),e.current}var ib=Symbol.for("Animated:node"),fat=t=>!!t&&t[ib]===t,Bc=t=>t&&t[ib],q9=(t,e)=>Mot(t,ib,e),MI=t=>t&&t[ib]&&t[ib].getPayload(),yfe=class{constructor(){q9(this,this)}getPayload(){return this.payload||[]}},lS=class extends yfe{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,ke.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new lS(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return ke.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,ke.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},sb=class extends lS{constructor(t){super(0),this._string=null,this._toString=eb({output:[t,t]})}static create(t){return new sb(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(ke.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=eb({output:[this.getValue(),t]})),this._value=0,super.reset()}},l2={dependencies:null},AI=class extends yfe{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return hl(this.source,(n,r)=>{fat(n)?e[r]=n.getValue(t):aa(n)?e[r]=$s(n):t||(e[r]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&St(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return hl(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){l2.dependencies&&aa(t)&&l2.dependencies.add(t);const e=MI(t);e&&St(e,n=>this.add(n))}},_fe=class extends AI{constructor(t){super(t)}static create(t){return new _fe(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((n,r)=>n.setValue(t[r])).some(Boolean):(super.setValue(t.map(hat)),!0)}};function hat(t){return(OI(t)?sb:lS).create(t)}function jL(t){const e=Bc(t);return e?e.constructor:ke.arr(t)?_fe:OI(t)?sb:lS}var _z=(t,e)=>{const n=!ke.fun(t)||t.prototype&&t.prototype.isReactComponent;return y.forwardRef((r,i)=>{const s=y.useRef(null),o=n&&y.useCallback(m=>{s.current=mat(i,m)},[i]),[a,c]=gat(r,e),l=mfe(),u=()=>{const m=s.current;if(n&&!m)return;(m?e.applyAnimatedValues(m,a.getValue(!0)):!1)===!1&&l()},d=new pat(u,c),f=y.useRef();cm(()=>(f.current=d,St(c,m=>hy(m,d)),()=>{f.current&&(St(f.current.deps,m=>rb(m,f.current)),vt.cancel(f.current.update))})),y.useEffect(u,[]),vfe(()=>()=>{const m=f.current;St(m.deps,v=>rb(v,m))});const p=e.getComponentProps(a.getValue());return y.createElement(t,{...p,ref:o})})},pat=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&vt.write(this.update)}};function gat(t,e){const n=new Set;return l2.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new AI(t),l2.dependencies=null,[t,n]}function mat(t,e){return t&&(ke.fun(t)?t(e):t.current=e),e}var bz=Symbol.for("AnimatedComponent"),vat=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new AI(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:r},s=o=>{const a=Sz(o)||"Anonymous";return ke.str(o)?o=s[o]||(s[o]=_z(o,i)):o=o[bz]||(o[bz]=_z(o,i)),o.displayName=`Animated(${a})`,o};return hl(t,(o,a)=>{ke.arr(t)&&(a=Sz(o)),s[a]=s(o)}),{animated:s}},Sz=t=>ke.str(t)?t:t&&ke.str(t.displayName)?t.displayName:ke.fun(t)&&t.name||null;function Fs(t,...e){return ke.fun(t)?t(...e):t}var U0=(t,e)=>t===!0||!!(e&&t&&(ke.fun(t)?t(e):ms(t).includes(e))),bfe=(t,e)=>ke.obj(t)?e&&t[e]:t,Sfe=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,yat=t=>t,G9=(t,e=yat)=>{let n=_at;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const r={};for(const i of n){const s=e(t[i],i);ke.und(s)||(r[i]=s)}return r},_at=["config","onProps","onStart","onChange","onPause","onResume","onRest"],bat={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Sat(t){const e={};let n=0;if(hl(t,(r,i)=>{bat[i]||(e[i]=r,n++)}),n)return e}function z9(t){const e=Sat(t);if(e){const n={to:e};return hl(t,(r,i)=>i in e||(n[i]=r)),n}return{...t}}function ob(t){return t=$s(t),ke.arr(t)?t.map(ob):OI(t)?pc.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function wat(t){for(const e in t)return!0;return!1}function HL(t){return ke.fun(t)||ke.arr(t)&&ke.obj(t[0])}function wz(t,e){var n;(n=t.ref)==null||n.delete(t),e==null||e.delete(t)}function Eat(t,e){var n;e&&t.ref!==e&&((n=t.ref)==null||n.delete(t),e.add(t),t.ref=e)}var Tat={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},KL={...Tat.default,mass:1,damping:1,easing:Jot.linear,clamp:!1},Cat=class{constructor(){this.velocity=0,Object.assign(this,KL)}};function kat(t,e,n){n&&(n={...n},Ez(n,e),e={...n,...e}),Ez(t,e),Object.assign(t,e);for(const o in KL)t[o]==null&&(t[o]=KL[o]);let{frequency:r,damping:i}=t;const{mass:s}=t;return ke.und(r)||(r<.01&&(r=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/r,2)*s,t.friction=4*Math.PI*i*s/r),t}function Ez(t,e){if(!ke.und(e.decay))t.duration=void 0;else{const n=!ke.und(e.tension)||!ke.und(e.friction);(n||!ke.und(e.frequency)||!ke.und(e.damping)||!ke.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var Tz=[],Rat=class{constructor(){this.changed=!1,this.values=Tz,this.toValues=null,this.fromValues=Tz,this.config=new Cat,this.immediate=!1}};function wfe(t,{key:e,props:n,defaultProps:r,state:i,actions:s}){return new Promise((o,a)=>{let c,l,u=U0(n.cancel??(r==null?void 0:r.cancel),e);if(u)p();else{ke.und(n.pause)||(i.paused=U0(n.pause,e));let m=r==null?void 0:r.pause;m!==!0&&(m=i.paused||U0(m,e)),c=Fs(n.delay||0,e),m?(i.resumeQueue.add(f),s.pause()):(s.resume(),f())}function d(){i.resumeQueue.add(f),i.timeouts.delete(l),l.cancel(),c=l.time-vt.now()}function f(){c>0&&!pc.skipAnimation?(i.delayed=!0,l=vt.setTimeout(p,c),i.pauseQueue.add(d),i.timeouts.add(l)):p()}function p(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(d),i.timeouts.delete(l),t<=(i.cancelId||0)&&(u=!0);try{s.start({...n,callId:t,cancel:u},o)}catch(m){a(m)}}})}var W9=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?Ym(t.get()):e.every(n=>n.noop)?Efe(t.get()):ec(t.get(),e.every(n=>n.finished)),Efe=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),ec=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Ym=t=>({value:t,cancelled:!0,finished:!1});function Tfe(t,e,n,r){const{callId:i,parentId:s,onRest:o}=e,{asyncTo:a,promise:c}=n;return!s&&t===a&&!e.reset?c:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const l=G9(e,(S,_)=>_==="onRest"?void 0:S);let u,d;const f=new Promise((S,_)=>(u=S,d=_)),p=S=>{const _=i<=(n.cancelId||0)&&Ym(r)||i!==n.asyncId&&ec(r,!1);if(_)throw S.result=_,d(S),S},m=(S,_)=>{const w=new Cz,T=new kz;return(async()=>{if(pc.skipAnimation)throw ab(n),T.result=ec(r,!1),d(T),T;p(w);const C=ke.obj(S)?{...S}:{..._,to:S};C.parentId=i,hl(l,(R,O)=>{ke.und(C[O])&&(C[O]=R)});const I=await r.start(C);return p(w),n.paused&&await new Promise(R=>{n.resumeQueue.add(R)}),I})()};let v;if(pc.skipAnimation)return ab(n),ec(r,!1);try{let S;ke.arr(t)?S=(async _=>{for(const w of _)await m(w)})(t):S=Promise.resolve(t(m,r.stop.bind(r))),await Promise.all([S.then(u),f]),v=ec(r.get(),!0,!1)}catch(S){if(S instanceof Cz)v=S.result;else if(S instanceof kz)v=S.result;else throw S}finally{i==n.asyncId&&(n.asyncId=s,n.asyncTo=s?a:void 0,n.promise=s?c:void 0)}return ke.fun(o)&&vt.batchedUpdates(()=>{o(v,r,r.item)}),v})()}function ab(t,e){D0(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var Cz=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},kz=class extends Error{constructor(){super("SkipAnimationSignal")}},VL=t=>t instanceof Y9,Iat=1,Y9=class extends dfe{constructor(){super(...arguments),this.id=Iat++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Bc(this);return t&&t.getValue()}to(...t){return pc.to(this,t)}interpolate(...t){return iat(),pc.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){nb(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||II.sort(this),nb(this,{type:"priority",parent:this,priority:t})}},Ep=Symbol.for("SpringPhase"),Cfe=1,qL=2,GL=4,i6=t=>(t[Ep]&Cfe)>0,od=t=>(t[Ep]&qL)>0,S1=t=>(t[Ep]&GL)>0,Rz=(t,e)=>e?t[Ep]|=qL|Cfe:t[Ep]&=~qL,Iz=(t,e)=>e?t[Ep]|=GL:t[Ep]&=~GL,xat=class extends Y9{constructor(t,e){if(super(),this.animation=new Rat,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!ke.und(t)||!ke.und(e)){const n=ke.obj(t)?{...t}:{...e,from:t};ke.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(od(this)||this._state.asyncTo)||S1(this)}get goal(){return $s(this.animation.to)}get velocity(){const t=Bc(this);return t instanceof lS?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return i6(this)}get isAnimating(){return od(this)}get isPaused(){return S1(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,o=MI(r.to);!o&&aa(r.to)&&(i=ms($s(r.to))),r.values.forEach((l,u)=>{if(l.done)return;const d=l.constructor==sb?1:o?o[u].lastPosition:i[u];let f=r.immediate,p=d;if(!f){if(p=l.lastPosition,s.tension<=0){l.done=!0;return}let m=l.elapsedTime+=t;const v=r.fromValues[u],S=l.v0!=null?l.v0:l.v0=ke.arr(s.velocity)?s.velocity[u]:s.velocity;let _;const w=s.precision||(v==d?.005:Math.min(1,Math.abs(d-v)*.001));if(ke.und(s.duration))if(s.decay){const T=s.decay===!0?.998:s.decay,C=Math.exp(-(1-T)*m);p=v+S/(1-T)*(1-C),f=Math.abs(l.lastPosition-p)<=w,_=S*C}else{_=l.lastVelocity==null?S:l.lastVelocity;const T=s.restVelocity||w/10,C=s.clamp?0:s.bounce,I=!ke.und(C),R=v==d?l.v0>0:v<d;let O,A=!1;const U=1,N=Math.ceil(t/U);for(let L=0;L<N&&(O=Math.abs(_)>T,!(!O&&(f=Math.abs(d-p)<=w,f)));++L){I&&(A=p==d||p>d==R,A&&(_=-_*C,p=d));const j=-s.tension*1e-6*(p-d),X=-s.friction*.001*_,G=(j+X)/s.mass;_=_+G*U,p=p+_*U}}else{let T=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,l.durationProgress>0&&(l.elapsedTime=s.duration*l.durationProgress,m=l.elapsedTime+=t)),T=(s.progress||0)+m/this._memoizedDuration,T=T>1?1:T<0?0:T,l.durationProgress=T),p=v+s.easing(T)*(d-v),_=(p-l.lastPosition)/t,f=T==1}l.lastVelocity=_,Number.isNaN(p)&&(console.warn("Got NaN while animating:",this),f=!0)}o&&!o[u].done&&(f=!1),f?l.done=!0:e=!1,l.setValue(p,s.round)&&(n=!0)});const a=Bc(this),c=a.getValue();if(e){const l=$s(r.to);(c!==l||n)&&!s.decay?(a.setValue(l),this._onChange(l)):n&&s.decay&&this._onChange(c),this._stop()}else n&&this._onChange(c)}set(t){return vt.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(od(this)){const{to:t,config:e}=this.animation;vt.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return ke.und(t)?(n=this.queue||[],this.queue=[]):n=[ke.obj(t)?t:{...e,to:t}],Promise.all(n.map(r=>this._update(r))).then(r=>W9(this,r))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),ab(this._state,t&&this._lastCallId),vt.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:r}=t;n=ke.obj(n)?n[e]:n,(n==null||HL(n))&&(n=void 0),r=ke.obj(r)?r[e]:r,r==null&&(r=void 0);const i={to:n,from:r};return i6(this)||(t.reverse&&([n,r]=[r,n]),r=$s(r),ke.und(r)?Bc(this)||this._set(n):this._set(r)),i}_update({...t},e){const{key:n,defaultProps:r}=this;t.default&&Object.assign(r,G9(t,(o,a)=>/^on/.test(a)?bfe(o,n):o)),Pz(this,t,"onProps"),E1(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return wfe(++this._lastCallId,{key:n,props:t,defaultProps:r,state:s,actions:{pause:()=>{S1(this)||(Iz(this,!0),q1(s.pauseQueue),E1(this,"onPause",ec(this,w1(this,this.animation.to)),this))},resume:()=>{S1(this)&&(Iz(this,!1),od(this)&&this._resume(),q1(s.resumeQueue),E1(this,"onResume",ec(this,w1(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=kfe(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Ym(this));const r=!ke.und(t.to),i=!ke.und(t.from);if(r||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(Ym(this));const{key:s,defaultProps:o,animation:a}=this,{to:c,from:l}=a;let{to:u=c,from:d=l}=t;i&&!r&&(!e.default||ke.und(u))&&(u=d),e.reverse&&([u,d]=[d,u]);const f=!zl(d,l);f&&(a.from=d),d=$s(d);const p=!zl(u,c);p&&this._focus(u);const m=HL(e.to),{config:v}=a,{decay:S,velocity:_}=v;(r||i)&&(v.velocity=0),e.config&&!m&&kat(v,Fs(e.config,s),e.config!==o.config?Fs(o.config,s):void 0);let w=Bc(this);if(!w||ke.und(u))return n(ec(this,!0));const T=ke.und(e.reset)?i&&!e.default:!ke.und(d)&&U0(e.reset,s),C=T?d:this.get(),I=ob(u),R=ke.num(I)||ke.arr(I)||OI(I),O=!m&&(!R||U0(o.immediate||e.immediate,s));if(p){const L=jL(u);if(L!==w.constructor)if(O)w=this._set(I);else throw Error(`Cannot animate between ${w.constructor.name} and ${L.name}, as the "to" prop suggests`)}const A=w.constructor;let U=aa(u),N=!1;if(!U){const L=T||!i6(this)&&f;(p||L)&&(N=zl(ob(C),I),U=!N),(!zl(a.immediate,O)&&!O||!zl(v.decay,S)||!zl(v.velocity,_))&&(U=!0)}if(N&&od(this)&&(a.changed&&!T?U=!0:U||this._stop(c)),!m&&((U||aa(c))&&(a.values=w.getPayload(),a.toValues=aa(u)?null:A==sb?[1]:ms(I)),a.immediate!=O&&(a.immediate=O,!O&&!T&&this._set(c)),U)){const{onRest:L}=a;St(Pat,X=>Pz(this,e,X));const j=ec(this,w1(this,c));q1(this._pendingCalls,j),this._pendingCalls.add(n),a.changed&&vt.batchedUpdates(()=>{var X;a.changed=!T,L==null||L(j,this),T?Fs(o.onRest,j):(X=a.onStart)==null||X.call(a,j,this)})}T&&this._set(C),m?n(Tfe(e.to,e,this._state,this)):U?this._start():od(this)&&!p?this._pendingCalls.add(n):n(Efe(C))}_focus(t){const e=this.animation;t!==e.to&&(vz(this)&&this._detach(),e.to=t,vz(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;aa(e)&&(hy(e,this),VL(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;aa(t)&&rb(t,this)}_set(t,e=!0){const n=$s(t);if(!ke.und(n)){const r=Bc(this);if(!r||!zl(n,r.getValue())){const i=jL(n);!r||r.constructor!=i?q9(this,i.create(n)):r.setValue(n),r&&vt.batchedUpdates(()=>{this._onChange(n,e)})}}return Bc(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,E1(this,"onStart",ec(this,w1(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),Fs(this.animation.onChange,t,this)),Fs(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Bc(this).reset($s(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),od(this)||(Rz(this,!0),S1(this)||this._resume())}_resume(){pc.skipAnimation?this.finish():II.start(this)}_stop(t,e){if(od(this)){Rz(this,!1);const n=this.animation;St(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),nb(this,{type:"idle",parent:this});const r=e?Ym(this.get()):ec(this.get(),w1(this,t??n.to));q1(this._pendingCalls,r),n.changed&&(n.changed=!1,E1(this,"onRest",r,this))}}};function w1(t,e){const n=ob(e),r=ob(t.get());return zl(r,n)}function kfe(t,e=t.loop,n=t.to){const r=Fs(e);if(r){const i=r!==!0&&z9(r),s=(i||t).reverse,o=!i||i.reset;return u2({...t,loop:e,default:!1,pause:void 0,to:!s||HL(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function u2(t){const{to:e,from:n}=t=z9(t),r=new Set;return ke.obj(e)&&xz(e,r),ke.obj(n)&&xz(n,r),t.keys=r.size?Array.from(r):null,t}function xz(t,e){hl(t,(n,r)=>n!=null&&e.add(r))}var Pat=["onStart","onRest","onChange","onPause","onResume"];function Pz(t,e,n){t.animation[n]=e[n]!==Sfe(e,n)?bfe(e[n],t.key):void 0}function E1(t,e,...n){var r,i,s,o;(i=(r=t.animation)[e])==null||i.call(r,...n),(o=(s=t.defaultProps)[e])==null||o.call(s,...n)}var Oat=["onStart","onChange","onRest"],Mat=1,Aat=class{constructor(e,n){this.id=Mat++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((n,r)=>e[r]=n.get()),e}set(e){for(const n in e){const r=e[n];ke.und(r)||this.springs[n].set(r)}}update(e){return e&&this.queue.push(u2(e)),this}start(e){let{queue:n}=this;return e?n=ms(e).map(u2):this.queue=[],this._flush?this._flush(this,n):(Pfe(this,n),Lat(this,n))}stop(e,n){if(e!==!!e&&(n=e),n){const r=this.springs;St(ms(n),i=>r[i].stop(!!e))}else ab(this._state,this._lastAsyncId),this.each(r=>r.stop(!!e));return this}pause(e){if(ke.und(e))this.start({pause:!0});else{const n=this.springs;St(ms(e),r=>n[r].pause())}return this}resume(e){if(ke.und(e))this.start({pause:!1});else{const n=this.springs;St(ms(e),r=>n[r].resume())}return this}each(e){hl(this.springs,e)}_onFrame(){const{onStart:e,onChange:n,onRest:r}=this._events,i=this._active.size>0,s=this._changed.size>0;(i&&!this._started||s&&!this._started)&&(this._started=!0,D0(e,([c,l])=>{l.value=this.get(),c(l,this,this._item)}));const o=!i&&this._started,a=s||o&&r.size?this.get():null;s&&n.size&&D0(n,([c,l])=>{l.value=a,c(l,this,this._item)}),o&&(this._started=!1,D0(r,([c,l])=>{l.value=a,c(l,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;vt.onFrame(this._onFrame)}};function Lat(t,e){return Promise.all(e.map(n=>Rfe(t,n))).then(n=>W9(t,n))}async function Rfe(t,e,n){const{keys:r,to:i,from:s,loop:o,onRest:a,onResolve:c}=e,l=ke.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),s===!1&&(e.from=null);const u=ke.arr(i)||ke.fun(i)?i:void 0;u?(e.to=void 0,e.onRest=void 0,l&&(l.onRest=void 0)):St(Oat,v=>{const S=e[v];if(ke.fun(S)){const _=t._events[v];e[v]=({finished:w,cancelled:T})=>{const C=_.get(S);C?(w||(C.finished=!1),T&&(C.cancelled=!0)):_.set(S,{value:null,finished:w||!1,cancelled:T||!1})},l&&(l[v]=e[v])}});const d=t._state;e.pause===!d.paused?(d.paused=e.pause,q1(e.pause?d.pauseQueue:d.resumeQueue)):d.paused&&(e.pause=!0);const f=(r||Object.keys(t.springs)).map(v=>t.springs[v].start(e)),p=e.cancel===!0||Sfe(e,"cancel")===!0;(u||p&&d.asyncId)&&f.push(wfe(++t._lastAsyncId,{props:e,state:d,actions:{pause:FL,resume:FL,start(v,S){p?(ab(d,t._lastAsyncId),S(Ym(t))):(v.onRest=a,S(Tfe(u,v,d,t)))}}})),d.paused&&await new Promise(v=>{d.resumeQueue.add(v)});const m=W9(t,await Promise.all(f));if(o&&m.finished&&!(n&&m.noop)){const v=kfe(e,o,i);if(v)return Pfe(t,[v]),Rfe(t,v,!0)}return c&&vt.batchedUpdates(()=>c(m,t,t.item)),m}function Dat(t,e){const n={...t.springs};return e&&St(ms(e),r=>{ke.und(r.keys)&&(r=u2(r)),ke.obj(r.to)||(r={...r,to:void 0}),xfe(n,r,i=>Ife(i))}),Nat(t,n),n}function Nat(t,e){hl(e,(n,r)=>{t.springs[r]||(t.springs[r]=n,hy(n,t))})}function Ife(t,e){const n=new xat;return n.key=t,e&&hy(n,e),n}function xfe(t,e,n){e.keys&&St(e.keys,r=>{(t[r]||(t[r]=n(r)))._prepareNode(e)})}function Pfe(t,e){St(e,n=>{xfe(t.springs,n,r=>Ife(r,t))})}var LI=({children:t,...e})=>{const n=y.useContext(d2),r=e.pause||!!n.pause,i=e.immediate||!!n.immediate;e=cat(()=>({pause:r,immediate:i}),[r,i]);const{Provider:s}=d2;return y.createElement(s,{value:e},t)},d2=Uat(LI,{});LI.Provider=d2.Provider;LI.Consumer=d2.Consumer;function Uat(t,e){return Object.assign(t,y.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var $at=()=>{const t=[],e=function(r){oat();const i=[];return St(t,(s,o)=>{if(ke.und(r))i.push(s.start());else{const a=n(r,s,o);a&&i.push(s.start(a))}}),i};e.current=t,e.add=function(r){t.includes(r)||t.push(r)},e.delete=function(r){const i=t.indexOf(r);~i&&t.splice(i,1)},e.pause=function(){return St(t,r=>r.pause(...arguments)),this},e.resume=function(){return St(t,r=>r.resume(...arguments)),this},e.set=function(r){St(t,(i,s)=>{const o=ke.fun(r)?r(s,i):r;o&&i.set(o)})},e.start=function(r){const i=[];return St(t,(s,o)=>{if(ke.und(r))i.push(s.start());else{const a=this._getProps(r,s,o);a&&i.push(s.start(a))}}),i},e.stop=function(){return St(t,r=>r.stop(...arguments)),this},e.update=function(r){return St(t,(i,s)=>i.update(this._getProps(r,i,s))),this};const n=function(r,i,s){return ke.fun(r)?r(s,i):r};return e._getProps=n,e};function Fat(t,e,n){const r=ke.fun(e)&&e,{reset:i,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:c=!1,onDestroyed:l,ref:u,config:d}=r?r():e,f=y.useMemo(()=>r||arguments.length==3?$at():void 0,[]),p=ms(t),m=[],v=y.useRef(null),S=i?null:v.current;cm(()=>{v.current=m}),vfe(()=>(St(m,G=>{f==null||f.add(G.ctrl),G.ctrl.ref=f}),()=>{St(v.current,G=>{G.expired&&clearTimeout(G.expirationId),wz(G.ctrl,f),G.ctrl.stop(!0)})}));const _=jat(p,r?r():e,S),w=i&&v.current||[];cm(()=>St(w,({ctrl:G,item:F,key:V})=>{wz(G,f),Fs(l,F,V)}));const T=[];if(S&&St(S,(G,F)=>{G.expired?(clearTimeout(G.expirationId),w.push(G)):(F=T[F]=_.indexOf(G.key),~F&&(m[F]=G))}),St(p,(G,F)=>{m[F]||(m[F]={key:_[F],item:G,phase:"mount",ctrl:new Aat},m[F].ctrl.item=G)}),T.length){let G=-1;const{leave:F}=r?r():e;St(T,(V,J)=>{const K=S[J];~V?(G=m.indexOf(K),m[G]={...K,item:p[V]}):F&&m.splice(++G,0,K)})}ke.fun(s)&&m.sort((G,F)=>s(G.item,F.item));let C=-o;const I=mfe(),R=G9(e),O=new Map,A=y.useRef(new Map),U=y.useRef(!1);St(m,(G,F)=>{const V=G.key,J=G.phase,K=r?r():e;let W,Y;const ce=Fs(K.delay||0,V);if(J=="mount")W=K.enter,Y="enter";else{const Oe=_.indexOf(V)<0;if(J!="leave")if(Oe)W=K.leave,Y="leave";else if(W=K.update)Y="update";else return;else if(!Oe)W=K.enter,Y="enter";else return}if(W=Fs(W,G.item,F),W=ke.obj(W)?z9(W):{to:W},!W.config){const Oe=d||R.config;W.config=Fs(Oe,G.item,F,Y)}C+=o;const ue={...R,delay:ce+C,ref:u,immediate:K.immediate,reset:!1,...W};if(Y=="enter"&&ke.und(ue.from)){const Oe=r?r():e,De=ke.und(Oe.initial)||S?Oe.from:Oe.initial;ue.from=Fs(De,G.item,F)}const{onResolve:Te}=ue;ue.onResolve=Oe=>{Fs(Te,Oe);const De=v.current,ze=De.find(et=>et.key===V);if(ze&&!(Oe.cancelled&&ze.phase!="update")&&ze.ctrl.idle){const et=De.every(lt=>lt.ctrl.idle);if(ze.phase=="leave"){const lt=Fs(a,ze.item);if(lt!==!1){const Ae=lt===!0?0:lt;if(ze.expired=!0,!et&&Ae>0){Ae<=2147483647&&(ze.expirationId=setTimeout(I,Ae));return}}}et&&De.some(lt=>lt.expired)&&(A.current.delete(ze),c&&(U.current=!0),I())}};const Re=Dat(G.ctrl,ue);Y==="leave"&&c?A.current.set(G,{phase:Y,springs:Re,payload:ue}):O.set(G,{phase:Y,springs:Re,payload:ue})});const N=y.useContext(LI),L=dat(N),j=N!==L&&wat(N);cm(()=>{j&&St(m,G=>{G.ctrl.start({default:N})})},[N]),St(O,(G,F)=>{if(A.current.size){const V=m.findIndex(J=>J.key===F.key);m.splice(V,1)}}),cm(()=>{St(A.current.size?A.current:O,({phase:G,payload:F},V)=>{const{ctrl:J}=V;V.phase=G,f==null||f.add(J),j&&G=="enter"&&J.start({default:N}),F&&(Eat(J,F.ref),(J.ref||f)&&!U.current?J.update(F):(J.start(F),U.current&&(U.current=!1)))})},i?void 0:n);const X=G=>y.createElement(y.Fragment,null,m.map((F,V)=>{const{springs:J}=O.get(F)||F.ctrl,K=G({...J},F.item,F,V);return K&&K.type?y.createElement(K.type,{...K.props,key:ke.str(F.key)||ke.num(F.key)?F.key:F.ctrl.id,ref:K.ref}):K}));return f?[X,f]:X}var Bat=1;function jat(t,{key:e,keys:n=e},r){if(n===null){const i=new Set;return t.map(s=>{const o=r&&r.find(a=>a.item===s&&a.phase!=="leave"&&!i.has(a));return o?(i.add(o),o.key):Bat++})}return ke.und(n)?t:ke.fun(n)?t.map(n):ms(n)}var Hat=class extends Y9{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=eb(...e);const n=this._get(),r=jL(n);q9(this,r.create(n))}advance(t){const e=this._get(),n=this.get();zl(e,n)||(Bc(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&Oz(this._active)&&s6(this)}_get(){const t=ke.arr(this.source)?this.source.map($s):ms($s(this.source));return this.calc(...t)}_start(){this.idle&&!Oz(this._active)&&(this.idle=!1,St(MI(this),t=>{t.done=!1}),pc.skipAnimation?(vt.batchedUpdates(()=>this.advance()),s6(this)):II.start(this))}_attach(){let t=1;St(ms(this.source),e=>{aa(e)&&hy(e,this),VL(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){St(ms(this.source),t=>{aa(t)&&rb(t,this)}),this._active.clear(),s6(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ms(this.source).reduce((e,n)=>Math.max(e,(VL(n)?n.priority:0)+1),0))}};function Kat(t){return t.idle!==!1}function Oz(t){return!t.size||Array.from(t).every(Kat)}function s6(t){t.idle||(t.idle=!0,St(MI(t),e=>{e.done=!0}),nb(t,{type:"idle",parent:t}))}pc.assign({createStringInterpolator:pfe,to:(t,e)=>new Hat(t,e)});var Ofe=/^--/;function Vat(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!Ofe.test(t)&&!($0.hasOwnProperty(t)&&$0[t])?e+"px":(""+e).trim()}var Mz={};function qat(t,e){if(!t.nodeType||!t.setAttribute)return!1;const n=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{style:r,children:i,scrollTop:s,scrollLeft:o,viewBox:a,...c}=e,l=Object.values(c),u=Object.keys(c).map(d=>n||t.hasAttribute(d)?d:Mz[d]||(Mz[d]=d.replace(/([A-Z])/g,f=>"-"+f.toLowerCase())));i!==void 0&&(t.textContent=i);for(const d in r)if(r.hasOwnProperty(d)){const f=Vat(d,r[d]);Ofe.test(d)?t.style.setProperty(d,f):t.style[d]=f}u.forEach((d,f)=>{t.setAttribute(d,l[f])}),s!==void 0&&(t.scrollTop=s),o!==void 0&&(t.scrollLeft=o),a!==void 0&&t.setAttribute("viewBox",a)}var $0={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gat=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),zat=["Webkit","Ms","Moz","O"];$0=Object.keys($0).reduce((t,e)=>(zat.forEach(n=>t[Gat(n,e)]=t[e]),t),$0);var Wat=/^(matrix|translate|scale|rotate|skew)/,Yat=/^(translate)/,Jat=/^(rotate|skew)/,o6=(t,e)=>ke.num(t)&&t!==0?t+e:t,YT=(t,e)=>ke.arr(t)?t.every(n=>YT(n,e)):ke.num(t)?t===e:parseFloat(t)===e,Xat=class extends AI{constructor({x:t,y:e,z:n,...r}){const i=[],s=[];(t||e||n)&&(i.push([t||0,e||0,n||0]),s.push(o=>[`translate3d(${o.map(a=>o6(a,"px")).join(",")})`,YT(o,0)])),hl(r,(o,a)=>{if(a==="transform")i.push([o||""]),s.push(c=>[c,c===""]);else if(Wat.test(a)){if(delete r[a],ke.und(o))return;const c=Yat.test(a)?"px":Jat.test(a)?"deg":"";i.push(ms(o)),s.push(a==="rotate3d"?([l,u,d,f])=>[`rotate3d(${l},${u},${d},${o6(f,c)})`,YT(f,0)]:l=>[`${a}(${l.map(u=>o6(u,c)).join(",")})`,YT(l,a.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new Zat(i,s)),super(r)}},Zat=class extends dfe{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return St(this.inputs,(n,r)=>{const i=$s(n[0]),[s,o]=this.transforms[r](ke.arr(i)?i:n.map($s));t+=" "+s,e=e&&o}),e?"none":t}observerAdded(t){t==1&&St(this.inputs,e=>St(e,n=>aa(n)&&hy(n,this)))}observerRemoved(t){t==0&&St(this.inputs,e=>St(e,n=>aa(n)&&rb(n,this)))}eventObserved(t){t.type=="change"&&(this._value=null),nb(this,t)}},Qat=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];pc.assign({batchedUpdates:Ip.unstable_batchedUpdates,createStringInterpolator:pfe,colors:Uot});var ect=vat(Qat,{applyAnimatedValues:qat,createAnimatedStyle:t=>new Xat(t),getComponentProps:({scrollTop:t,scrollLeft:e,...n})=>n}),Mfe=ect.animated;const tct="_media_ejnt2_8",nct="_mirror_ejnt2_25",rct="_videoMuted_ejnt2_37",ict="_bg_ejnt2_41",sct="_avatar_ejnt2_49",oct="_fg_ejnt2_79",act="_nameTag_ejnt2_93",cct="_name_ejnt2_93",lct="_errorIcon_ejnt2_122",Dl={media:tct,mirror:nct,videoMuted:rct,bg:ict,avatar:sct,fg:oct,nameTag:act,name:cct,errorIcon:lct},uS=y.forwardRef(({className:t,style:e,targetWidth:n,targetHeight:r,video:i,videoFit:s,mirror:o,member:a,videoEnabled:c,unencryptedWarning:l,nameTagLeadingIcon:u,displayName:d,primaryButton:f,...p},m)=>{const{t:v}=ht();return b.jsxs(Mfe.div,{className:Pe(Dl.media,t,{[Dl.mirror]:o,[Dl.videoMuted]:!c}),style:e,ref:m,"data-testid":"videoTile","data-video-fit":s,...p,children:[b.jsxs("div",{className:Dl.bg,children:[b.jsx(cy,{id:(a==null?void 0:a.userId)??d,name:d,size:Math.round(Math.min(n,r)/2),src:a==null?void 0:a.getMxcAvatarUrl(),className:Dl.avatar}),i.publication!==void 0&&b.jsx(bst,{trackRef:i,tabIndex:-1,disablePictureInPicture:!0})]}),b.jsxs("div",{className:Dl.fg,children:[b.jsxs("div",{className:Dl.nameTag,children:[u,b.jsx(Mn,{as:"span",size:"sm",weight:"medium",className:Dl.name,children:d}),l&&b.jsx(Ao,{label:v("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,children:b.jsx(CD,{width:20,height:20,className:Dl.errorIcon})})]}),f]})]})});uS.displayName="MediaView";const J9=y.forwardRef(({vm:t,showVideo:e,showSpeakingIndicators:n,menuStart:r,menuEnd:i,className:s,displayName:o,...a},c)=>{const{t:l}=ht(),u=jt(t.video),d=jt(t.unencryptedWarning),f=jt(t.audioEnabled),p=jt(t.videoEnabled),m=jt(t.speaking),v=jt(t.cropVideo),S=y.useCallback(R=>{R.preventDefault(),t.toggleFitContain()},[t]),_=f?Qoe:Joe,[w,T]=y.useState(!1),C=b.jsxs(b.Fragment,{children:[r,b.jsx(_N,{Icon:Voe,label:l("video_tile.change_fit_contain"),checked:v,onSelect:S}),i]}),I=b.jsx(uS,{ref:c,video:u,member:t.member,unencryptedWarning:d,videoEnabled:p&&e,videoFit:v?"cover":"contain",className:Pe(s,zT.tile,{[zT.speaking]:n&&m}),nameTagLeadingIcon:b.jsx(_,{width:20,height:20,"aria-label":l(f?"microphone_on":"microphone_off"),"data-muted":!f,className:zT.muteIcon}),displayName:o,primaryButton:b.jsx(yN,{open:w,onOpenChange:T,title:o,trigger:b.jsx("button",{"aria-label":l("common.options"),children:b.jsx(KBe,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:C}),...a});return b.jsx(G$e,{title:o,trigger:I,hasAccessibleAlternative:!0,children:C})});J9.displayName="UserMediaTile";const Afe=y.forwardRef(({vm:t,onOpenProfile:e,...n},r)=>{const{t:i}=ht(),s=jt(t.mirror),o=jt(t.alwaysShow),a=Rk(o),c=y.useCallback(l=>{l.preventDefault(),t.setAlwaysShow(!a.current)},[t,a]);return b.jsx(J9,{ref:r,vm:t,mirror:s,menuStart:b.jsx(_N,{Icon:doe,label:i("video_tile.always_show"),checked:o,onSelect:c}),menuEnd:b.jsx(Sv,{Icon:cae,label:i("common.profile"),onSelect:e}),...n})});Afe.displayName="LocalUserMediaTile";const Lfe=y.forwardRef(({vm:t,...e},n)=>{const{t:r}=ht(),i=jt(t.locallyMuted),s=jt(t.localVolume),o=y.useCallback(l=>{l.preventDefault(),t.toggleLocallyMuted()},[t]),a=y.useCallback(l=>t.setLocalVolume(l),[t]),c=i?ZBe:QBe;return b.jsx(J9,{ref:n,vm:t,mirror:!1,menuStart:b.jsxs(b.Fragment,{children:[b.jsx(_N,{Icon:HBe,label:r("video_tile.mute_for_me"),checked:i,onSelect:o}),b.jsx(Sv,{as:"div",Icon:c,label:null,onSelect:null,children:b.jsx(Iot,{className:zT.volumeSlider,label:r("video_tile.volume"),value:s,onValueChange:a,min:.1,max:1,step:.01,disabled:i})})]}),...e})});Lfe.displayName="RemoteUserMediaTile";const Dfe=y.forwardRef(({vm:t,onOpenProfile:e,...n},r)=>{const i=Fde(t);return t instanceof CI?b.jsx(Afe,{ref:r,vm:t,onOpenProfile:e,displayName:i,...n}):b.jsx(Lfe,{ref:r,vm:t,displayName:i,...n})});Dfe.displayName="GridTile";const uct=({rageshakeRequestId:t,roomId:e,open:n,onDismiss:r})=>{const{t:i}=ht(),{submitRageshake:s,sending:o,sent:a,error:c}=a9();return y.useEffect(()=>{a&&r()},[a,r]),b.jsxs(nS,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[b.jsx(Mn,{children:i("rageshake_request_modal.body")}),b.jsx(qt,{children:b.jsx(tn,{onClick:()=>void s({sendLogs:!0,rageshakeRequestId:t,roomId:e}),disabled:o,children:i(o?"rageshake_sending_logs":"rageshake_send_logs")})}),c&&b.jsx(qt,{children:b.jsx(Nf,{error:c})})]})};function Az(t){return new Worker("/assets/livekit-client.e2ee.worker-B8uLGUGk.js",{name:t==null?void 0:t.name})}const dct={audioPreset:tk.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[Qc.h180,Qc.h360],screenShareEncoding:mR.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:Qc.h720.encoding,backupCodec:{codec:"vp8",encoding:Qc.h720.encoding}},a6={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:Qc.h720.resolution},publishDefaults:dct,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new bee,disconnectOnPageLeave:!0,webAudioMix:!1};function fct(t){const[e,n]=y.useState(()=>{const i=t.getActiveFocus();return i&&hM(i)?i:void 0}),r=y.useCallback(()=>{const i=t.getActiveFocus();if(!(i&&!hM(i))&&!of(e,i)){const s=t.getOldestMembership();k.warn(`Got new active focus from membership: ${s==null?void 0:s.sender}/${s==null?void 0:s.deviceId}.
        Updating focus (focus switch) from ${e} to ${i}`),n(i)}},[e,t]);return y.useEffect(()=>(t.on(Su.MembershipsChanged,r),()=>{t.off(Su.MembershipsChanged,r)})),e}function hct(t,e){return t===void 0&&e===void 0?!0:t===void 0||e===void 0?!1:t.jwt===e.jwt&&t.url===e.url}function pct(t,e){const[n,r]=y.useState(void 0),i=fct(e);return y.useEffect(()=>{i?gct(t,i).then(s=>{r(s)},s=>{k.error("Failed to get SFU config",s)}):r(void 0)},[t,i]),n}async function gct(t,e){const n=await t.getOpenIdToken();k.debug("Got openID token",n);try{k.info(`Trying to get JWT from call's active focus URL of ${e.livekit_service_url}...`);const r=await mct(t,e.livekit_service_url,e.livekit_alias,n);return k.info("Got JWT from call's active focus URL."),r}catch(r){k.warn(`Failed to get JWT from RTC session's active focus URL of ${e.livekit_service_url}.`,r);return}}async function mct(t,e,n,r){try{const i=await fetch(e+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:t.getDeviceId()})});if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}catch(i){throw new Error("SFU Config fetch failed with exception "+i)}}var zL=(t=>(t.ECSwitchingFocus="ec_switching_focus",t.ECWaiting="ec_waiting",t))(zL||{});function IE(t){return!!(t!=null&&t.url)&&!!(t!=null&&t.jwt)}async function vct(t,e,n,r){if(t.localParticipant.getTrackPublication(ve.Source.Microphone)){k.warn("Pre-creating audio track but participant already appears to have an microphone track: this shouldn't happen!"),WMe("Pre-creating audio track but participant already appears to have an microphone track!");return}k.info("Pre-creating microphone track");let i;try{const s=await t.localParticipant.createTracks({audio:r});s.length<1?k.info("Tried to pre-create local audio track but got no tracks"):i=s[0],k.info("Pre-created microphone track")}catch(s){k.error("Failed to pre-create microphone track",s)}if(n||await(i==null?void 0:i.mute()),t.localParticipant.getTrackPublication(ve.Source.Microphone)){k.warn("Pre-created audio track but participant already appears to have an microphone track: this shouldn't happen!"),i==null||i.stop();return}k.info("Connecting & publishing");try{await Nfe(t,e,i,[])}catch(s){i==null||i.stop(),k.warn("Stopped precreated audio tracks.",s)}}async function Nfe(t,e,n,r){const i=zt.instance.eventCallConnectDuration;i.cacheConnectStart(),t.once(fe.SignalConnected,i.cacheWsConnect),await t.connect(e.url,e.jwt,{peerConnectionTimeout:window.peerConnectionTimeout??45e3,websocketTimeout:window.websocketTimeout??45e3}),t.off(fe.SignalConnected,i.cacheWsConnect),i.track({log:!0}),n&&(k.info("Publishing precreated mic track"),await t.localParticipant.publishTrack(n,{source:ve.Source.Microphone})),k.info(`Publishing ${r.length} precreated screenshare tracks`);for(const s of r)t.localParticipant.publishTrack(s,{source:ve.Source.ScreenShare}).catch(o=>{k.error("Failed to publish screenshare track",o)})}function yct(t,e,n,r){const[i,s]=y.useState(r&&n?n.state:"ec_waiting"),[o,a]=y.useState(!1),[c,l]=y.useState(!1),u=y.useCallback(p=>{p==Dt.Connected&&a(!1),s(p)},[]);y.useEffect(()=>{const p=n;return n&&n.on(fe.ConnectionStateChanged,u),()=>{p&&p.off(fe.ConnectionStateChanged,u)}},[n,u]);const d=y.useCallback(async()=>{const p=[];for(const m of n.localParticipant.videoTrackPublications.values())if(m.track&&m.source==ve.Source.ScreenShare){const v=m.track.mediaStreamTrack.clone();v.enabled=!0,p.push(v)}a(!0),await(n==null?void 0:n.disconnect()),l(!0);try{await Nfe(n,r,void 0,p)}finally{l(!1)}},[n,r]),f=y.useRef(Object.assign({},r));return y.useEffect(()=>{var p;IE(r)&&IE(f.current)&&!hct(f.current,r)?(k.info(`SFU config changed! URL was ${(p=f.current)==null?void 0:p.url} now ${r==null?void 0:r.url}`),d().catch(m=>{k.error("Failed to switch focus",m)})):!IE(f.current)&&IE(r)&&(l(!0),vct(n,r,e,t).catch(m=>{k.error("Failed to connect to SFU",m)}).finally(()=>l(!1))),f.current=Object.assign({},r)},[r,n,t,e,d]),o?"ec_switching_focus":c?Dt.Connecting:i}class _ct extends ute{constructor(){super({ratchetWindowSize:0}),this.onEncryptionKeyChanged=(e,n,r)=>{lte(e).then(i=>{var s;this.onSetEncryptionKey(i,r,n),k.debug(`Sent new key to livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${n}`)},i=>{var s;k.error(`Failed to create key material from buffer for livekit room=${(s=this.rtcSession)==null?void 0:s.room.roomId} participantId=${r} encryptionKeyIndex=${n}`,i)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(Su.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(Su.EncryptionKeyChanged,this.onEncryptionKeyChanged);for(const[n,r]of this.rtcSession.getEncryptionKeys())for(const[i,s]of r.entries())this.onEncryptionKeyChanged(s,i,n)}}function bct(t,e,n,r){const i=y.useMemo(()=>{if(r.kind!==En.NONE){if(r.kind===En.PER_PARTICIPANT)return{keyProvider:new _ct,worker:new Az};if(r.kind===En.SHARED_KEY&&r.secret)return{keyProvider:new f3e,worker:new Az}}},[r]);y.useEffect(()=>{r.kind===En.NONE||!i||(r.kind===En.PER_PARTICIPANT?i.keyProvider.setRTCSession(t):r.kind===En.SHARED_KEY&&r.secret&&i.keyProvider.setKey(r.secret).catch(m=>{k.error("Failed to set shared key for E2EE",m)}))},[i,r,t]);const s=y.useRef(e),o=rS(),a=y.useRef(o),c=y.useMemo(()=>({...a6,videoCaptureDefaults:{...a6.videoCaptureDefaults,deviceId:a.current.videoInput.selectedId},audioCaptureDefaults:{...a6.audioCaptureDefaults,deviceId:a.current.audioInput.selectedId},audioOutput:{deviceId:a.current.audioOutput.selectedId},e2ee:i}),[i]),l=y.useRef(!1),u=y.useRef(!1),d=y.useRef({audio:s.current.audio.enabled,video:s.current.video.enabled}),f=y.useMemo(()=>{const m=new k_(c);return m.setE2EEEnabled(r.kind!==En.NONE).catch(v=>{k.error("Failed to set E2EE enabled on room",v)}),m},[c,r]),p=yct({deviceId:a.current.audioInput.selectedId},s.current.audio.enabled,f,n);return y.useEffect(()=>{if(f!==void 0&&p===Dt.Connected){const m=f.localParticipant;d.current={audio:e.audio.enabled,video:e.video.enabled};let v;(_=>{_[_.Microphone=0]="Microphone",_[_.Camera=1]="Camera"})(v||(v={}));const S=async(_,w)=>{var R,O,A,U;if(_>10){k.error("Stop trying to sync the input device with current mute state after 10 failed tries");return}let T,C,I;switch(w){case 0:T=m.isMicrophoneEnabled,C=d.current.audio,I=l.current;break;case 1:T=m.isCameraEnabled,C=d.current.video,I=u.current;break}if(T!==C&&!I)try{let N;switch(w){case 0:l.current=!0,N=await m.setMicrophoneEnabled(d.current.audio),l.current=!1;break;case 1:u.current=!0,N=await m.setCameraEnabled(d.current.video),u.current=!1;break}if(N)await new Promise(L=>setTimeout(L,100)),await S(_+1,w);else throw new Error("track with new mute state could not be published")}catch(N){N.name==="NotAllowedError"?(k.error("Fatal error while syncing mute state: resetting",N),w===0?(l.current=!1,(O=(R=e.audio).setEnabled)==null||O.call(R,!1)):(u.current=!1,(U=(A=e.video).setEnabled)==null||U.call(A,!1))):(k.error("Failed to sync audio mute state with LiveKit (will retry to sync in 1s):",N),setTimeout(()=>{S(_+1,w).catch(L=>{k.error(`Failed to sync ${v[w]} mute state with LiveKit iterCount=${_+1}`,L)})},1e3))}};S(0,0).catch(_=>{k.error("Failed to sync audio mute state with LiveKit",_)}),S(0,1).catch(_=>{k.error("Failed to sync video mute state with LiveKit",_)})}},[f,e,p]),y.useEffect(()=>{if(f!==void 0&&p===Dt.Connected){const m=(v,S)=>{var w,T,C,I;const _=S.selectedId;if(_==="default"&&v==="audioinput"&&((w=f.options.audioCaptureDefaults)==null?void 0:w.deviceId)==="default"){const R=(T=Array.from(f.localParticipant.audioTrackPublications.values()).find(A=>A.source===ve.Source.Microphone))==null?void 0:T.track,O=S.available.find(A=>A.deviceId==="default");O&&R&&R.mediaStreamTrack.readyState!=="ended"&&O.groupId!==R.mediaStreamTrack.getSettings().groupId&&((I=(C=f.localParticipant.getTrackPublication(ve.Source.Microphone))==null?void 0:C.audioTrack)==null||I.restartTrack().catch(A=>{k.error("Failed to restart audio device track",A)}))}else _!==void 0&&f.getActiveDevice(v)!==_&&f.switchActiveDevice(v,_).catch(R=>k.error(`Failed to sync ${v} device with LiveKit`,R))};m("audioinput",o.audioInput),m("audiooutput",o.audioOutput),m("videoinput",o.videoInput)}},[f,o,p]),{connState:p,livekitRoom:f}}function Sct(){y.useEffect(()=>{if("wakeLock"in navigator){let t=!0,e=null;const n=()=>{document.visibilityState==="visible"&&navigator.wakeLock.request("screen").then(r=>{e=r,t||e.release().catch(i=>k.warn("Can't release wake lock",i))},r=>{k.warn("Can't acquire wake lock",r)})};return n(),document.addEventListener("visibilitychange",n),()=>{t=!1,e!==null&&e.release().catch(r=>k.warn("Can't release wake lock",r)),document.removeEventListener("visibilitychange",n)}}},[])}const DI=(...t)=>y.useCallback(e=>t.forEach(n=>{typeof n=="function"?n(e):n!==null&&(n.current=e)}),t),wct="_toggle_1momj_8",Ect={toggle:wct},Tct=({layout:t,setLayout:e,className:n,onTouchEnd:r})=>{const{t:i}=ht(),s=y.useCallback(o=>e(o.target.value),[e]);return b.jsxs("div",{className:Pe(Ect.toggle,n),children:[b.jsx(Ao,{label:i("layout_spotlight_label"),children:b.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:t==="spotlight",onChange:s,onTouchEnd:r})}),b.jsx(WBe,{"aria-hidden":!0,width:24,height:24}),b.jsx(Ao,{label:i("layout_grid_label"),children:b.jsx("input",{type:"radio",name:"layout",value:"grid",checked:t==="grid",onChange:s,onTouchEnd:r})}),b.jsx($Be,{"aria-hidden":!0,width:24,height:24})]})},Lz=Symbol("nothing");function Cct(t){return e=>fQe(()=>{let n=Lz;return e.pipe(LQe(r=>n=r),oue(()=>{n!==Lz&&t(n)}))})}function Dz(t,e){return n=>n.pipe(CL(e,t),Us(t))}const Fg=new da;window.controls={canEnterPip(){return Fg.observed},enablePip(){if(!Fg.observed)throw new Error("No call is running");Fg.next(!0)},disablePip(){if(!Fg.observed)throw new Error("No call is running");Fg.next(!1)}};const kct=3e3,Rct=3;class Nz{constructor(e,n,r,i){this.id=e,this.scope=new Ude,this.vm=r.isLocal?new CI(e,n,r,i):new rot(e,n,r,i),this.speaker=this.vm.speaking.pipe(TQe(s=>sue(M0(s?1e3:6e4),this.vm.speaking.pipe(o9(o=>o!==s)))),Us(!1),Vh(),this.scope.state()),this.presenter=w9(r,le.TrackPublished,le.TrackUnpublished,le.LocalTrackPublished,le.LocalTrackUnpublished).pipe(Ut(s=>s.isScreenShareEnabled))}destroy(){this.scope.end(),this.vm.destroy()}}class Uz{constructor(e,n,r,i){this.vm=new s2(e,n,r,i)}destroy(){this.vm.destroy()}}function Ict(t,e){if(e==="local")return t.getMember(t.client.getUserId())??void 0;const n=e.split(":");if(n.length<3){k.warn("Livekit participants ID doesn't look like a userId:deviceId combination");return}n.pop();const r=n.join(":");return t.getMember(r)??void 0}class xct extends $de{constructor(e,n,r,i){super(),this.matrixRoom=e,this.livekitRoom=n,this.encrypted=r,this.connectionState=i,this.rawRemoteParticipants=Jtt(this.livekitRoom).pipe(this.scope.state()),this.remoteParticipantHolds=this.connectionState.pipe(UQe(this.rawRemoteParticipants),fI(([s,o])=>s===zL.ECSwitchingFocus?Zk(Ms({hold:o}),hQe([M0(kct),this.connectionState.pipe(o9(a=>a!==zL.ECSwitchingFocus),PG(1))]).pipe(Ut(()=>({unhold:o})))):Xk),Dz([],(s,o)=>"hold"in o?[o.hold,...s]:s.filter(a=>a!==o.unhold))),this.remoteParticipants=As([this.rawRemoteParticipants,this.remoteParticipantHolds],(s,o)=>{const a=[...s],c=new Set(a.map(l=>l.identity));for(const l of o)for(const u of l)c.has(u.identity)||(a.push(u),c.add(u.identity));return a}),this.mediaItems=As([this.remoteParticipants,E9(this.livekitRoom.localParticipant),aue.value,Q_(this.matrixRoom,xt.Update).pipe(Us(null))]).pipe(CL((s,[o,{participant:a},c])=>{const l=new Map((function*(){for(const u of[a,...o]){const d=u===a?"local":u.identity,f=Ict(this.matrixRoom,d);f===void 0&&k.warn(`Ruh, roh! No matrix member found for SFU participant '${u.identity}': creating g-g-g-ghost!`);for(let p=0;p<1+c;p++){const m=`${u.identity}:${p}`;if(yield[m,s.get(m)??new Nz(m,f,u,this.encrypted)],u.isScreenShareEnabled){const v=`${m}:screen-share`;yield[v,s.get(v)??new Uz(v,f,u,this.encrypted)]}}}}).bind(this)());for(const[u,d]of s)l.has(u)||d.destroy();return l},new Map),Ut(s=>[...s.values()]),Cct(s=>{for(const o of s)o.destroy()}),this.scope.state()),this.userMedia=this.mediaItems.pipe(Ut(s=>s.filter(o=>o instanceof Nz))),this.localUserMedia=this.mediaItems.pipe(Ut(s=>s.find(o=>o.vm.local).vm)),this.screenShares=this.mediaItems.pipe(Ut(s=>s.filter(o=>o instanceof Uz)),this.scope.state()),this.hasRemoteScreenShares=this.screenShares.pipe(Ut(s=>s.some(o=>!o.vm.local)),Vh()),this.spotlightSpeaker=this.userMedia.pipe(Dr(s=>s.length===0?Ms([]):As(s.map(o=>o.vm.speaking.pipe(Ut(a=>[o,a]))))),CL((s,o)=>{var l,u;const[a,c]=!(s!=null&&s.vm.local)&&o.find(([d])=>d===s)||[];return c?a:((l=o.find(([d,f])=>!d.vm.local&&f))==null?void 0:l[0])??a??((u=o.find(([d])=>!d.vm.local))==null?void 0:u[0])??o.find(([d])=>d.vm.local)[0]},null),Ut(s=>s.vm),this.scope.state(),NQe(1600,void 0,{leading:!0,trailing:!0})),this.grid=this.userMedia.pipe(Dr(s=>{const o=s.map(a=>As([a.speaker,a.presenter,a.vm.videoEnabled,a.vm instanceof CI?a.vm.alwaysShow:Ms(!1)],(c,l,u,d)=>{let f;return a.vm.local?f=d?0:5:l?f=1:c?f=2:u?f=3:f=4,[a,f]}));return o.length===0?Ms([]):As(o,(...a)=>a.sort(([,c],[,l])=>c-l).map(([c])=>c.vm))})),this.spotlightAndPip=this.screenShares.pipe(Ut(s=>s.length>0?[Ms(s.map(o=>o.vm)),this.spotlightSpeaker]:[this.spotlightSpeaker.pipe(Ut(o=>[o])),this.spotlightSpeaker.pipe(Dr(o=>o.local?Ms(null):this.localUserMedia.pipe(Dr(a=>a.alwaysShow.pipe(Ut(c=>c?a:null))))))])),this.spotlight=this.spotlightAndPip.pipe(Dr(([s])=>s),this.scope.state()),this.pip=this.spotlightAndPip.pipe(Dr(([,s])=>s)),this.pipEnabled=Fg.pipe(Us(!1)),this.naturalWindowMode=Q_(window,"resize").pipe(Us(null),Ut(()=>{const s=window.innerHeight,o=window.innerWidth;return s<=400&&o<=340?"pip":s<=600?"flat":o<=600?"narrow":"normal"}),this.scope.state()),this.windowMode=this.pipEnabled.pipe(Dr(s=>s?Ms("pip"):this.naturalWindowMode)),this.spotlightExpandedToggle=new da,this.spotlightExpanded=this.spotlightExpandedToggle.pipe(Dz(!1,s=>!s),this.scope.state()),this.gridModeUserSelection=new da,this.gridMode=this.gridModeUserSelection.pipe(Us(null),Dr(s=>(s==="spotlight"?Xk:As([this.hasRemoteScreenShares,this.windowMode]).pipe(PQe(s===null?0:1),Ut(([o,a])=>o||a==="flat"?"spotlight":"grid"))).pipe(Us(s??"grid"))),this.scope.state()),this.oneOnOne=As([this.grid,this.screenShares],(s,o)=>s.length==2&&s.some(a=>!a.local)&&o.length===0),this.gridLayout=As([this.grid,this.spotlight],(s,o)=>({type:"grid",spotlight:o.some(a=>a instanceof s2)?o:void 0,grid:s})),this.spotlightLandscapeLayout=As([this.grid,this.spotlight],(s,o)=>({type:"spotlight-landscape",spotlight:o,grid:s})),this.spotlightPortraitLayout=As([this.grid,this.spotlight],(s,o)=>({type:"spotlight-portrait",spotlight:o,grid:s})),this.spotlightExpandedLayout=As([this.spotlight,this.pip],(s,o)=>({type:"spotlight-expanded",spotlight:s,pip:o??void 0})),this.oneOnOneLayout=this.grid.pipe(Ut(s=>({type:"one-on-one",local:s.find(o=>o.local),remote:s.find(o=>!o.local)}))),this.pipLayout=this.spotlight.pipe(Ut(s=>({type:"pip",spotlight:s}))),this.layout=this.windowMode.pipe(Dr(s=>{switch(s){case"normal":return this.gridMode.pipe(Dr(o=>{switch(o){case"grid":return this.oneOnOne.pipe(Dr(a=>a?this.oneOnOneLayout:this.gridLayout));case"spotlight":return this.spotlightExpanded.pipe(Dr(a=>a?this.spotlightExpandedLayout:this.spotlightLandscapeLayout))}}));case"narrow":return this.oneOnOne.pipe(Dr(o=>o?this.spotlightExpandedLayout:As([this.grid,this.spotlight],(a,c)=>a.length>Rct||c.some(l=>l instanceof s2)?this.spotlightPortraitLayout:this.gridLayout).pipe(OQe())));case"flat":return this.gridMode.pipe(Dr(o=>{switch(o){case"grid":return this.spotlightLandscapeLayout;case"spotlight":return this.spotlightExpandedLayout}}));case"pip":return this.pipLayout}}),this.scope.state()),this.showSpotlightIndicators=this.layout.pipe(Ut(s=>s.type!=="grid"),this.scope.state()),this.showSpeakingIndicators=this.layout.pipe(Ut(s=>s.type!=="one-on-one"&&!s.type.startsWith("spotlight-")),this.scope.state()),this.toggleSpotlightExpanded=this.windowMode.pipe(Dr(s=>s==="normal"?this.layout.pipe(Ut(o=>o.type==="spotlight-landscape"||o.type==="spotlight-expanded")):Ms(!1)),Vh(),Ut(s=>s?()=>this.spotlightExpandedToggle.next():null),this.scope.state()),this.screenTap=new da,this.screenHover=new da,this.screenUnhover=new da,this.showHeader=this.windowMode.pipe(Ut(s=>s!=="pip"&&s!=="flat"),this.scope.state()),this.showFooter=this.windowMode.pipe(Dr(s=>{switch(s){case"pip":return Ms(!1);case"normal":case"narrow":return Ms(!0);case"flat":return A0()?Ms(!0):sue(this.screenTap.pipe(Ut(()=>"tap")),this.screenHover.pipe(Ut(()=>"hover"))).pipe(MQe((o,a)=>a==="tap"?o?Ms(!1):M0(6e3).pipe(Ut(()=>!1),Us(!0)):wQe(M0(3e3),this.screenUnhover.pipe(PG(1))).pipe(Ut(()=>!1),Us(!0)),!1),Us(!1))}}),this.scope.state())}setGridMode(e){this.gridModeUserSelection.next(e)}showGridVideo(e){return this.layout.pipe(Ut(n=>!((n.type==="spotlight-landscape"||n.type==="spotlight-portrait")&&n.spotlight.some(r=>r===e))),Vh())}tapScreen(){this.screenTap.next()}hoverScreen(){this.screenHover.next()}unhoverScreen(){this.screenUnhover.next()}}function Pct(t,e,n){return Math.max(e,Math.min(t,n))}const si={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function $z(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function Fz(t,e,n,r=.15){return r===0?Pct(t,e,n):t<e?-$z(e-t,n-e,r)+e:t>n?+$z(t-n,n-e,r)+n:t}function Oct(t,[e,n],[r,i]){const[[s,o],[a,c]]=t;return[Fz(e,s,o,r),Fz(n,a,c,i)]}function Mct(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Act(t){var e=Mct(t,"string");return typeof e=="symbol"?e:String(e)}function ls(t,e,n){return e=Act(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Bz(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function rr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Bz(Object(n),!0).forEach(function(r){ls(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bz(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Ufe={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function jz(t){return t?t[0].toUpperCase()+t.slice(1):""}const Lct=["enter","leave"];function Dct(t=!1,e){return t&&!Lct.includes(e)}function Nct(t,e="",n=!1){const r=Ufe[t],i=r&&r[e]||e;return"on"+jz(t)+jz(i)+(Dct(n,i)?"Capture":"")}const Uct=["gotpointercapture","lostpointercapture"];function $ct(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=Uct.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function Fct(t,e=""){const n=Ufe[t],r=n&&n[e]||e;return t+r}function NI(t){return"touches"in t}function $fe(t){return NI(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function Bct(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function jct(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function Ffe(t){return NI(t)?jct(t)[0]:t}function Hct(t){return Bct(t).map(e=>e.identifier)}function c6(t){const e=Ffe(t);return NI(t)?e.identifier:e.pointerId}function Hz(t){const e=Ffe(t);return[e.clientX,e.clientY]}function Kct(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:o}=t.currentTarget;return[(e=r??s)!==null&&e!==void 0?e:0,(n=i??o)!==null&&n!==void 0?n:0]}function Vct(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return e}function f2(t,...e){return typeof t=="function"?t(...e):t}function qct(){}function Gct(...t){return t.length===0?qct:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function Kz(t,e){return Object.assign({},e,t||{})}const zct=32;class Wct{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?f2(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let s=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,Vct(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const R=n._delta.map(Math.abs);si.addTo(n._distance,R)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[c,l]=r.threshold,{_step:u,values:d}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=c&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=l&&d[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=c&&Math.sign(o)*c),u[1]===!1&&(u[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const f=[0,0];if(r.hasCustomTransform){const[R,O]=d;f[0]=u[0]!==!1?R-u[0]:0,f[1]=u[1]!==!1?O-u[1]:0}else f[0]=u[0]!==!1?o-u[0]:0,f[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(f);const p=n.offset,m=n._active&&!n._blocked||n.active;m&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=f2(r.bounds,n)),this.setup&&this.setup()),n.movement=f,this.computeOffset()));const[v,S]=n.offset,[[_,w],[T,C]]=n._bounds;n.overflow=[v<_?-1:v>w?1:0,S<T?-1:S>C?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const I=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Oct(n._bounds,n.offset,I),n.delta=si.sub(n.offset,p),this.computeMovement(),m&&(!n.last||s>zct)){n.delta=si.sub(n.offset,p);const R=n.delta.map(Math.abs);si.addTo(n.distance,R),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[R[0]/s,R[1]/s],n.timeDelta=s)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(rr(rr(rr({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Yct([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class Bfe extends Wct{constructor(...e){super(...e),ls(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=si.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=si.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[$fe(e)]:r.axisThreshold;n.axis=Yct(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const Jct=t=>t,Vz=.15,jfe={enabled(t=!0){return t},eventOptions(t,e,n){return rr(rr({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[Vz,Vz];case!1:return[0,0];default:return si.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return si.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||Jct},threshold(t){return si.toVector(t,0)}},Xct=0,py=rr(rr({},jfe),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=Xct){return t},bounds(t={}){if(typeof t=="function")return s=>py.bounds(t(s));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),qz={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class Zct extends Bfe{constructor(...e){super(...e),ls(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const n=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:n.left-r.left+e.offset[0],right:n.right-r.right+e.offset[0],top:n.top-r.top+e.offset[1],bottom:n.bottom-r.bottom+e.offset[1]};e._bounds=py.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const n=this.config,r=this.state;if(e.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(e.buttons):n.pointerButtons!==-1&&n.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);n.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&r._pointerActive)&&(this.start(e),this.setupPointer(e),r._pointerId=c6(e),r._pointerActive=!0,this.computeValues(Hz(e)),this.computeInitial(),n.preventScrollAxis&&$fe(e)!=="mouse"?(r._active=!1,this.setupScrollPrevention(e)):n.delay>0?(this.setupDelayTrigger(e),n.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const n=this.state,r=this.config;if(!n._pointerActive)return;const i=c6(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;const s=Hz(e);if(document.pointerLockElement===e.target?n._delta=[e.movementX,e.movementY]:(n._delta=si.sub(s,n._values),this.computeValues(s)),si.addTo(n._movement,n._delta),this.compute(e),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const i=c6(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=n._distance;if(n.tap=s<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[a,c]=n._delta,[l,u]=n._movement,[d,f]=r.swipe.velocity,[p,m]=r.swipe.distance,v=r.swipe.duration;if(n.elapsedTime<v){const S=Math.abs(a/n.timeDelta),_=Math.abs(c/n.timeDelta);S>d&&Math.abs(l)>p&&(n.swipe[0]=Math.sign(a)),_>f&&Math.abs(u)>m&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const n=this.config,r=n.device;n.pointerLock&&e.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,Qct(e);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const n=qz[e.key];if(n){const r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=n(this.config.keyboardDisplacement,i),r._keyboardActive=!0,si.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in qz&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const n=this.config.device;e(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(n,"change",this.pointerMove.bind(this)),e(n,"end",this.pointerUp.bind(this)),e(n,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function Qct(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const dS=typeof window<"u"&&window.document&&window.document.createElement;function Hfe(){return dS&&"ontouchstart"in window}function elt(){return Hfe()||dS&&window.navigator.maxTouchPoints>1}function tlt(){return dS&&"onpointerdown"in window}function nlt(){return dS&&"exitPointerLock"in window.document}function rlt(){try{return"constructor"in GestureEvent}catch{return!1}}const ca={isBrowser:dS,gesture:rlt(),touch:Hfe(),touchscreen:elt(),pointer:tlt(),pointerLock:nlt()},ilt=250,slt=180,olt=.5,alt=50,clt=250,llt=10,Gz={mouse:0,touch:0,pen:8},ult=rr(rr({},py),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&ca.pointerLock,ca.touch&&n?"touch":this.pointerLock?"mouse":ca.pointer&&!i?"pointer":ca.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?ilt:void 0,!(!ca.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const s=si.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:t=olt,distance:e=alt,duration:n=clt}={}){return{velocity:this.transform(si.toVector(t)),distance:this.transform(si.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return slt;case!1:return 0;default:return t}},axisThreshold(t){return t?rr(rr({},Gz),t):Gz},keyboardDisplacement(t=llt){return t}});rr(rr({},jfe),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!ca.touch&&ca.gesture)return"gesture";if(ca.touch&&r)return"touch";if(ca.touchscreen){if(ca.pointer)return"pointer";if(ca.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=o=>{const a=Kz(f2(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=Kz(f2(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",si.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});rr(rr({},py),{},{mouseOnly:(t=!0)=>t});class dlt extends Bfe{constructor(...e){super(...e),ls(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const n=this.state,r=Kct(e);n._delta=si.sub(r,n._values),si.addTo(n._movement,n._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const flt=py;rr(rr({},py),{},{mouseOnly:(t=!0)=>t});const Kfe=new Map,WL=new Map;function Vfe(t){Kfe.set(t.key,t.engine),WL.set(t.key,t.resolver)}const hlt={key:"drag",engine:Zct,resolver:ult},plt={key:"scroll",engine:dlt,resolver:flt};function glt(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function mlt(t,e){if(t==null)return{};var n=glt(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const vlt={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=ca.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},ylt=["target","eventOptions","window","enabled","transform"];function JT(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=JT(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function _lt(t,e,n={}){const r=t,{target:i,eventOptions:s,window:o,enabled:a,transform:c}=r,l=mlt(r,ylt);if(n.shared=JT({target:i,eventOptions:s,window:o,enabled:a,transform:c},vlt),e){const u=WL.get(e);n[e]=JT(rr({shared:n.shared},l),u)}else for(const u in l){const d=WL.get(u);d&&(n[u]=JT(rr({shared:n.shared},l[u]),d))}return n}class qfe{constructor(e,n){ls(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,s){const o=this._listeners,a=Fct(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=rr(rr({},c),s);e.addEventListener(a,i,l);const u=()=>{e.removeEventListener(a,i,l),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class blt{constructor(){ls(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Slt{constructor(e){ls(this,"gestures",new Set),ls(this,"_targetEventStore",new qfe(this)),ls(this,"gestureEventStores",{}),ls(this,"gestureTimeoutStores",{}),ls(this,"handlers",{}),ls(this,"config",{}),ls(this,"pointerIds",new Set),ls(this,"touchIds",new Set),ls(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),wlt(this,e)}setEventIds(e){if(NI(e))return this.touchIds=new Set(Hct(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=_lt(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],c=zz(r,a.eventOptions,!!i);if(a.enabled){const l=Kfe.get(o);new l(this,e,o).bind(c)}}const s=zz(r,n.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](rr(rr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=Gct(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:c}=$ct(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:c})}}}}function Rg(t,e){t.gestures.add(e),t.gestureEventStores[e]=new qfe(t,e),t.gestureTimeoutStores[e]=new blt}function wlt(t,e){e.drag&&Rg(t,"drag"),e.wheel&&Rg(t,"wheel"),e.scroll&&Rg(t,"scroll"),e.move&&Rg(t,"move"),e.pinch&&Rg(t,"pinch"),e.hover&&Rg(t,"hover")}const zz=(t,e,n)=>(r,i,s,o={},a=!1)=>{var c,l;const u=(c=o.capture)!==null&&c!==void 0?c:e.capture,d=(l=o.passive)!==null&&l!==void 0?l:e.passive;let f=a?r:Nct(r,i,u);n&&d&&(f+="Passive"),t[f]=t[f]||[],t[f].push(s)};function Gfe(t,e={},n,r){const i=re.useMemo(()=>new Slt(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),re.useEffect(i.effect.bind(i)),re.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Elt(t,e){return Vfe(hlt),Gfe({drag:t},e||{},"drag")}function Tlt(t,e){return Vfe(plt),Gfe({scroll:t},e||{},"scroll")}const Clt="_grid_vxulb_8",klt="_slot_vxulb_12",l6={grid:Clt,slot:klt},Rlt="_tile_1r7xt_8",Ilt="_draggable_1r7xt_8",Wz={tile:Rlt,draggable:Ilt},zfe=y.memo(({id:t,onDrag:e,targetWidth:n,targetHeight:r,model:i,Tile:s,opacity:o,scale:a,zIndex:c,x:l,y:u,width:d,height:f})=>{const p=y.useRef(null);return Elt(m=>e==null?void 0:e.current(t,m),{target:p,filterTaps:!0,preventScroll:!0}),b.jsx(s,{ref:p,className:Pe(Wz.tile,{[Wz.draggable]:e}),style:{opacity:o,scale:a,zIndex:c,x:l,y:u,width:d,height:f},targetWidth:n,targetHeight:r,model:i})});zfe.displayName="TileWrapper";const xlt=zfe,Plt=()=>tI("(prefers-reduced-motion)");function Wfe(t,e){if(!(t.offsetParent instanceof HTMLElement)||t.offsetParent===e)return{x:t.offsetLeft,y:t.offsetTop};{const n=Wfe(t.offsetParent,e);return n.x+=t.offsetLeft,n.y+=t.offsetTop,n}}const Yfe=y.createContext(null);function pl(){const t=y.useContext(Yfe);if(t===null)throw new Error("useUpdateLayout called outside a Grid layout context");y.useEffect(()=>t.setGeneration(e=>e===null?0:e+1))}function Yz({model:t,Layout:e,Tile:n,className:r,style:i}){const[s,o]=L0(),[a,c]=y.useState(null),l=DI(s,c),[u,d]=y.useState(null),[f,p]=y.useState(null),m=wp(()=>new Map),v=Plt(),S=y.useMemo(()=>function({id:j,model:X,onDrag:G,style:F,className:V,...J}){const K=y.useRef(null);return y.useEffect(()=>(m.set(j,{id:j,model:X,onDrag:G}),()=>void m.delete(j)),[j,X,G]),b.jsx("div",{ref:K,className:Pe(V,l6.slot),"data-id":j,style:F,...J})},[m]),_=y.useMemo(()=>y.memo(y.forwardRef(function({Layout:j,...X},G){return b.jsx(j,{...X,ref:G})})),[]),w=y.useMemo(()=>({setGeneration:p}),[]),T=y.useMemo(()=>{const L=[];if(a!==null&&u!==null){const j=u.getElementsByClassName(l6.slot);for(const X of j){const G=X.getAttribute("data-id");X.offsetWidth>0&&X.offsetHeight>0&&L.push({...m.get(G),...Wfe(X,a),width:X.offsetWidth,height:X.offsetHeight})}}return L},[a,u,m,o,f]),C=y.useRef(null),[I,R]=Fat(T,()=>({key:({id:L})=>L,from:({x:L,y:j,width:X,height:G})=>({opacity:0,scale:0,zIndex:1,x:L,y:j,width:X,height:G,immediate:v}),enter:{opacity:1,scale:1,immediate:v},update:({id:L,x:j,y:X,width:G,height:F})=>{var V;return L===((V=C.current)==null?void 0:V.tileId)?null:{x:j,y:X,width:G,height:F,immediate:v}},leave:{opacity:0,scale:0,immediate:v},config:{mass:.7,tension:252,friction:25}}));y.useEffect(()=>{R.start().forEach(L=>void L.catch(k.error))},[T,R]);const O=(L,j)=>{var J;const{tileId:X,tileX:G,tileY:F}=C.current,V=T.find(K=>K.id===X);(J=R.current.find(K=>K.item.id===X))==null||J.start(L?{scale:1,zIndex:1,x:V.x,y:V.y,width:V.width,height:V.height,immediate:v||(K=>K==="zIndex"),delay:K=>K==="zIndex"?500:0}:{scale:1.1,zIndex:2,x:G,y:F,immediate:v||(K=>K==="zIndex"||K==="x"||K==="y")}).catch(k.error),L&&j({x:G,y:F,xRatio:G/(o.width-V.width),yRatio:F/(o.height-V.height)})},A=(L,{tap:j,initial:[X,G],delta:[F,V],last:J})=>{if(!j){const K=R.current.find(Y=>Y.item.id===L),W=m.get(K.item.id).onDrag;if(W!=null){if(C.current===null){const Y=K.get();C.current={tileId:L,tileX:Y.x,tileY:Y.y,cursorX:X-o.x,cursorY:G-o.y+N.current}}C.current.tileX+=F,C.current.tileY+=V,C.current.cursorX+=F,C.current.cursorY+=V,O(J,W),J&&(C.current=null)}}},U=y.useRef(A);U.current=A;const N=y.useRef(0);return Tlt(({xy:[,L],delta:[,j]})=>{N.current=L,C.current!==null&&(C.current.tileY+=j,C.current.cursorY+=j,O(!1,m.get(C.current.tileId).onDrag))},{target:a??void 0}),b.jsxs("div",{ref:l,className:Pe(r,l6.grid),style:i,children:[b.jsx(Yfe.Provider,{value:w,children:b.jsx(_,{ref:d,Layout:e,model:t,Slot:S})}),I((L,{id:j,model:X,onDrag:G,width:F,height:V})=>b.jsx(xlt,{id:j,onDrag:G?U:null,targetWidth:F,targetHeight:V,model:X,Tile:n,...L},j))]})}function Jfe(t){const e=y.useRef();return e.current??(e.current=new bf(t)),t!==e.current.value&&e.current.next(t),e.current}function Olt(t){const e=wp(()=>new bf(t)),n=y.useCallback(r=>e.next(r),[e]);return[e,n]}const Mlt="_contents_1q1o8_8",Alt="_tile_1q1o8_25",Llt="_maximised_1q1o8_25",Dlt="_item_1q1o8_29",Nlt="_snap_1q1o8_36",Ult="_advance_1q1o8_40",$lt="_back_1q1o8_76",Flt="_next_1q1o8_80",Blt="_expand_1q1o8_84",jlt="_indicators_1q1o8_128",Hlt="_show_1q1o8_140",go={contents:Mlt,tile:Alt,maximised:Llt,item:Dlt,snap:Nlt,advance:Ult,back:$lt,next:Flt,expand:Blt,indicators:jlt,show:Hlt},Xfe=y.forwardRef(({vm:t,...e},n)=>{const r=jt(t.mirror);return b.jsx(uS,{ref:n,mirror:r,...e})});Xfe.displayName="SpotlightLocalUserMediaItem";const Zfe=y.forwardRef(({vm:t,...e},n)=>{const r=jt(t.videoEnabled),i=jt(t.cropVideo),s={videoEnabled:r,videoFit:i?"cover":"contain",...e};return t instanceof CI?b.jsx(Xfe,{ref:n,vm:t,...s}):b.jsx(uS,{mirror:!1,...s})});Zfe.displayName="SpotlightUserMediaItem";const Qfe=y.forwardRef(({vm:t,targetWidth:e,targetHeight:n,intersectionObserver:r,snap:i,"aria-hidden":s},o)=>{const a=y.useRef(null),c=DI(a,o),l=Fde(t),u=jt(t.video),d=jt(t.unencryptedWarning);y.useEffect(()=>{const p=a.current;let m=null;const v=r.subscribe(S=>{m==null||m.unobserve(p),S.observe(p),m=S});return()=>{v.unsubscribe(),m==null||m.unobserve(p)}},[r]);const f={ref:c,"data-id":t.id,className:Pe(go.item,{[go.snap]:i}),targetWidth:e,targetHeight:n,video:u,member:t.member,unencryptedWarning:d,displayName:l,"aria-hidden":s};return t instanceof s2?b.jsx(uS,{videoEnabled:!0,videoFit:"contain",mirror:!1,...f}):b.jsx(Zfe,{vm:t,...f})});Qfe.displayName="SpotlightItem";const YL=y.forwardRef(({vms:t,maximised:e,expanded:n,onToggleExpanded:r,targetWidth:i,targetHeight:s,showIndicators:o,className:a,style:c},l)=>{const{t:u}=ht(),[d,f]=Olt(null),p=DI(f,l),[m,v]=y.useState(t[0].id),S=Rk(t),_=Rk(m),w=t.findIndex(L=>L.id===m),T=w>0,C=w!==-1&&w<t.length-1,I=wp(()=>d.pipe(Ut(L=>new IntersectionObserver(j=>{const X=j.find(G=>G.isIntersecting);X!==void 0&&v(X.target.getAttribute("data-id"))},{root:L,threshold:.5})))),[R,O]=L9(L=>L==null||L===m||t.every(j=>j.id!==L)?null:L,[m]),A=y.useCallback(()=>{const L=S.current,j=L.findIndex(X=>X.id===_.current);j>0&&O(L[j-1].id)},[_,S,O]),U=y.useCallback(()=>{const L=S.current,j=L.findIndex(X=>X.id===_.current);j!==-1&&j!==L.length-1&&O(L[j+1].id)},[_,S,O]),N=n?DBe:Voe;return b.jsxs(Mfe.div,{ref:p,className:Pe(a,go.tile,{[go.maximised]:e}),style:c,children:[T&&b.jsx("button",{className:Pe(go.advance,go.back),"aria-label":u("common.back"),onClick:A,children:b.jsx(LBe,{"aria-hidden":!0,width:24,height:24})}),b.jsx("div",{className:go.contents,children:t.map(L=>b.jsx(Qfe,{vm:L,targetWidth:i,targetHeight:s,intersectionObserver:I,snap:R===null||R===L.id,"aria-hidden":(R??m)!==L.id},L.id))}),r&&b.jsx("button",{className:Pe(go.expand),"aria-label":u(n?"video_tile.collapse":"video_tile.expand"),onClick:r,children:b.jsx(N,{"aria-hidden":!0,width:20,height:20})}),C&&b.jsx("button",{className:Pe(go.advance,go.next),"aria-label":u("common.next"),onClick:U,children:b.jsx(Gse,{"aria-hidden":!0,width:24,height:24})}),!n&&b.jsx("div",{className:Pe(go.indicators,{[go.show]:o&&t.length>1}),children:t.map(L=>b.jsx("div",{className:go.item,"data-visible":L.id===m},L.id))})]})});YL.displayName="SpotlightTile";const Klt="_fixed_1mz83_8",Vlt="_scrolling_1mz83_9",qlt="_slot_1mz83_21",xE={fixed:Klt,scrolling:Vlt,slot:qlt},Glt={inline:"end",block:"end"},zlt={inline:"end",block:"start"},Jz=17/9,u6=4/3;function X9(t,e,n){const r=t<800?16:20,i=t*e,s=Math.pow(Math.sqrt(i)/8+125,2),o=Math.min(n,i/s);let a=Math.min(o,Math.round(Math.sqrt(t/e/u6*o))),c=o/a;o===n&&(c=Math.ceil(c),a=Math.ceil(n/c));let l=(t-(a+1)*r)/a,u=(e-(c-1)*r)/c;const d=l/u;return d>Jz?l=u*Jz:d<u6&&(u=l/u6),{tileWidth:l,tileHeight:u,gap:r,columns:a}}const Wlt=({minBounds:t,spotlightAlignment:e})=>({scrollingOnTop:!1,fixed:y.forwardRef(function({model:r,Slot:i},s){pl();const o=jt(wp(()=>e.pipe(Vh((l,u)=>l.block===u.block&&l.inline===u.inline)))),a=y.useMemo(()=>r.spotlight&&{type:"spotlight",vms:r.spotlight,maximised:!1},[r.spotlight]),c=y.useCallback(({xRatio:l,yRatio:u})=>e.next({block:u<.5?"start":"end",inline:l<.5?"start":"end"}),[]);return b.jsx("div",{ref:s,className:xE.fixed,children:a&&b.jsx(i,{className:xE.slot,id:"spotlight",model:a,onDrag:c,"data-block-alignment":o.block,"data-inline-alignment":o.inline})})}),scrolling:y.forwardRef(function({model:r,Slot:i},s){pl();const{width:o,height:a}=jt(t),{gap:c,tileWidth:l,tileHeight:u}=y.useMemo(()=>X9(o,a,r.grid.length),[o,a,r.grid.length]),d=y.useMemo(()=>r.grid.map(f=>({type:"grid",vm:f})),[r.grid]);return b.jsx("div",{ref:s,className:xE.scrolling,style:{width:o,"--gap":`${c}px`,"--width":`${Math.floor(l)}px`,"--height":`${Math.floor(u)}px`},children:d.map(f=>b.jsx(i,{className:xE.slot,id:f.vm.id,model:f},f.vm.id))})})}),Ylt="_layer_10i5l_8",Jlt="_container_10i5l_14",Xlt="_local_10i5l_18",Zlt="_spotlight_10i5l_25",Qlt="_slot_10i5l_31",PE={layer:Ylt,container:Jlt,local:Xlt,spotlight:Zlt,slot:Qlt},eut=({minBounds:t,pipAlignment:e})=>({scrollingOnTop:!1,fixed:y.forwardRef(function(r,i){return pl(),b.jsx("div",{ref:i})}),scrolling:y.forwardRef(function({model:r,Slot:i},s){pl();const{width:o,height:a}=jt(t),c=jt(e),{tileWidth:l,tileHeight:u}=y.useMemo(()=>X9(o,a,1),[o,a]),d=y.useMemo(()=>({type:"grid",vm:r.remote}),[r.remote]),f=y.useMemo(()=>({type:"grid",vm:r.local}),[r.local]),p=y.useCallback(({xRatio:m,yRatio:v})=>e.next({block:v<.5?"start":"end",inline:m<.5?"start":"end"}),[]);return b.jsx("div",{ref:s,className:PE.layer,children:b.jsx(i,{id:d.vm.id,model:d,className:PE.container,style:{width:l,height:u},children:b.jsx(i,{className:Pe(PE.slot,PE.local),id:f.vm.id,model:f,onDrag:p,"data-block-alignment":c.block,"data-inline-alignment":c.inline})})})})}),tut="_layer_1bn1m_8",nut="_spotlight_1bn1m_12",rut="_pip_1bn1m_17",OE={layer:tut,spotlight:nut,pip:rut},iut=({pipAlignment:t})=>({scrollingOnTop:!0,fixed:y.forwardRef(function({model:n,Slot:r},i){pl();const s=y.useMemo(()=>({type:"spotlight",vms:n.spotlight,maximised:!0}),[n.spotlight]);return b.jsx("div",{ref:i,className:OE.layer,children:b.jsx(r,{className:OE.spotlight,id:"spotlight",model:s})})}),scrolling:y.forwardRef(function({model:n,Slot:r},i){pl();const s=jt(t),o=y.useMemo(()=>n.pip&&{type:"grid",vm:n.pip},[n.pip]),a=y.useCallback(({xRatio:c,yRatio:l})=>t.next({block:l<.5?"start":"end",inline:c<.5?"start":"end"}),[]);return b.jsx("div",{ref:i,className:OE.layer,children:o&&b.jsx(r,{className:OE.pip,id:"pip",model:o,onDrag:a,"data-block-alignment":s.block,"data-inline-alignment":s.inline})})})}),sut="_layer_1cuqb_8",out="_spotlight_1cuqb_19",aut="_slot_1cuqb_28",cut="_grid_1cuqb_34",Nl={layer:sut,spotlight:out,slot:aut,grid:cut},lut=({minBounds:t})=>({scrollingOnTop:!1,fixed:y.forwardRef(function({model:n,Slot:r},i){pl(),jt(t);const s=y.useMemo(()=>({type:"spotlight",vms:n.spotlight,maximised:!1}),[n.spotlight]);return b.jsxs("div",{ref:i,className:Nl.layer,children:[b.jsx("div",{className:Nl.spotlight,children:b.jsx(r,{className:Nl.slot,id:"spotlight",model:s})}),b.jsx("div",{className:Nl.grid})]})}),scrolling:y.forwardRef(function({model:n,Slot:r},i){pl(),jt(t);const s=y.useMemo(()=>n.grid.map(o=>({type:"grid",vm:o})),[n.grid]);return b.jsxs("div",{ref:i,className:Nl.layer,children:[b.jsx("div",{className:Pe(Nl.spotlight,{[Nl.withIndicators]:n.spotlight.length>1})}),b.jsx("div",{className:Nl.grid,children:s.map(o=>b.jsx(r,{className:Nl.slot,id:o.vm.id,model:o},o.vm.id))})]})})}),uut="_layer_qjvz2_8",dut="_spotlight_qjvz2_17",fut="_withIndicators_qjvz2_26",hut="_slot_qjvz2_30",put="_grid_qjvz2_35",ad={layer:uut,spotlight:dut,withIndicators:fut,slot:hut,grid:put},gut=({minBounds:t})=>({scrollingOnTop:!1,fixed:y.forwardRef(function({model:n,Slot:r},i){pl();const s=y.useMemo(()=>({type:"spotlight",vms:n.spotlight,maximised:!0}),[n.spotlight]);return b.jsx("div",{ref:i,className:ad.layer,children:b.jsx("div",{className:ad.spotlight,children:b.jsx(r,{className:ad.slot,id:"spotlight",model:s})})})}),scrolling:y.forwardRef(function({model:n,Slot:r},i){pl();const{width:s}=jt(t),{gap:o,tileWidth:a,tileHeight:c}=X9(s,s,n.grid.length),l=y.useMemo(()=>n.grid.map(u=>({type:"grid",vm:u})),[n.grid]);return b.jsxs("div",{ref:i,className:ad.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(a)}px`,"--grid-tile-height":`${Math.floor(c)}px`},children:[b.jsx("div",{className:Pe(ad.spotlight,{[ad.withIndicators]:n.spotlight.length>1})}),b.jsx("div",{className:ad.grid,children:l.map(u=>b.jsx(r,{className:ad.slot,id:u.vm.id,model:u},u.vm.id))})]})})}),mut="getDisplayMedia"in(navigator.mediaDevices??{}),vut=400,yut=t=>{const e=pct(t.client,t.rtcSession),{livekitRoom:n,connState:r}=bct(t.rtcSession,t.muteStates,e,t.e2eeSystem),i=Jfe(r),[s,o]=y.useState(null);return y.useEffect(()=>()=>{n==null||n.disconnect().catch(a=>{k.error("Failed to disconnect from livekit room",a)})},[]),y.useEffect(()=>{if(n!==void 0){const a=new xct(t.rtcSession.room,n,t.e2eeSystem.kind!==En.NONE,i);return o(a),()=>a.destroy()}},[t.rtcSession.room,n,t.e2eeSystem.kind,i]),n===void 0||s===null?null:b.jsx(Ode.Provider,{value:n,children:b.jsx(_ut,{...t,vm:s,livekitRoom:n,connState:r})})},_ut=({client:t,vm:e,matrixInfo:n,rtcSession:r,livekitRoom:i,muteStates:s,participantCount:o,onLeave:a,hideHeader:c,connState:l,onShareClick:u})=>{Sct(),y.useEffect(()=>{l===Dt.Disconnected&&a(new Error("Disconnected from call server"))},[l,a]);const d=y.useRef(null),[f,p]=L0(),m=p.height>0,v=DI(d,f),{hideScreensharing:S,showControls:_}=Fp(),{isScreenShareEnabled:w,localParticipant:T}=Git({room:i}),C=y.useCallback(()=>{var Xe,Rn;return(Rn=(Xe=s.audio).setEnabled)==null?void 0:Rn.call(Xe,At=>!At)},[s]),I=y.useCallback(()=>{var Xe,Rn;return(Rn=(Xe=s.video).setEnabled)==null?void 0:Rn.call(Xe,At=>!At)},[s]);Zst(d,C,I,Xe=>{var Rn,At;return(At=(Rn=s.audio).setEnabled)==null?void 0:At.call(Rn,!Xe)});const R=m&&p.width<=660,O=m&&p.width<=340,A=O&&p.height<=400,U=jt(e.windowMode),N=jt(e.layout),L=jt(e.gridMode),j=jt(e.showHeader),X=jt(e.showFooter),G=y.useRef(null),F=y.useCallback(()=>G.current=Date.now(),[]),V=y.useCallback(()=>{const Xe=G.current;Xe!==null&&Date.now()-Xe<=vut&&e.tapScreen(),G.current=null},[e]),J=y.useCallback(()=>G.current=null,[]),K=y.useCallback(Xe=>Xe.stopPropagation(),[]),W=y.useCallback(Xe=>{Xe.pointerType==="mouse"&&e.hoverScreen()},[e]),Y=y.useCallback(()=>e.unhoverScreen(),[e]),[ce,ue]=y.useState(!1),[Te,Re]=y.useState(T9),Oe=y.useCallback(()=>ue(!0),[ue]),De=y.useCallback(()=>ue(!1),[ue]),ze=y.useCallback(()=>{Re("profile"),ue(!0)},[Re,ue]),[et,lt]=L0(),[Ae,yn]=L0(),un=y.useMemo(()=>({width:p.width,height:p.height-lt.height-(U==="flat"?0:yn.height)}),[p.width,p.height,lt.height,yn.height,U]),je=Jfe(un),Bt=wp(()=>new bf(Glt)),_n=wp(()=>new bf(zlt)),Jn=y.useCallback(Xe=>e.setGridMode(Xe),[e]);y.useEffect(()=>{rt==null||rt.api.transport.send(L==="grid"?fs.TileLayout:fs.SpotlightLayout,{}).catch(Xe=>{k.error("Failed to send layout change to widget API",Xe)})},[L]),y.useEffect(()=>{if(rt){const Xe=At=>{Jn("grid"),rt.api.transport.reply(At.detail,{})},Rn=At=>{Jn("spotlight"),rt.api.transport.reply(At.detail,{})};return rt.lazyActions.on(fs.TileLayout,Xe),rt.lazyActions.on(fs.SpotlightLayout,Rn),()=>{rt.lazyActions.off(fs.TileLayout,Xe),rt.lazyActions.off(fs.SpotlightLayout,Rn)}}},[Jn]);const nn=y.useMemo(()=>y.forwardRef(function({className:Rn,style:At,targetWidth:_c,targetHeight:$,model:x},M){const q=jt(e.spotlightExpanded),ee=jt(e.toggleSpotlightExpanded),ae=jt(y.useMemo(()=>x.type==="grid"?e.showGridVideo(x.vm):Ms(!0),[x])),ge=jt(e.showSpeakingIndicators),dt=jt(e.showSpotlightIndicators);return x.type==="grid"?b.jsx(Dfe,{ref:M,vm:x.vm,onOpenProfile:ze,targetWidth:_c,targetHeight:$,className:Pe(Rn,Nr.tile),style:At,showVideo:ae,showSpeakingIndicators:ge}):b.jsx(YL,{ref:M,vms:x.vms,maximised:x.maximised,expanded:q,onToggleExpanded:ee,targetWidth:_c,targetHeight:$,showIndicators:dt,className:Pe(Rn,Nr.tile),style:At})}),[e,ze]),Mr=y.useMemo(()=>{const Xe={minBounds:je,spotlightAlignment:Bt,pipAlignment:_n};return{grid:Wlt(Xe),"spotlight-landscape":lut(Xe),"spotlight-portrait":gut(Xe),"spotlight-expanded":iut(Xe),"one-on-one":eut(Xe)}},[je,Bt,_n]),kn=()=>{if(N.type==="pip")return b.jsx(YL,{className:Pe(Nr.tile,Nr.maximised),vms:N.spotlight,maximised:!0,expanded:!0,onToggleExpanded:null,targetWidth:un.height,targetHeight:un.width,showIndicators:!1});const Xe=Mr[N.type],Rn=b.jsx(Yz,{className:Nr.fixedGrid,style:{insetBlockStart:lt.bottom,height:un.height},model:N,Layout:Xe.fixed,Tile:nn},"fixed"),At=b.jsx(Yz,{className:Nr.scrollingGrid,model:N,Layout:Xe.scrolling,Tile:nn},"scrolling");return N.type==="spotlight-expanded"?b.jsxs(b.Fragment,{children:[Rn,At]}):b.jsxs(b.Fragment,{children:[At,Rn]})},Di=ZQe(r.room.roomId),ar=y.useCallback(()=>{T.setScreenShareEnabled(!w,{audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"}).catch(k.error)},[T,w]);let dn;if(A)dn=null;else{const Xe=[];Xe.push(b.jsx(Sae,{muted:!s.audio.enabled,onClick:C,disabled:s.audio.setEnabled===null,"data-testid":"incall_mute"},"1"),b.jsx(wae,{muted:!s.video.enabled,onClick:I,disabled:s.video.setEnabled===null,"data-testid":"incall_videomute"},"2")),O||(mut&&!S&&Xe.push(b.jsx(Aje,{enabled:w,onClick:ar,"data-testid":"incall_screenshare"},"3")),Xe.push(b.jsx(Tae,{onClick:Oe},"4"))),Xe.push(b.jsx(Eae,{onClick:function(){a()},"data-testid":"incall_leave"},"6")),dn=b.jsxs("div",{ref:Ae,className:Pe(Nr.footer,{[Nr.overlay]:U==="flat",[Nr.hidden]:!X||!_&&c}),children:[!R&&!c&&b.jsxs("div",{className:Nr.logo,children:[b.jsx(Yst,{width:24,height:24,"aria-hidden":!0}),b.jsx(Xst,{width:80,height:11,"aria-label":"Element Call"})]}),_&&b.jsx("div",{className:Nr.buttons,children:Xe}),!R&&_&&b.jsx(Tct,{className:Nr.layout,layout:L,setLayout:Jn,onTouchEnd:K})]})}return b.jsxs("div",{className:Nr.inRoom,ref:v,onTouchStart:F,onTouchEnd:V,onTouchCancel:J,onPointerMove:W,onPointerOut:Y,children:[j&&(c?b.jsx("div",{className:Pe(Nr.header,Nr.filler),ref:et}):b.jsxs(Af,{className:Nr.header,ref:et,children:[b.jsx(Bp,{children:b.jsx(bae,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==En.NONE,participantCount:o})}),b.jsx(jp,{children:!O&&_&&u!==null&&b.jsx(Dde,{onClick:u})})]})),b.jsx(wst,{}),kn(),dn,!A&&b.jsx(uct,{...Di}),b.jsx(C9,{client:t,roomId:r.room.roomId,open:ce,onDismiss:De,tab:Te,onTabChange:Re})]})},but=8,Sut={enabled:!1,setEnabled:null};function Xz(t,e){const[n,r]=L9(i=>t.available.length>0?i??e():void 0,[t]);return y.useMemo(()=>t.available.length===0?Sut:{enabled:n??!1,setEnabled:r},[t,n,r])}function wut(){const t=rS(),e=Xz(t.audioInput,()=>!0),n=Xz(t.videoInput,()=>!0);y.useEffect(()=>{rt==null||rt.api.transport.send(fs.DeviceMute,{audio_enabled:e.enabled,video_enabled:n.enabled}).catch(i=>k.warn("Could not send DeviceMute action to widget",i))},[e,n]);const r=y.useCallback(i=>{var o,a;const s={audio_enabled:e.enabled,video_enabled:n.enabled};i.detail.data.audio_enabled!=null&&typeof i.detail.data.audio_enabled=="boolean"&&((o=e.setEnabled)==null||o.call(e,i.detail.data.audio_enabled),s.audio_enabled=i.detail.data.audio_enabled),i.detail.data.video_enabled!=null&&typeof i.detail.data.video_enabled=="boolean"&&((a=n.setEnabled)==null||a.call(n,i.detail.data.video_enabled),s.video_enabled=i.detail.data.video_enabled),rt.api.transport.reply(i.detail,s)},[e,n]);return y.useEffect(()=>{if(rt)return rt.lazyActions.on(fs.DeviceMute,r),()=>{rt==null||rt.lazyActions.off(fs.DeviceMute,r)}},[r]),y.useMemo(()=>({audio:e,video:n}),[e,n])}function Eut(t){const[e,n]=y.useState(t.memberships),r=y.useCallback(()=>{k.info(`Memberships changed for call in room ${t.room.roomId} (${t.memberships.length} members)`),n(t.memberships)},[t]);return y.useEffect(()=>(t.on(Su.MembershipsChanged,r),()=>{t.off(Su.MembershipsChanged,r)}),[t,r]),e}const Tut="org.matrix.msc4143.rtc_foci";function Cut(){return{type:"livekit",focus_selection:"oldest_membership"}}async function kut(t,e){var o,a;k.log("Start building foci_preferred list: ",t.room.roomId);const n=[],r=t.getFocusInUse();r&&hM(r)&&(k.log("Adding livekit focus from oldest member: ",r),n.push(r));const i=(o=t.room.client.getClientWellKnown())==null?void 0:o[Tut];Array.isArray(i)&&n.push(...i.filter(c=>!!c).filter(HJ).map(c=>(k.log("Adding livekit focus from well known: ",c),{...c,livekit_alias:e})));const s=(a=on.get().livekit)==null?void 0:a.livekit_service_url;if(s){const c={type:"livekit",livekit_service_url:s,livekit_alias:e};k.log("Adding livekit focus from config: ",c),n.push(c)}if(n.length===0)throw new Error(`No livekit_service_url is configured so we could not create a focus.
    Currently we skip computing a focus based on other users in the room.`);return Promise.resolve(n)}async function ME(t,e){var i;zt.instance.eventCallEnded.cacheStartCall(new Date),zt.instance.eventCallStarted.track(t.room.roomId);const n=t.room.roomId,r=(i=on.get().features)==null?void 0:i.feature_use_device_session_member_events;t.joinRoomSession(await kut(t,n),Cut(),{manageMediaKeys:e,...r!==void 0&&{useLegacyMemberEvents:!r}})}const Rut=async t=>{await new Promise(e=>window.setTimeout(e,10)),zt.instance.logout();try{await t.api.setAlwaysOnScreen(!1)}catch(e){k.error("Failed to set call widget `alwaysOnScreen` to false",e)}await t.api.transport.send(fs.HangupCall,{})};async function Zz(t){await t.leaveRoomSession(),rt&&await Rut(rt)}function Iut(t){const[e,n]=y.useState(t.isJoined()),r=y.useCallback(i=>{k.info(`Session in room ${t.room.roomId} changed to ${i?"joined":"left"}`),n(i)},[t]);return y.useEffect(()=>(t.on(Su.JoinStateChanged,r),()=>{t.off(Su.JoinStateChanged,r)}),[t,r]),e}const ehe=(t,e)=>{const[n,r]=y.useState(0);return _ae(t,xt.Update,y.useCallback(()=>r(i=>i+1),[r])),y.useMemo(()=>e(t.currentState),[t,e,n])};function xut(t){return ehe(t,y.useCallback(()=>t.getMxcAvatarUrl(),[t]))}function Put(t){const[,e]=y.useState(0);return _ae(t,ct.Name,()=>e(n=>n+1)),t.name}function Out(t){return ehe(t,y.useCallback(e=>e.getJoinRule(),[]))}var Mut=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<t.rangeCount;r++)n.push(t.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(i){t.addRange(i)}),e&&e.focus()}},Aut=Mut,Qz={"text/plain":"Text","text/html":"Url",default:"Text"},Lut="Copy to clipboard: #{key}, Enter";function Dut(t){var e=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}function Nut(t,e){var n,r,i,s,o,a,c=!1;e||(e={}),n=e.debug||!1;try{i=Aut(),s=document.createRange(),o=document.getSelection(),a=document.createElement("span"),a.textContent=t,a.ariaHidden="true",a.style.all="unset",a.style.position="fixed",a.style.top=0,a.style.clip="rect(0, 0, 0, 0)",a.style.whiteSpace="pre",a.style.webkitUserSelect="text",a.style.MozUserSelect="text",a.style.msUserSelect="text",a.style.userSelect="text",a.addEventListener("copy",function(u){if(u.stopPropagation(),e.format)if(u.preventDefault(),typeof u.clipboardData>"u"){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=Qz[e.format]||Qz.default;window.clipboardData.setData(d,t)}else u.clipboardData.clearData(),u.clipboardData.setData(e.format,t);e.onCopy&&(u.preventDefault(),e.onCopy(u.clipboardData))}),document.body.appendChild(a),s.selectNodeContents(a),o.addRange(s);var l=document.execCommand("copy");if(!l)throw new Error("copy command was unsuccessful");c=!0}catch(u){n&&console.error("unable to copy using execCommand: ",u),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",t),e.onCopy&&e.onCopy(window.clipboardData),c=!0}catch(d){n&&console.error("unable to copy using clipboardData: ",d),n&&console.error("falling back to prompt"),r=Dut("message"in e?e.message:Lut),window.prompt(r,t)}}finally{o&&(typeof o.removeRange=="function"?o.removeRange(s):o.removeAllRanges()),a&&document.body.removeChild(a),i()}return c}var Uut=Nut;const $ut=es(Uut);function Fut(t,e){var n=y.useState(!1),r=n[0],i=n[1],s=e;return y.useEffect(function(){if(r&&s){var o=setTimeout(function(){i(!1)},s);return function(){clearTimeout(o)}}},[r,s]),[r,function(){var o=$ut(t);i(o)}]}const But="_url_hvpyk_8",jut="_button_hvpyk_15",Hut="_qrCode_hvpyk_19",d6={url:But,button:jut,qrCode:Hut},Kut="_toast_1bh34_8",Vut={toast:Kut},qut=({open:t,onDismiss:e,autoDismiss:n,children:r,Icon:i})=>{const s=y.useCallback(o=>{o||e()},[e]);return y.useEffect(()=>{if(t&&n!==void 0){const o=setTimeout(e,n);return()=>clearTimeout(o)}},[t,n,e]),b.jsx(p9,{open:t,onOpenChange:s,children:b.jsxs(g9,{children:[b.jsx(m9,{className:Pe(Gc.bg,Gc.animate)}),b.jsx(v9,{"aria-describedby":void 0,asChild:!0,children:b.jsxs(_9,{className:Pe(Gc.overlay,Gc.animate,Vut.toast),children:[b.jsx(y9,{asChild:!0,children:b.jsx(Mn,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&b.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]})})};var Gut=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},the={},Fo={};let Z9;const zut=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];Fo.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return e*4+17};Fo.getSymbolTotalCodewords=function(e){return zut[e]};Fo.getBCHDigit=function(t){let e=0;for(;t!==0;)e++,t>>>=1;return e};Fo.setToSJISFunction=function(e){if(typeof e!="function")throw new Error('"toSJISFunc" is not a valid function.');Z9=e};Fo.isKanjiModeEnabled=function(){return typeof Z9<"u"};Fo.toSJIS=function(e){return Z9(e)};var UI={};(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,i){if(t.isValid(r))return r;try{return e(r)}catch{return i}}})(UI);function nhe(){this.buffer=[],this.length=0}nhe.prototype={get:function(t){const e=Math.floor(t/8);return(this.buffer[e]>>>7-t%8&1)===1},put:function(t,e){for(let n=0;n<e;n++)this.putBit((t>>>e-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var Wut=nhe;function fS(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}fS.prototype.set=function(t,e,n,r){const i=t*this.size+e;this.data[i]=n,r&&(this.reservedBit[i]=!0)};fS.prototype.get=function(t,e){return this.data[t*this.size+e]};fS.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n};fS.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]};var Yut=fS,rhe={};(function(t){const e=Fo.getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},t.getPositions=function(r){const i=[],s=t.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}})(rhe);var ihe={};const Jut=Fo.getSymbolSize,eW=7;ihe.getPositions=function(e){const n=Jut(e);return[[0,0],[n-eW,0],[0,n-eW]]};var she={};(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},t.from=function(i){return t.isValid(i)?parseInt(i,10):void 0},t.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,l=null,u=null;for(let d=0;d<s;d++){a=c=0,l=u=null;for(let f=0;f<s;f++){let p=i.get(d,f);p===l?a++:(a>=5&&(o+=e.N1+(a-5)),l=p,a=1),p=i.get(f,d),p===u?c++:(c>=5&&(o+=e.N1+(c-5)),u=p,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},t.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const l=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(l===4||l===0)&&o++}return o*e.N2},t.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let l=0;l<s;l++){a=c=0;for(let u=0;u<s;u++)a=a<<1&2047|i.get(l,u),u>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(u,l),u>=10&&(c===1488||c===93)&&o++}return o*e.N3},t.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function n(r,i,s){switch(r){case t.Patterns.PATTERN000:return(i+s)%2===0;case t.Patterns.PATTERN001:return i%2===0;case t.Patterns.PATTERN010:return s%3===0;case t.Patterns.PATTERN011:return(i+s)%3===0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case t.Patterns.PATTERN101:return i*s%2+i*s%3===0;case t.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case t.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,n(i,c,a))},t.getBestMask=function(i,s){const o=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<o;l++){s(l),t.applyMask(l,i);const u=t.getPenaltyN1(i)+t.getPenaltyN2(i)+t.getPenaltyN3(i)+t.getPenaltyN4(i);t.applyMask(l,i),u<c&&(c=u,a=l)}return a}})(she);var $I={};const Fd=UI,AE=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],LE=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];$I.getBlocksCount=function(e,n){switch(n){case Fd.L:return AE[(e-1)*4+0];case Fd.M:return AE[(e-1)*4+1];case Fd.Q:return AE[(e-1)*4+2];case Fd.H:return AE[(e-1)*4+3];default:return}};$I.getTotalCodewordsCount=function(e,n){switch(n){case Fd.L:return LE[(e-1)*4+0];case Fd.M:return LE[(e-1)*4+1];case Fd.Q:return LE[(e-1)*4+2];case Fd.H:return LE[(e-1)*4+3];default:return}};var ohe={},FI={};const F0=new Uint8Array(512),h2=new Uint8Array(256);(function(){let e=1;for(let n=0;n<255;n++)F0[n]=e,h2[e]=n,e<<=1,e&256&&(e^=285);for(let n=255;n<512;n++)F0[n]=F0[n-255]})();FI.log=function(e){if(e<1)throw new Error("log("+e+")");return h2[e]};FI.exp=function(e){return F0[e]};FI.mul=function(e,n){return e===0||n===0?0:F0[h2[e]+h2[n]]};(function(t){const e=FI;t.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},t.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},t.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=t.mul(i,new Uint8Array([1,e.exp(s)]));return i}})(ohe);const ahe=ohe;function Q9(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}Q9.prototype.initialize=function(e){this.degree=e,this.genPoly=ahe.generateECPolynomial(this.degree)};Q9.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(e.length+this.degree);n.set(e);const r=ahe.mod(n,this.genPoly),i=this.degree-r.length;if(i>0){const s=new Uint8Array(this.degree);return s.set(r,i),s}return r};var Xut=Q9,che={},Uf={},e7={};e7.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40};var _l={};const lhe="[0-9]+",Zut="[A-Z $%*+\\-./:]+";let cb="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";cb=cb.replace(/u/g,"\\u");const Qut="(?:(?![A-Z0-9 $%*+\\-./:]|"+cb+`)(?:.|[\r
]))+`;_l.KANJI=new RegExp(cb,"g");_l.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");_l.BYTE=new RegExp(Qut,"g");_l.NUMERIC=new RegExp(lhe,"g");_l.ALPHANUMERIC=new RegExp(Zut,"g");const edt=new RegExp("^"+cb+"$"),tdt=new RegExp("^"+lhe+"$"),ndt=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");_l.testKanji=function(e){return edt.test(e)};_l.testNumeric=function(e){return tdt.test(e)};_l.testAlphanumeric=function(e){return ndt.test(e)};(function(t){const e=e7,n=_l;t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},t.getBestModeForData=function(s){return n.testNumeric(s)?t.NUMERIC:n.testAlphanumeric(s)?t.ALPHANUMERIC:n.testKanji(s)?t.KANJI:t.BYTE},t.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},t.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+i)}}t.from=function(s,o){if(t.isValid(s))return s;try{return r(s)}catch{return o}}})(Uf);(function(t){const e=Fo,n=$I,r=UI,i=Uf,s=e7,o=7973,a=e.getBCHDigit(o);function c(f,p,m){for(let v=1;v<=40;v++)if(p<=t.getCapacity(v,m,f))return v}function l(f,p){return i.getCharCountIndicator(f,p)+4}function u(f,p){let m=0;return f.forEach(function(v){const S=l(v.mode,p);m+=S+v.getBitsLength()}),m}function d(f,p){for(let m=1;m<=40;m++)if(u(f,m)<=t.getCapacity(m,p,i.MIXED))return m}t.from=function(p,m){return s.isValid(p)?parseInt(p,10):m},t.getCapacity=function(p,m,v){if(!s.isValid(p))throw new Error("Invalid QR Code version");typeof v>"u"&&(v=i.BYTE);const S=e.getSymbolTotalCodewords(p),_=n.getTotalCodewordsCount(p,m),w=(S-_)*8;if(v===i.MIXED)return w;const T=w-l(v,p);switch(v){case i.NUMERIC:return Math.floor(T/10*3);case i.ALPHANUMERIC:return Math.floor(T/11*2);case i.KANJI:return Math.floor(T/13);case i.BYTE:default:return Math.floor(T/8)}},t.getBestVersionForData=function(p,m){let v;const S=r.from(m,r.M);if(Array.isArray(p)){if(p.length>1)return d(p,S);if(p.length===0)return 1;v=p[0]}else v=p;return c(v.mode,v.getLength(),S)},t.getEncodedBits=function(p){if(!s.isValid(p)||p<7)throw new Error("Invalid QR Code version");let m=p<<12;for(;e.getBCHDigit(m)-a>=0;)m^=o<<e.getBCHDigit(m)-a;return p<<12|m}})(che);var uhe={};const JL=Fo,dhe=1335,rdt=21522,tW=JL.getBCHDigit(dhe);uhe.getEncodedBits=function(e,n){const r=e.bit<<3|n;let i=r<<10;for(;JL.getBCHDigit(i)-tW>=0;)i^=dhe<<JL.getBCHDigit(i)-tW;return(r<<10|i)^rdt};var fhe={};const idt=Uf;function xv(t){this.mode=idt.NUMERIC,this.data=t.toString()}xv.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)};xv.prototype.getLength=function(){return this.data.length};xv.prototype.getBitsLength=function(){return xv.getBitsLength(this.data.length)};xv.prototype.write=function(e){let n,r,i;for(n=0;n+3<=this.data.length;n+=3)r=this.data.substr(n,3),i=parseInt(r,10),e.put(i,10);const s=this.data.length-n;s>0&&(r=this.data.substr(n),i=parseInt(r,10),e.put(i,s*3+1))};var sdt=xv;const odt=Uf,f6=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function Pv(t){this.mode=odt.ALPHANUMERIC,this.data=t}Pv.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)};Pv.prototype.getLength=function(){return this.data.length};Pv.prototype.getBitsLength=function(){return Pv.getBitsLength(this.data.length)};Pv.prototype.write=function(e){let n;for(n=0;n+2<=this.data.length;n+=2){let r=f6.indexOf(this.data[n])*45;r+=f6.indexOf(this.data[n+1]),e.put(r,11)}this.data.length%2&&e.put(f6.indexOf(this.data[n]),6)};var adt=Pv;const cdt=Uf;function Ov(t){this.mode=cdt.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}Ov.getBitsLength=function(e){return e*8};Ov.prototype.getLength=function(){return this.data.length};Ov.prototype.getBitsLength=function(){return Ov.getBitsLength(this.data.length)};Ov.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)};var ldt=Ov;const udt=Uf,ddt=Fo;function Mv(t){this.mode=udt.KANJI,this.data=t}Mv.getBitsLength=function(e){return e*13};Mv.prototype.getLength=function(){return this.data.length};Mv.prototype.getBitsLength=function(){return Mv.getBitsLength(this.data.length)};Mv.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=ddt.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),t.put(n,13)}};var fdt=Mv,hhe={exports:{}};(function(t){var e={single_source_shortest_paths:function(n,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,u,d,f,p,m,v,S;!a.empty();){c=a.pop(),l=c.value,d=c.cost,f=n[l]||{};for(u in f)f.hasOwnProperty(u)&&(p=f[u],m=d+p,v=o[u],S=typeof o[u]>"u",(S||v>m)&&(o[u]=m,a.push(u,m),s[u]=l))}if(typeof i<"u"&&typeof o[i]>"u"){var _=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(_)}return s},extract_shortest_path_from_predecessor_list:function(n,r){for(var i=[],s=r;s;)i.push(s),n[s],s=n[s];return i.reverse(),i},find_path:function(n,r,i){var s=e.single_source_shortest_paths(n,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,i={},s;n=n||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=n.sorter||r.default_sorter,i},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var i={value:n,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(hhe);var hdt=hhe.exports;(function(t){const e=Uf,n=sdt,r=adt,i=ldt,s=fdt,o=_l,a=Fo,c=hdt;function l(_){return unescape(encodeURIComponent(_)).length}function u(_,w,T){const C=[];let I;for(;(I=_.exec(T))!==null;)C.push({data:I[0],index:I.index,mode:w,length:I[0].length});return C}function d(_){const w=u(o.NUMERIC,e.NUMERIC,_),T=u(o.ALPHANUMERIC,e.ALPHANUMERIC,_);let C,I;return a.isKanjiModeEnabled()?(C=u(o.BYTE,e.BYTE,_),I=u(o.KANJI,e.KANJI,_)):(C=u(o.BYTE_KANJI,e.BYTE,_),I=[]),w.concat(T,C,I).sort(function(O,A){return O.index-A.index}).map(function(O){return{data:O.data,mode:O.mode,length:O.length}})}function f(_,w){switch(w){case e.NUMERIC:return n.getBitsLength(_);case e.ALPHANUMERIC:return r.getBitsLength(_);case e.KANJI:return s.getBitsLength(_);case e.BYTE:return i.getBitsLength(_)}}function p(_){return _.reduce(function(w,T){const C=w.length-1>=0?w[w.length-1]:null;return C&&C.mode===T.mode?(w[w.length-1].data+=T.data,w):(w.push(T),w)},[])}function m(_){const w=[];for(let T=0;T<_.length;T++){const C=_[T];switch(C.mode){case e.NUMERIC:w.push([C,{data:C.data,mode:e.ALPHANUMERIC,length:C.length},{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.ALPHANUMERIC:w.push([C,{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.KANJI:w.push([C,{data:C.data,mode:e.BYTE,length:l(C.data)}]);break;case e.BYTE:w.push([{data:C.data,mode:e.BYTE,length:l(C.data)}])}}return w}function v(_,w){const T={},C={start:{}};let I=["start"];for(let R=0;R<_.length;R++){const O=_[R],A=[];for(let U=0;U<O.length;U++){const N=O[U],L=""+R+U;A.push(L),T[L]={node:N,lastCount:0},C[L]={};for(let j=0;j<I.length;j++){const X=I[j];T[X]&&T[X].node.mode===N.mode?(C[X][L]=f(T[X].lastCount+N.length,N.mode)-f(T[X].lastCount,N.mode),T[X].lastCount+=N.length):(T[X]&&(T[X].lastCount=N.length),C[X][L]=f(N.length,N.mode)+4+e.getCharCountIndicator(N.mode,w))}}I=A}for(let R=0;R<I.length;R++)C[I[R]].end=0;return{map:C,table:T}}function S(_,w){let T;const C=e.getBestModeForData(_);if(T=e.from(w,C),T!==e.BYTE&&T.bit<C.bit)throw new Error('"'+_+'" cannot be encoded with mode '+e.toString(T)+`.
 Suggested mode is: `+e.toString(C));switch(T===e.KANJI&&!a.isKanjiModeEnabled()&&(T=e.BYTE),T){case e.NUMERIC:return new n(_);case e.ALPHANUMERIC:return new r(_);case e.KANJI:return new s(_);case e.BYTE:return new i(_)}}t.fromArray=function(w){return w.reduce(function(T,C){return typeof C=="string"?T.push(S(C,null)):C.data&&T.push(S(C.data,C.mode)),T},[])},t.fromString=function(w,T){const C=d(w,a.isKanjiModeEnabled()),I=m(C),R=v(I,T),O=c.find_path(R.map,"start","end"),A=[];for(let U=1;U<O.length-1;U++)A.push(R.table[O[U]].node);return t.fromArray(p(A))},t.rawSplit=function(w){return t.fromArray(d(w,a.isKanjiModeEnabled()))}})(fhe);const BI=Fo,h6=UI,pdt=Wut,gdt=Yut,mdt=rhe,vdt=ihe,XL=she,ZL=$I,ydt=Xut,p2=che,_dt=uhe,bdt=Uf,p6=fhe;function Sdt(t,e){const n=t.size,r=vdt.getPositions(e);for(let i=0;i<r.length;i++){const s=r[i][0],o=r[i][1];for(let a=-1;a<=7;a++)if(!(s+a<=-1||n<=s+a))for(let c=-1;c<=7;c++)o+c<=-1||n<=o+c||(a>=0&&a<=6&&(c===0||c===6)||c>=0&&c<=6&&(a===0||a===6)||a>=2&&a<=4&&c>=2&&c<=4?t.set(s+a,o+c,!0,!0):t.set(s+a,o+c,!1,!0))}}function wdt(t){const e=t.size;for(let n=8;n<e-8;n++){const r=n%2===0;t.set(n,6,r,!0),t.set(6,n,r,!0)}}function Edt(t,e){const n=mdt.getPositions(e);for(let r=0;r<n.length;r++){const i=n[r][0],s=n[r][1];for(let o=-2;o<=2;o++)for(let a=-2;a<=2;a++)o===-2||o===2||a===-2||a===2||o===0&&a===0?t.set(i+o,s+a,!0,!0):t.set(i+o,s+a,!1,!0)}}function Tdt(t,e){const n=t.size,r=p2.getEncodedBits(e);let i,s,o;for(let a=0;a<18;a++)i=Math.floor(a/3),s=a%3+n-8-3,o=(r>>a&1)===1,t.set(i,s,o,!0),t.set(s,i,o,!0)}function g6(t,e,n){const r=t.size,i=_dt.getEncodedBits(e,n);let s,o;for(s=0;s<15;s++)o=(i>>s&1)===1,s<6?t.set(s,8,o,!0):s<8?t.set(s+1,8,o,!0):t.set(r-15+s,8,o,!0),s<8?t.set(8,r-s-1,o,!0):s<9?t.set(8,15-s-1+1,o,!0):t.set(8,15-s-1,o,!0);t.set(r-8,8,1,!0)}function Cdt(t,e){const n=t.size;let r=-1,i=n-1,s=7,o=0;for(let a=n-1;a>0;a-=2)for(a===6&&a--;;){for(let c=0;c<2;c++)if(!t.isReserved(i,a-c)){let l=!1;o<e.length&&(l=(e[o]>>>s&1)===1),t.set(i,a-c,l),s--,s===-1&&(o++,s=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}function kdt(t,e,n){const r=new pdt;n.forEach(function(c){r.put(c.mode.bit,4),r.put(c.getLength(),bdt.getCharCountIndicator(c.mode,t)),c.write(r)});const i=BI.getSymbolTotalCodewords(t),s=ZL.getTotalCodewordsCount(t,e),o=(i-s)*8;for(r.getLengthInBits()+4<=o&&r.put(0,4);r.getLengthInBits()%8!==0;)r.putBit(0);const a=(o-r.getLengthInBits())/8;for(let c=0;c<a;c++)r.put(c%2?17:236,8);return Rdt(r,t,e)}function Rdt(t,e,n){const r=BI.getSymbolTotalCodewords(e),i=ZL.getTotalCodewordsCount(e,n),s=r-i,o=ZL.getBlocksCount(e,n),a=r%o,c=o-a,l=Math.floor(r/o),u=Math.floor(s/o),d=u+1,f=l-u,p=new ydt(f);let m=0;const v=new Array(o),S=new Array(o);let _=0;const w=new Uint8Array(t.buffer);for(let O=0;O<o;O++){const A=O<c?u:d;v[O]=w.slice(m,m+A),S[O]=p.encode(v[O]),m+=A,_=Math.max(_,A)}const T=new Uint8Array(r);let C=0,I,R;for(I=0;I<_;I++)for(R=0;R<o;R++)I<v[R].length&&(T[C++]=v[R][I]);for(I=0;I<f;I++)for(R=0;R<o;R++)T[C++]=S[R][I];return T}function Idt(t,e,n,r){let i;if(Array.isArray(t))i=p6.fromArray(t);else if(typeof t=="string"){let l=e;if(!l){const u=p6.rawSplit(t);l=p2.getBestVersionForData(u,n)}i=p6.fromString(t,l||40)}else throw new Error("Invalid data");const s=p2.getBestVersionForData(i,n);if(!s)throw new Error("The amount of data is too big to be stored in a QR Code");if(!e)e=s;else if(e<s)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+s+`.
`);const o=kdt(e,n,i),a=BI.getSymbolSize(e),c=new gdt(a);return Sdt(c,e),wdt(c),Edt(c,e),g6(c,n,0),e>=7&&Tdt(c,e),Cdt(c,o),isNaN(r)&&(r=XL.getBestMask(c,g6.bind(null,c,n))),XL.applyMask(r,c),g6(c,n,r),{modules:c,version:e,errorCorrectionLevel:n,maskPattern:r,segments:i}}the.create=function(e,n){if(typeof e>"u"||e==="")throw new Error("No input text");let r=h6.M,i,s;return typeof n<"u"&&(r=h6.from(n.errorCorrectionLevel,h6.M),i=p2.from(n.version),s=XL.from(n.maskPattern),n.toSJISFunc&&BI.setToSJISFunction(n.toSJISFunc)),Idt(e,i,r,s)};var phe={},t7={};(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},t.getImageWidth=function(r,i){const s=t.getScale(r,i);return Math.floor((r+i.margin*2)*s)},t.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,c=t.getScale(o,s),l=Math.floor((o+s.margin*2)*c),u=s.margin*c,d=[s.color.light,s.color.dark];for(let f=0;f<l;f++)for(let p=0;p<l;p++){let m=(f*l+p)*4,v=s.color.light;if(f>=u&&p>=u&&f<l-u&&p<l-u){const S=Math.floor((f-u)/c),_=Math.floor((p-u)/c);v=d[a[S*o+_]?1:0]}r[m++]=v.r,r[m++]=v.g,r[m++]=v.b,r[m]=v.a}}})(t7);(function(t){const e=t7;function n(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(s,o,a){let c=a,l=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(l=r()),c=e.getOptions(c);const u=e.getImageWidth(s.modules.size,c),d=l.getContext("2d"),f=d.createImageData(u,u);return e.qrToImageData(f.data,s,c),n(d,l,u),d.putImageData(f,0,0),l},t.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const l=t.render(s,o,c),u=c.type||"image/png",d=c.rendererOpts||{};return l.toDataURL(u,d.quality)}})(phe);var ghe={};const xdt=t7;function nW(t,e){const n=t.a/255,r=e+'="'+t.hex+'"';return n<1?r+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function m6(t,e,n){let r=t+e;return typeof n<"u"&&(r+=" "+n),r}function Pdt(t,e,n){let r="",i=0,s=!1,o=0;for(let a=0;a<t.length;a++){const c=Math.floor(a%e),l=Math.floor(a/e);!c&&!s&&(s=!0),t[a]?(o++,a>0&&c>0&&t[a-1]||(r+=s?m6("M",c+n,.5+l+n):m6("m",i,0),i=0,s=!1),c+1<e&&t[a+1]||(r+=m6("h",o),o=0)):i++}return r}ghe.render=function(e,n,r){const i=xdt.getOptions(n),s=e.modules.size,o=e.modules.data,a=s+i.margin*2,c=i.color.light.a?"<path "+nW(i.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",l="<path "+nW(i.color.dark,"stroke")+' d="'+Pdt(o,s,i.margin)+'"/>',u='viewBox="0 0 '+a+" "+a+'"',f='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+u+' shape-rendering="crispEdges">'+c+l+`</svg>
`;return typeof r=="function"&&r(null,f),f};const Odt=Gut,QL=the,mhe=phe,Mdt=ghe;function n7(t,e,n,r,i){const s=[].slice.call(arguments,1),o=s.length,a=typeof s[o-1]=="function";if(!a&&!Odt())throw new Error("Callback required as last argument");if(a){if(o<2)throw new Error("Too few arguments provided");o===2?(i=n,n=e,e=r=void 0):o===3&&(e.getContext&&typeof i>"u"?(i=r,r=void 0):(i=r,r=n,n=e,e=void 0))}else{if(o<1)throw new Error("Too few arguments provided");return o===1?(n=e,e=r=void 0):o===2&&!e.getContext&&(r=n,n=e,e=void 0),new Promise(function(c,l){try{const u=QL.create(n,r);c(t(u,e,r))}catch(u){l(u)}})}try{const c=QL.create(n,r);i(null,t(c,e,r))}catch(c){i(c)}}QL.create;n7.bind(null,mhe.render);var Adt=n7.bind(null,mhe.renderToDataURL);n7.bind(null,function(t,e,n){return Mdt.render(t,n)});const Ldt={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console&&console[t]&&console[t].apply(console,e)}};class g2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||Ldt,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,r,i){return i&&!this.debug?null:(typeof e[0]=="string"&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new g2(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new g2(this.logger,e)}}var tl=new g2;class jI{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(n)||0;this.observers[r].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,c]=o;for(let l=0;l<c;l++)a.apply(a,[e,...r])})}}const T1=()=>{let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n},rW=t=>t==null?"":""+t,Ddt=(t,e,n)=>{t.forEach(r=>{e[r]&&(n[r]=e[r])})},Ndt=/###/g,iW=t=>t&&t.indexOf("###")>-1?t.replace(Ndt,"."):t,sW=t=>!t||typeof t=="string",B0=(t,e,n)=>{const r=typeof e!="string"?e:e.split(".");let i=0;for(;i<r.length-1;){if(sW(t))return{};const s=iW(r[i]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++i}return sW(t)?{}:{obj:t,k:iW(r[i])}},oW=(t,e,n)=>{const{obj:r,k:i}=B0(t,e,Object);if(r!==void 0||e.length===1){r[i]=n;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=B0(t,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=B0(t,o,Object),a&&a.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=n},Udt=(t,e,n,r)=>{const{obj:i,k:s}=B0(t,e,Object);i[s]=i[s]||[],i[s].push(n)},m2=(t,e)=>{const{obj:n,k:r}=B0(t,e);if(n)return n[r]},$dt=(t,e,n)=>{const r=m2(t,n);return r!==void 0?r:m2(e,n)},vhe=(t,e,n)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?typeof t[r]=="string"||t[r]instanceof String||typeof e[r]=="string"||e[r]instanceof String?n&&(t[r]=e[r]):vhe(t[r],e[r],n):t[r]=e[r]);return t},Ig=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var Fdt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Bdt=t=>typeof t=="string"?t.replace(/[&<>"'\/]/g,e=>Fdt[e]):t;class jdt{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const Hdt=[" ",",","?","!",";"],Kdt=new jdt(20),Vdt=(t,e,n)=>{e=e||"",n=n||"";const r=Hdt.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(r.length===0)return!0;const i=Kdt.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!i.test(t);if(!s){const o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s},e4=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return t[e];const r=e.split(n);let i=t;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let o,a="";for(let c=s;c<r.length;++c)if(c!==s&&(a+=n),a+=r[c],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<r.length-1)continue;s+=c-s+1;break}i=o}return i},v2=t=>t&&t.indexOf("_")>0?t.replace("_","-"):t;class aW extends jI{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],r&&(Array.isArray(r)?a.push(...r):typeof r=="string"&&s?a.push(...r.split(s)):a.push(r)));const c=m2(this.data,a);return!c&&!n&&!r&&e.indexOf(".")>-1&&(e=a[0],n=a[1],r=a.slice(2).join(".")),c||!o||typeof r!="string"?c:e4(this.data&&this.data[e]&&this.data[e][n],r,s)}addResource(e,n,r,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,n];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),i=n,n=a[1]),this.addNamespaces(n),oW(this.data,a,i),s.silent||this.emit("added",e,n,r,i)}addResources(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const s in r)(typeof r[s]=="string"||Array.isArray(r[s]))&&this.addResource(e,n,s,r[s],{silent:!0});i.silent||this.emit("added",e,n,r)}addResourceBundle(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),i=r,r=n,n=a[1]),this.addNamespaces(n);let c=m2(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?vhe(c,r,s):c={...c,...r},oW(this.data,a,c),o.silent||this.emit("added",e,n,r)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,n)}:this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var yhe={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,r,i){return t.forEach(s=>{this.processors[s]&&(e=this.processors[s].process(e,n,r,i))}),e}};const cW={};class y2 extends jI{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ddt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=tl.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,n);return r&&r.res!==void 0}extractFromKey(e,n){let r=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!Vdt(e,r,i);if(o&&!a){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:s};const l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(i)}return typeof s=="string"&&(s=[s]),{key:e,namespaces:s}}translate(e,n,r){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const i=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,s=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),c=a[a.length-1],l=n.lng||this.language,u=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(l&&l.toLowerCase()==="cimode"){if(u){const C=n.nsSeparator||this.options.nsSeparator;return i?{res:`${c}${C}${o}`,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:`${c}${C}${o}`}return i?{res:o,usedKey:o,exactUsedKey:o,usedLng:l,usedNS:c,usedParams:this.getUsedParamsDetails(n)}:o}const d=this.resolve(e,n);let f=d&&d.res;const p=d&&d.usedKey||o,m=d&&d.exactUsedKey||o,v=Object.prototype.toString.apply(f),S=["[object Number]","[object Function]","[object RegExp]"],_=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject;if(w&&f&&(typeof f!="string"&&typeof f!="boolean"&&typeof f!="number")&&S.indexOf(v)<0&&!(typeof _=="string"&&Array.isArray(f))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const C=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,f,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return i?(d.res=C,d.usedParams=this.getUsedParamsDetails(n),d):C}if(s){const C=Array.isArray(f),I=C?[]:{},R=C?m:p;for(const O in f)if(Object.prototype.hasOwnProperty.call(f,O)){const A=`${R}${s}${O}`;I[O]=this.translate(A,{...n,joinArrays:!1,ns:a}),I[O]===A&&(I[O]=f[O])}f=I}}else if(w&&typeof _=="string"&&Array.isArray(f))f=f.join(_),f&&(f=this.extendTranslation(f,e,n,r));else{let C=!1,I=!1;const R=n.count!==void 0&&typeof n.count!="string",O=y2.hasDefaultValue(n),A=R?this.pluralResolver.getSuffix(l,n.count,n):"",U=n.ordinal&&R?this.pluralResolver.getSuffix(l,n.count,{ordinal:!1}):"",N=R&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),L=N&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${A}`]||n[`defaultValue${U}`]||n.defaultValue;!this.isValidLookup(f)&&O&&(C=!0,f=L),this.isValidLookup(f)||(I=!0,f=o);const X=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&I?void 0:f,G=O&&L!==f&&this.options.updateMissing;if(I||C||G){if(this.logger.log(G?"updateKey":"missingKey",l,c,o,G?L:f),s){const K=this.resolve(o,{...n,keySeparator:!1});K&&K.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let F=[];const V=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&V&&V[0])for(let K=0;K<V.length;K++)F.push(V[K]);else this.options.saveMissingTo==="all"?F=this.languageUtils.toResolveHierarchy(n.lng||this.language):F.push(n.lng||this.language);const J=(K,W,Y)=>{const ce=O&&Y!==f?Y:X;this.options.missingKeyHandler?this.options.missingKeyHandler(K,c,W,ce,G,n):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(K,c,W,ce,G,n),this.emit("missingKey",K,c,W,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?F.forEach(K=>{const W=this.pluralResolver.getSuffixes(K,n);N&&n[`defaultValue${this.options.pluralSeparator}zero`]&&W.indexOf(`${this.options.pluralSeparator}zero`)<0&&W.push(`${this.options.pluralSeparator}zero`),W.forEach(Y=>{J([K],o+Y,n[`defaultValue${Y}`]||L)})}):J(F,o,L))}f=this.extendTranslation(f,e,n,d,r),I&&f===o&&this.options.appendNamespaceToMissingKey&&(f=`${c}:${o}`),(I||C)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?f=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}:${o}`:o,C?f:void 0):f=this.options.parseMissingKeyHandler(f))}return i?(d.res=f,d.usedParams=this.getUsedParamsDetails(n),d):f}extendTranslation(e,n,r,i,s){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=typeof e=="string"&&(r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(l){const f=e.match(this.interpolator.nestingRegexp);u=f&&f.length}let d=r.replace&&typeof r.replace!="string"?r.replace:r;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,r.lng||this.language||i.usedLng,r),l){const f=e.match(this.interpolator.nestingRegexp),p=f&&f.length;u<p&&(r.nest=!1)}!r.lng&&this.options.compatibilityAPI!=="v1"&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var f=arguments.length,p=new Array(f),m=0;m<f;m++)p[m]=arguments[m];return s&&s[0]===p[0]&&!r.context?(o.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${n[0]}`),null):o.translate(...p,n)},r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,c=typeof a=="string"?[a]:a;return e!=null&&c&&c.length&&r.applyPostProcessor!==!1&&(e=yhe.handle(c,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,i,s,o,a;return typeof e=="string"&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(c,n),u=l.key;i=u;let d=l.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const f=n.count!==void 0&&typeof n.count!="string",p=f&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),m=n.context!==void 0&&(typeof n.context=="string"||typeof n.context=="number")&&n.context!=="",v=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);d.forEach(S=>{this.isValidLookup(r)||(a=S,!cW[`${v[0]}-${S}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(cW[`${v[0]}-${S}`]=!0,this.logger.warn(`key "${i}" for languages "${v.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(_=>{if(this.isValidLookup(r))return;o=_;const w=[u];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(w,u,_,S,n);else{let C;f&&(C=this.pluralResolver.getSuffix(_,n.count,n));const I=`${this.options.pluralSeparator}zero`,R=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(f&&(w.push(u+C),n.ordinal&&C.indexOf(R)===0&&w.push(u+C.replace(R,this.options.pluralSeparator)),p&&w.push(u+I)),m){const O=`${u}${this.options.contextSeparator}${n.context}`;w.push(O),f&&(w.push(O+C),n.ordinal&&C.indexOf(R)===0&&w.push(O+C.replace(R,this.options.pluralSeparator)),p&&w.push(O+I))}}let T;for(;T=w.pop();)this.isValidLookup(r)||(s=T,r=this.getResource(_,S,T,n))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,n,r,i):this.resourceStore.getResource(e,n,r,i)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&typeof e.replace!="string";let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of n)delete i[s]}return i}static hasDefaultValue(e){const n="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n===r.substring(0,n.length)&&e[r]!==void 0)return!0;return!1}}const v6=t=>t.charAt(0).toUpperCase()+t.slice(1);class lW{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=tl.create("languageUtils")}getScriptPartFromCode(e){if(e=v2(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=v2(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(typeof e=="string"&&e.indexOf("-")>-1){const n=["hans","hant","latn","cyrl","cans","mong","arab"];let r=e.split("-");return this.options.lowerCaseLng?r=r.map(i=>i.toLowerCase()):r.length===2?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),n.indexOf(r[1].toLowerCase())>-1&&(r[1]=v6(r[1].toLowerCase()))):r.length===3&&(r[0]=r[0].toLowerCase(),r[1].length===2&&(r[1]=r[1].toUpperCase()),r[0]!=="sgn"&&r[2].length===2&&(r[2]=r[2].toUpperCase()),n.indexOf(r[1].toLowerCase())>-1&&(r[1]=v6(r[1].toLowerCase())),n.indexOf(r[2].toLowerCase())>-1&&(r[2]=v6(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(r=>{if(n)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(r=>{if(n)return;const i=this.getLanguagePartFromCode(r);if(this.isSupportedCode(i))return n=i;n=this.options.supportedLngs.find(s=>{if(s===i)return s;if(!(s.indexOf("-")<0&&i.indexOf("-")<0)&&(s.indexOf("-")>0&&i.indexOf("-")<0&&s.substring(0,s.indexOf("-"))===i||s.indexOf(i)===0&&i.length>1))return s})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),typeof e=="string"&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let r=e[n];return r||(r=e[this.getScriptPartFromCode(n)]),r||(r=e[this.formatLanguageCode(n)]),r||(r=e[this.getLanguagePartFromCode(n)]),r||(r=e.default),r||[]}toResolveHierarchy(e,n){const r=this.getFallbackCodes(n||this.options.fallbackLng||[],e),i=[],s=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return typeof e=="string"&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):typeof e=="string"&&s(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&s(this.formatLanguageCode(o))}),i}}let qdt=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Gdt={1:t=>+(t>1),2:t=>+(t!=1),3:t=>0,4:t=>t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,5:t=>t==0?0:t==1?1:t==2?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5,6:t=>t==1?0:t>=2&&t<=4?1:2,7:t=>t==1?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,8:t=>t==1?0:t==2?1:t!=8&&t!=11?2:3,9:t=>+(t>=2),10:t=>t==1?0:t==2?1:t<7?2:t<11?3:4,11:t=>t==1||t==11?0:t==2||t==12?1:t>2&&t<20?2:3,12:t=>+(t%10!=1||t%100==11),13:t=>+(t!==0),14:t=>t==1?0:t==2?1:t==3?2:3,15:t=>t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2,16:t=>t%10==1&&t%100!=11?0:t!==0?1:2,17:t=>t==1||t%10==1&&t%100!=11?0:1,18:t=>t==0?0:t==1?1:2,19:t=>t==1?0:t==0||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3,20:t=>t==1?0:t==0||t%100>0&&t%100<20?1:2,21:t=>t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0,22:t=>t==1?0:t==2?1:(t<0||t>10)&&t%10==0?2:3};const zdt=["v1","v2","v3"],Wdt=["v4"],uW={zero:0,one:1,two:2,few:3,many:4,other:5},Ydt=()=>{const t={};return qdt.forEach(e=>{e.lngs.forEach(n=>{t[n]={numbers:e.nr,plurals:Gdt[e.fc]}})}),t};class Jdt{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=tl.create("pluralResolver"),(!this.options.compatibilityJSON||Wdt.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Ydt(),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{const r=v2(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];const o=new Intl.PluralRules(r,{type:i});return this.pluralRulesCache[s]=o,o}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,n);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(i=>`${n}${i}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((i,s)=>uW[i]-uW[s]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):r.numbers.map(i=>this.getSuffix(e,i,n)):[]}getSuffix(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=this.getRule(e,r);return i?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:this.getSuffixRetroCompatible(i,n):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,n){const r=e.noAbs?e.plurals(n):e.plurals(Math.abs(n));let i=e.numbers[r];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(i===2?i="plural":i===1&&(i=""));const s=()=>this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString();return this.options.compatibilityJSON==="v1"?i===1?"":typeof i=="number"?`_plural_${i.toString()}`:s():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?s():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!zdt.includes(this.options.compatibilityJSON)}}const dW=function(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=$dt(t,e,n);return!s&&i&&typeof n=="string"&&(s=e4(t,n,r),s===void 0&&(s=e4(e,n,r))),s},y6=t=>t.replace(/\$/g,"$$$$");class Xdt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=tl.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:c,formatSeparator:l,unescapeSuffix:u,unescapePrefix:d,nestingPrefix:f,nestingPrefixEscaped:p,nestingSuffix:m,nestingSuffixEscaped:v,nestingOptionsSeparator:S,maxReplaces:_,alwaysFormat:w}=e.interpolation;this.escape=n!==void 0?n:Bdt,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?Ig(s):o||"{{",this.suffix=a?Ig(a):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=u?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=f?Ig(f):p||Ig("$t("),this.nestingSuffix=m?Ig(m):v||Ig(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=_||1e3,this.alwaysFormat=w!==void 0?w:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,r)=>n&&n.source===r?(n.lastIndex=0,n):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,r,i){let s,o,a;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=p=>{if(p.indexOf(this.formatSeparator)<0){const _=dW(n,c,p,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(_,void 0,r,{...i,...n,interpolationkey:p}):_}const m=p.split(this.formatSeparator),v=m.shift().trim(),S=m.join(this.formatSeparator).trim();return this.format(dW(n,c,v,this.options.keySeparator,this.options.ignoreJSONStructure),S,r,{...i,...n,interpolationkey:v})};this.resetRegExp();const u=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,d=i&&i.interpolation&&i.interpolation.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:p=>y6(p)},{regex:this.regexp,safeValue:p=>this.escapeValue?y6(this.escape(p)):y6(p)}].forEach(p=>{for(a=0;s=p.regex.exec(e);){const m=s[1].trim();if(o=l(m),o===void 0)if(typeof u=="function"){const S=u(e,s,i);o=typeof S=="string"?S:""}else if(i&&Object.prototype.hasOwnProperty.call(i,m))o="";else if(d){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${m} for interpolating ${e}`),o="";else typeof o!="string"&&!this.useRawValueToEscape&&(o=rW(o));const v=p.safeValue(o);if(e=e.replace(s[0],v),d?(p.regex.lastIndex+=o.length,p.regex.lastIndex-=s[0].length):p.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i,s,o;const a=(c,l)=>{const u=this.nestingOptionsSeparator;if(c.indexOf(u)<0)return c;const d=c.split(new RegExp(`${u}[ ]*{`));let f=`{${d[1]}`;c=d[0],f=this.interpolate(f,o);const p=f.match(/'/g),m=f.match(/"/g);(p&&p.length%2===0&&!m||m.length%2!==0)&&(f=f.replace(/'/g,'"'));try{o=JSON.parse(f),l&&(o={...l,...o})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,v),`${c}${u}${f}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];o={...r},o=o.replace&&typeof o.replace!="string"?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let l=!1;if(i[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(i[1])){const u=i[1].split(this.formatSeparator).map(d=>d.trim());i[1]=u.shift(),c=u,l=!0}if(s=n(a.call(this,i[1].trim(),o),o),s&&i[0]===e&&typeof s!="string")return s;typeof s!="string"&&(s=rW(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),l&&(s=c.reduce((u,d)=>this.format(u,d,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const Zdt=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...c]=o.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),u=a.trim();n[u]||(n[u]=l),l==="false"&&(n[u]=!1),l==="true"&&(n[u]=!0),isNaN(l)||(n[u]=parseInt(l,10))}})}return{formatName:e,formatOptions:n}},xg=t=>{const e={};return(n,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const o=r+JSON.stringify(s);let a=e[o];return a||(a=t(v2(r),i),e[o]=a),a(n)}};class Qdt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=tl.create("formatter"),this.options=e,this.formats={number:xg((n,r)=>{const i=new Intl.NumberFormat(n,{...r});return s=>i.format(s)}),currency:xg((n,r)=>{const i=new Intl.NumberFormat(n,{...r,style:"currency"});return s=>i.format(s)}),datetime:xg((n,r)=>{const i=new Intl.DateTimeFormat(n,{...r});return s=>i.format(s)}),relativetime:xg((n,r)=>{const i=new Intl.RelativeTimeFormat(n,{...r});return s=>i.format(s,r.range||"day")}),list:xg((n,r)=>{const i=new Intl.ListFormat(n,{...r});return s=>i.format(s)})},this.init(e)}init(e){const r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=r.formatSeparator?r.formatSeparator:r.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=xg(n)}format(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(c=>c.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,c)=>{const{formatName:l,formatOptions:u}=Zdt(c);if(this.formats[l]){let d=a;try{const f=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},p=f.locale||f.lng||i.locale||i.lng||r;d=this.formats[l](a,p,{...u,...i,...f})}catch(f){this.logger.warn(f)}return d}else this.logger.warn(`there was no format function for ${l}`);return a},e)}}const eft=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class tft extends jI{constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=tl.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,i.backend,i)}queueLoad(e,n,r,i){const s={},o={},a={},c={};return e.forEach(l=>{let u=!0;n.forEach(d=>{const f=`${l}|${d}`;!r.reload&&this.store.hasResourceBundle(l,d)?this.state[f]=2:this.state[f]<0||(this.state[f]===1?o[f]===void 0&&(o[f]=!0):(this.state[f]=1,u=!1,o[f]===void 0&&(o[f]=!0),s[f]===void 0&&(s[f]=!0),c[d]===void 0&&(c[d]=!0)))}),u||(a[l]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(c)}}loaded(e,n,r){const i=e.split("|"),s=i[0],o=i[1];n&&this.emit("failedLoading",s,o,n),!n&&r&&this.store.addResourceBundle(s,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&r&&(this.state[e]=0);const a={};this.queue.forEach(c=>{Udt(c.loaded,[s],o),eft(c,e),n&&c.errors.push(n),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{a[l]||(a[l]={});const u=c.loaded[l];u.length&&u.forEach(d=>{a[l][d]===void 0&&(a[l][d]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(c=>!c.done)}read(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:r,tried:i,wait:s,callback:o});return}this.readingCalls++;const a=(l,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(l&&u&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,r,i+1,s*2,o)},s);return}o(l,u)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const l=c(e,n);l&&typeof l.then=="function"?l.then(u=>a(null,u)).catch(a):a(null,l)}catch(l){a(l)}return}return c(e,n,a)}prepareLoading(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();typeof e=="string"&&(e=this.languageUtils.toResolveHierarchy(e)),typeof n=="string"&&(n=[n]);const s=this.queueLoad(e,n,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,r){this.prepareLoading(e,n,{},r)}reload(e,n,r){this.prepareLoading(e,n,{reload:!0},r)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${s} for language ${i} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${s} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,n,r,i,s){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${r}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend&&this.backend.create){const c={...o,isUpdate:s},l=this.backend.create.bind(this.backend);if(l.length<6)try{let u;l.length===5?u=l(e,n,r,i,c):u=l(e,n,r,i),u&&typeof u.then=="function"?u.then(d=>a(null,d)).catch(a):a(null,u)}catch(u){a(u)}else l(e,n,r,i,a,c)}!e||!e[0]||this.store.addResource(e[0],n,r,i)}}}const fW=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),typeof t[1]=="string"&&(e.defaultValue=t[1]),typeof t[2]=="string"&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(r=>{e[r]=n[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),hW=t=>(typeof t.ns=="string"&&(t.ns=[t.ns]),typeof t.fallbackLng=="string"&&(t.fallbackLng=[t.fallbackLng]),typeof t.fallbackNS=="string"&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t),DE=()=>{},nft=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class lb extends jI{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=hW(e),this.services={},this.logger=tl,this.modules={external:[]},nft(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(r=n,n={}),!n.defaultNS&&n.defaultNS!==!1&&n.ns&&(typeof n.ns=="string"?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const i=fW();this.options={...i,...this.options,...hW(n)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...i.interpolation,...this.options.interpolation}),n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const s=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?tl.init(s(this.modules.logger),this.options):tl.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:typeof Intl<"u"&&(u=Qdt);const d=new lW(this.options);this.store=new aW(this.options.resources,this.options);const f=this.services;f.logger=tl,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new Jdt(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(f.formatter=s(u),f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new Xdt(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new tft(s(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",function(p){for(var m=arguments.length,v=new Array(m>1?m-1:0),S=1;S<m;S++)v[S-1]=arguments[S];e.emit(p,...v)}),this.modules.languageDetector&&(f.languageDetector=s(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=s(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new y2(this.services,this.options),this.translator.on("*",function(p){for(var m=arguments.length,v=new Array(m>1?m-1:0),S=1;S<m;S++)v[S-1]=arguments[S];e.emit(p,...v)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,r||(r=DE),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const c=T1(),l=()=>{const u=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),c.resolve(f),r(d,f)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),c}loadResources(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:DE;const i=typeof e=="string"?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&i.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const s=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(l=>{l!=="cimode"&&s.indexOf(l)<0&&s.push(l)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload&&this.options.preload.forEach(a=>o(a)),this.services.backendConnector.load(s,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(a)})}else r(null)}reloadResources(e,n,r){const i=T1();return typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),r||(r=DE),this.services.backendConnector.reload(e,n,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&yhe.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const r=this.languages[n];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,n){var r=this;this.isLanguageChangingTo=e;const i=T1();this.emit("languageChanging",e);const s=c=>{this.language=c,this.languages=this.services.languageUtils.toResolveHierarchy(c),this.resolvedLanguage=void 0,this.setResolvedLanguage(c)},o=(c,l)=>{l?(s(l),this.translator.changeLanguage(l),this.isLanguageChangingTo=void 0,this.emit("languageChanged",l),this.logger.log("languageChanged",l)):this.isLanguageChangingTo=void 0,i.resolve(function(){return r.t(...arguments)}),n&&n(c,function(){return r.t(...arguments)})},a=c=>{!e&&!c&&this.services.languageDetector&&(c=[]);const l=typeof c=="string"?c:this.services.languageUtils.getBestMatchFromCodes(c);l&&(this.language||s(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(l)),this.loadResources(l,u=>{o(u,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),i}getFixedT(e,n,r){var i=this;const s=function(o,a){let c;if(typeof a!="object"){for(var l=arguments.length,u=new Array(l>2?l-2:0),d=2;d<l;d++)u[d-2]=arguments[d];c=i.options.overloadTranslationOptionHandler([o,a].concat(u))}else c={...a};c.lng=c.lng||s.lng,c.lngs=c.lngs||s.lngs,c.ns=c.ns||s.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||s.keyPrefix);const f=i.options.keySeparator||".";let p;return c.keyPrefix&&Array.isArray(o)?p=o.map(m=>`${c.keyPrefix}${f}${m}`):p=c.keyPrefix?`${c.keyPrefix}${f}${o}`:o,i.t(p,c)};return typeof e=="string"?s.lng=e:s.lngs=e,s.ns=n,s.keyPrefix=r,s}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,c)=>{const l=this.services.backendConnector.state[`${a}|${c}`];return l===-1||l===0||l===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(s,e)))}loadNamespaces(e,n){const r=T1();return this.options.ns?(typeof e=="string"&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),n&&n(i)}),r):(n&&n(),Promise.resolve())}loadLanguages(e,n){const r=T1();typeof e=="string"&&(e=[e]);const i=this.options.preload||[],s=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=i.concat(s),this.loadResources(o=>{r.resolve(),n&&n(o)}),r):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services&&this.services.languageUtils||new lW(fW());return n.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new lb(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:DE;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new lb(i);return(e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r&&(s.store=new aW(this.store.data,i),s.services.resourceStore=s.store),s.translator=new y2(s.services,i),s.translator.on("*",function(a){for(var c=arguments.length,l=new Array(c>1?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];s.emit(a,...l)}),s.init(i,n),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const ns=lb.createInstance();ns.createInstance=lb.createInstance;ns.createInstance;ns.dir;ns.init;ns.loadResources;ns.reloadResources;ns.use;ns.changeLanguage;ns.getFixedT;const rft=ns.t;ns.exists;ns.setDefaultNamespace;ns.hasLoadedNamespace;ns.loadNamespaces;ns.loadLanguages;const ift="_qrCode_8px50_8",sft={qrCode:ift},oft=({data:t,className:e})=>{const[n,r]=y.useState(null);return y.useEffect(()=>{let i=!1;return Adt(t,{errorCorrectionLevel:"L"}).then(s=>{i||r(s)}).catch(s=>{i||r(null)}),()=>{i=!0}},[t]),b.jsx("div",{className:Pe(sft.qrCode,e),children:n&&b.jsx("img",{src:n,alt:rft("qr_code")})})},aft=({room:t,open:e,onDismiss:n})=>{const{t:r}=ht(),i=QR(t.roomId),s=y.useMemo(()=>yae(t.roomId,i,t.name),[i,t.name,t.roomId]),[,o]=Fut(s),[a,c]=y.useState(!1),l=y.useCallback(()=>c(!1),[c]),u=y.useCallback(d=>{d.stopPropagation(),o(),n(),c(!0)},[o,n]);return b.jsxs(b.Fragment,{children:[b.jsxs(nS,{title:r("invite_modal.title"),open:e,onDismiss:n,children:[b.jsx(oft,{className:d6.qrCode,data:s}),b.jsx(Mn,{className:d6.url,size:"sm",weight:"semibold",children:s}),b.jsx(tn,{className:d6.button,Icon:FBe,onClick:u,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),b.jsx(qut,{open:a,onDismiss:l,autoDismiss:2e3,Icon:Kb,children:r("invite_modal.link_copied_toast")})]})},cft=({client:t,isPasswordlessUser:e,confineToRoom:n,preload:r,skipLobby:i,hideHeader:s,rtcSession:o,muteStates:a})=>{const c=Eut(o),l=Iut(o);y.useEffect(()=>{var ue,Te;c.length>=but&&((Te=(ue=a.audio).setEnabled)==null||Te.call(ue,!1))},[]),y.useEffect(()=>(window.rtcSession=o,()=>{delete window.rtcSession}),[o]),y.useEffect(()=>{t.getRoom(o.room.roomId)!==o.room&&k.warn(`We've ended up with multiple rooms for the same ID (${o.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[t,o.room]);const{displayName:u,avatarUrl:d}=tS(t),f=Put(o.room),p=xut(o.room),{perParticipantE2EE:m,returnToLobby:v}=Fp(),S=QR(o.room.roomId),_=y.useMemo(()=>({userId:t.getUserId(),displayName:u,avatarUrl:d,roomId:o.room.roomId,roomName:f,roomAlias:o.room.getCanonicalAlias(),roomAvatar:p,e2eeSystem:S}),[t,u,d,o.room,f,p,S]),w=y.useMemo(()=>new Set(c.map(ue=>ue.sender)).size,[c]),T=rS(),C=y.useRef();C.current=T;const I=y.useRef();I.current=a,y.useEffect(()=>{const ue=async Te=>{var ze,et,lt,Ae,yn,un,je,Bt,_n,Jn,nn,Mr;const Re=await k_.getLocalDevices(void 0,!0),{audioInput:Oe,videoInput:De}=Te;if(Oe===null)(et=(ze=I.current.audio).setEnabled)==null||et.call(ze,!1);else{const kn=az(Oe,"audioinput",Re);kn?(k.debug(`Found audio input ID ${kn} for name ${Oe}`),C.current.audioInput.select(kn),(un=(yn=I.current.audio).setEnabled)==null||un.call(yn,!0)):(k.warn("Unknown audio input: "+Oe),(Ae=(lt=I.current.audio).setEnabled)==null||Ae.call(lt,!1))}if(De===null)(Bt=(je=I.current.video).setEnabled)==null||Bt.call(je,!1);else{const kn=az(De,"videoinput",Re);kn?(k.debug(`Found video input ID ${kn} for name ${De}`),C.current.videoInput.select(kn),(Mr=(nn=I.current.video).setEnabled)==null||Mr.call(nn,!0)):(k.warn("Unknown video input: "+De),(Jn=(_n=I.current.video).setEnabled)==null||Jn.call(_n,!1))}};if(rt&&r&&i){const Te=Re=>{(async()=>{await ue(Re.detail.data),await ME(o,m),rt.api.transport.reply(Re.detail,{})})().catch(Oe=>{k.error("Error joining RTC session",Oe)})};return rt.lazyActions.on(fs.JoinCall,Te),()=>{rt.lazyActions.off(fs.JoinCall,Te)}}else rt&&!r&&i&&(async()=>{await ue({audioInput:null,videoInput:null}),await ME(o,m)})().catch(Te=>{k.error("Error joining RTC session",Te)})},[o,r,i,m]);const[R,O]=y.useState(!1),[A,U]=y.useState(void 0),N=gc(),L=y.useCallback(ue=>{U(ue),O(!0);const Te=!!rt;zt.instance.eventCallEnded.track(o.room.roomId,o.memberships.length,Te,o),Zz(o).then(()=>{!e&&!n&&!zt.instance.isEnabled()&&N.push("/")}).catch(Re=>{k.error("Error leaving RTC session",Re)})},[o,e,n,N]);y.useEffect(()=>{if(rt&&l){rt.api.setAlwaysOnScreen(!0).catch(Te=>{k.error("Error calling setAlwaysOnScreen(true)",Te)});const ue=Te=>{rt.api.transport.reply(Te.detail,{}),Zz(o).catch(Re=>{k.error("Failed to leave RTC session",Re)})};return rt.lazyActions.once(fs.HangupCall,ue),()=>{rt.lazyActions.off(fs.HangupCall,ue)}}},[l,o]);const j=y.useCallback(()=>{O(!1),U(void 0),ME(o,m).catch(ue=>{k.error("Error re-entering RTC session on reconnect",ue)})},[o,m]),X=Out(o.room),[G,F]=y.useState(!1),V=y.useCallback(()=>F(!1),[F]),J=y.useCallback(()=>F(!0),[F]),K=X===hu.Public?J:null,{t:W}=ht();if(!cte()&&S.kind!==En.NONE)return b.jsxs(qh,{children:[b.jsx(ul,{children:W("browser_media_e2ee_unsupported_heading")}),b.jsx(Mn,{children:W("browser_media_e2ee_unsupported")}),b.jsx(Lo,{to:"/",children:W("common.home")})]});const Y=b.jsx(aft,{room:o.room,open:G,onDismiss:V}),ce=b.jsxs(b.Fragment,{children:[Y,b.jsx(Nde,{client:t,matrixInfo:_,muteStates:a,onEnter:()=>void ME(o,m),confineToRoom:n,hideHeader:s,participantCount:w,onShareClick:K})]});if(l)return b.jsxs(b.Fragment,{children:[Y,b.jsx(yut,{client:t,matrixInfo:_,rtcSession:o,participantCount:w,onLeave:L,hideHeader:s,muteStates:a,e2eeSystem:S,onShareClick:K})]});if(R&&rt===null)return e||zt.instance.isEnabled()&&rt===null||A?b.jsx(zst,{endedCallId:o.room.roomId,client:t,isPasswordlessUser:e,confineToRoom:n,leaveError:A,reconnect:j}):null;if(R&&rt!==null){if(!v)return null}else if(r||i)return null;return ce},lft="_modal_uexlf_8",uft={modal:lft},dft=({roomId:t})=>{const{t:e}=ht(),[n,r]=y.useState(!0),i=y.useCallback(a=>{a.preventDefault(),a.stopPropagation(),r(!1)},[r]),s=QR(t);s.kind===En.NONE&&k.error("Generating app redirect URL for encrypted room but don't have key available!");const o=y.useMemo(()=>{const a=new URL(t===null?window.location.href:yae(t,s));a.hash=pje(a.hash,l=>(l.set("appPrompt","false"),l.set("confineToRoom","true"),l));const c=new URL("io.element.call:/");return c.searchParams.set("url",a.toString()),c.toString()},[s,t]);return b.jsxs(nS,{className:uft.modal,title:e("app_selection_modal.title"),open:n,children:[b.jsx(Mn,{size:"md",weight:"semibold",children:e("app_selection_modal.text")}),b.jsx(tn,{kind:"secondary",onClick:i,children:e("app_selection_modal.continue_in_browser")}),b.jsx(tn,{as:"a",href:o,Icon:VBe,children:e("app_selection_modal.open_in_app")})]})},fft=()=>{const{confineToRoom:t,appPrompt:e,preload:n,hideHeader:r,displayName:i,skipLobby:s}=Fp(),{t:o}=ht(),{roomAlias:a,roomId:c,viaServers:l}=mje(),u=c??a;u||k.error("No room specified");const{registerPasswordlessUser:d}=Que(),[f,p]=y.useState(!1),{loading:m,authenticated:v,client:S,error:_,passwordlessUser:w}=l9(),{avatarUrl:T,displayName:C}=tS(S),I=wut();y.useEffect(()=>{!m&&!v&&i&&!rt&&(p(!0),d(i).catch(N=>{k.error("Failed to register passwordless user",N)}).finally(()=>{p(!1)}))},[m,v,i,p,d]);const[R,O]=hI();y.useEffect(()=>{R===null&&O&&O(!0)},[R,O]);const A=y.useCallback(N=>{switch(N.kind){case"loaded":return b.jsx(cft,{client:S,rtcSession:N.rtcSession,isPasswordlessUser:w,confineToRoom:t,preload:n,skipLobby:s,hideHeader:r,muteStates:I});case"waitForInvite":case"canKnock":{const L=N.kind==="canKnock"?N.knock:null,j=N.kind==="canKnock"?o("lobby.ask_to_join"):b.jsxs(b.Fragment,{children:[o("lobby.waiting_for_invite"),b.jsx(Kb,{})]});return b.jsx(Nde,{client:S,matrixInfo:{userId:S.getUserId()??"",displayName:C??"",avatarUrl:T??"",roomAlias:null,roomId:N.roomSummary.room_id,roomName:N.roomSummary.name??"",roomAvatar:N.roomSummary.avatar_url??null,e2eeSystem:{kind:N.roomSummary["im.nheko.summary.encryption"]?En.PER_PARTICIPANT:En.NONE}},onEnter:()=>L==null?void 0:L(),enterLabel:j,waitingForInvite:N.kind==="waitForInvite",confineToRoom:t,hideHeader:r,participantCount:null,muteStates:I,onShareClick:null})}default:return b.jsx(b.Fragment,{children:" "})}},[S,w,t,n,s,r,I,o,C,T]);let U;return m||f?U=b.jsx(vI,{}):_?U=b.jsx(mI,{error:_}):S?u?U=b.jsx(_rt,{client:S,roomIdOrAlias:u,viaServers:l,children:A}):U=b.jsx(Xue,{}):U=b.jsx(grt,{}),b.jsxs(b.Fragment,{children:[U,e&&(qm==="android"||qm==="ios")&&c&&b.jsx(dft,{roomId:c})]})},hft="_banner_1wp3v_8",pft={banner:hft},gft=({children:t,className:e,...n})=>{const{t:r}=ht(),i=yI();let s=!1;return(i==null?void 0:i.state)==="valid"&&(s=i.disconnected),b.jsx(b.Fragment,{children:s&&b.jsxs("div",{className:Pe(pft.banner,e),...n,children:[t,r("disconnected_banner")]})})},{slice:mft,forEach:vft}=[];function yft(t){return vft.call(mft.call(arguments,1),e=>{if(e)for(const n in e)t[n]===void 0&&(t[n]=e[n])}),t}const pW=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,_ft=(t,e,n)=>{const r=n||{};r.path=r.path||"/";const i=encodeURIComponent(e);let s=`${t}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!pW.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!pW.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return s},gW={create(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+n*60*1e3)),r&&(i.domain=r),document.cookie=_ft(t,encodeURIComponent(e),i)},read(t){const e=`${t}=`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){let i=n[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t){this.create(t,"",-1)}};var bft={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return gW.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;n&&typeof document<"u"&&gW.create(n,t,r,i,s)}},Sft={name:"querystring",lookup(t){var r;let{lookupQuerystring:e}=t,n;if(typeof window<"u"){let{search:i}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(i=window.location.hash.substring(window.location.hash.indexOf("?")));const o=i.substring(1).split("&");for(let a=0;a<o.length;a++){const c=o[a].indexOf("=");c>0&&o[a].substring(0,c)===e&&(n=o[a].substring(c+1))}}return n}};let C1=null;const mW=()=>{if(C1!==null)return C1;try{C1=window!=="undefined"&&window.localStorage!==null;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{C1=!1}return C1};var wft={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&mW())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:n}=e;n&&mW()&&window.localStorage.setItem(n,t)}};let k1=null;const vW=()=>{if(k1!==null)return k1;try{k1=window!=="undefined"&&window.sessionStorage!==null;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{k1=!1}return k1};var Eft={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&vW())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:n}=e;n&&vW()&&window.sessionStorage.setItem(n,t)}},Tft={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:n,userLanguage:r,language:i}=navigator;if(n)for(let s=0;s<n.length;s++)e.push(n[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},Cft={name:"htmlTag",lookup(t){let{htmlTag:e}=t,n;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(n=r.getAttribute("lang")),n}},kft={name:"path",lookup(t){var i;let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?(i=n[typeof e=="number"?e:0])==null?void 0:i.replace("/",""):void 0}},Rft={name:"subdomain",lookup(t){var i,s;let{lookupFromSubdomainIndex:e}=t;const n=typeof e=="number"?e+1:1,r=typeof window<"u"&&((s=(i=window.location)==null?void 0:i.hostname)==null?void 0:s.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[n]}};function Ift(){return{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t}}class _he{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=yft(n,this.options||{},Ift()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(bft),this.addDetector(Sft),this.addDetector(wft),this.addDetector(Eft),this.addDetector(Tft),this.addDetector(Cft),this.addDetector(kft),this.addDetector(Rft)}addDetector(e){return this.detectors[e.name]=e,this}detect(e){e||(e=this.options.order);let n=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(n=n.concat(i))}}),n=n.map(r=>this.options.convertDetectedLanguage(r)),this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(e,n){n||(n=this.options.caches),n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||n.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}_he.type="languageDetector";function t4(t){"@babel/helpers - typeof";return t4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t4(t)}function bhe(){return typeof XMLHttpRequest=="function"||(typeof XMLHttpRequest>"u"?"undefined":t4(XMLHttpRequest))==="object"}function xft(t){return!!t&&typeof t.then=="function"}function Pft(t){return xft(t)?t:Promise.resolve(t)}function Oft(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var n4={exports:{}},NE={exports:{}},yW;function Mft(){return yW||(yW=1,function(t,e){var n=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof la<"u"&&la,r=function(){function s(){this.fetch=!1,this.DOMException=n.DOMException}return s.prototype=n,new s}();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof a<"u"&&a,c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(F){return F&&DataView.prototype.isPrototypeOf(F)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(F){return F&&u.indexOf(Object.prototype.toString.call(F))>-1};function f(F){if(typeof F!="string"&&(F=String(F)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(F)||F==="")throw new TypeError('Invalid character in header field name: "'+F+'"');return F.toLowerCase()}function p(F){return typeof F!="string"&&(F=String(F)),F}function m(F){var V={next:function(){var J=F.shift();return{done:J===void 0,value:J}}};return c.iterable&&(V[Symbol.iterator]=function(){return V}),V}function v(F){this.map={},F instanceof v?F.forEach(function(V,J){this.append(J,V)},this):Array.isArray(F)?F.forEach(function(V){this.append(V[0],V[1])},this):F&&Object.getOwnPropertyNames(F).forEach(function(V){this.append(V,F[V])},this)}v.prototype.append=function(F,V){F=f(F),V=p(V);var J=this.map[F];this.map[F]=J?J+", "+V:V},v.prototype.delete=function(F){delete this.map[f(F)]},v.prototype.get=function(F){return F=f(F),this.has(F)?this.map[F]:null},v.prototype.has=function(F){return this.map.hasOwnProperty(f(F))},v.prototype.set=function(F,V){this.map[f(F)]=p(V)},v.prototype.forEach=function(F,V){for(var J in this.map)this.map.hasOwnProperty(J)&&F.call(V,this.map[J],J,this)},v.prototype.keys=function(){var F=[];return this.forEach(function(V,J){F.push(J)}),m(F)},v.prototype.values=function(){var F=[];return this.forEach(function(V){F.push(V)}),m(F)},v.prototype.entries=function(){var F=[];return this.forEach(function(V,J){F.push([J,V])}),m(F)},c.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function S(F){if(F.bodyUsed)return Promise.reject(new TypeError("Already read"));F.bodyUsed=!0}function _(F){return new Promise(function(V,J){F.onload=function(){V(F.result)},F.onerror=function(){J(F.error)}})}function w(F){var V=new FileReader,J=_(V);return V.readAsArrayBuffer(F),J}function T(F){var V=new FileReader,J=_(V);return V.readAsText(F),J}function C(F){for(var V=new Uint8Array(F),J=new Array(V.length),K=0;K<V.length;K++)J[K]=String.fromCharCode(V[K]);return J.join("")}function I(F){if(F.slice)return F.slice(0);var V=new Uint8Array(F.byteLength);return V.set(new Uint8Array(F)),V.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(F){this.bodyUsed=this.bodyUsed,this._bodyInit=F,F?typeof F=="string"?this._bodyText=F:c.blob&&Blob.prototype.isPrototypeOf(F)?this._bodyBlob=F:c.formData&&FormData.prototype.isPrototypeOf(F)?this._bodyFormData=F:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)?this._bodyText=F.toString():c.arrayBuffer&&c.blob&&l(F)?(this._bodyArrayBuffer=I(F.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(F)||d(F))?this._bodyArrayBuffer=I(F):this._bodyText=F=Object.prototype.toString.call(F):this._bodyText="",this.headers.get("content-type")||(typeof F=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(F)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var F=S(this);if(F)return F;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var F=S(this);return F||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(w)}),this.text=function(){var F=S(this);if(F)return F;if(this._bodyBlob)return T(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(C(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(N)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function A(F){var V=F.toUpperCase();return O.indexOf(V)>-1?V:F}function U(F,V){if(!(this instanceof U))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');V=V||{};var J=V.body;if(F instanceof U){if(F.bodyUsed)throw new TypeError("Already read");this.url=F.url,this.credentials=F.credentials,V.headers||(this.headers=new v(F.headers)),this.method=F.method,this.mode=F.mode,this.signal=F.signal,!J&&F._bodyInit!=null&&(J=F._bodyInit,F.bodyUsed=!0)}else this.url=String(F);if(this.credentials=V.credentials||this.credentials||"same-origin",(V.headers||!this.headers)&&(this.headers=new v(V.headers)),this.method=A(V.method||this.method||"GET"),this.mode=V.mode||this.mode||null,this.signal=V.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&J)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(J),(this.method==="GET"||this.method==="HEAD")&&(V.cache==="no-store"||V.cache==="no-cache")){var K=/([?&])_=[^&]*/;if(K.test(this.url))this.url=this.url.replace(K,"$1_="+new Date().getTime());else{var W=/\?/;this.url+=(W.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})};function N(F){var V=new FormData;return F.trim().split("&").forEach(function(J){if(J){var K=J.split("="),W=K.shift().replace(/\+/g," "),Y=K.join("=").replace(/\+/g," ");V.append(decodeURIComponent(W),decodeURIComponent(Y))}}),V}function L(F){var V=new v,J=F.replace(/\r?\n[\t ]+/g," ");return J.split("\r").map(function(K){return K.indexOf(`
`)===0?K.substr(1,K.length):K}).forEach(function(K){var W=K.split(":"),Y=W.shift().trim();if(Y){var ce=W.join(":").trim();V.append(Y,ce)}}),V}R.call(U.prototype);function j(F,V){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');V||(V={}),this.type="default",this.status=V.status===void 0?200:V.status,this.ok=this.status>=200&&this.status<300,this.statusText=V.statusText===void 0?"":""+V.statusText,this.headers=new v(V.headers),this.url=V.url||"",this._initBody(F)}R.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},j.error=function(){var F=new j(null,{status:0,statusText:""});return F.type="error",F};var X=[301,302,303,307,308];j.redirect=function(F,V){if(X.indexOf(V)===-1)throw new RangeError("Invalid status code");return new j(null,{status:V,headers:{location:F}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(V,J){this.message=V,this.name=J;var K=Error(V);this.stack=K.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function G(F,V){return new Promise(function(J,K){var W=new U(F,V);if(W.signal&&W.signal.aborted)return K(new o.DOMException("Aborted","AbortError"));var Y=new XMLHttpRequest;function ce(){Y.abort()}Y.onload=function(){var Te={status:Y.status,statusText:Y.statusText,headers:L(Y.getAllResponseHeaders()||"")};Te.url="responseURL"in Y?Y.responseURL:Te.headers.get("X-Request-URL");var Re="response"in Y?Y.response:Y.responseText;setTimeout(function(){J(new j(Re,Te))},0)},Y.onerror=function(){setTimeout(function(){K(new TypeError("Network request failed"))},0)},Y.ontimeout=function(){setTimeout(function(){K(new TypeError("Network request failed"))},0)},Y.onabort=function(){setTimeout(function(){K(new o.DOMException("Aborted","AbortError"))},0)};function ue(Te){try{return Te===""&&a.location.href?a.location.href:Te}catch{return Te}}Y.open(W.method,ue(W.url),!0),W.credentials==="include"?Y.withCredentials=!0:W.credentials==="omit"&&(Y.withCredentials=!1),"responseType"in Y&&(c.blob?Y.responseType="blob":c.arrayBuffer&&W.headers.get("Content-Type")&&W.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(Y.responseType="arraybuffer")),V&&typeof V.headers=="object"&&!(V.headers instanceof v)?Object.getOwnPropertyNames(V.headers).forEach(function(Te){Y.setRequestHeader(Te,p(V.headers[Te]))}):W.headers.forEach(function(Te,Re){Y.setRequestHeader(Re,Te)}),W.signal&&(W.signal.addEventListener("abort",ce),Y.onreadystatechange=function(){Y.readyState===4&&W.signal.removeEventListener("abort",ce)}),Y.send(typeof W._bodyInit>"u"?null:W._bodyInit)})}return G.polyfill=!0,a.fetch||(a.fetch=G,a.Headers=v,a.Request=U,a.Response=j),o.Headers=v,o.Request=U,o.Response=j,o.fetch=G,o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=n.fetch?n:r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e}(NE,NE.exports)),NE.exports}(function(t,e){var n;if(typeof fetch=="function"&&(typeof la<"u"&&la.fetch?n=la.fetch:typeof window<"u"&&window.fetch?n=window.fetch:n=fetch),typeof Oft<"u"&&typeof window>"u"){var r=n||Mft();r.default&&(r=r.default),e.default=r,t.exports=e.default}})(n4,n4.exports);var She=n4.exports;const whe=es(She),_W=CW({__proto__:null,default:whe},[She]);function bW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function SW(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bW(Object(n),!0).forEach(function(r){Aft(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Aft(t,e,n){return(e=Lft(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Lft(t){var e=Dft(t,"string");return Tp(e)=="symbol"?e:e+""}function Dft(t,e){if(Tp(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Tp(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Tp(t){"@babel/helpers - typeof";return Tp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tp(t)}var bu;typeof fetch=="function"&&(typeof global<"u"&&global.fetch?bu=global.fetch:typeof window<"u"&&window.fetch?bu=window.fetch:bu=fetch);var ub;bhe()&&(typeof global<"u"&&global.XMLHttpRequest?ub=global.XMLHttpRequest:typeof window<"u"&&window.XMLHttpRequest&&(ub=window.XMLHttpRequest));var _2;typeof ActiveXObject=="function"&&(typeof global<"u"&&global.ActiveXObject?_2=global.ActiveXObject:typeof window<"u"&&window.ActiveXObject&&(_2=window.ActiveXObject));!bu&&_W&&!ub&&!_2&&(bu=whe||_W);typeof bu!="function"&&(bu=void 0);var r4=function(e,n){if(n&&Tp(n)==="object"){var r="";for(var i in n)r+="&"+encodeURIComponent(i)+"="+encodeURIComponent(n[i]);if(!r)return e;e=e+(e.indexOf("?")!==-1?"&":"?")+r.slice(1)}return e},wW=function(e,n,r,i){var s=function(c){if(!c.ok)return r(c.statusText||"Error",{status:c.status});c.text().then(function(l){r(null,{status:c.status,data:l})}).catch(r)};if(i){var o=i(e,n);if(o instanceof Promise){o.then(s).catch(r);return}}typeof fetch=="function"?fetch(e,n).then(s).catch(r):bu(e,n).then(s).catch(r)},EW=!1,Nft=function(e,n,r,i){e.queryStringParams&&(n=r4(n,e.queryStringParams));var s=SW({},typeof e.customHeaders=="function"?e.customHeaders():e.customHeaders);typeof window>"u"&&typeof global<"u"&&typeof global.process<"u"&&global.process.versions&&global.process.versions.node&&(s["User-Agent"]="i18next-http-backend (node/".concat(global.process.version,"; ").concat(global.process.platform," ").concat(global.process.arch,")")),r&&(s["Content-Type"]="application/json");var o=typeof e.requestOptions=="function"?e.requestOptions(r):e.requestOptions,a=SW({method:r?"POST":"GET",body:r?e.stringify(r):void 0,headers:s},EW?{}:o),c=typeof e.alternateFetch=="function"&&e.alternateFetch.length>=1?e.alternateFetch:void 0;try{wW(n,a,i,c)}catch(l){if(!o||Object.keys(o).length===0||!l.message||l.message.indexOf("not implemented")<0)return i(l);try{Object.keys(o).forEach(function(u){delete a[u]}),wW(n,a,i,c),EW=!0}catch(u){i(u)}}},Uft=function(e,n,r,i){r&&Tp(r)==="object"&&(r=r4("",r).slice(1)),e.queryStringParams&&(n=r4(n,e.queryStringParams));try{var s;ub?s=new ub:s=new _2("MSXML2.XMLHTTP.3.0"),s.open(r?"POST":"GET",n,1),e.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!e.withCredentials,r&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var o=e.customHeaders;if(o=typeof o=="function"?o():o,o)for(var a in o)s.setRequestHeader(a,o[a]);s.onreadystatechange=function(){s.readyState>3&&i(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(r)}catch(c){console&&console.log(c)}},$ft=function(e,n,r,i){if(typeof r=="function"&&(i=r,r=void 0),i=i||function(){},bu&&n.indexOf("file:")!==0)return Nft(e,n,r,i);if(bhe()||typeof ActiveXObject=="function")return Uft(e,n,r,i);i(new Error("No fetch and no xhr implementation found!"))};function Av(t){"@babel/helpers - typeof";return Av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Av(t)}function TW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _6(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TW(Object(n),!0).forEach(function(r){Ehe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Fft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,The(r.key),r)}}function jft(t,e,n){return e&&Bft(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ehe(t,e,n){return(e=The(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function The(t){var e=Hft(t,"string");return Av(e)=="symbol"?e:e+""}function Hft(t,e){if(Av(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Av(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Kft=function(){return{loadPath:"../locales/{{lng}}/{{ns}}.json",addPath:"../locales/add/{{lng}}/{{ns}}",parse:function(n){return JSON.parse(n)},stringify:JSON.stringify,parsePayload:function(n,r,i){return Ehe({},r,i||"")},parseLoadPayload:function(n,r){},request:$ft,reloadInterval:typeof window<"u"?!1:60*60*1e3,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},Che=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Fft(this,t),this.services=e,this.options=n,this.allOptions=r,this.type="backend",this.init(e,n,r)}return jft(t,[{key:"init",value:function(n){var r=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.services=n,this.options=_6(_6(_6({},Kft()),this.options||{}),i),this.allOptions=s,this.services&&this.options.reloadInterval){var o=setInterval(function(){return r.reload()},this.options.reloadInterval);Av(o)==="object"&&typeof o.unref=="function"&&o.unref()}}},{key:"readMulti",value:function(n,r,i){this._readAny(n,n,r,r,i)}},{key:"read",value:function(n,r,i){this._readAny([n],n,[r],r,i)}},{key:"_readAny",value:function(n,r,i,s,o){var a=this,c=this.options.loadPath;typeof this.options.loadPath=="function"&&(c=this.options.loadPath(n,i)),c=Pft(c),c.then(function(l){if(!l)return o(null,{});var u=a.services.interpolator.interpolate(l,{lng:n.join("+"),ns:i.join("+")});a.loadUrl(u,o,r,s)})}},{key:"loadUrl",value:function(n,r,i,s){var o=this,a=typeof i=="string"?[i]:i,c=typeof s=="string"?[s]:s,l=this.options.parseLoadPayload(a,c);this.options.request(this.options,n,l,function(u,d){if(d&&(d.status>=500&&d.status<600||!d.status))return r("failed loading "+n+"; status code: "+d.status,!0);if(d&&d.status>=400&&d.status<500)return r("failed loading "+n+"; status code: "+d.status,!1);if(!d&&u&&u.message&&u.message.toLowerCase().indexOf("failed")>-1&&(u.message.indexOf("fetch")>-1||u.message.toLowerCase().indexOf("network")>-1))return r("failed loading "+n+": "+u.message,!0);if(u)return r(u,!1);var f,p;try{typeof d.data=="string"?f=o.options.parse(d.data,i,s):f=d.data}catch{p="failed parsing "+n+" to json"}if(p)return r(p,!1);r(null,f)})}},{key:"create",value:function(n,r,i,s,o){var a=this;if(this.options.addPath){typeof n=="string"&&(n=[n]);var c=this.options.parsePayload(r,i,s),l=0,u=[],d=[];n.forEach(function(f){var p=a.options.addPath;typeof a.options.addPath=="function"&&(p=a.options.addPath(f,r));var m=a.services.interpolator.interpolate(p,{lng:f,ns:r});a.options.request(a.options,m,c,function(v,S){l+=1,u.push(v),d.push(S),l===n.length&&typeof o=="function"&&o(u,d)})})}}},{key:"reload",value:function(){var n=this,r=this.services,i=r.backendConnector,s=r.languageUtils,o=r.logger,a=i.language;if(!(a&&a.toLowerCase()==="cimode")){var c=[],l=function(d){var f=s.toResolveHierarchy(d);f.forEach(function(p){c.indexOf(p)<0&&c.push(p)})};l(a),this.allOptions.preload&&this.allOptions.preload.forEach(function(u){return l(u)}),c.forEach(function(u){n.allOptions.ns.forEach(function(d){i.read(u,d,"read",null,null,function(f,p){f&&o.warn("loading namespace ".concat(d," for language ").concat(u," failed"),f),!f&&p&&o.log("loaded namespace ".concat(d," for language ").concat(u),p),i.loaded("".concat(u,"|").concat(d),f,p)})})})}}}])}();Che.type="backend";class Vft{constructor(){this.config=0,this.sentry=0,this.openTelemetry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>e!==2)}}class Qo{constructor(){this.isInitialized=!1,this.loadStates=new Vft}static isInitialized(){var e;return(e=Qo.internalInstance)==null?void 0:e.isInitialized}static initBeforeReact(){const e=new _he;e.addDetector({name:"urlFragment",lookup:()=>hc().lang??void 0}),ns.use(Che).use(e).use(PBe).init({fallbackLng:"en-GB",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}}).catch(i=>{k.error("Failed to initialize i18n",i)});const{fonts:n,fontScale:r}=hc();r!==null&&document.documentElement.style.setProperty("--font-scale",r.toString()),n.length>0&&document.documentElement.style.setProperty("--font-family",n.map(i=>`"${i}"`).join(", ")),document.body.setAttribute("data-platform",qm)}static init(){var e;return(e=Qo==null?void 0:Qo.internalInstance)!=null&&e.initPromise?null:(Qo.internalInstance=new Qo,Qo.internalInstance.initPromise=new Promise(n=>{Qo.internalInstance.initStep(n)}),Qo.internalInstance.initPromise)}initStep(e){var n,r,i,s;this.loadStates.config===0&&(this.loadStates.config=1,on.init().then(()=>{this.loadStates.config=2,this.initStep(e)},o=>{k.error("Failed to load config",o)})),this.loadStates.sentry===0&&this.loadStates.config===2&&((n=on.get().sentry)!=null&&n.DSN&&((r=on.get().sentry)!=null&&r.environment)&&b4e({dsn:(i=on.get().sentry)==null?void 0:i.DSN,environment:(s=on.get().sentry)==null?void 0:s.environment,integrations:[C4e({history})],tracesSampleRate:1}),this.loadStates.sentry=2),this.loadStates.openTelemetry===0&&this.loadStates.config===2&&(gI.globalInit(),this.loadStates.openTelemetry=2),this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const qft=()=>{const{theme:t}=Fp(),e=y.useRef(document.body.classList.item(0));y.useLayoutEffect(()=>{const n=t!=null&&t.includes("light")?"light":"dark",r=t!=null&&t.includes("high-contrast")?"-hc":"",i="cpd-theme-"+n+r;i!==e.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(i),e.current=i),document.body.classList.remove("no-theme")},[e,t])},UE=I4e(IOe),Gft=({children:t})=>{const{pathname:e}=Ku();return y.useEffect(()=>{let n="";!["/login","/register"].includes(e)&&!rt&&(n="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=n},[e]),b.jsx(b.Fragment,{children:t})},zft=({children:t})=>(qft(),t),Wft=({history:t})=>{const[e,n]=y.useState(!1);y.useEffect(()=>{var i;(i=Qo.init())==null||i.then(async()=>{e||(n(!0),await(rt==null?void 0:rt.api.sendContentLoaded()))}).catch(k.error)});const r=b.jsx(QQe,{});return b.jsx(MOe,{history:t,children:b.jsx(Gft,{children:b.jsx(zft,{children:b.jsx(Eoe,{children:e?b.jsx(y.Suspense,{fallback:null,children:b.jsx(eet,{children:b.jsx(Qtt,{children:b.jsxs(TD,{fallback:r,children:[b.jsx(gft,{}),b.jsxs(OOe,{children:[b.jsx(UE,{exact:!0,path:"/",children:b.jsx(Xue,{})}),b.jsx(UE,{exact:!0,path:"/login",children:b.jsx(srt,{})}),b.jsx(UE,{exact:!0,path:"/register",children:b.jsx(ort,{})}),b.jsx(UE,{path:"*",children:b.jsx(fft,{})})]})]})})})}):b.jsx(vI,{})})})})})};WVe().catch(t=>{k.error("Failed to initialize rageshake",t)});Vxe("debug");qxe((t,e,n)=>{global.mx_rage_logger.log(t,"livekit",e,n)});k.info("Element Call 1dc6584911fe333d951379e410225ec75a7f8d9f");const khe=xQ(document.getElementById("root"));let j0=null;window.isSecureContext?navigator.mediaDevices||(j0=new Error("Your browser does not support WebRTC.")):j0=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(j0!==null)throw khe.render(j0.message),j0;Qo.initBeforeReact();const Yft=LQ();khe.render(b.jsx(y.StrictMode,{children:b.jsx(Wft,{history:Yft})}));export{_Te as A,du as B,Zt as C,$l as D,Z as E,sn as F,fr as G,G2 as H,EJ as I,jr as J,Ge as K,Jft as L,oe as M,Gn as N,jl as O,fh as P,Be as Q,Wh as R,jc as S,vs as T,Z1 as U,V2 as V,Eb as W,Oft as a,Qft as b,la as c,xi as d,$2 as e,Me as f,zY as g,cJ as h,Fn as i,Bv as j,hd as k,k as l,Cf as m,wb as n,Ef as o,Oa as p,Ii as q,Nn as r,Jm as s,gTe as t,hs as u,TJ as v,K2 as w,Zi as x,P4 as y,yC as z};
//# sourceMappingURL=index-B63wl5pC.js.map
